<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Bbr on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/bbr/</link><description>Recent content in Bbr on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Tue, 17 Aug 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/bbr/index.xml" rel="self" type="application/rss+xml"/><item><title>æµ…æ·¡TCP BBR</title><link>https://wizmann.top/posts/bbr-intro/</link><pubDate>Tue, 17 Aug 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/bbr-intro/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸€å¯¹è·¨åœ°åŸŸçš„æœºå™¨ï¼ˆç¾Žå›½&amp;lt;-&amp;gt;é¦™æ¸¯ï¼‰ï¼Œä½¿ç”¨TCPï¼ˆCubicæ‹¥å¡žæŽ§åˆ¶ç®—æ³•ï¼‰é€šä¿¡throughputæœ€é«˜2MB/sï¼Œä¸¢åŒ…çŽ‡0.02%ã€‚ä½¿ç”¨UDPé€šä¿¡throughputæœ€é«˜èƒ½è¾¾åˆ°140MB/sã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªéžå¸¸å…¸åž‹çš„é•¿è‚¥ç®¡é“ï¼ˆLFNï¼‰ï¼Œå¹¶ä¸”ä¸¢åŒ…çŽ‡æ¯”è¾ƒé«˜ã€‚å°è¯•ä½¿ç”¨BBRç®—æ³•åŽï¼Œthroughputå¯è¾¾50MB/s+ï¼ˆWindowsç³»ç»Ÿï¼Œé€šä¿¡åè®®ä½¿ç”¨ç”¨æˆ·æ€MsQuicï¼‰ã€‚&lt;/p>
&lt;h2 id="loss-based-congestion-control-algorithm">Loss-based Congestion Control Algorithm &lt;a href="#loss-based-congestion-control-algorithm" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>Renoå’ŒCubicæ˜¯æ¯”è¾ƒç»å…¸çš„ï¼Œç”¨äºŽTCPçš„æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ã€‚è¿™ä¸€ç±»ç®—æ³•ä½¿ç”¨çš„æ˜¯åŸºäºŽä¸¢åŒ…åé¦ˆçš„æ€æƒ³ï¼Œå³ä¸€æ—¦äº§ç”Ÿäº†ä¸¢åŒ…ï¼Œå°±è®¤ä¸ºé“¾è·¯ä¸Šäº§ç”Ÿäº†æ‹¥å¡žã€‚å…ˆå°†æ‹¥å¡žçª—å£å‡åŠï¼Œå†è¿›å…¥å¿«é€Ÿæ¢å¤æ¨¡å¼ã€‚&lt;/p>
&lt;p>åœ¨å¿«é€Ÿæ¢å¤å®ŒæˆåŽä¸­ï¼Œå°±åˆä¼šé‡æ–°è¿›å…¥æ‹¥å¡žé¿å…é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-16/2021-08-16_23-07-29.png" alt="TCP-Reno-Cubic">&lt;/p>
&lt;p>Renoå½“æ”¶åˆ°ä¸€ä¸ªACKåŒ…æ—¶ï¼Œä¼šå°†æ‹¥å¡žçª—å£å¢žå¤§ä¸€ä¸ªMSSï¼Œçª—å£å¤§å°çº¿æ€§å¢žé•¿ã€‚è€ŒCubicä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåŸºäºŽä¸Šæ¬¡æ‹¥å¡žäº‹ä»¶äº§ç”Ÿæ—¶é—´çš„ä¸‰æ¬¡å‡½æ•°ï¼Œæ‰€ä»¥æ‹¥å¡žçª—å£èƒ½æ›´å¿«é€Ÿçš„æ¢å¤åˆ°æ‹¥å¡žäº‹ä»¶å‘ç”Ÿä¹‹å‰çš„å¤§å°ã€‚&lt;/p>
&lt;p>ä½†æ— è®ºæ˜¯Renoè¿˜æ˜¯Cubicï¼Œåœ¨é­é‡é«˜ä¸¢åŒ…çŽ‡çš„æ—¶å€™ï¼Œå…¶æ‹¥å¡žæŽ§åˆ¶çª—å£çš„å¤§å°ä¼šä¸€ç›´å¤„äºŽä¸€ä¸ªéžå¸¸å°çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>åœ¨RTTè¾ƒå¤§æ—¶ï¼Œæ‹¥å¡žçª—å£çš„å¤§å°å¢žé•¿é€Ÿåº¦æ›´åŠ ç¼“æ…¢ï¼Œä½¿å¾—å¸¦å®½åˆ©ç”¨çŽ‡é•¿æ—¶é—´ç»´æŒåœ¨ä¸€ä¸ªè¾ƒä½Žçš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¸‹å›¾ä¸ºCubicåœ¨æœ‰ä¸¢åŒ…ï¼ˆ0.002%, 0.02%, 0.2%, 1%, 2%ï¼‰ï¼Œé«˜å»¶æ—¶ï¼ˆ200ms RTTï¼‰çš„ç½‘ç»œæ¡ä»¶ä¸‹throughputæ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_00-18-45.png" alt="cubic-bandwidth">&lt;/p>
&lt;h2 id="bbr---congestion-based-congestion-control">BBR - Congestion-based Congestion Control &lt;a href="#bbr---congestion-based-congestion-control" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸åŒäºŽRenoå’ŒCubicï¼ŒBBRå¹¶æ²¡æœ‰ä½¿ç”¨â€œä¸¢åŒ…â€åšä¸ºæ‹¥å¡žäº§ç”Ÿçš„ä¿¡å·ï¼Œè€Œæ˜¯æž„å»ºäº†ä¸€ä¸ªåé¦ˆç³»ç»Ÿï¼Œé€šè¿‡æ—¶å»¶çš„å˜åŒ–æ¥ç¡®å®šé“¾è·¯ä¸Šæ˜¯å¦å‘ç”Ÿäº†æ‹¥å¡žã€‚&lt;/p>
&lt;h3 id="æ‹¥å¡žäº§ç”Ÿçš„ä¸‰ä¸ªé˜¶æ®µ">æ‹¥å¡žäº§ç”Ÿçš„ä¸‰ä¸ªé˜¶æ®µ &lt;a href="#%e6%8b%a5%e5%a1%9e%e4%ba%a7%e7%94%9f%e7%9a%84%e4%b8%89%e4%b8%aa%e9%98%b6%e6%ae%b5" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_00-58-34.png" alt="BBR-3-stages">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>App Limited åº”ç”¨é™åˆ¶é˜¶æ®µ &lt;br>
åœ¨æ­¤é˜¶æ®µï¼Œæ•°æ®ä¼ è¾“é€ŸçŽ‡ç”±ç”¨æˆ·ç¨‹åºå†³å®šã€‚ç”¨æˆ·ç¨‹åºå¹¶æ²¡æœ‰åˆ©ç”¨æ‰€æœ‰çš„å¸¦å®½ï¼ŒRTTç»´æŒç¨³å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Bandwidth Limited å¸¦å®½é™åˆ¶é˜¶æ®µ &lt;br>
åœ¨æ­¤é˜¶æ®µï¼Œæ•°æ®ä¼ è¾“é€ŸçŽ‡ç”±é“¾è·¯å¸¦å®½æ‰€å†³å®šï¼Œæœ‰æ•ˆåžåé‡ç­‰äºŽé“¾è·¯å¸¦å®½ã€‚ä½†ç”±äºŽé“¾è·¯ç¼“å­˜çš„å­˜åœ¨ï¼Œå‘é€ç«¯çš„å‘é€é€ŸçŽ‡å¯ä»¥ç•¥å¤§äºŽé“¾è·¯å¸¦å®½ã€‚æ­¤æ—¶æ•°æ®å¼€å§‹åœ¨é“¾è·¯ç¼“å­˜ä¸Šå †ç§¯ï¼ŒRTTå¢žåŠ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>Buffer Limited ç¼“å†²åŒºé™åˆ¶é˜¶æ®µ &lt;br>
å½“é“¾è·¯ç¼“å­˜æ— æ³•å®¹çº³æ‰€æœ‰çš„æ•°æ®åŒ…æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸¢åŒ…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Loss-basedæ‹¥å¡žæŽ§åˆ¶ç®—æ³•ä¼šåœ¨é˜¶æ®µ3çš„æ—¶å€™äº§ç”Ÿâ€œæ‹¥å¡žâ€ä¿¡å·ï¼Œä½†æ˜¯æ­¤æ—¶å¤§æ¦‚çŽ‡ä¸ºæ—¶å·²æ™šã€‚å› ä¸ºé“¾è·¯ç¼“å­˜å †ç§¯çš„æ•°æ®å·²ç»å¼€å§‹å½±å“RTTï¼Œå¹¶ä¸”å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç¼“å­˜å¤§å°å·®å¼‚ï¼Œè¿˜ä¼šå¯¼è‡´çŸ­æ—¶é—´å†…çš„æŒç»­ä¸¢åŒ…ï¼Œä½¿å¾—æ‹¥å¡žçª—å£å¤§å°æ€¥å‰§å‡å°ã€‚&lt;/p>
&lt;p>è€ŒBBRä¼šå°†æ‹¥å¡žæŽ§åˆ¶åœ¨é˜¶æ®µ1å’Œé˜¶æ®µ2çš„äº¤ç•Œå¤„ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§åŒ–åˆ©ç”¨å¸¦å®½ï¼Œå¹¶ä¸”ä½¿å¾—é“¾è·¯æ—¶å»¶æœ€å°ã€‚&lt;/p>
&lt;h3 id="ç¡®å®šæ‹¥å¡žçª—å£çš„å¤§å°">ç¡®å®šæ‹¥å¡žçª—å£çš„å¤§å° &lt;a href="#%e7%a1%ae%e5%ae%9a%e6%8b%a5%e5%a1%9e%e7%aa%97%e5%8f%a3%e7%9a%84%e5%a4%a7%e5%b0%8f" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>ä»Žç†è®ºä¸Šåˆ†æžï¼Œè¦ä½¿ä¸€æ¡è¿žæŽ¥åŒæ—¶ä¿æŒæœ€é«˜throughputå’Œæœ€å°çš„å»¶è¿Ÿï¼Œé‚£ä¹ˆå…¶å‘é€é€ŸçŽ‡ä¸€å®šç­‰äºŽç½‘ç»œå¸¦å®½ã€‚æ­¤æ—¶ï¼Œåœ¨é€”çš„æ•°æ®å¤§å°BDP = BtlBw Ã— RTpropï¼Œå°±å¯ä»¥ç”¨æ»¡é“¾è·¯çš„å¸¦å®½è€Œä¸äº§ç”Ÿæ‹¥å¡žã€‚&lt;/p>
&lt;p>BDPæ„ä¸ºâ€œå¸¦å®½æ—¶å»¶ä¹˜ç§¯â€ã€‚è€ŒBtlBwæ„ä¸ºâ€œç“¶é¢ˆå¸¦å®½â€ï¼Œå³ä¸ºæ•´æ¡é“¾è·¯ä¸­ï¼Œå¸¦å®½æœ€å°çš„éƒ¨åˆ†ã€‚RTpropæ„ä¸ºâ€œé“¾è·¯å›ºæœ‰ä¼ è¾“å»¶è¿Ÿâ€ã€‚&lt;/p>
&lt;blockquote>
&lt;p>RTTï¼ˆå¾€è¿”æ—¶å»¶ï¼‰ä¸ŽRTpropï¼ˆé“¾è·¯å›ºæœ‰ä¼ è¾“å»¶è¿Ÿï¼‰çš„åŒºåˆ«æ˜¯ï¼šRTTåŒ…æ‹¬äº†æ”¶å‘ä¸¤ç«¯åº”ç”¨å±‚çš„æ—¶å»¶ï¼Œè€ŒRTpropåªåŒ…å«ç½‘ç»œä¼ æ’­çš„æ—¶å»¶&lt;/p>&lt;/blockquote>
&lt;p>ä¸å‡‘å·§çš„æ˜¯ï¼Œåœ¨é€šä¿¡ä¸­æˆ‘ä»¬å‡ ä¹Žæ— æ³•ç›´æŽ¥ç¡®å®šBtlBwå’ŒRTpropã€‚BBRå»ºç«‹äº†ä¸€ä¸ªæ¨¡åž‹æ¥å¯¹å…¶è¿›è¡Œä¼°è®¡ã€‚å…¬å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_10-02-28.png" alt="rtprop-hat">&lt;/p>
&lt;p>Î·ä»£è¡¨çš„æ˜¯ç½‘ç»œé˜Ÿåˆ—çš„æŠ–åŠ¨ã€æŽ¥æ”¶æ–¹ACKæ—¶å»¶ç­‰ç­‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_10-04-06.png" alt="btlbw-hat">&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæ—¶å»¶ä¸Žå¸¦å®½æ— æ³•åŒæ—¶æŽ¢æµ‹ã€‚å› ä¸ºæŽ¢æµ‹æ—¶å»¶æ—¶ï¼Œæˆ‘ä»¬å¿…ç„¶è¦å‡æ…¢å‘åŒ…é€Ÿåº¦ï¼ŒæŽ’ç©ºé˜Ÿåˆ—é¿å…æ‹¥å¡žï¼›è€ŒæŽ¢æµ‹å¸¦å®½æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡å æ»¡å¸¦å®½ï¼Œä»¥æ£€æµ‹ACKé€ŸçŽ‡æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥æ—¶å»¶ä¸Žå¸¦å®½çš„æŽ¢æµ‹éœ€è¦äº¤æ›¿è¿›è¡Œã€‚&lt;/p>
&lt;h4 id="probertt---æ—¶å»¶æŽ¢æµ‹">ProbeRTT - æ—¶å»¶æŽ¢æµ‹ &lt;a href="#probertt---%e6%97%b6%e5%bb%b6%e6%8e%a2%e6%b5%8b" class="anchor">ðŸ”—&lt;/a>&lt;/h4>&lt;p>BBRæ¯10ç§’é’Ÿä¼šè¿›å…¥æ—¶å»¶æŽ¢æµ‹çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼ŒBBRä¼šé™åˆ¶æ‹¥å¡žçª—å£çš„å¤§å°åˆ°4ä¸ªMSSï¼ˆ&lt;a href="https://blog.csdn.net/dog250/article/details/72042516">ä¸ºä»€ä¹ˆï¼Ÿ&lt;/a>ï¼‰ã€‚å½“æ”¶åˆ°ACKåŒ…åŽï¼Œä¼šæ›´æ–°MinRTTçš„å–æ ·å€¼ã€‚&lt;/p>
&lt;h4 id="probebw---å¸¦å®½æŽ¢æµ‹">ProbeBW - å¸¦å®½æŽ¢æµ‹ &lt;a href="#probebw---%e5%b8%a6%e5%ae%bd%e6%8e%a2%e6%b5%8b" class="anchor">ðŸ”—&lt;/a>&lt;/h4>&lt;p>BBRå¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¼šå¤„äºŽProbeBWçŠ¶æ€ã€‚&lt;/p>
&lt;p>BBRé€šè¿‡è®¡ç®—åŒ…çš„å‘é€æ—¶é—´ä¸Žæ”¶åˆ°ACKæ—¶é—´çš„å·®æ¥ç¡®å®šå¸¦å®½ï¼Œä½¿ç”¨â€œé€è¾¾é€Ÿåº¦â€æ¥æ‹Ÿåˆå¸¦å®½ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/6b0dcc0d2f7b2446ea0c3ca6faec29da6f28dc7e/wizmann-pic/21-08-17/image.png" alt="bw-probe-pacing">&lt;/p>
&lt;p>åŒæ—¶ï¼ŒBBRä¼šé‡‡ç”¨gain cycleæ¥éšæœºå¾®è°ƒï¼ˆ+25%, -25%, ä¸å˜ï¼‰å‘é€é€ŸçŽ‡ï¼Œä»¥å®žæ—¶æ£€æµ‹é“¾è·¯ä¸Šå¸¦å®½çš„å˜åŒ–ã€‚ï¼ˆå›¾ä¸­çš„ç»¿çº¿çœ‹èµ·æ¥åƒå¿ƒç”µå›¾çš„éƒ¨åˆ†ï¼‰&lt;/p>
&lt;h3 id="æ€§èƒ½æ¯”è¾ƒ">æ€§èƒ½æ¯”è¾ƒ &lt;a href="#%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é‡Œæ˜¯Cubicä¸ŽBBRåœ¨æœ‰ä¸¢åŒ…ï¼ˆ0.002%, 0.02%, 0.2%, 1%, 2%ï¼‰ï¼Œé«˜å»¶æ—¶ï¼ˆ200ms RTTï¼‰çš„ç½‘ç»œæ¡ä»¶ä¸‹çš„throughputå¯¹æ¯”ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/8a78e8e7c7193f4bf5d6de01997f21491f3794ab/wizmann-pic/21-08-17/Snipaste_2021-08-17_14-54-21.png" alt="perf-bbr-cubic">&lt;/p>
&lt;h2 id="æ‚é¡¹">æ‚é¡¹ &lt;a href="#%e6%9d%82%e9%a1%b9" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ä½¿ç”¨tcå‘½ä»¤æ¨¡æ‹Ÿä¸åŒçš„ç½‘ç»œçŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚100mså»¶è¿Ÿï¼ˆRTT=2*å»¶è¿Ÿï¼‰ï¼Œ1%ä¸¢åŒ…çŽ‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo tc qdisc add dev lo root handle 1:0 netem delay 100msec loss 1%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨Windowsä¸‹å¯ä»¥ä½¿ç”¨&lt;a href="http://jagt.github.io/clumsy/">Clumsy&lt;/a>è¿›è¡Œæ¨¡æ‹Ÿï¼Œä½†æ˜¯æœ‰æ€€ç–‘å…¶ä¼šä¸¥é‡å½±å“ç½‘ç»œæ€§èƒ½ï¼Œæ•ˆæžœæœ‰å¾…è¿›ä¸€æ­¥æµ‹è¯•ã€‚&lt;/p>
&lt;p>åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›¿æ¢ç³»ç»Ÿcongestion controlç®—æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv4.tcp_congestion_control&lt;span style="color:#f92672">=&lt;/span>cubic
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv4.tcp_congestion_control&lt;span style="color:#f92672">=&lt;/span>bbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="references">References &lt;a href="#references" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://juejin.cn/post/6844904065759969287">æµ…è°ˆTCP/IPä¼ è¾“å±‚TCP BBRç®—æ³•&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/CUBIC_TCP">CUBIC TCP&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://queue.acm.org/detail.cfm?id=3022184">BBR: Congestion-Based Congestion Control&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/facebookincubator/mvfst">facebookincubator/mvfst&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://blog.csdn.net/dog250/article/details/72042516">ä½¿ç”¨TCPæ—¶åºå›¾è§£é‡ŠBBRæ‹¥å¡žæŽ§åˆ¶ç®—æ³•çš„å‡ ä¸ªç»†èŠ‚&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item></channel></rss>