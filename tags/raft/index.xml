<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Raft on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/raft/</link><description>Recent content in Raft on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Thu, 02 May 2019 21:33:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/raft/index.xml" rel="self" type="application/rss+xml"/><item><title>6.824 Lab 2: Raftåè®®å®ç°æŒ‡å— ï¼ˆæ— å‰§é€ç‰ˆï¼‰</title><link>https://wizmann.top/posts/raft-lab-mit-6.824/</link><pubDate>Thu, 02 May 2019 21:33:00 +0000</pubDate><guid>https://wizmann.top/posts/raft-lab-mit-6.824/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>MIT6.824æ˜¯ä¸€ä¸ªç”¨æ¥å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿçš„éå¸¸å¥½çš„èµ„æºã€‚å…¶ä¸­ç¬¬äºŒä¸ªè¯¾ç¨‹ä½œä¸šå°±æ˜¯å…³äº&lt;a href="https://pdos.csail.mit.edu/6.824/labs/lab-raft.html">Raftç®—æ³•&lt;/a>ã€‚&lt;/p>
&lt;p>ç”±äºåœ¨å·¥ä½œä¸­æ¶‰åŠåˆ°åˆ†å¸ƒä¸€è‡´æ€§ç®—æ³•çš„è°ƒç ”ï¼Œæ¥è§¦äº†paxos/raftç®—æ³•ã€‚ç„¶åè¢«@neutronestå®‰åˆ©äº†ä¸€å‘ï¼Œäºæ˜¯å¼€å§‹ç€æ‰‹å®ç°è¿™ä¸ªä½œä¸šã€‚&lt;/p>
&lt;p>æœ¬æ–‡æ˜¯æˆ‘å¯¹è¿™ä¸ªé¡¹ç›®çš„å®ç°æ€»ç»“ã€‚å¸Œæœ›èƒ½åœ¨åˆ’å‡ºé‡ç‚¹çš„åŒæ—¶ï¼Œä¸æ¶‰åŠå®ç°ç»†èŠ‚ï¼Œé¿å…ç ´åå¤§å®¶çš„å†™ä»£ç ä½“éªŒã€‚&lt;/p>
&lt;p>æœ¬æ–‡å”¯ä¸€å‚è€ƒèµ„æ–™ï¼š&lt;a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm&lt;/a>&lt;/p>
&lt;h2 id="ä»»åŠ¡åˆ†è§£">ä»»åŠ¡åˆ†è§£ &lt;a href="#%e4%bb%bb%e5%8a%a1%e5%88%86%e8%a7%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å®˜æ–¹æ–‡æ¡£é‡Œï¼Œæ•´ä¸ªé¡¹ç›®è¢«åˆ†æˆäº†2Aã€2Bã€2Cä¸‰ä¸ªéƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>2A - æŠ•ç¥¨ä¸é€‰ä¸¾&lt;/li>
&lt;li>2B - ä¸€è‡´æ€§&lt;/li>
&lt;li>2C - å¯æŒä¹…åŒ–&lt;/li>
&lt;/ul>
&lt;p>å®é™…ä¸Šï¼Œ2Cçš„å·¥ä½œé‡éå¸¸å°‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ2Bå’Œ2Cåˆæˆä¸€ä¸ªã€‚ç„¶åå•ç‹¬æå‡ºå‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ’åˆ†æˆå­é¡¹ç›®ã€‚ä»»åŠ¡åˆ†è§£å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>2A - æŠ•ç¥¨ä¸é€‰ä¸¾&lt;/li>
&lt;li>2B/2C - ä¸€è‡´æ€§å’Œå¯æŒä¹…åŒ–&lt;/li>
&lt;li>ä¸‰ä¸ªéš¾åº¦æ¯”è¾ƒé«˜çš„Case
&lt;ul>
&lt;li>Test (2B): leader backs up quickly over incorrect follower logs &lt;br>
éªŒè¯åè®®å®ç°çš„æ­£ç¡®æ€§&lt;/li>
&lt;li>Test (2B): RPC counts aren&amp;rsquo;t too high &lt;br>
æµ‹è¯•åè®®æ˜¯å¦äº§ç”Ÿäº†è¿‡å¤šçš„RPCè¯·æ±‚ã€‚éªŒè¯åè®®çš„æ€§èƒ½ã€‚&lt;/li>
&lt;li>Test (2C): Figure 8 (unreliable) &lt;br>
æµ‹è¯•åœ¨æç«¯æ··ä¹±çš„æƒ…å†µä¸‹ï¼ŒRaftåè®®æ˜¯å¦èƒ½åŠæ—¶æ¢å¤æ­£å¸¸å·¥ä½œã€‚éªŒè¯åè®®å®ç°çš„æ­£ç¡®æ€§å’Œæ€§èƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥æ¨èå¤§å®¶æŒ‰é¡ºåºä»¥ä¸Šé¡ºåºè¿›è¡Œå®ç°ã€‚å¹¶ä¸”å……åˆ†åˆ©ç”¨ç‰ˆæœ¬æ§åˆ¶å¯¹ä»£ç è¿›è¡Œå¼€å‘å’Œé‡æ„ã€‚&lt;/p>
&lt;h2 id="éœ€è¦å…³æ³¨çš„çŸ¥è¯†ç‚¹">éœ€è¦å…³æ³¨çš„çŸ¥è¯†ç‚¹ &lt;a href="#%e9%9c%80%e8%a6%81%e5%85%b3%e6%b3%a8%e7%9a%84%e7%9f%a5%e8%af%86%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸‹ä¼šä»‹ç»æ¯ä¸€ä¸ªéƒ¨åˆ†éœ€è¦é‡ç‚¹å…³æ³¨çš„çŸ¥è¯†ç‚¹ï¼Œå†…å®¹åŒ…æ‹¬golangåŸºç¡€å’Œè®ºæ–‡ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œæ— å‰§é€ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨ã€‚&lt;/p>
&lt;h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ &lt;a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>golangæ˜¯ä¸€é—¨å‚²æ…¢çš„è¯­è¨€ï¼Œå…¶æ ‡å‡†åº“çš„ç¼ºä¹å®åœ¨æ˜¯è®©äººæ„Ÿåˆ°TMDè›‹ç–¼ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªè¯¾ç¨‹ä½œä¸šæ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¿…è¦å¼•å…¥ä¸€ç³»åˆ—ç¬¬ä¸‰æ–¹åº“ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆè¦æ‰©å……&lt;code>util.go&lt;/code>æ–‡ä»¶ï¼Œä½¿å…¶ä¸ºæˆ‘ä»¬çš„å¼€å‘æä¾›æ›´å¤šçš„ä¾¿åˆ©ã€‚&lt;/p>
&lt;h4 id="logæ¨¡å—">Logæ¨¡å— &lt;a href="#log%e6%a8%a1%e5%9d%97" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é¡¹ç›®ç»™å‡ºçš„&lt;code>DPrintf&lt;/code>å‡½æ•°éå¸¸ç®€å•ï¼Œåªæä¾›äº†ä¸€ä¸ª&lt;code>fmt.Printf&lt;/code>çš„å°è£…ã€‚å¹¶ä¸èƒ½æ‰“å°è¡Œå·å’Œæ–‡ä»¶åã€‚è¿™é‡Œæä¾›ä¸€ä¸ªæ‰©å±•ç‰ˆæœ¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">DPrintf&lt;/span>(&lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">Debug&lt;/span> &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">path&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">runtime&lt;/span>.&lt;span style="color:#a6e22e">Caller&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">filepath&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#a6e22e">path&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">ok&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Now&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> = append([]&lt;span style="color:#66d9ef">interface&lt;/span>{} { &lt;span style="color:#a6e22e">t&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2006-01-02 15:04:05.00&amp;#34;&lt;/span>), &lt;span style="color:#a6e22e">file&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span> }, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s [%s:%d] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶è¾“å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>2019-05-02 09:28:35.04 [raft.go:652] Node[1] is processing, state: [LEADER], term 1, commitIndex: 12, logCount: 12, leader 1
&lt;/code>&lt;/pre>&lt;h4 id="maxå’Œminå‡½æ•°">Maxå’ŒMinå‡½æ•° &lt;a href="#max%e5%92%8cmin%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>golangæ˜¯æ²¡æœ‰å¯¹äºintå€¼çš„&lt;code>max&lt;/code>å’Œ&lt;code>min&lt;/code>å‡½æ•°çš„ï¼Œè¿™é‡Œçœç•¥è„è¯100å¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Min&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &amp;lt; &lt;span style="color:#a6e22e">b&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Max&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &amp;gt; &lt;span style="color:#a6e22e">b&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="assertå‡½æ•°">Assertå‡½æ•° &lt;a href="#assert%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œgolangä¹Ÿæ²¡æœ‰æä¾›&lt;code>assert&lt;/code>å‡½æ•°ã€‚å¦‚æœä½ å«Œåˆ°å¤„å†™&lt;code>if&lt;/code>å’Œ&lt;code>panic&lt;/code>å¤ªä¸‘çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª&lt;code>assert&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Assert&lt;/span>(&lt;span style="color:#a6e22e">flag&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (!&lt;span style="color:#a6e22e">flag&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">path&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">runtime&lt;/span>.&lt;span style="color:#a6e22e">Caller&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">filepath&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#a6e22e">path&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">ok&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Now&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> = append([]&lt;span style="color:#66d9ef">interface&lt;/span>{} { &lt;span style="color:#a6e22e">t&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2006-01-02 15:04:05.00&amp;#34;&lt;/span>), &lt;span style="color:#a6e22e">file&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span> }, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">reason&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s [%s:%d] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#a6e22e">reason&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="log-id">Log Id &lt;a href="#log-id" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸ºäº†éªŒè¯æ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬åœ¨æ—¥å¿—ä¸­é¢å¤–åŠ å…¥ä¸€ä¸ªUUIDæ¥è¿›è¡Œæ ‡è¯†ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>import &amp;#34;math/rand&amp;#34;
func CreateLogId() (uuid string) {
b := make([]byte, 16)
_, err := rand.Read(b)
if err != nil {
fmt.Println(&amp;#34;Error: &amp;#34;, err)
return
}
uuid = fmt.Sprintf(&amp;#34;%X-%X-%X-%X-%X&amp;#34;, b[0:4], b[4:6], b[6:8], b[8:10], b[10:])
return uuid
}
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šä»£ç å¯ä»¥ç”Ÿæˆä¸€ä¸ªï¼ˆä¼ªï¼‰UUIDå¯¹æ—¥å¿—è¿›è¡Œæ ‡è¯†ã€‚æ¨èä½¿ç”¨&lt;code>math/rand&lt;/code>ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¼ªéšæœºæ•°å°±å¤Ÿäº†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨ï¼šè¿™é‡Œçš„UUIDåªæ˜¯çœ‹èµ·æ¥åƒä¸€ä¸ªUUIDï¼Œå®é™…ä¸ŠUUIDæœ‰å…¶ç‰¹æ®Šçš„è§„èŒƒä¸æ ¼å¼ã€‚ä½†æ˜¯ç”±äºgolangå†…éƒ¨æ²¡æœ‰æä¾›å¯ç”¨çš„UUIDåº“ï¼Œæ‰€ä»¥åªå¥½éšæ‰‹æ¨¡æ‹Ÿäº†ä¸€ä¸ªã€‚&lt;/p>&lt;/blockquote>
&lt;h4 id="æ–‡ä»¶ç»„ç»‡">æ–‡ä»¶ç»„ç»‡ &lt;a href="#%e6%96%87%e4%bb%b6%e7%bb%84%e7%bb%87" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é»˜è®¤çš„å®ç°æ˜¯æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½å†™åˆ°äº†&lt;code>raft.go&lt;/code>æ–‡ä»¶é‡Œã€‚ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶å¯èƒ½ä¼šç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥è´Ÿæ‹…ï¼Œæ‰€ä»¥æˆ‘çš„åšæ³•æ˜¯æŠŠæ‰€æœ‰çš„ç±»å£°æ˜æ”¾åˆ°&lt;code>models.go&lt;/code>æ–‡ä»¶é‡Œã€‚ä»¥é¿å…æ–‡ä»¶çš„è†¨èƒ€ã€‚&lt;/p>
&lt;h4 id="é”ä¸defer">é”ä¸defer &lt;a href="#%e9%94%81%e4%b8%8edefer" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨raftå®ç°ä¸­ï¼Œé”å¯ä»¥ç”¨æ¥ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„æ­£ç¡®æ€§ã€‚æ‰€ä»¥åªè¦åœ¨æ¶‰åŠåˆ°raftå†…éƒ¨çŠ¶æ€çš„å˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦åŠ é”ã€‚ä¸€ä¸ªå¸¸è§çš„åŠ é”patternæ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>() &lt;span style="color:#75715e">// åŠ é”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>() &lt;span style="color:#75715e">// åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆåè§£é”&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæ¨èä½¿ç”¨deferï¼Œå› ä¸ºæ‰‹åŠ¨æ§åˆ¶é”å®ç°æ˜¯è¿‡äºå®¹æ˜“å‡ºé”™ã€‚ä½†æ˜¯deferä¹Ÿæ˜¯æœ‰å‘çš„ï¼&lt;/p>
&lt;p>ä¸åŒäºC++çš„å¤§æ‹¬å·ä½œç”¨åŸŸï¼Œdeferçš„è§¦å‘æ—¶é—´æ˜¯åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œè€Œå¹¶ä¸æ˜¯é€€å‡ºå½“å‰å¤§æ‹¬å·æ—¶ã€‚è¿™ç‚¹éå¸¸éœ€è¦æ³¨æ„ï¼Œå¦åˆ™ææ˜“å‡ºç°æ­»é”ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬æƒ³å®ç°C++ä¸­&lt;code>do { ... } while (0);&lt;/code>ç±»ä¼¼çš„lock guard patternï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Unlock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// do something here&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨æ‰§è¡Œå®Œå½“å‰lambdaä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨è§£é”ã€‚&lt;/p>
&lt;h4 id="åˆ·æ–°å®šæ—¶å™¨">åˆ·æ–°å®šæ—¶å™¨ &lt;a href="#%e5%88%b7%e6%96%b0%e5%ae%9a%e6%97%b6%e5%99%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç”±äºraftç®—æ³•é‡Œé¢ä½¿ç”¨äº†å®šæ—¶å™¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªåˆ·æ–°å®šæ—¶å™¨çš„golangä»£ç ã€‚è¿™æ ·å®ç°æ˜¯ä¸ºäº†æ¯æ¬¡åœ¨åˆ·æ–°çš„æ—¶å€™ï¼Œæ¸…ç©ºå®šæ—¶å™¨ä¸­åŸæœ‰çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…æ··ä¹±ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">rf&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Raft&lt;/span>) &lt;span style="color:#a6e22e">renewTimer&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Duration&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span> = &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">NewTimer&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (!&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">Stop&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">select&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">C&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">Reset&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥åŠï¼Œåœ¨å®šæ—¶å™¨è¶…æ—¶ä¹‹åï¼Œä¸è¦å¿˜äº†æ›´æ–°å®šæ—¶å™¨ã€‚&lt;/p>
&lt;h3 id="2a---æŠ•ç¥¨ä¸é€‰ä¸¾">2A - æŠ•ç¥¨ä¸é€‰ä¸¾ &lt;a href="#2a---%e6%8a%95%e7%a5%a8%e4%b8%8e%e9%80%89%e4%b8%be" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="æ‰€éœ€è¦ç±»çš„å£°æ˜">æ‰€éœ€è¦ç±»çš„å£°æ˜ &lt;a href="#%e6%89%80%e9%9c%80%e8%a6%81%e7%b1%bb%e7%9a%84%e5%a3%b0%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è®ºæ–‡ä¸­çš„&lt;code>Figure2&lt;/code>åŒ…å«äº†ç®—æ³•ä¸­æ‰€æœ‰çš„ç±»ä»¥åŠåŸºæœ¬ç®—æ³•ã€‚åœ¨2Aä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šè¢«ç”¨åˆ°ã€‚ç”±äº2Aä¸­åªåŒ…æ‹¬æŠ•ç¥¨ä¸é€‰ä¸¾ï¼Œæ‰€ä»¥å’Œæ—¥å¿—ç›¸å…³çš„å­—æ®µå¯ä»¥å…ˆå¿½ç•¥æ‰ã€‚&lt;/p>
&lt;h4 id="checklist-for-2a">Checklist for 2A &lt;a href="#checklist-for-2a" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>å®ç°raftçŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€ï¼šleaderï¼Œfollowerå’Œcandidate&lt;/li>
&lt;li>å®ç°RPCå‡½æ•°ï¼š&lt;code>sendRequestVote&lt;/code>ï¼ˆå‘é€ç«¯ï¼‰å’Œ&lt;code>RequestVote&lt;/code>ï¼ˆæ¥æ”¶ç«¯çš„å›è°ƒå‡½æ•°ï¼‰&lt;/li>
&lt;li>å®ç°RPCå‡½æ•°ï¼š&lt;code>sendAppendEntries&lt;/code>ï¼ˆå‘é€ç«¯ï¼‰å’Œ&lt;code>AppendEntries&lt;/code>ï¼ˆæ¥æ”¶ç«¯çš„å›è°ƒå‡½æ•°ï¼‰&lt;/li>
&lt;li>ä¿è¯raftçŠ¶æ€æœºçš„ä»»æœŸå·ï¼ˆ&lt;code>currentTerm&lt;/code>ï¼‰æ˜¯å•è°ƒé€’å¢çš„&lt;/li>
&lt;li>ä¸€ä¸ªFollowerå¯¹äºæŸä¸€ä¸ªTermåªèƒ½æŠ•å‡ºä¸€ç¥¨&lt;/li>
&lt;li>å®ç°Leaderå¿ƒè·³ï¼Œç»´æŠ¤å½“å‰ä»»æœŸï¼ˆTermï¼‰ã€‚&lt;/li>
&lt;li>å®ç°Followeré€‰ä¸¾è¶…æ—¶ï¼ˆelection timeoutï¼‰&lt;/li>
&lt;li>å®ç°Candidateé€‰ä¸¾çš„ä¸‰ç§åœºæ™¯
&lt;ul>
&lt;li>è·å¾—å¤šæ•°é€‰ç¥¨ï¼Œèµ¢å¾—é€‰ä¸¾ã€‚çŠ¶æ€åˆ‡æ¢ä¸ºLeader&lt;/li>
&lt;li>å…¶å®ƒçš„èŠ‚ç‚¹å·²ç»è¢«é€‰ä¸ºLeaderã€‚çŠ¶æ€åˆ‡æ¢ä¸ºFollower&lt;/li>
&lt;li>åœ¨é€‰ä¸¾ä¸­å¹¶æœªè·å¾—å¤šæ•°é€‰ç¥¨ï¼ŒçŠ¶æ€åˆ‡æ¢ä¸ºFollower&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å®ç°Candidateéšæœºé€‰ä¸¾è¶…æ—¶ï¼ˆrandomized election timeoutï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="2b2c---æ—¥å¿—å¤åˆ¶ä¸æŒä¹…åŒ–">2B/2C - æ—¥å¿—å¤åˆ¶ä¸æŒä¹…åŒ– &lt;a href="#2b2c---%e6%97%a5%e5%bf%97%e5%a4%8d%e5%88%b6%e4%b8%8e%e6%8c%81%e4%b9%85%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="åŸºæœ¬å·¥ä½œæµ">åŸºæœ¬å·¥ä½œæµ &lt;a href="#%e5%9f%ba%e6%9c%ac%e5%b7%a5%e4%bd%9c%e6%b5%81" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ—¥å¿—å¤åˆ¶çš„åŸºæœ¬å·¥ä½œæµå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Leaderæ¥å—ç”¨æˆ·è¯·æ±‚ï¼Œå°†çŠ¶æ€å˜åŒ–å†™å…¥æœ¬æœºçš„æ—¥å¿—æµä¸­ï¼Œå¹¶ä¸”æŠŠæ—¥å¿—å¤åˆ¶åˆ°Followersã€‚å¦‚æœæœ¬æ¡æ—¥å¿—åˆæ³•ï¼ŒFollowersä¼šå°†è¿™æ¡æ—¥å¿—æ ‡è®°ä¸ºâ€œæäº¤â€ï¼ˆcommittedï¼‰ï¼Œç„¶åå†å°†è¿™æ¡æ—¥å¿—â€œåº”ç”¨â€ï¼ˆapplyï¼‰åˆ°Raftåè®®ä¹‹å¤–çš„çŠ¶æ€æœºã€‚Followeråœ¨æäº¤æ—¥å¿—ä¹‹åï¼Œå°±å¯ä»¥å‘Leaderå›æŠ¥è¿™æ¡æ—¥å¿—å·²ç»è¢«æäº¤ã€‚åœ¨æœ¬æ¡æ—¥å¿—è¢«å¤šæ•°èŠ‚ç‚¹æäº¤ä¹‹åï¼ŒLeaderå†å°†è¿™æ¡æ—¥å¿—æ ‡è®°ä¸ºæäº¤ã€‚æ­¤æ—¶ï¼Œç”¨æˆ·çš„è¯·æ±‚å°±å¯ä»¥è¢«ç¡®è®¤ï¼ˆACKï¼‰äº†ã€‚&lt;/p>
&lt;p>Raftçš„è®ºæ–‡ä¸­ï¼ŒLeaderéœ€è¦ç»´æŠ¤&lt;code>commitIndex&lt;/code>å’Œ&lt;code>lastApplied&lt;/code>è¿™ä¸¤ä¸ªçŠ¶æ€ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥â€œåº”ç”¨â€ï¼ˆapplyï¼‰è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸¤ä¸ªçŠ¶æ€æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤&lt;code>commitIndex&lt;/code>å³å¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Raftåè®®ä¸æ˜¯2PCï¼Œåƒä¸‡ä¸è¦ææ··äº†å“¦ï½&lt;/p>&lt;/blockquote>
&lt;h4 id="å›æ»šä¸æ»šå›æ¥">å›æ»šä¸æ»šå›æ¥ &lt;a href="#%e5%9b%9e%e6%bb%9a%e4%b8%8e%e6%bb%9a%e5%9b%9e%e6%9d%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/3f1056d6f142755204092fb89a474dc964608bab/wizmann-pic/2019-05-02_14-40-52.png" alt="rollback">&lt;/p>
&lt;p>ä»ä¸Šé¢çš„å·¥ä½œæµæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºå·²ç»committedçš„æ—¥å¿—ï¼Œä»ç„¶æœ‰å¯èƒ½æ˜¯ä¸å¯é çš„ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œåœ¨Term1æ—¶ï¼ŒèŠ‚ç‚¹1ä½œä¸šLeaderæäº¤åˆ°äº†æ—¥å¿—(1, 2)ï¼Œè€ŒFollowerèŠ‚ç‚¹Node2å’ŒNode3åˆ†åˆ«æäº¤åˆ°äº†æ—¥å¿—(1, 2)å’Œ(1, 3)ã€‚æ­¤æ—¶LeaderçŸ­æš‚æ–­çº¿ï¼Œå‡ºå‘é€‰ä¸¾è¶…æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„é€‰ä¸¾ã€‚å¦‚æœèŠ‚ç‚¹Node2è¢«é€‰ä¸ºLeaderï¼Œé‚£ä¹ˆèŠ‚ç‚¹Node3å°±ä¼šè¢«Leaderå¤šå‡ºä¸€æ¡æ—¥å¿—ï¼Œè¿™æ˜¯ä¸è¢«å…è®¸çš„ã€‚å¦‚æœèŠ‚ç‚¹Node3è¢«é€‰ä¸ºLeaderï¼Œé‚£ä¹ˆNode2å°±æ¯”Leaderåœ¨Term1å°‘ä¸€æ¡æ—¥å¿—ï¼Œéœ€è¦è¡¥é½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰äººå¯èƒ½ä¼šæ€€ç–‘ï¼ŒèŠ‚ç‚¹2æ¯”èŠ‚ç‚¹3å°‘ä¸€æ¡æ—¥å¿—ï¼Œé‚£ä¹ˆæŒ‰ç…§è®ºæ–‡é‡Œçš„è¯´æ³•ï¼Œå› ä¸ºèŠ‚ç‚¹3çš„æ—¥å¿—æ¯”è¾ƒèŠ‚ç‚¹2è¦å¤šï¼Œæ‰€ä»¥åªæœ‰èŠ‚ç‚¹3æ‰èƒ½èµ¢å¾—ä¸‹ä¸€è½®é€‰ä¸¾ã€‚è¿™å…¶å®æ˜¯ä¸å¯¹çš„ï¼Œå¦‚æœèŠ‚ç‚¹3æ–­çº¿ï¼ŒèŠ‚ç‚¹1å’ŒèŠ‚ç‚¹2ä»ç„¶å¯ä»¥ç»„æˆä¸€ä¸ªquorumï¼Œé€‰ä¸¾å‡ºLeaderã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘å°†å·²committedçš„æ—¥å¿—å›æ»šï¼ˆå‘å·¦æ»šï¼‰ï¼Œä»¥åŠç¼ºå¤±çš„æ—¥å¿—è¡¥é½ï¼ˆå‘å³æ»šï¼‰ã€‚è¿™é‡Œå…¶å®æœ‰ä¸€äº›ä¼˜åŒ–çš„ç‚¹ï¼Œæˆ‘ä»¬åæ–‡å†è¯´ã€‚&lt;/p>
&lt;p>å†æ¬¡æ³¨æ„ï¼Œä¿è¯æ—¥å¿—çš„ä¸€è‡´æ€§æ˜¯Raftåè®®æ­£ç¡®æ€§çš„å¿…é¡»ä¿è¯ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šä¸€å®šè¦æ³¨æ„ã€‚&lt;/p>
&lt;h4 id="ä¹±åºè¯·æ±‚">ä¹±åºè¯·æ±‚ &lt;a href="#%e4%b9%b1%e5%ba%8f%e8%af%b7%e6%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æœ¬é¡¹ç›®ä¸­ï¼Œæ¨¡æ‹Ÿçš„RPCåè®®å¹¶ä¸èƒ½ä¿è¯å¯é æ€§ï¼ˆä¼šä¸¢åŒ…ï¼‰ã€æœ‰åºæ€§ï¼ˆä¼šä¹±åºï¼‰ï¼Œä¹Ÿæ²¡æœ‰SLAï¼ˆæ²¡æœ‰è¶…æ—¶æ—¶é—´çš„ä¸Šé™ï¼‰ï¼Œæ›´ä¸ç”¨æƒ³æ‹¥å¡æ§åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®ƒåœ¨åº•å±‚ä½¿ç”¨äº†UDPåè®®ï¼Œè€Œä¸æ˜¯TCPã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åšå‡ºä»»ä½•å‡è®¾ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œä¸¤ä¸ªè¯·æ±‚å…ˆåæ¥åˆ°Leaderç«¯ï¼ŒAè¯·æ±‚ç¼–å·(1,100)ï¼ŒBè¯·æ±‚ç¼–å·(1,110)ã€‚ç„¶åæˆ‘ä»¬ä¾æ¬¡å°†Logå¤åˆ¶åˆ°Followerç«¯ï¼ˆAå…ˆBåï¼‰ï¼Œä½†æ˜¯åœ¨Followerç«¯æœ‰å¯èƒ½æ”¶åˆ°çš„é¡ºåºæ˜¯Bå…ˆAåã€‚ç”šè‡³åªæ”¶åˆ°Bï¼Œæ²¡æ”¶åˆ°Aã€‚è¿™ç§æƒ…å†µæ—¥å¸¸å·¥ç¨‹ä¸­çš„TCPåè®®ä¸‹å‡ ä¹ä¸èƒ½å‘ç”Ÿï¼Œä½†æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¦ååˆ†å°å¿ƒã€‚&lt;/p>
&lt;h4 id="checklist-for-2b2c">Checklist for 2B/2C &lt;a href="#checklist-for-2b2c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>æ—¥å¿—çš„çŠ¶æ€ä¼šå½±å“Leaderé€‰ä¸¾ &lt;br>
å¦‚æœä¸¤ä»½æ—¥å¿—æµçš„æœ€åä¸€æ¡æ—¥å¿—çš„Termä¸ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºTermå·å¤§çš„æ—¥å¿—â€œæ¯”è¾ƒæ–°â€ã€‚å¦‚æœTermå·ä¸€æ ·ï¼Œé‚£ä¹ˆIndexå¤§çš„æ—¥å¿—â€œæ¯”è¾ƒæ–°â€&lt;/li>
&lt;li>å¦‚æœLeaderå’ŒFollowerçš„æ—¥å¿—ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆFolloweréœ€è¦æ‹·è´Leaderçš„æ—¥å¿—ï¼ˆå‘å·¦æ»šæˆ–å‘å³æ»šçš„æ­£ç¡®æ€§ï¼‰ &lt;br>
è¿™é‡Œæ¨èä½¿ç”¨AssertåŠ æ–­è¨€è¿›è¡Œä¿è¯ï¼Œå¦‚æœå‡ºé”™å¯ä»¥è·å¾—å®æ—¶çš„ç°åœº&lt;/li>
&lt;li>å¯¹äºå°äºå½“å‰Termçš„æ—¥å¿—ï¼ŒLeaderä¸éœ€è¦ç­‰å¤šæ•°Followerç¡®è®¤å°±å¯ä»¥ç›´æ¥commit&lt;/li>
&lt;li>ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šå¦‚æœä¸¤ä¸ªæ—¥å¿—çš„(Term, Index)ä¸€è‡´ï¼Œé‚£ä¹ˆå…¶å†…å®¹ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚å¹¶ä¸”åœ¨æ­¤æ—¥å¿—ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—éƒ½å¿…é¡»æ˜¯ä¸€è‡´çš„&lt;/li>
&lt;li>å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šRPCè¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡é‡å¤å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶ä¸ä¼šç ´åRaftåè®®çš„çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;h3 id="æœ€åçš„3ä¸ªcase">æœ€åçš„3ä¸ªCase &lt;a href="#%e6%9c%80%e5%90%8e%e7%9a%843%e4%b8%aacase" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ€åçš„ä¸‰ä¸ªCaseæœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå°±æ˜¯å¯¹åè®®çš„æ•ˆç‡å’Œæ­£ç¡®æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ã€‚å³ä½¿å‰é¢çš„ä»£ç é‡Œä½ çš„å®ç°æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿæœ‰å¯èƒ½å› ä¸ºå„ç§å…¶å®ƒçš„åŸå› é€ æˆCaseæŒ‚æ‰ã€‚&lt;/p>
&lt;p>å»ºè®®é¦–å…ˆè§£å†³æ­£ç¡®æ€§é—®é¢˜ï¼Œå†æå‡æ•ˆç‡ã€‚&lt;/p>
&lt;h4 id="å‘å·¦æ»šçš„ä¼˜åŒ–é‡è¦">å‘å·¦æ»šçš„ä¼˜åŒ–ï¼ˆé‡è¦ï¼ï¼‰ &lt;a href="#%e5%90%91%e5%b7%a6%e6%bb%9a%e7%9a%84%e4%bc%98%e5%8c%96%e9%87%8d%e8%a6%81" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨è®ºæ–‡çš„5.3èŠ‚ï¼Œä»‹ç»äº†ä¸€ç§å›æ»šçš„ä¼˜åŒ–ã€‚å¦‚æœLeaderå’ŒFolloweråœ¨æŸä¸ªIndexä¸Šçš„æ—¥å¿—ä¸ä¸€è‡´ï¼ŒLeaderçš„ç‰ˆæœ¬è®°ä¸º(Term1, Index)ï¼ŒFollowerçš„ç‰ˆæœ¬è®°ä¸º(Term2, Index)ã€‚é‚£ä¹ˆFolloweréœ€è¦å›æ»šæ‰€æœ‰æ—¥å¿—ï¼Œç›´åˆ°Termå°äº&lt;code>Min(Term1, Term2)&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥åŠ å¿«å›æ»šçš„æ•ˆç‡ã€‚è™½ç„¶è®ºæ–‡ä¸Šè¡¨ç¤ºè¿™ç§ä¼˜åŒ–å¹¶éå¿…è¦ï¼Œä½†æ˜¯åœ¨æ¨¡æ‹Ÿå‡ºæ¥çš„æç«¯ç½‘ç»œç¯å¢ƒä¸‹ï¼Œè¿™æ ·çš„ä¼˜åŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€äº›æ¯”è¾ƒå˜æ€çš„Caseã€‚&lt;/p>
&lt;h4 id="å…¶å®ƒçš„éå®˜æ–¹ä¼˜åŒ–">å…¶å®ƒçš„éå®˜æ–¹ä¼˜åŒ– &lt;a href="#%e5%85%b6%e5%ae%83%e7%9a%84%e9%9d%9e%e5%ae%98%e6%96%b9%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è¿™é‡Œè¿˜æœ‰ä¸€äº›è®ºæ–‡é‡Œæ²¡çš„æåˆ°çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä¸ä¿è¯ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¸å‰§é€ï¼Œæ”¾åˆ°å•ç‹¬çš„é“¾æ¥é‡Œäº†ï¼š&lt;a href="https://github.com/Wizmann/assets/blob/master/wizmann-pic/19-05-02/raft-hints.md">å‰§é€è­¦å‘Šï¼&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>è¿˜æœ‰ä¸€ä¸ªBonusæŒ‘æˆ˜ï¼Œè°æ¯”è¾ƒé—²å¯ä»¥è¯•ä¸€ä¸‹ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ &lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/e35dd59aa533ddd19065f070dcb85a3734cc035d/wizmann-pic/19-05-02/2019-05-02_21-37-14.png" alt="tests">&lt;/p>
&lt;p>åœ¨Travis CIä¸Šé¢è¿è¡Œçš„æµ‹è¯•ã€‚è‡ªæˆ‘æ„Ÿè§‰å®ç°çš„æ¯”è¾ƒä¸€èˆ¬ï¼Œæ‰€ä»¥ä½ ä»¬çš„ç¨‹åºåº”è¯¥è·‘çš„æ¯”æˆ‘å¿«ä¸€ç‚¹æ‰æ­£å¸¸ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æƒ³è¦å®Œæ•´æ­£ç¡®çš„å®ç°è¿™ä¸ªé¡¹ç›®ï¼Œé¦–å…ˆä¸€å®šè¦æŠŠè®ºæ–‡è¯»æ‡‚ã€‚å¹¶ä¸”åˆ’å‡ºå®ç°ä¸Šåº”è¯¥æ³¨æ„çš„é‡ç‚¹ã€‚&lt;/p>
&lt;p>å½“é‡åˆ°æ­£ç¡®æ€§é—®é¢˜æ—¶ï¼Œä¸€å®šè¦å›å½’è®ºæ–‡ï¼Œå¤§éƒ¨åˆ†çš„é—®é¢˜éƒ½å¯ä»¥è·å¾—è§£ç­”ã€‚å½“é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥å‚è€ƒä½œä¸šä¸Šé¢çš„Hintsï¼Œé‡Œé¢ä¹Ÿæœ‰éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>MITçš„è¿™ä¸ªè¯¾ç¨‹è¿˜æœ‰åŸºäºraftå®ç°kv storageçš„é¡¹ç›®ï¼Œåç»­å¦‚æœæœ‰æ—¶é—´åº”è¯¥è¿˜ä¼šåšå§ã€‚&lt;/p></description></item><item><title>ç™½è¯ä¸€è‡´æ€§åè®® - Paxosã€Raftå’ŒPacificA[1]</title><link>https://wizmann.top/posts/paxos-raft-pecifaca1/</link><pubDate>Wed, 05 Dec 2018 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paxos-raft-pecifaca1/</guid><description>&lt;h2 id="ä¹¦æ¥ä¸Šæ–‡---multi-paxos">ä¹¦æ¥ä¸Šæ–‡ - Multi Paxos &lt;a href="#%e4%b9%a6%e6%8e%a5%e4%b8%8a%e6%96%87---multi-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†Basic Paxoså’ŒMulti Paxosçš„å¼‚åŒã€‚åœ¨&lt;a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">Paxos Made Simple&lt;/a>è®ºæ–‡ä¸­ï¼Œä½œè€…æåˆ°äº†Multi Paxosçš„ä¸€ç§å®ç°ã€‚è¿™ä¸ªå®ç°å…è®¸æˆ‘ä»¬å¯¹ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºå¤åˆ¶æ—¥å¿—ï¼Œreplicated logï¼‰è¾¾æˆå…±è¯†ï¼Œä»è€Œå®ç°èŠ‚ç‚¹çŠ¶æ€çš„ä¸€è‡´æ€§å¤åˆ¶ã€‚&lt;/p>
&lt;h3 id="ç¡®å®šæ€§çŠ¶æ€æœº">ç¡®å®šæ€§çŠ¶æ€æœº &lt;a href="#%e7%a1%ae%e5%ae%9a%e6%80%a7%e7%8a%b6%e6%80%81%e6%9c%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å¯ä»¥å°†ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æŠ½è±¡ä¸ºä¸€ä¸ªæœ‰ç€ç¡®å®šæ€§çŠ¶æ€æœºï¼Œå³ç»™å®šå¤šä¸ªçŠ¶æ€ä¸€è‡´çš„çŠ¶æ€æœºï¼Œåœ¨æ‰§è¡ŒåŒä¸€ä¸ªå‘½ä»¤ä¹‹åï¼Œå…¶çŠ¶æ€ä»ä¿æŒä¸€è‡´ã€‚ï¼ˆå¯ä»¥æƒ³ä¸€æƒ³ç¼–è¯‘åŸç†é‡Œé¢çš„DFAï¼‰&lt;/p>
&lt;h3 id="leader---ç³»ç»Ÿä¸­å”¯ä¸€çš„proposer">Leader - ç³»ç»Ÿä¸­å”¯ä¸€çš„proposer &lt;a href="#leader---%e7%b3%bb%e7%bb%9f%e4%b8%ad%e5%94%af%e4%b8%80%e7%9a%84proposer" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨æœ‰å¤šä¸ªproposerï¼Œé‚£ä¹ˆå°±å¾ˆå¯èƒ½ä¼šå‡ºç°å¤šä¸ªææ¡ˆç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚è™½ç„¶æ ¹æ®è¯æ˜ï¼Œæœ€ç»ˆè¿™äº›ææ¡ˆéƒ½ä¼šæ”¶æ•›åˆ°ä¸€è‡´ï¼Œä½†æ˜¯æ€§èƒ½ä¼šéå¸¸ä½ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­é€šè¿‡é€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªleaderåšä¸ºä¸»proposerï¼ˆdistinguishied proposerï¼‰ï¼Œæ‰€æœ‰çš„ææ¡ˆéƒ½ç”±leaderæå‡ºã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸ä¼šå‡ºç°ææ¡ˆç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚åªæœ‰åœ¨leaderåˆ‡æ¢çš„ç¬é—´ï¼Œå¯èƒ½ä¼šå‡ºç°ç›¸åŒç¼–å·çš„ä¸åŒææ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç®—æ³•å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™ç§æƒ…å†µã€‚&lt;/p>
&lt;h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„tcp">åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„â€œTCPâ€ &lt;a href="#%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%ad%e7%9a%84tcp" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç±»ä¼¼äºTCPåè®®ä¸­åºåˆ—å·ï¼ŒMulti Paxosä¸­çš„æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æœ‰ä¸€ä¸ªé€’å¢çš„ç¼–å·ã€‚å³æˆ‘ä»¬å‰ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤æ˜¯100å·ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ä¸€å®šæ˜¯101å·ã€‚æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸€ä¸ªPaxoså®ä¾‹ï¼ŒLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘å¸ƒè¿™ä¸ªææ¡ˆï¼Œåœ¨ææ¡ˆè¾¾æˆä¸€è‡´ä¹‹åï¼ˆå¤šæ•°èŠ‚ç‚¹è¿”å›ACKï¼‰ï¼Œå°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªå‘½ä»¤å·²ç»è¾¾æˆäº†ä¸€è‡´ã€‚&lt;/p>
&lt;p>å’ŒTCPä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬é¡ºåºçš„å‘å¸ƒå¹¶è¡¨å†³ææ¡ˆï¼Œæ•ˆç‡ä¼šéå¸¸ä½ä¸‹ï¼ˆTCPåœç­‰æ¨¡å‹ï¼‰ã€‚æ‰€ä»¥ï¼ŒMulti Paxosé‡‡ç”¨ç±»ä¼¼æ»‘åŠ¨çª—å£çš„æ–¹æ¡ˆï¼Œæ¯æ¬¡å¯¹Nä¸ªææ¡ˆè¿›è¡Œè¡¨å†³ï¼Œä»¥å¢åŠ è¡¨å†³çš„å¸¦å®½ã€‚&lt;/p>
&lt;p>å’ŒTCPä¸åŒçš„æ˜¯ï¼Œå¦‚æœæŸäº›åºå·çš„TCPåŒ…åœ¨ä¼ è¾“ä¸­ä¸¢å¤±ï¼Œæœ€åçš„æƒ…å†µæ˜¯æˆ‘ä»¬ä¼šRSTè¿™æ¡é“¾æ¥ï¼Œå…¶å®ƒçš„å·¥ä½œéƒ½äº¤ç»™åº”ç”¨å±‚é€»è¾‘æ¥è§£å†³ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¯¹äºMulti Paxosæ¥è¯´ï¼Œå¦‚æœæŸäº›ææ¡ˆæ²¡æœ‰è¢«è¡¨å†³ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨æ—¥å¿—ä¸­ç•™ä¸‹ç©ºæ´ï¼ˆgapï¼‰ã€‚è¿™ä¼šç›´æ¥å½±å“ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚å¦‚æœæ°å·§è¿™ä¸ªæ—¶å€™å‘ç”Ÿäº†Leaderå¤±æ•ˆï¼Œé‚£ä¹ˆæ–°é€‰ä¸¾å‡ºæ¥çš„LeaderèŠ‚ç‚¹å°±è¦å¤„ç†æ—¥å¿—ä¸­çš„ç©ºæ´ã€‚&lt;/p>
&lt;p>è§£å†³ç©ºæ´çš„åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯Leaderå‘æ‰€æœ‰æˆå‘˜è¯¢é—®ï¼Œå¯¹äºè¿™ä¸ªææ¡ˆï¼Œæ˜¯å¦å·²ç»æœ‰è¾¾æˆå…±è¯†çš„å€¼ã€‚å¦‚æœæœ‰çš„è¯ï¼Œå°±ä½¿ç”¨è¿™ä¸ªå€¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨ä¸€ä¸ªno-opï¼ˆæ— æ“ä½œï¼‰å‘½ä»¤æ¥å¡«è¡¥è¿™ä¸ªç©ºä½ã€‚ä½†æ˜¯ï¼Œå¯¹äºå®é™…å·¥ç¨‹ä¸­æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³æœªè¾¾æˆå…±è¯†æ—¶å€¼çš„å†²çªç­‰æƒ…å†µã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦raft">ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦Raftï¼Ÿ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e4%bb%ac%e8%bf%98%e9%9c%80%e8%a6%81raft" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Multi-Paxosåœ¨ç°å®çš„å·¥ç¨‹å½“ä¸­æ›´å¤šçš„æ˜¯ä¸€ç§ç¬¦å·ã€‚å› ä¸ºç†è®ºä¸å®è·µä¸Šçš„éš”é˜‚æ˜¯å¦‚æ­¤ä¹‹å¤§ï¼Œå¦‚æœæƒ³åœ¨å·¥ç¨‹æ„ä¹‰ä¸Šå®ç°ä¸€ä¸ªå¯ç”¨çš„Multi-Paxosç®—æ³•ï¼Œå¿…ç„¶ä¼šåœ¨åŸç®—æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€ç³»åˆ—çš„é­”æ”¹ï¼Œè¿™äº›é­”æ”¹è™½ç„¶å‡å£°ç§°è‡ªå·±å®ç°äº†Multi-Paxosç®—æ³•ï¼Œä½†æ˜¯è¿™äº›ç®—æ³•å¤§å¤šä¸èƒ½è¢«è¯æ˜æ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>Raftçš„ç›®æ ‡æ˜¯ï¼Œå³è®©ç®—æ³•æ»¡è¶³å·¥ç¨‹åŒ–éœ€è¦ï¼Œåˆèƒ½ä¿è¯å…¶æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Raftè®ºæ–‡å½“ä¸­è¯´Paxosç®—æ³•éš¾ä»¥ç†è§£ï¼Œæˆ‘å¹¶ä¸è¿™ä¹ˆè§‰å¾—ã€‚å› ä¸ºPaxosè®ºæ–‡é‡Œé¢æŠŠå›°éš¾çš„éƒ¨åˆ†éƒ½ä¸€ç¬”å¸¦è¿‡äº†ã€‚åªå‰©ä¸‹ç®€å•çš„é‚£éƒ¨åˆ†äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="raft-vs-paxos">Raft vs. Paxos &lt;a href="#raft-vs-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="leaderé€‰ä¸¾">Leaderé€‰ä¸¾ &lt;a href="#leader%e9%80%89%e4%b8%be" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨Paxosè®ºæ–‡ä¸­ï¼ŒLeaderé€‰ä¸¾è¢«è§†ä½œä¸€ç§ç‰¹æ®Šçš„â€œææ¡ˆé€‰ä¸¾â€ã€‚åªéœ€è¦Proposerå’ŒAcceptorè¿›è¡Œä¸€è½®æˆ–å¤šè½®ï¼ˆå–å†³äºè¿æ°”ï¼‰æŠ•ç¥¨ï¼Œå°±å¯ä»¥ç¡®å®šLeaderã€‚&lt;/p>
&lt;p>ä½†åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä»¥ä¸‹çš„é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¦‚ä½•åˆ¤æ–­Leaderæ˜¯å¦å­˜æ´»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¯å¦æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æ‹…å½“Leader&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="leaderçš„ä»»æœŸ">Leaderçš„ä»»æœŸ &lt;a href="#leader%e7%9a%84%e4%bb%bb%e6%9c%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Leaderåœ¨è¢«é€‰ä¸¾å‡ºæ¥ä¹‹åï¼Œéƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªä»»æœŸç¼–å·ï¼ˆtermï¼‰ã€‚åœ¨ä»»æœŸé‡Œï¼ŒLeaderä¼šå‘æ‰€æœ‰æˆå‘˜å‘é€å¿ƒè·³åŒ…ä»¥å»¶ç»­è‡ªå·±çš„ä»»æœŸã€‚&lt;/p>
&lt;p>å¦‚æœLeaderå¤±æ•ˆæ— æ³•å‘é€å¿ƒè·³åŒ…çš„è¯ï¼Œæˆå‘˜å°±ä¼šäº§ç”Ÿä¸€ä¸ªâ€œé€‰ä¸¾è¶…æ—¶â€ï¼Œæ­¤æ—¶å°±ä¼šé‡æ–°è§¦å‘ä¸€è½®é€‰ä¸¾ã€‚&lt;/p>
&lt;p>é€‰ä¸¾çš„æµç¨‹å’ŒBasic-Paxosç®—æ³•ç±»ä¼¼ï¼Œproposerå‘æ‰€æœ‰æˆå‘˜å‘é€â€œæˆ‘è¦å½“è€å¤§â€çš„ææ¡ˆï¼Œæˆå‘˜ä»¬ä¼šé…Œæƒ…å›å¤ã€‚å¦‚æœå¾—åˆ°äº†å¤šæ•°æˆå‘˜çš„è‚¯å®šï¼Œè¿™ä¸ªproposerå°±æ˜¯ä¸‹ä¸€ä¸ªä»»æœŸçš„Leaderäº†ã€‚&lt;/p>
&lt;p>ä»æœ¬è´¨ä¸Šè¯´ï¼Œæ¯ä¸€ä¸ªä»»æœŸçš„Leaderé€‰ä¸¾ï¼Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Basic-Paxoså®ä¾‹ã€‚ä»»æœŸå·ç›¸å½“äºPaxosé‡Œé¢çš„ææ¡ˆç¼–å·ã€‚&lt;/p>
&lt;h4 id="leaderèµ„æ ¼çš„è®¤å®š">Leaderèµ„æ ¼çš„è®¤å®š &lt;a href="#leader%e8%b5%84%e6%a0%bc%e7%9a%84%e8%ae%a4%e5%ae%9a" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Rafté‡‡ç”¨å¼ºä¸€è‡´æ€§çš„æ¨¡å‹ï¼Œå¯¹äºå·²ç»ACKçš„ç”¨æˆ·è¯·æ±‚ï¼Œè¦å°½åŠ›ä¿è¯å…¶çŠ¶æ€ä¸ä¸¢å¤±ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¦‚æœä½ é—®æˆ‘ï¼Œç°åœ¨æ¥ä¸€æ ¸å¼¹æŠŠæœºæˆ¿ç‚¸äº†ï¼Œæ•°æ®éƒ½ä¸¢äº†ï¼Œé‚£ä½ æ€ä¹ˆèƒ½ä¿è¯å¼ºä¸€è‡´æ€§ã€‚ &lt;br>
å…¶å®è¿™ä¸ªé—®é¢˜éå¸¸ç®€å•ã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¿è¯äº†ä¸¢æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬è¦é€‰å‡ºä¸€ä¸ªLeaderï¼Œä½¿å…¶èƒ½å¤ŸåŒ…å«æ‰€æœ‰å·²ç»ACKçš„ææ¡ˆã€‚å½“ä¸€ä¸ªproposerå‘å…¶å®ƒèŠ‚ç‚¹å‘é€ææ¡ˆæ—¶ï¼Œå°±ä¼šæ”¶åˆ°å…¶å®ƒèŠ‚ç‚¹çš„å“åº”ã€‚å› ä¸ºä¸€ä¸ªå·²ç»ACKçš„ææ¡ˆå¿…ç„¶è¢«å¤šæ•°èŠ‚ç‚¹æ‰€è®¤å¯ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªproposeræ²¡æœ‰åŒ…å«æ‰€æœ‰è¢«ACKçš„ææ¡ˆæ—¶ï¼Œå®ƒçš„ææ¡ˆå°±ä¼šè¢«å…¶å®ƒåŒ…å«æ›´å¤šçŠ¶æ€çš„èŠ‚ç‚¹é©³å›ã€‚æœ€åè¢«é€‰å‡ºæ¥çš„Leaderï¼Œä¸€å®šæ˜¯åŒ…å«æ‰€æœ‰è¢«ACKçš„çŠ¶æ€çš„èŠ‚ç‚¹ã€‚&lt;/p>
&lt;h3 id="æ—¥å¿—å¤åˆ¶">æ—¥å¿—å¤åˆ¶ &lt;a href="#%e6%97%a5%e5%bf%97%e5%a4%8d%e5%88%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å½“Leaderè¢«é€‰å‡ºåï¼ŒLeaderå°±ä¼šå¼€å§‹å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚ç”¨æˆ·çš„è¯·æ±‚å¯ä»¥çœ‹åšä¸€ç³»åˆ—çš„å‘½ä»¤ï¼Œåœ¨æ¥æ”¶åˆ°ææ¡ˆåï¼Œææ¡ˆé¦–å…ˆè¢«åˆ†å‘åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€æœºé¡ºåºæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚åœ¨å¤šæ•°èŠ‚ç‚¹è¿”å›ACKåï¼Œè¿™ä¸ªå‘½ä»¤å°±è¢«è§†ä¸ºâ€œå·²æäº¤â€ï¼ˆcommitedï¼‰ã€‚&lt;/p>
&lt;p>ä¸Šæ–‡ä¸­å·²ç»æåˆ°äº†ä¸€è‡´æ€§ç®—æ³•ä¸­çš„æ—¥å¿—éå¸¸ç±»ä¼¼äºç½‘ç»œåè®®ä¸­çš„TCPã€‚å³å¦‚æœä¸¤ä¸ªå‘½ä»¤çš„IDä¸€æ ·ï¼Œé‚£ä¹ˆå…¶å†…å®¹å¿…å®šä¹Ÿä¸€æ ·ï¼›å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½æœ‰è®¤å¯äº†ç¼–å·ä¸ºpçš„å‘½ä»¤ï¼Œé‚£ä¹ˆæ‰€æœ‰ç¼–å·å°äºpçš„å‘½ä»¤ä¹Ÿå¿…å®šä¿æŒä¸€è‡´ã€‚ï¼ˆè¢«ç§°ä¸ºLog Matching Propertyï¼‰&lt;/p>
&lt;p>Raftä¸ºäº†ç®€åŒ–ç®—æ³•çš„å·¥ç¨‹å®ç°ï¼ŒæŠŠèŠ‚ç‚¹çš„çŠ¶æ€æŠ½è±¡ä¸ºä¸¥æ ¼append onlyçš„æ—¥å¿—ã€‚å³æˆ‘ä»¬å¯ä»¥å°†æ—¥å¿—æŒ‡é’ˆå‘åæˆ–å‘å‰ç§»åŠ¨ï¼Œæ¥â€œå›æ»šâ€æˆ–â€œæ›´æ–°â€çŠ¶æ€ã€‚ä½†æ˜¯ç»å¯¹ä¸å…è®¸åœ¨æ—¥å¿—ä¸­é—´æ·»åŠ æˆ–åˆ é™¤æ—¥å¿—æ¡ç›®ã€‚æ‰€ä»¥ï¼Œåœ¨Leaderå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æœleaderå’Œå…¶ä»–followerä¹‹é—´çš„æ—¥å¿—ä¸åŒï¼Œé‚£ä¹ˆfolloweréœ€è¦å›æ»šæ—¥å¿—ä»¥ä¿æŒå’Œleaderæ—¥å¿—çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h3 id="å®‰å…¨æ€§">å®‰å…¨æ€§ &lt;a href="#%e5%ae%89%e5%85%a8%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="ä¸å½’æˆ‘ç®¡çš„äº‹æˆ‘ä¸æ‹¿ä¸»æ„">ä¸å½’æˆ‘ç®¡çš„äº‹æˆ‘ä¸æ‹¿ä¸»æ„ &lt;a href="#%e4%b8%8d%e5%bd%92%e6%88%91%e7%ae%a1%e7%9a%84%e4%ba%8b%e6%88%91%e4%b8%8d%e6%8b%bf%e4%b8%bb%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å‰æ–‡æˆ‘ä»¬è¯´åˆ°ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¦æˆä¸ºLeaderï¼Œä¸€å®šè¦æ‹¥æœ‰æ‰€æœ‰å·²ç»è¢«ACKçš„çŠ¶æ€ï¼Œå¦åˆ™å°±ä¼šè¢«å…¶å®ƒèŠ‚ç‚¹é©³å›ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç°å®éƒ½ä¼šå‡ºç°ä¸€äº›å°å°çš„æ„å¤–ã€‚åœ¨ç³»ç»Ÿçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€äº›ææ¡ˆåªè¢«å°‘æ•°èŠ‚ç‚¹è®¤å¯ï¼Œä¸æ­¤åŒæ—¶å‘èµ·ææ¡ˆçš„Leaderæ„å¤–é€€å‡ºã€‚é‚£ä¹ˆåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ—¥å¿—ä¼šäº§ç”Ÿâ€œåˆ†å‰â€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³æ—¥å¿—å½“ä¸­çš„å†²çªå‘¢ï¼Ÿ&lt;/p>
&lt;p>å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºè¿™äº›ä»¥å°‘æ•°èŠ‚ç‚¹è®¤å¯çš„ææ¡ˆå¹¶æ²¡æœ‰è¢«ç¡®è®¤ã€‚æ‰€ä»¥æˆ‘ä»¬æ— è®ºæ˜¯æ¥å—ææ¡ˆè¿˜æ˜¯é©³å›ææ¡ˆï¼Œéƒ½ä¸å½±å“æˆ‘ä»¬å¼ºä¸€è‡´æ€§çš„è¦æ±‚ã€‚æ‰€ä»¥å…³é”®æ˜¯å¤„ç†å†²çªï¼Œä½¿å…¶ä¸äº§ç”Ÿå½±å“ç³»ç»Ÿä¸€è‡´æ€§çš„åæ•ˆã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_17-34-59.png" alt="">&lt;/p>
&lt;p>å‡è®¾åœ¨Term1ï¼Œæœ€åä¸€ä¸ªææ¡ˆæ˜¯&amp;quot;Value:3&amp;quot;ï¼Œè¿™ä¸ªææ¡ˆå¹¶æ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼ŒLeaderå°±æŒ‚æ‰äº†ã€‚é€‰å‡ºæ¥äº†ä¸€ä¸ªæ–°Leaderï¼ŒTermæ•°åŠ 1ã€‚åœ¨Term2ï¼Œè¢«æå‡ºçš„ç¬¬ä¸€ä¸ªææ¡ˆæ˜¯&amp;quot;Value:1&amp;quot;ï¼Œè¿™ä¸ªææ¡ˆä¹Ÿæ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼ŒLeaderä¹ŸæŒ‚æ‰äº†ã€‚&lt;/p>
&lt;p>å› ä¸ºè¿™ä¸¤ä¸ªåˆ†å‰çš„ææ¡ˆéƒ½æ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªLeaderå¯èƒ½å·²ç»ç¡®è®¤è¿™ä¸¤ä¸ªææ¡ˆï¼Œæˆ–è€…ä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªéƒ½æ²¡æœ‰ç¡®è®¤ã€‚æ–°çš„Leaderåœ¨è¢«é€‰å‡ºåï¼Œéœ€è¦é¢å¯¹çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•å¤„ç†å±äºæ—§Termçš„ææ¡ˆã€‚&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š&lt;/p>
&lt;ol>
&lt;li>æ–°Leaderå°†æ—¥å¿—ä¸­ä»æ²¡æœ‰è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯çš„ææ¡ˆé‡æ–°æå‡ºï¼Œç›´åˆ°è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯ä¸ºæ­¢&lt;/li>
&lt;li>æ–°Leaderå¿½ç•¥å±äºæ—§çš„Termçš„ææ¡ˆï¼Œåªæäº¤å±äºæœ¬Termçš„ææ¡ˆï¼›å¯¹äºæ—¥å¿—å†²çªï¼Œä½¿ç”¨å¤åˆ¶æ—¥å¿—çš„æ–¹æ³•è§£å†³ï¼Œä½†ä¸ä¼šæ˜¾å¼è®¤å¯æ—§Termçš„ææ¡ˆã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_22-02-45.png" alt="">&lt;/p>
&lt;p>å¯¹äºæ–¹æ¡ˆ1ï¼Œæœ‰ä¸€ä¸ªéšå«çš„é—®é¢˜ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨æ—¶é—´ç‚¹1ï¼ŒS2ä¸ºLeaderï¼Œæ ‡çº¢çš„ä¸¤ä¸ªææ¡ˆå¹¶æ²¡æœ‰è¢«ç¡®è®¤ã€‚æ­¤æ—¶å¦‚æœLeaderåœ¨æ—¶é—´ç‚¹2é‡æ–°æå‡º&amp;quot;Term1/Value3&amp;quot;ï¼Œå¹¶ä¸”å¾—åˆ°äº†S1å’ŒS2çš„è®¤å¯ï¼Œé‚£ä¹ˆè¿™æ¡ææ¡ˆå·²ç»è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯ã€‚ä½†æ˜¯åœ¨æ—¶é—´ç‚¹3ï¼ŒS3è¢«é€‰ä¸¾ä¸ºäº†Leaderã€‚S1å’ŒS2éœ€è¦å›æ»šæ—¥å¿—ä»¥ä¿æŒä¸S3æ—¥å¿—çš„ä¸€è‡´ã€‚æ­¤æ—¶å°±å‡ºç°äº†ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯å·²ç»è¢«ç¡®è®¤çš„æ—¥å¿—è¢«å›æ»šæ‰äº†ï¼Œå¼ºä¸€è‡´æ€§å°±ä¸èƒ½æ»¡è¶³äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_22-12-50.png" alt="">&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆ2ï¼Œé‚£ä¹ˆè¢«é€‰å‡ºçš„æ–°Leaderæå‡ºçš„ç¬¬ä¸€ä¸ªææ¡ˆçš„Termä¸€å®šä¸º3ã€‚ç¡®è®¤æ–°ææ¡ˆçš„èŠ‚ç‚¹æ¥ä¸‹æ¥ä¼šå¤åˆ¶Leaderçš„æ—¥å¿—ï¼Œå›æ»šæ‰æ²¡æœ‰è¢«è®¤å¯çš„ææ¡ˆ&amp;quot;Term2/Value1&amp;quot;ã€‚å¯¹äºæ ‡ç»¿çš„&amp;quot;Term1/Value3&amp;quot;ï¼Œè™½ç„¶è¢«å¤åˆ¶åˆ°äº†å…¶å®ƒçš„èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯è¿™ä¸ªå€¼å¹¶ä¸ä¼šè¢«ç¡®è®¤ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ—¢ä¿è¯äº†å·²ç»è¢«ç¡®è®¤çš„ææ¡ˆä¸ä¼šè¢«å›æ»šï¼Œåˆä¿è¯äº†æ—¥å¿—çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>åœ¨å…·ä½“å®ç°ä¸­ï¼Œâ€œT3/V1â€å¾€å¾€æ˜¯ä¸€ä¸ªç©ºå‘½ä»¤(no-op)ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ²¡æœ‰å†™è¯·æ±‚ï¼ŒLeaderå°±å¯ä»¥æ›´å¿«çš„ç¡®è®¤æ–°çš„ä»»æœŸå¹¶åŒæ­¥Logäº†ã€‚&lt;/p>
&lt;h4 id="å¦‚ä½•è¯æ˜">å¦‚ä½•è¯æ˜ &lt;a href="#%e5%a6%82%e4%bd%95%e8%af%81%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸Šé¢çš„ä½œæ³•å®ƒæ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>å‡è®¾å½“å‰ä»»æœŸä¸ºT1ï¼Œæ­¤æ—¶ç”±äºç³»ç»Ÿæ•…éšœï¼Œæˆ‘ä»¬é€‰å‡ºäº†æ–°çš„Leader - S2ï¼Œå¹¶è®°Termä¸ºT2ã€‚å› ä¸ºæˆ‘ä»¬ä¸¥æ ¼éµå®ˆäº†Log Matching Propertyã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¯¹äºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/p>
&lt;ol>
&lt;li>T2çš„Leaderå’ŒVoterçš„Logä¸­æœ€åä¸€ä¸ªææ¡ˆçš„ç¼–å·æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ä»–ä»¬æ—¥å¿—ä¸­çš„ææ¡ˆéƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„&lt;/li>
&lt;li>T2ä¸­Leaderçš„Logæ¯”Voteræ›´æ–°ï¼Œé‚£ä¹ˆLeaderä¸€å®šåŒ…å«æ¯”Voteræ›´å¤šçš„ææ¡ˆï¼›å¦åˆ™Voterå°±ä¸ä¼šç»™LeaderæŠ•ç¥¨&lt;/li>
&lt;/ol>
&lt;p>æˆ‘ä»¬éƒ½å¯ä»¥è¯æ˜ï¼Œå¯¹äºå‰ä¸€ä¸ªTermå·²ç»è¢«ç¡®è®¤çš„ææ¡ˆï¼Œä¸€å®šä¼šè¢«åŒ…å«åœ¨åä¸€ä¸ªTermçš„æ—¥å¿—ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè¢«ç¡®è®¤çš„ææ¡ˆä¸ä¼šä¸­é€”ä¸¢å¤±ã€‚&lt;/p>
&lt;h2 id="æˆå‘˜å˜åŒ–">æˆå‘˜å˜åŒ– &lt;a href="#%e6%88%90%e5%91%98%e5%8f%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸Šæˆ‘ä»¬çš„è®¨è®ºéƒ½åŸºäºç³»ç»Ÿçš„èŠ‚ç‚¹ä¸ä¼šå‘ç”Ÿå˜æ›´ï¼Œä½†æ˜¯åœ¨ç°å®å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾å¯¹æ­¤è¿›è¡Œä»»ä½•ä¿è¯ã€‚æ‰€ä»¥ä¸€ä¸ªå®ç”¨çš„ç³»ç»Ÿï¼Œä¸€å®šèƒ½è§£å†³æˆå‘˜å˜åŒ–çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆå‘˜å˜åŒ–é—®é¢˜çš„æœ¬è´¨æ˜¯ç³»ç»Ÿä¸­ä¸èƒ½åŒæ—¶å‡ºç°ä¸¤ä¸ªLeaderã€‚&lt;/p>
&lt;p>åœ¨Raftä¸­ï¼Œæˆ‘ä»¬å°†è¿‡æ¸¡æœŸçš„é…ç½®ç§°ä¸ºâ€œå…±åŒä¸€è‡´â€ï¼ˆjoint consensusï¼‰ï¼Œä¸€ä½†å®ƒè¢«ç¡®è®¤ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»è¿‡æ¸¡åˆ°äº†æ–°çš„æˆå‘˜é…ç½®ã€‚&lt;/p>
&lt;p>å…·ä½“çš„ç­–ç•¥å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ç³»ç»Ÿä¸­åªæœ‰æ—§çš„é…ç½®C_oldï¼Œæ–°åŠ å…¥çš„æˆå‘˜ä¸å¯èƒ½æˆä¸ºLeader&lt;/li>
&lt;li>å½“å‰ç³»ç»Ÿçš„Leaderæ¥å—åˆ°æ–°çš„é…ç½®C_newã€‚ç„¶åLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·ä¿®æ”¹é…ç½®ä¸ºC_old+newçš„ææ¡ˆã€‚&lt;/li>
&lt;li>å³ä½¿è¿™ä¸ªæ—¶é—´ç‚¹LeaderæŒ‚æ‰äº†ï¼Œæ–°çš„Leaderä¹Ÿåªä¼šæ‹¥æœ‰æ—§é…ç½®C_oldæˆ–è€…è¿‡æ¸¡æœŸé…ç½®C_old+newã€‚è¿™å–å†³äºLeaderé€‰ä¸¾çš„æ—¶æœºï¼ˆå’Œè¿æ°”ï¼‰ã€‚&lt;/li>
&lt;li>å½“è¿‡æ¸¡æœŸé…ç½®C_old+newè¢«å¤šæ•°èŠ‚ç‚¹ç¡®è®¤åï¼ŒLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·ä¿®æ”¹é…ç½®ä¸ºC_newçš„ææ¡ˆã€‚&lt;/li>
&lt;li>å¦‚æœè¿™ä¸ªæ—¶é—´ç‚¹LeaderæŒ‚æ‰äº†ï¼Œæ–°Leaderä¼šä»æ‹¥æœ‰C_old+newå’ŒC_newçš„èŠ‚ç‚¹ä¸­é€‰å‡ºã€‚æ–°çš„Leaderä»ç„¶å¯ä»¥è¿›è¡Œé…ç½®çš„å˜æ›´ï¼Œè€Œä¸å½±å“æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚&lt;/li>
&lt;li>ç›´åˆ°C_newè¢«ç¡®è®¤ï¼Œé…ç½®æ›´æ¢å®£å‘Šå®Œæˆã€‚&lt;/li>
&lt;/ol>
&lt;p>â€œå…±åŒä¸€è‡´â€å…è®¸èŠ‚ç‚¹æ— éœ€è€ƒè™‘å®‰å…¨æ€§çš„æƒ…å†µä¸‹ï¼Œåœ¨ä»»æ„æ—¶é—´è¿›è¡Œé…ç½®çš„æ›´æ¢ã€‚é…ç½®çš„æ›´æ¢ä¹Ÿä¸ä¼šå½±å“å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šæˆ‘ä»¬è§£å†³çš„æ˜¯å®‰å…¨æ€§é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ç¨‹ä¸­æˆ‘ä»¬è¿˜éœ€è¦å…¼é¡¾æ•ˆç‡é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æ–°åŠ å…¥çš„èŠ‚ç‚¹å¯ä»¥è§†ä½œâ€œnon-voting membersâ€ï¼ŒåªåŒæ­¥æ•°æ®ï¼Œä¸èƒ½å¯¹ææ¡ˆè¿›è¡ŒæŠ•ç¥¨ã€‚ç›´åˆ°æ•°æ®åŒæ­¥åŸºæœ¬å®Œæˆï¼Œæ‰è¿›è¡Œé…ç½®å˜æ›´ã€‚è¿™æ ·é¿å…äº†æ–°çš„èŠ‚ç‚¹ç”±äºç¼ºå°‘Logä¸èƒ½åŠæ—¶çš„å¤„ç†ææ¡ˆã€‚&lt;/p>
&lt;p>åˆå¦‚æ–°çš„æˆå‘˜åˆ—è¡¨ä¸­ï¼Œä¸åŒ…å«åŸå…ˆçš„LeaderèŠ‚ç‚¹ã€‚åœ¨æ—§Leaderè®¤å¯äº†æ–°çš„é…ç½®ææ¡ˆä¹‹åï¼Œå°±å¯ä»¥é€€ä½è®©è´¤ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°çš„Leaderã€‚&lt;/p>
&lt;p>ä»¥åŠè¢«æ¸…é™¤å‡ºæˆå‘˜åˆ—è¡¨çš„èŠ‚ç‚¹ï¼Œä¸ä¼šæ”¶åˆ°åç»­çš„å¿ƒè·³ï¼Œå®ƒä»¬ä¼šè®¤ä¸ºLeaderå·²ç»å¤±æ•ˆï¼Œæ‰€ä»¥è‡ªå·±è·³å‡ºæ¥ç«é€‰Leaderã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šè§¦å‘æ–°çš„ï¼ˆæ— æ„ä¹‰ çš„ï¼‰Leaderé€‰ä¸¾ï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…æ”¶åˆ°äº†Leaderçš„å¿ƒè·³ï¼Œé‚£ä¹ˆå°±ä¼šå¿½ç•¥Leaderçš„ç«é€‰è¯·æ±‚ã€‚è¿™æ ·æ—¢ä¸ä¼šå½±å“æ­£å¸¸çš„é€‰ä¸¾ï¼Œåˆå¯ä»¥å±è”½æ— æ•ˆçš„é€‰ä¸¾è¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="å¿«ç…§">å¿«ç…§ &lt;a href="#%e5%bf%ab%e7%85%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬çš„ææ¡ˆè¶Šæ¥è¶Šå¤šï¼Œæ—¥å¿—ä¹Ÿè¶Šæ¥è¶Šé•¿ã€‚éšä¹‹è€Œæ¥çš„æ˜¯æ¼«é•¿çš„æ¢å¤æ—¶é—´ä»¥åŠç£ç›˜ç©ºé—´çš„æµªè´¹ã€‚å¿«ç…§æŠ€æœ¯å¯ä»¥å¸®æˆ‘ä»¬æ¸…é™¤æ—§çš„æ— ç”¨æ—¥å¿—ï¼Œåªä¿ç•™æœ‰ç”¨çš„çŠ¶æ€ä¿¡æ¯ã€‚&lt;/p>
&lt;p>åœ¨Raftç®—æ³•ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½è‡ªä¸»çš„ç”Ÿæˆå¿«ç…§ã€‚å¥½å¤„æ˜¯é¿å…Leaderåˆ†å‘å¿«ç…§é€ æˆçš„æ•ˆç‡é™ä½ï¼Œä¹Ÿç®€åŒ–äº†Leaderçš„åŠŸèƒ½å’ŒèŒè´£ã€‚åˆç”±äºæ—¥å¿—çš„â€œTCPç‰¹æ€§â€ï¼Œæ‰€ä»¥ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œåªè¦ä¿è¯ææ¡ˆç¼–å·ä¸€è‡´ï¼Œé‚£ä¹ˆå…¶å†…å®¹å°±å¯ä»¥ä¿è¯ä¸€è‡´ã€‚&lt;/p>
&lt;h2 id="å®¢æˆ·ç«¯äº¤äº’">å®¢æˆ·ç«¯äº¤äº’ &lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e4%ba%a4%e4%ba%92" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºå®¢æˆ·ç«¯ä¸äº†è§£ç³»ç»Ÿå†…éƒ¨çš„é€‰ä¸¾æƒ…å†µï¼Œæ‰€ä»¥åœ¨å¼€å§‹é€šä¿¡æ—¶ï¼Œä¼šéšæœºé€‰ä¸€å°èŠ‚ç‚¹å‘é€è¯·æ±‚ã€‚å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸æ˜¯Leaderï¼Œå°±ä¼šæ‹’ç»è¿™ä¸ªè¯·æ±‚ï¼Œä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯å“ªä¸ªèŠ‚ç‚¹æ˜¯å½“å‰ä»»æœŸçš„Leaderã€‚å¦‚æœLeaderå¤±æ•ˆï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶ï¼Œå°±ä¼šé‡æ–°éšæœºé€‰æ‹©èŠ‚ç‚¹ï¼Œè·å–æ–°ä»»Leaderä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¯¹äºå®¢æˆ·ç«¯å‘é€çš„å†™è¯·æ±‚ï¼ŒLeaderéœ€è¦è®°å½•å…¶å”¯ä¸€çš„è¯·æ±‚IDï¼Œä»¥é¿å…å®¢æˆ·ç«¯å‘é€çš„é‡å¤è¯·æ±‚ã€‚&lt;/p>
&lt;p>å¯¹äºå®¢æˆ·ç«¯å‘é€çš„è¯»è¯·æ±‚ï¼ŒLeaderéœ€è¦å†æ¬¡ç¡®è®¤å®ƒæ˜¯ä»æ˜¯å½“å‰ä»»æœŸçš„Leaderï¼Œé¿å…å‘å®¢æˆ·ç«¯å‘é€è¿‡æœŸæ•°æ®ã€‚å¦‚æœå¯¹æ•°æ®æ­£ç¡®æ€§å’Œæ—¶æ•ˆæ€§çš„æ•æ„Ÿæ€§ä¸é«˜ï¼Œå°±å¯ä»¥å‘ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œ&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Paxosçš„äº®ç‚¹åœ¨äºæŠŠå¤æ‚çš„ä¸œè¥¿è¯´ç®€å•äº†ã€‚è€ŒRaftçš„äº®ç‚¹æ˜¯æŠŠç®€å•çš„ä¸œè¥¿å…·ä½“åŒ–ï¼Œä½¿ä¹‹æˆä¸ºèƒ½è½åœ°çš„å·¥ç¨‹é¡¹ç›®ã€‚&lt;/p>
&lt;p>ä½†æ˜¯Paxosåšä¸ºä¸€ç§Quorumåè®®ï¼ˆä¿—ç§°P2Pï¼‰ï¼Œå…¶å·¥ç¨‹å¤æ‚æ€§æ˜¯éš¾ä»¥é¿å…çš„ã€‚Raftåœ¨Paxosåè®®ä¸Šé¢åŠ å…¥äº†å¾ˆå¤šé™åˆ¶ä»¥ç®€åŒ–å®ç°ï¼Œä½†æ˜¯æƒ³è¦å®Œæ•´çš„å®ç°å…¶åŠŸèƒ½ä»ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚ï¼ˆæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥&lt;a href="https://pdos.csail.mit.edu/6.824/labs/lab-raft.html">æŒ‘æˆ˜ä¸€ä¸‹è‡ªå·±&lt;/a>ï¼‰&lt;/p>
&lt;p>ä¸‹é¢ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šæ¢ä¸€ç§æ–°æ€è·¯ï¼Œå­¦ä¹ PecificAç®—æ³•ï¼Œçœ‹ä¸€çœ‹å¦‚ä½•ä½¿ç”¨Paxoså®ç°ä¸€ä¸ªä¸»ä»å¤åˆ¶åè®®ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æ›´åé¢">å†™åœ¨æ›´åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e6%9b%b4%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸ªäººè§‰å¾—ï¼ŒRaftè®ºæ–‡çš„ä¸€ä¸ªæ›´å¤§äº®ç‚¹æ˜¯å……åˆ†çš„æ€è€ƒäº†Paxos/Multi-Paxosåœ¨å·¥ç¨‹å®è·µä¸Šçš„ç¼ºé™·ã€‚æ€è€ƒå¹¶æå‡ºæœ‰ä»·å€¼çš„è´¨ç–‘ï¼Œè€Œä¸æ˜¯è¢«ä»–äººçš„è§‚ç‚¹å¸¦ç€èµ°ï¼ŒçœŸçš„æ˜¯æœ€é‡è¦çš„èƒ½åŠ›ä¹‹ä¸€äº†ã€‚&lt;/p>
&lt;p>å¤§èƒ†çŒœæµ‹æ˜¯å› ä¸ºæœ‰è¶³å¤Ÿçš„ç†è§£èƒ½åŠ›ï¼Œæœ‰é¢å¤–çš„å¸¦å®½å»å‘é—®ï¼Ÿè¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ã€‚&lt;/p></description></item></channel></rss>