<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Modern C++ on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/modern-c++/</link><description>Recent content in Modern C++ on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Fri, 01 Feb 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/modern-c++/index.xml" rel="self" type="application/rss+xml"/><item><title>C++ç±»åž‹æ“¦é™¤ä¸Ž`std::function`æ€§èƒ½æŽ¢ç´¢</title><link>https://wizmann.top/posts/cpp-type-erasure-and-std-function/</link><pubDate>Fri, 01 Feb 2019 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/cpp-type-erasure-and-std-function/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯ç±»åž‹æ“¦é™¤">ä»€ä¹ˆæ˜¯ç±»åž‹æ“¦é™¤ &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºŽPythonè¿™ç§åŠ¨æ€ç±»åž‹è¯­è¨€æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨â€œç±»åž‹æ“¦é™¤â€è¿™ä¸ªæ¦‚å¿µçš„ã€‚Pythonå¯¹è±¡çš„è¡Œä¸ºå¹¶ä¸ç”±æŽ¥å£å®šä¹‰ï¼Œè€Œæ˜¯ç”±â€œå½“å‰æ–¹æ³•å’Œå±žæ€§çš„é›†åˆâ€å†³å®šã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œä»¥ä¸‹çš„ä»£ç æ˜¯å®Œå…¨åˆæ³•çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">print&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">print&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;bar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(obj):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print obj&lt;span style="color:#f92672">.&lt;/span>print()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Foo()) &lt;span style="color:#f92672">//&lt;/span> print &lt;span style="color:#e6db74">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Bar()) &lt;span style="color:#f92672">//&lt;/span> print &lt;span style="color:#e6db74">&amp;#39;bar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯å¯¹äºŽC++è¿™ç§é™æ€ç±»åž‹è¯­è¨€æ¥è®²ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨è¿™ç§è¯­æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(&lt;span style="color:#f92672">???&lt;/span> obj) { &lt;span style="color:#75715e">// &amp;lt;--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> obj.print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Foo());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Bar());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç†Ÿæ‚‰C++çš„åŒå­¦ä»¬éƒ½çŸ¥é“ï¼Œå› ä¸º&lt;code>Foo&lt;/code>å’Œ&lt;code>Bar&lt;/code>çš„ç±»åž‹ä¸åŒï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æŽ¥å°†ä¸åŒç±»åž‹çš„å®žä¾‹ä¼ å…¥&lt;code>do_print(obj)&lt;/code>å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ“¦é™¤ç±»åž‹ä¿¡æ¯ï¼Œæä¾›ä¸€ç§ç±»åž‹çš„æŠ½è±¡ã€‚ä½¿å¾—å®žçŽ°ä¸ä¾èµ–äºŽå…·ä½“ç±»åž‹ï¼Œè€Œæ˜¯ä¾èµ–äºŽç±»åž‹æŠ½è±¡ã€‚&lt;/p>
&lt;h2 id="cä¸­ç±»åž‹æ“¦é™¤çš„å®žçŽ°">C++ä¸­ç±»åž‹æ“¦é™¤çš„å®žçŽ° &lt;a href="#c%e4%b8%ad%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ç®€å•ç²—æš´---void">ç®€å•ç²—æš´ - &lt;code>void*&lt;/code> &lt;a href="#%e7%ae%80%e5%8d%95%e7%b2%97%e6%9a%b4---void" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>å†™è¿‡Cè¯­è¨€åŒå­¦ä»¬ä¸€å®šéžå¸¸ç†Ÿæ‚‰&lt;code>qsort&lt;/code>å‡½æ•°çš„å†™æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// http://www.cplusplus.com/reference/cstdlib/qsort/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">compare&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ( &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)a &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)b );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> values[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">qsort&lt;/span> (values, &lt;span style="color:#ae81ff">6&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>), compare);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>; i&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">printf&lt;/span> (&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>,values[n]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„&lt;code>compare(const void*, const void*)&lt;/code>å‡½æ•°å°±æ˜¯Cè¯­è¨€é£Žæ ¼çš„ç±»åž‹æ“¦é™¤ï¼Œå¯ä»¥æ”¯æŒä¸åŒç±»åž‹çš„æŒ‡é’ˆç±»åž‹ä¼ å…¥ã€‚ä½†æ˜¯ç¼ºé™·æ˜¯åœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å°†å·²æ“¦é™¤çš„ç±»åž‹æ¢å¤ï¼Œä»¥è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;p>è¿™ç§ç±»åž‹æ“¦é™¤æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå¸¦å¼€é¢å¤–çš„å¼€é”€ã€‚ä½†æ˜¯è¿™æ ·çš„å¼ºåˆ¶ç±»åž‹éšå«ç€ç±»åž‹ä¸åŒ¹é…çš„é£Žé™©ï¼Œéœ€è¦ç¨‹åºå‘˜æ ¼å¤–æ³¨æ„ã€‚&lt;/p>
&lt;h3 id="é¢å‘å¯¹è±¡çš„ç»å…¸æ–¹æ³•---è™šå‡½æ•°virtual-function">é¢å‘å¯¹è±¡çš„ç»å…¸æ–¹æ³• - è™šå‡½æ•°ï¼ˆvirtual functionï¼‰ &lt;a href="#%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bb%8f%e5%85%b8%e6%96%b9%e6%b3%95---%e8%99%9a%e5%87%bd%e6%95%b0virtual-function" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>C++åšä¸ºCè¯­è¨€çš„è¿›åŒ–ï¼Œå¼•å…¥äº†é¢å‘å¯¹è±¡çš„ç†å¿µã€‚è€Œå¤šæ€ï¼Œåšä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œä¸ºæˆ‘ä»¬çš„ä»£ç å¸¦æ¥äº†æ›´å¤šçš„å¼¹æ€§ã€‚&lt;/p>
&lt;p>å¯¹äºŽä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ¥å®žçŽ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">IPrintable&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IPrintable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IPrintable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(IPrintable&lt;span style="color:#f92672">*&lt;/span> obj) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obj&lt;span style="color:#f92672">-&amp;gt;&lt;/span>print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_print(&lt;span style="color:#66d9ef">new&lt;/span> Foo());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_print(&lt;span style="color:#66d9ef">new&lt;/span> Bar());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª&lt;code>IPrintable&lt;/code>åŸºç±»ï¼Œæ“¦é™¤äº†å­ç±»&lt;code>Foo&lt;/code>å’Œ&lt;code>Bar&lt;/code>çš„å…·ä½“ç±»åž‹ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å­ç±»å®žçŽ°äº†åŸºç±»çš„æŽ¥å£ï¼Œå°±å¯ä»¥åšä¸ºå‚æ•°ä¼ å…¥&lt;code>do_print(obj)&lt;/code>ä¸­ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬åªéœ€è¦ä¸ºç»§æ‰¿åŒæ ·æŽ¥å£çš„ç±»åž‹å®Œæˆä¸€å¥—å®žçŽ°ï¼Œæä¾›äº†æ›´å¥½çš„å°è£…ä¸ŽæŠ½è±¡ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œè¿™ç§å®žçŽ°çš„é—®é¢˜åœ¨äºŽè™šå‡½æ•°çš„è°ƒç”¨æ˜¯æœ‰é¢å¤–çš„å¼€é”€çš„ã€‚éœ€è¦è¿›è¡Œä¸€æ¬¡è¿è¡Œæ—¶è™šè¡¨çš„æŸ¥æ‰¾ï¼Œæ‰å¯ä»¥ç¡®å®šå¯¹è±¡éœ€è¦è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ¨¡æ¿template">ä½¿ç”¨æ¨¡æ¿ï¼ˆtemplateï¼‰ &lt;a href="#%e4%bd%bf%e7%94%a8%e6%a8%a1%e6%9d%bftemplate" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>C++æä¾›äº†æ¨¡æ¿ï¼Œæ”¯æŒå°†ç±»åž‹ä»¥æ¨¡æ¿å‚æ•°å½¢å¼ä¼ å…¥å‚æ•°ã€‚ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥ä¸€ç§ç‹¬ç«‹äºŽç‰¹å®šç±»åž‹çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ”¹å†™ä¸Šæ–‡ä¸­çš„&lt;code>do_print(obj)&lt;/code>å‡½æ•°ï¼Œä½¿å…¶å¯ä»¥æ”¯æŒä¸åŒçš„ç±»åž‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> do_print(T obj) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obj.print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œï¼Œä¼ å…¥å‚æ•°çš„ç±»åž‹&lt;code>T&lt;/code>æ— éœ€ç»§æ‰¿&lt;code>IPrintable&lt;/code>æŽ¥å£ï¼Œåªè¦å…¶å®žçŽ°äº†&lt;code>print()&lt;/code>æˆå‘˜å‡½æ•°å³å¯åšä¸ºå¯¹è±¡ä¼ å…¥ã€‚&lt;/p>
&lt;p>C++æ¨¡æ¿çš„ç±»åž‹æ“¦é™¤ä½œç”¨äºŽç¼–è¯‘æœŸï¼Œå¯ä»¥å°½æ—©çš„å‘çŽ°é£Žé™©ï¼ŒåŒæ—¶ï¼ˆä¸€èˆ¬æ¥è¯´ï¼‰ä¸å½±å“è¿è¡Œæ—¶çš„æ€§èƒ½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨æ„ï¼šJava/C#çš„æ³›åž‹(generic)è¯­æ³•ä¸ŽC++çš„æ¨¡æ¿éžå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯Java/C#çš„æ³›åž‹æ˜¯ä½œç”¨äºŽè¿è¡Œæ—¶çš„ã€‚è¿™é‡Œæ³¨æ„åŒºåˆ†äºŒè€…çš„åŒºåˆ«ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ä½†æ˜¯æ¨¡æ¿ä¹Ÿæœ‰å…¶å±€é™æ€§ã€‚æ¨¡æ¿æœ‰éšå«çš„æŽ¥å£è¯­ä¹‰ï¼Œä½†æ˜¯ç”±äºŽæ¨¡æ¿æ‰€ä½¿ç”¨çš„å¯¹è±¡å¹¶æ²¡æœ‰å…±åŒçš„åŸºç±»ï¼ˆæŽ¥å£ï¼‰ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„å®¹å™¨æ¥å‚¨å­˜å¯¹è±¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">???&lt;/span> objs[] &lt;span style="color:#f92672">=&lt;/span> { &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span>(), &lt;span style="color:#66d9ef">new&lt;/span> Bar() };
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cç±»åž‹æ“¦é™¤å®žæˆ˜--stdfunction">C++ç±»åž‹æ“¦é™¤å®žæˆ˜ â€”â€” &lt;code>std::function&lt;/code> &lt;a href="#c%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4%e5%ae%9e%e6%88%98--stdfunction" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ªå‡½æ•°å¯¹è±¡åªèƒ½ä½¿ç”¨å‡½æ•°æœ¬èº«ä»¥åŠå‡½æ•°æŒ‡é’ˆã€‚ä½†æ˜¯åœ¨C++ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†æ›´å¤šçš„é€‰æ‹©ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡½æ•°&lt;/li>
&lt;li>inline lambda&lt;/li>
&lt;li>å‡½æ•°æŒ‡é’ˆï¼ˆC-styleï¼‰&lt;/li>
&lt;li>ä»¿å‡½æ•°ï¼ˆfactor classï¼‰&lt;/li>
&lt;li>&lt;code>std::bind&lt;/code>&lt;/li>
&lt;li>&lt;code>std::function&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢çš„è¿™äº›å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸ºå¯è°ƒç”¨ï¼ˆcallableï¼‰å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼&lt;code>f(obj)&lt;/code>çš„è¯­æ³•ï¼Œä»¥å‡½æ•°å½¢å¼è°ƒç”¨è¿™äº›å¯¹è±¡ã€‚&lt;/p>
&lt;p>æ€è€ƒä»¥ä¸‹çš„åœºæ™¯ï¼šæˆ‘ä»¬æƒ³è¦å®žçŽ°ä¸€ä¸ªå›žè°ƒå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œå¯ä»¥æ˜¯ä»¥ä¸Šå¯è°ƒç”¨å¯¹è±¡çš„ä»»æ„ä¸€ç§ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ç”¨ä»€ä¹ˆç±»åž‹æ¥è¡¨ç¤ºè¿™ä¸ªå›žè°ƒå‡½æ•°å¯¹è±¡å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ˜¯çš„ï¼Œç­”æ¡ˆå°±æ˜¯&lt;code>std::function&lt;/code>ã€‚C++ä¸­çš„&lt;code>std::function&lt;/code>ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹å¯è°ƒç”¨å¯¹è±¡çš„æŠ½è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>std::function&lt;/code>å°è£…å¯è°ƒç”¨å¯¹è±¡ï¼Œä»Žè€Œæ“¦é™¤å…¶ç±»åž‹ä¿¡æ¯ï¼Œä½¿ç”¨ç»Ÿä¸€çš„æ–¹æ³•å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚&lt;/p>
&lt;p>è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// http://www.cplusplus.com/reference/functional/function/function/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e"> &lt;/span>&lt;span style="color:#75715e">// std::cout
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;functional&amp;gt;&lt;/span>&lt;span style="color:#75715e"> &lt;/span>&lt;span style="color:#75715e">// std::function, std::negate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a function:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">half&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a function object class:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">third_t&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">operator&lt;/span>()(&lt;span style="color:#66d9ef">int&lt;/span> x) {&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a class with data members:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyValue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">fifth&lt;/span>() {&lt;span style="color:#66d9ef">return&lt;/span> value&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn1 &lt;span style="color:#f92672">=&lt;/span> half; &lt;span style="color:#75715e">// function
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>half; &lt;span style="color:#75715e">// function pointer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn3 &lt;span style="color:#f92672">=&lt;/span> third_t(); &lt;span style="color:#75715e">// function object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn4 &lt;span style="color:#f92672">=&lt;/span> [](&lt;span style="color:#66d9ef">int&lt;/span> x){&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>;}; &lt;span style="color:#75715e">// lambda expression
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn5 &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>negate&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(); &lt;span style="color:#75715e">// standard function object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn1(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn1(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn2(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn2(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn3(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn3(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn4(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn4(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn5(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn5(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// stuff with members:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(MyValue&lt;span style="color:#f92672">&amp;amp;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>MyValue&lt;span style="color:#f92672">::&lt;/span>value; &lt;span style="color:#75715e">// pointer to data member
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(MyValue&lt;span style="color:#f92672">&amp;amp;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fifth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>MyValue&lt;span style="color:#f92672">::&lt;/span>fifth; &lt;span style="color:#75715e">// pointer to member function
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyValue sixty {&lt;span style="color:#ae81ff">60&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;value(sixty): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> value(sixty) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fifth(sixty): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fifth(sixty) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="stdfunctionçš„ç¼ºé™·">&lt;code>std::function&lt;/code>çš„ç¼ºé™· &lt;a href="#stdfunction%e7%9a%84%e7%bc%ba%e9%99%b7" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::function&lt;/code>çš„ç±»åž‹æ“¦é™¤åŠŸèƒ½å¼‚å¸¸å¼ºå¤§ï¼Œå‡ ä¹Žå¯ä»¥å°è£…æ‰€æœ‰çš„å¯è°ƒç”¨ç±»åž‹ã€‚ä½†æ˜¯ï¼Œè¯­æ³•ä¸Šé¢çš„ä¾¿åˆ©å´ä¼šå¸¦æ¥äº†æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚&lt;/p>
&lt;p>ä»Ž&lt;a href="https://gist.github.com/Wizmann/30073037f31d796efd6f42798dd85aee">benchmark&lt;/a>ç»“æžœä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨&lt;code>O2&lt;/code>çš„ä¼˜åŒ–å‚æ•°ä¸‹ï¼Œå‡½æ•°è°ƒç”¨ï¼ˆåŒ…æ‹¬å‡½æ•°ã€å‡½æ•°æ¨¡æ¿å’Œä»¿å‡½æ•°ï¼‰ã€å‡½æ•°æŒ‡é’ˆå’Œlambdaçš„æ€§èƒ½ç›¸ä»¿ã€‚è€Œè™šå‡½æ•°å¤§æ¦‚éœ€è¦èŠ±è´¹5å€å·¦å³çš„æ—¶é—´ï¼Œè€Œ&lt;code>std::function&lt;/code>åˆ™éœ€è¦èŠ±è´¹6å€ä»¥ä¸Šçš„æ—¶é—´ã€‚å¯¹äºŽä¸€ä¸ªä¼šè¢«ç»å¸¸è°ƒç”¨åˆ°çš„å‡½æ•°ï¼Œå¸¦æ¥çš„é¢å¤–çš„æ€§èƒ½å¼€é”€æ˜¯ä¸å¯ä»¥å¿½ç•¥çš„ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>method&lt;/th>
&lt;th style="text-align: right">Linux (Azure VM, E5-2673 v3, -O0)&lt;/th>
&lt;th style="text-align: right">Linux (Azure VM, E5-2673 v3, -O2)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Function&lt;/td>
&lt;td style="text-align: right">12.4s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Function Ptr&lt;/td>
&lt;td style="text-align: right">13.5s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Inline Lambda&lt;/td>
&lt;td style="text-align: right">12.7s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Virtual Function&lt;/td>
&lt;td style="text-align: right">14.1s&lt;/td>
&lt;td style="text-align: right">6.3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::function&lt;/td>
&lt;td style="text-align: right">77.3s&lt;/td>
&lt;td style="text-align: right">7.2s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ç©¶å…¶åŽŸå› ï¼Œæ˜¯ç”±äºŽ&lt;code>std::function&lt;/code>çš„æ¨¡æ¿å‚æ•°ä¸­åªæä¾›äº†å‚æ•°ç±»åž‹å’Œè¿”å›žå€¼ç±»åž‹ï¼Œæ‰€ä»¥ä¸ºäº†è¿›è¡Œç±»åž‹æ“¦é™¤ï¼Œå…¶ä¸­å†…ç½®äº†ä¸€ä¸ªè™šå‡½æ•°ã€‚æ‰€ä»¥ä¸€æ¬¡&lt;code>std::function&lt;/code>è°ƒç”¨ä¼šå¼•å‘éšå¼çš„å¤šæ¬¡å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­è¿˜åŒ…å«ç€ä¸€æ¬¡è™šå‡½æ•°çš„è°ƒç”¨ã€‚æ‰€ä»¥æ€§èƒ½ä¸‹é™ä¹Ÿå°±ä¸éš¾è§£é‡Šäº†ã€‚&lt;/p>
&lt;h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œé™¤éžå¿…è¦ï¼Œä¸è¦ä½¿ç”¨&lt;code>std::function&lt;/code>ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œåœ¨&lt;code>std::sort&lt;/code>ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿ä¼ å…¥å¯è°ƒç”¨ç±»åž‹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…&lt;code>std::function&lt;/code>çš„é¢å¤–å¼€é”€ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RandomIt&lt;/span>, &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Compare&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> sort( RandomIt first, RandomIt last, Compare comp );
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨ä¸åŒçš„å¯è°ƒç”¨ç±»åž‹æ¥è§„é¿ç±»åž‹æ“¦é™¤ï¼Œå¦‚ç»Ÿä¸€ä½¿ç”¨å‡½æ•°æŒ‡é’ˆã€‚åœ¨C++14ä¹‹åŽï¼Œinline lambdaä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºå‡½æ•°æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é—­åŒ…æ¥å°è£…å…¶å®ƒçš„å¯è°ƒç”¨å¯¹è±¡äº†ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±é€ ä¸ª&lt;a href="https://codereview.stackexchange.com/questions/14730/impossibly-fast-delegate-in-c11">è½®å­&lt;/a>ï¼Œè¿™å°±åˆæ˜¯å¦ä¸€ä¸ªæ•…äº‹äº†ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æœ€åŽ">å†™åœ¨æœ€åŽ &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>æ–°çš„C++è§„èŒƒç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šçš„è¯­æ³•ç³–ã€‚å¯¹äºŽä¼ ç»ŸC++ç¨‹åºå‘˜æ¥è¯´ï¼Œå¥½å¤„åœ¨äºŽæˆ‘ä»¬å¯ä»¥å†™å‡ºæ›´èˆ’æœçš„ï¼Œæ›´ç¬¦åˆç›´è§‰çš„ä»£ç ï¼Œä½†ç¼ºç‚¹æ˜¯æˆ‘ä»¬éœ€è¦äº†è§£æ›´å¤šè¯­è¨€èƒŒåŽçš„ä¸œè¥¿ã€‚æ‰€ä»¥å¯¹äºŽè‡ªå·±ä¸ç†Ÿæ‚‰çš„æ–°å¼è¯­æ³•ï¼Œæ— è®ºçœ‹èµ·æ¥å¤šä¹ˆè¯±äººï¼Œä¹Ÿéœ€è¦å¤šåŠ è°¨æ…Žã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æŽ¥">å‚è€ƒé“¾æŽ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/Wizmann/30073037f31d796efd6f42798dd85aee">Benchmark for &amp;ldquo;function pointer&amp;rdquo;, &amp;ldquo;virtual function&amp;rdquo; and &amp;ldquo;std::function&amp;rdquo;&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.modernescpp.com/index.php/c-core-guidelines-type-erasure">C++ Core Guidelines: Type Erasure&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://davekilian.com/cpp-type-erasure.html">C++ &amp;lsquo;Type Erasure&amp;rsquo; Explained&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>