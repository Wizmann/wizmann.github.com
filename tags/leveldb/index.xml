<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Leveldb on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/leveldb/</link><description>Recent content in Leveldb on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Sun, 15 Aug 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/leveldb/index.xml" rel="self" type="application/rss+xml"/><item><title>è®ºæ–‡é˜…è¯»-WiscKeyï¼šSSDå‹å¥½çš„KVåˆ†ç¦»å­˜å‚¨å¼•æ“</title><link>https://wizmann.top/posts/paper-wisckey/</link><pubDate>Sun, 15 Aug 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paper-wisckey/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åŸºäºlsm-treeçš„å­˜å‚¨å¼•æ“">åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ &lt;a href="#%e5%9f%ba%e4%ba%8elsm-tree%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Log-Structed Merge-Tree (a.k.a. LSM-Tree)æ˜¯å½“ä¸‹å¸¸ç”¨çš„ä¸€ç§åŸºäºç£ç›˜çš„å­˜å‚¨å¼•æ“ã€‚ä¸Hashç´¢å¼•å’ŒB-TreeåŒä¸ºæ•°æ®åº“æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;p>LSM-Treeçš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>æ— éœ€å°†æ‰€æœ‰çš„Keyç´¢å¼•åœ¨å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡åˆ†çº§æŸ¥æ‰¾çš„æ–¹å¼ï¼ŒæŸ¥è¯¢åˆ°ç‰¹å®šKVåœ¨ç£ç›˜ä¸­çš„åç§»é‡&lt;/li>
&lt;li>æ•°æ®å†™å…¥ä¸åˆå¹¶ä½¿ç”¨é¡ºåºè¿½åŠ å†™ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨ç£ç›˜çš„é¡ºåºå†™æ€§èƒ½&lt;/li>
&lt;li>å¯¹äºæ•°æ®å†™å…¥ï¼Œä¼šä½¿ç”¨batchæ–¹å¼å†™å…¥ç£ç›˜&lt;/li>
&lt;li>æ”¯æŒèŒƒå›´æŸ¥è¯¢&lt;/li>
&lt;/ol>
&lt;p>LSM-Treeçš„åŠ£åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>è¯»æ”¾å¤§ä¸å†™æ”¾å¤§&lt;/li>
&lt;li>æ— æ³•å¯¹å•æ¡æ•°æ®åŠ é”ï¼ˆäº‹åŠ¡æ”¯æŒï¼‰&lt;/li>
&lt;/ol>
&lt;p>ç°åœ¨å¸¸ç”¨çš„LevelDBå’ŒRocksDBï¼Œéƒ½æ˜¯åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_18-00-50.png" alt="LSM-Tree-Architecture">&lt;/p>
&lt;h3 id="wisckeyä¸»è¦è§£å†³çš„é—®é¢˜">WiscKeyä¸»è¦è§£å†³çš„é—®é¢˜ &lt;a href="#wisckey%e4%b8%bb%e8%a6%81%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LSM-Treeåœ¨æ€§èƒ½ä¸Šé¢çš„ç“¶é¢ˆä¸»è¦åœ¨äºè¯»å†™çš„æ”¾å¤§ã€‚ç®€å•è¯´æ¥ï¼Œå‡è®¾ä½ çš„ç£ç›˜æœ€å¤§å¸¦å®½ä¸º4GB/sï¼Œè¯»å†™æ”¾å¤§å€æ•°ä¸º10ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨å±‚çš„æœ‰æ•ˆååé‡ï¼ˆ&lt;a href="https://en.wikipedia.org/wiki/Goodput">Goodput&lt;/a>ï¼‰æœ€å¤šåªèƒ½è¾¾åˆ°400MB/sã€‚å¹¶ä¸”ï¼Œå¯¹äºä¸€äº›å¤§æ•°æ®é›†ï¼Œè¯»å†™æ”¾å¤§çš„å€¼æœ‰å¯èƒ½ä¼šéå¸¸å¤§ï¼ˆå¤§äº100ï¼‰ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„è¯»å†™æ”¾å¤§å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹é¢åˆ†å¼€è®¨è®ºã€‚&lt;/p>
&lt;h4 id="è¯»æ”¾å¤§">è¯»æ”¾å¤§ &lt;a href="#%e8%af%bb%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹LSM-Treeçš„æŸ¥è¯¢æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆåœ¨mutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>ç„¶ååœ¨immutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>æœ€ååœ¨ä¸åŒçš„LSM-Treeå±‚çº§ä¸­çš„SST fileä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;/ol>
&lt;p>å¯¹äº1å’Œ2ï¼Œéƒ½æ˜¯å†…å­˜æ“ä½œï¼Œå…¶è€—æ—¶ä¸è¯»å–ç£ç›˜ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚
å¯¹äº3ï¼ŒSST fileæ–‡ä»¶çš„æŸ¥æ‰¾ä¼šå…ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å®šä½ç‰¹å®šKVä½äºè¯¥å±‚çš„å“ªä¸€ä¸ªSSTæ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVä¸å­˜åœ¨äºæ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šè¢«å¸¸é©»å†…å­˜çš„bloom filterè¿‡æ»¤æ‰ï¼Œä¸ä¼šçœŸæ­£çš„è¯»å–æ–‡ä»¶ã€‚ï¼ˆå¤§æ¦‚ç‡ï¼Œbloom filterçš„åŸç†äº†è§£ä¸€ä¸‹ï¼‰&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVåœ¨æ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šé€šè¿‡index blockè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œç¡®å®šKVä½äºå“ªä¸ªblockã€‚ç„¶åè¿™ä¸ªblockä¼šè¢«ä»ç£ç›˜ä¸Šè¯»å–åˆ°å†…å­˜è¿›è¡Œè§£å‹ï¼Œæœ€åé€šè¿‡äºŒåˆ†+éå†æ‰¾åˆ°å¯¹åº”çš„KVã€‚&lt;/p>
&lt;blockquote>
&lt;p>è®ºæ–‡é‡Œå¯¹äºè¯»æ”¾å¤§çš„è®¡ç®—æ–¹æ³•æœ‰ç‚¹å¤¸å¤§äº†ã€‚å¯¹äºRocksDBæ¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹index blockå’Œbloom filteréƒ½æ˜¯å¸¸é©»å†…å­˜çš„ã€‚é™¤éæ˜¯å†…å­˜éå¸¸ç´§å¼ çš„åœºæ™¯ï¼Œå¦åˆ™å¹¶ä¸ä¼šäº§ç”Ÿè®ºæ–‡ä¸­å¦‚æ­¤å¤¸å¼ çš„ç£ç›˜è¯»æ”¾å¤§çš„ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥è¯»æ”¾å¤§ä¸»è¦å› ä¸ºè¯»å–ä¸€ä¸ªKVï¼Œéœ€è¦è¯»å–+è§£å‹æ•´ä¸ªblockã€‚å½“KVå¤§å°è¿œå°äºblock sizeçš„æ—¶å€™ï¼Œé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ã€‚&lt;/p>
&lt;h4 id="å†™æ”¾å¤§">å†™æ”¾å¤§ &lt;a href="#%e5%86%99%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬å†é‡æ¸©ä¸€ä¸ªLSM-Treeçš„å†™å…¥æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆå†™å…¥mutable memtable&lt;/li>
&lt;li>mutable memtableåç»­ä¼šè¢«sealedï¼Œæˆä¸ºimmutable memtable&lt;/li>
&lt;li>immutable memtableä¼šè¢«flushåˆ°ç£ç›˜ï¼Œæˆä¸ºL0&lt;/li>
&lt;li>L0ä¸­çš„æ•°æ®ä¼šåœ¨åå°ï¼Œé€å±‚å‘ä¸‹åˆå¹¶ï¼Œç›´åˆ°åˆå¹¶åˆ°æœ€åº•å±‚&lt;/li>
&lt;/ol>
&lt;p>å±‚æ¬¡æ•°æ®é€å±‚å‘ä¸‹åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚ï¼ˆå…·ä½“åŸç†è¿™é‡Œä¸å±•å¼€äº†ï¼‰&lt;/p>
&lt;p>å†™æ”¾å¤§å€¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¼°ç®—ã€‚å·²çŸ¥&lt;code>options.max_bytes_for_level_multiplier&lt;/code>ä»£è¡¨æ¯ä¸€å±‚å¤§å°çš„å€æ•°kï¼Œå¹¶ä¸”å‡è®¾L0ä¸L1çš„å¤§å°ç›¸ç­‰ï¼Œæ€»å…±æœ‰Nå±‚ã€‚é‚£ä¹ˆå†™æ”¾å¤§çº¦ä¸º&lt;code>(N - 1) * k + 1&lt;/code>ã€‚&lt;/p>
&lt;h2 id="æ­£æ–‡">æ­£æ–‡ &lt;a href="#%e6%ad%a3%e6%96%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å…¥æ´»äº†å…¥æ´»äº†ï¼&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡ç›®æ ‡">WiscKeyçš„è®¾è®¡ç›®æ ‡ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>é™ä½å†™æ”¾å¤§&lt;/li>
&lt;li>é™ä½è¯»æ”¾å¤§&lt;/li>
&lt;li>å¯¹SSDè¿›è¡Œä¼˜åŒ–&lt;/li>
&lt;li>æä¾›LSM-Treeå…¼å®¹çš„API&lt;/li>
&lt;li>é’ˆå¯¹ç°å®åœºæ™¯çš„KV size&lt;/li>
&lt;/ul>
&lt;h3 id="wisckeyçš„è®¾è®¡æ€è·¯kvåˆ†ç¦»">WiscKeyçš„è®¾è®¡æ€è·¯â€”â€”KVåˆ†ç¦» &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%afkv%e5%88%86%e7%a6%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€èˆ¬çš„åœºæ™¯ä¸­ï¼Œåœ¨ä¸€å¯¹KVä¸­ï¼ŒKeyçš„å¤§å°è¿œæ¯”Valueçš„è¦å°ã€‚å¦‚æœæˆ‘ä»¬åœ¨LSM-Treeä¸­åªä¿ç•™Keyï¼Œé‚£ä¹ˆå¯¹äºä¸€æ¬¡è¯»å†™ï¼Œæˆ‘ä»¬æ‰€è¦å¤„ç†çš„æ•°æ®å°±ä¼šå°‘å¾ˆå¤šï¼Œä»è€Œé™ä½äº†è¯»å†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>å¯¹äºValueï¼Œæˆ‘ä»¬ä¼šå°†å…¶å­˜å‚¨åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„vLogä¸­ã€‚æ¯ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šåœ¨LSM-Treeä¸­è®°å½•å…¶åœ¨vLogä¸­çš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code> ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»å–Valueçš„æ“ä½œä¹Ÿåªæœ‰ä¸€æ¬¡ç£ç›˜è®¿é—®ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-08-54.png" alt="WiscKey-data-layout">&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœæŒ‰è®ºæ–‡é‡Œé¢çš„è®¾è®¡ï¼ŒvLogé‡Œé¢çš„æ•°æ®æ˜¯ä¸ä¼šæ‰“åŒ…çš„blockè¿›è¡Œå‹ç¼©çš„ï¼Œå¿…ç„¶ä¼šæŸå¤±capacityã€‚å¦‚æœæ‰“åŒ…å‹ç¼©äº†ï¼Œé‚£ä¹ˆè¯»æ”¾å¤§å¹¶æ²¡æœ‰æ˜¾è‘—ä¼˜åŒ–ã€‚åˆå¦‚æœvalue size â‰ˆ block sizeï¼Œé‚£ä¹ˆå…¶å®åœ¨è¯»æ”¾å¤§ä¸Šé¢çš„ä¼˜åŒ–ä¹Ÿå°±æ¯”è¾ƒå¾®å¼±äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡æŒ‘æˆ˜">WiscKeyçš„è®¾è®¡æŒ‘æˆ˜ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="å¹¶å‘èŒƒå›´æŸ¥æ‰¾">å¹¶å‘èŒƒå›´æŸ¥æ‰¾ &lt;a href="#%e5%b9%b6%e5%8f%91%e8%8c%83%e5%9b%b4%e6%9f%a5%e6%89%be" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å› ä¸ºä½¿ç”¨äº†KVåˆ†ç¦»çš„å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥æ‰¾ï¼ˆrange queryï¼‰å¯¹äºvalueå°±ä¼šé€€åŒ–æˆå¾ˆå¤šæ¬¡éšæœºè¯»å–ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç”±äºSSDçš„å¹¶å‘è¯»å–ç‰¹æ€§ï¼ŒWiscKeyä¼šå°†æ‰€éœ€è¦è¯»å–çš„valueçš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code>æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ‰€éœ€è¦çš„valueã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-42-44.png" alt="seq-rand-reads-on-ssd">&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œå¯¹äºè¾ƒå¤§çš„value sizeï¼Œé¡ºåºè¯»ä¸å¹¶å‘è¯»çš„throughputåŸºæœ¬ä¿æŒä¸€è‡´ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¤šçº¿ç¨‹å¹¶å‘è¯»ä¼šæ¶ˆè€—æ›´å¤šçš„CPUã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_16-02-21.png" alt="CPU-usage">&lt;/p>
&lt;blockquote>
&lt;p>ä¸è¿‡å¯¹äºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼ŒCPUå¤§æ¦‚æ˜¯æœ€ä¸é‡è¦çš„èµ„æºäº†å§ï¼ˆè§ä»è§æ™ºå’¯ï¼‰&lt;/p>&lt;/blockquote>
&lt;h4 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶ &lt;a href="#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¯¹äºé‡å¤å†™å…¥çš„KVï¼ŒLSM-Treeä¼šé€šè¿‡å±‚æ¬¡åˆå¹¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚è€ŒWiscKeyä¼šä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_00-11-06.png" alt="vlog-data-layout">&lt;/p>
&lt;p>vLogå¯ä»¥è§†ä½œä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ŒheadæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„å¼€å¤´ï¼ˆè¾ƒæ–°çš„æ•°æ®ï¼‰ï¼ŒtailæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„ç»“å°¾ï¼ˆè¾ƒæ—§çš„æ•°æ®ï¼‰ã€‚åœ¨headå’ŒtailæŒ‡é’ˆä¹‹å¤–çš„ç©ºé—´éƒ½è§†ä½œfree spaceã€‚&lt;/p>
&lt;p>å½“ç©ºé—²æ•°æ®å°äºä¸€å®šé˜ˆå€¼ä¹‹åï¼Œä¼šè§¦å‘GCã€‚WiscKeyä¼šä»tailä¾æ¬¡è¯»å‡ºä¸€éƒ¨åˆ†æ—§æ•°æ®ï¼ˆbatch readï¼‰ï¼ŒæŸ¥è¯¢LSM-Treeï¼Œå¦‚æœè¿™æ¡æ•°æ®å·²ç»è¢«è¦†ç›–æˆ–åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒæ­¤æ•°æ®ï¼›å¦åˆ™ä»headæŒ‡é’ˆå¤„å†™å…¥æ­¤æ¡æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¿è¯åœ¨GCè¿‡ç¨‹ä¸­çš„crashä¸äº§ç”Ÿæ•°æ®çš„ä¸¢å¤±ï¼ŒGCçš„æµç¨‹ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>å°†tailå¤„çš„KVå†™å…¥åˆ°headå¤„ï¼Œå¹¶è°ƒç”¨&lt;code>fsync()&lt;/code>å°†å…¶æŒä¹…åŒ–&lt;/li>
&lt;li>åŒæ­¥çš„å°†KVçš„æ–°ä½ç½®ï¼Œå’Œhead/tailæŒ‡é’ˆçš„æœ€æ–°ä½ç½®å†™å…¥LSM-Tree&lt;/li>
&lt;/ol>
&lt;p>ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†LSM-Treeçš„WALï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰åœ¨LSM-Treeé‡Œçš„æ•°æ®éƒ½æ˜¯å¯ç”¨çš„ã€‚&lt;/p>
&lt;h4 id="å´©æºƒä¸€è‡´æ€§crash-consistency">å´©æºƒä¸€è‡´æ€§ï¼ˆCrash Consistencyï¼‰ &lt;a href="#%e5%b4%a9%e6%ba%83%e4%b8%80%e8%87%b4%e6%80%a7crash-consistency" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨åƒåœ¾å›æ”¶ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»é‡åˆ°äº†ä¸€è‡´æ€§çš„é—®é¢˜ã€‚å…¶æ ¹æœ¬åŸå› ï¼Œåœ¨äºLSM-Treeå’ŒvLogæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¨¡å—ï¼Œåœ¨å…¶é—´ä¿æŒä¸€è‡´æ€§å¿…ç„¶æ˜¯å›°éš¾çš„ã€‚&lt;/p>
&lt;p>WiscKeyä½¿ç”¨äº†ç°ä»£æ–‡ä»¶ç³»ç»Ÿï¼ˆext4ï¼Œbtrfså’Œxfsï¼‰çš„ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§ï¼Œå³å¯¹äºä¸€ä¸ªï¼ˆå°†è¦ï¼‰å†™å…¥æ–‡ä»¶çš„æ•°æ®æµï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šä¿è¯è¿™ä¸ªæ•°æ®æµçš„ä¸€ä¸ªå‰ç¼€ï¼ˆæˆ–è€…æ•´ä¸ªæ•°æ®æµï¼‰æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„ä¼˜åŒ–">WiscKeyçš„ä¼˜åŒ– &lt;a href="#wisckey%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="vlogå†™å…¥buffer">vLogå†™å…¥Buffer &lt;a href="#vlog%e5%86%99%e5%85%a5buffer" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_12-20-02.png" alt="impact-of-write-unit-size">&lt;/p>
&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç£ç›˜çš„åŒæ­¥å†™å…¥å¿…ç„¶ä¼šå¸¦æ¥ä¸€äº›overheadã€‚å¯¹äºå°æ•°æ®æ¥è¯´ï¼Œè¿™åœ¨æ€§èƒ½ä¸Šä¼šäº§ç”Ÿä¸¥é‡çš„æŸè€—ã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„ä¼˜åŒ–ç±»ä¼¼äºå°†vLogä¹Ÿæ·»åŠ ä¸€ä¸ªmemory tableï¼Œæ‰€æœ‰å†™å…¥vLogçš„æ•°æ®éƒ½å…ˆå†™å…¥è¿™ä¸ªmemory tableï¼Œç„¶åä¾æ¬¡flushåˆ°ç£ç›˜ä¸Šã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä¼˜åŠ¿åœ¨äºå°†å†™å…¥batchåŒ–ï¼Œå¯ä»¥å‡å°‘overheadï¼Œæå‡æ€§èƒ½ã€‚åŠ£åŠ¿åœ¨äºï¼Œåœ¨ç³»ç»Ÿå´©æºƒæ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ã€‚ä½†ä¸¢å¤±æ•°æ®æ—¶ï¼Œä»èƒ½æŠ±è¯ä¸Šæ–‡æåˆ°çš„å´©æºƒä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h4 id="ä¼˜åŒ–lsm-tree-wal">ä¼˜åŒ–LSM-Tree WAL &lt;a href="#%e4%bc%98%e5%8c%96lsm-tree-wal" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>LSM-Treeçš„WALè™½ç„¶ä¿è¯äº†å†™å…¥çš„æ•°æ®çš„æŒä¹…æ€§ï¼Œä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œå®ƒä¹Ÿä¼šæ¶ˆè€—ç£ç›˜çš„ä¸€éƒ¨åˆ†å¸¦å®½ã€‚&lt;/p>
&lt;p>å…³é—­WALï¼Œæ„å‘³ç€LSM-Tree memtableåœ¨è¿›ç¨‹é‡å¯æ—¶ä¸€å®šä¼šä¸¢å¤±æ•°æ®ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨vLogé‡å»ºLSM-Treeï¼ˆçš„memtableéƒ¨åˆ†ï¼‰ã€‚&lt;/p>
&lt;p>ç”±äºvLogä¹‹ä¸­å·²ç»åŒ…æ‹¬äº†æ‰€æœ‰çš„KVå¯¹ï¼Œæ‰€ä»¥åœ¨WiscKeyé‡å¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»headæŒ‡é’ˆå¤„æ‰«ævLogçš„æ•°æ®ï¼Œç”±äºå´©æºƒä¸€è‡´æ€§çš„ä¿è¯ï¼Œå½“æŒ‡é’ˆæ‰«æåˆ°å·²ç»å­˜åœ¨äºLSM-Treeçš„æ•°æ®æ—¶ï¼Œå¯ä»¥è®¤ä¸ºLSM-Treeå·²ç»é‡å»ºæˆåŠŸã€‚&lt;/p>
&lt;h4 id="æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–">æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ– &lt;a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>WiscKeyä½¿ç”¨&lt;code>posix_fadvice()&lt;/code>å‘OSå±‚é¢„å£°æ˜æ¥ä¸‹æ¥vLogçš„æ“ä½œç±»å‹ä»¥é€‚åº”ä¸åŒåœºæ™¯çš„ç£ç›˜è®¿é—®æ¨¡å¼ã€‚ä½¿ç”¨&lt;code>fallocate()&lt;/code>ï¼Œé€šè¿‡&amp;quot;hole-punching&amp;quot;åŠŸèƒ½è¿›è¡ŒGCï¼Œä»¥å‡å°‘æ•°æ®çš„ç§»åŠ¨ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„æ€§èƒ½">WiscKeyçš„æ€§èƒ½ &lt;a href="#wisckey%e7%9a%84%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è®ºæ–‡çš„æœ€åç»™å‡ºäº†ä¸€ç³»åˆ—æ•°å­—ã€‚ç”±äºWiscKeyçš„è¯»å†™æ”¾å¤§å¾ˆå°ï¼Œæ‰€ä»¥åœ¨value sizeæ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼ˆ&amp;gt;= 1KBï¼‰ï¼Œæ€§èƒ½è¿œä¼˜äºä¼ ç»ŸLSM-Treeã€‚åŒæ—¶ï¼Œç£ç›˜ç©ºé—´çš„ä½¿ç”¨ä¹Ÿæ›´å‹å¥½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œè®ºæ–‡é‡Œåšmicrobenchmarkçš„æ—¶å€™ï¼Œå¯¹äºLevelDBå’ŒRocksDBï¼Œæ˜¯ä¸æ˜¯è¿˜å¼€ç€å‹ç¼©ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>WiscKeyåº”è¯¥æ˜¯â€œLSM-Tree + KVåˆ†ç¦»â€æ€è·¯çš„æ¯”è¾ƒæ—©æœŸçš„è®ºæ–‡ï¼Œå…¶ä¸­ä»æœ‰å¾ˆå¤šä¸æ˜ç¡®çš„ç»†èŠ‚ã€‚ä½†æ˜¯æ•´ä½“æ€è·¯æ˜¯å¯è¡Œçš„ã€‚&lt;/p>
&lt;p>PingCAPçš„&lt;a href="https://pingcap.com/zh/blog/titan-design-and-implementation">Titan&lt;/a>æ˜¯ä¸€ä¸ªåŸºäºWiscKeyæ€æƒ³çš„RocksDB KVåˆ†ç¦»å­˜å‚¨å¼•æ“ã€‚åç»­å¯ä»¥å‚è€ƒå…¶å®ç°å†äº†è§£æ›´å¤šçš„å®ç°æ€è·¯ä¸ç»†èŠ‚ã€‚&lt;/p></description></item></channel></rss>