<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Poll on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/poll/</link><description>Recent content in Poll on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Mon, 03 Oct 2016 22:22:14 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/poll/index.xml" rel="self" type="application/rss+xml"/><item><title>é˜»å¡TCPæµ - phxrpcä»£ç é˜…è¯»(3)</title><link>https://wizmann.top/posts/phxrpc-3/</link><pubDate>Mon, 03 Oct 2016 22:22:14 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-3/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>phxrpcçš„æµï¼ˆ&lt;code>stream&lt;/code>å’Œ&lt;code>streambuf&lt;/code>ï¼‰ä¸ç½‘ç»œè®¿é—®å…¶å®æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥æœ¬æ–‡å¯ä»¥ç»“åˆç€ç¬¬ä¸€ç¯‡ç¬”è®°ä¸€èµ·æ¥çœ‹ã€‚è™½ç„¶æˆ‘éå¸¸æƒ³åæ§½è¿™ç§å¼ºè€¦åˆæ€§çš„è®¾è®¡ï¼Œä½†æ˜¯æˆ‘å†³å®šè¿˜æ˜¯å¥½å¥½ç†è§£phxrpcçš„è®¾è®¡ä¹‹åã€‚ã€‚ã€‚æ”’ä¸€æ³¢å¤§çš„ï¼šï¼‰&lt;/p>
&lt;h2 id="blocktcpstreambuf">BlockTcpStreamBuf &lt;a href="#blocktcpstreambuf" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>class BlockTcpStreamBuf&lt;/code>ç»§æ‰¿è‡ª&lt;code>BaseTcpStreamBuf&lt;/code>ã€‚å…¶ä¸­é‡å†™äº†&lt;code>precv&lt;/code>å’Œ&lt;code>psend&lt;/code>ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æŒæœ‰äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦(file descriptor)ï¼š&lt;code>socket_&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>precv&lt;/code>å’Œ&lt;code>psend&lt;/code>ç›´æ¥è°ƒç”¨äº†&lt;code>&amp;lt;sys/socket.h&amp;gt;&lt;/code>ä¸­çš„&lt;code>recv(2)&lt;/code>å’Œ&lt;code>send(2)&lt;/code>ï¼Œå¹¶æ²¡æœ‰å…¶å®ƒæ“ä½œã€‚&lt;/p>
&lt;p>ç½‘ç»œç›¸å…³çš„æ“ä½œï¼Œåˆ™ç”±&lt;code>class BlockTcpStream&lt;/code>æ¥è´Ÿè´£ã€‚&lt;code>BlockTcpStreamBuf&lt;/code>åªè´Ÿè´£IOéƒ¨åˆ†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (BaseTcpUtils&lt;span style="color:#f92672">::&lt;/span>SetNonBlock(sockfd, false)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> BaseTcpUtils&lt;span style="color:#f92672">::&lt;/span>SetNoDelay(sockfd, true)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stream&lt;span style="color:#f92672">-&amp;gt;&lt;/span>Attach(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> phxrpc&lt;span style="color:#f92672">::&lt;/span>log(LOG_ERR, &lt;span style="color:#e6db74">&amp;#34;set nonblock fail&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> error &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;code>BlockTcpStream&lt;/code>æŠŠfdä¼ é€’ç»™&lt;code>BlockTcpStreambuf&lt;/code>ä¹‹å‰ï¼Œéœ€è¦æŠŠfdè®¾ç½®ä¸º&lt;code>block&lt;/code>çš„ã€‚è€Œè¿™æ®µä»£ç æœ€å¤§çš„æ§½ç‚¹å°±æ˜¯è¿™ä¸ª&lt;code>SetNonBlock&lt;/code>å‡½æ•°ï¼Œå’Œä¸‹é¢çš„&lt;code>set nonblock fail&lt;/code>æ—¥å¿—ï¼ˆæƒ³ä¸€æƒ³ï¼‰ã€‚å®Œå…¨è®©äººæ‘¸ä¸åˆ°å¤´è„‘ï¼Œè¾¾åˆ°ä¸€è„¸æ‡µé€¼çš„æœ€é«˜å¢ƒç•Œã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/87163832.jpg" alt="">&lt;/p>
&lt;p>ç”±äº&lt;code>recv&lt;/code>å’Œ&lt;code>send&lt;/code>å‡½æ•°æ˜¯&lt;code>block&lt;/code>çš„ï¼Œæ‰€ä»¥åœ¨è¯»å–ã€å†™å…¥ç¼“å†²åŒºæ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®å¯è¯»æˆ–æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å¯å†™ï¼Œåˆ™è¯»å–å†™å…¥æ“ä½œä¼šé˜»å¡ä½ã€‚&lt;/p>
&lt;h2 id="blocktcpstream">BlockTcpStream &lt;a href="#blocktcpstream" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨è¿™é‡Œæˆ‘åˆæƒ³åä¸ªæ§½äº†ï¼Œä¸ºå•¥åœ¨è¿™é‡ŒæŠŠTCP Serverå’ŒClientçš„å·¥ä½œæµæ··ä¸ºä¸€è°ˆã€‚æˆ‘è§‰å¾—è‡³å°‘åº”è¯¥ä»å‘½åä¸ŠåŒºåˆ†ä¸€ä¸‹ï¼Œå¦åˆ™æå®¹æ˜“è¯¯ç”¨ã€‚&lt;/p>
&lt;h3 id="tcpçš„å·¥ä½œæµç¨‹">TCPçš„å·¥ä½œæµç¨‹ &lt;a href="#tcp%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/92621506.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šUNIXç½‘ç»œç¼–ç¨‹å·ä¸€ï¼šå¥—æ¥å­—ç¼–ç¨‹ 4.2èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒTCPçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„å·¥ä½œæµç¨‹æ˜¯ä¸åŒçš„ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå®¢æˆ·ç«¯çš„ç¨‹åºè¦ç®€å•ä¸€äº›ã€‚&lt;/p>
&lt;p>&lt;code>BlockTcpStream&lt;/code>ä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨çš„å‡½æ•°åªæœ‰&lt;code>BlockTcpUtils::Open&lt;/code>ï¼Œè€ŒæœåŠ¡ç«¯çš„&lt;code>BlockTCPUtils::Listen&lt;/code>å‡½æ•°åŒ…æ‹¬äº†&lt;code>bind()&lt;/code>å’Œ&lt;code>listen()&lt;/code>ä¸¤ä¸ªæ“ä½œï¼Œè€Œ&lt;code>accept()&lt;/code>åˆ™éœ€è¦å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨ã€‚&lt;/p>
&lt;h3 id="so_reuseaddr">SO_REUSEADDR &lt;a href="#so_reuseaddr" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨æœåŠ¡ç«¯çš„&lt;code>Listen()&lt;/code>å‡½æ•°ä¸­ï¼Œphxrpcä½¿ç”¨äº†&lt;code>SO_REUSEADDR&lt;/code>é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹çš„æ„åœ¨é€šçŸ¥å†…æ ¸ï¼šå¦‚æœç«¯å£å¿™ï¼Œä½†æ˜¯TCPçŠ¶æ€ä½äº&lt;code>TIME_WAIT&lt;/code>æ—¶ï¼Œå¯ä»¥é‡ç”¨ç«¯å£ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªå¥—æ¥å­—å…¶å®æ˜¯ä¸€ä¸ª&lt;code>ï¼ˆåè®®ï¼Œæºåœ°å€ï¼Œæºç«¯å£ï¼Œç›®æ ‡åœ°å€ï¼Œç›®æ ‡ç«¯å£ï¼‰&lt;/code>äº”å…ƒç»„ã€‚&lt;code>SO_REUSEADDR&lt;/code>æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é‡ç”¨æºåœ°å€å’Œæºç«¯å£ã€‚å½“ç„¶æ­¤æ—¶çš„é£é™©åœ¨äºå¦‚æœè¯¥åŸå¥—æ¥å­—å‘é€äº†ä¸€äº›é”™è¯¯çš„æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„TCPå·¥ä½œæµå°±ä¼šäº§ç”Ÿé”™ä¹±ã€‚ä½†æ˜¯ç”±äºTCPçš„å®ç°ä¸­ï¼Œé€šè¿‡éšæœºçš„æ¶ˆæ¯åºå·è§„é¿äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œçš„é£é™©å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>SO_REUSEADDR&lt;/code>çš„å¥½å¤„æ˜¯ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºå´©æºƒå’Œé€€å‡ºæ—¶ï¼ˆå¯¹äºä¸€èˆ¬çš„æœåŠ¡ç«¯ç¨‹åºæ¥è¯´ï¼Œå´©æºƒå’Œé€€å‡ºæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼‰ï¼Œå¯ä»¥ç«‹å³é‡å¯ï¼Œè€Œä¸éœ€è¦ç­‰å¾…2MSLæ—¶é—´ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦ç­‰å¾…2MSLæ—¶é—´å‘¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/33186679.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šEffective TCP/IP 3.8èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>TCPæ‹†é™¤è¿æ¥ä½¿ç”¨äº†å››æ¬¡æ¡æ‰‹çš„æœºåˆ¶ï¼Œè€Œä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹åœ¨å‘é€å®Œæœ€åä¸€ä¸ªACKä¹‹åï¼Œéœ€è¦ç­‰å¾…2MSLçš„æ—¶é—´ã€‚è¿™å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œå½“æœåŠ¡å™¨é‡å¯åï¼Œå‡ºç°&lt;code>Address already in use&lt;/code>çš„æŠ¥é”™ä¿¡æ¯ï¼Œéœ€è¦é¢å¤–ç­‰å¾…å¤§çº¦1~4åˆ†é’Ÿçš„åŸå› ã€‚&lt;/p>
&lt;p>ç©¶å…¶åŸå› ï¼ŒTIME-WAITçŠ¶æ€çš„æ„å›¾åœ¨äºé¿å…ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€ç«¯æœ€åä¸€ä¸ªACKå‘é€å¤±è´¥ã€‚æ­¤æ—¶ï¼Œä¸»æœº1å·²ç»å®Œå…¨å…³é—­ï¼Œè€Œä¸»æœº2å› ä¸ºæ²¡æœ‰æ”¶åˆ°FINåŒ…çš„ACKï¼Œå¤„äºåŠå…³é—­çŠ¶æ€ã€‚æ­¤æ—¶ä¸»æœº2å‘ä¸»æœº1å‘é€çš„ä»»ä½•ä¿¡æ¯ï¼ˆå¦‚å»¶è¿Ÿçš„ACKåŒ…ç­‰ï¼‰éƒ½åªä¼šæ”¶åˆ°RSTï¼Œå¯¼è‡´è¿æ¥çš„å¼‚å¸¸å…³é—­ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œä¸»åŠ¨å…³é—­ç«¯éœ€è¦ç­‰å¾…2MSLæ—¶é—´ã€‚ä¸€ä¸ªMSLæ˜¯ç»™æœ€åçš„ACKåŒ…ï¼Œè€Œå¦å¤–ä¸€ä¸ªMSLï¼Œæ˜¯ä¸ºäº†ç­‰å¾…è¢«åŠ¨å…³é—­ç«¯é‡æ–°å‘é€FINåŒ…ã€‚å¦‚æœåœ¨TIME_WAITæœŸé—´æ”¶åˆ°äº†å¯¹ç«¯çš„æ•°æ®åŒ…ï¼Œä¼šåˆ·æ–°TIME_WAITçŠ¶æ€çš„æ—¶é—´ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒï¼šEffective TCP/IP 3.8 3.9èŠ‚&lt;/p>&lt;/blockquote>
&lt;h3 id="ioå¤ç”¨poll">IOå¤ç”¨ï¼šPoll &lt;a href="#io%e5%a4%8d%e7%94%a8poll" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/84501111.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šUNIXç½‘ç»œç¼–ç¨‹å·ä¸€ï¼šå¥—æ¥å­—ç¼–ç¨‹ 6.2èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>IOå¤ç”¨æ˜¯æŒ‡å†…æ ¸åœ¨å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªIOæ¡ä»¶å°±ç»ªï¼Œå†…æ ¸å°±é€šçŸ¥è¿›ç¨‹ã€‚é€šå¸¸æ¥è®²ï¼Œå¸¸ç”¨çš„IOå¤ç”¨å‡½æ•°æœ‰&lt;code>select()&lt;/code>å’Œ&lt;code>poll()&lt;/code>ã€‚&lt;/p>
&lt;p>å½“&lt;code>poll()&lt;/code>è¿”å›åï¼Œæˆ‘ä»¬éœ€è¦éå†å…¶ä¸­çš„fdæ•°ç»„æ‰¾åˆ°å¯æ“ä½œçš„fdã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">pollfd&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> fd; &lt;span style="color:#75715e">/* file descriptor */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">short&lt;/span> events; &lt;span style="color:#75715e">/* requested events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">short&lt;/span> revents; &lt;span style="color:#75715e">/* returned events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥ä»&lt;code>events&lt;/code>å’Œ&lt;code>revents&lt;/code>è·å¾—è¯¥fdçš„çŠ¶æ€ï¼Œä»è€Œåˆ¤åˆ«å¯è¯»ã€å¯å†™ã€è¶…æ—¶æˆ–å‡ºé”™ã€‚&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨pollå‡½æ•°çš„IOå¤ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯æŠŠå®ƒåšä¸ºå¦ä¸€ä¸ªé˜»å¡IOè°ƒç”¨æ¥ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&lt;code>BlockTcpUtils::Open&lt;/code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†pollï¼Œç”¨æ¥ç›‘è§†ç›¸åº”çš„ï¼ˆä¸€ä¸ªï¼‰fdæ˜¯å¦å¯è¯»ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±éšå¼ï¼ˆä¸ºä»€ä¹ˆè¯´éšå¼å‘¢ï¼Œå› ä¸ºä»–ä»¬ä¸€ä¸å†™æ–‡æ¡£ï¼ŒäºŒä¸å†™æ³¨é‡Šï¼Œä¸€åˆ‡éƒ½æ˜¯æ½œè§„åˆ™ï¼‰è§„å®šäº†C/Säº¤äº’çš„åŸºæœ¬å·¥ä½œæµç¨‹ï¼šå½“C/Sè¿æ¥å»ºç«‹åï¼ŒServerç«¯è¦å…ˆè¯´è¯ï¼ŒClientç«¯æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œä¸‹é¢çš„æµç¨‹ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Clientï¼šâ€œä¸ç®¡ä½ ä»¬ä¿¡ä¸ä¿¡ï¼Œæ˜¯Serverå…ˆåŠ¨çš„æ‰‹ã€‚â€&lt;/p>&lt;/blockquote>
&lt;p>å…·ä½“ä¸ºä»€ä¹ˆå…ˆç”¨pollï¼Œå†æŠŠfdè®¾ä¸º&lt;code>blocking&lt;/code>çš„ï¼Œæˆ‘è¡¨ç¤ºäºŒè„¸æ‡µé€¼ã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œå³ä½¿æŠŠpollåˆ æ‰ï¼Œæµ‹è¯•ä»£ç ä¹Ÿæ˜¯å¯ä»¥workçš„ã€‚å¯èƒ½åœ¨åé¢çš„ä»£ç é˜…è¯»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥è·å¾—è§£é‡Šå§ã€‚&lt;/p>
&lt;p>å’Œselectä¸€æ ·ï¼Œpollä¹Ÿå­˜åœ¨è¢«ä¸­æ–­çš„æƒ…å†µï¼Œåœ¨phxrpcçš„ä»£ç é‡Œï¼Œæˆ‘ä»¬ç»™äº†ä¸­æ–­â€œa second chanceâ€ã€‚å½“pollè¢«ä¸­æ–­åï¼Œä¼šé‡æ–°å†pollä¸€æ¬¡ï¼›å¦‚æœè¿™æ¬¡å†è¢«ä¸­æ–­ï¼Œåˆ™ç›´æ¥è¿”å›TIMEOUTã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// retry again for EINTR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ret &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">::&lt;/span>poll(&lt;span style="color:#f92672">&amp;amp;&lt;/span>pfd, &lt;span style="color:#ae81ff">1&lt;/span>, timeout_ms);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> ret &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> EINTR &lt;span style="color:#f92672">==&lt;/span> errno)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">==&lt;/span> ret)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> errno &lt;span style="color:#f92672">=&lt;/span> ETIMEDOUT;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºè¿™ç¯‡æ–‡ç« ä¸­çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒæ‚ï¼Œå†™ä½œçš„é¡ºåºä¹Ÿæ˜¯éšæœºçš„ã€‚æ‰€ä»¥è¿è´¯æ€§ä¸æ˜¯é‚£ä¹ˆå¼ºã€‚å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¿ç€ç‚¹å§æ‚¨å°±ã€‚&lt;/p>
&lt;p>å¿ä¸äº†çš„è¯ã€‚ã€‚ã€‚é‚£å°±ç•™è¨€äº¤æµå§~&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/42112021.jpg" alt="">&lt;/p></description></item></channel></rss>