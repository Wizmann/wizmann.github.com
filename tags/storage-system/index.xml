<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Storage System on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/storage-system/</link><description>Recent content in Storage System on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Sun, 15 Aug 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/storage-system/index.xml" rel="self" type="application/rss+xml"/><item><title>è®ºæ–‡é˜…è¯»-WiscKeyï¼šSSDå‹å¥½çš„KVåˆ†ç¦»å­˜å‚¨å¼•æ“</title><link>https://wizmann.top/posts/paper-wisckey/</link><pubDate>Sun, 15 Aug 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paper-wisckey/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åŸºäºlsm-treeçš„å­˜å‚¨å¼•æ“">åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ &lt;a href="#%e5%9f%ba%e4%ba%8elsm-tree%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Log-Structed Merge-Tree (a.k.a. LSM-Tree)æ˜¯å½“ä¸‹å¸¸ç”¨çš„ä¸€ç§åŸºäºç£ç›˜çš„å­˜å‚¨å¼•æ“ã€‚ä¸Hashç´¢å¼•å’ŒB-TreeåŒä¸ºæ•°æ®åº“æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;p>LSM-Treeçš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>æ— éœ€å°†æ‰€æœ‰çš„Keyç´¢å¼•åœ¨å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡åˆ†çº§æŸ¥æ‰¾çš„æ–¹å¼ï¼ŒæŸ¥è¯¢åˆ°ç‰¹å®šKVåœ¨ç£ç›˜ä¸­çš„åç§»é‡&lt;/li>
&lt;li>æ•°æ®å†™å…¥ä¸åˆå¹¶ä½¿ç”¨é¡ºåºè¿½åŠ å†™ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨ç£ç›˜çš„é¡ºåºå†™æ€§èƒ½&lt;/li>
&lt;li>å¯¹äºæ•°æ®å†™å…¥ï¼Œä¼šä½¿ç”¨batchæ–¹å¼å†™å…¥ç£ç›˜&lt;/li>
&lt;li>æ”¯æŒèŒƒå›´æŸ¥è¯¢&lt;/li>
&lt;/ol>
&lt;p>LSM-Treeçš„åŠ£åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>è¯»æ”¾å¤§ä¸å†™æ”¾å¤§&lt;/li>
&lt;li>æ— æ³•å¯¹å•æ¡æ•°æ®åŠ é”ï¼ˆäº‹åŠ¡æ”¯æŒï¼‰&lt;/li>
&lt;/ol>
&lt;p>ç°åœ¨å¸¸ç”¨çš„LevelDBå’ŒRocksDBï¼Œéƒ½æ˜¯åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_18-00-50.png" alt="LSM-Tree-Architecture">&lt;/p>
&lt;h3 id="wisckeyä¸»è¦è§£å†³çš„é—®é¢˜">WiscKeyä¸»è¦è§£å†³çš„é—®é¢˜ &lt;a href="#wisckey%e4%b8%bb%e8%a6%81%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LSM-Treeåœ¨æ€§èƒ½ä¸Šé¢çš„ç“¶é¢ˆä¸»è¦åœ¨äºè¯»å†™çš„æ”¾å¤§ã€‚ç®€å•è¯´æ¥ï¼Œå‡è®¾ä½ çš„ç£ç›˜æœ€å¤§å¸¦å®½ä¸º4GB/sï¼Œè¯»å†™æ”¾å¤§å€æ•°ä¸º10ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨å±‚çš„æœ‰æ•ˆååé‡ï¼ˆ&lt;a href="https://en.wikipedia.org/wiki/Goodput">Goodput&lt;/a>ï¼‰æœ€å¤šåªèƒ½è¾¾åˆ°400MB/sã€‚å¹¶ä¸”ï¼Œå¯¹äºä¸€äº›å¤§æ•°æ®é›†ï¼Œè¯»å†™æ”¾å¤§çš„å€¼æœ‰å¯èƒ½ä¼šéå¸¸å¤§ï¼ˆå¤§äº100ï¼‰ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„è¯»å†™æ”¾å¤§å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹é¢åˆ†å¼€è®¨è®ºã€‚&lt;/p>
&lt;h4 id="è¯»æ”¾å¤§">è¯»æ”¾å¤§ &lt;a href="#%e8%af%bb%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹LSM-Treeçš„æŸ¥è¯¢æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆåœ¨mutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>ç„¶ååœ¨immutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>æœ€ååœ¨ä¸åŒçš„LSM-Treeå±‚çº§ä¸­çš„SST fileä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;/ol>
&lt;p>å¯¹äº1å’Œ2ï¼Œéƒ½æ˜¯å†…å­˜æ“ä½œï¼Œå…¶è€—æ—¶ä¸è¯»å–ç£ç›˜ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚
å¯¹äº3ï¼ŒSST fileæ–‡ä»¶çš„æŸ¥æ‰¾ä¼šå…ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å®šä½ç‰¹å®šKVä½äºè¯¥å±‚çš„å“ªä¸€ä¸ªSSTæ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVä¸å­˜åœ¨äºæ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šè¢«å¸¸é©»å†…å­˜çš„bloom filterè¿‡æ»¤æ‰ï¼Œä¸ä¼šçœŸæ­£çš„è¯»å–æ–‡ä»¶ã€‚ï¼ˆå¤§æ¦‚ç‡ï¼Œbloom filterçš„åŸç†äº†è§£ä¸€ä¸‹ï¼‰&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVåœ¨æ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šé€šè¿‡index blockè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œç¡®å®šKVä½äºå“ªä¸ªblockã€‚ç„¶åè¿™ä¸ªblockä¼šè¢«ä»ç£ç›˜ä¸Šè¯»å–åˆ°å†…å­˜è¿›è¡Œè§£å‹ï¼Œæœ€åé€šè¿‡äºŒåˆ†+éå†æ‰¾åˆ°å¯¹åº”çš„KVã€‚&lt;/p>
&lt;blockquote>
&lt;p>è®ºæ–‡é‡Œå¯¹äºè¯»æ”¾å¤§çš„è®¡ç®—æ–¹æ³•æœ‰ç‚¹å¤¸å¤§äº†ã€‚å¯¹äºRocksDBæ¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹index blockå’Œbloom filteréƒ½æ˜¯å¸¸é©»å†…å­˜çš„ã€‚é™¤éæ˜¯å†…å­˜éå¸¸ç´§å¼ çš„åœºæ™¯ï¼Œå¦åˆ™å¹¶ä¸ä¼šäº§ç”Ÿè®ºæ–‡ä¸­å¦‚æ­¤å¤¸å¼ çš„ç£ç›˜è¯»æ”¾å¤§çš„ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥è¯»æ”¾å¤§ä¸»è¦å› ä¸ºè¯»å–ä¸€ä¸ªKVï¼Œéœ€è¦è¯»å–+è§£å‹æ•´ä¸ªblockã€‚å½“KVå¤§å°è¿œå°äºblock sizeçš„æ—¶å€™ï¼Œé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ã€‚&lt;/p>
&lt;h4 id="å†™æ”¾å¤§">å†™æ”¾å¤§ &lt;a href="#%e5%86%99%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬å†é‡æ¸©ä¸€ä¸ªLSM-Treeçš„å†™å…¥æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆå†™å…¥mutable memtable&lt;/li>
&lt;li>mutable memtableåç»­ä¼šè¢«sealedï¼Œæˆä¸ºimmutable memtable&lt;/li>
&lt;li>immutable memtableä¼šè¢«flushåˆ°ç£ç›˜ï¼Œæˆä¸ºL0&lt;/li>
&lt;li>L0ä¸­çš„æ•°æ®ä¼šåœ¨åå°ï¼Œé€å±‚å‘ä¸‹åˆå¹¶ï¼Œç›´åˆ°åˆå¹¶åˆ°æœ€åº•å±‚&lt;/li>
&lt;/ol>
&lt;p>å±‚æ¬¡æ•°æ®é€å±‚å‘ä¸‹åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚ï¼ˆå…·ä½“åŸç†è¿™é‡Œä¸å±•å¼€äº†ï¼‰&lt;/p>
&lt;p>å†™æ”¾å¤§å€¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¼°ç®—ã€‚å·²çŸ¥&lt;code>options.max_bytes_for_level_multiplier&lt;/code>ä»£è¡¨æ¯ä¸€å±‚å¤§å°çš„å€æ•°kï¼Œå¹¶ä¸”å‡è®¾L0ä¸L1çš„å¤§å°ç›¸ç­‰ï¼Œæ€»å…±æœ‰Nå±‚ã€‚é‚£ä¹ˆå†™æ”¾å¤§çº¦ä¸º&lt;code>(N - 1) * k + 1&lt;/code>ã€‚&lt;/p>
&lt;h2 id="æ­£æ–‡">æ­£æ–‡ &lt;a href="#%e6%ad%a3%e6%96%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å…¥æ´»äº†å…¥æ´»äº†ï¼&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡ç›®æ ‡">WiscKeyçš„è®¾è®¡ç›®æ ‡ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>é™ä½å†™æ”¾å¤§&lt;/li>
&lt;li>é™ä½è¯»æ”¾å¤§&lt;/li>
&lt;li>å¯¹SSDè¿›è¡Œä¼˜åŒ–&lt;/li>
&lt;li>æä¾›LSM-Treeå…¼å®¹çš„API&lt;/li>
&lt;li>é’ˆå¯¹ç°å®åœºæ™¯çš„KV size&lt;/li>
&lt;/ul>
&lt;h3 id="wisckeyçš„è®¾è®¡æ€è·¯kvåˆ†ç¦»">WiscKeyçš„è®¾è®¡æ€è·¯â€”â€”KVåˆ†ç¦» &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%afkv%e5%88%86%e7%a6%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€èˆ¬çš„åœºæ™¯ä¸­ï¼Œåœ¨ä¸€å¯¹KVä¸­ï¼ŒKeyçš„å¤§å°è¿œæ¯”Valueçš„è¦å°ã€‚å¦‚æœæˆ‘ä»¬åœ¨LSM-Treeä¸­åªä¿ç•™Keyï¼Œé‚£ä¹ˆå¯¹äºä¸€æ¬¡è¯»å†™ï¼Œæˆ‘ä»¬æ‰€è¦å¤„ç†çš„æ•°æ®å°±ä¼šå°‘å¾ˆå¤šï¼Œä»è€Œé™ä½äº†è¯»å†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>å¯¹äºValueï¼Œæˆ‘ä»¬ä¼šå°†å…¶å­˜å‚¨åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„vLogä¸­ã€‚æ¯ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šåœ¨LSM-Treeä¸­è®°å½•å…¶åœ¨vLogä¸­çš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code> ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»å–Valueçš„æ“ä½œä¹Ÿåªæœ‰ä¸€æ¬¡ç£ç›˜è®¿é—®ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-08-54.png" alt="WiscKey-data-layout">&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœæŒ‰è®ºæ–‡é‡Œé¢çš„è®¾è®¡ï¼ŒvLogé‡Œé¢çš„æ•°æ®æ˜¯ä¸ä¼šæ‰“åŒ…çš„blockè¿›è¡Œå‹ç¼©çš„ï¼Œå¿…ç„¶ä¼šæŸå¤±capacityã€‚å¦‚æœæ‰“åŒ…å‹ç¼©äº†ï¼Œé‚£ä¹ˆè¯»æ”¾å¤§å¹¶æ²¡æœ‰æ˜¾è‘—ä¼˜åŒ–ã€‚åˆå¦‚æœvalue size â‰ˆ block sizeï¼Œé‚£ä¹ˆå…¶å®åœ¨è¯»æ”¾å¤§ä¸Šé¢çš„ä¼˜åŒ–ä¹Ÿå°±æ¯”è¾ƒå¾®å¼±äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡æŒ‘æˆ˜">WiscKeyçš„è®¾è®¡æŒ‘æˆ˜ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="å¹¶å‘èŒƒå›´æŸ¥æ‰¾">å¹¶å‘èŒƒå›´æŸ¥æ‰¾ &lt;a href="#%e5%b9%b6%e5%8f%91%e8%8c%83%e5%9b%b4%e6%9f%a5%e6%89%be" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å› ä¸ºä½¿ç”¨äº†KVåˆ†ç¦»çš„å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥æ‰¾ï¼ˆrange queryï¼‰å¯¹äºvalueå°±ä¼šé€€åŒ–æˆå¾ˆå¤šæ¬¡éšæœºè¯»å–ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç”±äºSSDçš„å¹¶å‘è¯»å–ç‰¹æ€§ï¼ŒWiscKeyä¼šå°†æ‰€éœ€è¦è¯»å–çš„valueçš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code>æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ‰€éœ€è¦çš„valueã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-42-44.png" alt="seq-rand-reads-on-ssd">&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œå¯¹äºè¾ƒå¤§çš„value sizeï¼Œé¡ºåºè¯»ä¸å¹¶å‘è¯»çš„throughputåŸºæœ¬ä¿æŒä¸€è‡´ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¤šçº¿ç¨‹å¹¶å‘è¯»ä¼šæ¶ˆè€—æ›´å¤šçš„CPUã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_16-02-21.png" alt="CPU-usage">&lt;/p>
&lt;blockquote>
&lt;p>ä¸è¿‡å¯¹äºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼ŒCPUå¤§æ¦‚æ˜¯æœ€ä¸é‡è¦çš„èµ„æºäº†å§ï¼ˆè§ä»è§æ™ºå’¯ï¼‰&lt;/p>&lt;/blockquote>
&lt;h4 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶ &lt;a href="#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¯¹äºé‡å¤å†™å…¥çš„KVï¼ŒLSM-Treeä¼šé€šè¿‡å±‚æ¬¡åˆå¹¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚è€ŒWiscKeyä¼šä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_00-11-06.png" alt="vlog-data-layout">&lt;/p>
&lt;p>vLogå¯ä»¥è§†ä½œä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ŒheadæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„å¼€å¤´ï¼ˆè¾ƒæ–°çš„æ•°æ®ï¼‰ï¼ŒtailæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„ç»“å°¾ï¼ˆè¾ƒæ—§çš„æ•°æ®ï¼‰ã€‚åœ¨headå’ŒtailæŒ‡é’ˆä¹‹å¤–çš„ç©ºé—´éƒ½è§†ä½œfree spaceã€‚&lt;/p>
&lt;p>å½“ç©ºé—²æ•°æ®å°äºä¸€å®šé˜ˆå€¼ä¹‹åï¼Œä¼šè§¦å‘GCã€‚WiscKeyä¼šä»tailä¾æ¬¡è¯»å‡ºä¸€éƒ¨åˆ†æ—§æ•°æ®ï¼ˆbatch readï¼‰ï¼ŒæŸ¥è¯¢LSM-Treeï¼Œå¦‚æœè¿™æ¡æ•°æ®å·²ç»è¢«è¦†ç›–æˆ–åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒæ­¤æ•°æ®ï¼›å¦åˆ™ä»headæŒ‡é’ˆå¤„å†™å…¥æ­¤æ¡æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¿è¯åœ¨GCè¿‡ç¨‹ä¸­çš„crashä¸äº§ç”Ÿæ•°æ®çš„ä¸¢å¤±ï¼ŒGCçš„æµç¨‹ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>å°†tailå¤„çš„KVå†™å…¥åˆ°headå¤„ï¼Œå¹¶è°ƒç”¨&lt;code>fsync()&lt;/code>å°†å…¶æŒä¹…åŒ–&lt;/li>
&lt;li>åŒæ­¥çš„å°†KVçš„æ–°ä½ç½®ï¼Œå’Œhead/tailæŒ‡é’ˆçš„æœ€æ–°ä½ç½®å†™å…¥LSM-Tree&lt;/li>
&lt;/ol>
&lt;p>ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†LSM-Treeçš„WALï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰åœ¨LSM-Treeé‡Œçš„æ•°æ®éƒ½æ˜¯å¯ç”¨çš„ã€‚&lt;/p>
&lt;h4 id="å´©æºƒä¸€è‡´æ€§crash-consistency">å´©æºƒä¸€è‡´æ€§ï¼ˆCrash Consistencyï¼‰ &lt;a href="#%e5%b4%a9%e6%ba%83%e4%b8%80%e8%87%b4%e6%80%a7crash-consistency" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨åƒåœ¾å›æ”¶ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»é‡åˆ°äº†ä¸€è‡´æ€§çš„é—®é¢˜ã€‚å…¶æ ¹æœ¬åŸå› ï¼Œåœ¨äºLSM-Treeå’ŒvLogæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¨¡å—ï¼Œåœ¨å…¶é—´ä¿æŒä¸€è‡´æ€§å¿…ç„¶æ˜¯å›°éš¾çš„ã€‚&lt;/p>
&lt;p>WiscKeyä½¿ç”¨äº†ç°ä»£æ–‡ä»¶ç³»ç»Ÿï¼ˆext4ï¼Œbtrfså’Œxfsï¼‰çš„ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§ï¼Œå³å¯¹äºä¸€ä¸ªï¼ˆå°†è¦ï¼‰å†™å…¥æ–‡ä»¶çš„æ•°æ®æµï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šä¿è¯è¿™ä¸ªæ•°æ®æµçš„ä¸€ä¸ªå‰ç¼€ï¼ˆæˆ–è€…æ•´ä¸ªæ•°æ®æµï¼‰æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„ä¼˜åŒ–">WiscKeyçš„ä¼˜åŒ– &lt;a href="#wisckey%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="vlogå†™å…¥buffer">vLogå†™å…¥Buffer &lt;a href="#vlog%e5%86%99%e5%85%a5buffer" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_12-20-02.png" alt="impact-of-write-unit-size">&lt;/p>
&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç£ç›˜çš„åŒæ­¥å†™å…¥å¿…ç„¶ä¼šå¸¦æ¥ä¸€äº›overheadã€‚å¯¹äºå°æ•°æ®æ¥è¯´ï¼Œè¿™åœ¨æ€§èƒ½ä¸Šä¼šäº§ç”Ÿä¸¥é‡çš„æŸè€—ã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„ä¼˜åŒ–ç±»ä¼¼äºå°†vLogä¹Ÿæ·»åŠ ä¸€ä¸ªmemory tableï¼Œæ‰€æœ‰å†™å…¥vLogçš„æ•°æ®éƒ½å…ˆå†™å…¥è¿™ä¸ªmemory tableï¼Œç„¶åä¾æ¬¡flushåˆ°ç£ç›˜ä¸Šã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä¼˜åŠ¿åœ¨äºå°†å†™å…¥batchåŒ–ï¼Œå¯ä»¥å‡å°‘overheadï¼Œæå‡æ€§èƒ½ã€‚åŠ£åŠ¿åœ¨äºï¼Œåœ¨ç³»ç»Ÿå´©æºƒæ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ã€‚ä½†ä¸¢å¤±æ•°æ®æ—¶ï¼Œä»èƒ½æŠ±è¯ä¸Šæ–‡æåˆ°çš„å´©æºƒä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h4 id="ä¼˜åŒ–lsm-tree-wal">ä¼˜åŒ–LSM-Tree WAL &lt;a href="#%e4%bc%98%e5%8c%96lsm-tree-wal" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>LSM-Treeçš„WALè™½ç„¶ä¿è¯äº†å†™å…¥çš„æ•°æ®çš„æŒä¹…æ€§ï¼Œä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œå®ƒä¹Ÿä¼šæ¶ˆè€—ç£ç›˜çš„ä¸€éƒ¨åˆ†å¸¦å®½ã€‚&lt;/p>
&lt;p>å…³é—­WALï¼Œæ„å‘³ç€LSM-Tree memtableåœ¨è¿›ç¨‹é‡å¯æ—¶ä¸€å®šä¼šä¸¢å¤±æ•°æ®ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨vLogé‡å»ºLSM-Treeï¼ˆçš„memtableéƒ¨åˆ†ï¼‰ã€‚&lt;/p>
&lt;p>ç”±äºvLogä¹‹ä¸­å·²ç»åŒ…æ‹¬äº†æ‰€æœ‰çš„KVå¯¹ï¼Œæ‰€ä»¥åœ¨WiscKeyé‡å¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»headæŒ‡é’ˆå¤„æ‰«ævLogçš„æ•°æ®ï¼Œç”±äºå´©æºƒä¸€è‡´æ€§çš„ä¿è¯ï¼Œå½“æŒ‡é’ˆæ‰«æåˆ°å·²ç»å­˜åœ¨äºLSM-Treeçš„æ•°æ®æ—¶ï¼Œå¯ä»¥è®¤ä¸ºLSM-Treeå·²ç»é‡å»ºæˆåŠŸã€‚&lt;/p>
&lt;h4 id="æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–">æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ– &lt;a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>WiscKeyä½¿ç”¨&lt;code>posix_fadvice()&lt;/code>å‘OSå±‚é¢„å£°æ˜æ¥ä¸‹æ¥vLogçš„æ“ä½œç±»å‹ä»¥é€‚åº”ä¸åŒåœºæ™¯çš„ç£ç›˜è®¿é—®æ¨¡å¼ã€‚ä½¿ç”¨&lt;code>fallocate()&lt;/code>ï¼Œé€šè¿‡&amp;quot;hole-punching&amp;quot;åŠŸèƒ½è¿›è¡ŒGCï¼Œä»¥å‡å°‘æ•°æ®çš„ç§»åŠ¨ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„æ€§èƒ½">WiscKeyçš„æ€§èƒ½ &lt;a href="#wisckey%e7%9a%84%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è®ºæ–‡çš„æœ€åç»™å‡ºäº†ä¸€ç³»åˆ—æ•°å­—ã€‚ç”±äºWiscKeyçš„è¯»å†™æ”¾å¤§å¾ˆå°ï¼Œæ‰€ä»¥åœ¨value sizeæ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼ˆ&amp;gt;= 1KBï¼‰ï¼Œæ€§èƒ½è¿œä¼˜äºä¼ ç»ŸLSM-Treeã€‚åŒæ—¶ï¼Œç£ç›˜ç©ºé—´çš„ä½¿ç”¨ä¹Ÿæ›´å‹å¥½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œè®ºæ–‡é‡Œåšmicrobenchmarkçš„æ—¶å€™ï¼Œå¯¹äºLevelDBå’ŒRocksDBï¼Œæ˜¯ä¸æ˜¯è¿˜å¼€ç€å‹ç¼©ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>WiscKeyåº”è¯¥æ˜¯â€œLSM-Tree + KVåˆ†ç¦»â€æ€è·¯çš„æ¯”è¾ƒæ—©æœŸçš„è®ºæ–‡ï¼Œå…¶ä¸­ä»æœ‰å¾ˆå¤šä¸æ˜ç¡®çš„ç»†èŠ‚ã€‚ä½†æ˜¯æ•´ä½“æ€è·¯æ˜¯å¯è¡Œçš„ã€‚&lt;/p>
&lt;p>PingCAPçš„&lt;a href="https://pingcap.com/zh/blog/titan-design-and-implementation">Titan&lt;/a>æ˜¯ä¸€ä¸ªåŸºäºWiscKeyæ€æƒ³çš„RocksDB KVåˆ†ç¦»å­˜å‚¨å¼•æ“ã€‚åç»­å¯ä»¥å‚è€ƒå…¶å®ç°å†äº†è§£æ›´å¤šçš„å®ç°æ€è·¯ä¸ç»†èŠ‚ã€‚&lt;/p></description></item><item><title>Introduction to Ceph</title><link>https://wizmann.top/posts/introduction-to-ceph/</link><pubDate>Sun, 29 Nov 2020 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/introduction-to-ceph/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯ceph">ä»€ä¹ˆæ˜¯Ceph &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afceph" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Cephæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚æä¾›äº†ä¸‰ç§ä¸åŒç±»å‹çš„æ¥å£ä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>block-based: å—å­˜å‚¨ï¼Œå¯ä»¥ç”¨åšVMçš„è™šæ‹Ÿç£ç›˜&lt;/li>
&lt;li>object-based: å¯¹è±¡å­˜å‚¨ï¼Œä¸Amazon S3ç­‰å¸¸ç”¨å¯¹è±¡å­˜å‚¨å…¼å®¹&lt;/li>
&lt;li>file system: POSIXå…¼å®¹çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥è¢«æœ¬åœ°ç³»ç»ŸæŒ‚è½½ï¼Œå¹¶ä¸”èƒ½è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-04-49.png" alt="">&lt;/p>
&lt;h3 id="cephçš„ç‰¹æ€§">Cephçš„ç‰¹æ€§ &lt;a href="#ceph%e7%9a%84%e7%89%b9%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºé‡‡ç”¨äº†CRUSHç®—æ³•ï¼ŒCephæœ‰ç€ä¼˜å¼‚çš„å¯æ‰©å±•æ€§ï¼ˆå®£ç§°å¯ä»¥æ— é™æ‰©å±•ï¼‰ã€‚å¹¶ä¸”å€ŸåŠ©å¯æ‰©å±•æ€§ï¼Œè¿›è€Œå®ç°é«˜æ€§èƒ½ã€é«˜å¯é æ€§å’Œé«˜å¯ç”¨æ€§ã€‚&lt;/p>
&lt;p>Cephæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„å­˜å‚¨ç³»ç»Ÿï¼Œæ— éœ€ä¸­å¿ƒèŠ‚ç‚¹è¿›è¡Œèµ„æºçš„ç®¡ç†ä¸è°ƒåº¦ï¼Œå…¨éƒ¨çš„ç®¡ç†åŠŸèƒ½ç”±å­˜å‚¨èŠ‚ç‚¹è‡ªæ²»å®Œæˆã€‚ä½¿å¾—æ•´ä¸ªç³»ç»Ÿå¯ä»¥è‡ªæˆ‘ç®¡ç†ä¸è‡ªæˆ‘æ¢å¤ï¼Œå‡å°‘è¿ç»´æˆæœ¬ä¸ç®¡ç†æˆæœ¬ã€‚&lt;/p>
&lt;h2 id="rados---cephçš„å­˜å‚¨å¼•æ“">RADOS - Cephçš„å­˜å‚¨å¼•æ“ &lt;a href="#rados---ceph%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>RADOS=Reliable Autonomic Distributed Object Storeã€‚RADOSæ˜¯Cephåº•å±‚çš„å­˜å‚¨å¼•æ“ï¼Œæ‰€æœ‰çš„æ¥å£éƒ½å»ºç«‹åœ¨RADOSçš„åŠŸèƒ½ä¹‹ä¸Šã€‚&lt;/p>
&lt;h3 id="radosä¸­çš„å­˜å‚¨ç»“æ„">RADOSä¸­çš„å­˜å‚¨ç»“æ„ &lt;a href="#rados%e4%b8%ad%e7%9a%84%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-24-56.png" alt="">&lt;/p>
&lt;ul>
&lt;li>å­˜å‚¨æ± ï¼ˆpoolï¼‰ï¼šé€»è¾‘å±‚ï¼Œæ¯ä¸€ä¸ªpoolé‡Œéƒ½åŒ…å«ä¸€äº›æ”¾ç½®ç»„&lt;/li>
&lt;li>æ”¾ç½®ç»„ï¼ˆplacement-group, PG)ï¼šé€»è¾‘å±‚ï¼Œä¸€ä»½æ•°æ®ä¼šåœ¨PGå½“ä¸­è¿›è¡Œç¾å¤‡å¤åˆ¶ã€‚æ¯ä¸€ä¸ªPGéƒ½å¯¹åº”ç€ä¸€ç³»åˆ—çš„å­˜å‚¨èŠ‚ç‚¹&lt;/li>
&lt;li>å­˜å‚¨èŠ‚ç‚¹ï¼ˆOSDï¼‰ï¼šç”¨ä»¥å­˜å‚¨æ•°æ®çš„ç‰©ç†èŠ‚ç‚¹ã€‚ä¸PGä¹‹é—´å½¢æˆå¤šå¯¹å¤šçš„å…³ç³»ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä»½æ•°æ®åœ¨å†™å…¥RADOSæ—¶ï¼Œä¼šå…ˆé€‰ä¸­ä¸€ä¸ªpoolã€‚Poolä¸­å†ä½¿ç”¨ä¸€å®šçš„hashè§„åˆ™ï¼Œä¼ªéšæœºçš„é€‰ä¸­æŸä¸€ä¸ªPGã€‚PGä¼šå°†æ•°æ®å†™å…¥å¤šä¸ªOSDä¸­ã€‚è¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„è§„åˆ™ã€‚&lt;/p>
&lt;p>Poolæ˜¯ç”¨æˆ·å¯è§çš„ç®¡ç†æ•°æ®çš„åŸºæœ¬å•ä½ï¼Œç”¨æˆ·å¯ä»¥å¯¹Poolè¿›è¡Œä¸€ç³»åˆ—çš„é…ç½®ï¼ˆæƒé™æ§åˆ¶ã€ä½¿ç”¨SSD or HDDã€ä½¿ç”¨æ•°æ®æ‹·è´ or çº åˆ ç ï¼Œetc.ï¼‰ã€‚è€ŒPGä¸OSDå¯¹äºç”¨æˆ·æ˜¯ä¸å¯è§çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_23-00-51.png" alt="">&lt;/p>
&lt;h4 id="pgçš„ç»„ç»‡">PGçš„ç»„ç»‡ &lt;a href="#pg%e7%9a%84%e7%bb%84%e7%bb%87" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨ä¸€è‡´æ€§å“ˆå¸Œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨èŠ‚ç‚¹æ¥åˆ’åˆ†å“ˆå¸Œå€¼åŸŸã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœäº§ç”Ÿäº†æ•°æ®ä¸å¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è¿›è¡Œåˆ’åˆ†å€¼åŸŸæ¥è¿›è¡Œå†å¹³è¡¡ã€‚è¿™ä¼šé€ æˆå¤§é‡çš„æ•°æ®è¿ç§»ã€‚&lt;/p>
&lt;p>CRUSHé‡‡ç”¨äº†è™šæ‹ŸèŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯PGï¼‰å°†å“ˆå¸Œå€¼åŸŸåˆ’åˆ†æˆäº†å›ºå®šçš„ç­‰é•¿åŒºåŸŸã€‚è¿™ç§æ–¹æ³•åœ¨å•æ¡æ•°æ®ä¸ç‰©ç†èŠ‚ç‚¹ä¹‹é—´åŠ å…¥äº†ä¸€ä¸ªè™šæ‹Ÿå±‚ã€‚ä¹‹åï¼Œå†ä½¿ç”¨å“ˆå¸Œå–æ¨¡çš„ç®—æ³•ç¡®å®šæ•°æ®å±äºå“ªä¸ªPGã€‚ä½¿å¾—æ•°æ®çš„è¿ç§»æ˜¯ä»¥è™šæ‹ŸèŠ‚ç‚¹ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸€æ¡æ•°æ®éƒ½é‡æ–°è®¡ç®—ã€‚Cephå®˜æ–¹çš„å»ºè®®æ˜¯ï¼Œæ¯1ä¸ªOSDå¯¹åº”ç€100ä¸ªPGã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨è§„åˆ’çš„åˆæœŸéœ€è¦ç¡®å®šPGçš„æ•°ç›®ï¼Œå¦‚æœåæœŸéœ€è¦è°ƒæ•´PGï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œç”šè‡³éœ€è¦æœåŠ¡æš‚æ—¶åœæ­¢æœåŠ¡ã€‚&lt;/p>
&lt;h3 id="ç›‘æ§å­é›†ç¾¤monä¸cluster-map">ç›‘æ§å­é›†ç¾¤ï¼ˆMONï¼‰ä¸Cluster Map &lt;a href="#%e7%9b%91%e6%8e%a7%e5%ad%90%e9%9b%86%e7%be%a4mon%e4%b8%8ecluster-map" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-48-10.png" alt="">&lt;/p>
&lt;p>RADOSé›†ç¾¤ä¸­é™¤äº†OSDå­˜å‚¨èŠ‚ç‚¹ä¹‹å¤–ï¼Œè¿˜æœ‰ç›‘æ§å­é›†ç¾¤ï¼ˆMONï¼‰ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿçš„æ‹“æ‰‘ç»“æ„â€”â€”Cluster Mapã€‚&lt;/p>
&lt;blockquote>
&lt;p>å…ƒæ•°ç»„ç®¡ç†ï¼ˆMDSï¼‰èŠ‚ç‚¹ç”¨äºç®¡ç†CephFSä¸­çš„æ–‡ä»¶å…ƒä¿¡æ¯ï¼Œåæ–‡ä¼šæœ‰ä»‹ç»ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ä¸åŒäºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–ç®¡ç†èŠ‚ç‚¹ï¼ŒMONå¹¶ä¸ä¼šå¯¹èµ„æºè¿›è¡Œè°ƒé…ä¸è°ƒåº¦ï¼Œè€Œä»…ä»…æ˜¯ä¸€ä¸ªè§‚æµ‹è€…ï¼Œç”¨ä»¥å­˜å‚¨ç³»ç»Ÿå½“å‰çš„æ‹“æ‰‘ä¸çŠ¶æ€ã€‚&lt;/p>
&lt;p>MONä¸OSDã€OSDä¸OSDä¹‹é—´ä¼šå®šæ—¶å‘é€å¿ƒè·³åŒ…ï¼Œæ£€æµ‹OSDæ˜¯å¦å¥åº·ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹å¤±æ•ˆï¼ŒMONä¼šæ›´æ–°å†…éƒ¨å­˜å‚¨çš„æ‹“æ‰‘ç»“æ„ä¿¡æ¯ï¼ˆClusterMapï¼‰ï¼Œå¹¶ä¸”é€šè¿‡P2Påè®®å¹¿æ’­å‡ºå»ï¼Œä»è€Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿéƒ½æœ‰ç€ï¼ˆæœ€ç»ˆï¼‰ä¸€è‡´çš„æ‹“æ‰‘ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="ä¸»ä»åŒæ­¥ä¸èŠ‚ç‚¹è‡ªæ²»">ä¸»ä»åŒæ­¥ä¸èŠ‚ç‚¹è‡ªæ²» &lt;a href="#%e4%b8%bb%e4%bb%8e%e5%90%8c%e6%ad%a5%e4%b8%8e%e8%8a%82%e7%82%b9%e8%87%aa%e6%b2%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€ä¸ªPGä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ•°æ®å¤åˆ¶ï¼ˆreplicationï¼‰ã€å¤±æ•ˆæ£€æµ‹ï¼ˆfailure detectionï¼‰å’Œå¤±æ•ˆæ¢å¤ï¼ˆfailure recoveryï¼‰ã€‚&lt;/p>
&lt;h2 id="crush---cephçš‡å† ä¸Šçš„æ˜ç ">CRUSH - Cephçš‡å† ä¸Šçš„æ˜ç  &lt;a href="#crush---ceph%e7%9a%87%e5%86%a0%e4%b8%8a%e7%9a%84%e6%98%8e%e7%8f%a0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>CRUSHæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œä¼ªéšæœºçš„æ•°æ®æ”¾ç½®ç®—æ³•ã€‚ä»¥å»ä¸­å¿ƒåŒ–æ–¹æ³•ï¼Œå°†PGæŒ‰è§„åˆ™æ˜ å°„åˆ°ç›¸åº”çš„å­˜å‚¨è®¾å¤‡ä¸Šã€‚å¹¶ä¸”ç³»ç»Ÿçš„æ‹“æ‰‘ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°½å¯èƒ½çš„å‡å°‘æ•°æ®çš„è¿ç§»ã€‚&lt;/p>
&lt;h3 id="crushçš„ä¼˜åŠ¿">CRUSHçš„ä¼˜åŠ¿ &lt;a href="#crush%e7%9a%84%e4%bc%98%e5%8a%bf" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CRUSHå¯¹äºæ¯ä¸€ä¸ªæ•°æ®å…ƒç´ ä½¿ç”¨ä¸€ä¸ªä¼ªéšæœºç®—æ³•ï¼Œå†³å®šå…¶æ”¾ç½®çš„ä½ç½®ã€‚æ‰€ä»¥ï¼Œåªè¦æ‰€æœ‰å‚ä¸è€…éƒ½æ‹¥æœ‰ç›¸åŒçš„ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ä¿¡æ¯ï¼Œé‚£ä¹ˆæ•°æ®çš„ä½ç½®å°±æ˜¯ä¸€å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œé‡‡ç”¨P2Pçš„æ–¹æ³•æ¥è¿›è¡Œæ•°æ®çš„å­˜å‚¨ä¸æ£€ç´¢ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ï¼Œç”±äºä¼ªéšæœºç®—æ³•åªä¸å•ä¸ªPGç›¸å…³ï¼Œå¦‚æœæˆ‘ä»¬æ“ä½œå¾—å½“ï¼ŒèŠ‚ç‚¹æ•°é‡çš„å˜åŒ–å¹¶ä¸ä¼šå¼•èµ·å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œè€Œæ˜¯ä¼šæ¥è¿‘ç†è®ºæœ€ä¼˜å€¼ã€‚&lt;/p>
&lt;h3 id="æ•°æ®æ”¾ç½®data-placement">æ•°æ®æ”¾ç½®ï¼ˆData Placementï¼‰ &lt;a href="#%e6%95%b0%e6%8d%ae%e6%94%be%e7%bd%aedata-placement" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CRUSHçš„æ•°æ®æ”¾ç½®ç®—æ³•æœ‰å¾ˆå¤šä¸åŒçš„å®ç°ï¼Œè¿™é‡Œåªä»‹ç»æœ€å¸¸ç”¨çš„strawç®—æ³•ã€‚&lt;/p>
&lt;p>Cephä¸­ï¼Œæ¯ä¸€ä¸ªOSDèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼wï¼Œä»£è¡¨ç€æŸä¸ªèŠ‚ç‚¹èƒ½æ”¯æŒå¤šå°‘æ•°æ®çš„å­˜å‚¨ä¸æ£€ç´¢ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæƒå€¼ä¸èŠ‚ç‚¹çš„å®¹é‡æˆæ­£æ¯”ã€‚&lt;/p>
&lt;p>å‡è®¾ä¸€ä¸ªpoolé‡Œé¢æœ‰nä¸ªPGï¼Œåœ¨ä¸€æ¡æ–°çš„æ•°æ®å†™å…¥æ—¶ï¼Œæˆ‘ä»¬åˆ†åˆ«ä¼šè®¡ç®—è¿™nä¸ªPGçš„lengthå€¼ã€‚&lt;/p>
&lt;p>$$ length_{i} = f(w_{i}) * hash(x) $$&lt;/p>
&lt;p>$f(w_{i})$æ˜¯ä¸€ä¸ªåªäºå½“å‰OSDèŠ‚ç‚¹æƒå€¼æœ‰å…³çš„å‡½æ•°ã€‚$hash(x)$ä»£è¡¨å½“å‰PGçš„å“ˆå¸Œå€¼ã€‚æ‰€ä»¥ï¼ŒPGä¼šæ”¾ç½®åœ¨å“ªä¸ªOSDä¸Šï¼Œä»…ä¸å…¶æƒå€¼ç›¸å…³ã€‚&lt;/p>
&lt;p>å‡è®¾æŸä¸ªOSDèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ–°åŠ ã€åˆ é™¤ã€æƒå€¼å˜åŒ–ï¼‰ï¼Œåœ¨æ­¤å—å½±å“èŠ‚ç‚¹çš„æ•°æ®ä¼šè¿ç§»åˆ°å…¶å®ƒçš„OSDèŠ‚ç‚¹ã€‚å…¶å®ƒOSDèŠ‚ç‚¹çš„åŸæœ‰æ•°æ®å¹¶ä¸ä¼šå—åˆ°å½±å“ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Cephå½“ä¸­çš„strawç®—æ³•æœ‰&lt;code>straw1&lt;/code>å’Œ&lt;code>straw2&lt;/code>ã€‚&lt;code>straw1&lt;/code>çš„å®ç°é‡‡ç”¨äº†æœ‰ç¼ºé™·f(w)å‡½æ•°ï¼Œä¼šå¯¼è‡´æ„å¤–çš„æ•°æ®è¿ç§»ã€‚&lt;code>straw2&lt;/code>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
è¯¦æƒ…è¯·æˆ³&lt;a href="https://www.spinics.net/lists/ceph-devel/msg21635.html">è¿™é‡Œ&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h4 id="ä¸»ä»æ¶æ„">ä¸»ä»æ¶æ„ &lt;a href="#%e4%b8%bb%e4%bb%8e%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ¯ä¸ªPGæ‰€åŒ…å«çš„OSDéƒ½ç”±CRUSHç®—æ³•è®¡ç®—å¾—å‡ºï¼Œå¹¶æ ¹æ®é…ç½®é€‰å‡ºå‰rä¸ªOSDè¿›è¡Œä¸»ä»é…å¯¹ã€‚åˆ—è¡¨ä¸­çš„ç¬¬1ä¸ªOSDåšä¸ºä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰ï¼Œå…¶å®ƒçš„èŠ‚ç‚¹ä¸ºä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰ã€‚&lt;/p>
&lt;p>ä¸»ä»èŠ‚ç‚¹çš„åˆ†é…ä¸ç®¡ç†ç”±PGå†…éƒ¨è¿›è¡Œè‡ªæ²»ï¼Œä¸éœ€è¦é¢å¤–çš„å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;h2 id="cephfs">CephFS &lt;a href="#cephfs" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>CephFSæ˜¯ä¸€ä¸ªPOSIXå…¼å®¹çš„ï¼ˆå…±äº«ï¼‰æ–‡ä»¶ç³»ç»Ÿã€‚CephFSåˆ©ç”¨æ–‡ä»¶å…ƒæ•°æ®å­ç³»ç»Ÿï¼ˆMDSï¼‰æ¥ç»´æŠ¤ç›®å½•æ ‘ç»“æ„å’Œæ–‡ä»¶å’Œç›®å½•çš„å…ƒä¿¡æ¯ï¼ˆowner, timestamps, inodes, etc.)ç­‰ã€‚&lt;/p>
&lt;p>MDSå­ç³»ç»Ÿä¼šåœ¨å†…å­˜é‡Œé¢ç»´æŠ¤ä¸€ä»½Cacheï¼Œå¯¹äºéœ€è¦æŒä¹…åŒ–çš„ä¿¡æ¯ï¼Œä¼šä½¿ç”¨WALçš„æ–¹å¼å†™å…¥RADOSé‡Œä¸€ä¸ªä¸“ç”¨çš„Poolå½“ä¸­ã€‚&lt;/p>
&lt;h3 id="åŠ¨æ€æ ‘åˆ’åˆ†dynamic-tree-partitioningdtp">åŠ¨æ€æ ‘åˆ’åˆ†ï¼ˆDynamic Tree Partitioningï¼ŒDTPï¼‰ &lt;a href="#%e5%8a%a8%e6%80%81%e6%a0%91%e5%88%92%e5%88%86dynamic-tree-partitioningdtp" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CephFSçš„æ‰©å±•æ€§çš„å…³é”®ä¹‹ä¸€ï¼Œåœ¨äºå…ƒä¿¡æ¯å­ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚CephFSå®ç°äº†åŠ¨æ€æ ‘åˆ’åˆ†çš„ç®—æ³•ï¼Œå°†ç›®å½•æ ‘ç»“æ„æ ¹æ®å½“å‰ç³»ç»Ÿçš„è´Ÿè½½ï¼Œå°†å…¶åˆ’åˆ†åˆ°ä¸åŒçš„MDSèŠ‚ç‚¹ä¸Šå»ã€‚&lt;/p>
&lt;p>ç»´æŠ¤ç›®å½•æ ‘ç»“æ„çš„ä¼˜åŠ¿åœ¨äºåˆ©ç”¨äº†æ–‡ä»¶ç³»ç»Ÿçš„å±€éƒ¨æ€§ï¼ˆlocalityï¼‰ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œé¢„å–ï¼ˆprefetchï¼‰ã€‚åŠ¨æ€çš„æ ‘åˆ’åˆ†ï¼Œå¯ä»¥ä¿è¯å…ƒä¿¡æ¯å¯ä»¥çº¿æ€§å¢é•¿ï¼Œä»¥ä¿æŒé«˜å¯æ‰©å±•æ€§ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-29/2020-11-29_18-53-09.png" alt="">&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ¬æ–‡åŸºäºCephçš„ä¸‰ç¯‡è®ºæ–‡ç»¼åˆè€Œæˆï¼ˆCephFSã€RADOSã€CRUSHï¼‰ã€‚å…¶ä¸­åŠ å…¥äº†ä¸€äº›è‡ªå·±çš„çœ‹æ³•ï¼Œä½¿å…¶é€»è¾‘é€šé¡ºï¼Œå¹¶ä¸ä¿è¯ä¸è®ºæ–‡çš„æ€è·¯å®Œå…¨ä¸€è‡´ã€‚&lt;/p>
&lt;p>è¿™ä¸‰ç¯‡è®ºæ–‡å¹¶æ²¡æœ‰æ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œæ¢å¥è¯è¯´ï¼Œéœ€è¦ç»¼åˆé˜…è¯»ï¼Œæ‰èƒ½æœ‰æ¯”è¾ƒæ˜ç¡®çš„ç†è§£ã€‚&lt;/p>
&lt;p>å»ºè®®åœ¨é€šè¯»è®ºæ–‡åï¼Œå»å­¦ä¹ ä¸€ä¸‹&lt;a href="https://www.youtube.com/watch?v=PmLPbrf-x9g&amp;amp;ab_channel=Ceph">è¿™ä¸ªè§†é¢‘&lt;/a>ï¼Œä¼šå¯¹ç†è§£Cephæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚Youtubeä¸Šé¢è¿˜æœ‰å¾ˆå¤šCephçš„tech talkï¼Œå¯ä»¥ä¸€å¹¶çš„äº†è§£ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>Cephç›¸å…³çš„ä¹¦ç±ä»¥å®è·µå±…å¤šï¼Œåªæ¨è&lt;a href="https://www.oreilly.com/library/view/learning-ceph-/9781787127913/">Learning Ceph&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://crossoverjie.top/2018/01/08/Consistent-Hash/">ä¸€è‡´æ€§ Hash ç®—æ³•åˆ†æ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/60963885">ä»ä¸€è‡´æ€§ hash åˆ° ceph crush&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://ceph.io/publications/">Ceph Publications&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>