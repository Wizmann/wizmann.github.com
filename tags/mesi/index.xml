<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>MESI on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/mesi/</link><description>Recent content in MESI on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Mon, 18 Mar 2024 23:21:35 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/mesi/index.xml" rel="self" type="application/rss+xml"/><item><title>CPUç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜ä¸€è‡´æ€§ï¼ˆç¬¬ä¸€éƒ¨åˆ†-MESIåè®®ï¼‰</title><link>https://wizmann.top/posts/cache-coherence-and-memory-order/</link><pubDate>Mon, 18 Mar 2024 23:21:35 +0000</pubDate><guid>https://wizmann.top/posts/cache-coherence-and-memory-order/</guid><description>&lt;p>åœ¨å¯¹ç§°å¤šå¤„ç†ç³»ç»Ÿï¼ˆSymmetric Multiprocessing, SMPï¼‰ä¸­ï¼Œä¸€ä¸ªå˜é‡ï¼ˆæˆ–å†…å­˜ä½ç½®ï¼‰å¯ä»¥åŒæ—¶å­˜åœ¨äºå¤šä¸ªCPUçš„ç¼“å­˜è¡Œä¸­ã€‚ä¸ºäº†æä¾›å®Œç¾çš„ç”¨æˆ·çº§æŠ½è±¡ï¼Œä»»ä½•å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡çš„ä¿®æ”¹éƒ½åº”è¯¥è¢«å¼ºåˆ¶åŒæ­¥ï¼Œä»¥ç¡®ä¿å…¶å®ƒCPUçš„ç¼“å­˜å¾—åˆ°æ›´æ–°ã€‚
ç„¶è€Œï¼Œåœ¨å®ç°ä¸Šï¼Œç”±äºCPUä¹‹é—´é€šå¸¸é€šè¿‡æ€»çº¿äº’è”ï¼Œå®ƒä»¬ä¸èƒ½åŒæ—¶å¯¹å¤šä¸ªç¼“å­˜è¿›è¡Œå†™æ“ä½œã€‚&lt;/p>
&lt;h3 id="ç¼“å­˜ä¸€è‡´æ€§">ç¼“å­˜ä¸€è‡´æ€§ &lt;a href="#%e7%bc%93%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç¼“å­˜ä¸€è‡´æ€§æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œç¡®ä¿å½“æŸä¸ªå¤„ç†å™¨ä¿®æ”¹äº†å­˜å‚¨åœ¨å…±äº«èµ„æºï¼ˆå¦‚ä¸»å†…å­˜æˆ–ç¼“å­˜ä¸­çš„æ•°æ®ï¼‰æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨èƒ½å¤Ÿè®¿é—®åˆ°æœ€æ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®æ ‡ï¼Œç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶å¿…é¡»å¤„ç†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼šå†™ä¼ æ’­ï¼ˆWrite Propagationï¼‰å’Œäº‹åŠ¡ä¸²è¡ŒåŒ–ï¼ˆTransaction Serializationï¼‰ã€‚&lt;/p>
&lt;p>å†™ä¼ æ’­ç¡®ä¿ä¸€ä¸ªå¤„ç†å™¨æ ¸å¿ƒçš„å†™æ“ä½œèƒ½è¢«ä¼ æ’­å¹¶è¢«å…¶ä»–å¤„ç†å™¨æ ¸å¿ƒæ‰€è§ã€‚è€Œäº‹åŠ¡ä¸²è¡ŒåŒ–åˆ™ç¡®ä¿æ‰€æœ‰å¤„ç†å™¨æ ¸å¿ƒçš„å†™æ“ä½œæŒ‰ç…§ä¸€å®šçš„é¡ºåºæ‰§è¡Œï¼Œå¯¹æ‰€æœ‰å¤„ç†å™¨æ ¸å¿ƒè€Œè¨€è¿™ä¸ªé¡ºåºæ˜¯ä¸€è‡´çš„ã€‚è¿™ä¸¤ä¸ªæœºåˆ¶å…±åŒå·¥ä½œï¼Œç¡®ä¿äº†å³ä½¿å¤šä¸ªCPUå¯èƒ½å¹¶å‘åœ°ä¿®æ”¹åŒä¸€ä»½æ•°æ®ï¼Œå®ƒä»¬ä¹Ÿèƒ½çœ‹åˆ°ä¸€è‡´çš„æ•°æ®è§†å›¾ã€‚&lt;/p>
&lt;h3 id="mesiåè®®">MESIåè®® &lt;a href="#mesi%e5%8d%8f%e8%ae%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸ºäº†å®ç°ç¼“å­˜ä¸€è‡´æ€§ï¼Œå¤šç§åè®®å’Œæœºåˆ¶è¢«è®¾è®¡å‡ºæ¥ï¼Œå…¶ä¸­MESIåè®®æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å®é™…ä¸Šï¼ŒAMDå¤„ç†å™¨ä½¿ç”¨çš„æ˜¯MOESIåè®®ï¼ŒIntelå¤„ç†å™¨ä½¿ç”¨çš„æ˜¯MESIFåè®®ã€‚è¿™ä¸¤ç§åè®®éƒ½æ˜¯MESIåè®®çš„å˜ç§ã€‚è¿™é‡Œä¸å±•å¼€è®¨è®ºã€‚&lt;/p>&lt;/blockquote>
&lt;p>MESI åè®®é€šè¿‡å®šä¹‰ç¼“å­˜è¡Œçš„å››ç§çŠ¶æ€â€”â€”ä¿®æ”¹ï¼ˆModifiedï¼‰ã€ç‹¬å ï¼ˆExclusiveï¼‰ã€å…±äº«ï¼ˆSharedï¼‰å’Œæ— æ•ˆï¼ˆInvalidï¼‰ï¼Œç®¡ç†å¤šä¸ªå¤„ç†å™¨ç¼“å­˜ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å—åˆ°ç¼“å­˜åè®®æ§åˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’ŒåŒæ­¥ã€‚&lt;/p>
&lt;ul>
&lt;li>ç‹¬å ï¼ˆExclusive, Eï¼‰ï¼šç¼“å­˜è¡Œä»…å­˜åœ¨äºå½“å‰ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ˜¯å¹²å‡€çš„ï¼ˆå³ç¼“å­˜æ•°æ®ä¸ä¸»å­˜æ•°æ®ä¸€è‡´ï¼‰ã€‚å½“å…¶ä»–ç¼“å­˜å°è¯•è¯»å–è¯¥æ•°æ®æ—¶ï¼ŒçŠ¶æ€è½¬å˜ä¸ºå…±äº«ï¼›å½“å‰ç¼“å­˜å†™å…¥æ•°æ®æ—¶ï¼Œè½¬å˜ä¸ºå·²ä¿®æ”¹çŠ¶æ€&lt;/li>
&lt;li>å…±äº«ï¼ˆShared, Sï¼‰ï¼šç¼“å­˜è¡ŒåŒæ—¶å­˜åœ¨äºå…¶ä»–ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ˜¯å¹²å‡€çš„ã€‚è¯¥ç¼“å­˜è¡Œå¯ä»¥åœ¨ä»»æ„æ—¶åˆ»è¢«æŠ›å¼ƒ&lt;/li>
&lt;li>å·²ä¿®æ”¹ï¼ˆModified, Mï¼‰ï¼šç¼“å­˜è¡Œçš„æ•°æ®æ˜¯â€œè„â€çš„ï¼ˆå³ä¸ä¸»å­˜çš„å€¼ä¸åŒï¼‰ã€‚å¦‚æœå…¶ä»– CPU æ ¸å¿ƒéœ€è¦è¯»å–è¿™å—æ•°æ®ï¼Œè¯¥ç¼“å­˜è¡Œå¿…é¡»å…ˆå›å†™åˆ°ä¸»å­˜ï¼Œç„¶åçŠ¶æ€è½¬å˜ä¸ºå…±äº«&lt;/li>
&lt;li>æ— æ•ˆï¼ˆInvalid, Iï¼‰ï¼šè¡¨ç¤ºè¯¥ç¼“å­˜è¡Œæ— æ•ˆï¼Œå³ä¸ºç©ºã€‚ä¸Šæ–‡æåˆ°çš„ç¼“å­˜ç­–ç•¥ä¼šä¼˜å…ˆå¡«å……æ— æ•ˆè¡Œ&lt;/li>
&lt;/ul>
&lt;p>ç®€å•æ¥è¯´ï¼ŒMESIçš„è®¾è®¡ç›®æ ‡åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>é˜²æ­¢å¤šä¸ªå¤„ç†å™¨æ ¸å¿ƒåŒæ—¶å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä»»ä½•éœ€è¦ä¿®æ”¹å…±äº«æ•°æ®çš„æ ¸å¿ƒéƒ½ä¼šå…ˆå‘å‡ºRFOï¼ˆRead For Ownershipï¼‰è¯·æ±‚æ¥è·å–è¯¥ç¼“å­˜å—çš„æ‰€æœ‰æƒï¼Œå¹¶ä½¿å…¶ä»–å¤„ç†å™¨æ ¸å¿ƒä¸­çš„ç›¸åº”ç¼“å­˜å—å˜ä¸ºæ— æ•ˆã€‚&lt;/li>
&lt;li>é€šè¿‡æ¨è¿Ÿå†™å›æ“ä½œæ¥å‡å°‘å¯¹å†…å­˜çš„é¢‘ç¹ä¿®æ”¹ï¼Œç¡®ä¿åªæœ‰åœ¨å¿…è¦æ—¶æ‰å°†ç¼“å­˜ä¸­çš„æ›´æ”¹å†™å›å†…å­˜ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="mesi-çš„çŠ¶æ€è½¬ç§»">MESI çš„çŠ¶æ€è½¬ç§» &lt;a href="#mesi-%e7%9a%84%e7%8a%b6%e6%80%81%e8%bd%ac%e7%a7%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>MESI åè®®çš„çŠ¶æ€è½¬ç§»å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-03-31/1711876193915_Diagrama_MESI.gif" alt="">&lt;/p>
&lt;ul>
&lt;li>ä»æ— æ•ˆï¼ˆIï¼‰åˆ°ç‹¬å ï¼ˆEï¼‰ï¼šå½“ CPU éœ€è¦å†™å…¥ä¸€ä¸ªç¼“å­˜è¡Œè€Œè¯¥è¡Œå½“å‰çŠ¶æ€ä¸ºæ— æ•ˆæ—¶ï¼Œå¦‚æœå…¶ä»– CPU ç¼“å­˜ä¸­æ²¡æœ‰è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œè¯¥è¡ŒçŠ¶æ€å˜ä¸ºç‹¬å ã€‚è¿™è¡¨æ˜å½“å‰ CPU ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œä¸”æ²¡æœ‰å…¶ä»–å‰¯æœ¬å­˜åœ¨&lt;/li>
&lt;li>ä»æ— æ•ˆï¼ˆIï¼‰åˆ°å…±äº«ï¼ˆSï¼‰ï¼šå½“ CPU éœ€è¦è¯»å–ä¸€ä¸ªç¼“å­˜è¡Œè€Œè¯¥è¡Œå½“å‰çŠ¶æ€ä¸ºæ— æ•ˆæ—¶ï¼Œå¦‚æœå…¶ä»– CPU ç¼“å­˜ä¸­å­˜åœ¨è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œåˆ™è¯¥è¡ŒçŠ¶æ€å˜ä¸ºå…±äº«&lt;/li>
&lt;li>ä»å…±äº«ï¼ˆSï¼‰åˆ°ç‹¬å ï¼ˆEï¼‰ï¼šå½“ä¸€ä¸ª CPU æƒ³è¦å†™å…¥ä¸€ä¸ªå¤„äºå…±äº«çŠ¶æ€çš„ç¼“å­˜è¡Œæ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å–å…¶ä»–æ‰€æœ‰ CPU ä¸Šè¯¥ç¼“å­˜è¡Œçš„ç‹¬å è®¿é—®æƒï¼Œå¦‚æœæˆåŠŸï¼Œè¯¥ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºç‹¬å &lt;/li>
&lt;li>ä»ç‹¬å ï¼ˆEï¼‰åˆ°ä¿®æ”¹ï¼ˆMï¼‰ï¼šå½“ CPU å¯¹å¤„äºç‹¬å çŠ¶æ€çš„ç¼“å­˜è¡Œè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œè¯¥ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºä¿®æ”¹ã€‚è¿™è¡¨ç¤ºæ•°æ®å·²è¢«å½“å‰ CPU ä¿®æ”¹ï¼Œä¸”ä¸ä¸»å­˜ä¸åŒæ­¥&lt;/li>
&lt;li>ä»ä¿®æ”¹ï¼ˆMï¼‰åˆ°å…±äº«ï¼ˆSï¼‰ï¼šå½“å…¶ä»– CPU è¯·æ±‚è¯»å–å¤„äºä¿®æ”¹çŠ¶æ€çš„ç¼“å­˜è¡Œæ—¶ï¼Œå½“å‰ CPU å¿…é¡»å°†è¯¥ç¼“å­˜è¡Œçš„æ•°æ®å†™å›ä¸»å­˜ï¼Œå¹¶å°†ç¼“å­˜è¡ŒçŠ¶æ€æ”¹ä¸ºå…±äº«ï¼Œä»¥ä¾¿å…¶ä»– CPU å¯ä»¥è¯»å–æœ€æ–°æ•°ã€‚&lt;/li>
&lt;li>ä»ä»»ä½•çŠ¶æ€åˆ°æ— æ•ˆï¼ˆIï¼‰ï¼šå½“ CPU æ¥æ”¶åˆ°å…¶ä»– CPU å‘å‡ºçš„æ— æ•ˆåŒ–è¯·æ±‚æ—¶ï¼Œå¦‚æœå½“å‰ CPU ç¼“å­˜ä¸­æœ‰è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œä¸è®ºå®ƒå¤„äºä½•ç§çŠ¶æ€ï¼Œéƒ½å¿…é¡»å°†å…¶æ ‡è®°ä¸ºæ— æ•ˆã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å…¶ä»– CPU æƒ³è¦å†™å…¥åŒä¸€ç¼“å­˜è¡Œçš„æƒ…å†µä¸‹&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å¯ä»¥ä½¿ç”¨è¿™ä¸ª&lt;a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESI.htm">ç®€å•çš„æ¨¡æ‹Ÿå™¨&lt;/a>æ¥æ¨¡æ‹ŸMESIåè®®çš„å·¥ä½œçŠ¶æ€&lt;/p>&lt;/blockquote>
&lt;h3 id="mesiçš„ä¼˜åŒ–">MESIçš„ä¼˜åŒ– &lt;a href="#mesi%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>éšç€å¤šæ ¸å¤„ç†å™¨çš„æ™®åŠå’Œç³»ç»Ÿå¤æ‚åº¦çš„å¢åŠ ï¼ŒMESIåè®®é¢ä¸´ç€æ€§èƒ½ç“¶é¢ˆå’Œæ•ˆç‡é—®é¢˜ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿæ€§èƒ½å’Œç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯¹MESIåè®®çš„ä¼˜åŒ–å˜å¾—éå¸¸å¿…è¦ã€‚&lt;/p>
&lt;h4 id="å†™ç¼“å†²åŒºstore-bufferæœºåˆ¶">å†™ç¼“å†²åŒºï¼ˆStore Bufferï¼‰æœºåˆ¶ &lt;a href="#%e5%86%99%e7%bc%93%e5%86%b2%e5%8c%bastore-buffer%e6%9c%ba%e5%88%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œä¸€ä¸ªCPUæ ¸å¿ƒï¼ˆä¾‹å¦‚æ ¸å¿ƒ1ï¼‰é¦–å…ˆéœ€è¦å¹¿æ’­ä¸€ä¸ªè¯»å–ä¸ºäº†å†™å…¥ï¼ˆRead For Ownershipï¼ŒRFOï¼‰è¯·æ±‚ï¼Œä»¥è·å¾—å¯¹åº”æ•°æ®çš„ç‹¬å è®¿é—®æƒã€‚åœ¨ç­‰å¾…å…¶ä»–æ ¸å¿ƒå“åº”æ­¤è¯·æ±‚å¹¶å‘é€å›ç¡®è®¤ä¿¡å·ï¼ˆACKï¼‰æœŸé—´ï¼Œæ ¸å¿ƒ1åŸæœ¬éœ€è¦ç©ºé—²ç­‰å¾…ï¼Œè¿™æ— ç–‘æ˜¯å¯¹CPUèµ„æºçš„ä¸€ç§æµªè´¹ã€‚&lt;/p>
&lt;p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç°ä»£CPUè®¾è®¡äº†â€œå†™ç¼“å†²åŒºâ€æœºåˆ¶ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå½“æ ¸å¿ƒ1å‘å‡ºRFOè¯·æ±‚å¹¶å°†å†™å…¥æ“ä½œæ”¾å…¥å†™ç¼“å†²åŒºåï¼Œå®ƒå¯ä»¥ç«‹å³ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦ç­‰å¾…ACKçš„åˆ°æ¥ã€‚ä¸€æ—¦æ”¶åˆ°ACKï¼ŒCPUå†ä»å†™ç¼“å†²åŒºä¸­å–å‡ºå†™å…¥æ“ä½œï¼Œå®é™…å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚è¿™æ ·ä¸ä»…ä¼˜åŒ–äº†CPUçš„å·¥ä½œæµç¨‹ï¼Œè¿˜æå‡äº†å¤„ç†å™¨çš„æ•´ä½“æ•ˆèƒ½ã€‚&lt;/p>
&lt;h4 id="å¤±æ•ˆé˜Ÿåˆ—invalidation-queue">å¤±æ•ˆé˜Ÿåˆ—ï¼ˆInvalidation Queueï¼‰ &lt;a href="#%e5%a4%b1%e6%95%88%e9%98%9f%e5%88%97invalidation-queue" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸ºäº†è§£å†³æ ¸å¿ƒåœ¨å¿™ç¢Œæ—¶æ— æ³•åŠæ—¶å“åº”RFOè¯·æ±‚çš„é—®é¢˜ï¼Œç°ä»£CPUå¼•å…¥äº†â€œå¤±æ•ˆé˜Ÿåˆ—â€æœºåˆ¶ã€‚æ”¶åˆ°çš„RFOè¯·æ±‚è¢«æ”¾å…¥å¤±æ•ˆé˜Ÿåˆ—ï¼Œå¹¶ç«‹å³å‘é€å›ACKï¼Œå¾…æ ¸å¿ƒå®Œæˆæ‰‹å¤´ä¸Šçš„ä»»åŠ¡åï¼Œå†å¤„ç†å¤±æ•ˆé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ã€‚è¿™ç§è®¾è®¡æœ‰æ•ˆåœ°ç¼©çŸ­äº†ç­‰å¾…æ—¶é—´ï¼ŒåŠ é€Ÿäº†æ•°æ®åŒæ­¥è¿‡ç¨‹ã€‚&lt;/p>
&lt;h3 id="mesiçš„æ½œåœ¨é—®é¢˜">MESIçš„æ½œåœ¨é—®é¢˜ &lt;a href="#mesi%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="false-sharing">False Sharing &lt;a href="#false-sharing" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç”±äºCPUä»¥64Bçš„Cache Lineä¸ºæœ€å°å•ä½ä»å†…å­˜ä¸­åŠ è½½æ•°æ®ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼š&lt;/p>
&lt;p>å‡è®¾å˜é‡aå’Œbä½äºåŒä¸€ä¸ªCache Lineä¸­ï¼Œå½“å‰CPU0å’ŒCPU1éƒ½å°†è¿™ä¸ªCache LineåŠ è½½åˆ°Cacheï¼ŒCPU0åªä¿®æ”¹å˜é‡aï¼ŒCPU1åªè¯»å–å˜é‡bã€‚å½“CPU0ä¿®æ”¹aæ—¶ï¼ŒCPU1çš„Cache Lineä¼šå˜ä¸ºInvalidçŠ¶æ€ï¼Œå³ä½¿CPU1å¹¶æ²¡æœ‰ä¿®æ”¹bï¼Œè¿™ä¼šå¯¼è‡´CPU1ä»å†…å­˜æˆ–å…¶å®ƒæ ¸å¿ƒé‡æ–°åŠ è½½Cache Lineä¸­çš„æ‰€æœ‰å˜é‡ï¼Œå½±å“æ€§èƒ½ã€‚è¿™å°±æ˜¯False Sharingã€‚&lt;/p>
&lt;p>è§£å†³False Sharingçš„å¸¸ç”¨æ–¹æ³•æ˜¯è¿›è¡Œå­—èŠ‚å¡«å……ï¼Œåœ¨aå’Œbä¹‹é—´å¡«å……æ— æ„ä¹‰çš„å˜é‡ï¼Œä½¿ä¸€ä¸ªå˜é‡å•ç‹¬å ç”¨ä¸€ä¸ªCache Lineã€‚&lt;/p>
&lt;h4 id="rmwæ“ä½œ">RMWæ“ä½œ &lt;a href="#rmw%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œè¯»-æ”¹-å†™ï¼ˆRMWï¼‰æ“ä½œï¼Œå¦‚æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCASï¼‰å’ŒåŸå­åŠ ï¼ˆADDï¼‰ï¼Œéœ€ä½œä¸ºå•ä¸€çš„åŸå­æ“ä½œæ‰§è¡Œä»¥é¿å…æ•°æ®ç«äº‰ã€‚&lt;/p>
&lt;p>å°½ç®¡MESIç¼“å­˜ä¸€è‡´æ€§åè®®ç¡®ä¿äº†å¤„ç†å™¨æ ¸å¿ƒé—´ç¼“å­˜è¡ŒçŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œå®ƒå¹¶ä¸è§£å†³æ“ä½œçš„åŸå­æ€§é—®é¢˜ã€‚åœ¨RMWæ“ä½œä¸­ï¼Œç”±äºä»è¯»å–åˆ°å†™å›çš„æ—¶é—´çª—å£å†…å¯èƒ½å‘ç”Ÿå…¶ä»–å¤„ç†å™¨çš„å¹²é¢„ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰å’ŒçŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>åœ¨ä¸ºæ­¤ï¼Œ&lt;code>LOCK&lt;/code>æŒ‡ä»¤è¢«ç”¨æ¥ç¡®ä¿RMWæ“ä½œçš„åŸå­æ€§ï¼Œé€šè¿‡é”å®šæ“ä½œæ¶‰åŠçš„ç¼“å­˜è¡Œï¼Œé˜²æ­¢åœ¨æ“ä½œå®Œæˆå‰è¢«å…¶ä»–å¤„ç†å™¨è®¿é—®ï¼Œä»è€Œæœ‰æ•ˆåœ°è§£å†³äº†æ•°æ®ç«äº‰é—®é¢˜ï¼Œä¿éšœäº†æ“ä½œçš„å®‰å…¨æ€§å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h4 id="å†™ç¼“å†²åŒºstore-bufferä¼˜åŒ–å¸¦æ¥çš„æ½œåœ¨é—®é¢˜">å†™ç¼“å†²åŒºï¼ˆStore Bufferï¼‰ä¼˜åŒ–å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ &lt;a href="#%e5%86%99%e7%bc%93%e5%86%b2%e5%8c%bastore-buffer%e4%bc%98%e5%8c%96%e5%b8%a6%e6%9d%a5%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å†™ç¼“å†²åŒºå¸¦æ¥çš„æœ€ä¸»è¦çš„é—®é¢˜æ˜¯ä¸å…¶ä»–æ ¸å¿ƒçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå†™æ“ä½œè¢«å»¶è¿Ÿæ‰§è¡Œï¼Œå…¶ä»–æ ¸å¿ƒå¯èƒ½åœ¨è¿™æ®µæ—¶é—´å†…è¯»å–åˆ°äº†æ—§çš„æ•°æ®å€¼ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œå†™ç¼“å†²åŒºå¯èƒ½å¯¼è‡´å†…å­˜é¡ºåºçš„é—®é¢˜ï¼Œå³ç¼–å†™çš„ç¨‹åºé€»è¾‘ä¸å®é™…æ‰§è¡Œé€»è¾‘ä¸ç¬¦ã€‚&lt;/p>
&lt;h4 id="å¤±æ•ˆé˜Ÿåˆ—invalidation-queueå¸¦æ¥çš„æ½œåœ¨é—®é¢˜">å¤±æ•ˆé˜Ÿåˆ—ï¼ˆInvalidation Queueï¼‰å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ &lt;a href="#%e5%a4%b1%e6%95%88%e9%98%9f%e5%88%97invalidation-queue%e5%b8%a6%e6%9d%a5%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¤±æ•ˆé˜Ÿåˆ—æé«˜äº†å“åº”é€Ÿåº¦ï¼Œä½†å®ƒä¹Ÿå¯èƒ½å¼•å…¥æ–°çš„é—®é¢˜ã€‚å¤±æ•ˆé˜Ÿåˆ—å…è®¸CPUæ ¸å¿ƒåœ¨ç¡®è®¤æ¥æ”¶åˆ°å¤±æ•ˆè¯·æ±‚åï¼Œå»¶è¿Ÿå¤„ç†è¿™äº›è¯·æ±‚ã€‚è¿™ç§å»¶è¿Ÿå¯èƒ½å¯¼è‡´æ•°æ®åœ¨ä¸åŒæ ¸å¿ƒé—´çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä¸€ä¸ªæ ¸å¿ƒå¯èƒ½ä¼šåœ¨çŸ­æ—¶é—´å†…ç»§ç»­ä½¿ç”¨å·²ç»å¤±æ•ˆçš„æ•°æ®ï¼Œè€Œè¿™æ®µæ—¶é—´å†…å…¶ä»–æ ¸å¿ƒå·²ç»ä¿®æ”¹äº†è¿™éƒ¨åˆ†æ•°æ®ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://zh.wikipedia.org/wiki/MESI%E5%8D%8F%E8%AE%AE">MESIåè®®&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/LeoYang90/Golang-Internal-Notes/blob/master/Go%20%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B.md#go-%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B">Go å†…å­˜ä¸€è‡´æ€§æ¨¡å‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://juejin.cn/post/7158395475362578462">12 å¼ å›¾çœ‹æ‡‚ CPU ç¼“å­˜ä¸€è‡´æ€§ä¸ MESI åè®®ï¼ŒçœŸçš„ä¸€è‡´å—ï¼Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wudaijun.com/2019/04/cache-coherence-and-memory-consistency/">Cacheä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.chongsheng.art/post/golang/cpu-cache-memory-barrier/">CPUç¼“å­˜æ¶æ„åˆ°å†…å­˜å±éšœ&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item></channel></rss>