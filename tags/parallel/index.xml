<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Parallel on Maerlyn's Rainbow</title><link>https://wizmann.top/tags/parallel/</link><description>Recent content in Parallel on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Sun, 22 Jan 2017 22:52:28 +0000</lastBuildDate><atom:link href="https://wizmann.top/tags/parallel/index.xml" rel="self" type="application/rss+xml"/><item><title>Parallel patterns in C#</title><link>https://wizmann.top/posts/parallel-in-csharp/</link><pubDate>Sun, 22 Jan 2017 22:52:28 +0000</pubDate><guid>https://wizmann.top/posts/parallel-in-csharp/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸ŽC/C++æ‰€ä½¿ç”¨çš„ï¼Œä¼ ç»Ÿçš„åŸºäºŽçº¿ç¨‹çš„å¹¶è¡Œæ¨¡å¼ä¸åŒï¼ŒC#å®žçŽ°äº†ä¸°å¯Œçš„å¹¶å‘ç¼–ç¨‹æ¨¡åž‹ï¼Œå…¶ä¸­ä»¥å¼‚æ­¥æ¨¡åž‹æœ€ä¸ºæµè¡Œã€‚&lt;/p>
&lt;p>æœ¬æ–‡ä¸­æˆ‘ä»¬é‡ç‚¹è®¨è®ºC#åœ¨å‘å±•è¿‡ç¨‹ä¸­å‡ºçŽ°çš„å‡ ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡åž‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Async Programming Modelï¼ˆAPMï¼‰&lt;/li>
&lt;li>Event-based Async Pattern (EAP)&lt;/li>
&lt;li>Task-based Async Patternï¼ˆTAPï¼‰&lt;/li>
&lt;li>async/awaitè¯­æ³•ç³–&lt;/li>
&lt;/ul>
&lt;h2 id="å¼‚æ­¥ç¼–ç¨‹å…¥é—¨">å¼‚æ­¥ç¼–ç¨‹å…¥é—¨ &lt;a href="#%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%85%a5%e9%97%a8" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åŒæ­¥æ¨¡å¼æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€è¢«äººç†ŸçŸ¥çš„ç¼–ç¨‹æ¨¡åž‹ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œä¹‹åŽæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚&lt;/p>
&lt;p>å¼‚æ­¥ç¼–ç¨‹å’ŒåŒæ­¥ç¼–ç¨‹ä¸åŒï¼Œç¨‹åºçš„æ‰§è¡Œæµç¨‹æ˜¯ç”±â€œäº‹ä»¶â€æ‰€é©±åŠ¨çš„ã€‚å¼‚æ­¥ç¼–ç¨‹æœ‰ä¸¤ç§å®žçŽ°æ–¹å¼ï¼Œå›žè°ƒä¸Žfutureæ¨¡å¼ã€‚&lt;/p>
&lt;p>å›žè°ƒå‡½æ•°åœ¨Javascriptä¸­è¢«å¤§é‡ä½¿ç”¨ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ä¸ä¼šé™Œç”Ÿã€‚ä½†æ˜¯å¤§é‡çš„å›žè°ƒå‡½æ•°ä¼šè®©ä»£ç å¤±åŽ»å¯è¯»æ€§ï¼Œé™·å…¥â€œCallback hellâ€ã€‚&lt;/p>
&lt;p>Promiseæ¨¡å¼æ˜¯å›žè°ƒå‡½æ•°çš„ä¸€ç§â€œåŒ…è£…â€ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦æ¥è¡¨ç¤ºâ€œæœªæ¥â€å°†ä¼šäº§ç”Ÿçš„ä¸€ä¸ªå¼‚æ­¥å¤„ç†ç»“æžœã€‚&lt;/p>
&lt;p>è¿™ä¸ªå ä½ç¬¦åœ¨ä¸åŒçš„è¯­è¨€/æ¡†æž¶é‡Œé¢æœ‰ä¸åŒçš„åå­—ï¼Œå…¶å®šä¹‰ä¹Ÿä¸å°½ç›¸åŒï¼š&lt;/p>
&lt;ul>
&lt;li>Task - C#&lt;/li>
&lt;li>Deferred - Python Twisted&lt;/li>
&lt;li>Promise - Javascript&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä»»åŠ¡ç»“æŸåŽï¼Œä¼šè§¦å‘ç»‘å®šåœ¨è¿™ä¸ªå ä½ç¬¦ä¸Šå®šä¹‰çš„å›žè°ƒå‡½æ•°ï¼Œç»§ç»­é¢„å®šä¹‰å¥½çš„é€»è¾‘ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŒæ­¥æ¨¡åž‹å°±æ˜¯ä½ ï¼š&lt;/p>
&lt;p>å®…å®¶æƒ³åƒé¥­ -&amp;gt; ä¸‹æ¥¼ä¹°é¥­ -&amp;gt; ä¸Šæ¥¼ -&amp;gt; åƒé¥­ -&amp;gt; æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ã€‚&lt;/p>
&lt;p>è€Œå¼‚æ­¥æ¨¡åž‹å‘¢ï¼Œå°±æ˜¯ï¼š&lt;/p>
&lt;p>å®…å®¶æƒ³åƒé¥­ -&amp;gt; æ‰‹æœºå«å¤–å– -&amp;gt; æ‹¿åˆ°äº†å¤–å–å®šå•ï¼ˆæ‹¿åˆ°å ä½ç¬¦ æˆ– æ³¨å†Œå›žè°ƒï¼‰-&amp;gt; æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ -&amp;gt; å¤–å–å°å“¥æŠŠé¥­é€ä¸Šé—¨ï¼ˆå¯åŠ¨å›žè°ƒï¼‰ -&amp;gt; åƒé¥­ -&amp;gt; ç»§ç»­æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ã€‚&lt;/p>
&lt;p>è™½ç„¶ä»Žä¸Šé¢çœ‹ï¼Œå¼‚æ­¥æ¨¡åž‹æ¯”åŒæ­¥æ¨¡åž‹è¦å¤æ‚ä¸€äº›ã€‚ä½†æ˜¯å®ƒå´èŠ‚çœäº†è€—æ—¶çš„â€œä¸Šä¸‹æ¥¼ä¹°é¥­â€çš„æ—¶é—´ï¼Œè®©ä½ å¯ä»¥åˆ†é…æ›´å¤šçš„æ—¶é—´ç”¨æ¥çœ‹æ¼‚äº®å°å§å§ã€‚è¿™å’Œæˆ‘ä»¬å†™ç¨‹åºæ—¶çš„æ€è·¯æ˜¯ä¸€è‡´çš„ï¼ŒèŠ‚çœåŠ¨è¾„åå‡ å‡ åæ¯«ç§’è€—æ—¶çš„IOæ—¶é—´ï¼Œå°†æ›´å¤šçš„æ—¶é—´ç”¨åœ¨CPUä¸Šã€‚&lt;/p>
&lt;h2 id="thread-based-parallel">Thread Based Parallel &lt;a href="#thread-based-parallel" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åŸºäºŽçº¿ç¨‹çš„å¹¶å‘æ¨¡åž‹æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„å¹¶å‘æ¨¡åž‹äº†ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„çŽ°ä»£ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæ”¯æŒã€‚C#ä¸­Threadçš„ç”¨æ³•ä¸ŽJavaç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšå±•å¼€ã€‚&lt;/p>
&lt;p>ä¸Žæ­¤åŒæ—¶ï¼ŒC#è¿˜æ”¯æŒThread poolï¼Œç”¨æ¥è¿è¡Œ&amp;quot;long-running processor-bound tasks&amp;quot;ã€‚&lt;/p>
&lt;p>ç›´æŽ¥æ“ä½œçº¿ç¨‹ä¹Ÿè®¸æ˜¯ä¸­å¹´ç¨‹åºå‘˜çš„å¿…ä¿®è¯¾ï¼Œä½†æ˜¯æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ä¼šç»™ç¨‹åºå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ã€‚æ‰€ä»¥å„ç§æ¨¡åž‹ä¸Žæ¡†æž¶åº”è¿è€Œç”Ÿï¼Œè¯•å›¾é™ä½Žå¹¶å‘ç¼–ç¨‹çš„å¤æ‚åº¦ã€‚&lt;/p>
&lt;h2 id="async-programming-model-apm">Async Programming Model (APM) &lt;a href="#async-programming-model-apm" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„async/awaitè¯­æ³•ç³–å‡ºçŽ°ä¹‹å‰ï¼ŒC#ä¸­ä½¿ç”¨APMæ¥è¡¨ç¤ºå¼‚æ­¥æ“ä½œã€‚è™½ç„¶è¿™æ˜¯ä¸€ç§ä¸Šå¤æ—¶æœŸçš„å›žè°ƒæ¨¡å¼è¯­æ³•ï¼Œä½†æ˜¯çŽ°åœ¨æœ‰å¾ˆå¤šåº“ä»æ—§æ”¯æŒè¿™ç§é£Žæ ¼ã€‚å¦‚Azure Storage SDKä¸­çš„&lt;code>CloudTable.BeginExecute&lt;/code>ç­‰ä¸€ç³»åˆ—å‡½æ•°ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨APMæ¨¡å¼çš„ä»£ç èŒƒä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Runtime.Remoting.Messaging;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Runtime.Remoting.Proxies;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">delegate&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> AsyncInvoke();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> SI = &lt;span style="color:#66d9ef">new&lt;/span> AsyncInvoke(MyCall);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> ar = SI.BeginInvoke(MyCallback, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main()&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (!ar.AsyncWaitHandle.WaitOne(&lt;span style="color:#ae81ff">1000&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main() waiting...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main() done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MyCall()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i = &lt;span style="color:#ae81ff">0&lt;/span>; i &amp;lt; &lt;span style="color:#ae81ff">5&lt;/span>; i++)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;running...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">500&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> MyCallback(IAsyncResult iResult)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> result = iResult &lt;span style="color:#66d9ef">as&lt;/span> AsyncResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> si = (AsyncInvoke) result.AsyncDelegate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ret = si.EndInvoke(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(ret);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-19/26234044-file_1484828912411_150f3.gif" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p>
&lt;ol>
&lt;li>æˆ‘ä»¬å°†&lt;code>MyCall()&lt;/code>â€œåŒ…è£…â€åœ¨ä¸€ä¸ª&lt;code>delegate&lt;/code>ä¸­ï¼Œç„¶åŽè°ƒç”¨&lt;code>BeginInvoke&lt;/code>å‡½æ•°å®žçŽ°å¼‚æ­¥æ‰§è¡Œã€‚è¿™ä¸ªdelegateçš„æ‰§è¡Œä¸ä¼šé˜»å¡žmain threadã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„&lt;code>delegate&lt;/code>å¯ä»¥æœ‰ä¸€ä¸ªå›žè°ƒï¼Œè¿™ä¸ªå›žè°ƒåœ¨delegateæ‰§è¡Œå®ŒåŽè¢«è§¦å‘ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬å¯ä»¥&amp;quot;long-polling&amp;quot;ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨æ‰§è¡Œå®Œã€‚è¿™é‡Œçš„â€œæ‰§è¡Œå®Œâ€ä¸åŒ…æ‹¬æ¡ç›®2æåˆ°çš„å›žè°ƒï¼ˆå°å¿ƒrace conditionï¼ï¼‰ã€‚&lt;/li>
&lt;li>å¼‚æ­¥æ‰§è¡Œçš„ç»“æžœå¯ä»¥é€šè¿‡&lt;code>delegate.EndInvoke(IAsyncResult)&lt;/code>å‡½æ•°èŽ·å–åˆ°å¼‚æ­¥è°ƒç”¨çš„ç»“æžœã€‚&lt;/li>
&lt;li>ç”±æ¡ç›®3æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨callbackå‡½æ•°ä¸­èŽ·å–å¼‚æ­¥è°ƒç”¨çš„ç»“æžœæ˜¯æœ€åˆé€‚çš„ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥APMé£Žæ ¼çš„ä»£ç å†™èµ·æ¥éžå¸¸åƒjavascriptä¸­çš„å›žè°ƒå†™æ³•ï¼Œå¦‚æžœé€»è¾‘å¤æ‚çš„è¯ï¼Œç»´æŠ¤èµ·æ¥ä¼šæ˜¯ä¸€ä¸ªå¤§å‘ã€‚&lt;/p>
&lt;h2 id="event-asynchronous-pattern-eap">Event Asynchronous Pattern (EAP) &lt;a href="#event-asynchronous-pattern-eap" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>EAPæ˜¯å›žè°ƒå‡½æ•°çš„å¦ä¸€ç§å°è£…ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.ComponentModel;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">StringEventArgs&lt;/span> : EventArgs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> Content { &lt;span style="color:#66d9ef">get&lt;/span>; &lt;span style="color:#66d9ef">set&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">event&lt;/span> EventHandler&amp;lt;StringEventArgs&amp;gt; _eventHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Solution()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler += Handle1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler += Handle2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Run()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler?.Invoke(&lt;span style="color:#66d9ef">this&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> StringEventArgs()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Content = &lt;span style="color:#e6db74">&amp;#34;123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> Handle1(&lt;span style="color:#66d9ef">object&lt;/span> sender, StringEventArgs args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Handle1 &amp;#34;&lt;/span> + args.Content);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> Handle2(&lt;span style="color:#66d9ef">object&lt;/span> sender, StringEventArgs args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Handle2 &amp;#34;&lt;/span> + args.Content);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Solution sol = &lt;span style="color:#66d9ef">new&lt;/span> Solution();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sol.Run();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-20/46892581-file_1484911655343_68ae.gif" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ‰§è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šã€‚å¹¶ä¸”&lt;code>Handle1&lt;/code>å’Œ&lt;code>Handle2&lt;/code>é¡ºåºæ‰§è¡Œã€‚&lt;/p>
&lt;p>åœ¨å®žé™…å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬fire eventçš„ä»£ç å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œä¹‹åŽ&lt;code>EventHandler&lt;/code>ï¼Œä¹Ÿå°±æ˜¯callbackå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚&lt;/p>
&lt;p>EventåŒæ—¶æ”¯æŒ&lt;code>BeginInvoke&lt;/code>å’Œ&lt;code>EndInvoke&lt;/code>å‡½æ•°ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¼‚æ­¥çš„fireç›¸åº”çš„å›žè°ƒã€‚ä½†æ˜¯æ³¨æ„æ­¤æ—¶æˆ‘ä»¬åªèƒ½æ³¨å†Œå”¯ä¸€çš„å›žè°ƒï¼Œå› ä¸º&lt;code>BeginInvoke&lt;/code>åªèƒ½æœ‰ä¸€ä¸ªç›®æ ‡å›žè°ƒï¼ˆåŽŸç†ï¼šåœ¨åŒä¸€æ—¶é—´åŒä¸€çº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼‰ã€‚&lt;/p>
&lt;h2 id="task-asynchronous-pattern-tap">Task Asynchronous Pattern (TAP) &lt;a href="#task-asynchronous-pattern-tap" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨.NET 4.0ï¼ˆçŽ°åœ¨å·²ç»åˆ°6.0äº†å“¦ï¼‰ï¼ŒC#å¼•å…¥äº†TPLï¼ŒTask Parallel Libraryã€‚Taskçš„ç›®æ ‡æ˜¯ç»Ÿä¸€C#ä¸­çš„ä¸åŒå¼‚æ­¥ç¼–ç¨‹é£Žæ ¼ã€‚&lt;/p>
&lt;p>TPLä¸­çš„Taskéžå¸¸åƒJSä¸­çš„promiseå’Œtwistedä¸­çš„deferredï¼Œæ˜¯â€œæœªæ¥ä¼šå®Œæˆçš„æ“ä½œçš„ç»“æžœâ€çš„å ä½ç¬¦ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µç®€å•ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Task t = Task.Run(() =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Task start&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">2000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Task end&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (!t.IsCompleted)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main(): Task is running...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç æˆ‘ä»¬å‰é¢æåˆ°çš„APMå’ŒEAPé£Žæ ¼çš„ä»£ç æœ‰æ˜Žæ˜¾çš„ä¸åŒï¼ŒTAPæ›´æ˜“è¯»ï¼Œå¹¶ä¸”ä¿æŒäº†æŽ§åˆ¶æµçš„å®Œæ•´æ€§ã€‚ä¸åƒAPMéœ€è¦åœ¨&lt;code>EndInvoke&lt;/code>å‡½æ•°ä¸­èŽ·å–è¿”å›žå€¼ä»¥åŠè¿›è¡ŒåŽç»­æ“ä½œï¼Œä¹Ÿä¸åƒEAPä¸€æ ·éœ€è¦æ ¹æ®ä¸åŒçš„eventå£°æ˜Žä¸åŒçš„å›žè°ƒã€‚&lt;/p>
&lt;p>Taskä¹Ÿå¯èƒ½â€œä¸²èµ·æ¥â€ï¼Œå®žçŽ°å¤šçº§å›žè°ƒçš„æœºåˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t0 = Task.Run(() =&amp;gt; &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t1 = t0.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t2 = t1.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t3 = t2.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå›žè°ƒå†™æˆä¸€æ£µæ ‘çŠ¶ç»“æž„ï¼Œç„¶åŽä¸€å±‚ä¸€å±‚çš„æ‰§è¡Œï¼Œä¸è¿‡ç”Ÿå‘½æ˜¯å¦‚æ­¤å®è´µï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å……åˆ†çš„ç†ç”±è¦è¿™ä¹ˆåšã€‚&lt;/p>
&lt;h2 id="asyncawaitè¯­æ³•ç³–">async/awaitè¯­æ³•ç³– &lt;a href="#asyncawait%e8%af%ad%e6%b3%95%e7%b3%96" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;p>async/awaitè¯­æ³•ç³–åœ¨C# 5.0ä¸­è¢«å¼•å…¥ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†é¿å…å›žè°ƒå¸¦æ¥çš„ä»£ç å¤æ‚åº¦ã€‚å°±åƒTwistedä¸­çš„&lt;code>@inlineCallbacks&lt;/code>ä¸€æ ·ï¼ŒçœåŽ»äº†deferå¤æ‚çš„å›žè°ƒé“¾ã€‚&lt;/p>
&lt;p>&lt;code>await&lt;/code>ä¸­æœ‰ä¸€ä¸ª&amp;quot;wait&amp;quot;ï¼Œè¯´æ˜Žè¿™æ˜¯ä¸€ä¸ªâ€œç­‰å¾…â€æ“ä½œã€‚å®ƒç­‰å¾…çš„æ˜¯ç›¸åº”çš„Taskæ‰§è¡Œå®Œæˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> DumpWebPageAsync(&lt;span style="color:#66d9ef">string&lt;/span> uri)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebClient webClient = &lt;span style="color:#66d9ef">new&lt;/span> WebClient();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> page = &lt;span style="color:#66d9ef">await&lt;/span> webClient.DownloadStringTaskAsync(uri);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(page);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä»£ç æ‰§è¡Œåˆ°&lt;code>await&lt;/code>ä¸€è¡Œæ—¶ï¼Œå½“å‰å‡½æ•°ä¼šä¸»åŠ¨æ”¾å¼ƒå½“å‰çš„æŽ§åˆ¶æµã€‚å½“ä½¿ç”¨&lt;code>await&lt;/code>ä¿®é¥°çš„Taskå®ŒæˆåŽï¼Œå½“å‰å‡½æ•°ä¼šä»Žä¹‹å‰ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>è¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å†™å‡ºå’ŒåŒæ­¥ç‰ˆæœ¬éžå¸¸ç›¸ä¼¼çš„å¼‚æ­¥ä»£ç ï¼Œåªéœ€è¦åœ¨å¿…é¡»çš„åœ°æ–¹åŠ ä¸Š&lt;code>await&lt;/code>å…³é”®å­—ï¼Œæé†’ç¼–è¯‘å™¨è¿™é‡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œéœ€è¦é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œä½†è¿™ä¸€åˆ‡éƒ½æ˜¯å¯¹å¼€å‘è€…é€æ˜Žçš„ã€‚&lt;/p>
&lt;h3 id="asyncawaitå¹²äº†ä»€ä¹ˆ">async/awaitå¹²äº†ä»€ä¹ˆ &lt;a href="#asyncawait%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>æƒ³å¼„æ¸…æ¥šasync/awaitåˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œé¦–å…ˆæˆ‘ä»¬è¦æƒ³æ˜Žç™½çº¿ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆã€å¹²äº†ä»€ä¹ˆã€‚&lt;/p>
&lt;p>çº¿ç¨‹æ˜¯è¿›ç¨‹å†…ä¸€æ¡æ‰§è¡Œæµçš„çŠ¶æ€ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ç¡¬ä»¶çŠ¶æ€ï¼ˆIPã€Registersç­‰ï¼‰ä»¥åŠå †æ ˆï¼ˆæ ˆä¸Šçš„å±€éƒ¨å˜é‡å’Œå †ä¸Šçš„è¿›ç¨‹çº§å†…å­˜ï¼‰ã€‚é‚£ä¹ˆå¦‚æžœæˆ‘ä»¬æƒ³å®žçŽ°æŒ‚èµ·/å¯åŠ¨ï¼ˆHibernating and Resumingï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ä¿å­˜å½“å‰çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å½“ä½ å†™ä¸‹äº†async/awaitå…³é”®å­—åŽï¼Œç¼–è¯‘å™¨åœ¨åŽé¢å¸®åŠ©ä½ ç”Ÿæˆäº†çŠ¶æ€ä¿å­˜å’Œæ¢å¤è¿è¡Œä¸Šä¸‹æ–‡çš„ä»£ç ã€‚&lt;/p>
&lt;h3 id="asyncawaitåˆ°åº•å¹²äº†ä»€ä¹ˆ">async/awaitåˆ°åº•å¹²äº†ä»€ä¹ˆ &lt;a href="#asyncawait%e5%88%b0%e5%ba%95%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>æƒ³åƒæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤æ‚çš„asyncå‡½æ•°ï¼Œé‡Œé¢æœ‰å¾ˆå¤šä¸ªawaitè°ƒç”¨ï¼Œé‚£å°±æ„å‘³ç€è¿™ä¸ªå‡½æ•°ä¸­ä¼šæœ‰å¤šæ¬¡æŒ‚èµ·/ç»§ç»­æ“ä½œã€‚åŒæ—¶æˆ‘ä»¬è¿˜è¦ç»´æŠ¤è¿™ä¸ªå‡½æ•°çš„çŠ¶æ€ã€‚å¦‚æžœæˆ‘ä»¬æ˜¯è¿™ä¸ªè¯­æ³•ç³–çš„è®¾è®¡è€…ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ€Žä¹ˆæ ·çš„æ‰‹æ®µæ¥å¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ˜¯çš„ï¼ŒçŠ¶æ€æœºã€‚async/awaité¿å…äº†ä»£ç çš„ç¢Žç‰‡åŒ–ï¼Œå®ƒçš„è§£å†³æ–¹æ¡ˆå¹¶ä¸æ˜¯æ¶ˆç­äº†å›žè°ƒå‡½æ•°å’ŒContinuation Tasksï¼Œè€Œæ˜¯ä½¿ç”¨å·¥å…·ï¼ˆç¼–è¯‘å™¨ï¼‰æ¥å¸®åŠ©äººç±»è¿›è¡Œé‡å¤åŠ³åŠ¨ã€‚å½“asyncå‡½æ•°ä»ŽæŒ‚èµ·ä¸­æ¢å¤æ—¶ï¼Œä¼šè°ƒç”¨&lt;code>MoveNext&lt;/code>å‡½æ•°ï¼ˆç›¸ä¿¡çœ‹è¿‡asyncå‡½æ•°é‚£ä¸€é•¿ä¸²çš„tracebackçš„åŒå­¦è‚¯å®šå¯¹è¿™ä¸ªå‡½æ•°éžå¸¸çœ¼ç†Ÿï¼‰ï¼Œ&lt;code>MoveNext&lt;/code>å‡½æ•°ä¼šåœ¨asyncå‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨ä»¥åŠä»ŽæŒ‚èµ·ä¸­æ¢å¤æ—¶è¢«è°ƒç”¨ã€‚çŠ¶æ€æœºä¿å­˜äº†å½“å‰å‡½æ•°çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå½“&lt;code>MoveNext&lt;/code>å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šæ ¹æ®å½“å‰çŠ¶æ€æ¥åˆ¤æ–­æŽ¥ä¸‹æ¥æ‰§è¡Œä»€ä¹ˆä»£ç ã€‚&lt;/p>
&lt;h3 id="asycnawaitåˆ°åº•tmdå¹²äº†ä»€ä¹ˆ">asycn/awaitåˆ°åº•TMDå¹²äº†ä»€ä¹ˆ &lt;a href="#asycnawait%e5%88%b0%e5%ba%95tmd%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºŽasync/awaicè¯­æ³•ç³–æ˜¯åœ¨ç¼–è¯‘æœŸæ‰è¢«ç¿»è¯‘æˆç›¸åº”çš„ç¨‹åºä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä½¿ç”¨ILåç¼–è¯‘å™¨æ¥çª¥æŽ¢ç¼–è¯‘å™¨åˆ°åº•åšäº†æ€Žæ ·çš„å¤„ç†ä¸Žä¼˜åŒ–ã€‚ä¸è¿‡åç¼–è¯‘å™¨ä½ æ‡‚å¾—ï¼Œç”Ÿæˆçš„ä»£ç åŸºæœ¬æ²¡æ³•çœ‹ï¼Œè®²è§£èµ·æ¥ä¹Ÿä¼šéžå¸¸æ™¦æ¶©ã€‚&lt;/p>
&lt;p>å¹¸å¥½åœ¨99%çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦çŸ¥é“async/awaitæ˜¯æ€Žæ ·è¢«å±•å¼€çš„ã€‚å¦‚æžœä½ ç¡®å®žå¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š&lt;a href="https://www.codeproject.com/Articles/535635/Async-Await-and-the-Generated-StateMachine">Async Await and the Generated StateMachine&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å‡ ä¸ªå¸¸è§çš„å‘">å‡ ä¸ªå¸¸è§çš„å‘ &lt;a href="#%e5%87%a0%e4%b8%aa%e5%b8%b8%e8%a7%81%e7%9a%84%e5%9d%91" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;h3 id="await-ä¸Ž-é”">await ä¸Ž é” &lt;a href="#await-%e4%b8%8e-%e9%94%81" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºŽawaitä¼šä¸­æ–­å½“å‰å‡½æ•°åœ¨å½“å‰çº¿ç¨‹çš„æ‰§è¡Œæµï¼Œå¹¶ä¸”å¯èƒ½åœ¨æ¢å¤æ—¶ï¼Œè¢«æŒ‡æ´¾åˆ°å¦å¤–çš„çº¿ç¨‹ã€‚æ‰€ä»¥å¯¹awaitåŠ é”æ˜Žæ˜¾æ˜¯å¤šæ­¤ä¸€ä¸¾çš„ã€‚å¹¶ä¸”å¦‚æžœæ“ä½œä¸å½“ï¼Œè¿˜ä¼šé€ æˆæ­»é”ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠawaitæ”¾åˆ°åŠ é”çš„åŒºåŸŸå¤–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">lock&lt;/span> (sync)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Prepare for async operation&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> myNum = &lt;span style="color:#66d9ef">await&lt;/span> AlexsMethodAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">lock&lt;/span> (sync)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Use result of async operation&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="there-is-an--unfired-task-between-us">&amp;ldquo;There is an &amp;hellip; unfired Task between us&amp;rdquo; &lt;a href="#there-is-an--unfired-task-between-us" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸€ä¸ªasyncå‡½æ•°å¦‚æžœè¿”å›žçš„æ˜¯Taskï¼Œé‚£ä¹ˆå®ƒè¿”å›žçš„ä¸€å®šæ˜¯ä¸€ä¸ªhot taskï¼Œå³å·²ç»è¢«å¯åŠ¨äº†çš„Taskã€‚&lt;/p>
&lt;p>å¹¶ä¸”awaitåªå¯èƒ½ç­‰å¾…ä¸€ä¸ªå¯åŠ¨äº†çš„Taskï¼Œå¦åˆ™awaitæ“ä½œå°†ä¼šhangä½ï¼Œç ´åç¨‹åºæ—¢å®šçš„æ‰§è¡Œæµã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨tpl-task-parallel-library">ä½¿ç”¨TPL (Task parallel library) &lt;a href="#%e4%bd%bf%e7%94%a8tpl-task-parallel-library" class="anchor">ðŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Async methods are synchronous util needed.&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æžœæˆ‘ä»¬æƒ³åŒæ—¶æ‰§è¡Œå‡ ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½¿ç”¨foræ¥éåŽ†æ‰§è¡Œå¯ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å› ä¸ºè¿™æ ·å‡½æ•°æ‰§è¡Œæµä»ç„¶æ˜¯é¡ºåºæ‰§è¡Œç›¸åº”çš„å‡½æ•°ã€‚&lt;/p>
&lt;p>TPLæä¾›äº†&lt;code>WhenAll&lt;/code>ã€&lt;code>WhenAny&lt;/code>ç­‰å‡½æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥æœ‰å¼¹æ€§çš„å¹¶å‘æ‰§è¡ŒTaskã€‚&lt;/p>
&lt;p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨PLINQï¼Œä¸è¿‡è¿™å°±æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æŽ¥">å‚è€ƒé“¾æŽ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ðŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://www.codeproject.com/Articles/535635/Async-Await-and-the-Generated-StateMachine">Async Await and the Generated StateMachine&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://blog.stephencleary.com/2012/07/async-interop-with-iasyncresult.html">Async Interop with IAsyncResult&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://msdn.microsoft.com/en-us/library/wewwczdw(v=vs.110).aspx">Event-based Asynchronous Pattern Overview&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.safaribooksonline.com/library/view/async-in-c/9781449337155/">Async in C# 5.0&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.safaribooksonline.com/library/view/essential-c-60/9780134176147/">Essential C# 6.0&lt;/a> Cpt18&lt;/li>
&lt;/ul></description></item></channel></rss>