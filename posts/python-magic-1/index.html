<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=Content-Security-Policy content="script-src 'self'; style-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'none'"><link rel=stylesheet href=/css/style.feedcd92d05c2cf19ee7487656b358ee4805f831b7b39711851199d0a6f8934cf9ba379d02425d485c5b65ae299bdffda3770739545d595074076bf3ead284ab.css media=screen integrity="sha512-/u3NktBcLPGe50h2VrNY7kgF+DG3s5cRhRGZ0Kb4k0z5ujedAkJdSFxbZa4pm9/9o3cHOVRdWVB0B2vz6tKEqw==" crossorigin=anonymous><title>简明Python魔法 - 1</title>
<meta name=description content="Python中类的实现 在Python的Web框架Django中，Python类的构造特性实现了它大部分的核心功能。
当Python解释器遇到类声明时，会创建一个新的namespace ，并执行其内的所有代码，并将变量注册到这个namespace中。
"><link rel=canonical href=https://wizmann.top/posts/python-magic-1/><link rel=alternate hreflang=zh-CN href=https://wizmann.top/posts/python-magic-1/><link rel=alternate hreflang=x-default href=https://wizmann.top/posts/python-magic-1/><meta property="og:title" content="简明Python魔法 - 1"><meta property="og:description" content="Python中类的实现
在Python的Web框架Django中，Python类的构造特性实现了它大部分的核心功能。
当Python解释器遇到类声明时，会创建一个新的namespace ，并执行其内的所有代码，并将变量注册到这个namespace中。"><meta property="og:type" content="article"><meta property="og:url" content="https://wizmann.top/posts/python-magic-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-07-26T22:23:34+00:00"><meta property="article:modified_time" content="2014-07-26T22:23:34+00:00"><meta property="og:site_name" content="Maerlyn's Rainbow"><meta name=twitter:card content="summary"><meta name=twitter:title content="简明Python魔法 - 1"><meta name=twitter:description content="Python中类的实现
在Python的Web框架Django中，Python类的构造特性实现了它大部分的核心功能。
当Python解释器遇到类声明时，会创建一个新的namespace ，并执行其内的所有代码，并将变量注册到这个namespace中。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"简明Python魔法 - 1","datePublished":"2014-07-26T22:23:34+00:00","dateModified":"2014-07-26T22:23:34+00:00","mainEntityOfPage":"https://wizmann.top/","publisher":{"@type":"Organization","name":"Maerlyn's Rainbow"},"wordcount":1866,"description":"Python中类的实现 在Python的Web框架Django中，Python类的构造特性实现了它大部分的核心功能。\n当Python解释器遇到类声明时，会创建一个新的namespace ，并执行其内的所有代码，并将变量注册到这个namespace中。\n","keywords":null}</script></head><body class="posts single d-flex flex-column min-vh-100"><header class=main-header><nav class="navbar navbar-expand-lg"><div class=container><a class=navbar-brand href=/>Maerlyn's Rainbow
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="menu-main navbar-nav me-auto mb-2 mb-lg-0"></ul></div></div></nav></header><div id=content><div class="container py-3"><h2 id=python中类的实现>Python中类的实现</h2><p>在Python的Web框架Django中，Python类的构造特性实现了它大部分的核心功能。</p><p>当Python解释器遇到类声明时，会创建一个新的namespace ，并执行其内的所有代码，并将变量注册到这个namespace中。</p><p>举例：</p><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; class Foo(object):
...     print &#39;Loading...&#39;
...     spam = &#39;eggs&#39;
...     print &#39;Done!&#39;
... 
Loading...
Done!
&gt;&gt;&gt; f = Foo()
&gt;&gt;&gt; f.spam
&#39;eggs&#39;
</code></pre><h3 id=动态的实现一个类>动态的实现一个类</h3><p>使用type方法可以动态的代码中实现一个类，接受三个参数“类名”、“基类”、“属性”。</p><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; Bar = type(&#39;Bar&#39;, (object,), {&#39;spam&#39;: &#39;eggs&#39;})
&gt;&gt;&gt; Bar.spam
&#39;eggs&#39;
</code></pre><h3 id=超类改变一切>超类改变一切</h3><p>“metaprogramming”是指一种在程序运行时创建或改变代码的编程手段。<code>type</code>是一个metaclass，一个创建其它类的metaclass。</p><p>我们可以替换掉原生的<code>type</code>，使用我们自己的版本，从而控制创建类的过程。</p><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; class MetaClass(type):
...     def __init__(cls, name, bases, attrs):
...         print(&#39;Defining %s&#39; % cls)
...         print(&#39;Name: %s&#39; % name)
...         print(&#39;Bases: %s&#39; % (bases,))
...         print(&#39;Attributes:&#39;)
...         for (name, value) in attrs.items():
...             print(&#39;    %s: %r&#39; % (name, value))
...
&gt;&gt;&gt; class RealClass(object, metaclass=MetaClass):
...     spam = &#39;eggs&#39;
...
Defining &lt;class &#39;__main__.RealClass&#39;&gt;
Name: RealClass
Bases: (&lt;class &#39;object&#39;&gt;,)
Attributes:
    spam: &#39;eggs&#39;
    __module__: &#39;__main__&#39;
    __qualname__: &#39;RealClass&#39;
&gt;&gt;&gt; RealClass
&lt;class &#39;__main__.RealClass&#39;&gt;
</code></pre><p>每当一个新的类被创建时，都会触发metaclass的行为。</p><h3 id=基类与超类>基类与超类</h3><p>基类与超类一起使用可以实现类方法的复用，以及对于类创建的跟踪。</p><pre tabindex=0><code class=language-pycon data-lang=pycon> &gt;&gt;&gt; class SubClass(RealClass):  # Notice there&#39;s no metaclass here.
...     pass
...
Defining &lt;class &#39;__main__.SubClass&#39;&gt;
Name: SubClass
Bases: (&lt;class &#39;__main__.RealClass&#39;&gt;,)
Attributes:
    __module__: &#39;__main__&#39;
</code></pre><p>在这里，超类对于<code>SubClass</code>是完全透明的，<code>SubClass</code>只需要完成自己的工作，Python会在后台料理好一切。</p><h3 id=声明式语法>声明式语法</h3><blockquote><p>This syntax (Declarative Syntax) is designed to make minimize &ldquo;boilerplate&rdquo; repetitive syntax and provide elegant, readable code.</p></blockquote><p>声明式语法是一种把数据和逻辑分离的编程方式，面对经常变动的但是规律明显的需求，声明式编程可以解救你于水火之中。:-P</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Contact</span>(models<span style=color:#f92672>.</span>Model):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Contact information provided when sending messages to the owner of the site.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> models<span style=color:#f92672>.</span>CharField(max_length<span style=color:#f92672>=</span><span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>    email <span style=color:#f92672>=</span> models<span style=color:#f92672>.</span>EmailField()
</span></span></code></pre></div><p>上面是Django的模型声明语法，简洁、明了、大气！</p><h2 id=让我们一起做鸭>让我们一起做鸭</h2><blockquote><p>Shakespeare: &ldquo;If it walks like a duck and talks like a duck, it&rsquo;s a Duck.&rdquo;</p></blockquote><h3 id=callables>Callables</h3><h4 id=__call__>__call__</h4><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; class Multiplier(object):
...     def __init__(self, factor):
...         self.factor = factor
...     def __call__(self, value):
...         return value * self.factor
...
&gt;&gt;&gt; times2 = Multiplier(2)
&gt;&gt;&gt; times2(5)
10
&gt;&gt;&gt; times2(10)
20
&gt;&gt;&gt; times3 = Multiplier(3)
&gt;&gt;&gt; times3(10)
30
</code></pre><p>我们可以使用callable函数来构造”有状态的函数“，以及其它可以想的到的一些黑魔法。</p><h3 id=dictionaries>Dictionaries</h3><p>使用<code>__contains</code>、<code>__getitem__</code>和<code>__setitem__</code>内建函数，可以让一个类实例模拟字典的行为。</p><h3 id=file>File</h3><p>实现<code>read</code>、<code>write</code>和<code>close</code>，你们就可以把我当文件来用啦。</p><h3 id=iterable>Iterable</h3><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; class Fibonacci(object):
...     def __init__(self, count):
...         self.count = count
...     def __iter__(self):
...         a, b = 0, 1
...         for x in range(self.count):
...             if x &lt; 2:
...                 yield x
...             else:
...                 c = a + b
...                 yield c
...                 a, b = b, c
...
&gt;&gt;&gt; for x in Fibonacci(5):
...     print(x)
...
0
1
1
2
3
</code></pre><h2 id=偏函数>偏函数</h2><p>偏函数和函数式编程中的”柯里化“一样，都是通过填充函数中的一部分参数，从而实现一个新的函数。</p><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; import functools
&gt;&gt;&gt; def add(a, b):
...     return a + b
...
&gt;&gt;&gt; add(4, 2)
6
&gt;&gt;&gt; plus3 = functools.partial(add, 3)
&gt;&gt;&gt; plus5 = functools.partial(add, 5)
&gt;&gt;&gt; plus3(4)
7
&gt;&gt;&gt; plus3(7)
10
&gt;&gt;&gt; plus5(10)
15
</code></pre><h2 id=描述符>描述符</h2><p>描述符用来存取类属性，并且可以提供如下的便利：</p><ul><li>从复杂的对象中取出数据，例如数据库或是配置文件</li><li>把一个简单的值传入一个复杂对象中</li><li>对存取的值进行自定义操作</li><li>把值转化为易于写入数据库中的类型</li></ul><pre tabindex=0><code class=language-pycon data-lang=pycon>&gt;&gt;&gt; import datetime
&gt;&gt;&gt; class CurrentDate(object):
...     def __get__(self, instance, owner):
...         return datetime.date.today()
...     def __set__(self, instance, value):
...         raise NotImplementedError(&#34;Can&#39;t change the current date.&#34;)
...
&gt;&gt;&gt; class Example(object):
...     date = CurrentDate()
...
&gt;&gt;&gt; e = Example()
&gt;&gt;&gt; e.date
datetime.date(2008, 11, 24)
&gt;&gt;&gt; e.date = datetime.date.today()
Traceback (most recent call last):
  ...
NotImplementedError: Can&#39;t change the current date.
</code></pre><h3 id=实现>实现</h3><p>覆写类的<code>__get__</code>和<code>__set__</code>函数就可以实现类的描述符。</p><h2 id=实践一个简单的unittest框架>实践：一个简单的UnitTest框架</h2><h3 id=设计思路>设计思路</h3><p>对于每一个Case，只需要声明一个类。在类中声明要测试的函数以及测试的Input和预期Output。之后框架可以运行所有测试用例，并输出结果。</p><h3 id=接口设计>接口设计</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> PyUnitTest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> PyUnitTest <span style=color:#f92672>import</span> BaseCase
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>func1</span>(a, b):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> a <span style=color:#f92672>+</span> b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>func2</span>(a, b):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> a <span style=color:#f92672>*</span> b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestFunc1</span>(BaseCase):
</span></span><span style=display:flex><span>    FUNC <span style=color:#f92672>=</span> func1
</span></span><span style=display:flex><span>    INPUT <span style=color:#f92672>=</span> [{<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>2</span>},
</span></span><span style=display:flex><span>             {<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>3</span>},
</span></span><span style=display:flex><span>             {<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>4</span>}]
</span></span><span style=display:flex><span>    OUTPUT <span style=color:#f92672>=</span> [<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>8</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestFunc2</span>(BaseCase):
</span></span><span style=display:flex><span>    FUNC <span style=color:#f92672>=</span> func2
</span></span><span style=display:flex><span>    INPUT <span style=color:#f92672>=</span> [{<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>2</span>},
</span></span><span style=display:flex><span>             {<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>3</span>},
</span></span><span style=display:flex><span>             {<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#ae81ff>4</span>}]
</span></span><span style=display:flex><span>    OUTPUT <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>12</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    PyUnitTest<span style=color:#f92672>.</span>run_all_test()
</span></span></code></pre></div><p>在Case中，使用<code>FUNC</code>标明函数，使用<code>INPUT</code>和<code>OUTPUT</code>标明预期输入输出。</p><p>使用<code>PyUnitTest.run_all_test()</code>自动运行所有用例。</p><h3 id=casecontainer>CaseContainer</h3><p><code>Case</code>类获得<code>Case</code>名，待测试函数名，输入和输出数据。</p><p>并且实现<code>run()</code>方法，运行测试用例。</p><p>使用<code>assert</code>方法保证用例的正确性。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Case</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, name, attrs):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>in_data <span style=color:#f92672>=</span> attrs<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;INPUT&#39;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>out_data <span style=color:#f92672>=</span> attrs<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;OUTPUT&#39;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>func <span style=color:#f92672>=</span> attrs<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;FUNC&#39;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span>(self<span style=color:#f92672>.</span>in_data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span>(self<span style=color:#f92672>.</span>out_data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span>(self<span style=color:#f92672>.</span>func)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span>(len(self<span style=color:#f92672>.</span>in_data) <span style=color:#f92672>==</span> len(self<span style=color:#f92672>.</span>out_data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self):
</span></span><span style=display:flex><span>        print <span style=color:#e6db74>&#39;running case: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74> ...&#39;</span> <span style=color:#f92672>%</span> self<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>        data_pair <span style=color:#f92672>=</span> zip(self<span style=color:#f92672>.</span>in_data, self<span style=color:#f92672>.</span>out_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cnt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        ok <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> data_in, data_out <span style=color:#f92672>in</span> data_pair:
</span></span><span style=display:flex><span>            res <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>func(<span style=color:#f92672>**</span>data_in)
</span></span><span style=display:flex><span>            cnt <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> data_out <span style=color:#f92672>==</span> res:
</span></span><span style=display:flex><span>                ok <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                print <span style=color:#e6db74>&#39;[PASS </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>]...&#39;</span> <span style=color:#f92672>%</span> cnt
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                print <span style=color:#e6db74>&#39;[FAILED </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>]...&#39;</span> <span style=color:#f92672>%</span> cnt
</span></span><span style=display:flex><span>                print <span style=color:#e6db74>&#39;INPUT:&#39;</span>, repr(data_in)
</span></span><span style=display:flex><span>                print <span style=color:#e6db74>&#39;OUTPUT:&#39;</span>, repr(res)
</span></span><span style=display:flex><span>                print <span style=color:#e6db74>&#39;EXPECT:&#39;</span>, repr(data_out)
</span></span><span style=display:flex><span>        print <span style=color:#e6db74>&#39;finish case: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74> (</span><span style=color:#e6db74>%d</span><span style=color:#e6db74> / </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>) ...&#39;</span> <span style=color:#f92672>%</span> (self<span style=color:#f92672>.</span>name, ok, cnt)
</span></span><span style=display:flex><span>        print <span style=color:#e6db74>&#39;-&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>20</span>
</span></span></code></pre></div><p>CaseContainer类实现了Case的收集。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CaseContainer</span>(object):
</span></span><span style=display:flex><span>    cases <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>append</span>(self, <span style=color:#66d9ef>case</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>cases<span style=color:#f92672>.</span>append(<span style=color:#66d9ef>case</span>)
</span></span></code></pre></div><h3 id=超类与基类>超类与基类</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> CaseContainer <span style=color:#f92672>import</span> Case, CaseContainer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetaCase</span>(type):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(cls, name, bases, attrs):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;BaseCase&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#f92672>=</span> Case(name, attrs)
</span></span><span style=display:flex><span>        CaseContainer<span style=color:#f92672>.</span>append(<span style=color:#66d9ef>case</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseCase</span>(object):
</span></span><span style=display:flex><span>    __metaclass__ <span style=color:#f92672>=</span> MetaCase
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run_all_test</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>case</span> <span style=color:#f92672>in</span> CaseContainer<span style=color:#f92672>.</span>cases:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span><span style=color:#f92672>.</span>run()
</span></span></code></pre></div><p>超类中，声明Case的收集逻辑。而基类中的<code>__metaclass__</code>使所有Case子类的超类皆为<code>MetaCase</code>。</p><p>最后的<code>run_all_test</code>可以批处理所有的test case。</p><h3 id=后续>后续</h3><p>这个小的单元测试框架并不完善，只是实现了最基本的测试功能。并且也没有完全应用上面所提到的所有Python的魔法特性。所以后续如果有时间和精力，应该继续完善吧。</p><h2 id=参考>参考</h2><ul><li><a href=http://book.douban.com/subject/24806569/ target=_blank rel=noopener>Pro Django</a></li></ul></div></div><footer class="py-3 mt-auto bg-light"><div class="container py-1 my-1"><div class="d-flex flex-wrap justify-content-between align-items-center"><p class="col-md mb-0 text-muted"></p><ul class="nav col-md-auto justify-content-end"></ul></div></div></footer><script src=/js/main.min.e8d88c82c0438b527f1aca4115652ba1e2877bf805b75593b23ac0e3fe2b3fe95a467d1feef275355132ba061da6404b0d24d55afabc209b294b1db043be014d.js integrity="sha512-6NiMgsBDi1J/GspBFWUroeKHe/gFt1WTsjrA4/4rP+laRn0f7vJ1NVEyugYdpkBLDSTVWvq8IJspSx2wQ74BTQ==" crossorigin=anonymous defer></script></body></html>