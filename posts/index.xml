<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Maerlyn's Rainbow</title><link>https://wizmann.top/posts/</link><description>Recent content in Posts on Maerlyn's Rainbow</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Sat, 17 May 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://wizmann.top/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>ä¸ºä»€ä¹ˆæˆ‘ä¸å»ºè®®ä½ é˜…è¯»ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ï¼ˆä¹‹ä¸€ï¼‰</title><link>https://wizmann.top/posts/why-not-start-with-ddia-part-1/</link><pubDate>Sat, 17 May 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/why-not-start-with-ddia-part-1/</guid><description>&lt;p>&lt;strong>å› ä¸ºæˆ‘æ˜¯æ ‡é¢˜å…šã€‚&lt;/strong>&lt;/p>
&lt;p>è¿™æœ¬ä¹¦ä¸æˆ‘ä»¬å¸¸ç”¨æ¥å«æ˜¾ç¤ºå™¨çš„ã€Šç®—æ³•å¯¼è®ºã€‹æˆ–ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ï¼ˆå¦‚æœä½ æ˜¯å¤§ä¸€å¤§äºŒçš„åŒå­¦ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬ã€Šç®—æ³•ç«èµ›å…¥é—¨ç»å…¸ã€‹ï¼‰å¹¶ä¸å±äºåŒä¸€ç±»ã€‚å®ƒæ›´æ¥è¿‘ã€ŠC++ Primerã€‹æˆ–é‚£æœ¬ã€Šç®—æ³•ã€‹(Robert Sedgewick è‘—ï¼‰â€”â€”å±äºé€šè¯†å‹è¯»ç‰©ã€‚&lt;/p>
&lt;p>æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ å°šæœªæŒæ¡ç›¸å…³åŸºç¡€çŸ¥è¯†ï¼Œé˜…è¯»è¿™æœ¬ä¹¦çš„å­¦ä¹ æ›²çº¿å°†ä¼šå¼‚å¸¸é™¡å³­ï¼›è€Œä¸€æ—¦ä½ å·²ç»å…¥é—¨ï¼Œå®ƒçš„è¡¨è¾¾æ–¹å¼ä¼šè®©ä½ è§‰å¾—ååˆ†ä¼˜é›…ï¼Œç»“æ„ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå´åˆå¯èƒ½è®©ä½ è§‰å¾—â€œè¯´å¾—éƒ½å¯¹ï¼Œä½†å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆæ–°ä¸œè¥¿â€ã€‚&lt;/p>
&lt;p>å¦‚æœä½ æ˜¯åˆå…¥æ•°æ®ç›¸å…³ç³»ç»Ÿé¢†åŸŸçš„æ–°æ‰‹ï¼Œæˆ‘æ›´å¸Œæœ›ä½ å…ˆå¯¹è¿™æœ¬ä¹¦çš„è„‰ç»œå’Œé‡ç‚¹æœ‰ä¸ªæ¸…æ™°æ¦‚è§ˆï¼Œå‰ªæä¿¡æ¯ã€åŒ–ç¹ä¸ºç®€ï¼Œå¸®åŠ©ä½ æ›´å¿«å»ºç«‹èµ·åŸºç¡€è®¤çŸ¥ï¼Œä»è€Œæ›´é«˜æ•ˆåœ°é˜…è¯»è¿™æœ¬ä¹¦ï¼Œè€Œä¸æ˜¯åœ¨æœ¯è¯­å’Œç»†èŠ‚ä¸­åå¤è¿·è·¯ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯æ•°æ®å¯†é›†å‹ç³»ç»Ÿ">ä»€ä¹ˆæ˜¯æ•°æ®å¯†é›†å‹ç³»ç»Ÿ &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%95%b0%e6%8d%ae%e5%af%86%e9%9b%86%e5%9e%8b%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ•°æ®å¯†é›†å‹ç³»ç»Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç»“æ„ä¸Šçš„â€œåŒé¢ä½“â€ï¼šä¸€æ–¹é¢ï¼Œå®ƒéœ€è¦å®æ—¶åœ°å¤„ç†æ•°æ®çš„å­˜å‚¨ä¸æ£€ç´¢ï¼›å¦ä¸€æ–¹é¢ï¼Œå®ƒè¿˜æ‰¿æ‹…ç€å¼‚æ­¥å¤„ç†å’Œè®¡ç®—å·²æœ‰æ•°æ®çš„ä»»åŠ¡ã€‚è¿™ä¸¤ç§æ¨¡å¼å…±åŒæ”¯æ’‘äº†ç³»ç»Ÿå¯¹æ•°æ®çš„å…¨é¢åˆ©ç”¨ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºâ€œæ•°æ®å¯†é›†å‹â€ï¼Œæ˜¯å› ä¸ºå®ƒæ‰€å¤„ç†çš„æ•°æ®å…·å¤‡ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç‰¹å¾ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®æ˜¯ä¸å¯å†ç”Ÿçš„â€”â€”ä¸€æ—¦ä¸¢å¤±ï¼Œå°±æ— æ³•é‡æ–°è·å–ï¼Œå…·æœ‰å”¯ä¸€æ€§ä¸ä¸å¯é€†æ€§ï¼›&lt;/li>
&lt;li>æ•°æ®æ˜¯æŒç»­å¢é•¿çš„â€”â€”ç³»ç»Ÿéœ€è¦ä¸æ–­æ¥æ”¶æ–°æ•°æ®ï¼Œæ•°æ®é‡éšç€æ—¶é—´æ¨ç§»å‘ˆçº¿æ€§ï¼Œç”šè‡³æŒ‡æ•°çº§ä¸Šå‡ï¼›&lt;/li>
&lt;li>æ•°æ®çš„åº”ç”¨æ˜¯ä¸æ–­æ¼”è¿›çš„â€”â€”æ•°æ®çš„ä»·å€¼å’Œä½¿ç”¨æ–¹å¼ä¼šéšç€ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯æ‰‹æ®µçš„å‘å±•è€Œå˜åŒ–ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œè®¾è®¡å’Œæ„å»ºæ•°æ®å¯†é›†å‹ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»é‡ç‚¹å…³æ³¨ä¸‰ä¸ªç›®æ ‡ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯é æ€§ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä¿éšœç³»ç»Ÿåœ¨æ•…éšœæ—¶èƒ½å¤Ÿæ­£ç¡®æ¢å¤ï¼›&lt;/li>
&lt;li>å¯æ‰©å±•æ€§ï¼šç³»ç»Ÿèƒ½å¤Ÿéšç€æ•°æ®é‡å’Œè®¿é—®é‡çš„å¢åŠ å¹³ç¨³æ‰©å±•ï¼›&lt;/li>
&lt;li>å¯ç»´æŠ¤æ€§ï¼šç³»ç»Ÿç»“æ„æ¸…æ™°ã€æ˜“äºç†è§£ï¼Œèƒ½å¤Ÿé€‚åº”æœªæ¥ä¸æ–­å˜åŒ–çš„éœ€æ±‚å’Œç¯å¢ƒã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ•°æ®æ¨¡å‹ä¸æ•°æ®ç¼–ç ">æ•°æ®æ¨¡å‹ä¸æ•°æ®ç¼–ç  &lt;a href="#%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e4%b8%8e%e6%95%b0%e6%8d%ae%e7%bc%96%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹ &lt;a href="#%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ•°æ®æ¨¡å‹æ˜¯å¯¹ç°å®ä¸–ç•Œçš„ç»“æ„åŒ–æŠ½è±¡ï¼Œæ˜¯æˆ‘ä»¬ä¸æ•°æ®ç³»ç»Ÿæ²Ÿé€šçš„â€œè¯­è¨€â€ã€‚ä¸åŒç±»å‹çš„æ•°æ®æ¨¡å‹åŸºäºä¸åŒçš„è®¾è®¡å‡è®¾ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚&lt;/p>
&lt;p>å¸¸è§çš„æ•°æ®æ¨¡å‹åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å…³ç³»æ¨¡å‹&lt;/p>
&lt;ul>
&lt;li>å…¸å‹ä»£è¡¨ï¼šMySQLã€PostgreSQL ç­‰ä¼ ç»Ÿ SQL æ•°æ®åº“&lt;/li>
&lt;li>æ•°æ®ä»¥â€œè¡¨æ ¼â€çš„å½¢å¼ç»„ç»‡ï¼Œæ¯å¼ è¡¨è¡¨ç¤ºä¸€ç§å®ä½“æˆ–å…³ç³»ï¼Œæ¯è¡Œæ˜¯ä¸€æ¡è®°å½•&lt;/li>
&lt;li>ç‰¹ç‚¹ï¼š
&lt;ul>
&lt;li>ä¸¥æ ¼çš„ç»“æ„çº¦æŸï¼ˆschemaï¼‰&lt;/li>
&lt;li>æ”¯æŒå¤æ‚çš„æŸ¥è¯¢è¯­å¥å’Œäº‹åŠ¡å¤„ç†&lt;/li>
&lt;li>æ•°æ®ä¸€è‡´æ€§å¼ºï¼Œé€‚åˆç»“æ„æ¸…æ™°ã€å…³ç³»å¤æ‚çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ–‡æ¡£æ¨¡å‹&lt;/p>
&lt;ul>
&lt;li>å…¸å‹ä»£è¡¨ï¼šMongoDBã€Redisï¼ˆéƒ¨åˆ†ç”¨ä½œæ–‡æ¡£å­˜å‚¨ï¼‰ç­‰ NoSQL ç³»ç»Ÿ&lt;/li>
&lt;li>æ•°æ®ä»¥æ–‡æ¡£å½¢å¼ç»„ç»‡ï¼ˆé€šå¸¸æ˜¯ JSON æˆ– BSON æ ¼å¼ï¼‰ï¼Œæ¯ä¸ªæ–‡æ¡£æ˜¯ä¸€æ¡è®°å½•&lt;/li>
&lt;li>ç‰¹ç‚¹ï¼š
&lt;ul>
&lt;li>æ¨¡å¼çµæ´»ï¼Œä¸å¼ºåˆ¶ schema&lt;/li>
&lt;li>æ›´é€‚åˆåµŒå¥—ç»“æ„å’Œéç»“æ„åŒ–æ•°æ®&lt;/li>
&lt;li>å†™å…¥ä¸æ‰©å±•æ€§èƒ½æ›´å¥½ï¼Œé€‚ç”¨äºå¿«é€Ÿè¿­ä»£å’Œæµ·é‡æ•°æ®åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>é€‰æ‹©ä½•ç§æ•°æ®æ¨¡å‹ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿçº¦æŸä¹‹é—´åšå‡ºçš„æƒè¡¡ã€‚&lt;/p>
&lt;h3 id="æ•°æ®ç¼–ç ">æ•°æ®ç¼–ç  &lt;a href="#%e6%95%b0%e6%8d%ae%e7%bc%96%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬å€¾å‘äºä½¿ç”¨é“¾è¡¨ã€å“ˆå¸Œè¡¨ã€æ ‘ç­‰ç»“æ„è¿›è¡Œå¿«é€Ÿè®¿é—®ã€‚ä½†åœ¨æŒä¹…åŒ–å­˜å‚¨å’Œç½‘ç»œä¼ è¾“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®ç¼–ç æˆ&lt;strong>ç´§å‡‘ä¸”ç»“æ„åŒ–çš„æ ¼å¼&lt;/strong>ï¼Œä»¥æé«˜è¯»å†™æ•ˆç‡ä¸å…¼å®¹æ€§ã€‚&lt;/p>
&lt;p>å¥½çš„æ•°æ®ç¼–ç æ ¼å¼éœ€è¦æƒè¡¡ä¸‰ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘å‰å…¼å®¹æ€§ï¼šæ–°ç‰ˆæœ¬çš„ç³»ç»Ÿä»èƒ½è¯»å–æ—§æ ¼å¼çš„æ•°æ®ï¼›&lt;/li>
&lt;li>å‘åå…¼å®¹æ€§ï¼šæ—§ç‰ˆæœ¬çš„ç³»ç»Ÿèƒ½å¿½ç•¥æ–°æ•°æ®ä¸­çš„æœªçŸ¥å­—æ®µï¼Œæ­£å¸¸è¿è¡Œï¼›&lt;/li>
&lt;li>æ•ˆç‡ï¼šç¼–ç åçš„æ•°æ®å¤§å°ä¸ CPU è§£ç å¼€é”€ä¹‹é—´å–å¾—å¹³è¡¡ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¸¸è§çš„æ•°æ®ç¼–ç æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>è¯­è¨€å†…ç½®æ ¼å¼ï¼ˆå¦‚ Python çš„ &lt;code>pickle&lt;/code>ã€Java çš„ &lt;code>Serializable&lt;/code>ï¼‰
&lt;ul>
&lt;li>ä¸è¯­è¨€ç´§è€¦åˆï¼Œç§»æ¤æ€§å·®&lt;/li>
&lt;li>ä¸æ”¯æŒæ•°æ®ç»“æ„æ¼”åŒ–&lt;/li>
&lt;li>ç¼–è§£ç æ•ˆç‡ä¸é«˜ï¼Œä¸å»ºè®®ç”¨äºè·¨ç³»ç»ŸæŒä¹…åŒ–æˆ–ç½‘ç»œä¼ è¾“&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ–‡æœ¬æ ¼å¼ï¼ˆå¦‚ CSVã€XMLã€JSONï¼‰
&lt;ul>
&lt;li>é€šç”¨ã€æ˜“è¯»ã€è°ƒè¯•å‹å¥½&lt;/li>
&lt;li>å‡ ä¹è¢«æ‰€æœ‰ç¼–ç¨‹è¯­è¨€æ”¯æŒ&lt;/li>
&lt;li>å­˜åœ¨å¤§é‡å†—ä½™ï¼ˆå¦‚é”®åé‡å¤ï¼‰ï¼Œä¸é€‚åˆé«˜æ•ˆå­˜å‚¨æˆ–ä¼ è¾“&lt;/li>
&lt;li>ä¸é€‚åˆåµŒå¥—ç»“æ„æˆ–äºŒè¿›åˆ¶æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>äºŒè¿›åˆ¶æ ¼å¼ï¼ˆå¦‚ Protobufã€Thriftã€Avroï¼‰
&lt;ul>
&lt;li>é«˜åº¦ç´§å‡‘ï¼Œæ”¯æŒåµŒå¥—ä¸å¤æ‚ç»“æ„&lt;/li>
&lt;li>æ”¯æŒæ•°æ®æ¼”åŒ–ï¼Œå…¼å®¹æ€§å¥½&lt;/li>
&lt;li>ç¼–è§£ç æ€§èƒ½é«˜ï¼Œä½†ä¸æ˜“è°ƒè¯•ï¼ˆéœ€å·¥å…·æŸ¥çœ‹ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨æ„å»ºæ•°æ®å¯†é›†å‹ç³»ç»Ÿæ—¶ï¼Œ&lt;strong>æ¨¡å‹ä¸ç¼–ç çš„é€‰æ‹©å¾€å¾€å½±å“æ·±è¿œï¼Œä¸”éš¾ä»¥éšæ„æ›´æ”¹&lt;/strong>ï¼ŒåŠ¡å¿…æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ…é‡é€‰æ‹©ã€‚&lt;/p>
&lt;h2 id="æ•°æ®æ£€ç´¢">æ•°æ®æ£€ç´¢ &lt;a href="#%e6%95%b0%e6%8d%ae%e6%a3%80%e7%b4%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="äº‹åŠ¡å¤„ç†ç³»ç»Ÿoltpä¸­çš„ç´¢å¼•ç»“æ„">äº‹åŠ¡å¤„ç†ç³»ç»Ÿï¼ˆOLTPï¼‰ä¸­çš„ç´¢å¼•ç»“æ„ &lt;a href="#%e4%ba%8b%e5%8a%a1%e5%a4%84%e7%90%86%e7%b3%bb%e7%bb%9foltp%e4%b8%ad%e7%9a%84%e7%b4%a2%e5%bc%95%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>OLTPï¼ˆåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼‰ç³»ç»Ÿä¸»è¦å¤„ç†é«˜å¹¶å‘ã€å®æ—¶è¯»å†™è¯·æ±‚ï¼Œå› æ­¤å¯¹å»¶è¿Ÿæåº¦æ•æ„Ÿã€‚å¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>å“ˆå¸Œè¡¨ï¼šç”¨äºå¿«é€Ÿé”®å€¼å¯¹æ£€ç´¢ï¼Œç»“æ„ç®€å•ï¼Œæ€§èƒ½é«˜ï¼›&lt;/li>
&lt;li>LSM-Treeï¼šå¤šå±‚å·²æ’åºæ•°ç»„ç»“æ„ï¼Œå†™å…¥å¿«ï¼Œé€‚åˆå†™å¤šè¯»å°‘åœºæ™¯ï¼›&lt;/li>
&lt;li>B-Treeï¼šå¤šå‰å¹³è¡¡æ’åºæ ‘ï¼Œé€‚åˆè¯»å†™æ··åˆåœºæ™¯ï¼Œæ˜¯å¤šæ•°æ•°æ®åº“çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="æ•°æ®åˆ†æç³»ç»Ÿolapä¸­çš„ç´¢å¼•ç»“æ„">æ•°æ®åˆ†æç³»ç»Ÿï¼ˆOLAPï¼‰ä¸­çš„ç´¢å¼•ç»“æ„ &lt;a href="#%e6%95%b0%e6%8d%ae%e5%88%86%e6%9e%90%e7%b3%bb%e7%bb%9folap%e4%b8%ad%e7%9a%84%e7%b4%a2%e5%bc%95%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>OLAPï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ç³»ç»Ÿç”¨äºå¤„ç†å¤§è§„æ¨¡ç¦»çº¿æ•°æ®ä»»åŠ¡ï¼Œå…³æ³¨çš„æ˜¯æ•´ä½“ååè€Œéå•æ¬¡è¯·æ±‚çš„å“åº”å»¶è¿Ÿã€‚&lt;/p>
&lt;h4 id="äº‹å®è¡¨ä¸åˆ—å¼å­˜å‚¨">äº‹å®è¡¨ä¸åˆ—å¼å­˜å‚¨ &lt;a href="#%e4%ba%8b%e5%ae%9e%e8%a1%a8%e4%b8%8e%e5%88%97%e5%bc%8f%e5%ad%98%e5%82%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨æ•°æ®ä»“åº“ä¸­ï¼Œäº‹å®è¡¨è®°å½•æ¯ä¸€æ¡äº‹ä»¶æ•°æ®ï¼Œé€šå¸¸æœ‰å¾ˆå¤šåˆ—æ¥è¡¨ç¤ºä¸åŒç»´åº¦ã€‚è™½ç„¶é€»è¾‘ä¸ŠæŒ‰è¡Œå­˜å‚¨ï¼Œä½†ç‰©ç†ä¸Šé‡‡ç”¨åˆ—å¼å­˜å‚¨æ›´ä¸ºé«˜æ•ˆï¼š&lt;/p>
&lt;ul>
&lt;li>æŸ¥è¯¢åªéœ€è¯»å–å¿…è¦çš„åˆ—ï¼ŒI/Oæ›´å°‘ï¼›&lt;/li>
&lt;li>åŒä¸€åˆ—æ•°æ®åˆ†å¸ƒç›¸ä¼¼ï¼Œå‹ç¼©ç‡æ›´é«˜ï¼›&lt;/li>
&lt;li>åˆ—å¼å¸ƒå±€æ›´åˆ©äºå‘é‡åŒ–è®¡ç®—å’Œå¹¶è¡Œå¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å°ç»“">å°ç»“ &lt;a href="#%e5%b0%8f%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»æ¨¡å‹ã€ç¼–ç åˆ°æ£€ç´¢ï¼Œæ•°æ®ç³»ç»Ÿçš„åŸºç¡€æ„æˆå…¶å®å›´ç»•ç€ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜å±•å¼€ï¼šæˆ‘ä»¬å¦‚ä½•é«˜æ•ˆã€å¯é åœ°ç»„ç»‡ã€ä¿å­˜ä¸ä½¿ç”¨æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>æ•°æ®æ¨¡å‹å†³å®šäº†æˆ‘ä»¬å¦‚ä½•æŠ½è±¡ç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©ä¸å…³ç³»ï¼›&lt;/li>
&lt;li>æ•°æ®ç¼–ç å†³å®šäº†æˆ‘ä»¬å¦‚ä½•åœ¨ç³»ç»Ÿä¹‹é—´ä¼ é€’å’ŒæŒä¹…åŒ–è¿™äº›æŠ½è±¡ï¼›&lt;/li>
&lt;li>æ•°æ®æ£€ç´¢ç»“æ„åˆ™å†³å®šäº†æˆ‘ä»¬å¦‚ä½•ä»¥å°½å¯èƒ½ä½çš„å¼€é”€è·å¾—æ‰€éœ€ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†æ¢è®¨åˆ†å¸ƒå¼æ—¥å¿—ã€å¤åˆ¶æœºåˆ¶å’Œä¸€è‡´æ€§åè®®åœ¨æ•°æ®ç³»ç»Ÿä¸­çš„è§’è‰²ä¸å®è·µ â€”â€” å¸Œæœ›èƒ½æœ‰ä¸‹ä¸€ç¯‡ã€‚&lt;/p></description></item><item><title>3Dæ‰“å°è§£å‹ç©å…· / 3D Printed Fidget Toy</title><link>https://wizmann.top/posts/press-pad-3d-model/</link><pubDate>Sat, 05 Apr 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/press-pad-3d-model/</guid><description>&lt;p>è¿™æ˜¯ä¸€æ¬¾æˆ‘ç”¨3Dæ‰“å°åˆ¶ä½œçš„å°å·§è§£å‹ç©å…·ï¼Œé€ å‹ä¸ºæŸ”å’Œçš„ä¸‰è§’å½¢ï¼Œä¸­é—´å¸ƒæ»¡å¯ä»¥æŒ‰å‹çš„å°åœ†ç‚¹ï¼Œç®€å•åˆæœ‰è¶£ã€‚é€‚åˆåœ¨å·¥ä½œæˆ–å­¦ä¹ æ—¶ç”¨æ¥æ”¾æ¾ï¼Œä¹Ÿé€‚åˆå°æœ‹å‹ç©è€ã€‚&lt;/p>
&lt;p>æˆ‘ä½¿ç”¨çš„æ˜¯PLAææ–™ï¼Œæ‰‹æ„Ÿåç¡¬ã€‚å¦‚æœç”¨TPUç­‰æŸ”æ€§ææ–™æ‰“å°ï¼Œå¯èƒ½ä¼šæ›´æ¥è¿‘ç¡…èƒ¶çš„æ„Ÿè§‰ï¼Œä½†æˆ‘è¿˜æ²¡æœ‰å®é™…å°è¯•ã€‚&lt;/p>
&lt;p>This is a small fidget toy I designed and 3D printed. The soft triangular shape with pressable dots makes it a fun and relaxing little toolâ€”great for work, study breaks, or as a toy for kids.&lt;/p>
&lt;p>I printed it using PLA, which feels firm. Flexible materials like TPU might give a more silicone-like feel, though I havenâ€™t tested that yet.&lt;/p>
&lt;p>&lt;img src="https://wizmann.top/statistics/Press-Pad-3D-Model/Press-Pad.png" alt="">&lt;/p>
&lt;p>&lt;img src="https://wizmann.top/statistics/Press-Pad-3D-Model/Press-Pad-real.png" alt="">&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://wizmann.top/statistics/Press-Pad-3D-Model/Press-Pad.3mf">Press-Pad.3mf&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wizmann.top/statistics/Press-Pad-3D-Model/Press-Pad.f3d">Press-Pad.f3d&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>é£åŠ›æ¶¡è½®æœº 3D æ¨¡å‹ / Vertical Axis Wind Turbine (VAWT) 3D Model</title><link>https://wizmann.top/posts/vertical-axis-wind-turbine-3d-model/</link><pubDate>Sat, 05 Apr 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/vertical-axis-wind-turbine-3d-model/</guid><description>&lt;p>è¿™æ˜¯ä¸€æ¬¾å‚ç›´è½´é£åŠ›æ¶¡è½®æœºï¼ˆVAWTï¼‰3Dæ¨¡å‹ï¼Œå¤–è§‚é‡‡ç”¨èºæ—‹æ‰­è½¬çš„å¶ç‰‡è®¾è®¡ï¼Œå…·æœ‰æå¼ºçš„ç¾æ„Ÿå’Œç»“æ„å¯¹ç§°æ€§ã€‚å®ƒä¸éœ€è¦æ”¯æ’‘ç»“æ„ï¼Œæ–¹ä¾¿3Dæ‰“å°ï¼ŒåŒæ—¶åº•éƒ¨è®¾è®¡äº†ä¸€ä¸ªæ ‡å‡†çš„608è½´æ‰¿æ¥å£ï¼Œç”¨äºå±•ç¤ºæ—‹è½¬æ•ˆæœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒå¹¶éçœŸæ­£çš„é£åŠ›é©±åŠ¨è®¾å¤‡ï¼Œä»…ä¸ºä¸€ä¸ªå±•ç¤ºç”¨æ¨¡å‹ã€‚&lt;/p>
&lt;p>æœ¬æ¨¡å‹ä½¿ç”¨ Fusion 360 è½¯ä»¶å»ºæ¨¡ï¼Œå¹¶é™„å¸¦ .f3dï¼ˆFusion 360 åŸå§‹æ–‡ä»¶ï¼‰ å’Œ .3mfï¼ˆé€‚ç”¨äºå¤šæ•°åˆ‡ç‰‡è½¯ä»¶çš„æ ¼å¼ï¼‰ï¼Œæ–¹ä¾¿è¿›è¡Œä¿®æ”¹æˆ–ç›´æ¥æ‰“å°ã€‚&lt;/p>
&lt;hr>
&lt;p>This is a vertical axis wind turbine (VAWT) 3D model, featuring a twisted helical blade design that enhances symmetry and visual appeal. Itâ€™s designed to be support-free for easy 3D printing, and includes a 608 bearing mount at the bottom to allow free spinning when assembled. Please note: this is a non-functional display model and is not powered by wind.&lt;/p>
&lt;p>The model was created using Fusion 360, and comes with both .f3d (Fusion 360 source file) and .3mf (widely compatible with slicer software) formats, making it easy to modify or print.&lt;/p>
&lt;p>&lt;img src="https://wizmann.top/statistics/Vertical-Axis-Wind-Turbine-3D-Model/mini%E9%A3%8E%E5%8A%9B%E5%8F%91%E7%94%B5%E6%9C%BA.png" alt="">&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://wizmann.top/statistics/Vertical-Axis-Wind-Turbine-3D-Model/mini%E9%A3%8E%E5%8A%9B%E5%8F%91%E7%94%B5%E6%9C%BA.3mf">minié£åŠ›å‘ç”µæœº.3mf&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wizmann.top/statistics/Vertical-Axis-Wind-Turbine-3D-Model/mini%E9%A3%8E%E5%8A%9B%E5%8F%91%E7%94%B5%E6%9C%BA.f3d">minié£åŠ›å‘ç”µæœº.f3d&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>è®ºæ–‡é˜…è¯»ï¼šLavaStore - é«˜æ€§èƒ½ã€æœ¬åœ°å­˜å‚¨å¼•æ“çš„æ¼”è¿›</title><link>https://wizmann.top/posts/lava-store/</link><pubDate>Mon, 17 Feb 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/lava-store/</guid><description>&lt;h2 id="å¼•è¨€">å¼•è¨€ &lt;a href="#%e5%bc%95%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨äº‘æœåŠ¡çš„å¿«é€Ÿå‘å±•ä¸­ï¼ŒæŒä¹…åŒ–é”®å€¼ï¼ˆKVï¼‰å­˜å‚¨å¼•æ“çš„æ€§èƒ½å’Œæˆæœ¬æ•ˆç‡æˆä¸ºäº†å…³é”®æŒ‘æˆ˜ã€‚å­—èŠ‚è·³åŠ¨ï¼ˆByteDanceï¼‰åœ¨å…¶å¤§è§„æ¨¡äº‘æœåŠ¡ä¸­å¹¿æ³›ä½¿ç”¨ RocksDB ä½œä¸ºæœ¬åœ°å­˜å‚¨å¼•æ“ã€‚ç„¶è€Œï¼Œç”±äº RocksDB åœ¨é«˜å†™å…¥å¯†é›†å‹è´Ÿè½½ã€æˆæœ¬ä¼˜åŒ–ä»¥åŠå°¾å»¶è¿Ÿæ§åˆ¶ä¸Šçš„å±€é™æ€§ï¼Œå­—èŠ‚è·³åŠ¨å›¢é˜Ÿå¼€å‘äº† &lt;strong>LavaStore&lt;/strong>ï¼Œä¸€ä¸ªä¸“é—¨é’ˆå¯¹äº‘æœåŠ¡ä¼˜åŒ–çš„é«˜æ€§èƒ½ã€æœ¬åœ°å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>æœ¬æ–‡åŸºäºè®ºæ–‡ &lt;em>&amp;ldquo;LavaStore: ByteDanceâ€™s Purpose-built, High-performance, Cost-effective Local Storage Engine for Cloud Services&amp;rdquo;&lt;/em>ï¼Œè®¨è®º LavaStore çš„æ ¸å¿ƒè®¾è®¡ã€ä¼˜åŒ–ç­–ç•¥ä»¥åŠå®é™…åº”ç”¨è¡¨ç°ã€‚&lt;/p>
&lt;h2 id="lavastore-è®¾è®¡èƒŒæ™¯ä¸æŒ‘æˆ˜">LavaStore è®¾è®¡èƒŒæ™¯ä¸æŒ‘æˆ˜ &lt;a href="#lavastore-%e8%ae%be%e8%ae%a1%e8%83%8c%e6%99%af%e4%b8%8e%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å­—èŠ‚è·³åŠ¨çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå­˜å‚¨å¼•æ“ä¸»è¦é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>å†™å…¥æ”¾å¤§é—®é¢˜&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç”±äº LSM-tree ç»“æ„çš„ç‰¹æ€§ï¼ŒRocksDB åœ¨å¤„ç†å¤§è§„æ¨¡å†™å…¥æ—¶å­˜åœ¨è¾ƒå¤§çš„å†™å…¥æ”¾å¤§é—®é¢˜ã€‚&lt;/li>
&lt;li>ç°æœ‰çš„ KV åˆ†ç¦»æ–¹æ¡ˆï¼ˆå¦‚ BlobDBï¼‰åœ¨åº”å¯¹å¤§å€¼å­˜å‚¨æ—¶ä»å­˜åœ¨ä¸€å®šçš„ GC è´Ÿæ‹…ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é«˜æ•ˆå­˜å‚¨éœ€æ±‚&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>äº‘æœåŠ¡å¯¹å­˜å‚¨æˆæœ¬æœ‰ä¸¥æ ¼æ§åˆ¶ï¼Œå¦‚ä½•åœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹é™ä½å­˜å‚¨å¼€é”€æˆä¸ºå…³é”®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä½å°¾å»¶è¿Ÿéœ€æ±‚&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¸å¤šåº”ç”¨ï¼ˆå¦‚åœ¨çº¿äº‹åŠ¡å¤„ç† OLTP å’Œç¼“å­˜æœåŠ¡ï¼‰å¯¹ 99% ç”šè‡³ 99.99% çš„è¯·æ±‚å»¶è¿Ÿæœ‰ä¸¥æ ¼è¦æ±‚ã€‚&lt;/li>
&lt;li>ä¼ ç»Ÿå­˜å‚¨å¼•æ“åœ¨é«˜å¹¶å‘æŸ¥è¯¢åœºæ™¯ä¸‹éš¾ä»¥ä¼˜åŒ–å°¾å»¶è¿Ÿã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="lavastore-å…³é”®ä¼˜åŒ–ç‚¹">LavaStore å…³é”®ä¼˜åŒ–ç‚¹ &lt;a href="#lavastore-%e5%85%b3%e9%94%ae%e4%bc%98%e5%8c%96%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="1-lavakvç‹¬ç«‹çš„-kv-åˆ†ç¦»æ–¹æ¡ˆ">1. &lt;strong>LavaKVï¼šç‹¬ç«‹çš„ KV åˆ†ç¦»æ–¹æ¡ˆ&lt;/strong> &lt;a href="#1-lavakv%e7%8b%ac%e7%ab%8b%e7%9a%84-kv-%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LavaStore é‡‡ç”¨äº† &lt;strong>LavaKV&lt;/strong>ï¼Œä¸€ä¸ªé’ˆå¯¹ RocksDB è¿›è¡Œå®šåˆ¶åŒ–ä¼˜åŒ–çš„ KV å­˜å‚¨å±‚ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>GC ä¸å‹ç¼©è§£è€¦&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¼ ç»Ÿ RocksDB BlobDB çš„ GC éœ€è¦ä¾èµ– SSTable å‹ç¼©ï¼Œè€Œ LavaKV å…è®¸ç‹¬ç«‹æ‰§è¡Œ Blob GCï¼Œä»è€Œæé«˜å†™å…¥æ€§èƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è‡ªé€‚åº” GC ç­–ç•¥&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ ¹æ®ç£ç›˜ä½¿ç”¨ç‡åŠ¨æ€è°ƒæ•´ GC é¢‘ç‡ï¼Œä»¥ä¼˜åŒ–å†™å…¥æ”¾å¤§å’Œå­˜å‚¨åˆ©ç”¨ç‡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ›´é«˜æ•ˆçš„ Blob å­˜å‚¨ç®¡ç†&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>é‡‡ç”¨ Crit-bit Tree (CBT) ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œæ¯” RocksDB çš„ Hash Index å ç”¨æ›´å°‘çš„ç©ºé—´ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="2-lavalogé’ˆå¯¹-wal-å·¥ä½œè´Ÿè½½çš„ä¼˜åŒ–">2. &lt;strong>LavaLogï¼šé’ˆå¯¹ WAL å·¥ä½œè´Ÿè½½çš„ä¼˜åŒ–&lt;/strong> &lt;a href="#2-lavalog%e9%92%88%e5%af%b9-wal-%e5%b7%a5%e4%bd%9c%e8%b4%9f%e8%bd%bd%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>è®¸å¤šæ•°æ®åº“ç³»ç»Ÿä¾èµ– Write-Ahead Logging (WAL) æ¥ä¿è¯æ•°æ®æŒä¹…åŒ–ã€‚&lt;/li>
&lt;li>LavaLog ä¸“é—¨é’ˆå¯¹ WAL è®¾è®¡ï¼Œæä¾›æ¥è¿‘ 1 çš„å†™æ”¾å¤§ï¼ˆç›¸æ¯” RocksDB çš„ WAFâ‰ˆ2ï¼‰ï¼Œå¹¶ä¼˜åŒ–æ—¥å¿— GC æœºåˆ¶ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-lavafsè‡ªå®šä¹‰çš„ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿ">3. &lt;strong>LavaFSï¼šè‡ªå®šä¹‰çš„ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿ&lt;/strong> &lt;a href="#3-lavafs%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84%e7%94%a8%e6%88%b7%e6%80%81%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>ä¼ ç»Ÿçš„ Ext4 åœ¨ fsync æ“ä½œä¸Šæœ‰è¾ƒé«˜çš„å¼€é”€ï¼Œå½±å“åŒæ­¥å†™å…¥æ€§èƒ½ã€‚&lt;/li>
&lt;li>LavaFS é‡‡ç”¨è½»é‡çº§æ—¥å¿—æœºåˆ¶ï¼Œé¿å…äº†ä¸å¿…è¦çš„å…ƒæ•°æ®å†™å…¥ï¼Œä½¿åŒæ­¥å†™å…¥çš„ WAF ä» Ext4 çš„ 6.7 ä¸‹é™è‡³ 1ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="lavastore-åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨è¡¨ç°">LavaStore åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨è¡¨ç° &lt;a href="#lavastore-%e5%9c%a8%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e8%a1%a8%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>LavaStore å·²åœ¨å­—èŠ‚è·³åŠ¨å†…éƒ¨å¤šä¸ªä¸šåŠ¡åœºæ™¯ä¸­éƒ¨ç½²ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>æ•°æ®åº“ï¼ˆByteNDBï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¹³å‡å†™å…¥å»¶è¿Ÿå‡å°‘ 61%&lt;/li>
&lt;li>è¯»å–å»¶è¿Ÿå‡å°‘ 16%&lt;/li>
&lt;li>æ€»ä½“å†™å…¥æ”¾å¤§ï¼ˆWAFï¼‰é™ä½ 24%&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¼“å­˜ç³»ç»Ÿï¼ˆABaseï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å†™å…¥ QPS æå‡ 87%&lt;/li>
&lt;li>P99 å†™å…¥å»¶è¿Ÿé™ä½ 38%&lt;/li>
&lt;li>P99 è¯»å–å»¶è¿Ÿé™ä½ 28%&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æµå¤„ç†ï¼ˆFlinkï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>CPU ä½¿ç”¨ç‡é™ä½ 67%&lt;/li>
&lt;li>å¹³å‡æ•°æ®å­˜å‚¨å ç”¨é™ä½ 15%&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="æœªæ¥å‘å±•æ–¹å‘">æœªæ¥å‘å±•æ–¹å‘ &lt;a href="#%e6%9c%aa%e6%9d%a5%e5%8f%91%e5%b1%95%e6%96%b9%e5%90%91" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å°½ç®¡ LavaStore åœ¨å½“å‰è®¾è®¡ä¸‹å·²ç»å¤§å¹…ä¼˜åŒ–äº† RocksDB çš„æ€§èƒ½ï¼Œä½†ä»æœ‰ä¸€äº›å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„æ–¹å‘ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>ä¼˜åŒ– KV åˆ†ç¦» GC ç­–ç•¥&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç ”ç©¶æ›´æ™ºèƒ½çš„ GC ç­–ç•¥ï¼Œä½¿å…¶åœ¨è¯»å†™è´Ÿè½½ä¸åŒçš„æƒ…å†µä¸‹åŠ¨æ€è°ƒæ•´å›æ”¶æ–¹å¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¼•å…¥æ–°å­˜å‚¨ç¡¬ä»¶æ”¯æŒ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¢ç´¢ &lt;strong>ZNS SSDs&lt;/strong>ï¼ˆZoned Namespace SSDsï¼‰å’Œ &lt;strong>SPDK&lt;/strong>ï¼ˆStorage Performance Development Kitï¼‰æ¥ä¼˜åŒ–å­˜å‚¨è¯»å†™è·¯å¾„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è·¨å±‚ GC ä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç›®å‰ GC ä¸»è¦åœ¨ KV å±‚å’Œæ–‡ä»¶ç³»ç»Ÿå±‚è¿›è¡Œï¼Œæœªæ¥å¯ä»¥ä¸ SSD å±‚çš„ GC è¿›è¡ŒååŒä¼˜åŒ–ï¼Œé™ä½æ•´ä½“å†™å…¥æ”¾å¤§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>LavaStore ä½œä¸ºå­—èŠ‚è·³åŠ¨è‡ªä¸»ç ”å‘çš„é«˜æ€§èƒ½å­˜å‚¨å¼•æ“ï¼Œåœ¨å†™å…¥æ€§èƒ½ã€å­˜å‚¨æ•ˆç‡å’Œå°¾å»¶è¿Ÿæ§åˆ¶ä¸Šå‡å–å¾—äº†æ˜¾è‘—ä¼˜åŒ–ã€‚é€šè¿‡ KV åˆ†ç¦»ã€æ—¥å¿—å­˜å‚¨ä¼˜åŒ–ä»¥åŠç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ï¼ŒLavaStore ç›¸æ¯”ä¼ ç»Ÿ RocksDB æ–¹æ¡ˆï¼Œåœ¨å¤šä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯ä¸‹å±•ç°äº†ä¼˜è¶Šçš„æ€§èƒ½å’Œæˆæœ¬ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>å¯¹äºå…³æ³¨äº‘å­˜å‚¨ç³»ç»Ÿä¼˜åŒ–çš„ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆæ¥è¯´ï¼ŒLavaStore æä¾›äº†ä¸€ç§åˆ›æ–°çš„æ€è·¯ï¼Œå³é€šè¿‡ &lt;strong>åˆç†çš„æ¨¡å—åŒ–ä¼˜åŒ–&lt;/strong> ä»¥åŠ &lt;strong>é’ˆå¯¹ç‰¹å®šè´Ÿè½½çš„å®šåˆ¶åŒ–è®¾è®¡&lt;/strong>ï¼Œå¯ä»¥åœ¨å…¼é¡¾é€šç”¨æ€§çš„åŒæ—¶ï¼Œå¤§å¹…æå‡å­˜å‚¨å¼•æ“çš„æ•´ä½“è¡¨ç°ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¼•è¨€-1">å¼•è¨€ &lt;a href="#%e5%bc%95%e8%a8%80-1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨äº‘æœåŠ¡çš„å¿«é€Ÿå‘å±•ä¸­ï¼ŒæŒä¹…åŒ–é”®å€¼ï¼ˆKVï¼‰å­˜å‚¨å¼•æ“çš„æ€§èƒ½å’Œæˆæœ¬æ•ˆç‡æˆä¸ºäº†å…³é”®æŒ‘æˆ˜ã€‚å­—èŠ‚è·³åŠ¨ï¼ˆByteDanceï¼‰åœ¨å…¶å¤§è§„æ¨¡äº‘æœåŠ¡ä¸­å¹¿æ³›ä½¿ç”¨ RocksDB ä½œä¸ºæœ¬åœ°å­˜å‚¨å¼•æ“ã€‚ç„¶è€Œï¼Œç”±äº RocksDB åœ¨é«˜å†™å…¥å¯†é›†å‹è´Ÿè½½ã€æˆæœ¬ä¼˜åŒ–ä»¥åŠå°¾å»¶è¿Ÿæ§åˆ¶ä¸Šçš„å±€é™æ€§ï¼Œå­—èŠ‚è·³åŠ¨å›¢é˜Ÿå¼€å‘äº† &lt;strong>LavaStore&lt;/strong>â€”â€”ä¸€ä¸ªä¸“é—¨é’ˆå¯¹äº‘æœåŠ¡ä¼˜åŒ–çš„é«˜æ€§èƒ½ã€æœ¬åœ°å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>æœ¬æ–‡åŸºäºå…¥é€‰ &lt;strong>VLDB 2024&lt;/strong> çš„è®ºæ–‡ &lt;em>&amp;ldquo;LavaStore: ByteDanceâ€™s Purpose-built, High-performance, Cost-effective Local Storage Engine for Cloud Services&amp;rdquo;&lt;/em>ï¼Œç»“åˆå·¥ä¸šå®è·µæ•°æ®ï¼Œç³»ç»Ÿåˆ†æ LavaStore çš„æ ¸å¿ƒè®¾è®¡ã€ä¼˜åŒ–ç­–ç•¥åŠå®é™…åº”ç”¨è¡¨ç°ã€‚æˆªè‡³2025å¹´ï¼ŒLavaStore å·²åœ¨å­—èŠ‚è·³åŠ¨å†…éƒ¨éƒ¨ç½² &lt;strong>æ•°åä¸‡ä¸ªè¿è¡Œå®ä¾‹&lt;/strong>ï¼Œå­˜å‚¨è¶…è¿‡ &lt;strong>100PB æ•°æ®&lt;/strong>ï¼Œæ¯ç§’å¤„ç† &lt;strong>æ•°åäº¿æ¬¡è¯·æ±‚&lt;/strong>ï¼Œæˆä¸ºäº‘åŸç”Ÿå­˜å‚¨é¢†åŸŸçš„é‡è¦åˆ›æ–°ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="lavastore-è®¾è®¡èƒŒæ™¯ä¸æŒ‘æˆ˜-1">LavaStore è®¾è®¡èƒŒæ™¯ä¸æŒ‘æˆ˜ &lt;a href="#lavastore-%e8%ae%be%e8%ae%a1%e8%83%8c%e6%99%af%e4%b8%8e%e6%8c%91%e6%88%98-1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å­—èŠ‚è·³åŠ¨çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå­˜å‚¨å¼•æ“ä¸»è¦é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>å†™å…¥æ”¾å¤§é—®é¢˜&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>ç”±äº LSM-tree ç»“æ„çš„ç‰¹æ€§ï¼ŒRocksDB åœ¨å¤„ç†å¤§è§„æ¨¡å†™å…¥æ—¶å­˜åœ¨è¾ƒå¤§çš„å†™å…¥æ”¾å¤§é—®é¢˜ï¼ˆWAFâ‰ˆ2ï¼‰ã€‚&lt;/li>
&lt;li>ç°æœ‰çš„ KV åˆ†ç¦»æ–¹æ¡ˆï¼ˆå¦‚ BlobDBï¼‰åœ¨åº”å¯¹å¤§å€¼å­˜å‚¨æ—¶ä»å­˜åœ¨ &lt;strong>GC ä¸ SSTable å‹ç¼©å¼ºè€¦åˆ&lt;/strong> çš„é—®é¢˜ï¼Œå¯¼è‡´é¢å¤– I/O å¼€é”€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é«˜æ•ˆå­˜å‚¨éœ€æ±‚&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>äº‘æœåŠ¡å¯¹å­˜å‚¨æˆæœ¬æœ‰ä¸¥æ ¼æ§åˆ¶ï¼Œéœ€åœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹é™ä½å­˜å‚¨å¼€é”€ã€‚ä¾‹å¦‚ï¼ŒABase ç¼“å­˜ç³»ç»Ÿè¦æ±‚ &lt;strong>å­˜å‚¨ç©ºé—´å¼€é”€ä¸è¶…è¿‡6%&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä½å°¾å»¶è¿Ÿéœ€æ±‚&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰å’Œç¼“å­˜æœåŠ¡å¯¹ &lt;strong>P99.99å»¶è¿Ÿ&lt;/strong> æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œä¼ ç»Ÿå­˜å‚¨å¼•æ“åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹éš¾ä»¥æ»¡è¶³ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="lavastore-å…³é”®ä¼˜åŒ–ç‚¹-1">LavaStore å…³é”®ä¼˜åŒ–ç‚¹ &lt;a href="#lavastore-%e5%85%b3%e9%94%ae%e4%bc%98%e5%8c%96%e7%82%b9-1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="1-lavakvè§£è€¦å¼-kv-åˆ†ç¦»æ–¹æ¡ˆ">1. &lt;strong>LavaKVï¼šè§£è€¦å¼ KV åˆ†ç¦»æ–¹æ¡ˆ&lt;/strong> &lt;a href="#1-lavakv%e8%a7%a3%e8%80%a6%e5%bc%8f-kv-%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LavaKV é€šè¿‡ä»¥ä¸‹åˆ›æ–°è§£å†³ RocksDB çš„å†™å…¥æ”¾å¤§é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>GC ä¸å‹ç¼©è§£è€¦&lt;/strong>ï¼šå…è®¸ç‹¬ç«‹æ‰§è¡Œ Blob GCï¼Œé¿å…ä¼ ç»Ÿæ–¹æ¡ˆä¸­ GC ä¾èµ– SSTable å‹ç¼©çš„ç“¶é¢ˆï¼Œä½¿å†™å…¥æ€§èƒ½æå‡ &lt;strong>30%+&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>Crit-bit Tree ç´¢å¼•&lt;/strong>ï¼šé‡‡ç”¨ç©ºé—´å ç”¨æ›´å°çš„ CBT æ›¿ä»£ Hash Indexï¼Œç´¢å¼•ä½“ç§¯å‡å°‘ &lt;strong>40%&lt;/strong>ï¼Œç¼“å­˜å‘½ä¸­ç‡æå‡ &lt;strong>18%&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>åŠ¨æ€ GC ç­–ç•¥&lt;/strong>ï¼šåŸºäºç£ç›˜ä½¿ç”¨ç‡ï¼ˆå¦‚é˜ˆå€¼è¶…è¿‡70%æ—¶è§¦å‘ GCï¼‰è‡ªé€‚åº”è°ƒæ•´å›æ”¶é¢‘ç‡ï¼Œå¹³è¡¡ WAF ä¸å­˜å‚¨åˆ©ç”¨ç‡ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="2-lavalogwal-ä¸“ç”¨å¼•æ“">2. &lt;strong>LavaLogï¼šWAL ä¸“ç”¨å¼•æ“&lt;/strong> &lt;a href="#2-lavalogwal-%e4%b8%93%e7%94%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>å†™æ”¾å¤§ä¼˜åŒ–&lt;/strong>ï¼šé’ˆå¯¹ Write-Ahead Logging è®¾è®¡è½»é‡æ—¥å¿—ç»“æ„ï¼ŒWAF ä» RocksDB çš„ &lt;strong>â‰ˆ2&lt;/strong> é™è‡³æ¥è¿‘ &lt;strong>1&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>å¹¶è¡Œ GC æœºåˆ¶&lt;/strong>ï¼šé€šè¿‡æ—¶é—´çª—å£åˆ’åˆ†å®ç°æ—¥å¿—åˆ†æ®µå›æ”¶ï¼ŒGC å»¶è¿Ÿé™ä½ &lt;strong>65%&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-lavafsç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿ">3. &lt;strong>LavaFSï¼šç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿ&lt;/strong> &lt;a href="#3-lavafs%e7%94%a8%e6%88%b7%e6%80%81%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>å…ƒæ•°æ®ä¼˜åŒ–&lt;/strong>ï¼šé‡‡ç”¨è½»é‡çº§æ—¥å¿—æœºåˆ¶æ›¿ä»£ Ext4 çš„å®Œæ•´å…ƒæ•°æ®å†™å…¥ï¼ŒåŒæ­¥å†™å…¥ WAF ä» &lt;strong>6.7&lt;/strong> é™è‡³ &lt;strong>1&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>I/O è·¯å¾„ç¼©çŸ­&lt;/strong>ï¼šç»•è¿‡å†…æ ¸æ€æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥ç®¡ç†è£¸è®¾å¤‡ï¼Œfsync å»¶è¿Ÿå‡å°‘ &lt;strong>80%&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="lavastore-ç”Ÿäº§ç¯å¢ƒè¡¨ç°">LavaStore ç”Ÿäº§ç¯å¢ƒè¡¨ç° &lt;a href="#lavastore-%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e8%a1%a8%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="1-æ•°æ®åº“vedbbytendb">1. &lt;strong>æ•°æ®åº“ï¼ˆveDB/ByteNDBï¼‰&lt;/strong> &lt;a href="#1-%e6%95%b0%e6%8d%ae%e5%ba%93vedbbytendb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å¹³å‡å†™å…¥å»¶è¿Ÿé™ä½ &lt;strong>61%&lt;/strong>ï¼ˆä» 12ms é™è‡³ 4.7msï¼‰&lt;/li>
&lt;li>è¯»å–å»¶è¿Ÿé™ä½ &lt;strong>16%&lt;/strong>ï¼ˆä» 3.2ms é™è‡³ 2.7msï¼‰&lt;/li>
&lt;li>æ€»ä½“ WAF é™ä½ &lt;strong>24%&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="2-ç¼“å­˜ç³»ç»Ÿabase">2. &lt;strong>ç¼“å­˜ç³»ç»Ÿï¼ˆABaseï¼‰&lt;/strong> &lt;a href="#2-%e7%bc%93%e5%ad%98%e7%b3%bb%e7%bb%9fabase" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å†™å…¥ QPS æå‡ &lt;strong>87%&lt;/strong>ï¼ˆå³°å€¼è¾¾ 120ä¸‡ QPSï¼‰&lt;/li>
&lt;li>P99 å†™å…¥å»¶è¿Ÿé™ä½ &lt;strong>38%&lt;/strong>ï¼ˆä» 45ms é™è‡³ 28msï¼‰&lt;/li>
&lt;li>å­˜å‚¨æˆæœ¬å‡å°‘ &lt;strong>46%&lt;/strong>ï¼ˆé€šè¿‡æ··éƒ¨èµ„æºä¼˜åŒ–ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="3-æµå¤„ç†flink">3. &lt;strong>æµå¤„ç†ï¼ˆFlinkï¼‰&lt;/strong> &lt;a href="#3-%e6%b5%81%e5%a4%84%e7%90%86flink" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>CPU ä½¿ç”¨ç‡é™ä½ &lt;strong>67%&lt;/strong>ï¼ˆå½’å› äº LavaFS çš„é›¶æ‹·è´ä¼˜åŒ–ï¼‰&lt;/li>
&lt;li>æ•°æ®å­˜å‚¨å ç”¨å‡å°‘ &lt;strong>15%&lt;/strong>ï¼ˆåŸºäº CBT ç´¢å¼•å‹ç¼©ï¼‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="æœªæ¥æ–¹å‘ä¸è¡Œä¸šå¯ç¤º">æœªæ¥æ–¹å‘ä¸è¡Œä¸šå¯ç¤º &lt;a href="#%e6%9c%aa%e6%9d%a5%e6%96%b9%e5%90%91%e4%b8%8e%e8%a1%8c%e4%b8%9a%e5%90%af%e7%a4%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç¡¬ä»¶ååŒä¼˜åŒ–&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¢ç´¢ &lt;strong>ZNS SSDs&lt;/strong> çš„ Zone ç‰¹æ€§ä¸ LavaKV GC ç­–ç•¥ç»“åˆï¼Œè¿›ä¸€æ­¥é™ä½ WAFã€‚&lt;/li>
&lt;li>é›†æˆ &lt;strong>SPDK&lt;/strong> åŠ é€Ÿç”¨æˆ·æ€ I/O æ ˆï¼Œç›®æ ‡å°† fsync å»¶è¿Ÿå‹ç¼©è‡³ &lt;strong>10Î¼s çº§&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è·¨å±‚ GC ååŒ&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>è”åˆ SSD æ§åˆ¶å™¨å®ç° &lt;strong>ç‰©ç†å—å›æ”¶æç¤º&lt;/strong>ï¼Œå‡å°‘ SSD å†…éƒ¨ GC å¼€é”€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å­¦æœ¯ä»·å€¼&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>LavaStore çš„æ¨¡å—åŒ–è®¾è®¡ï¼ˆKV åˆ†ç¦»ã€ä¸“ç”¨ WALã€ç”¨æˆ·æ€ FSï¼‰ä¸ºå·¥ä¸šç•Œæä¾›äº† &lt;strong>&amp;ldquo;å®šå‘ä¼˜åŒ–+é€šç”¨å…¼å®¹&amp;rdquo;&lt;/strong> çš„èŒƒå¼ï¼Œç›¸å…³è®ºæ–‡å·²è¢« VLDB 2024 æ”¶å½•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="æ€»ç»“-1">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93-1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>LavaStore é€šè¿‡ &lt;strong>å‚ç›´è§£è€¦&lt;/strong>ï¼ˆGC ä¸å‹ç¼©åˆ†ç¦»ï¼‰ã€&lt;strong>æ°´å¹³å®šåˆ¶&lt;/strong>ï¼ˆWAL ä¸“ç”¨å¼•æ“ï¼‰å’Œ &lt;strong>åº•å±‚é‡æ„&lt;/strong>ï¼ˆç”¨æˆ·æ€ FSï¼‰çš„ä¸‰å±‚ä¼˜åŒ–ï¼Œåœ¨å†™å…¥æ€§èƒ½ã€å­˜å‚¨æ•ˆç‡å’Œå°¾å»¶è¿Ÿæ§åˆ¶ä¸Šå‡å–å¾—çªç ´ã€‚å…¶è®¾è®¡å“²å­¦è¡¨æ˜ï¼š&lt;strong>åœ¨é€šç”¨å­˜å‚¨å¼•æ“æ— æ³•æ»¡è¶³æç«¯åœºæ™¯éœ€æ±‚æ—¶ï¼Œé’ˆå¯¹æ€§åœ°æ”¹é€ å…³é”®å­ç³»ç»Ÿï¼Œèƒ½ä»¥è¾ƒä½æˆæœ¬å®ç°æ˜¾è‘—æ”¶ç›Š&lt;/strong>ã€‚&lt;/p>
&lt;dl>
&lt;dt>å¯¹äºä»ä¸šè€…è€Œè¨€ï¼ŒLavaStore çš„å®è·µéªŒè¯äº†ä»¥ä¸‹å…¬å¼çš„å¯è¡Œæ€§ï¼š&lt;/dt>
&lt;dt>$$ \text{ç³»ç»Ÿä¼˜åŒ–æ”¶ç›Š} = \sum (\text{æ¨¡å—å®šåˆ¶åŒ–å¢ç›Š}) - \text{å…¼å®¹æ€§ä»£ä»·} $$&lt;/dt>
&lt;dt>æœªæ¥ï¼Œéšç€å­˜å‚¨ç¡¬ä»¶ä¸è½¯ä»¶æ ˆçš„æ·±åº¦ååŒï¼Œæ­¤ç±»å®šå‘ä¼˜åŒ–æ–¹æ¡ˆæˆ–å°†æˆä¸ºäº‘åŸºç¡€è®¾æ–½çš„æ ‡é…ã€‚&lt;/dt>
&lt;dd>
&lt;p>å­—èŠ‚è·³åŠ¨åŸºç¡€æ¶æ„å›¢é˜Ÿ. LavaStore: ByteDanceâ€™s Purpose-built, High-performance, Cost-effective Local Storage Engine for Cloud Services. VLDB 2024.&lt;/p>
&lt;/dd>
&lt;/dl>
&lt;p>å¦‚æœä½ å¯¹ LavaStore æˆ–ç±»ä¼¼å­˜å‚¨å¼•æ“çš„ä¼˜åŒ–æœ‰æ›´å¤šè§è§£ï¼Œæ¬¢è¿ç•™è¨€äº¤æµï¼&lt;/p></description></item><item><title>åŠ¨æ‰‹å®ç°æ™ºèƒ½æŒ‡é’ˆ ï¼ˆä¸Šç¯‡ï¼‰ - C++ for the Antiquatedï¼ˆä¹‹å››ï¼‰</title><link>https://wizmann.top/posts/std-smart-ptrs-cpp-for-the-antiquated-4/</link><pubDate>Tue, 21 Jan 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/std-smart-ptrs-cpp-for-the-antiquated-4/</guid><description>&lt;p>æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚ &lt;code>std::shared_ptr&lt;/code> å’Œ &lt;code>std::weak_ptr&lt;/code>ï¼‰å·²ç»æˆä¸ºç°ä»£ C++ ç¼–ç¨‹çš„é‡è¦å·¥å…·ï¼Œå°½ç®¡å®ƒä»¬å¹¶ä¸ç®—æ˜¯â€œæ–°å…´â€çš„ç‰¹æ€§ã€‚åœ¨ C++11 æ ‡å‡†ä¹‹å‰ï¼ŒBoost åº“å°±å·²ç»å¼•å…¥äº†æ™ºèƒ½æŒ‡é’ˆçš„å®ç°ï¼Œç‰¹åˆ«æ˜¯ &lt;code>boost::shared_ptr&lt;/code> å’Œ &lt;code>boost::weak_ptr&lt;/code>ï¼Œå®ƒä»¬ä¸º C++11 çš„æ™ºèƒ½æŒ‡é’ˆç‰¹æ€§å¥ å®šäº†åŸºç¡€ã€‚å› æ­¤ï¼Œå¯ä»¥è¯´æ™ºèƒ½æŒ‡é’ˆåœ¨ C++ ä¸­çš„å‘å±•å†ç¨‹å·²ç»æœ‰å¾ˆé•¿æ—¶é—´ï¼Œè€Œå®ƒä»¬çš„å¼•å…¥æå¤§åœ°ç®€åŒ–äº†å†…å­˜ç®¡ç†å’Œé¿å…äº†å¸¸è§çš„å†…å­˜æ³„æ¼å’Œæ‚¬æŒ‚æŒ‡é’ˆé—®é¢˜ã€‚&lt;/p>
&lt;p>æœ¬æ–‡å°†å›´ç»•ä»¥ä¸‹ä¸»é¢˜å±•å¼€è®¨è®ºï¼š&lt;/p>
&lt;ul>
&lt;li>C++ æ™ºèƒ½æŒ‡é’ˆçš„å®ç°åŸç†&lt;/li>
&lt;li>éä¾µå…¥å¼æ™ºèƒ½æŒ‡é’ˆä¸ä¾µå…¥å¼æ™ºèƒ½æŒ‡é’ˆçš„åŒºåˆ«&lt;/li>
&lt;li>åˆ©ç”¨ &lt;code>atomic&lt;/code> é¿å…å¤šçº¿ç¨‹ç«æ€æ¡ä»¶&lt;/li>
&lt;li>å¦‚ä½•å®ç°ä¾µå…¥å¼ç‰ˆæœ¬çš„ &lt;code>shared_ptr&lt;/code> å’Œ &lt;code>weak_ptr&lt;/code>&lt;/li>
&lt;li>é‡‡ç”¨ &lt;code>concept&lt;/code> çº¦æŸæ¨¡æ¿ç±»å‹&lt;/li>
&lt;li>æ¢è®¨å®Œç¾è½¬å‘ï¼ˆ&lt;code>std::forward&amp;lt;T&amp;gt;&lt;/code>ï¼‰åœ¨æ™ºèƒ½æŒ‡é’ˆä¸­çš„åº”ç”¨&lt;/li>
&lt;/ul>
&lt;h2 id="c-ä¸­çš„æ™ºèƒ½æŒ‡é’ˆ">C++ ä¸­çš„æ™ºèƒ½æŒ‡é’ˆ &lt;a href="#c-%e4%b8%ad%e7%9a%84%e6%99%ba%e8%83%bd%e6%8c%87%e9%92%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="stdshared_ptrçš„å®ç°">&lt;code>std::shared_ptr&lt;/code>çš„å®ç° &lt;a href="#stdshared_ptr%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::shared_ptr&lt;/code> æ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ƒé€šè¿‡å¼•ç”¨è®¡æ•°çš„æ–¹å¼æ¥è·Ÿè¸ªæœ‰å¤šå°‘ä¸ª &lt;code>shared_ptr&lt;/code> å®ä¾‹æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œç¡®ä¿å½“æœ€åä¸€ä¸ª &lt;code>shared_ptr&lt;/code> è¢«é”€æ¯æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜èƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾ã€‚&lt;/p>
&lt;h4 id="å¼•ç”¨è®¡æ•°ä¸åŸå­æ“ä½œ">å¼•ç”¨è®¡æ•°ä¸åŸå­æ“ä½œ &lt;a href="#%e5%bc%95%e7%94%a8%e8%ae%a1%e6%95%b0%e4%b8%8e%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;code>std::shared_ptr&lt;/code> çš„æ ¸å¿ƒæœºåˆ¶æ˜¯å¼•ç”¨è®¡æ•°ã€‚æ¯ä¸ª &lt;code>shared_ptr&lt;/code> ä¼šç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚å½“å¤šä¸ª &lt;code>shared_ptr&lt;/code> æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨ä¼šå¢åŠ ï¼›å½“ä¸€ä¸ª &lt;code>shared_ptr&lt;/code> è¢«é”€æ¯æ—¶ï¼Œè®¡æ•°å™¨ä¼šå‡å°‘ã€‚å¦‚æœè®¡æ•°å™¨å½’é›¶ï¼Œè¡¨æ˜æ²¡æœ‰ä»»ä½• &lt;code>shared_ptr&lt;/code> å†æŒ‡å‘è¯¥å¯¹è±¡ï¼Œè¿™æ—¶å¯¹è±¡ä¼šè¢«åˆ é™¤ã€‚&lt;/p>
&lt;p>å¼•ç”¨è®¡æ•°é€šå¸¸ç”±ä¸€ä¸ªæ§åˆ¶å—ï¼ˆcontrol blockï¼‰ç®¡ç†ã€‚æ§åˆ¶å—ä¸ä»…ä¿å­˜å¼•ç”¨è®¡æ•°ï¼Œè¿˜ä¼šä¿å­˜å¯¹è±¡æœ¬èº«ä»¥åŠä¸å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å…¶ä»–ä¿¡æ¯ã€‚&lt;code>std::shared_ptr&lt;/code> çš„å®ç°ä¸€èˆ¬ä½¿ç”¨â€œéä¾µå…¥å¼å¼•ç”¨è®¡æ•°â€ï¼ˆå³ä¸åµŒå…¥å¯¹è±¡æœ¬èº«ï¼‰ã€‚&lt;/p>
&lt;p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">control_block&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block(T&lt;span style="color:#f92672">*&lt;/span> ptr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ref_count(&lt;span style="color:#ae81ff">1&lt;/span>), obj(ptr) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_ref&lt;/span>() { &lt;span style="color:#f92672">++&lt;/span>ref_count; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‡å°‘å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">--&lt;/span>ref_count &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> obj; &lt;span style="color:#75715e">// åˆ é™¤å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">delete&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>; &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">get&lt;/span>() { &lt;span style="color:#66d9ef">return&lt;/span> obj; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> ref_count; &lt;span style="color:#75715e">// å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> obj; &lt;span style="color:#75715e">// å®é™…å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç®€åŒ–ç‰ˆ-shared_ptr-å®ç°">ç®€åŒ–ç‰ˆ &lt;code>shared_ptr&lt;/code> å®ç° &lt;a href="#%e7%ae%80%e5%8c%96%e7%89%88-shared_ptr-%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ &lt;code>shared_ptr&lt;/code> å®ç°ç¤ºä¾‹ã€‚è¿™ä¸ªç‰ˆæœ¬ä»ç„¶æœ‰ä¸€äº›é‡è¦ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚åŸå­æ“ä½œå’Œå¼‚å¸¸å®‰å…¨ç­‰é—®é¢˜ï¼Œä½†å¯ä»¥å¸®åŠ©ç†è§£ &lt;code>shared_ptr&lt;/code> çš„åŸºæœ¬åŸç†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">my_shared_ptr&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;*&lt;/span> ctrl_block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> my_shared_ptr(T&lt;span style="color:#f92672">*&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">nullptr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ptr(p), ctrl_block(&lt;span style="color:#66d9ef">new&lt;/span> control_block&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>(p)) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‹·è´æ„é€ å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> my_shared_ptr(&lt;span style="color:#66d9ef">const&lt;/span> my_shared_ptr&lt;span style="color:#f92672">&amp;amp;&lt;/span> other)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ptr(other.ptr), ctrl_block(other.ctrl_block) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ctrl_block) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctrl_block&lt;span style="color:#f92672">-&amp;gt;&lt;/span>add_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ææ„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">~&lt;/span>my_shared_ptr() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ctrl_block) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctrl_block&lt;span style="color:#f92672">-&amp;gt;&lt;/span>release_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>() { &lt;span style="color:#66d9ef">return&lt;/span> ptr; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">*&lt;/span>() { &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">*&lt;/span>ptr; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="stdweak_ptrçš„å®ç°">&lt;code>std::weak_ptr&lt;/code>çš„å®ç° &lt;a href="#stdweak_ptr%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::weak_ptr&lt;/code> æ˜¯ä¸ &lt;code>std::shared_ptr&lt;/code> é…åˆä½¿ç”¨çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒè§£å†³äº† &lt;code>shared_ptr&lt;/code> åœ¨æŸäº›åœºæ™¯ä¸‹çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚&lt;/p>
&lt;p>å¾ªç¯å¼•ç”¨é—®é¢˜å‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡é€šè¿‡ &lt;code>shared_ptr&lt;/code> ç›¸äº’å¼•ç”¨æ—¶ï¼Œå¯¼è‡´å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸ºé›¶ï¼Œä»è€Œå¼•å‘å†…å­˜æ³„æ¼ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† &lt;code>weak_ptr&lt;/code>ã€‚&lt;/p>
&lt;h4 id="ä¸ºä»€ä¹ˆéœ€è¦-weak_ptr">ä¸ºä»€ä¹ˆéœ€è¦ &lt;code>weak_ptr&lt;/code> &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81-weak_ptr" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;code>std::weak_ptr&lt;/code> ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå› æ­¤å®ƒä¸ä¼šå½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰ &lt;code>shared_ptr&lt;/code> è¢«é”€æ¯åï¼Œ&lt;code>weak_ptr&lt;/code> å°†å˜ä¸ºâ€œæ‚¬æŒ‚â€çŠ¶æ€ã€‚è¿™ä¸æ™®é€šæŒ‡é’ˆçš„â€œç©ºæ‚¬æŒ‡é’ˆâ€ï¼ˆdangling pointerï¼‰ä¸åŒï¼Œç©ºæ‚¬çš„ &lt;code>weak_ptr&lt;/code> ä¼šè¿”å›ç©ºæŒ‡é’ˆ &lt;code>nullptr&lt;/code>ï¼Œè¡¨æ˜è¯¥å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸã€‚&lt;/p>
&lt;p>&lt;code>weak_ptr&lt;/code> æä¾›äº†ä¸€ç§è®¿é—® &lt;code>shared_ptr&lt;/code> çš„æ–¹å¼ï¼Œä½†å¹¶ä¸æ§åˆ¶å¯¹è±¡çš„é”€æ¯ï¼Œå› æ­¤å®ƒå¯ä»¥æœ‰æ•ˆé¿å…å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚&lt;/p>
&lt;p>é€šè¿‡ &lt;code>weak_ptr&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å»¶é•¿å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å‰æä¸‹ï¼Œæ£€æŸ¥å¯¹è±¡æ˜¯å¦ä»ç„¶å­˜åœ¨ï¼Œå¹¶è®¿é—®å®ƒã€‚å…·ä½“æ¥è¯´ï¼Œ&lt;code>weak_ptr&lt;/code> å¯ä»¥é€šè¿‡è°ƒç”¨ &lt;code>lock()&lt;/code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª &lt;code>shared_ptr&lt;/code>ï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜åœ¨ï¼ˆå³å¼•ç”¨è®¡æ•°å¤§äºé›¶ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ &lt;code>shared_ptr&lt;/code>ï¼Œå¦åˆ™è¿”å›ç©ºæŒ‡é’ˆã€‚&lt;/p>
&lt;h4 id="æ§åˆ¶å—çš„æ‰©å±•">æ§åˆ¶å—çš„æ‰©å±• &lt;a href="#%e6%8e%a7%e5%88%b6%e5%9d%97%e7%9a%84%e6%89%a9%e5%b1%95" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸ºäº†æ”¯æŒ&lt;code>std::weak_ptr&lt;/code>ï¼Œ æˆ‘ä»¬éœ€è¦æ‰©å±•æ§åˆ¶å—çš„åŠŸèƒ½ ï¼Œä½¿å…¶èƒ½åŒæ—¶ç®¡ç†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ˆ&lt;code>ref_count&lt;/code>ï¼‰å’Œå¼±å¼•ç”¨è®¡æ•°ï¼ˆ&lt;code>weak_count&lt;/code>ï¼‰ï¼Œä»è€Œä¿æŒå¯¹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçš„æ­£ç¡®ç®¡ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">control_block&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block(T&lt;span style="color:#f92672">*&lt;/span> ptr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ref_count(&lt;span style="color:#ae81ff">1&lt;/span>), weak_count(&lt;span style="color:#ae81ff">1&lt;/span>), obj(ptr) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_ref&lt;/span>() { &lt;span style="color:#f92672">++&lt;/span>ref_count; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">lock&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> prev &lt;span style="color:#f92672">=&lt;/span> ref_count.load(); &lt;span style="color:#75715e">// ä½¿ç”¨åŠ è½½å½“å‰å€¼ï¼Œé¿å…é‡å¤è¯»å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> (prev &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>ref_count.compare_exchange_weak(prev, prev &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> prev &lt;span style="color:#f92672">=&lt;/span> ref_count.load(); &lt;span style="color:#75715e">// å¦‚æœå¤±è´¥ï¼Œé‡æ–°åŠ è½½å½“å‰å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> prev &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#75715e">// å¦‚æœ prev &amp;gt; 0ï¼Œè¡¨ç¤ºé”å®šæˆåŠŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‡å°‘å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">--&lt;/span>ref_count &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> obj; &lt;span style="color:#75715e">// åˆ é™¤å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> release_control_block(); &lt;span style="color:#75715e">// å°è¯•åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_weak_ref&lt;/span>() { &lt;span style="color:#f92672">++&lt;/span>weak_count; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‡å°‘å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release_weak_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (weak_count.fetch_sub(&lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>; &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">get&lt;/span>() { &lt;span style="color:#66d9ef">return&lt;/span> obj; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—ï¼Œåªæœ‰åœ¨å¼±å¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> release_control_block() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (weak_count &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>; &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> ref_count; &lt;span style="color:#75715e">// å¼ºå¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> weak_count; &lt;span style="color:#75715e">// å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> obj; &lt;span style="color:#75715e">// å®é™…å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="weak_ptr-çš„ç®€åŒ–ç‰ˆå®ç°">&lt;code>weak_ptr&lt;/code> çš„ç®€åŒ–ç‰ˆå®ç° &lt;a href="#weak_ptr-%e7%9a%84%e7%ae%80%e5%8c%96%e7%89%88%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ &lt;code>weak_ptr&lt;/code> å®ç°ï¼Œå®ƒä¸ &lt;code>shared_ptr&lt;/code> å…±äº«ç›¸åŒçš„æ§åˆ¶å—ã€‚&lt;code>weak_ptr&lt;/code> æœ¬èº«ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå› æ­¤ä¸ä¼šå½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">my_weak_ptr&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> my_weak_ptr() &lt;span style="color:#f92672">:&lt;/span> ctrl_block(&lt;span style="color:#66d9ef">nullptr&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä» shared_ptr æ„é€  my_weak_ptr
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> my_weak_ptr(&lt;span style="color:#66d9ef">const&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>shared_ptr&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> shared)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ctrl_block(shared.ctrl_block) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctrl_block&lt;span style="color:#f92672">-&amp;gt;&lt;/span>add_weak_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">~&lt;/span>my_weak_ptr() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ctrl_block) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctrl_block&lt;span style="color:#f92672">-&amp;gt;&lt;/span>release_weak_ref();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°è¯•è·å–æŒ‡å‘å¯¹è±¡çš„ shared_ptr
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>shared_ptr&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> lock() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>shared_ptr&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;*&lt;/span> ctrl_block; &lt;span style="color:#75715e">// æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">my_shared_ptr&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;*&lt;/span> ctrl_block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> my_shared_ptr(&lt;span style="color:#66d9ef">const&lt;/span> my_weak_ptr&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> weak_ptr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (weak_ptr.ctrl_block &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> weak_ptr.ctrl_block&lt;span style="color:#f92672">-&amp;gt;&lt;/span>lock()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">=&lt;/span> weak_ptr.ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ctrl_block &lt;span style="color:#f92672">=&lt;/span> weak_ptr.ctrl_block();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#a6e22e">exception&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;bad weak ptr&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç†è§£å¹¶ä¼˜åŒ–stdatomictæ“ä½œ">ç†è§£å¹¶ä¼˜åŒ–&lt;code>std::atomic&amp;lt;T&amp;gt;&lt;/code>æ“ä½œ &lt;a href="#%e7%90%86%e8%a7%a3%e5%b9%b6%e4%bc%98%e5%8c%96stdatomict%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†&lt;code>std::atomic&amp;lt;int&amp;gt;&lt;/code>ä½œä¸ºæ™ºèƒ½æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°ã€‚ä¸ç›´æ¥ä½¿ç”¨&lt;code>int&lt;/code>å˜é‡ä¸åŒï¼Œ&lt;code>std::atomic&amp;lt;int&amp;gt;&lt;/code>å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ­£ç¡®åœ°ç®¡ç†å¯¹åŒä¸€æ™ºèƒ½æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†&lt;code>std::atomic&amp;lt;int&amp;gt;&lt;/code>çš„åŸºæœ¬æ“ä½œï¼ˆå¦‚è‡ªå¢ã€è‡ªå‡å’Œèµ‹å€¼ç­‰ï¼‰ï¼Œè¿™äº›æ“ä½œé»˜è®¤ä½¿ç”¨&lt;code>memory_order_seq_cst&lt;/code>å†…å­˜åºï¼ˆç¨åä¼šè®¨è®ºï¼‰ã€‚åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œ&lt;code>std::atomic&amp;lt;T&amp;gt;&lt;/code>æä¾›äº†å¤šç§å†…å­˜åºï¼ˆmemory orderingï¼‰é€‰é¡¹ï¼Œç”¨ä»¥æ§åˆ¶æ“ä½œçš„å¯è§æ€§å’Œæ‰§è¡Œé¡ºåºï¼Œä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚ä¸åŒçš„å†…å­˜åºç­–ç•¥å†³å®šäº†ç¼–è¯‘å™¨å’ŒCPUå¯¹æŒ‡ä»¤çš„é‡æ’åºç¨‹åº¦ã€‚&lt;/p>
&lt;p>å¼€å‘è€…çš„ç›®æ ‡æ˜¯é€‰æ‹©åˆé€‚çš„å†…å­˜åºï¼Œä¼˜åŒ–ç¨‹åºæ€§èƒ½ï¼ŒåŒæ—¶ç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;h3 id="å†…å­˜åºçš„æ ¸å¿ƒæ¦‚å¿µ">å†…å­˜åºçš„æ ¸å¿ƒæ¦‚å¿µ &lt;a href="#%e5%86%85%e5%ad%98%e5%ba%8f%e7%9a%84%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç†è§£å†…å­˜åºçš„å…³é”®åœ¨äº&lt;strong>é‡æ’åº&lt;/strong>å’Œ&lt;strong>è·¨çº¿ç¨‹å¯è§æ€§&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>é‡æ’åºï¼ˆReorderingï¼‰&lt;/strong>&lt;br>
ç¼–è¯‘å™¨å’ŒCPUå¯èƒ½ä¼šé‡æ’æŒ‡ä»¤ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯èƒ½ä¼šæå‰æ‰§è¡ŒæŸäº›è®¡ç®—ï¼Œæˆ–è€…å°†å­˜å‚¨æ“ä½œæ¨è¿Ÿæ‰§è¡Œã€‚æ­£ç¡®ä½¿ç”¨&lt;code>std::atomic&lt;/code>å¯ä»¥é˜²æ­¢æŸäº›å…³é”®æ“ä½œè¢«é”™è¯¯åœ°é‡æ’åºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯è§æ€§ï¼ˆVisibilityï¼‰&lt;/strong>&lt;br>
åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡çš„ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œæˆ–è€…å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å˜é‡çš„æ“ä½œé¡ºåºå¯èƒ½ä¸ç¡®å®šã€‚åŸå­æ“ä½œçš„å†…å­˜åºå†³å®šäº†å…¶ä»–çº¿ç¨‹ä½•æ—¶èƒ½çœ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="ä¸åŒå†…å­˜åºçš„ä½œç”¨åŠä½¿ç”¨åœºæ™¯">ä¸åŒå†…å­˜åºçš„ä½œç”¨åŠä½¿ç”¨åœºæ™¯ &lt;a href="#%e4%b8%8d%e5%90%8c%e5%86%85%e5%ad%98%e5%ba%8f%e7%9a%84%e4%bd%9c%e7%94%a8%e5%8f%8a%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="memory_order_relaxedæ¾æ•£é¡ºåºæœ€ä½å¼€é”€">&lt;code>memory_order_relaxed&lt;/code>ï¼ˆæ¾æ•£é¡ºåºï¼Œæœ€ä½å¼€é”€ï¼‰ &lt;a href="#memory_order_relaxed%e6%9d%be%e6%95%a3%e9%a1%ba%e5%ba%8f%e6%9c%80%e4%bd%8e%e5%bc%80%e9%94%80" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼šä¸ä¿è¯é¡ºåºï¼Œä»…ä¿è¯æ“ä½œæ˜¯&lt;strong>åŸå­çš„&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>ä½œç”¨&lt;/strong>ï¼šç¡®ä¿åŒä¸€&lt;code>std::atomic&amp;lt;T&amp;gt;&lt;/code>å˜é‡çš„è¯»å†™æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†ä¸æä¾›çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œä¸å½±å“å¯è§æ€§æˆ–é¡ºåºã€‚&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šé€‚ç”¨äº&lt;strong>æ•°æ®ç«äº‰ä¸å½±å“ç¨‹åºæ­£ç¡®æ€§&lt;/strong>çš„åœºæ™¯ï¼Œå¦‚&lt;strong>æ— ä¾èµ–çš„è®¡æ•°&lt;/strong>ï¼ˆç»Ÿè®¡çº¿ç¨‹æ•°ã€äº‹ä»¶è®¡æ•°ç­‰ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> counter{&lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>counter.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_relaxed); &lt;span style="color:#75715e">// ä»…ä¿è¯åŸå­æ€§ï¼Œä¸ä¿è¯å¯è§æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œï¼Œ&lt;code>fetch_add&lt;/code>ç¡®ä¿&lt;code>counter&lt;/code>è‡ªå¢æ“ä½œä¸ä¼šä¸¢å¤±ï¼Œä½†ä¸åŒçº¿ç¨‹çš„ä¿®æ”¹å¯èƒ½ä¼šè¢«å»¶è¿Ÿçœ‹åˆ°ã€‚&lt;/p>
&lt;h4 id="memory_order_acquireè·å–é˜²æ­¢é‡æ’åºåˆ°å‰">&lt;code>memory_order_acquire&lt;/code>ï¼ˆè·å–ï¼Œé˜²æ­¢é‡æ’åºåˆ°å‰ï¼‰ &lt;a href="#memory_order_acquire%e8%8e%b7%e5%8f%96%e9%98%b2%e6%ad%a2%e9%87%8d%e6%8e%92%e5%ba%8f%e5%88%b0%e5%89%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼šä¿è¯&lt;strong>å½“å‰çº¿ç¨‹&lt;/strong>åœ¨&lt;code>acquire&lt;/code>ä¹‹åçš„æ‰€æœ‰æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°&lt;code>acquire&lt;/code>ä¹‹å‰ï¼Œå› æ­¤ï¼Œå…¶ä»–çº¿ç¨‹ä¸­ç›¸åŒåŸå­å˜é‡çš„é‡Šæ”¾æ“ä½œï¼ˆrelease operationï¼‰ä¹‹å‰çš„å†™å…¥å¯¹å½“å‰çº¿ç¨‹æ˜¯å¯è§çš„ã€‚&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šç”¨äº&lt;strong>è¯»å–&lt;/strong>å…±äº«æ•°æ®ï¼Œç¡®ä¿å½“å‰çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å…¶ä»–çº¿ç¨‹ä¹‹å‰å¯¹è¯¥å˜é‡çš„ä¿®æ”¹ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="memory_order_releaseé‡Šæ”¾é˜²æ­¢é‡æ’åºåˆ°å">&lt;code>memory_order_release&lt;/code>ï¼ˆé‡Šæ”¾ï¼Œé˜²æ­¢é‡æ’åºåˆ°åï¼‰ &lt;a href="#memory_order_release%e9%87%8a%e6%94%be%e9%98%b2%e6%ad%a2%e9%87%8d%e6%8e%92%e5%ba%8f%e5%88%b0%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼šç¡®ä¿&lt;strong>å½“å‰çº¿ç¨‹&lt;/strong>åœ¨&lt;code>release&lt;/code>ä¹‹å‰çš„æ‰€æœ‰æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°&lt;code>release&lt;/code>ä¹‹åï¼Œå› æ­¤ï¼Œå½“å‰æ“ä½œæ‰€åœ¨çº¿ç¨‹ä¹‹å‰çš„å†™å…¥ï¼Œåœ¨å…¶ä»–çº¿ç¨‹æ–½åŠ å æœ‰æ“ä½œï¼ˆacquire operationï¼‰ä¹‹åæ˜¯å¯è§çš„ã€‚&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šç”¨äº&lt;strong>å†™å…¥&lt;/strong>å…±äº«æ•°æ®ï¼Œç¡®ä¿å…¶ä»–çº¿ç¨‹èƒ½åœ¨&lt;code>acquire&lt;/code>è¯»å–æ—¶çœ‹åˆ°ä¿®æ”¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> flag{&lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> data &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">producer&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag.store(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_release); &lt;span style="color:#75715e">// è®©æ¶ˆè´¹è€…å¯ä»¥çœ‹åˆ° data=42
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">consumer&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (flag.load(std&lt;span style="color:#f92672">::&lt;/span>memory_order_acquire) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>); &lt;span style="color:#75715e">// ç¡®ä¿ data=42 å¯è§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> data &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// ç¡®ä¿ data çš„ä¿®æ”¹å¯¹æœ¬çº¿ç¨‹å¯è§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>store(release)&lt;/code>ç¡®ä¿&lt;code>data=42&lt;/code>å‘ç”Ÿåœ¨&lt;code>flag=1&lt;/code>ä¹‹å‰ã€‚&lt;/li>
&lt;li>&lt;code>load(acquire)&lt;/code>ç¡®ä¿&lt;code>flag=1&lt;/code>ä¹‹åï¼Œ&lt;code>data=42&lt;/code>å¯¹æ¶ˆè´¹è€…çº¿ç¨‹å¯è§ã€‚&lt;/li>
&lt;li>é€šè¿‡&lt;code>acquire-release&lt;/code>ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®çœ‹åˆ°ç”Ÿäº§è€…çº¿ç¨‹çš„&lt;code>data&lt;/code>ä¿®æ”¹ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="memory_order_acq_relè·å–-é‡Šæ”¾åŒå‘åŒæ­¥">&lt;code>memory_order_acq_rel&lt;/code>ï¼ˆè·å–-é‡Šæ”¾ï¼ŒåŒå‘åŒæ­¥ï¼‰ &lt;a href="#memory_order_acq_rel%e8%8e%b7%e5%8f%96-%e9%87%8a%e6%94%be%e5%8f%8c%e5%90%91%e5%90%8c%e6%ad%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼šç»“åˆ&lt;code>acquire&lt;/code>å’Œ&lt;code>release&lt;/code>ï¼Œç”¨äº**è¯»-æ”¹-å†™ï¼ˆRead-Modify-Write, RMWï¼‰**æ“ä½œï¼Œç¡®ä¿ï¼š
&lt;ul>
&lt;li>è¯»å–æ—¶ä½¿ç”¨&lt;code>acquire&lt;/code>è¯­ä¹‰ï¼Œä¿è¯ä¹‹å‰çš„ä¿®æ”¹å¯¹å½“å‰çº¿ç¨‹å¯è§ã€‚&lt;/li>
&lt;li>å†™å…¥æ—¶ä½¿ç”¨&lt;code>release&lt;/code>è¯­ä¹‰ï¼Œä¿è¯å½“å‰ä¿®æ”¹å¯¹åç»­çº¿ç¨‹å¯è§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šç”¨äº&lt;strong>è¯»-æ”¹-å†™&lt;/strong>ï¼ˆå¦‚&lt;code>fetch_add()&lt;/code>ã€&lt;code>exchange()&lt;/code>ï¼‰æ“ä½œï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®åè°ƒã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> value{&lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>value.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_acq_rel); &lt;span style="color:#75715e">// è¯»å†™éƒ½ä¿è¯å¯è§æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™é‡Œï¼Œ&lt;code>fetch_add&lt;/code>åŒæ—¶è¯»å–æ—§å€¼å¹¶å†™å…¥æ–°å€¼ï¼š&lt;/p>
&lt;ul>
&lt;li>è¯»å–æ—¶ä½¿ç”¨&lt;code>acquire&lt;/code>è¯­ä¹‰ï¼Œç¡®ä¿å®ƒèƒ½çœ‹åˆ°å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹ã€‚&lt;/li>
&lt;li>å†™å…¥æ—¶ä½¿ç”¨&lt;code>release&lt;/code>è¯­ä¹‰ï¼Œç¡®ä¿å®ƒçš„ä¿®æ”¹èƒ½è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="memory_order_seq_csté¡ºåºä¸€è‡´æ€§æœ€ä¸¥æ ¼">&lt;code>memory_order_seq_cst&lt;/code>ï¼ˆé¡ºåºä¸€è‡´æ€§ï¼Œæœ€ä¸¥æ ¼ï¼‰ &lt;a href="#memory_order_seq_cst%e9%a1%ba%e5%ba%8f%e4%b8%80%e8%87%b4%e6%80%a7%e6%9c%80%e4%b8%a5%e6%a0%bc" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;strong>ç‰¹ç‚¹&lt;/strong>ï¼šæ‰€æœ‰ä½¿ç”¨&lt;code>memory_order_seq_cst&lt;/code>çš„åŸå­æ“ä½œåœ¨&lt;strong>æ‰€æœ‰çº¿ç¨‹çœ‹æ¥&lt;/strong>éƒ½æ˜¯æŒ‰ç…§ç›¸åŒçš„é¡ºåºæ‰§è¡Œçš„ï¼Œå³å…¨å±€ä¸€è‡´çš„æ—¶åºã€‚&lt;/li>
&lt;li>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼š
&lt;ul>
&lt;li>éœ€è¦ä¸¥æ ¼åŒæ­¥çš„åœºæ™¯ï¼Œå¦‚&lt;strong>é”&lt;/strong>ã€&lt;strong>åŒæ­¥å˜é‡&lt;/strong>ã€&lt;strong>ä¸´ç•ŒåŒºä¿æŠ¤&lt;/strong>ç­‰ã€‚&lt;/li>
&lt;li>é€‚ç”¨äº&lt;strong>å¤šçº¿ç¨‹äº¤äº’å¤æ‚&lt;/strong>ã€éš¾ä»¥ç®¡ç†ä¾èµ–å…³ç³»çš„æƒ…å†µã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¿è¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>seq_cst&lt;/code>ç¡®ä¿æ‰€æœ‰æ“ä½œä¸¥æ ¼æŒ‰ç…§å…¨å±€ç»Ÿä¸€é¡ºåºæ‰§è¡Œï¼Œé¿å…ä¹±åºé—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ç›´è§‚æ¯”å–»">ç›´è§‚æ¯”å–» &lt;a href="#%e7%9b%b4%e8%a7%82%e6%af%94%e5%96%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;code>relaxed&lt;/code>ï¼šéšæ„å†™ç¬”è®°ï¼Œä½†ä¸ä¿è¯åˆ«äººèƒ½çœ‹åˆ°ã€‚&lt;/li>
&lt;li>&lt;code>acquire&lt;/code>ï¼š&lt;strong>è¿›é—¨æ£€æŸ¥å…¬å‘Šæ &lt;/strong>ï¼Œç¡®ä¿çœ‹åˆ°ä¹‹å‰çš„é€šçŸ¥ã€‚&lt;/li>
&lt;li>&lt;code>release&lt;/code>ï¼š&lt;strong>ç¦»å¼€æ—¶æ›´æ–°å…¬å‘Šæ &lt;/strong>ï¼Œè®©åæ¥çš„äººçœ‹åˆ°ã€‚&lt;/li>
&lt;li>&lt;code>acq_rel&lt;/code>ï¼š&lt;strong>è¿›é—¨çœ‹å…¬å‘Š + èµ°å‰æ›´æ–°å…¬å‘Š&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;code>seq_cst&lt;/code>ï¼š&lt;strong>æ‰€æœ‰äººæŒ‰åŒæ ·é¡ºåºå†™ã€çœ‹å…¬å‘Š&lt;/strong>ï¼Œä¿è¯ä¸€è‡´æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ ¹æ®ä¸åŒåœºæ™¯åˆç†é€‰æ‹©å†…å­˜åºï¼Œå¯ä»¥æé«˜å¹¶å‘ç¨‹åºçš„æ­£ç¡®æ€§å’Œæ€§èƒ½ã€‚&lt;/p>
&lt;h3 id="ä¼˜åŒ–æ§åˆ¶å—ä¸­çš„åŸå­å˜é‡">ä¼˜åŒ–æ§åˆ¶å—ä¸­çš„åŸå­å˜é‡ &lt;a href="#%e4%bc%98%e5%8c%96%e6%8e%a7%e5%88%b6%e5%9d%97%e4%b8%ad%e7%9a%84%e5%8e%9f%e5%ad%90%e5%8f%98%e9%87%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;atomic&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">control_block&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> control_block(T&lt;span style="color:#f92672">*&lt;/span> ptr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> ref_count(&lt;span style="color:#ae81ff">1&lt;/span>), weak_count(&lt;span style="color:#ae81ff">1&lt;/span>), obj(ptr) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ref_count.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_relaxed);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°è¯•å¢åŠ å¼ºå¼•ç”¨è®¡æ•°ï¼ˆä»…å½“å¯¹è±¡ä»ç„¶å­˜æ´»æ—¶ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">lock&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> prev &lt;span style="color:#f92672">=&lt;/span> ref_count.load(std&lt;span style="color:#f92672">::&lt;/span>memory_order_acquire);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (prev &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ref_count.compare_exchange_weak(prev, prev &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>memory_order_acquire, std&lt;span style="color:#f92672">::&lt;/span>memory_order_relaxed)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true; &lt;span style="color:#75715e">// æˆåŠŸé”å®š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false; &lt;span style="color:#75715e">// å¯¹è±¡å·²è¢«é‡Šæ”¾
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡Šæ”¾å¼ºå¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ref_count.fetch_sub(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_acq_rel) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> obj; &lt;span style="color:#75715e">// åˆ é™¤å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> release_control_block(); &lt;span style="color:#75715e">// å°è¯•åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¢åŠ å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_weak_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> weak_count.fetch_add(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_relaxed);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é‡Šæ”¾å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release_weak_ref&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (weak_count.fetch_sub(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_acq_rel) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>; &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">get&lt;/span>() { &lt;span style="color:#66d9ef">return&lt;/span> obj; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—ï¼Œä»…å½“å¼±å¼•ç”¨è®¡æ•°ä¹Ÿå½’é›¶æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> release_control_block() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (weak_count.fetch_sub(&lt;span style="color:#ae81ff">1&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>memory_order_acq_rel) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">delete&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>; &lt;span style="color:#75715e">// åˆ é™¤æ§åˆ¶å—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> ref_count; &lt;span style="color:#75715e">// å¼ºå¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>atomic&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> weak_count; &lt;span style="color:#75715e">// å¼±å¼•ç”¨è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> obj; &lt;span style="color:#75715e">// å®é™…å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‚è€ƒ">å‚è€ƒ &lt;a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/532215950">C++å†…å­˜ç®¡ç†ï¼šshared_ptr/weak_ptræºç &lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.cnblogs.com/Solstice/archive/2010/02/10/dtor_meets_threads.html">å½“ææ„å‡½æ•°é‡åˆ°å¤šçº¿ç¨‹ â”€â”€ C++ ä¸­çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡å›è°ƒ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://liam.page/2021/12/11/memory-order-cpp-02/">ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼ˆâ‘«ï¼‰ï¼šC++ çš„å†…å­˜é¡ºåº&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>std::visitå®ç°è¿è¡Œæ—¶å¤šæ€ - C++ for the Antiquatedï¼ˆä¹‹ä¸‰ï¼‰</title><link>https://wizmann.top/posts/std-visit-polymorphism-cpp-for-the-antiquated-3/</link><pubDate>Sat, 04 Jan 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/std-visit-polymorphism-cpp-for-the-antiquated-3/</guid><description>&lt;p>åœ¨ä¼ ç»Ÿçš„ &lt;strong>C++&lt;/strong> ä¸­ï¼Œ&lt;strong>è¿è¡Œæ—¶å¤šæ€&lt;/strong> é€šå¸¸ä¾èµ–äº &lt;strong>â€œæ¥å£ - è™šå‡½æ•°â€&lt;/strong> æœºåˆ¶ï¼Œé€šè¿‡æŠ½è±¡ç±»ã€å…·ä½“ç±»ä¸å¯¹è±¡çš„è®¾è®¡æ¥å®ç°ã€‚è¿™ç§å¤šæ€æ–¹å¼é€šå¸¸è¢«ç§°ä¸º &lt;strong>å­ç±»å‹å¤šæ€&lt;/strong>ï¼ˆ&lt;em>Subtype Polymorphism&lt;/em>ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ç°ä»£ C++ å¼•å…¥çš„ &lt;code>std::variant&lt;/code> â€”â€” ä¸€ç§ç±»å‹å®‰å…¨çš„è”åˆä½“ï¼Œä»¥åŠå¦‚ä½•å€ŸåŠ© &lt;code>std::visit&lt;/code> åœ¨ç±»å‹å®‰å…¨çš„å‰æä¸‹ï¼ŒåŠ¨æ€åœ°è®¿é—®è”åˆä½“ä¸­çš„ä¸åŒç±»å‹ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚è¿™ç§å¤šæ€æ–¹å¼è¢«ç§°ä¸º &lt;strong>ä¸´æ—¶å¤šæ€&lt;/strong>ï¼ˆ&lt;em>Ad-hoc Polymorphism&lt;/em>ï¼‰ã€‚&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§è¢«ç§°ä¸º &lt;strong>å‚æ•°åŒ–å¤šæ€&lt;/strong>ï¼ˆ&lt;em>Parametric Polymorphism&lt;/em>ï¼‰ï¼Œå³æˆ‘ä»¬ç†ŸçŸ¥çš„ &lt;strong>C++ æ¨¡æ¿&lt;/strong>ã€‚å®ƒå…è®¸æˆ‘ä»¬ç¼–å†™ä¸ç±»å‹æ— å…³çš„ä»£ç ï¼Œæä¾›æ›´å¼ºçš„æ³›å‹ç¼–ç¨‹èƒ½åŠ›ã€‚ç”±äºæœ¬ç¯‡æ–‡ç« çš„é‡ç‚¹å¹¶ä¸åœ¨æ­¤ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸å±•å¼€ã€‚&lt;/p>
&lt;p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å¯¹æ¯” &lt;strong>å­ç±»å‹å¤šæ€&lt;/strong> å’Œ &lt;strong>ä¸´æ—¶å¤šæ€&lt;/strong> çš„ä¼˜åŠ£ï¼Œåˆ†æå®ƒä»¬åœ¨å®é™…åœºæ™¯ä¸­çš„åº”ç”¨ä¸æƒè¡¡ï¼Œå¸Œæœ›èƒ½æ›´å¥½åœ°ç†è§£å’Œé€‰æ‹©åˆé€‚çš„å¤šæ€æœºåˆ¶ã€‚&lt;/p>
&lt;h2 id="ä¸´æ—¶å¤šæ€çš„å®ç°åŸç†">&lt;strong>ä¸´æ—¶å¤šæ€çš„å®ç°åŸç†&lt;/strong> &lt;a href="#%e4%b8%b4%e6%97%b6%e5%a4%9a%e6%80%81%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;strong>ä¸´æ—¶å¤šæ€&lt;/strong>ï¼ˆ&lt;em>Ad-hoc Polymorphism&lt;/em>ï¼‰ä¸ &lt;strong>å­ç±»å‹å¤šæ€&lt;/strong>ï¼ˆ&lt;em>Subtype Polymorphism&lt;/em>ï¼‰åœ¨å®ç°åŸç†ä¸Šæœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼šå®ƒä»¬éƒ½ä¾èµ–äºåœ¨ç±»å‹ä¸­å¼•å…¥é¢å¤–çš„ä¿¡æ¯æ¥å†³å®šä¸åŒç±»å‹åº”æ‰§è¡Œçš„å‡½æ•°é€»è¾‘ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å­ç±»å‹å¤šæ€&lt;/strong>ï¼šä¾èµ–äº&lt;strong>è™šè¡¨ï¼ˆvtableï¼‰&lt;/strong> å’Œ &lt;strong>è™šæŒ‡é’ˆï¼ˆvptrï¼‰&lt;/strong>ï¼Œé€šè¿‡è¿è¡Œæ—¶çš„åŠ¨æ€åˆ†æ´¾æ¥ç¡®å®šè°ƒç”¨å“ªä¸ªæ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸´æ—¶å¤šæ€&lt;/strong>ï¼šä¾èµ–ä¸€ä¸ª &lt;strong>æšä¸¾å€¼ï¼ˆenumï¼‰&lt;/strong> æ¥è¡¨ç¤ºç±»å‹ä¿¡æ¯ï¼Œé€šè¿‡æ˜¾å¼çš„ &lt;code>switch-case&lt;/code> æˆ– &lt;code>if-else&lt;/code> è¯­å¥æ¥é€‰æ‹©ä¸åŒçš„é€»è¾‘åˆ†æ”¯ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ç®€å•ç¤ºä¾‹æ¨¡æ‹Ÿ-stdvisit">&lt;strong>ç®€å•ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿ std::visit&lt;/strong> &lt;a href="#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b%e6%a8%a1%e6%8b%9f-stdvisit" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>è¿™é‡Œåªä½¿ç”¨äº†ä¼ ç»ŸC++çš„å®ç°ï¼Œå…³äº&lt;code>std::visit&lt;/code>çš„æ›´è¯¦ç»†çš„è§£è¯»ï¼Œå¯ä»¥å‚è€ƒæœ¬ç³»åˆ—çš„â€œåŠ¨æ‰‹å®ç°std::visitâ€ä¸€æ–‡ã€‚&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cassert&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">EType&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">uint8_t&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TYPE_Int &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TYPE_Float &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TYPE_String &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyVariant&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> EType type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span> obj;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">MyVisitor&lt;/span>(MyVariant&lt;span style="color:#f92672">&amp;amp;&lt;/span> var) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (var.type) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> TYPE_Int:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Int: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)var.obj &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> TYPE_Float:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Float: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">float&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)var.obj &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> TYPE_String:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;String: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(std&lt;span style="color:#f92672">::&lt;/span>string&lt;span style="color:#f92672">*&lt;/span>)var.obj &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(false &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Unknown type!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">float&lt;/span> f &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">3.14f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>string s &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Hello&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVariant var1 &lt;span style="color:#f92672">=&lt;/span> {TYPE_Int, &lt;span style="color:#f92672">&amp;amp;&lt;/span>i};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVariant var2 &lt;span style="color:#f92672">=&lt;/span> {TYPE_Float, &lt;span style="color:#f92672">&amp;amp;&lt;/span>f};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVariant var3 &lt;span style="color:#f92672">=&lt;/span> {TYPE_String, &lt;span style="color:#f92672">&amp;amp;&lt;/span>s};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVisitor(var1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVisitor(var2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVisitor(var3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åŸç†è§£æ">&lt;strong>åŸç†è§£æ&lt;/strong> &lt;a href="#%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ol>
&lt;li>&lt;strong>EType æšä¸¾&lt;/strong>
&lt;ul>
&lt;li>å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹ &lt;code>EType&lt;/code>ï¼Œç”¨äºæ ‡è¯† &lt;code>MyVariant&lt;/code> å½“å‰å­˜å‚¨çš„å…·ä½“ç±»å‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>MyVariant ç»“æ„ä½“&lt;/strong>
&lt;ul>
&lt;li>&lt;code>type&lt;/code> å­—æ®µä¿å­˜å½“å‰å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚&lt;/li>
&lt;li>&lt;code>obj&lt;/code> å­—æ®µæ˜¯ä¸€ä¸ªé€šç”¨æŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…å­˜å‚¨çš„æ•°æ®å¯¹è±¡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>MyVisitor å‡½æ•°&lt;/strong>
&lt;ul>
&lt;li>é€šè¿‡ &lt;code>switch-case&lt;/code> è¯­å¥ï¼ŒåŸºäº &lt;code>type&lt;/code> å­—æ®µé€‰æ‹©ä¸åŒçš„åˆ†æ”¯é€»è¾‘æ¥è®¿é—®å’Œæ‰“å°ä¸åŒç±»å‹çš„æ•°æ®ã€‚&lt;/li>
&lt;li>å¦‚æœé‡åˆ°æœªçŸ¥ç±»å‹ï¼Œç¨‹åºä¼šè§¦å‘ &lt;code>assert&lt;/code> ä»¥é˜²æ­¢æœªå®šä¹‰è¡Œä¸ºã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–æ€è€ƒ">&lt;strong>æ€§èƒ½ä¼˜åŒ–æ€è€ƒ&lt;/strong> &lt;a href="#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e6%80%9d%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ&lt;code>switch-case&lt;/code> è¯­å¥å¯èƒ½éšç€ç±»å‹æ•°é‡çš„å¢åŠ è€Œå¯¼è‡´æ€§èƒ½å¼€é”€ã€‚å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ï¼ˆBinary Searchï¼‰æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘ &lt;code>switch-case&lt;/code> çš„åˆ†æ”¯æ·±åº¦ã€‚&lt;/p>
&lt;h2 id="ä¸´æ—¶å¤šæ€çš„æ€§èƒ½åˆ†æ">ä¸´æ—¶å¤šæ€çš„æ€§èƒ½åˆ†æ &lt;a href="#%e4%b8%b4%e6%97%b6%e5%a4%9a%e6%80%81%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è™šå‡½æ•°å¸¸å› å…¶è¾ƒä½çš„æ€§èƒ½è€Œå—åˆ°æ‰¹è¯„ã€‚ä¸ºäº†æ›´å¥½åœ°äº†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†å¯¹æ¯”ä½¿ç”¨è™šå‡½æ•°å®ç°çš„â€œå­ç±»å‹å¤šæ€â€å’Œé€šè¿‡ &lt;code>std::visit&lt;/code> å®ç°çš„â€œä¸´æ—¶å¤šæ€â€åœ¨æ€§èƒ½ä¸Šçš„å·®å¼‚ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨è™šå‡½æ•°å®ç°çš„&lt;a href="https://gist.github.com/Wizmann/df65af6d214c3b4ae296363839477b94">ä»£ç &lt;/a>&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>std::visit&lt;/code> + &lt;code>std::variant&amp;lt;object&amp;gt;&lt;/code> å®ç°çš„&lt;a href="https://gist.github.com/Wizmann/f1494312a8e0cf30b97e9d8580fa9d6d">ä»£ç &lt;/a>&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>std::visit&lt;/code> + &lt;code>std::variant&amp;lt;ptr&amp;gt;&lt;/code> å®ç°çš„&lt;a href="https://gist.github.com/Wizmann/a25708bcd732df8f6e3d158f7105b6c9">ä»£ç &lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ç»“æœå¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code># ä½¿ç”¨g++ --std=c++17 -O2ç¼–è¯‘è¿è¡Œ
# ä½¿ç”¨è™šå‡½æ•°å®ç°
Total Object Creation Time: 55.53 ms
Total Visit Time: 6.99 ms
# ä½¿ç”¨std::visit + std::variant&amp;lt;object&amp;gt;å®ç°
Total Object Creation Time: 26.88 ms
Total Visit Time: 5.93 ms
# ä½¿ç”¨std::visit + std::variant&amp;lt;ptr&amp;gt;å®ç°
Total Object Creation Time: 52.15 ms
Total Visit Time: 6.05 ms
&lt;/code>&lt;/pre>&lt;h3 id="ç»“æœåˆ†æ">ç»“æœåˆ†æ &lt;a href="#%e7%bb%93%e6%9e%9c%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å†…å­˜ç®¡ç†å¼€é”€ï¼š
ä½¿ç”¨è™šå‡½æ•°çš„å­ç±»å‹å¤šæ€å®ç°é€šå¸¸éœ€è¦åŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œä»è€Œå¼•å…¥äº†é¢å¤–çš„å†…å­˜ç®¡ç†å¼€é”€ã€‚è€Œä½¿ç”¨åŸºäº &lt;code>std::variant&amp;lt;object&amp;gt;&lt;/code>çš„ä¸´æ—¶å¤šæ€å¯ä»¥ä¸€æ¬¡æ€§åˆ†é…æ‰€æœ‰å†…å­˜ï¼Œè™½ç„¶å¯èƒ½å­˜åœ¨ä¸€å®šç¨‹åº¦çš„å†…å­˜æµªè´¹ï¼Œä½†é¿å…äº†é¢‘ç¹çš„åŠ¨æ€å†…å­˜ç®¡ç†ã€‚&lt;/li>
&lt;li>æ€§èƒ½æ¥è¿‘ï¼Œ&lt;code>std::visit&lt;/code> ç•¥ä¼˜ï¼š
è™½ç„¶è™šå‡½æ•°å’Œ &lt;code>std::visit&lt;/code> çš„æ€§èƒ½å·®è·ä¸å¤§ï¼Œä½† &lt;code>std::visit&lt;/code> ç•¥å¾®ä¼˜äºè™šå‡½æ•°ã€‚ä¸¤è€…éƒ½å¼•å…¥äº†é¢å¤–çš„å¼€é”€ä»¥å®ç°å¤šæ€ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="é€šè¿‡ä¸´æ—¶å¤šæ€å®ç°vistoræ¨¡å¼">é€šè¿‡ä¸´æ—¶å¤šæ€å®ç°Vistoræ¨¡å¼ &lt;a href="#%e9%80%9a%e8%bf%87%e4%b8%b4%e6%97%b6%e5%a4%9a%e6%80%81%e5%ae%9e%e7%8e%b0vistor%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Visitoræ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†æ•°æ®ç»“æ„çš„æ“ä½œä¸æ•°æ®ç»“æ„æœ¬èº«åˆ†ç¦»ã€‚å®ƒé€šå¸¸é€šè¿‡â€œå­ç±»å‹å¤šæ€â€æ¥å®ç°ï¼Œå…¶ä¸­æ¯ä¸ªå…·ä½“ç±»å‹çš„å¯¹è±¡éƒ½æ¥å—ä¸€ä¸ªè®¿é—®è€…ï¼ˆVisitorï¼‰å¹¶å¯¹å…¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ä½¿ç”¨è™šå‡½æ•°å’Œç»§æ‰¿æ˜¯å®ç°è¿™ä¸€æ¨¡å¼çš„ä¸€ç§æ–¹å¼ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¯ä»¥ç”¨æ›´è½»é‡çš„æ–¹å¼æ¥å®ç°ï¼Œæ¯”å¦‚é€šè¿‡ä¸´æ—¶å¤šæ€ç»“åˆ &lt;code>std::variant&lt;/code> å’Œ &lt;code>std::visit&lt;/code>ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨è™šå‡½æ•°å®ç°visitoræ¨¡å¼">ä½¿ç”¨è™šå‡½æ•°å®ç°Visitoræ¨¡å¼ &lt;a href="#%e4%bd%bf%e7%94%a8%e8%99%9a%e5%87%bd%e6%95%b0%e5%ae%9e%e7%8e%b0visitor%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸ªä¼ ç»Ÿçš„é€šè¿‡å­ç±»å‹å¤šæ€å®ç°Visitoræ¨¡å¼çš„ä¾‹å­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IVisitor&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IResource&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">accept&lt;/span>(IVisitor&lt;span style="color:#f92672">*&lt;/span> visitor) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IVisitor&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">visit&lt;/span>(IResource&lt;span style="color:#f92672">*&lt;/span> res) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyResource&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IResource {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> accept(IVisitor&lt;span style="color:#f92672">*&lt;/span> visitor) &lt;span style="color:#66d9ef">override&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visitor&lt;span style="color:#f92672">-&amp;gt;&lt;/span>visit(&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyVisitor&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IVisitor {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> visit(IResource&lt;span style="color:#f92672">*&lt;/span> res) &lt;span style="color:#66d9ef">override&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§å®ç°æ–¹å¼è™½ç„¶èƒ½å¾ˆå¥½åœ°åˆ†ç¦»æ•°æ®å’Œæ“ä½œï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡è°ƒç”¨ &lt;code>visit&lt;/code> éƒ½éœ€è¦é€šè¿‡è™šå‡½æ•°æ¥é—´æ¥è°ƒç”¨æ–¹æ³•ï¼Œè¿™ä¼šå¼•å…¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;code>visitor&lt;/code> æ— æ³•åœ¨ &lt;code>visit&lt;/code> æ—¶ç›´æ¥è·å–èµ„æºå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œé€šå¸¸éœ€è¦é¢å¤–ä¼ é€’ç±»å‹ä¿¡æ¯æˆ–è€…è®©èµ„æºç±»æš´éœ²æ›´å¤šçš„æ¥å£ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨-stdvisit-å®ç°visitoræ¨¡å¼">ä½¿ç”¨ &lt;code>std::visit&lt;/code> å®ç°Visitoræ¨¡å¼ &lt;a href="#%e4%bd%bf%e7%94%a8-stdvisit-%e5%ae%9e%e7%8e%b0visitor%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é€šè¿‡ &lt;code>std::visit&lt;/code> å’Œ &lt;code>std::variant&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°é€šè¿‡ç±»å‹ä¿¡æ¯æ¥å¤„ç†æ¯ç§èµ„æºç±»å‹ï¼Œé¿å…äº†è™šå‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼ŒåŒæ—¶ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œç±»å‹å®‰å…¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡ä¸´æ—¶å¤šæ€å®ç°Visitoræ¨¡å¼çš„ä¾‹å­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> ResourceUnion &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>variant&lt;span style="color:#f92672">&amp;lt;&lt;/span>ResourceA, ResourceB, ResourceC&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>ResourceUnion&lt;span style="color:#f92672">&amp;gt;&lt;/span> resources;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> res : resources) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>visit([](&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> T &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>decay_t&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">decltype&lt;/span>(res)&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, ResourceA&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç±»å‹ä¸º ResourceA çš„èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, ResourceB&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç±»å‹ä¸º ResourceB çš„èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, ResourceC&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¤„ç†ç±»å‹ä¸º ResourceC çš„èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static_assert&lt;/span>(always_false_v&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Unhandled type!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, res);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¼˜ç‚¹ä¸åˆ†æ">ä¼˜ç‚¹ä¸åˆ†æ &lt;a href="#%e4%bc%98%e7%82%b9%e4%b8%8e%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç±»å‹å®‰å…¨&lt;/strong>ï¼š
ä½¿ç”¨ &lt;code>std::visit&lt;/code> æ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®ç±»å‹æ¨æ–­å¹¶ä¸ºæ¯ç§ç±»å‹ç”Ÿæˆä¸åŒçš„ä»£ç è·¯å¾„ï¼Œä»è€Œé¿å…äº†è¿è¡Œæ—¶é”™è¯¯å’Œç±»å‹é”™è¯¯ï¼Œæå‡äº†ç±»å‹å®‰å…¨æ€§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½&lt;/strong>ï¼š
ç”±äºä¸å†ä¾èµ–è™šå‡½æ•°ï¼Œ&lt;code>std::visit&lt;/code> èƒ½é¿å…æ¯æ¬¡è°ƒç”¨ &lt;code>visit&lt;/code> æ—¶çš„è™šå‡½æ•°å¼€é”€ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç®€æ´æ€§&lt;/strong>ï¼š
é€šè¿‡ &lt;code>std::variant&lt;/code> å’Œ &lt;code>std::visit&lt;/code>ï¼Œä»£ç æ›´åŠ ç®€æ´ä¸”ä¸éœ€è¦ç¹ççš„ç»§æ‰¿ç»“æ„ã€‚æ¯ä¸ªèµ„æºç±»å‹åªéœ€å…³æ³¨å…¶è‡ªèº«çš„å®ç°ï¼Œè€Œæ— éœ€å¤„ç†ä¸åŒè®¿é—®è€…çš„é€»è¾‘ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ‰©å±•æ€§&lt;/strong>ï¼š
å¦‚æœè¦æ–°å¢èµ„æºç±»å‹ï¼Œåªéœ€åœ¨ &lt;code>std::variant&lt;/code> ä¸­æ·»åŠ æ–°ç±»å‹ï¼Œå¹¶åœ¨ &lt;code>std::visit&lt;/code> çš„ lambda è¡¨è¾¾å¼ä¸­æ·»åŠ å¯¹åº”çš„åˆ†æ”¯ï¼Œé¿å…äº†ä¿®æ”¹ç°æœ‰ä»£ç çš„é£é™©ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä¸´æ—¶å¤šæ€çš„ä¼˜ç‚¹ä¸ç¼ºç‚¹">ä¸´æ—¶å¤šæ€çš„ä¼˜ç‚¹ä¸ç¼ºç‚¹ &lt;a href="#%e4%b8%b4%e6%97%b6%e5%a4%9a%e6%80%81%e7%9a%84%e4%bc%98%e7%82%b9%e4%b8%8e%e7%bc%ba%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹ï¼š &lt;a href="#%e4%bc%98%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ol>
&lt;li>&lt;strong>ç±»å‹å®‰å…¨&lt;/strong>ï¼š&lt;code>std::variant&lt;/code> ä¸ &lt;code>std::visit&lt;/code> ç¡®ä¿äº†ç±»å‹å®‰å…¨ï¼Œé¿å…äº†è®¸å¤šä¼ ç»Ÿå¤šæ€æœºåˆ¶ä¸­çš„é”™è¯¯ã€‚&lt;/li>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong>ï¼šç›¸è¾ƒäºè™šå‡½æ•°ï¼Œ&lt;code>std::visit&lt;/code> é€šè¿‡ç±»å‹æŠ˜å å’Œç¼–è¯‘æ—¶åˆ†æ”¯ä¼˜åŒ–ï¼Œé€šå¸¸è¡¨ç°å‡ºæ›´å¥½çš„æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ²¡æœ‰åŠ¨æ€å†…å­˜ç®¡ç†æ—¶ã€‚&lt;/li>
&lt;li>&lt;strong>è‡ªç”±ç»„ç»‡åŠŸèƒ½å‡½æ•°&lt;/strong>ï¼šä½ å¯ä»¥çµæ´»åœ°å°†åŠŸèƒ½å‡½æ•°ç»„ç»‡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè€Œæ— éœ€ä¿®æ”¹æ¯ä¸ªå…·ä½“ç±»å‹ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š &lt;a href="#%e7%bc%ba%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ol>
&lt;li>&lt;strong>èŒè´£åˆ†æ•£&lt;/strong>ï¼šæ¯ä¸ªç±»å‹çš„è¡Œä¸ºéƒ½å¯èƒ½åˆ†æ•£åˆ°å¤šä¸ª&lt;code>visit&lt;/code>å‡½æ•°ä¸­ï¼Œå¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚&lt;/li>
&lt;li>&lt;strong>é«˜è€¦åˆé£é™©&lt;/strong>ï¼šå½“æ–°å¢ç±»å‹æ—¶ï¼Œæ‰€æœ‰è®¿é—®é€»è¾‘éœ€è¦ä¿®æ”¹ï¼Œå¯èƒ½å¸¦æ¥è¾ƒé«˜çš„è€¦åˆåº¦ï¼Œå°¤å…¶åœ¨ç±»å‹è¾ƒå¤šæ—¶ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ &lt;a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>C++20é«˜çº§ç¼–ç¨‹ï¼ˆç½—èƒ½ï¼‰ â€”â€” 1.6 è¿è¡Œæ—¶å¤šæ€&lt;/li>
&lt;li>&lt;a href="https://wiyi.org/polymorphism-in-java.html">æ·±å…¥ç†è§£é¢å‘å¯¹è±¡ä¸­çš„å¤šæ€&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://refactoringguru.cn/design-patterns/visitor/cpp/example">C++ è®¿é—®è€…æ¨¡å¼è®²è§£å’Œä»£ç ç¤ºä¾‹&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>åŠ¨æ‰‹å®ç°std::visit - C++ for the Antiquatedï¼ˆä¹‹äºŒï¼‰</title><link>https://wizmann.top/posts/std-visit-cpp-for-the-antiquated-2/</link><pubDate>Wed, 01 Jan 2025 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/std-visit-cpp-for-the-antiquated-2/</guid><description>&lt;h2 id="stdvariant-ä¸-stdvisit">std::variant ä¸ std::visit &lt;a href="#stdvariant-%e4%b8%8e-stdvisit" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="stdvariant">std::variant &lt;a href="#stdvariant" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::variant&lt;/code> æ˜¯ C++17 å¼•å…¥çš„ç±»å‹å®‰å…¨çš„è”åˆä½“ï¼ˆtype-safe unionï¼‰ï¼Œå¯ä»¥åœ¨å¤šä¸ªé¢„å®šä¹‰ç±»å‹ä¸­å­˜å‚¨ä»»æ„ä¸€ä¸ªå€¼ã€‚ä¸ä¼ ç»Ÿçš„ &lt;code>union&lt;/code> ä¸åŒï¼Œ&lt;code>std::variant&lt;/code> èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶å®‰å…¨åœ°æ£€æŸ¥å½“å‰å­˜å‚¨çš„ç±»å‹ï¼Œé¿å…æœªå®šä¹‰è¡Œä¸ºã€‚&lt;/p>
&lt;p>å…¶æ ¸å¿ƒç‰¹ç‚¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç±»å‹å®‰å…¨ï¼šè®¿é—®å€¼æ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œé˜²æ­¢ç±»å‹é”™è¯¯ã€‚&lt;/li>
&lt;li>å›ºå®šç±»å‹é›†åˆï¼šå­˜å‚¨ç±»å‹åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚&lt;/li>
&lt;li>å¼‚å¸¸å®‰å…¨ï¼šåœ¨èµ‹å€¼å¤±è´¥æ—¶ä¼šè¿›å…¥æ— æ•ˆçŠ¶æ€ï¼ˆstd::monostateï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="stdvisit">std::visit &lt;a href="#stdvisit" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::visit&lt;/code> æ˜¯ä¸€ä¸ªè®¿é—®å™¨å‡½æ•°ï¼Œç”¨äºè®¿é—® &lt;code>std::variant&lt;/code> ä¸­å½“å‰å­˜å‚¨çš„å€¼ã€‚å®ƒé€šè¿‡ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚ Lambda è¡¨è¾¾å¼ï¼‰æ¥å¤„ç†å­˜å‚¨çš„å€¼ï¼Œä»è€Œå®ç°ç¼–è¯‘æ—¶å¤šæ€ã€‚&lt;/p>
&lt;p>å…¶æ ¸å¿ƒç‰¹ç‚¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç»Ÿä¸€è®¿é—®æ¥å£ï¼šæ— è®ºå­˜å‚¨çš„æ˜¯å“ªç§ç±»å‹ï¼Œéƒ½å¯ä»¥é€šè¿‡åŒä¸€ä¸ªå‡½æ•°è¿›è¡Œè®¿é—®ã€‚&lt;/li>
&lt;li>ç±»å‹å®‰å…¨ï¼šç¡®ä¿æ‰€æœ‰å¯èƒ½çš„ç±»å‹éƒ½è¢«æ­£ç¡®å¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹ &lt;a href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;variant&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;type_traits&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> always_false_v &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>std&lt;span style="color:#f92672">::&lt;/span>variant&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#66d9ef">float&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>string&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> items {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">3.14f&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;foobar&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> item : items) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>visit([](&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> arg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> T &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>decay_t&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">decltype&lt;/span>(arg)&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;int: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> arg &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, &lt;span style="color:#66d9ef">float&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;float: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> arg &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_same_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, std&lt;span style="color:#f92672">::&lt;/span>string&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;std::string: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> arg &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static_assert&lt;/span>(always_false_v&lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Unhandled type!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, item);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ &lt;a href="#%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>&lt;code>std::variant&amp;lt;int, float, std::string&amp;gt;&lt;/code>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è¿™æ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„è”åˆä½“ï¼Œå¯ä»¥å­˜å‚¨ &lt;code>int&lt;/code>ã€&lt;code>float&lt;/code> æˆ– &lt;code>std::string&lt;/code> ä¸­çš„ä»»æ„ä¸€ç§ç±»å‹ã€‚&lt;/li>
&lt;li>å°†å¤šä¸ª &lt;code>std::variant&lt;/code> å­˜å‚¨åœ¨ &lt;code>std::vector&lt;/code> ä¸­ï¼Œå½¢æˆä¸€ä¸ªç»Ÿä¸€çš„å®¹å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>std::visit&lt;/code>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>std::visit&lt;/code> è®¿é—®æ¯ä¸ª &lt;code>std::variant&lt;/code> å…ƒç´ ã€‚&lt;/li>
&lt;li>ä¼ å…¥ä¸€ä¸ª&lt;strong>æ³›å‹ Lambda è¡¨è¾¾å¼&lt;/strong>ï¼Œé€šè¿‡ &lt;code>if constexpr&lt;/code> åœ¨ç¼–è¯‘æ—¶åˆ†å‘åˆ°ä¸åŒçš„åˆ†æ”¯ï¼Œå¤„ç†ä¸åŒç±»å‹çš„å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>if constexpr&lt;/code> ä¸ &lt;code>std::is_same_v&lt;/code>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>std::is_same_v&lt;/code> åˆ¤æ–­å­˜å‚¨çš„å®é™…ç±»å‹ã€‚&lt;/li>
&lt;li>æ ¹æ®ç±»å‹è¿›è¡Œä¸åŒçš„è¾“å‡ºæ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç±»å‹å®‰å…¨&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¦‚æœæ·»åŠ ä¸€ä¸ªæœªå¤„ç†çš„ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ &lt;code>static_assert&lt;/code> ä¸­æŠ¥é”™ï¼Œæé†’å¼€å‘è€…è¡¥å……å¤„ç†é€»è¾‘ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä½¿ç”¨ä¼ ç»Ÿcå®ç°stdvisit">ä½¿ç”¨ä¼ ç»ŸC++å®ç°std::visit &lt;a href="#%e4%bd%bf%e7%94%a8%e4%bc%a0%e7%bb%9fc%e5%ae%9e%e7%8e%b0stdvisit" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="å®ç°stdvariant">å®ç°std::variant &lt;a href="#%e5%ae%9e%e7%8e%b0stdvariant" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ç®€å•çš„ &lt;code>union&lt;/code> æ¥å®ç°â€œè”åˆä½“â€è¯­ä¹‰ã€‚ç„¶è€Œï¼Œ&lt;code>union&lt;/code> å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>æ— æ³•å­˜å‚¨éå¹³å‡¡ç±»å‹ï¼ˆä¾‹å¦‚ &lt;code>std::string&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>æ— æ³•è·Ÿè¸ªå½“å‰å­˜å‚¨çš„ç±»å‹ã€‚&lt;/li>
&lt;li>æ— æ³•è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥ã€‚&lt;/li>
&lt;/ul>
&lt;p>è€Œ &lt;code>std::variant&lt;/code> é€šè¿‡ç±»å‹ç´¢å¼•å’Œç±»å‹åŒ¹é…æ¥æä¾›ç±»å‹å®‰å…¨ï¼Œæ”¯æŒå¤šç§ç±»å‹çš„å­˜å‚¨ä¸è®¿é—®ã€‚&lt;/p>
&lt;h3 id="å®ç°-stdvisit">å®ç° std::visit &lt;a href="#%e5%ae%9e%e7%8e%b0-stdvisit" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å®ç° &lt;code>std::visit&lt;/code> éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆä¾‹å¦‚ Visitorï¼‰æ¥è®¿é—® &lt;code>std::variant&lt;/code> ä¸­çš„å€¼ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶æ ¹æ®å®é™…ç±»å‹åŒ¹é…ç›¸åº”çš„ &lt;code>operator()&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;variant&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;type_traits&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Visitor&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">operator&lt;/span>()(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) &lt;span style="color:#66d9ef">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;int: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> item &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">operator&lt;/span>()(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">float&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) &lt;span style="color:#66d9ef">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;float: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> item &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">operator&lt;/span>()(&lt;span style="color:#66d9ef">const&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>string&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) &lt;span style="color:#66d9ef">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;string: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> item &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>variant&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#66d9ef">float&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>string&lt;span style="color:#f92672">&amp;gt;&lt;/span> item(&lt;span style="color:#ae81ff">114.514f&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–å½“å‰ç±»å‹çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> item.index() &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// è¾“å‡º: 1 (float çš„ç´¢å¼•)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–å½“å‰å­˜å‚¨çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>get&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">float&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(item) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// è¾“å‡º: 114.514
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>get&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(item) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>bad_variant_access&lt;span style="color:#f92672">&amp;amp;&lt;/span> e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> e.what() &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// ç±»å‹ä¸åŒ¹é…ï¼ŒæŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨ Visitor è®¿é—®å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>visit(Visitor{}, item) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// è¾“å‡º: 1 (float ç±»å‹è¿”å› 1)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®ç°çš„æ ¸å¿ƒè¦ç‚¹">å®ç°çš„æ ¸å¿ƒè¦ç‚¹ &lt;a href="#%e5%ae%9e%e7%8e%b0%e7%9a%84%e6%a0%b8%e5%bf%83%e8%a6%81%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å®ç° &lt;code>std::visit&lt;/code> çš„å…³é”®åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>ç±»å‹ç´¢å¼• (&lt;code>index()&lt;/code>)&lt;/strong>&lt;br>
æ ¹æ®ä¼ å…¥çš„ &lt;code>std::variant&lt;/code> å‚æ•°ç±»å‹ï¼Œç¡®å®šå…¶åœ¨ç±»å‹é›†åˆä¸­çš„ç´¢å¼•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç±»å‹è®¿é—® (&lt;code>std::get&amp;lt;T&amp;gt;&lt;/code>)&lt;/strong>&lt;br>
æ ¹æ®ä¼ å…¥çš„æ¨¡æ¿ç±»å‹ &lt;code>T&lt;/code>ï¼Œè·å–å­˜å‚¨çš„å€¼ã€‚å¦‚æœç±»å‹ä¸åŒ¹é…ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œç¡®ä¿ç±»å‹å®‰å…¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç±»å‹åˆ†æ´¾ (&lt;code>std::visit&lt;/code>)&lt;/strong>&lt;br>
æ ¹æ®å½“å‰å­˜å‚¨çš„ç±»å‹ï¼Œè°ƒç”¨ &lt;code>Visitor&lt;/code> ä¸­å¯¹åº”çš„ &lt;code>operator()&lt;/code> æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡ &lt;code>switch-case&lt;/code> æˆ–æ¨¡æ¿åŒ¹é…æ¥å®ç°ç±»å‹åˆ†å‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä»£ç å®ç°0---åŸºæœ¬æ¡†æ¶">ä»£ç å®ç°0 - åŸºæœ¬æ¡†æ¶ &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b00---%e5%9f%ba%e6%9c%ac%e6%a1%86%e6%9e%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyVariant&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyVariant(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setValue(item);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> setValue(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TODO
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”¨äºå­˜å‚¨â€œè”åˆä½“â€çš„æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">union&lt;/span> &lt;span style="color:#a6e22e">Storage&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Storage() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">~&lt;/span>Storage() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>aligned_union_t&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, Ts...&lt;span style="color:#f92672">&amp;gt;&lt;/span> data;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } storage;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä»£ç å®ç°1---indexå‡½æ•°">ä»£ç å®ç°1 - index()å‡½æ•° &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b01---index%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬ä½¿ç”¨ç»å…¸çš„æ¨¡æ¿é€’å½’æ¥æŸ¥æ‰¾ç±»å‹å¯¹åº”çš„ç´¢å¼•ã€‚åŒæ—¶ï¼Œåˆ©ç”¨ &lt;code>constexpr&lt;/code> æ¥ç®€åŒ–ç¼–è¯‘æ—¶è®¡ç®—çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>std&lt;span style="color:#f92672">::&lt;/span>size_t N, &lt;span style="color:#66d9ef">typename&lt;/span>... Types&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> TupleElement &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">typename&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>tuple_element&lt;span style="color:#f92672">&amp;lt;&lt;/span>N, std&lt;span style="color:#f92672">::&lt;/span>tuple&lt;span style="color:#f92672">&amp;lt;&lt;/span>Types...&lt;span style="color:#f92672">&amp;gt;&amp;gt;::&lt;/span>type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T, &lt;span style="color:#66d9ef">typename&lt;/span>... Types&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">TypeIndex&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T, &lt;span style="color:#66d9ef">typename&lt;/span> First, &lt;span style="color:#66d9ef">typename&lt;/span>... Rest&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">TypeIndex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, First, Rest...&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>is_same&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, First&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span> (TypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, Rest...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">:&lt;/span> TypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, Rest...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">TypeIndex&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T, &lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> containsType() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> TypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å®ç°äº†åœ¨ç¼–è¯‘æœŸç¡®å®šä¼ å…¥ç±»å‹å¯¹åº”çš„ç±»å‹ç´¢å¼•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>setValue(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> TargetType &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>decay_t&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static_assert&lt;/span>(containsType&lt;span style="color:#f92672">&amp;lt;&lt;/span>TargetType&lt;span style="color:#f92672">&amp;gt;&lt;/span>(), &lt;span style="color:#e6db74">&amp;#34;Type not supported&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> (&lt;span style="color:#f92672">&amp;amp;&lt;/span>storage.data) TargetType(item);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> typeIndex &lt;span style="color:#f92672">=&lt;/span> getTypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>TargetType&lt;span style="color:#f92672">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä»£ç å®ç°2---get-å‡½æ•°">ä»£ç å®ç°2 - &lt;code>get()&lt;/code> å‡½æ•° &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b02---get-%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå‡½æ•° &lt;code>MyVariant::get()&lt;/code>ï¼Œé€šè¿‡æ£€æŸ¥ &lt;code>typeIndex&lt;/code> æ¥ç¡®ä¿è·å–çš„ç±»å‹ä¸å­˜å‚¨ç±»å‹ä¸€è‡´ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹Ÿèƒ½å¯ä»¥é€šè¿‡&lt;code>MyGet&lt;/code>å‡½æ•°æ¨¡æ‹Ÿ&lt;code>std::get&amp;lt;T&amp;gt;&lt;/code>å‡½æ•°çš„è¡Œä¸ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyVariant&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T, &lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>T&lt;span style="color:#f92672">&amp;amp;&lt;/span> MyGet(MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> var) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> var.&lt;span style="color:#66d9ef">template&lt;/span> get&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>T&lt;span style="color:#f92672">&amp;amp;&lt;/span> MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>get() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> TargetType &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>decay_t&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (TypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">!=&lt;/span> typeIndex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>runtime_error(&lt;span style="color:#e6db74">&amp;#34;Wrong type&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#66d9ef">reinterpret_cast&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>TargetType&lt;span style="color:#f92672">*&amp;gt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>storage.data);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä»£ç å®ç°3---visitå‡½æ•°">ä»£ç å®ç°3 - &lt;code>visit&lt;/code>å‡½æ•° &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b03---visit%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ¥ä¸‹æ¥æ˜¯ &lt;code>visit()&lt;/code> å‡½æ•°çš„å®ç°ã€‚å®ƒé€šè¿‡é€’å½’æ–¹å¼ä¾æ¬¡è®¿é—® &lt;code>std::variant&lt;/code> ä¸­çš„æ¯ç§ç±»å‹ï¼Œå¹¶è°ƒç”¨ä¸ä¹‹å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>std&lt;span style="color:#f92672">::&lt;/span>size_t N, &lt;span style="color:#66d9ef">typename&lt;/span>... Types&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> TupleElement &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">typename&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>tuple_element&lt;span style="color:#f92672">&amp;lt;&lt;/span>N, std&lt;span style="color:#f92672">::&lt;/span>tuple&lt;span style="color:#f92672">&amp;lt;&lt;/span>Types...&lt;span style="color:#f92672">&amp;gt;&amp;gt;::&lt;/span>type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> TVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">auto&lt;/span> MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>visit(TVisitor&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> visitor) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> FirstType &lt;span style="color:#f92672">=&lt;/span> TupleElement&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>, Ts...&lt;span style="color:#f92672">&amp;gt;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> RetT &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">decltype&lt;/span>(visitor(std&lt;span style="color:#f92672">::&lt;/span>declval&lt;span style="color:#f92672">&amp;lt;&lt;/span>FirstType&lt;span style="color:#f92672">&amp;gt;&lt;/span>()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> visitImpl&lt;span style="color:#f92672">&amp;lt;&lt;/span>RetT, TVisitor, Ts...&lt;span style="color:#f92672">&amp;gt;&lt;/span>(std&lt;span style="color:#f92672">::&lt;/span>forward&lt;span style="color:#f92672">&amp;lt;&lt;/span>TVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>(visitor));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> RetT, &lt;span style="color:#66d9ef">typename&lt;/span> TVisitor, &lt;span style="color:#66d9ef">typename&lt;/span> First, &lt;span style="color:#66d9ef">typename&lt;/span>... Rest&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RetT MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>visitImpl(TVisitor&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> visitor) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (getTypeIndex&lt;span style="color:#f92672">&amp;lt;&lt;/span>First&lt;span style="color:#f92672">&amp;gt;&lt;/span>() &lt;span style="color:#f92672">==&lt;/span> typeIndex) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">visitor&lt;/span>(get&lt;span style="color:#f92672">&amp;lt;&lt;/span>First&lt;span style="color:#f92672">&amp;gt;&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€’å½’è®¿é—®å‰©ä½™çš„ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> visitImpl&lt;span style="color:#f92672">&amp;lt;&lt;/span>RetT, TVisitor, Rest...&lt;span style="color:#f92672">&amp;gt;&lt;/span>(std&lt;span style="color:#f92672">::&lt;/span>forward&lt;span style="color:#f92672">&amp;lt;&lt;/span>TVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>(visitor));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span>... Ts&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> RetT, &lt;span style="color:#66d9ef">typename&lt;/span> TVisitor&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RetT MyVariant&lt;span style="color:#f92672">&amp;lt;&lt;/span>Ts...&lt;span style="color:#f92672">&amp;gt;::&lt;/span>visitImpl(&lt;span style="color:#a6e22e">[[maybe_unused]]&lt;/span>TVisitor&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> visitor) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŸºç¡€æƒ…å†µï¼šæ‰€æœ‰ç±»å‹éƒ½å·²æ£€æŸ¥ï¼Œæœªæ‰¾åˆ°åŒ¹é…çš„ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">throw&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>runtime_error(&lt;span style="color:#e6db74">&amp;#34;Wrong type&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆçš„ &lt;code>std::variant&lt;/code> å’Œ &lt;code>std::visit&lt;/code>ï¼Œé€šè¿‡ä¼ ç»Ÿ C++ å®ç°äº†ç±»å‹å®‰å…¨çš„è”åˆä½“æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬ä¾æ¬¡é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ„å»ºäº†è¿™ä¸€ç³»ç»Ÿï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>&lt;code>MyVariant&lt;/code> ç±»çš„åŸºæœ¬æ¡†æ¶&lt;/strong>ï¼šé€šè¿‡è”åˆä½“ (&lt;code>union&lt;/code>) å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ¨¡æ¿æ„é€ å‡½æ•°åŠ¨æ€è®¾ç½®å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç±»å‹ç´¢å¼• (&lt;code>index()&lt;/code>) çš„å®ç°&lt;/strong>ï¼šä½¿ç”¨æ¨¡æ¿é€’å½’æŠ€æœ¯ç»“åˆ &lt;code>constexpr&lt;/code> æ¥å®ç°ç±»å‹çš„ç¼–è¯‘æ—¶ç´¢å¼•æŸ¥æ‰¾ï¼Œä»è€Œåœ¨è¿è¡Œæ—¶æ ¹æ®ç±»å‹ç´¢å¼•æ¥è®¿é—®å¯¹åº”çš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>get()&lt;/code> å‡½æ•°&lt;/strong>ï¼šå®ç°äº†è·å–å­˜å‚¨å€¼çš„å‡½æ•°ï¼Œå¹¶é€šè¿‡ç±»å‹æ£€æŸ¥ç¡®ä¿ç±»å‹å®‰å…¨ã€‚å¦‚æœè®¿é—®äº†é”™è¯¯ç±»å‹çš„æ•°æ®ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&lt;code>visit()&lt;/code> å‡½æ•°&lt;/strong>ï¼šå®ç°äº†ä¸€ä¸ªå¯æ‰©å±•çš„è®¿é—®æœºåˆ¶ï¼Œä½¿å¾—ä¸åŒç±»å‹çš„å€¼å¯ä»¥é€šè¿‡åŒä¸€ä¸ª &lt;code>Visitor&lt;/code> è¢«è®¿é—®å’Œå¤„ç†ã€‚é€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œç³»ç»Ÿèƒ½å¤ŸåŠ¨æ€åœ°è®¿é—®ä¸åŒç±»å‹çš„å€¼ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>é€šè¿‡è¿™äº›å®ç°ï¼Œæˆ‘ä»¬æˆåŠŸæ¨¡æ‹Ÿäº† C++ æ ‡å‡†åº“ä¸­çš„ &lt;code>std::variant&lt;/code> å’Œ &lt;code>std::visit&lt;/code> åŠŸèƒ½ã€‚åŒæ—¶ï¼Œé€šè¿‡å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œç°ä»£ C++ æä¾›äº†æ›´å¼ºå¤§çš„æ¨¡æ¿å…ƒç¼–ç¨‹èƒ½åŠ›ã€‚åˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ›´ç›´è§‚çš„è¯­æ³•ï¼Œåœ¨ç¼–è¯‘æœŸé—´å®ç°é«˜æ•ˆä¸”ç±»å‹å®‰å…¨çš„è”åˆä½“è®¿é—®ï¼Œä»è€Œæä¾›ä¸€ç§çµæ´»ã€ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†å¤šç±»å‹æ•°æ®ã€‚&lt;/p></description></item><item><title>constexprè¯¦è§£ - C++ for the Antiquatedï¼ˆä¹‹ä¸€ï¼‰</title><link>https://wizmann.top/posts/constexpr-cpp-for-the-antiquated-1/</link><pubDate>Sat, 28 Dec 2024 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/constexpr-cpp-for-the-antiquated-1/</guid><description>&lt;p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®¨è®º C++ ä¸­çš„å¸¸é‡è¡¨è¾¾å¼ï¼ˆ&lt;code>constexpr&lt;/code>ï¼‰åŠå…¶ä¸ä¼ ç»Ÿçš„&lt;code>const&lt;/code>å¸¸é‡çš„åŒºåˆ«ï¼Œå¹¶ç»“åˆå®é™…ä»£ç ç¤ºä¾‹è¿›è¡Œè¯´æ˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¼šæ¢è®¨&lt;code>constexpr&lt;/code>å‡½æ•°åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­çš„åº”ç”¨ï¼Œä»¥åŠ C++11 ä¹‹åå¯¹å¸¸é‡è¡¨è¾¾å¼çš„ä¼˜åŒ–ä¸æ‰©å±•ã€‚&lt;/p>
&lt;h2 id="å¸¸é‡è¡¨è¾¾å¼constexpr">å¸¸é‡è¡¨è¾¾å¼ï¼ˆconstexprï¼‰ &lt;a href="#%e5%b8%b8%e9%87%8f%e8%a1%a8%e8%be%be%e5%bc%8fconstexpr" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ C++ ä¸­ï¼Œ&lt;code>const&lt;/code> å…³é”®å­—é€šå¸¸ç”¨äºä¿®é¥°å˜é‡ã€å¼•ç”¨å’ŒæŒ‡é’ˆï¼Œä½¿å¾—å®ƒä»¬åœ¨è¿è¡Œæ—¶ä¸èƒ½è¢«ä¿®æ”¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code>const&lt;/code> å¹¶æ²¡æœ‰åŒºåˆ†ç¼–è¯‘æœŸå¸¸é‡å’Œè¿è¡Œæ—¶å¸¸é‡ï¼Œå®ƒåªæ˜¯ä¿è¯äº†è¿™äº›å˜é‡åœ¨è¿è¡Œæ—¶ä¸å¯ä¿®æ”¹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œä½¿ç”¨ &lt;code>const&lt;/code> å£°æ˜çš„å˜é‡åœ¨è¿è¡Œæ—¶å…¶å€¼æ˜¯å›ºå®šçš„ï¼Œä½†å¹¶ä¸æ„å‘³ç€å®ƒä»¬åœ¨ç¼–è¯‘æ—¶å·²çŸ¥ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¼ ç»Ÿ C++ ä¸­ &lt;code>const&lt;/code> å…³é”®å­—çš„ä¸€äº›å¸¸è§ç”¨æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define CONSTANT_1 114514 &lt;/span>&lt;span style="color:#75715e">// å®ä¹Ÿæ˜¯ä¸€ç§å¸¸é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> helloworld1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;helloworld&amp;#34;&lt;/span>; &lt;span style="color:#75715e">// const å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; &lt;span style="color:#75715e">// å¸¸é‡å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value3 &lt;span style="color:#f92672">=&lt;/span> value1 &lt;span style="color:#f92672">+&lt;/span> value2; &lt;span style="color:#75715e">// è¿è¡Œæ—¶è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value8 &lt;span style="color:#f92672">=&lt;/span> pow(value2, value3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> arr_pow_of_2[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>}; &lt;span style="color:#75715e">// æ•°ç»„åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œè™½ç„¶ const ä¿®é¥°çš„å˜é‡åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¸èƒ½ä¿®æ”¹ï¼Œä½†å®ƒä»¬çš„å€¼æ˜¯åœ¨è¿è¡Œæ—¶è®¡ç®—çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ç¼–è¯‘æ—¶å°†å®ƒä»¬è§†ä¸ºå¸¸é‡ã€‚æ‰€ä»¥ï¼Œ&lt;code>const&lt;/code> å˜é‡ä¹Ÿå¯ä»¥æœ‰å†…å­˜åœ°å€ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ &lt;code>const_cast&lt;/code> å¼ºè¡Œè¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cmath&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">MakeChange&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">const_cast&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&amp;gt;&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>x)) &lt;span style="color:#f92672">=&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MakeChange(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> x &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// è¾“å‡ºï¼š2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¼•å…¥-constexpr">å¼•å…¥ constexpr &lt;a href="#%e5%bc%95%e5%85%a5-constexpr" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>C++11 å¼•å…¥äº† &lt;code>constexpr&lt;/code>ï¼Œå®ƒçš„å­—é¢æ„æ€æ˜¯ &lt;code>constant expression&lt;/code>ï¼ˆå¸¸é‡è¡¨è¾¾å¼ï¼‰ï¼Œç”¨äºåœ¨ç¼–è¯‘æ—¶è®¡ç®—å¸¸é‡å€¼ã€‚ä¸ &lt;code>const&lt;/code> ä¸åŒï¼Œ&lt;code>constexpr&lt;/code> ç¡®ä¿ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°çš„å€¼æ˜¯åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶å¯¹å…¶è¿›è¡Œæ±‚å€¼ã€‚&lt;/p>
&lt;p>é€šè¿‡ä½¿ç”¨ &lt;code>constexpr&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ç¼–è¯‘æ—¶å¸¸é‡ï¼Œå¹¶ä¸” &lt;code>constexpr&lt;/code> å‡½æ•°åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿèƒ½å¤Ÿåœ¨ç¼–è¯‘æœŸè®¡ç®—ç»“æœã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>constexpr&lt;/code> é‡å†™ä¸Šè¿°ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> helloworld1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;helloworld&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value3 &lt;span style="color:#f92672">=&lt;/span> value1 &lt;span style="color:#f92672">+&lt;/span> value2; &lt;span style="color:#75715e">// ç¼–è¯‘æœŸè®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> value8 &lt;span style="color:#f92672">=&lt;/span> pow(value2, value3); &lt;span style="color:#75715e">// ç¼–è¯‘æœŸè®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–è¯‘æœŸåˆå§‹åŒ–æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> arr_pow_of_2[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¸¸é‡è¡¨è¾¾å¼å‡½æ•°">å¸¸é‡è¡¨è¾¾å¼å‡½æ•° &lt;a href="#%e5%b8%b8%e9%87%8f%e8%a1%a8%e8%be%be%e5%bc%8f%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>constexpr&lt;/code> ä¸ä»…å¯ä»¥ä¿®é¥°å˜é‡ï¼Œè¿˜å¯ä»¥ä¿®é¥°å‡½æ•°ã€‚&lt;code>constexpr&lt;/code> å‡½æ•°çš„ç‰¹æ€§æ˜¯ï¼Œè‹¥è¾“å…¥çš„å‚æ•°æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å¸¸é‡ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¡ç®— Fibonacci æ•°åˆ—çš„ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> MOD &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">1LL&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">62&lt;/span>) &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; &lt;span style="color:#75715e">// ç¼–è¯‘æ—¶å¸¸é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> &lt;span style="color:#a6e22e">fib&lt;/span>(&lt;span style="color:#66d9ef">uint64_t&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; &lt;span style="color:#f92672">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> temp &lt;span style="color:#f92672">=&lt;/span> a &lt;span style="color:#f92672">+&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">=&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b &lt;span style="color:#f92672">=&lt;/span> temp &lt;span style="color:#f92672">%&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åœ¨ç¼–è¯‘æœŸè®¡ç®— Fibonacci æ•°åˆ—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> result &lt;span style="color:#f92672">=&lt;/span> fib(&lt;span style="color:#ae81ff">123456&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> result &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ&lt;code>fib&lt;/code> å‡½æ•°è¢«æ ‡è®°ä¸º &lt;code>constexpr&lt;/code>ï¼Œå› æ­¤å½“ä¼ å…¥å¸¸é‡å‚æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å‡º Fibonacci æ•°åˆ—çš„ç¬¬ &lt;code>123456&lt;/code> é¡¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code>constexpr&lt;/code> å‡½æ•°çš„è®¡ç®—å­˜åœ¨ä¸€äº›é™åˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>é€’å½’æ·±åº¦é™åˆ¶&lt;/strong>ï¼šconstexpr å‡½æ•°çš„é€’å½’æ·±åº¦é€šå¸¸å—åˆ°ç¼–è¯‘å™¨çš„é™åˆ¶ï¼Œå¦‚æœé€’å½’è¿‡æ·±ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯æˆ–è­¦å‘Šã€‚&lt;/li>
&lt;li>&lt;strong>è®¡ç®—æ•ˆç‡&lt;/strong>ï¼šå°½ç®¡å¸¸é‡è¡¨è¾¾å¼å‡½æ•°å¯ä»¥åœ¨ç¼–è¯‘æœŸè®¡ç®—ï¼Œä½†å¯¹äºå¤æ‚çš„è¿ç®—ï¼Œå¯èƒ½ä¼šå¢åŠ ç¼–è¯‘æ—¶é—´ï¼Œå› ä¸ºç¼–è¯‘å™¨éœ€è¦è¿›è¡Œæ›´å¤šçš„è®¡ç®—ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="constexpr-vs-æ¨¡æ¿å…ƒç¼–ç¨‹">constexpr vs æ¨¡æ¿å…ƒç¼–ç¨‹ &lt;a href="#constexpr-vs-%e6%a8%a1%e6%9d%bf%e5%85%83%e7%bc%96%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>constexpr&lt;/code> å‡½æ•°çš„ä½¿ç”¨åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–äº†æ¨¡æ¿å…ƒç¼–ç¨‹ã€‚ä¼ ç»Ÿçš„æ¨¡æ¿å…ƒç¼–ç¨‹å¯ä»¥å®ç°ä¸ &lt;code>constexpr&lt;/code> ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä»£ç ç»“æ„é€šå¸¸æ›´åŠ å¤æ‚ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹è®¡ç®— Fibonacci æ•°åˆ—çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> MOD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1999&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">uint64_t&lt;/span> N&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Fibonacci&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> (Fibonacci&lt;span style="color:#f92672">&amp;lt;&lt;/span>N &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">+&lt;/span> Fibonacci&lt;span style="color:#f92672">&amp;lt;&lt;/span>N &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value) &lt;span style="color:#f92672">%&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Fibonacci&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> { &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Fibonacci&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> { &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Fibonacci(40): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> Fibonacci&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">40&lt;/span>&lt;span style="color:#f92672">&amp;gt;::&lt;/span>value &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªæ¨¡æ¿å…ƒç¼–ç¨‹ç¤ºä¾‹ä¸­ï¼ŒFibonacci ç»“æ„ä½“ä½¿ç”¨é€’å½’æ¨¡æ¿è®¡ç®— Fibonacci æ•°åˆ—çš„ç¬¬ N é¡¹ã€‚è¿™ä¸ &lt;code>constexpr&lt;/code> å‡½æ•°ç±»ä¼¼ï¼Œä½†æ¨¡æ¿å…ƒç¼–ç¨‹çš„è¯­æ³•æ›´åŠ ç¹çã€‚&lt;code>constexpr&lt;/code> çš„ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿå†™å‡ºæ›´åŠ æ¥è¿‘æ­£å¸¸é€»è¾‘ä»£ç çš„å½¢å¼ï¼Œå¹¶ä¸”å…·æœ‰æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›&lt;/p>
&lt;h3 id="c14-å¯¹å¸¸é‡è¡¨è¾¾å¼å‡½æ•°çš„å¢å¼º">C++14 å¯¹å¸¸é‡è¡¨è¾¾å¼å‡½æ•°çš„å¢å¼º &lt;a href="#c14-%e5%af%b9%e5%b8%b8%e9%87%8f%e8%a1%a8%e8%be%be%e5%bc%8f%e5%87%bd%e6%95%b0%e7%9a%84%e5%a2%9e%e5%bc%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ C++14 ä¸­ï¼Œå¸¸é‡è¡¨è¾¾å¼å‡½æ•°å¾—åˆ°äº†è¿›ä¸€æ­¥çš„å¢å¼ºã€‚å…·ä½“å¢å¼ºåŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ”¯æŒå±€éƒ¨å˜é‡&lt;/strong>ï¼š&lt;code>constexpr&lt;/code> å‡½æ•°å¯ä»¥å£°æ˜å’Œåˆå§‹åŒ–å±€éƒ¨å˜é‡ï¼Œä½†ä¸èƒ½å£°æ˜æœªåˆå§‹åŒ–çš„å˜é‡ã€&lt;code>static&lt;/code> æˆ– &lt;code>thread_local&lt;/code> å˜é‡ã€‚&lt;/li>
&lt;li>&lt;strong>æ”¯æŒ if å’Œ switch è¯­å¥&lt;/strong>ï¼š&lt;code>constexpr&lt;/code> å‡½æ•°å¯ä»¥ä½¿ç”¨ &lt;code>if&lt;/code> å’Œ &lt;code>switch&lt;/code> è¯­å¥æ¥æ§åˆ¶æµç¨‹ï¼Œä½†ä¸èƒ½ä½¿ç”¨ &lt;code>got&lt;/code>oã€‚&lt;/li>
&lt;li>&lt;strong>æ”¯æŒå¾ªç¯è¯­å¥&lt;/strong>ï¼š&lt;code>constexpr&lt;/code> å‡½æ•°æ”¯æŒæ‰€æœ‰ç±»å‹çš„å¾ªç¯è¯­å¥ï¼ŒåŒ…æ‹¬ &lt;code>for&lt;/code>ã€&lt;code>while&lt;/code> å’Œ &lt;code>do-while&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>ä¿®æ”¹ç”Ÿå‘½å‘¨æœŸ&lt;/strong>ï¼šåœ¨ constexpr å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä¿®æ”¹å±€éƒ¨å˜é‡å’Œéå¸¸é‡å¼•ç”¨å‚æ•°&lt;/li>
&lt;li>&lt;strong>è¿”å›å€¼å¯ä»¥æ˜¯ void&lt;/strong>ï¼š&lt;code>constexpr&lt;/code> å‡½æ•°å¯ä»¥å£°æ˜è¿”å›ç±»å‹ä¸º &lt;code>void&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¸¸é‡è¡¨è¾¾å¼ä¸æ¨¡æ¿å‡½æ•°">å¸¸é‡è¡¨è¾¾å¼ä¸æ¨¡æ¿å‡½æ•° &lt;a href="#%e5%b8%b8%e9%87%8f%e8%a1%a8%e8%be%be%e5%bc%8f%e4%b8%8e%e6%a8%a1%e6%9d%bf%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ C++11 å¼•å…¥ &lt;code>constexpr&lt;/code> åï¼Œå»ºè®®åœ¨æ‰€æœ‰éœ€è¦å¸¸é‡è¯­ä¹‰çš„åœºæ™¯ä¸­ä½¿ç”¨ &lt;code>constexpr&lt;/code>ã€‚&lt;code>constexpr&lt;/code> å˜é‡å’Œå‡½æ•°ä½œä¸ºç¼–è¯‘æ—¶å¸¸é‡ï¼Œåœ¨æ¨¡æ¿å‡½æ•°ä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ç¨‹åºçš„æ•ˆç‡å’Œå¯è¯»æ€§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> T square(T x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> x &lt;span style="color:#f92672">*&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">uint64_t&lt;/span> square2 &lt;span style="color:#f92672">=&lt;/span> square(&lt;span style="color:#ae81ff">2&lt;/span>); &lt;span style="color:#75715e">// è®¡ç®—å¸¸é‡çš„å¹³æ–¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">double&lt;/span> square2_0 &lt;span style="color:#f92672">=&lt;/span> square(&lt;span style="color:#ae81ff">2.0&lt;/span>); &lt;span style="color:#75715e">// è®¡ç®—æµ®ç‚¹æ•°çš„å¹³æ–¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> printf(&lt;span style="color:#e6db74">&amp;#34;%lu&lt;/span>&lt;span style="color:#ae81ff">\t&lt;/span>&lt;span style="color:#e6db74">%.04lf&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, square2, square2_0); &lt;span style="color:#75715e">// è¾“å‡ºç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¨¡æ¿å‡½æ•° &lt;code>square&lt;/code> ä½¿ç”¨äº† &lt;code>constexpr&lt;/code>ï¼Œç¡®ä¿åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥è®¡ç®—ç»“æœã€‚å¯¹äºä¸åŒç±»å‹çš„å‚æ•°ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰ï¼Œæ¨¡æ¿ä¼šè‡ªåŠ¨è¿›è¡Œå®ä¾‹åŒ–ã€‚&lt;/p>
&lt;p>å¦‚æœæ¨¡æ¿å‚æ•°ä¸æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œ&lt;code>constexpr&lt;/code> å°†ä¸ä¼šåœ¨ç¼–è¯‘æœŸæ‰§è¡Œï¼Œä½†å‡½æ•°æœ¬èº«ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚&lt;/p>
&lt;h2 id="constexpr-å‡½æ•°ä¸­çš„åŠ¨æ€å†…å­˜åˆ†é…">constexpr å‡½æ•°ä¸­çš„åŠ¨æ€å†…å­˜åˆ†é… &lt;a href="#constexpr-%e5%87%bd%e6%95%b0%e4%b8%ad%e7%9a%84%e5%8a%a8%e6%80%81%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ C++20 ä¸­ï¼Œ&lt;code>constexpr&lt;/code> å‡½æ•°å¾—åˆ°äº†è¿›ä¸€æ­¥å¢å¼ºï¼Œæ”¯æŒåœ¨ç¼–è¯‘æœŸè¿›è¡ŒåŠ¨æ€å†…å­˜åˆ†é…ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›é™åˆ¶ã€‚&lt;/p>
&lt;p>&lt;code>std::array&lt;/code> çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œä¸æ˜¯å †ä¸Šã€‚ä¸¥æ ¼çš„è¯´ï¼Œ&lt;code>std::array&lt;/code>ä¸æ¶‰åŠåŠ¨æ€å†…å­˜åˆ†é…ã€‚æ‰€ä»¥&lt;code>std::array&lt;/code>å¯ä»¥åœ¨&lt;code>constexpr&lt;/code>å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ã€ä¿®æ”¹å¹¶è¿”å›ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;array&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> maxstep&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">100&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>array&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>, maxstep&lt;span style="color:#f92672">&amp;gt;&lt;/span> Collatz(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>array&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>, maxstep&lt;span style="color:#f92672">&amp;gt;&lt;/span> path;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> idx &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> path[idx&lt;span style="color:#f92672">++&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (x &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (x &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">/=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#a6e22e">if&lt;/span> (x &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">=&lt;/span> x &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> path;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span> path &lt;span style="color:#f92672">=&lt;/span> Collatz(&lt;span style="color:#ae81ff">12345&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> item : path) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (item &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, item);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œå¯¹äº&lt;code>std::string&lt;/code>æˆ–è€…&lt;code>std::vector&lt;/code>è¿™ç§ éœ€è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åˆ™ä¸å¯ä»¥åœ¨constexprå‡½æ•°ä¸­ç›´æ¥è¿”å›ã€‚ä½†æ˜¯å¯ä»¥åœ¨constexprå‡½æ•°ä¸­åˆ™ç”¨å…¶è¿›è¡Œè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;array&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">square&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> x &lt;span style="color:#f92672">*&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">CountPrimes&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> primes{&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> flag &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> prime : primes) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i &lt;span style="color:#f92672">%&lt;/span> prime &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (square(prime) &lt;span style="color:#f92672">&amp;gt;=&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (flag) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> primes.push_back(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> primes.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> CountPrimes(&lt;span style="color:#ae81ff">100&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, cnt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="constexpr-virtual-å‡½æ•°">constexpr virtual å‡½æ•° &lt;a href="#constexpr-virtual-%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ C++20 ä¸­ï¼Œ&lt;code>constexpr&lt;/code> å‡½æ•°å¯ä»¥ä¸ &lt;code>virtual&lt;/code> å…³é”®å­—ç»“åˆä½¿ç”¨ï¼Œå®ç°åœ¨ç¼–è¯‘æœŸè¿›è¡Œå¤šæ€æ±‚å€¼ã€‚&lt;/p>
&lt;p>è™šå‡½æ•°çš„ constexpr é™åˆ¶ï¼šconstexpr è™šå‡½æ•°åªèƒ½åœ¨ç¼–è¯‘æœŸæ±‚å€¼ï¼Œå‰ææ˜¯å…¶è¢«è°ƒç”¨çš„å…·ä½“å¯¹è±¡ç±»å‹æ˜¯ç¡®å®šçš„ã€‚&lt;/p>
&lt;p>åœ¨ constexpr ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ virtual å‡½æ•°æ—¶ï¼Œè°ƒç”¨å°†ç»‘å®šåˆ°å…·ä½“æ´¾ç”Ÿç±»çš„å®ç°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Base&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">Value&lt;/span>() &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#75715e">// è™šæ‹Ÿ constexpr å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Derived1&lt;/span> &lt;span style="color:#f92672">:&lt;/span> Base {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">Value&lt;/span>() &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Derived2&lt;/span> &lt;span style="color:#f92672">:&lt;/span> Base {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">Value&lt;/span>() &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">Calc&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Base&lt;span style="color:#f92672">*&lt;/span> d1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Derived1(); &lt;span style="color:#75715e">// constexpr ä¸­åˆ†é…å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Base&lt;span style="color:#f92672">*&lt;/span> d2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Derived2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> d1&lt;span style="color:#f92672">-&amp;gt;&lt;/span>Value() &lt;span style="color:#f92672">+&lt;/span> d2&lt;span style="color:#f92672">-&amp;gt;&lt;/span>Value(); &lt;span style="color:#75715e">// è°ƒç”¨è™šå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">delete&lt;/span> d1; &lt;span style="color:#75715e">// å¿…é¡»é‡Šæ”¾å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">delete&lt;/span> d2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">constexpr&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span> v &lt;span style="color:#f92672">=&lt;/span> Calc(); &lt;span style="color:#75715e">// åœ¨ç¼–è¯‘æœŸè®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¸¸é‡è¡¨è¾¾å¼ç”¨äºæ¨¡æ¿å‡½æ•°çš„ç±»å‹åˆ¤æ–­">å¸¸é‡è¡¨è¾¾å¼ç”¨äºæ¨¡æ¿å‡½æ•°çš„ç±»å‹åˆ¤æ–­ &lt;a href="#%e5%b8%b8%e9%87%8f%e8%a1%a8%e8%be%be%e5%bc%8f%e7%94%a8%e4%ba%8e%e6%a8%a1%e6%9d%bf%e5%87%bd%e6%95%b0%e7%9a%84%e7%b1%bb%e5%9e%8b%e5%88%a4%e6%96%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ C++17 ä¸­å¼•å…¥çš„ &lt;code>if constexpr&lt;/code> æä¾›äº†ä¸€ç§æ›´åŠ ç®€æ´å’Œå¯è¯»çš„æ–¹å¼æ¥è¿›è¡Œæ¨¡æ¿å…ƒç¼–ç¨‹çš„ç±»å‹åˆ¤æ–­ã€‚æ ¹æ®ç±»å‹ç‰¹æ€§ï¼Œåœ¨ç¼–è¯‘æœŸé€‰æ‹©ä¸åŒçš„åˆ†æ”¯è·¯å¾„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdint&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cmath&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;type_traits&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> equal(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_integral_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">==&lt;/span> b; &lt;span style="color:#75715e">// æ•´æ•°ç±»å‹ç›´æ¥æ¯”è¾ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">constexpr&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>is_floating_point_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> fabs(a &lt;span style="color:#f92672">-&lt;/span> b) &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1e-3&lt;/span>; &lt;span style="color:#75715e">// æµ®ç‚¹æ•°è¿›è¡Œè¯¯å·®æ¯”è¾ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static_assert&lt;/span>(std&lt;span style="color:#f92672">::&lt;/span>is_arithmetic_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">||&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>is_pointer_v&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;not supported&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>boolalpha;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> equal(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> equal(&lt;span style="color:#ae81ff">1L&lt;/span>, &lt;span style="color:#ae81ff">1L&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> equal(&lt;span style="color:#ae81ff">1.0000001&lt;/span>, &lt;span style="color:#ae81ff">1.000002&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> equal(&lt;span style="color:#ae81ff">1.0000001&lt;/span>, &lt;span style="color:#ae81ff">2.000002&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl; &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä¼ ç»ŸC++ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨&lt;code>std::enable_if&lt;/code>æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œè¯­æ³•ä¼šæ˜¾å¾—è¿‡äºç¬¨é‡ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>#include &amp;lt;type_traits&amp;gt;
#include &amp;lt;cmath&amp;gt;
#include &amp;lt;cstdio&amp;gt;
// æ•´æ•°ç±»å‹
template &amp;lt;typename T&amp;gt;
typename std::enable_if&amp;lt;std::is_integral&amp;lt;T&amp;gt;::value, bool&amp;gt;::type
equal(const T&amp;amp; a, const T&amp;amp; b) {
return a == b;
}
// æµ®ç‚¹ç±»å‹
template &amp;lt;typename T&amp;gt;
typename std::enable_if&amp;lt;std::is_floating_point&amp;lt;T&amp;gt;::value, bool&amp;gt;::type
equal(const T&amp;amp; a, const T&amp;amp; b) {
return std::fabs(a - b) &amp;lt;= 1e-3;
}
// å…¶ä»–ç±»å‹
template &amp;lt;typename T&amp;gt;
typename std::enable_if&amp;lt;
!(std::is_integral&amp;lt;T&amp;gt;::value || std::is_floating_point&amp;lt;T&amp;gt;::value), bool&amp;gt;::type
equal(const T&amp;amp; a, const T&amp;amp; b) {
static_assert(std::is_arithmetic&amp;lt;T&amp;gt;::value || std::is_pointer&amp;lt;T&amp;gt;::value, &amp;#34;not supported&amp;#34;);
return false;
}
int main() {
puts(equal(1, 1) ? &amp;#34;true&amp;#34; : &amp;#34;false&amp;#34;); // æ•´æ•°
puts(equal(1.0000001, 1.000002) ? &amp;#34;true&amp;#34; : &amp;#34;false&amp;#34;); // æµ®ç‚¹
return 0;
}
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨constevalå¼ºåˆ¶ä½¿ç”¨ç¼–è¯‘æœŸæ±‚å€¼">ä½¿ç”¨&lt;code>consteval&lt;/code>å¼ºåˆ¶ä½¿ç”¨ç¼–è¯‘æœŸæ±‚å€¼ &lt;a href="#%e4%bd%bf%e7%94%a8consteval%e5%bc%ba%e5%88%b6%e4%bd%bf%e7%94%a8%e7%bc%96%e8%af%91%e6%9c%9f%e6%b1%82%e5%80%bc" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>consteval&lt;/code> æ˜¯åœ¨ C++20 ä¸­å¼•å…¥çš„å…³é”®å­—ï¼Œç”¨äºå£°æ˜ç«‹å³å‡½æ•°ï¼ˆimmediate functionï¼‰ã€‚ç«‹å³å‡½æ•°è¦æ±‚åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ±‚å€¼ï¼Œä¸èƒ½åœ¨è¿è¡Œæ—¶è°ƒç”¨ã€‚
å¦‚æœè°ƒç”¨ä¸€ä¸ª&lt;code>consteval&lt;/code>ã€‚å¦‚æœè°ƒç”¨ &lt;code>consteval&lt;/code> å‡½æ•°æ—¶æ— æ³•åœ¨ç¼–è¯‘æœŸè®¡ç®—ï¼Œç¼–è¯‘å™¨å°†æŠ¥é”™ã€‚&lt;/p>
&lt;p>&lt;code>constexpr&lt;/code> å‡½æ•°åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šé€€åŒ–ä¸ºè¿è¡Œæ—¶è°ƒç”¨ï¼Œ&lt;code>consteval&lt;/code> å¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>#include &amp;lt;iostream&amp;gt;
// consteval å¼ºåˆ¶è¦æ±‚åœ¨ç¼–è¯‘æ—¶è¿›è¡Œè®¡ç®—
consteval int factorial(int n) {
return (n &amp;lt;= 1) ? 1 : (n * factorial(n - 1));
}
int main() {
constexpr int result = factorial(5); // OKï¼šåœ¨ç¼–è¯‘æ—¶è®¡ç®—
std::cout &amp;lt;&amp;lt; &amp;#34;Factorial of 5 is: &amp;#34; &amp;lt;&amp;lt; result &amp;lt;&amp;lt; std::endl;
// int runtime = 5;
// std::cout &amp;lt;&amp;lt; &amp;#34;Factorial of runtime: &amp;#34; &amp;lt;&amp;lt; factorial(runtime) &amp;lt;&amp;lt; std::endl;
// é”™è¯¯ï¼šfactorial å¿…é¡»åœ¨ç¼–è¯‘æ—¶è°ƒç”¨
return 0;
}
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨constinitæ˜¾å¼è¦æ±‚ç¼–è¯‘æ—¶åˆå§‹åŒ–">ä½¿ç”¨&lt;code>constinit&lt;/code>æ˜¾å¼è¦æ±‚ç¼–è¯‘æ—¶åˆå§‹åŒ– &lt;a href="#%e4%bd%bf%e7%94%a8constinit%e6%98%be%e5%bc%8f%e8%a6%81%e6%b1%82%e7%bc%96%e8%af%91%e6%97%b6%e5%88%9d%e5%a7%8b%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>constinit&lt;/code> å…³é”®å­—ç”¨äºæ˜¾å¼è¦æ±‚å…¨å±€æˆ–é™æ€å˜é‡åœ¨ç¼–è¯‘æœŸå®Œæˆåˆå§‹åŒ–ã€‚
å¦‚æœå˜é‡æ— æ³•åœ¨ç¼–è¯‘æ—¶åˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨å°†æŠ¥é”™ã€‚
&lt;code>constinit&lt;/code> ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ã€‚&lt;/p>
&lt;p>ä¸ &lt;code>constexpr&lt;/code> ä¸åŒï¼Œ&lt;code>constinit&lt;/code> å˜é‡å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«ä¿®æ”¹ã€‚
çº¿ç¨‹å®‰å…¨æ€§ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œ&lt;code>constinit&lt;/code> ç¡®ä¿å˜é‡åœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–ï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>#include &amp;lt;array&amp;gt;
// ç¼–è¯‘æ—¶åˆå§‹åŒ–
constexpr int compute(int v) { return v * v * v; }
constinit int global = compute(10);
// é”™è¯¯ï¼šconstinit å˜é‡ä¸èƒ½ä¾èµ–è¿è¡Œæ—¶åˆå§‹åŒ–
// constinit int another = global;
int main() {
global = 100; // å…è®¸åœ¨è¿è¡Œæ—¶ä¿®æ”¹
// é”™è¯¯ï¼šconstinit å˜é‡ä¸æ˜¯å¸¸é‡ï¼Œä¸èƒ½ç”¨ä½œæ•°ç»„å¤§å°
// std::array&amp;lt;int, global&amp;gt; arr;
std::cout &amp;lt;&amp;lt; &amp;#34;Global value: &amp;#34; &amp;lt;&amp;lt; global &amp;lt;&amp;lt; std::endl;
return 0;
}
&lt;/code>&lt;/pre>&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;code>constexpr&lt;/code>åœ¨å¤šæ•°æƒ…å†µä¸‹å¯ä»¥æ›¿ä»£&lt;code>const&lt;/code>ä»¥è¡¨è¾¾â€œç¼–è¯‘æœŸå¸¸é‡â€çš„è¯­ä¹‰ï¼Œå¯ç”¨äºå‡½æ•°ã€å˜é‡ã€ç±»ç­‰åœºæ™¯ã€‚constexpr æ”¯æŒåœ¨ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸè¿›è¡Œæ±‚å€¼ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šé€€åŒ–ä¸ºè¿è¡ŒæœŸæ±‚å€¼ã€‚&lt;/li>
&lt;li>å¸¸é‡è¡¨è¾¾å¼å‡½æ•° æä¾›äº†ä¸€ç§æ›´æ¸…æ™°çš„ç¼–è¯‘æœŸè®¡ç®—æ–¹å¼ï¼Œèƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå–ä»£å¤æ‚ä¸”æ™¦æ¶©çš„æ¨¡æ¿å…ƒç¼–ç¨‹ã€‚éšç€ C++ æ ‡å‡†çš„æ¼”è¿›ï¼Œ&lt;code>constexpr&lt;/code> å‡½æ•°é€æ­¥æ”¯æŒäº†æ›´å¤æ‚çš„è¯­æ³•å’Œé€»è¾‘ï¼Œä¾‹å¦‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥å’Œå±€éƒ¨å˜é‡ã€‚ä½†å¯¹äºæç«¯å¤æ‚çš„è®¡ç®—åœºæ™¯ï¼Œç¼–è¯‘æœŸè®¡ç®—å¯èƒ½å¯¼è‡´æ˜¾è‘—çš„ç¼–è¯‘æ—¶é—´å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;code>constexpr&lt;/code>å¯ä»¥åœ¨æ¨¡æ¿å‡½æ•°ä¸­ç”¨äºç±»å‹åˆ¤æ–­ï¼Œé€šè¿‡&lt;code>if constexpr&lt;/code>è¯­æ³•æœ‰æ•ˆåœ°å–ä»£&lt;code>std::enable_if&lt;/code>ï¼Œä»è€Œç®€åŒ–æ¨¡æ¿ç¼–ç¨‹ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/li>
&lt;li>&lt;code>constexpr&lt;/code>å‡½æ•°çš„éšå¼é€€åŒ–é£é™©ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œ&lt;code>constexpr&lt;/code> å‡½æ•°å¯èƒ½åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚è‹¥éœ€è¦ä¸¥æ ¼ä¿è¯ä»…åœ¨ç¼–è¯‘æœŸæ±‚å€¼ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>consteval&lt;/code> æ¥å¼ºåˆ¶è¿›è¡Œç¼–è¯‘æœŸæ±‚å€¼ï¼Œé¿å…ä¸å¿…è¦çš„è¿è¡Œæ—¶å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;code>constinit&lt;/code>æä¾›äº†ä¸€ç§æ˜¾å¼è¦æ±‚å˜é‡åœ¨ç¼–è¯‘æ—¶å®Œæˆåˆå§‹åŒ–çš„æœºåˆ¶ï¼Œé€‚ç”¨äºé&lt;code>constexpr&lt;/code>å˜é‡ã€‚è¿™åœ¨å…¨å±€å’Œé™æ€å˜é‡çš„åˆå§‹åŒ–ä¸­å°¤ä¸ºæœ‰ç”¨ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åˆå§‹åŒ–å®‰å…¨æ€§ã€‚&lt;/li>
&lt;/ul></description></item><item><title>CPUç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜ä¸€è‡´æ€§ï¼ˆç¬¬äºŒéƒ¨åˆ†-å†…å­˜ä¸€è‡´æ€§ï¼‰</title><link>https://wizmann.top/posts/cache-coherence-and-memory-order-2/</link><pubDate>Sun, 01 Sep 2024 00:24:00 +0000</pubDate><guid>https://wizmann.top/posts/cache-coherence-and-memory-order-2/</guid><description>&lt;h2 id="ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜ä¸€è‡´æ€§">ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜ä¸€è‡´æ€§ &lt;a href="#%e7%bc%93%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7%e4%b8%8e%e5%86%85%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­çš„ä¸¤ä¸ªä¸åŒæ¦‚å¿µï¼Œå®ƒä»¬è§£å†³çš„æ˜¯ä¸åŒç±»å‹çš„å†…å­˜è®¿é—®é—®é¢˜ã€‚&lt;/p>
&lt;p>ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆå¦‚ MESI åè®®ï¼‰ç”¨äºè§£å†³å¤šä¸ªå¤„ç†å™¨å¯¹ç›¸åŒå†…å­˜ä½ç½®è¿›è¡Œè®¿é—®å’Œä¿®æ”¹æ—¶çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒç¡®ä¿å„å¤„ç†å™¨çš„ç¼“å­˜ä¸­é’ˆå¯¹åŒä¸€å†…å­˜åœ°å€çš„å‰¯æœ¬ä¿æŒä¸€è‡´ï¼Œé¿å…å› ç¼“å­˜ä¸åŒæ­¥è€Œå¯¼è‡´çš„æ•°æ®é”™è¯¯ã€‚&lt;/p>
&lt;p>è€Œå†…å­˜ä¸€è‡´æ€§å…³æ³¨çš„æ˜¯å¤„ç†å™¨å¯¹å¤šä¸ªä¸åŒå†…å­˜åœ°å€çš„è®¿é—®é¡ºåºé—®é¢˜ã€‚å½“ä¸åŒå¤„ç†å™¨çš„å†…å­˜è®¿é—®é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„é¢„æœŸé¡ºåºä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå¼•å‘å†…å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒè¦æ±‚å„å¤„ç†å™¨æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è®¿é—®å†…å­˜ï¼Œä»¥ä¿æŒç¨‹åºé€»è¾‘çš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;p>ç®€è€Œè¨€ä¹‹ï¼Œç¼“å­˜ä¸€è‡´æ€§è§£å†³çš„æ˜¯åŒä¸€å†…å­˜ä½ç½®çš„æ•°æ®åŒæ­¥é—®é¢˜ï¼Œè€Œå†…å­˜ä¸€è‡´æ€§åˆ™æ¶‰åŠå¤šä¸ªå†…å­˜ä½ç½®çš„è®¿é—®é¡ºåºé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="å†…å­˜ä¹±åºè®¿é—®äº§ç”Ÿçš„åŸå› ">å†…å­˜ä¹±åºè®¿é—®äº§ç”Ÿçš„åŸå›  &lt;a href="#%e5%86%85%e5%ad%98%e4%b9%b1%e5%ba%8f%e8%ae%bf%e9%97%ae%e4%ba%a7%e7%94%9f%e7%9a%84%e5%8e%9f%e5%9b%a0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å†…å­˜ä¹±åºè®¿é—®çš„åŸå› å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥ç†è§£ï¼šç¨‹åºé¡ºåºï¼ˆProgram Order, POï¼‰å’Œå†…å­˜é¡ºåºï¼ˆMemory Order, MOï¼‰ã€‚ç¨‹åºé¡ºåºæ˜¯æŒ‡ç¨‹åºä»£ç ä¸­ç¼–å†™çš„å†…å­˜è®¿é—®åºåˆ—ï¼Œåæ˜ äº†ç¨‹åºå‘˜é¢„æœŸçš„æŒ‡ä»¤æ‰§è¡Œé¡ºåºã€‚æŒ‰ç…§ç¨‹åºé¡ºåºï¼ŒæŒ‡ä»¤åº”è¯¥ä¾æ¬¡è¢«æ‰§è¡Œï¼Œä»¥ç¡®ä¿ç¨‹åºçš„é€»è¾‘æ­£ç¡®æ€§ã€‚ç„¶è€Œï¼Œåœ¨å®é™…æ‰§è¡Œä¸­ï¼Œç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨ä¸€ç§ä¸åŒçš„é¡ºåºï¼Œå³å†…å­˜é¡ºåºã€‚&lt;/p>
&lt;p>å†…å­˜é¡ºåºæ˜¯æŒ‡ç³»ç»Ÿä¸­æ‰€æœ‰å¤„ç†å™¨å¯¹å†…å­˜æ“ä½œè¾¾æˆä¸€è‡´çš„è®¿é—®é¡ºåºã€‚ç”±äºç°ä»£è®¡ç®—æœºç³»ç»Ÿé€šå¸¸ç”±å¤šä¸ªå¤„ç†å™¨å…±åŒæ“ä½œå…±äº«å†…å­˜ï¼Œä¸ºäº†æé«˜æ•´ä½“æ€§èƒ½ï¼Œè¿™äº›å¤„ç†å™¨å¯èƒ½ä¼šå¯¹å†…å­˜æ“ä½œè¿›è¡Œé‡æ’åºï¼Œä»è€Œäº§ç”Ÿä¸ç¨‹åºé¡ºåºä¸ä¸€è‡´çš„å†…å­˜é¡ºåºã€‚&lt;/p>
&lt;p>è¿™ç§å†…å­˜ä¹±åºè®¿é—®çš„ç°è±¡ä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œé€šå¸¸å‘ç”Ÿåœ¨ä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘é˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æŒ‡ä»¤çš„é‡æ’åºï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚åœ¨æ‰§è¡Œé˜¶æ®µï¼Œå¤šä¸ª CPU ä¹‹é—´çš„äº¤äº’ä¹Ÿä¼šå¼•èµ·å†…å­˜è®¿é—®é¡ºåºçš„ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼ŒCPU å¯¹æŒ‡ä»¤çš„ä¹±åºæ‰§è¡Œå’Œé‡æ’å¯¹äºç¨‹åºå‘˜æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå³ç¨‹åºçš„æ‰§è¡Œç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ç„¶è€Œï¼Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œä¸åŒçš„å¤„ç†å™¨ï¼ˆæˆ–ç§°ä¸ºè§‚å¯Ÿè€…ï¼‰å¯èƒ½ä¼šè§‚å¯Ÿåˆ°ä¸åŒçš„å†…å­˜æ‰§è¡Œé¡ºåºï¼Œè¿™ä¸æŒ‡ä»¤çš„å®é™…æ‰§è¡Œé¡ºåºä¸å®Œå…¨ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„åŒæ­¥é—®é¢˜å’Œæ•°æ®ä¸ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h2 id="å‡ ç§å¸¸è§çš„ä¸€è‡´æ€§æ¨¡å‹">å‡ ç§å¸¸è§çš„ä¸€è‡´æ€§æ¨¡å‹ &lt;a href="#%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e7%9a%84%e4%b8%80%e8%87%b4%e6%80%a7%e6%a8%a1%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œå†…å­˜ä¸€è‡´æ€§æ¨¡å‹å†³å®šäº†ä¸åŒå¤„ç†å™¨ä¹‹é—´å¦‚ä½•è§‚å¯Ÿå’Œæ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºã€‚ä»¥ä¸‹ä»‹ç»å‡ ç§å¸¸è§çš„ä¸€è‡´æ€§æ¨¡å‹ï¼š&lt;/p>
&lt;h3 id="é¡ºåºä¸€è‡´æ€§æ¨¡å‹sequential-consistency-sc">é¡ºåºä¸€è‡´æ€§æ¨¡å‹ï¼ˆSequential Consistency, SCï¼‰ &lt;a href="#%e9%a1%ba%e5%ba%8f%e4%b8%80%e8%87%b4%e6%80%a7%e6%a8%a1%e5%9e%8bsequential-consistency-sc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é¡ºåºä¸€è‡´æ€§æ¨¡å‹çš„æ¦‚å¿µæœ€æ—©ç”± Leslie Lamport åœ¨ 1979 å¹´çš„è®ºæ–‡ã€Šå¦‚ä½•æ„å»ºæ­£ç¡®æ‰§è¡Œå¤šå¤„ç†ç¨‹åºçš„å¤šå¤„ç†è®¡ç®—æœºã€‹ä¸­æå‡ºã€‚æŒ‰ç…§ä»–çš„å®šä¹‰ï¼š&lt;/p>
&lt;p>ä»»ä½•æ‰§è¡Œçš„ç»“æœéƒ½ä¸æ‰€æœ‰å¤„ç†å™¨çš„æ“ä½œæŒ‰ç…§æŸç§é¡ºåºä¾æ¬¡æ‰§è¡Œçš„ç»“æœç›¸åŒï¼Œå¹¶ä¸”æ¯ä¸ªå¤„ç†å™¨çš„æ“ä½œåœ¨è¿™ä¸ªé¡ºåºä¸­å‡ºç°çš„é¡ºåºä¸å…¶ç¨‹åºä¸­æŒ‡å®šçš„é¡ºåºä¸€è‡´ã€‚æ»¡è¶³è¿™ä¸€æ¡ä»¶çš„å¤šå¤„ç†å™¨è¢«ç§°ä¸ºé¡ºåºä¸€è‡´æ€§ç³»ç»Ÿã€‚&lt;/p>
&lt;p>é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯äº†æ¯ä¸ªåŠ è½½ï¼ˆLoadï¼‰å’Œå­˜å‚¨ï¼ˆStoreï¼‰æŒ‡ä»¤æŒ‰ç…§ç¨‹åºä¸­æŒ‡å®šçš„ä¸¥æ ¼é¡ºåºæ‰§è¡Œï¼Œç¡®ä¿äº†â€œè¯»-&amp;gt;è¯»â€ã€â€œè¯»-&amp;gt;å†™â€ã€â€œå†™-&amp;gt;å†™â€ä»¥åŠâ€œå†™-&amp;gt;è¯»â€å››ç§æ“ä½œçš„é¡ºåºã€‚è¿™ç§æ¨¡å‹æä¾›äº†æœ€å¼ºçš„å†…å­˜ä¸€è‡´æ€§ä¿è¯ï¼Œä½†ä»£ä»·æ˜¯è¾ƒä½çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºå®ƒä¸å…è®¸ä»»ä½•å½¢å¼çš„æŒ‡ä»¤é‡æ’åºã€‚&lt;/p>
&lt;h3 id="å¤„ç†å™¨ä¸€è‡´æ€§æ¨¡å‹processor-consistency-pc">å¤„ç†å™¨ä¸€è‡´æ€§æ¨¡å‹ï¼ˆProcessor Consistency, PC) &lt;a href="#%e5%a4%84%e7%90%86%e5%99%a8%e4%b8%80%e8%87%b4%e6%80%a7%e6%a8%a1%e5%9e%8bprocessor-consistency-pc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¤„ç†å™¨ä¸€è‡´æ€§æ¨¡å‹æ˜¯é¡ºåºä¸€è‡´æ€§æ¨¡å‹çš„å¼±åŒ–ç‰ˆæœ¬ï¼Œå®ƒæ”¾å®½äº†å¯¹â€œå†™-&amp;gt;è¯»â€æ“ä½œé¡ºåºçš„è¦æ±‚ã€‚è¯¥æ¨¡å‹å…è®¸å¤„ç†å™¨åœ¨è¯»å–æ—¶ä»å­˜å‚¨ç¼“å†²åŒºï¼ˆStore Bufferï¼‰ä¸­è·å–ä¸€ä¸ªå°šæœªå†™å…¥ç¼“å­˜çš„å€¼ï¼Œå³ä½¿è¿™ä¸ªå€¼è¿˜æ²¡æœ‰è¢«å…¶ä»–å¤„ç†å™¨çœ‹åˆ°ã€‚x86-64 å®ç°çš„å…¨åºå†™ï¼ˆTotal Store Ordering, TSOï¼‰æ¨¡å‹å°±æ˜¯å¤„ç†å™¨ä¸€è‡´æ€§çš„ä¸€ç§ã€‚TSO å…è®¸ä¸€å®šç¨‹åº¦çš„ä¹±åºæ‰§è¡Œï¼Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒåŒæ—¶ä»ç„¶æä¾›äº†è¾ƒå¼ºçš„ä¸€è‡´æ€§ä¿è¯ã€‚&lt;/p>
&lt;h3 id="å¼±ä¸€è‡´æ€§æ¨¡å‹weak-consistency-wc">å¼±ä¸€è‡´æ€§æ¨¡å‹ï¼ˆWeak Consistency, WCï¼‰ &lt;a href="#%e5%bc%b1%e4%b8%80%e8%87%b4%e6%80%a7%e6%a8%a1%e5%9e%8bweak-consistency-wc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¼±ä¸€è‡´æ€§æ¨¡å‹è¿›ä¸€æ­¥å¼±åŒ–äº†å¤„ç†å™¨ä¸€è‡´æ€§æ¨¡å‹çš„è¦æ±‚ï¼Œæ”¾å®½äº†å¯¹â€œè¯»-&amp;gt;è¯»â€ã€â€œè¯»-&amp;gt;å†™â€ã€â€œå†™-&amp;gt;å†™â€ä»¥åŠâ€œå†™-&amp;gt;è¯»â€å››ç§æ“ä½œé¡ºåºçš„çº¦æŸã€‚ä¸ºäº†ç¡®ä¿ç¨‹åºæ‰§è¡Œçš„æ­£ç¡®æ€§ï¼Œç¨‹åºå‘˜éœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹æ˜¾å¼æ·»åŠ åŒæ­¥æ“ä½œã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œå¤šå¤„ç†å™¨ç³»ç»Ÿçš„å†…å­˜è®¿é—®æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ç§°ä¸ºå¼±ä¸€è‡´æ€§å†…å­˜è®¿é—®ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹å…¨å±€åŒæ­¥å˜é‡çš„è®¿é—®æ˜¯é¡ºåºä¸€è‡´çš„&lt;/li>
&lt;li>åœ¨ä¸€ä¸ªåŒæ­¥æ“ä½œï¼ˆå¦‚å†…å­˜å±éšœæŒ‡ä»¤ï¼‰æ‰§è¡Œä¹‹å‰ï¼Œæ‰€æœ‰å…ˆå‰çš„æ•°æ®è®¿é—®å¿…é¡»å®Œæˆï¼›&lt;/li>
&lt;li>åœ¨ä¸€ä¸ªæ­£å¸¸çš„æ•°æ®è®¿é—®ï¼ˆå¦‚æ•°æ®è®¿é—®æŒ‡ä»¤ï¼‰æ‰§è¡Œä¹‹å‰ï¼Œæ‰€æœ‰å…ˆå‰çš„åŒæ­¥æ“ä½œï¼ˆå¦‚å†…å­˜å±éšœæŒ‡ä»¤ï¼‰å¿…é¡»å®Œæˆã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é‡Šæ”¾ä¸€è‡´æ€§æ¨¡å‹release-consistency-rc">é‡Šæ”¾ä¸€è‡´æ€§æ¨¡å‹ï¼ˆRelease Consistency, RCï¼‰ &lt;a href="#%e9%87%8a%e6%94%be%e4%b8%80%e8%87%b4%e6%80%a7%e6%a8%a1%e5%9e%8brelease-consistency-rc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é‡Šæ”¾ä¸€è‡´æ€§æ¨¡å‹æ˜¯åœ¨å¼±ä¸€è‡´æ€§æ¨¡å‹çš„åŸºç¡€ä¸Šå¼•å…¥äº†â€œè·å–â€ï¼ˆacquireï¼‰å’Œâ€œé‡Šæ”¾â€ï¼ˆreleaseï¼‰å±éšœåŸè¯­ï¼Œç”¨äºç®€åŒ–å…±äº«æ•°æ®çš„äº’æ–¥è®¿é—®ã€‚&lt;/p>
&lt;p>åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œâ€œè·å–â€å±éšœåŸè¯­åé¢çš„è¯»å†™æ“ä½œä¸èƒ½è¢«é‡æ’åˆ°è¯¥å±éšœä¹‹å‰ï¼Œâ€œé‡Šæ”¾â€å±éšœåŸè¯­å‰é¢çš„è¯»å†™æ“ä½œä¸èƒ½è¢«é‡æ’åˆ°è¯¥å±éšœä¹‹åã€‚è¿™ç§æœºåˆ¶èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç®¡ç†å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­çš„å…±äº«æ•°æ®è®¿é—®ï¼Œæé«˜å¹¶è¡Œæ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/38b192183bdefe1e658707d505a5263f12e4ba34/wizmann-pic/image_1724584827296_0.png" alt="">&lt;/p>
&lt;p>è¿™äº›å†…å­˜ä¸€è‡´æ€§æ¨¡å‹æä¾›äº†ä»ä¸¥æ ¼åˆ°å®½æ¾çš„ä¸åŒé€‰æ‹©ï¼Œé€‚åº”ä¸åŒçš„åº”ç”¨éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚ã€‚é€‰æ‹©åˆé€‚çš„ä¸€è‡´æ€§æ¨¡å‹å¯¹å¤šå¤„ç†å™¨ç³»ç»Ÿçš„è®¾è®¡å’Œä¼˜åŒ–è‡³å…³é‡è¦ã€‚&lt;/p>
&lt;h2 id="å››ç§å†…å­˜ä¹±åº">å››ç§å†…å­˜ä¹±åº &lt;a href="#%e5%9b%9b%e7%a7%8d%e5%86%85%e5%ad%98%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹å†…å­˜æ“ä½œè¿›è¡Œä¸åŒç±»å‹çš„ä¹±åºæ‰§è¡Œã€‚è¿™ç§ä¹±åºè¡Œä¸ºåŒ…æ‹¬å››ç§ä¸»è¦ç±»å‹ï¼Œæ¯ä¸€ç§éƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼å½±å“å¤šçº¿ç¨‹ç¨‹åºçš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h3 id="loadload-ä¹±åº">LoadLoad ä¹±åº &lt;a href="#loadload-%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LoadLoad ä¹±åºæŒ‡çš„æ˜¯åç»­çš„åŠ è½½ï¼ˆè¯»å–ï¼‰æ“ä½œå¯ä»¥åœ¨å…ˆå‰çš„åŠ è½½æ“ä½œå®Œæˆä¹‹å‰å¼€å§‹ï¼Œæˆ–è€…ä¸¤ä¸ªåŠ è½½æ“ä½œçš„å®Œæˆé¡ºåºä¸å®ƒä»¬çš„å‘èµ·é¡ºåºä¸åŒã€‚è¿™æ„å‘³ç€å¤„ç†å™¨å¯èƒ½ä¼šä¼˜å…ˆæ‰§è¡Œåå‘èµ·çš„åŠ è½½æ“ä½œã€‚è¿™ç§ä¹±åºä¼˜åŒ–å¯èƒ½æœ‰åŠ©äºæé«˜ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ï¼Œä½†å¦‚æœæœªåŠ ä»¥æ§åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›çº¿ç¨‹è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚&lt;/p>
&lt;h3 id="loadstore-ä¹±åº">LoadStore ä¹±åº &lt;a href="#loadstore-%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LoadStore ä¹±åºè¡¨ç¤ºä¸€ä¸ªå­˜å‚¨ï¼ˆå†™å…¥ï¼‰æ“ä½œå¯ä»¥åœ¨ä¹‹å‰å‘èµ·çš„åŠ è½½æ“ä½œå®Œæˆä¹‹å‰å¼€å§‹æ‰§è¡Œï¼Œæˆ–è€…å†™æ“ä½œå¯èƒ½â€œè¶…è¶Šâ€è¯»æ“ä½œã€‚å°½ç®¡è¿™ç§ä¼˜åŒ–å¯ä»¥æé«˜å¤„ç†å™¨çš„æ€§èƒ½ï¼Œä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¯èƒ½å¯¼è‡´æ„å¤–çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šçœ‹åˆ°æ•°æ®è¢«å†™å…¥ä¹‹å‰çš„çŠ¶æ€ï¼Œå¯¼è‡´é€»è¾‘é”™è¯¯æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;h3 id="storeload-ä¹±åº">StoreLoad ä¹±åº &lt;a href="#storeload-%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>StoreLoad ä¹±åºæ˜¯å››ç§ä¹±åºç±»å‹ä¸­å¯¹ç¼–ç¨‹æ¨¡å‹å½±å“æœ€å¤§çš„ä¸€ç§ã€‚å®ƒå…è®¸ä¸€ä¸ªåŠ è½½æ“ä½œåœ¨ä¹‹å‰çš„å­˜å‚¨æ“ä½œå®Œæˆä¹‹å‰å¼€å§‹ï¼Œæˆ–è€…è¯»å–æ“ä½œå¯èƒ½çœ‹åˆ°å†™æ“ä½œçš„ç»“æœï¼Œå³ä½¿è¿™ä¸ªå†™æ“ä½œåœ¨ç¨‹åºä¸­çš„é¡ºåºä¸Šåº”è¯¥å‘ç”Ÿåœ¨è¯»æ“ä½œä¹‹åã€‚è¿™ç§ä¹±åºæ‰§è¡Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è¯»å–åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„â€œæ—§â€å€¼ï¼Œè€Œä¸æ˜¯æœ€æ–°å†™å…¥çš„å€¼ï¼Œä»è€Œå¼•å‘æ•°æ®åŒæ­¥é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="storestore-ä¹±åº">StoreStore ä¹±åº &lt;a href="#storestore-%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>StoreStore ä¹±åºæ¶‰åŠä¸¤ä¸ªè¿ç»­çš„å­˜å‚¨æ“ä½œï¼Œå…¶ä¸­åä¸€ä¸ªå­˜å‚¨æ“ä½œå¯ä»¥åœ¨ç¬¬ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹å‰å¼€å§‹ï¼Œæˆ–è€…å®ƒä»¬çš„å®Œæˆé¡ºåºä¸å®ƒä»¬è¢«å‘èµ·çš„é¡ºåºä¸åŒã€‚è¿™æ„å‘³ç€ï¼Œåä¸€ä¸ªå†™æ“ä½œçš„ç»“æœå¯èƒ½åœ¨å‰ä¸€ä¸ªå†™æ“ä½œçš„ç»“æœå¯¹å…¶ä»–å¤„ç†å™¨å¯è§ä¹‹å‰å°±å·²ç»è¢«è§‚å¯Ÿåˆ°ï¼Œä»è€Œé€ æˆæ•°æ®é¡ºåºçš„ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;h3 id="ç®¡ç†å†…å­˜ä¹±åºçš„é‡è¦æ€§">ç®¡ç†å†…å­˜ä¹±åºçš„é‡è¦æ€§ &lt;a href="#%e7%ae%a1%e7%90%86%e5%86%85%e5%ad%98%e4%b9%b1%e5%ba%8f%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ­£ç¡®ç®¡ç†è¿™äº›ä¹±åºè¡Œä¸ºå¯¹äºå¹¶å‘ç¼–ç¨‹è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾è®¡æ— é”æ•°æ®ç»“æ„å’Œç¼–å†™å¤šçº¿ç¨‹ç¨‹åºæ—¶ã€‚å¦‚æœä¸åŠ ä»¥æ§åˆ¶ï¼Œè¿™äº›ä¹±åºå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€éš¾ä»¥é‡ç°çš„é”™è¯¯å’Œç¨‹åºå´©æºƒã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨å’Œç¼–ç¨‹è¯­è¨€æä¾›äº†å„ç§å†…å­˜å±éšœï¼ˆMemory Barriersï¼‰æˆ–å†…å­˜é¡ºåºï¼ˆMemory Orderï¼‰æŒ‡ä»¤ï¼Œç¡®ä¿åœ¨å…³é”®çš„ç¨‹åºç‚¹ä¸Šå¼ºåˆ¶æ‰§è¡Œæ‰€éœ€çš„å†…å­˜æ“ä½œé¡ºåºã€‚è¿™äº›æœºåˆ¶å¸®åŠ©ç¨‹åºå‘˜åœ¨ä¼˜åŒ–æ€§èƒ½çš„åŒæ—¶ï¼Œç»´æŠ¤æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨litmuså·¥å…·åˆ†æå†…å­˜ä¹±åº---ä»¥x86-tsoä¸ºä¾‹">ä½¿ç”¨Litmuså·¥å…·åˆ†æå†…å­˜ä¹±åº - ä»¥x86-TSOä¸ºä¾‹ &lt;a href="#%e4%bd%bf%e7%94%a8litmus%e5%b7%a5%e5%85%b7%e5%88%86%e6%9e%90%e5%86%85%e5%ad%98%e4%b9%b1%e5%ba%8f---%e4%bb%a5x86-tso%e4%b8%ba%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œç†è§£å’ŒéªŒè¯å†…å­˜æ¨¡å‹çš„è¡Œä¸ºå¯¹äºç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§è‡³å…³é‡è¦ã€‚ä»¥ x86 Total Store Order (x86-TSO) ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Litmus æµ‹è¯•å·¥å…·æ¥åˆ†æå†…å­˜ä¹±åºç°è±¡ï¼Œå¹¶äº†è§£å¦‚ä½•é€šè¿‡å†…å­˜å±éšœæ¥é¿å…è¿™ç§æƒ…å†µã€‚&lt;/p>
&lt;blockquote>
&lt;p>Litmuså·¥å…·å¯ä»¥åœ¨&lt;a href="https://developer.arm.com/herd7">è¿™é‡Œ&lt;/a>åœ¨çº¿è¯•ç”¨ï¼Œä¹Ÿå¯ä»¥å®‰è£…åˆ°æœ¬åœ°ç¯å¢ƒ&lt;/p>&lt;/blockquote>
&lt;h3 id="x86-total-store-order-x86-tso">x86 Total Store Order (x86-TSO) &lt;a href="#x86-total-store-order-x86-tso" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-09-01/1725159498577_mem-tso_1723970692408_0.png" alt="">&lt;/p>
&lt;p>åœ¨ x86 æ¶æ„ä¸­ï¼ŒStore Bufferï¼ˆå­˜å‚¨ç¼“å†²åŒºï¼‰ç”¨äºæš‚æ—¶å­˜æ”¾å¤„ç†å™¨çš„å†™æ“ä½œï¼Œè€Œä¸ç«‹å³å°†å…¶å†™å…¥ä¸»å­˜ã€‚è¿™ç§æœºåˆ¶æé«˜äº†å¤„ç†å™¨çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒå…è®¸å¤„ç†å™¨åœ¨å†™æ“ä½œå°šæœªå®Œæˆæ—¶ç»§ç»­æ‰§è¡Œåç»­æŒ‡ä»¤ã€‚ç„¶è€Œï¼ŒStore Buffer ä¹Ÿå¯¼è‡´äº†æŸäº›å†…å­˜æ“ä½œçš„å¯è§æ€§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ã€‚&lt;/p>
&lt;p>x86 Total Store Order (x86-TSO) æ¨¡å‹çš„ç‰¹æ€§æ­£æ˜¯ç”±è¿™ç§ Store Buffer æœºåˆ¶å†³å®šçš„ã€‚ç”±äºå†™æ“ä½œåœ¨ Store Buffer ä¸­æš‚å­˜ï¼Œx86-TSO æ¨¡å‹ä¿è¯äº†ä¸€äº›å…³é”®ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿåšå‡ºäº†ä¸€äº›åŸºäºæ€§èƒ½çš„å¦¥åï¼š&lt;/p>
&lt;ul>
&lt;li>å†™æ“ä½œé¡ºåºä¸€è‡´æ€§ï¼šæ‰€æœ‰å†™æ“ä½œæŒ‰ç…§ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼Œå¹¶å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ï¼Œå³å†™æ“ä½œåœ¨ Store Buffer åˆ·æ–°åˆ°ä¸»å­˜ä¹‹å‰ï¼Œä¸ä¼šè¢«å…¶ä»–å¤„ç†å™¨çœ‹åˆ°ã€‚&lt;/li>
&lt;li>è¯»æ“ä½œçš„è‡ªæˆ‘å¯è§æ€§ï¼šå¤„ç†å™¨å¯ä»¥ç«‹å³çœ‹åˆ°è‡ªå·±åœ¨ Store Buffer ä¸­çš„æœ€æ–°å†™å…¥ï¼Œå³æœ¬å¤„ç†å™¨çš„è¯»æ“ä½œå¯ä»¥ä» Store Buffer ä¸­è¯»å–æœªæäº¤åˆ°ä¸»å­˜çš„å€¼ã€‚&lt;/li>
&lt;li>é˜²æ­¢æŸäº›é‡æ’åºï¼šä¸ºäº†é¿å…å›  Store Buffer å¯¼è‡´çš„è¯»å†™ä¹±åºï¼Œx86-TSO ç¦æ­¢å†™æ“ä½œä¸å…¶åçš„è¯»æ“ä½œé‡æ’åºï¼Œç¡®ä¿è¯»å†™é¡ºåºä¸€è‡´ã€‚&lt;/li>
&lt;li>å…è®¸éƒ¨åˆ†è¯»æ“ä½œé‡æ’åºï¼šä¸ºäº†è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œå¤„ç†å™¨å…è®¸ä¸€äº›è¯»æ“ä½œçš„é‡æ’åºï¼Œä½†ä»ç„¶éµå¾ªä¸¥æ ¼çš„è§„åˆ™ä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨-litmus-éªŒè¯-x86-çš„-storeload-ä¹±åº">ä½¿ç”¨ Litmus éªŒè¯ x86 çš„ StoreLoad ä¹±åº &lt;a href="#%e4%bd%bf%e7%94%a8-litmus-%e9%aa%8c%e8%af%81-x86-%e7%9a%84-storeload-%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Litmus å·¥å…·æ¥éªŒè¯åœ¨ x86-TSO å†…å­˜æ¨¡å‹ä¸‹çš„ StoreLoad ä¹±åºè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-litmus" data-lang="litmus">X86 SB
{ x = 0; y = 0; }
P0 | P1 ;
MOV [y],$1 | MOV [x],$1 ;
MOV EAX,[x] | MOV EAX,[y] ;
exists
(0:EAX=0 /\ 1:EAX=0)
&lt;/code>&lt;/pre>&lt;p>åœ¨æ‰§è¡Œè¯¥ä»£ç åï¼ŒLitmus ä¼šç”Ÿæˆå››ç§å¯èƒ½çš„ç»“æœï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„æ‰§è¡Œé¡ºåºã€‚&lt;/p>
&lt;h4 id="ç»“æœ1">ç»“æœ1 &lt;a href="#%e7%bb%93%e6%9e%9c1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-09-01/1725159921512_graph3_1725095884015_0.png" alt="">&lt;/p>
&lt;p>åœ¨ç»“æœ1ä¸­ï¼Œç¨‹åºæŒ‰ç…§ä¸¥æ ¼çš„é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨çš„å†…å­˜æ“ä½œé¡ºåºä¸ç¨‹åºä¸­çš„é¡ºåºä¸€è‡´ã€‚&lt;/p>
&lt;p>å›¾ä¸­ï¼Œpoï¼ˆProgram Orderï¼‰è¡¨ç¤ºç¨‹åºé¡ºåºï¼Œrfï¼ˆReads-Fromï¼‰è¡¨ç¤ºæ¯ä¸ªè¯»æ“ä½œä»å“ªä¸ªå†™æ“ä½œä¸­è¯»å–çš„å€¼ã€‚ç”±äºå†…å­˜æ“ä½œæŒ‰ç…§é¢„æœŸé¡ºåºæ‰§è¡Œï¼Œè¿™ç§æƒ…å†µæ²¡æœ‰è¿›ä¸€æ­¥çš„ä¹±åºè¡Œä¸ºï¼Œå› æ­¤ä¸éœ€è¦è¿›ä¸€æ­¥åˆ†æ&lt;/p>
&lt;h4 id="ç»“æœ2ç»“æœ3">ç»“æœ2/ç»“æœ3 &lt;a href="#%e7%bb%93%e6%9e%9c2%e7%bb%93%e6%9e%9c3" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-09-01/1725160079968_graph1_1725098202554_0.png" alt="">
&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-09-01/1725160089725_graph2_1725098310293_0.png" alt="">&lt;/p>
&lt;p>ç»“æœ2å’Œç»“æœ3æ˜¯å¯¹ç§°çš„ï¼Œè¡¨ç¤ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå†…å­˜çš„è¯»å–å‘ç”Ÿäº†â€œä¹±åºâ€ï¼Œå³è¯»å–æ“ä½œè¢«é‡æ’åˆ°äº†å†™å…¥æ“ä½œä¹‹å‰ã€‚åœ¨ Litmus ä¸­ï¼Œè¿™ç§æƒ…å†µè¢«æ ‡è®°ä¸º frï¼ˆFrom-Readï¼‰ï¼Œè¡¨ç¤ºä¸€ä¸ªå†™æ“ä½œè¦†ç›–äº†ä¸€ä¸ªè¯»æ“ä½œæ‰€è¯»å–çš„å€¼ï¼Œå³è¿™ä¸ªå†™æ“ä½œå‘ç”Ÿåœ¨è¯»æ“ä½œä¹‹åã€‚è¿™ç§â€œå†™è¯»â€æ“ä½œçš„ä¹±åºå¯èƒ½æ˜¯ç”±äºæ‰§è¡Œé¡ºåºçš„ä¸åŒï¼Œä¹Ÿå¯èƒ½æ˜¯å†…å­˜æ¨¡å‹çš„é¡ºåºé€ æˆçš„ã€‚&lt;/p>
&lt;h4 id="ç»“æœ4">ç»“æœ4 &lt;a href="#%e7%bb%93%e6%9e%9c4" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-09-01/1725160171251_graph0_1725099005660_0.png" alt="">&lt;/p>
&lt;p>ç»“æœ4è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹å„è‡ªéƒ½å‘ç”Ÿäº† frï¼Œå³æ¯ä¸ªçº¿ç¨‹çš„è¯»æ“ä½œéƒ½è¢«é‡æ’åˆ°äº†å†™æ“ä½œä¹‹å‰ã€‚è¿™ç§æƒ…å†µå±•ç¤ºäº†æœ€å¤æ‚çš„ä¹±åºè¡Œä¸ºï¼Œå…¶ä¸­ä¸¤ä¸ªçº¿ç¨‹çš„è¯»æ“ä½œåˆ†åˆ«â€œè¶…è¶Šâ€äº†å„è‡ªçš„å†™æ“ä½œã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨å†…å­˜å±éšœmfenceæŒ‡ä»¤é¿å…å†…å­˜ä¹±åº">ä½¿ç”¨å†…å­˜å±éšœï¼ˆMFENCEï¼‰æŒ‡ä»¤é¿å…å†…å­˜ä¹±åº &lt;a href="#%e4%bd%bf%e7%94%a8%e5%86%85%e5%ad%98%e5%b1%8f%e9%9a%9cmfence%e6%8c%87%e4%bb%a4%e9%81%bf%e5%85%8d%e5%86%85%e5%ad%98%e4%b9%b1%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸ºäº†é¿å…è¿™ç§ä¹±åºæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ MFENCEï¼ˆMemory Fenceï¼‰ æŒ‡ä»¤ã€‚åœ¨ x86 æ¶æ„ä¸­ï¼ŒMFENCE æ˜¯ä¸€ç§å¼ºåˆ¶å†…å­˜å±éšœï¼Œç¡®ä¿æ‰€æœ‰åœ¨ MFENCE ä¹‹å‰çš„å†…å­˜æ“ä½œï¼ˆæ— è®ºæ˜¯è¯»è¿˜æ˜¯å†™ï¼‰åœ¨æ‰€æœ‰ MFENCE ä¹‹åçš„å†…å­˜æ“ä½œä¹‹å‰å®Œæˆã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€çº¿ç¨‹å†…ï¼ŒMFENCE ä¿è¯äº†å†…å­˜æ“ä½œçš„é¡ºåºæ€§ï¼šMFENCE ä¹‹å‰çš„æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§åï¼Œæ‰å¯ä»¥æ‰§è¡Œ MFENCE ä¹‹åçš„æ“ä½œã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å°† Litmus ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼Œä»¥æ’å…¥ MFENCE æŒ‡ä»¤ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-litmus" data-lang="litmus">X86 SB
{ x = 0; y = 0; }
P0 | P1 ;
MOV [y],$1 | MOV [x],$1 ;
MFENCE | MFENCE ;
MOV EAX,[x] | MOV EAX,[y] ;
exists
(0:EAX=0 /\ 1:EAX=0)
&lt;/code>&lt;/pre>&lt;p>åœ¨åŠ å…¥å†…å­˜å±éšœåï¼Œæˆ‘ä»¬çœ‹åˆ°ç»“æœ1åˆ°ç»“æœ3ä¾ç„¶ä¼šå‡ºç°ï¼Œä½†ç»“æœ4å›  MFENCE çš„å­˜åœ¨è€Œè¢«é¿å…ã€‚é€šè¿‡ MFENCE ç¡®ä¿äº†å†…å­˜æ“ä½œçš„é¡ºåºæ€§ï¼Œä»è€Œé˜²æ­¢äº†æŸäº›ç±»å‹çš„å†…å­˜ä¹±åºï¼Œä¿è¯äº†å¤šçº¿ç¨‹ç¨‹åºçš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h2 id="æ¥ä¸‹æ¥">æ¥ä¸‹æ¥&amp;hellip; &lt;a href="#%e6%8e%a5%e4%b8%8b%e6%9d%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šä»‹ç»C++çš„å†…å­˜é¡ºåºæ¨¡å‹ï¼Œå¹¶ä¸”åˆ†ææ›´å¤æ‚çš„å†…å­˜ä¹±åºé—®é¢˜&lt;/p>
&lt;h2 id="references">References &lt;a href="#references" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://colobu.com/2021/06/30/hwmm/">ç¡¬ä»¶å†…å­˜æ¨¡å‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://book.douban.com/subject/36240082/">RISC-Vä½“ç³»ç»“æ„ç¼–ç¨‹ä¸å®è·µ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.microsoft.com/en-us/research/publication/make-multiprocessor-computer-correctly-executes-multiprocess-programs/">How to Make a Multiprocessor Computer That Correctly Executes Multiprocess Programs&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dl.acm.org/doi/10.1145/285930.285991">Memory access buffering in multiprocessors&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.cl.cam.ac.uk/~pes20/weakmemory/tacas11.pdf">Litmus: Running Tests Against Hardware&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.arm.com/herd7">Herd7 Simulator&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/0voice/dpdk_engineer_manual/blob/main/%E5%A4%A7%E4%BC%9APPT/NA%202021-Memory%20Model%20Simulation%20Tool%20-%20Herd7.pdf">Memory Model Simulation Tool - Herd7&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/how-to-use-the-memory-model-tool#intuitively">A working example of how to use the herd7 Memory Model Tool&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>åˆ©ç”¨å‡¸ç»„åˆæ±‚è§£æœ€ä¼˜å€¼ï¼ˆAtCoder abc356_g Freestyle é¢˜è§£ï¼‰</title><link>https://wizmann.top/posts/atcoder-abc356g-solution/</link><pubDate>Sat, 15 Jun 2024 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/atcoder-abc356g-solution/</guid><description>&lt;ul>
&lt;li>
&lt;h2 id="é¢˜ç›®å¤§æ„">é¢˜ç›®å¤§æ„ &lt;a href="#%e9%a2%98%e7%9b%ae%e5%a4%a7%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>æˆ‘ä»¬å·²ç»å­¦ä¼šäº† &lt;strong>N&lt;/strong> ç§ä¸åŒçš„æ¸¸æ³³æŠ€æœ¯ã€‚å¯¹äºæ¯ç§æŠ€æœ¯ $i$ ï¼Œæ¯ç§’å‰è¿› $A_{i}$ ç±³ï¼Œå¹¶æ¶ˆè€— $B_{i}$ å•ä½çš„ä½“åŠ›ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„è°ƒæ•´æ¯ç§æŠ€æœ¯çš„ä½¿ç”¨æ—¶é•¿ $t_i$ ï¼Œå…¶ä¸­ $t_i$ æ˜¯ä¸€ä¸ªå®æ•°&lt;/li>
&lt;li>ç°åœ¨ï¼Œæˆ‘ä»¬é¢ä¸´ $Q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®æŒ‡å®šè·ç¦»ç»ˆç‚¹çš„è·ç¦» $C_j$ å’Œä½“åŠ›é™åˆ¶ $D_j$ ã€‚æˆ‘ä»¬éœ€è¦ç¡®å®šæ˜¯å¦åœ¨ä½“åŠ›é™åˆ¶ä¸‹åˆ°è¾¾ç»ˆç‚¹ã€‚å¦‚æœå¯ä»¥ï¼Œæ±‚å‡ºæ‰€éœ€çš„æœ€çŸ­æ—¶é—´ã€‚&lt;/li>
&lt;li>ï¼ˆç¬¦å·ä½¿ç”¨ä¸åŸé¢˜ç•¥æœ‰å·®å¼‚ï¼‰&lt;/li>
&lt;li>&lt;strong>æ•°æ®è§„æ¨¡&lt;/strong>ï¼š
&lt;ul>
&lt;li>$1 &amp;lt;= N, Q &amp;lt;= 2 \times 10^5$&lt;/li>
&lt;li>$1 &amp;lt;= A_i, B_i, C_j, D_j &amp;lt;= 10^9$&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ &lt;a href="#%e9%a2%98%e7%9b%ae%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>é‰´äºæ•°æ®è§„æ¨¡åºå¤§ï¼Œå¹¶ä¸”æ—¶é—´ $t_i$ æ˜¯å®æ•°ï¼Œä¼ ç»Ÿçš„åŠ¨æ€è§„åˆ’æ–¹æ³•ä¸é€‚ç”¨ã€‚åœ¨å¤„ç†æ¯æ¬¡è¯¢é—®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶è€ƒè™‘è·ç¦»ã€ä½“åŠ›å’Œæ—¶é—´ä¸‰ä¸ªå˜é‡ã€‚ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•æ˜¯è½¬åŒ–è¿™äº›å˜é‡ä¸ºå•ä½æ—¶é—´å†…çš„è·ç¦»ï¼ˆå³é€Ÿåº¦ï¼‰å’Œå•ä½æ—¶é—´å†…çš„ä½“åŠ›æ¶ˆè€—ã€‚å¦‚æœå•ä½æ—¶é—´å†…çš„è·ç¦»å¤§äºå•ä½æ—¶é—´å†…çš„ä½“åŠ›æ¶ˆè€—ï¼Œé‚£ä¹ˆç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥åˆ°è¾¾ç»ˆç‚¹ã€‚æ¥ä¸‹æ¥çš„ç›®æ ‡æ˜¯åœ¨æ‰€æœ‰å¯èƒ½çš„æƒ…å†µä¸­æ‰¾åˆ°æœ€å¤§çš„é€Ÿåº¦ï¼Œä½œä¸ºæœ€ç»ˆç­”æ¡ˆã€‚
ä»¥ä¸¤ç§æ¸¸æ³³æŠ€æœ¯ï¼ˆN=2ï¼‰ä¸ºä¾‹è¿›è¡Œå…·ä½“åˆ†æã€‚å‡è®¾åœ¨æ€»æ¸¸æ³³æ—¶é—´ä¸­ï¼ŒæŠ€æœ¯1å’ŒæŠ€æœ¯2çš„ä½¿ç”¨æ—¶é—´æ¯”ä¾‹åˆ†åˆ«ä¸º $p$ å’Œ $1-p$ ï¼ˆå…¶ä¸­ $0 \leq p \leq 1$ ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ç§’å‰è¿›è·ç¦»ä¸º $A_1 \cdot p + A_2 \cdot (1 - p)$ ï¼Œä½“åŠ›æ¶ˆè€—ä¸º $B_1 \cdot p + B_2 \cdot (1 - p)$ ã€‚&lt;br>
ä»å‡ ä½•è§’åº¦çœ‹ï¼Œç»„åˆè¿™ä¸¤ç§æ¸¸æ³³æŠ€æœ¯çš„é€Ÿåº¦ä¸ä½“åŠ›æ¶ˆè€— $(A_x, B_x)$ ä¸º $(A_1, B_1) \cdot p$ å’Œ $(A_2, B_2) \cdot (1 - p)$ çš„å‘é‡å’Œï¼Œå…¶å¯èƒ½çš„å–å€¼ä½äºä»¥ $(A_1, B_1)$ å’Œ $(A_2, B_2)$ ä¸ºç«¯ç‚¹çš„çº¿æ®µä¸Šçš„ä»»æ„ä¸€ç‚¹ã€‚&lt;br>
å¯¹äºå…·ä½“è¯¢é—® $(C_i, D_i)$ ï¼Œä¸ºäº†ç¡®ä¿â€œåœ¨åˆ°è¾¾ç»ˆç‚¹ä¹‹å‰ä¸èƒ½è€—å°½ä½“åŠ›â€ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°çš„ç‚¹å¿…é¡»ä½äºæ–œç‡ä¸º $D_i/C_i$ çš„å°„çº¿ä¸xè½´ä¹‹é—´çš„å¤¹è§’å†…ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ˜¯å¦æœ‰å¯èƒ½åœ¨ç»™å®šçš„ä½“åŠ›é™åˆ¶ä¸‹å®ŒæˆæŒ‡å®šçš„è·ç¦»ï¼Œå¹¶æ‰¾åˆ°é€Ÿåº¦æœ€å¿«çš„ç‚¹ã€‚&lt;/li>
&lt;li>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/965294986c47c3153fe9cd4e831748903ba224ef/wizmann-pic/24-06-15/%E4%B8%8B%E8%BD%BD_1718003803558_0.png" alt="ä¸‹è½½_1718003803558_0.png">&lt;/li>
&lt;li>å¯¹äºå¤šç§æ¸¸æ³³æŠ€æœ¯çš„ç»„åˆï¼Œæƒ…å†µä¼šæ›´å¤æ‚ä¸€äº›ã€‚æˆ‘ä»¬å°†æ‰€æœ‰æ¸¸æ³³æŠ€æœ¯è§†ä¸ºä¸€ç»„å‘é‡ $(A_1, B_1), (A_2, B_2), \ldots, (A_n, B_n)$ å’Œä¸€ç»„å¯¹åº”çš„æƒé‡ $p_1, p_2, \ldots, p_n$ ï¼Œå…¶ä¸­ $\sum_{i=1}^n p_i = 1$ å¹¶ä¸”æ¯ä¸ª $p_i \geq 0$ ï¼Œé‚£ä¹ˆè¿™äº›å‘é‡çš„åŠ æƒå’Œ $\sum_{i=1}^n p_i (A_i, B_i)$ å®šä¹‰äº†ä¸€ä¸ªåœ¨äºŒç»´ç©ºé—´ä¸­çš„å‡¸å¤šè¾¹å½¢ï¼Œç§°ä¸ºè¿™äº›å‘é‡çš„å‡¸åŒ…ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬å¯ä»¥ç”¨ç¨å¾®è¯¦ç»†ä¸€ç‚¹çš„æ•°å­¦æ¥è§£é‡Šè¿™ä¸€è¿‡ç¨‹ï¼š
&lt;ul>
&lt;li>
&lt;h3 id="å‘é‡çš„çº¿æ€§ç»„åˆ">å‘é‡çš„çº¿æ€§ç»„åˆ &lt;a href="#%e5%90%91%e9%87%8f%e7%9a%84%e7%ba%bf%e6%80%a7%e7%bb%84%e5%90%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>é¦–å…ˆï¼Œå®šä¹‰å‘é‡ $\mathbf{v}_1, \mathbf{v}_2, \ldots, \mathbf{v}_n$ åœ¨äºŒç»´ç©ºé—´ä¸­çš„ä½ç½®ã€‚æ¯ä¸ªå‘é‡ $\mathbf{v}&lt;em>i$ å¯ä»¥è¡¨ç¤ºä¸ºä»åŸç‚¹åˆ°ç‚¹ $(x_i, y_i)$ çš„ç®­å¤´ã€‚
å½“æˆ‘ä»¬è€ƒè™‘è¿™äº›å‘é‡çš„çº¿æ€§ç»„åˆæ—¶ï¼š $\sum&lt;/em>{i=1}^n \lambda_i \mathbf{v}_i$&lt;br>
å…¶ä¸­ï¼Œæ¯ä¸ª $\lambda_i$ æ˜¯ä¸€ä¸ªå®æ•°ç³»æ•°ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨æè¿°ä¸€ä¸ªæ–°å‘é‡ï¼Œè¿™ä¸ªå‘é‡æ˜¯é€šè¿‡åœ¨æ¯ä¸ªåŸå‘é‡ä¸Šâ€œæ‹‰ä¼¸â€æˆ–â€œå‹ç¼©â€ï¼ˆå–å†³äº $\lambda_i$ çš„æ­£è´Ÿå’Œå¤§å°ï¼‰ï¼Œç„¶åå°†ç»“æœç›¸åŠ å¾—åˆ°çš„ã€‚è¿™ç§çº¿æ€§ç»„åˆåœ¨å‡ ä½•ä¸Šå®šä¹‰äº†ä¸€ä¸ªç‚¹çš„é›†åˆã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å‡¸ç»„åˆä¸å‡¸å¤šè¾¹å½¢">å‡¸ç»„åˆä¸å‡¸å¤šè¾¹å½¢ &lt;a href="#%e5%87%b8%e7%bb%84%e5%90%88%e4%b8%8e%e5%87%b8%e5%a4%9a%e8%be%b9%e5%bd%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å½“è¿™äº›ç³»æ•° $\lambda_i$ éƒ½éè´Ÿä¸”å’Œä¸º1ï¼ˆå³ $\lambda_i \geq 0$ ä¸” $\sum_{i=1}^n \lambda_i = 1$ ï¼‰ï¼Œæˆ‘ä»¬ç§°è¿™æ ·çš„çº¿æ€§ç»„åˆä¸º&lt;strong>å‡¸ç»„åˆ&lt;/strong>ã€‚å‡¸ç»„åˆå…·æœ‰é‡è¦çš„å‡ ä½•ç‰¹æ€§ï¼šå®ƒå®šä¹‰çš„ç‚¹ä¸€å®šä½äºè¿™äº›å‘é‡ç«¯ç‚¹æ‰€å½¢æˆçš„å‡¸å¤šè¾¹å½¢å†…éƒ¨æˆ–è¾¹ç•Œä¸Šã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å‡¸å¤šè¾¹å½¢çš„å½¢æˆ">å‡¸å¤šè¾¹å½¢çš„å½¢æˆ &lt;a href="#%e5%87%b8%e5%a4%9a%e8%be%b9%e5%bd%a2%e7%9a%84%e5%bd%a2%e6%88%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>
&lt;ol>
&lt;li>&lt;strong>è¾¹ç•Œçš„æ„æˆ&lt;/strong>ï¼šå¦‚æœä½ åªè€ƒè™‘ä¸¤ä¸ªå‘é‡ $\mathbf{v}_1$ å’Œ $\mathbf{v}_2$ ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å‡¸ç»„åˆä¼šå½¢æˆä¸€æ¡è¿æ¥ä¸¤ç‚¹ $(x_1, y_1)$ å’Œ $(x_2, y_2)$ çš„çº¿æ®µã€‚è¿™æ¡çº¿æ®µæ˜¯ç›´çº¿ï¼Œå› ä¸ºæ‰€æœ‰çš„ç»„åˆç‚¹éƒ½ç›´æ¥é€šè¿‡ä¸¤ç‚¹é—´çš„ç›´çº¿è·¯å¾„äº’ç›¸è¿ç»“ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="2">
&lt;li>&lt;strong>æ‰©å±•åˆ°å¤šä¸ªå‘é‡&lt;/strong>ï¼šå½“ä½ æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‘é‡æ—¶ï¼Œé€šè¿‡è€ƒè™‘ä»»æ„ä¸¤ä¸ªå‘é‡çš„æ‰€æœ‰å‡¸ç»„åˆï¼ˆå³æ‰€æœ‰å¯èƒ½çš„çº¿æ®µï¼‰ï¼Œç„¶åå†å°†è¿™äº›çº¿æ®µçš„ç»“æœè¿›è¡Œç»„åˆï¼Œæœ€ç»ˆä½ å°†è¦†ç›–ä¸€ä¸ªå¤šè¾¹å½¢åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸæ˜¯ç”±æœ€å¤–å›´çš„å‘é‡ç‚¹å®šä¹‰çš„ï¼Œè¿™äº›ç‚¹åœ¨å‡ ä½•ä¸Šæ„æˆäº†å‡¸å¤šè¾¹å½¢çš„é¡¶ç‚¹ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;ol start="3">
&lt;li>&lt;strong>æ•°å­¦æè¿°&lt;/strong>ï¼šåœ¨æ•°å­¦ä¸Šï¼Œè¿™ä¸ªåŒºåŸŸå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰å¯èƒ½çš„ $\lambda_i$ å€¼ï¼ˆç¬¦åˆå‡¸ç»„åˆæ¡ä»¶ï¼‰ä¸‹çš„ $\sum_{i=1}^n \lambda_i \mathbf{v}_i$ çš„é›†åˆã€‚ç”±äºæ¯ä¸ª $\lambda_i$ éƒ½ä¿è¯éè´Ÿä¸”å’Œä¸º1ï¼Œå‡¸å¤šè¾¹å½¢çš„ä»»æ„å†…éƒ¨æˆ–è¾¹ç•Œç‚¹éƒ½å¯ä»¥é€šè¿‡è¿™æ ·çš„ç»„åˆè¡¨ç¤ºï¼Œä¸”ä¸ä¼šæœ‰ä»»ä½•ç‚¹â€œå‡¸å‡ºâ€äºè¿™ä¸ªå®šä¹‰çš„å¤šè¾¹å½¢ä¹‹å¤–ï¼Œè¿™æ­£æ˜¯å‡¸æ€§è´¨çš„ä½“ç°ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç±»ä¼¼äºä»…æ¶‰åŠä¸¤ä¸ªç‚¹çš„ç®€å•æƒ…å†µï¼Œä¸ºäº†è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å‡¸å¤šè¾¹å½¢å†…ä¸ $x$ è½´ä¹‹é—´æ–œç‡ä¸º $D_i/C_i$ çš„å°„çº¿åŒ…å›´çš„åŒºåŸŸï¼ˆå³å‡¸åŒ…ä¸­çš„æ·±è‰²éƒ¨åˆ†ï¼‰ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥éœ€è¦æ‰¾å‡ºè¯¥éƒ¨åˆ†ä¸­åœ¨ $x$ è½´ä¸Šå–å¾—æœ€å¤§å€¼çš„ç‚¹ã€‚&lt;/li>
&lt;li>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/965294986c47c3153fe9cd4e831748903ba224ef/wizmann-pic/24-06-15/geogebra-export_1718034870873_0.png" alt="geogebra-export.png">&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ä»£ç å®ç°---å¹¶ä¸é«˜æ•ˆ">ä»£ç å®ç° - å¹¶ä¸é«˜æ•ˆ &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0---%e5%b9%b6%e4%b8%8d%e9%ab%98%e6%95%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;h3 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤ &lt;a href="#%e5%ae%9e%e7%8e%b0%e6%ad%a5%e9%aa%a4" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ±‚å‡ºæ‰€æœ‰ $(A_i, B_i)$ ç‚¹æ‰€æ„æˆçš„å‡¸åŒ…&lt;/li>
&lt;li>å¯¹äºæ¯ä¸€ä¸ªæŸ¥è¯¢Qï¼Œä»é›¶ç‚¹ç”»å‡ºæ–œç‡ä¸º $D_i / C_i$ çš„å°„çº¿&lt;/li>
&lt;li>å¦‚æœå‡¸åŒ…ä½äºå°„çº¿çš„â€œä¸Šæ–¹â€ï¼Œåˆ™æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„æƒ…å†µï¼Œè¿”å›-1&lt;/li>
&lt;li>å¦‚æœå‡¸åŒ…ä½äºå°„çº¿çš„â€œä¸‹æ–¹â€æˆ–ä¸å°„çº¿ç›¸äº¤ï¼Œåˆ™éœ€è¦æ‰¾åˆ°å‡¸åŒ…åœ¨å°„çº¿â€œä¸‹æ–¹â€ $B_i$ å€¼æœ€å¤§çš„ç‚¹ã€‚æ„å‘³ç€è¿™ä¸ªç»„åˆå¯ä»¥æˆåŠŸåˆ°è¾¾ç»ˆç‚¹ï¼Œå¹¶ä¸”å¹³å‡é€Ÿåº¦æœ€å¿«&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ &lt;a href="#%e5%a4%8d%e6%9d%82%e5%ba%a6%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å¯¹äºæ¯ä¸€æ¬¡æŸ¥è¯¢ï¼Œæˆ‘ä»¬éƒ½è¦éå†å‡¸åŒ…çš„æ‰€æœ‰è¾¹ï¼ˆå³â€œå‡¸åŒ…å£³â€ï¼‰ä¸å°„çº¿çš„äº¤ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦ $O(n)$ ã€‚&lt;/li>
&lt;li>å¯¹äºæ‰€æœ‰æŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(q * n)$ ï¼Œæ˜æ˜¾æ˜¯ä¼šè¶…æ—¶çš„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ä¼˜åŒ–çš„å¯èƒ½æ€§">ä¼˜åŒ–çš„å¯èƒ½æ€§ &lt;a href="#%e4%bc%98%e5%8c%96%e7%9a%84%e5%8f%af%e8%83%bd%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>æ˜“çŸ¥ï¼Œå¹¶ä¸æ˜¯å‡¸åŒ…çš„æ‰€æœ‰éƒ¨åˆ†éƒ½èƒ½å¾—å‡ºæœ€ä¼˜è§£ã€‚ä¸åŸç‚¹è¿çº¿æ–œç‡è¶Šå°çš„ç‚¹ï¼Œå…¶â€œæ€§ä»·æ¯”â€è¶Šé«˜ï¼Œå³åœ¨æ¶ˆè€—æ›´å°‘çš„ä½“åŠ›çš„åŒæ—¶ï¼Œå¯ä»¥æ¸¸æ›´è¿œçš„è·ç¦»ã€‚
åŒæ—¶ï¼Œå¦‚æœå‡¸åŒ…å†…éƒ¨çš„æŸä¸€ä¸ªç‚¹æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æ€»æœ‰ä½äºå‡¸åŒ…å£³ä¸Šé¢çš„å¦ä¸€ä¸ªç‚¹ä¸å®ƒæ›´ä¼˜ã€‚åŒæ ·ï¼Œå¦‚æœå‡¸åŒ…å£³ä¸Šæœ‰ä¸¤ä¸ªç‚¹çš„æ–œç‡ç›¸åŒï¼Œé‚£ä¹ˆ $B_i$ å€¼æ›´å¤§çš„ç‚¹æ˜¯æ›´ä¼˜çš„ã€‚&lt;br>
æ‰€ä»¥ä¼˜åŒ–çš„ç›®æ ‡åœ¨äºæ‰¾åˆ°ä¸€ç³»åˆ—å‡¸åŒ…å£³ï¼Œä½¿å…¶å¯ä»¥åªä¿ç•™æœ€ä¼˜è§£æ‰€åœ¨çš„è¾¹ï¼Œå¹¶ä¸”æ’é™¤æ‰€æœ‰éæœ€ä¼˜çš„æƒ…å†µã€‚&lt;br>
æˆ‘ä»¬å¯ä»¥ä»â€œæ€§ä»·æ¯”â€æœ€å¥½çš„ç‚¹å¼€å§‹ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæ‰€éœ€è¦çš„â€œæ€§ä»·æ¯”â€é«˜äºæˆ‘ä»¬æ‰€æœ‰çš„é€‰é¡¹ï¼Œé‚£ä¹ˆä¸€å®šæ²¡æœ‰è§£ã€‚&lt;br>
ç„¶åæˆ‘ä»¬é€†æ—¶é’ˆéå†æ‰€æœ‰ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ° $B_i$ å€¼æœ€å¤§çš„ç‚¹ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªæŸ¥è¯¢ï¼Œåœ¨æ»¡è¶³â€œæ€§ä»·æ¯”â€çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬èƒ½ç»™å‡ºçš„ï¼Œæ¶ˆè€—æ—¶é—´æœ€å°çš„ç­”æ¡ˆã€‚&lt;/li>
&lt;li>
&lt;h3 id="å®ç°æ–¹æ¡ˆ1">å®ç°æ–¹æ¡ˆ1: &lt;a href="#%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%881" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡¸åŒ…ç®—æ³•ï¼Œæ‰¾åˆ°å‡¸åŒ…å£³ï¼ŒæŒ‰ç…§ä¸Šæ–‡æ‰€è¿°çš„æ–¹æ³•ï¼Œæ‰¾åˆ°æ–œç‡æœ€å°ï¼ˆæ‰€è°“â€œæ€§ä»·æ¯”æœ€é«˜â€ï¼‰çš„ç‚¹ï¼Œç„¶åé€†æ—¶é’ˆéå†åˆ° $B_i$ æœ€å¤§çš„ç‚¹ã€‚è¿™äº›ç‚¹å¿…ç„¶ä»¥æ–œç‡ä»å°åˆ°å¤§æ’åºã€‚
å¯¹äºä¸€ä¸ªæŸ¥è¯¢ $(C_i, D_i)$ ï¼Œæˆ‘ä»¬å°†å…¶è§†ä¸ºæ–œç‡ä¸º $D_i / C_i$ çš„å°„çº¿ã€‚æˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æ³•ï¼Œæ‰¾åˆ°ä¸è¯¥å°„çº¿ç›¸äº¤çš„å‡¸åŒ…å£³è¾¹ã€‚å†é€šè¿‡è”ç«‹æ–¹ç¨‹æ–¹æ³•æ‰¾åˆ°å…¶äº¤ç‚¹ $(A_x, B_x)$ ï¼Œå…¶ä¸­ $A_x$ å³ä¸ºæ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„æœ€å¤§æ¸¸æ³³é€Ÿåº¦ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å®ç°æ–¹æ¡ˆ2">å®ç°æ–¹æ¡ˆ2ï¼š &lt;a href="#%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%882" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ–¹æ¡ˆ2ä¸æ–¹æ¡ˆ1ç±»ä¼¼ï¼Œåªæ˜¯åœ¨æŸ¥æ‰¾å‡¸åŒ…çš„æ—¶å€™ï¼ŒåŠ å…¥ç‚¹ $(0, 0)$ ä¸ç‚¹ $(max(A_i), INF)$ ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŠ å…¥è¿™ä¸¤ä¸ªç‚¹ä¹‹åï¼Œéæœ€ä¼˜è§£çš„ç‚¹éƒ½è¢«åŒ…å«åœ¨äº†å‡¸åŒ…ï¼ˆè“è‰²ï¼‰å†…éƒ¨ã€‚æˆ‘ä»¬åœ¨æ‰¾åˆ°å‡¸åŒ…ä¹‹åï¼Œå°†åŠ å…¥çš„ç‚¹åˆ é™¤ï¼Œå¹¶æŒ‰æ–¹æ¡ˆ1çš„æ–¹æ³•æ’åºã€‚åç»­å†è¿›è¡ŒäºŒåˆ†ï¼Œä»¥åŠæ±‚äº¤ç‚¹ç­‰æ“ä½œã€‚&lt;/li>
&lt;li>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/965294986c47c3153fe9cd4e831748903ba224ef/wizmann-pic/24-06-15/image_1718464319087_0.png" alt="image.png">&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ä»£ç å®ç°">ä»£ç å®ç° &lt;a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://atcoder.jp/contests/abc356/submissions/54463383">æˆ‘å†™çš„&lt;/a> ï¼ˆæŠ„äº†åˆ«äººçš„å‡¸åŒ…ç®—æ³•ï¼‰&lt;/li>
&lt;li>&lt;a href="https://atcoder.jp/contests/abc356/editorial/10145">å®˜æ–¹é¢˜è§£&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="æ„Ÿæ‚Ÿ">æ„Ÿæ‚Ÿ &lt;a href="#%e6%84%9f%e6%82%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>åˆ«è°ƒè®¡ç®—å‡ ä½•ï¼Œä¼šå˜çš„ä¸å¹¸ï¼ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>å®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç»­ä¸å‹˜è¯¯ï¼‰</title><link>https://wizmann.top/posts/implement-non-blocking-queue-2/</link><pubDate>Sun, 14 Apr 2024 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/implement-non-blocking-queue-2/</guid><description>&lt;ul>
&lt;li>æœ¬æ–‡å†…å®¹ä¸»è¦å‚è€ƒè‡ª&lt;a href="https://people.cs.pitt.edu/~jacklange/teaching/cs2510-f17/implementing_lock_free.pdf">Implementing Lock-Free Queue&lt;/a>ä¸€æ–‡ï¼ˆä»¥ä¸‹ç®€ç§°â€œåŸè®ºæ–‡â€ï¼‰&lt;/li>
&lt;li>æ˜¯å¯¹&lt;a href="https://wizmann.top/implement-non-blocking-queue.html">å®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—&lt;/a>ä¸€æ–‡çš„å†…å®¹è¿›è¡Œè¡¥å……&lt;/li>
&lt;li>
&lt;h2 id="tldr">TLï¼›DR &lt;a href="#tldr" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>å°½ç®¡&lt;a href="https://wizmann.top/implement-non-blocking-queue.html">å®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—&lt;/a>ä¸€æ–‡ä¸­çš„å®ç°æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¿½ç•¥äº†â€œéé˜»å¡æ€§â€
&lt;ul>
&lt;li>ä¾‹å¦‚ï¼Œå½“ä»»ä¸€æ’å…¥æ“ä½œè¢«é˜»å¡ï¼Œåˆ™å…¶å®ƒæ’å…¥æ“ä½œå‡ä¼šé™·å…¥å¿™ç­‰å¾…&lt;/li>
&lt;li>æ­¤å®ç°ä¸&lt;a href="https://dl.acm.org/doi/pdf/10.5555/110382.110466">A simple and correct shared-queue algorithm using Compare-and-Swap&lt;/a>çš„å®ç°åŸºæœ¬ä¸€è‡´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¯¹äºä¸€ä¸ªæ”¯æŒå¹¶å‘çš„æ•°æ®ç»“æ„ï¼Œç†åº”åŒæ—¶å…·å¤‡éé˜»å¡æ€§å’Œæ— ç­‰å¾…æ€§
&lt;ul>
&lt;li>éé˜»å¡æ€§ï¼ˆnon-blockingï¼‰ï¼šæ— è®ºæ˜¯ç”±äºCPUè°ƒåº¦æˆ–å…¶ä»–å¤–éƒ¨å› ç´ ï¼Œæ•°æ®ç»“æ„çš„æ“ä½œä¸èƒ½è¢«ä¸­æ–­æˆ–å»¶è¿Ÿ&lt;/li>
&lt;li>æ— ç­‰å¾…æ€§ï¼ˆwait-free)ï¼šä¿è¯æ²¡æœ‰ä»»ä½•çº¿ç¨‹ä¼šé­å—é¥¥é¥¿çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å‰ä¸€ç¯‡åšæ–‡å¯¹å…¶å®ƒå®ç°çš„è´¨ç–‘ï¼Œä¸»è¦åœ¨äºABAé—®é¢˜ï¼Œä½†è¿™ä¸ªé—®é¢˜æ˜¯Compare&amp;amp;Swapæ‰€ç‰¹æœ‰çš„ï¼Œéœ€è¦ç‰¹å®šçš„å®ç°æ¥è§„é¿&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç†è®ºåŸºç¡€">ç†è®ºåŸºç¡€ &lt;a href="#%e7%90%86%e8%ae%ba%e5%9f%ba%e7%a1%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªæ”¯æŒå¹¶å‘enqueue/dequeçš„é˜Ÿåˆ—&lt;/li>
&lt;li>å¯¹äºè¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§
&lt;ul>
&lt;li>éé˜»å¡æ€§ï¼ˆnon-blockingï¼‰
&lt;ul>
&lt;li>å¯¹äºæ¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œå°†ä¼šåœ¨æœ‰é™çš„æ¬¡æ•°å†…å®Œæˆ&lt;/li>
&lt;li>æ— è®ºæœ¬çº¿ç¨‹æˆ–å…¶å®ƒçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å› å…¶å®ƒåŸå› ï¼ˆå¦‚CPUè°ƒåº¦ï¼‰æ‰§è¡Œè¿‡ç¼“ï¼Œæˆ–è€…è¢«ä¸­æ–­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ— ç­‰å¾…æ€§ï¼ˆwait-free)
&lt;ul>
&lt;li>æ²¡æœ‰çº¿ç¨‹ä¼šé¥¥é¥¿&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åŸºäºé”çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆä¸Šè¿°ç‰¹æ€§ï¼Œå› ä¸ºæŒæœ‰é”çš„çº¿ç¨‹å¯èƒ½ä¼šæ— é™æœŸåœ°é˜»å¡æ‰€æœ‰æ“ä½œ&lt;/li>
&lt;li>â€œçº¿æ€§ä¸€è‡´æ€§â€(Linearizability) â€”â€” æ›´å¼ºçš„æ­£ç¡®æ€§
&lt;ul>
&lt;li>éå¹¶å‘æ“ä½œåº”å½“æŒ‰ç…§å®ƒä»¬çš„é€»è¾‘é¡ºåºæ‰§è¡Œï¼Œä»¥ä¿è¯æ“ä½œçš„æ­£ç¡®æ€§ï¼Œè€Œå¹¶å‘æ“ä½œåˆ™å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿›è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&amp;ldquo;Fetch&amp;amp;Add&amp;rdquo; ä¸ &amp;ldquo;Compare&amp;amp;Swap&amp;rdquo;
&lt;ul>
&lt;li>å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œè¿™é‡Œä¸åšèµ˜è¿°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="åŸºäºé“¾è¡¨çš„æ— é”é˜Ÿåˆ—å®ç°">åŸºäºé“¾è¡¨çš„æ— é”é˜Ÿåˆ—å®ç° &lt;a href="#%e5%9f%ba%e4%ba%8e%e9%93%be%e8%a1%a8%e7%9a%84%e6%97%a0%e9%94%81%e9%98%9f%e5%88%97%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ç•¥ï¼Œå‚è€ƒåŸè®ºæ–‡ä¸&lt;a href="https://coolshell.cn/articles/8239.html">æ— é”é˜Ÿåˆ—çš„å®ç°&lt;/a>ä¸€æ–‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="åŸºäºæ•°ç»„çš„æ— é”é˜Ÿåˆ—å®ç°">åŸºäºæ•°ç»„çš„æ— é”é˜Ÿåˆ—å®ç° &lt;a href="#%e5%9f%ba%e4%ba%8e%e6%95%b0%e7%bb%84%e7%9a%84%e6%97%a0%e9%94%81%e9%98%9f%e5%88%97%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ç•¥ï¼Œå‚è€ƒåŸè®ºæ–‡ä¸&lt;a href="https://coolshell.cn/articles/8239.html">æ— é”é˜Ÿåˆ—çš„å®ç°&lt;/a>ä¸€æ–‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="abaé—®é¢˜">ABAé—®é¢˜ &lt;a href="#aba%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>Compare&amp;amp;Swapæ“ä½œç¡®ä¿äº†å€¼ä¿®æ”¹çš„åŸå­æ€§ã€‚æŒ‡é’ˆä½œä¸ºå€¼çš„ä¸€ç§ï¼Œä»£è¡¨ç€æŸä¸ªå†…å­˜åœ°å€ï¼Œä½†Compare&amp;amp;Swapå¯¹æŒ‡é’ˆçš„æ“ä½œæ— æ³•ä¿è¯å…¶æŒ‡å‘çš„å†…å­˜å†…å®¹ä¸è¢«ä¿®æ”¹&lt;/li>
&lt;li>è€ƒè™‘åˆ°å¯èƒ½é‡Šæ”¾æ—§å†…å­˜åå†ç”³è¯·æ–°å†…å­˜ï¼Œè¿™ä¸¤å—å†…å­˜è™½é€»è¾‘ä¸åŒå´å¯èƒ½æ‹¥æœ‰åŒä¸€åœ°å€ï¼Œè¿™å¯¹Compare&amp;amp;Swapæ“ä½œé€ æˆäº†å›°æ‰°&lt;/li>
&lt;li>è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºæŒ‡é’ˆåŠ å…¥å¼•ç”¨è®¡æ•°ï¼ˆref countï¼‰ï¼Œä»¥ç¡®ä¿å†…å­˜åœ¨å¯è®¿é—®æ—¶ä¸ä¼šè¢«é‡Šæ”¾æˆ–é‡ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯” &lt;a href="#%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ä¸Šé¢æˆ‘ä»¬å·²ç»æåˆ°ï¼Œ&lt;a href="https://dl.acm.org/doi/pdf/10.5555/110382.110466">A simple and correct shared-queue algorithm using Compare-and-Swap&lt;/a>ä¸€æ–‡ä¸­çš„æ–¹æ³•ç¼ºå°‘äº†â€œéé˜»å¡æ€§â€ï¼Œï¼Œä½†å…¶æ€§èƒ½ä¸åŸè®ºæ–‡ä¸­çš„å®ç°ååˆ†æ¥è¿‘&lt;/li>
&lt;li>ä½†æ˜¯åœ¨åŸç†ä¸Šï¼Œâ€œéé˜»å¡æ€§â€å®ç°å¯ä»¥é¿å…æ„å¤–çš„çº¿ç¨‹åœæ­¢æˆ–å»¶è¿Ÿ&lt;/li>
&lt;li>ç–‘é—®ï¼šæ˜¯å¦ä¼šåœ¨P99çº§åˆ«çš„Latencyä¸Šæ‰ä¼šä½“ç°å‡ºæ˜æ˜¾çš„å·®å¼‚ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://people.cs.pitt.edu/~jacklange/teaching/cs2510-f17/implementing_lock_free.pdf">Implementing Lock-Free Queue&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dl.acm.org/doi/pdf/10.5555/110382.110466">A simple and correct shared-queue algorithm using Compare-and-Swap&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cs.nyu.edu/~wies/teaching/cso-fa19/class27_concurrency.pdf">Concurrency â€“ Correctness of Concurrent Objects&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="åç»­">åç»­ &lt;a href="#%e5%90%8e%e7%bb%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://www.cs.rochester.edu/~scott/papers/1996_PODC_queues.pdf">Simple, Fast, and Practical Non-Blocking and Blocking Concurrent Queue Algorithms&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/690872647">C++ å•ç”Ÿäº§è€…&amp;amp;å•æ¶ˆè´¹è€… æ— é”é˜Ÿåˆ—&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=K3P_Lmq6pw0&amp;amp;ab_channel=CppCon">Single Producer Single Consumer Lock-free FIFO From the Ground Up - Charles Frasch - CppCon 2023&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>CPUç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜ä¸€è‡´æ€§ï¼ˆç¬¬ä¸€éƒ¨åˆ†-MESIåè®®ï¼‰</title><link>https://wizmann.top/posts/cache-coherence-and-memory-order/</link><pubDate>Mon, 18 Mar 2024 23:21:35 +0000</pubDate><guid>https://wizmann.top/posts/cache-coherence-and-memory-order/</guid><description>&lt;p>åœ¨å¯¹ç§°å¤šå¤„ç†ç³»ç»Ÿï¼ˆSymmetric Multiprocessing, SMPï¼‰ä¸­ï¼Œä¸€ä¸ªå˜é‡ï¼ˆæˆ–å†…å­˜ä½ç½®ï¼‰å¯ä»¥åŒæ—¶å­˜åœ¨äºå¤šä¸ªCPUçš„ç¼“å­˜è¡Œä¸­ã€‚ä¸ºäº†æä¾›å®Œç¾çš„ç”¨æˆ·çº§æŠ½è±¡ï¼Œä»»ä½•å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡çš„ä¿®æ”¹éƒ½åº”è¯¥è¢«å¼ºåˆ¶åŒæ­¥ï¼Œä»¥ç¡®ä¿å…¶å®ƒCPUçš„ç¼“å­˜å¾—åˆ°æ›´æ–°ã€‚
ç„¶è€Œï¼Œåœ¨å®ç°ä¸Šï¼Œç”±äºCPUä¹‹é—´é€šå¸¸é€šè¿‡æ€»çº¿äº’è”ï¼Œå®ƒä»¬ä¸èƒ½åŒæ—¶å¯¹å¤šä¸ªç¼“å­˜è¿›è¡Œå†™æ“ä½œã€‚&lt;/p>
&lt;h3 id="ç¼“å­˜ä¸€è‡´æ€§">ç¼“å­˜ä¸€è‡´æ€§ &lt;a href="#%e7%bc%93%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç¼“å­˜ä¸€è‡´æ€§æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œç¡®ä¿å½“æŸä¸ªå¤„ç†å™¨ä¿®æ”¹äº†å­˜å‚¨åœ¨å…±äº«èµ„æºï¼ˆå¦‚ä¸»å†…å­˜æˆ–ç¼“å­˜ä¸­çš„æ•°æ®ï¼‰æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨èƒ½å¤Ÿè®¿é—®åˆ°æœ€æ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®æ ‡ï¼Œç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶å¿…é¡»å¤„ç†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼šå†™ä¼ æ’­ï¼ˆWrite Propagationï¼‰å’Œäº‹åŠ¡ä¸²è¡ŒåŒ–ï¼ˆTransaction Serializationï¼‰ã€‚&lt;/p>
&lt;p>å†™ä¼ æ’­ç¡®ä¿ä¸€ä¸ªå¤„ç†å™¨æ ¸å¿ƒçš„å†™æ“ä½œèƒ½è¢«ä¼ æ’­å¹¶è¢«å…¶ä»–å¤„ç†å™¨æ ¸å¿ƒæ‰€è§ã€‚è€Œäº‹åŠ¡ä¸²è¡ŒåŒ–åˆ™ç¡®ä¿æ‰€æœ‰å¤„ç†å™¨æ ¸å¿ƒçš„å†™æ“ä½œæŒ‰ç…§ä¸€å®šçš„é¡ºåºæ‰§è¡Œï¼Œå¯¹æ‰€æœ‰å¤„ç†å™¨æ ¸å¿ƒè€Œè¨€è¿™ä¸ªé¡ºåºæ˜¯ä¸€è‡´çš„ã€‚è¿™ä¸¤ä¸ªæœºåˆ¶å…±åŒå·¥ä½œï¼Œç¡®ä¿äº†å³ä½¿å¤šä¸ªCPUå¯èƒ½å¹¶å‘åœ°ä¿®æ”¹åŒä¸€ä»½æ•°æ®ï¼Œå®ƒä»¬ä¹Ÿèƒ½çœ‹åˆ°ä¸€è‡´çš„æ•°æ®è§†å›¾ã€‚&lt;/p>
&lt;h3 id="mesiåè®®">MESIåè®® &lt;a href="#mesi%e5%8d%8f%e8%ae%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸ºäº†å®ç°ç¼“å­˜ä¸€è‡´æ€§ï¼Œå¤šç§åè®®å’Œæœºåˆ¶è¢«è®¾è®¡å‡ºæ¥ï¼Œå…¶ä¸­MESIåè®®æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å®é™…ä¸Šï¼ŒAMDå¤„ç†å™¨ä½¿ç”¨çš„æ˜¯MOESIåè®®ï¼ŒIntelå¤„ç†å™¨ä½¿ç”¨çš„æ˜¯MESIFåè®®ã€‚è¿™ä¸¤ç§åè®®éƒ½æ˜¯MESIåè®®çš„å˜ç§ã€‚è¿™é‡Œä¸å±•å¼€è®¨è®ºã€‚&lt;/p>&lt;/blockquote>
&lt;p>MESI åè®®é€šè¿‡å®šä¹‰ç¼“å­˜è¡Œçš„å››ç§çŠ¶æ€â€”â€”ä¿®æ”¹ï¼ˆModifiedï¼‰ã€ç‹¬å ï¼ˆExclusiveï¼‰ã€å…±äº«ï¼ˆSharedï¼‰å’Œæ— æ•ˆï¼ˆInvalidï¼‰ï¼Œç®¡ç†å¤šä¸ªå¤„ç†å™¨ç¼“å­˜ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å—åˆ°ç¼“å­˜åè®®æ§åˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’ŒåŒæ­¥ã€‚&lt;/p>
&lt;ul>
&lt;li>ç‹¬å ï¼ˆExclusive, Eï¼‰ï¼šç¼“å­˜è¡Œä»…å­˜åœ¨äºå½“å‰ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ˜¯å¹²å‡€çš„ï¼ˆå³ç¼“å­˜æ•°æ®ä¸ä¸»å­˜æ•°æ®ä¸€è‡´ï¼‰ã€‚å½“å…¶ä»–ç¼“å­˜å°è¯•è¯»å–è¯¥æ•°æ®æ—¶ï¼ŒçŠ¶æ€è½¬å˜ä¸ºå…±äº«ï¼›å½“å‰ç¼“å­˜å†™å…¥æ•°æ®æ—¶ï¼Œè½¬å˜ä¸ºå·²ä¿®æ”¹çŠ¶æ€&lt;/li>
&lt;li>å…±äº«ï¼ˆShared, Sï¼‰ï¼šç¼“å­˜è¡ŒåŒæ—¶å­˜åœ¨äºå…¶ä»–ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ˜¯å¹²å‡€çš„ã€‚è¯¥ç¼“å­˜è¡Œå¯ä»¥åœ¨ä»»æ„æ—¶åˆ»è¢«æŠ›å¼ƒ&lt;/li>
&lt;li>å·²ä¿®æ”¹ï¼ˆModified, Mï¼‰ï¼šç¼“å­˜è¡Œçš„æ•°æ®æ˜¯â€œè„â€çš„ï¼ˆå³ä¸ä¸»å­˜çš„å€¼ä¸åŒï¼‰ã€‚å¦‚æœå…¶ä»– CPU æ ¸å¿ƒéœ€è¦è¯»å–è¿™å—æ•°æ®ï¼Œè¯¥ç¼“å­˜è¡Œå¿…é¡»å…ˆå›å†™åˆ°ä¸»å­˜ï¼Œç„¶åçŠ¶æ€è½¬å˜ä¸ºå…±äº«&lt;/li>
&lt;li>æ— æ•ˆï¼ˆInvalid, Iï¼‰ï¼šè¡¨ç¤ºè¯¥ç¼“å­˜è¡Œæ— æ•ˆï¼Œå³ä¸ºç©ºã€‚ä¸Šæ–‡æåˆ°çš„ç¼“å­˜ç­–ç•¥ä¼šä¼˜å…ˆå¡«å……æ— æ•ˆè¡Œ&lt;/li>
&lt;/ul>
&lt;p>ç®€å•æ¥è¯´ï¼ŒMESIçš„è®¾è®¡ç›®æ ‡åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>é˜²æ­¢å¤šä¸ªå¤„ç†å™¨æ ¸å¿ƒåŒæ—¶å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä»»ä½•éœ€è¦ä¿®æ”¹å…±äº«æ•°æ®çš„æ ¸å¿ƒéƒ½ä¼šå…ˆå‘å‡ºRFOï¼ˆRead For Ownershipï¼‰è¯·æ±‚æ¥è·å–è¯¥ç¼“å­˜å—çš„æ‰€æœ‰æƒï¼Œå¹¶ä½¿å…¶ä»–å¤„ç†å™¨æ ¸å¿ƒä¸­çš„ç›¸åº”ç¼“å­˜å—å˜ä¸ºæ— æ•ˆã€‚&lt;/li>
&lt;li>é€šè¿‡æ¨è¿Ÿå†™å›æ“ä½œæ¥å‡å°‘å¯¹å†…å­˜çš„é¢‘ç¹ä¿®æ”¹ï¼Œç¡®ä¿åªæœ‰åœ¨å¿…è¦æ—¶æ‰å°†ç¼“å­˜ä¸­çš„æ›´æ”¹å†™å›å†…å­˜ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="mesi-çš„çŠ¶æ€è½¬ç§»">MESI çš„çŠ¶æ€è½¬ç§» &lt;a href="#mesi-%e7%9a%84%e7%8a%b6%e6%80%81%e8%bd%ac%e7%a7%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>MESI åè®®çš„çŠ¶æ€è½¬ç§»å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/24-03-31/1711876193915_Diagrama_MESI.gif" alt="">&lt;/p>
&lt;ul>
&lt;li>ä»æ— æ•ˆï¼ˆIï¼‰åˆ°ç‹¬å ï¼ˆEï¼‰ï¼šå½“ CPU éœ€è¦å†™å…¥ä¸€ä¸ªç¼“å­˜è¡Œè€Œè¯¥è¡Œå½“å‰çŠ¶æ€ä¸ºæ— æ•ˆæ—¶ï¼Œå¦‚æœå…¶ä»– CPU ç¼“å­˜ä¸­æ²¡æœ‰è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œè¯¥è¡ŒçŠ¶æ€å˜ä¸ºç‹¬å ã€‚è¿™è¡¨æ˜å½“å‰ CPU ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œä¸”æ²¡æœ‰å…¶ä»–å‰¯æœ¬å­˜åœ¨&lt;/li>
&lt;li>ä»æ— æ•ˆï¼ˆIï¼‰åˆ°å…±äº«ï¼ˆSï¼‰ï¼šå½“ CPU éœ€è¦è¯»å–ä¸€ä¸ªç¼“å­˜è¡Œè€Œè¯¥è¡Œå½“å‰çŠ¶æ€ä¸ºæ— æ•ˆæ—¶ï¼Œå¦‚æœå…¶ä»– CPU ç¼“å­˜ä¸­å­˜åœ¨è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œåˆ™è¯¥è¡ŒçŠ¶æ€å˜ä¸ºå…±äº«&lt;/li>
&lt;li>ä»å…±äº«ï¼ˆSï¼‰åˆ°ç‹¬å ï¼ˆEï¼‰ï¼šå½“ä¸€ä¸ª CPU æƒ³è¦å†™å…¥ä¸€ä¸ªå¤„äºå…±äº«çŠ¶æ€çš„ç¼“å­˜è¡Œæ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å–å…¶ä»–æ‰€æœ‰ CPU ä¸Šè¯¥ç¼“å­˜è¡Œçš„ç‹¬å è®¿é—®æƒï¼Œå¦‚æœæˆåŠŸï¼Œè¯¥ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºç‹¬å &lt;/li>
&lt;li>ä»ç‹¬å ï¼ˆEï¼‰åˆ°ä¿®æ”¹ï¼ˆMï¼‰ï¼šå½“ CPU å¯¹å¤„äºç‹¬å çŠ¶æ€çš„ç¼“å­˜è¡Œè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œè¯¥ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºä¿®æ”¹ã€‚è¿™è¡¨ç¤ºæ•°æ®å·²è¢«å½“å‰ CPU ä¿®æ”¹ï¼Œä¸”ä¸ä¸»å­˜ä¸åŒæ­¥&lt;/li>
&lt;li>ä»ä¿®æ”¹ï¼ˆMï¼‰åˆ°å…±äº«ï¼ˆSï¼‰ï¼šå½“å…¶ä»– CPU è¯·æ±‚è¯»å–å¤„äºä¿®æ”¹çŠ¶æ€çš„ç¼“å­˜è¡Œæ—¶ï¼Œå½“å‰ CPU å¿…é¡»å°†è¯¥ç¼“å­˜è¡Œçš„æ•°æ®å†™å›ä¸»å­˜ï¼Œå¹¶å°†ç¼“å­˜è¡ŒçŠ¶æ€æ”¹ä¸ºå…±äº«ï¼Œä»¥ä¾¿å…¶ä»– CPU å¯ä»¥è¯»å–æœ€æ–°æ•°ã€‚&lt;/li>
&lt;li>ä»ä»»ä½•çŠ¶æ€åˆ°æ— æ•ˆï¼ˆIï¼‰ï¼šå½“ CPU æ¥æ”¶åˆ°å…¶ä»– CPU å‘å‡ºçš„æ— æ•ˆåŒ–è¯·æ±‚æ—¶ï¼Œå¦‚æœå½“å‰ CPU ç¼“å­˜ä¸­æœ‰è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ï¼Œä¸è®ºå®ƒå¤„äºä½•ç§çŠ¶æ€ï¼Œéƒ½å¿…é¡»å°†å…¶æ ‡è®°ä¸ºæ— æ•ˆã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å…¶ä»– CPU æƒ³è¦å†™å…¥åŒä¸€ç¼“å­˜è¡Œçš„æƒ…å†µä¸‹&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å¯ä»¥ä½¿ç”¨è¿™ä¸ª&lt;a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESI.htm">ç®€å•çš„æ¨¡æ‹Ÿå™¨&lt;/a>æ¥æ¨¡æ‹ŸMESIåè®®çš„å·¥ä½œçŠ¶æ€&lt;/p>&lt;/blockquote>
&lt;h3 id="mesiçš„ä¼˜åŒ–">MESIçš„ä¼˜åŒ– &lt;a href="#mesi%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>éšç€å¤šæ ¸å¤„ç†å™¨çš„æ™®åŠå’Œç³»ç»Ÿå¤æ‚åº¦çš„å¢åŠ ï¼ŒMESIåè®®é¢ä¸´ç€æ€§èƒ½ç“¶é¢ˆå’Œæ•ˆç‡é—®é¢˜ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿæ€§èƒ½å’Œç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯¹MESIåè®®çš„ä¼˜åŒ–å˜å¾—éå¸¸å¿…è¦ã€‚&lt;/p>
&lt;h4 id="å†™ç¼“å†²åŒºstore-bufferæœºåˆ¶">å†™ç¼“å†²åŒºï¼ˆStore Bufferï¼‰æœºåˆ¶ &lt;a href="#%e5%86%99%e7%bc%93%e5%86%b2%e5%8c%bastore-buffer%e6%9c%ba%e5%88%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œä¸€ä¸ªCPUæ ¸å¿ƒï¼ˆä¾‹å¦‚æ ¸å¿ƒ1ï¼‰é¦–å…ˆéœ€è¦å¹¿æ’­ä¸€ä¸ªè¯»å–ä¸ºäº†å†™å…¥ï¼ˆRead For Ownershipï¼ŒRFOï¼‰è¯·æ±‚ï¼Œä»¥è·å¾—å¯¹åº”æ•°æ®çš„ç‹¬å è®¿é—®æƒã€‚åœ¨ç­‰å¾…å…¶ä»–æ ¸å¿ƒå“åº”æ­¤è¯·æ±‚å¹¶å‘é€å›ç¡®è®¤ä¿¡å·ï¼ˆACKï¼‰æœŸé—´ï¼Œæ ¸å¿ƒ1åŸæœ¬éœ€è¦ç©ºé—²ç­‰å¾…ï¼Œè¿™æ— ç–‘æ˜¯å¯¹CPUèµ„æºçš„ä¸€ç§æµªè´¹ã€‚&lt;/p>
&lt;p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç°ä»£CPUè®¾è®¡äº†â€œå†™ç¼“å†²åŒºâ€æœºåˆ¶ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå½“æ ¸å¿ƒ1å‘å‡ºRFOè¯·æ±‚å¹¶å°†å†™å…¥æ“ä½œæ”¾å…¥å†™ç¼“å†²åŒºåï¼Œå®ƒå¯ä»¥ç«‹å³ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦ç­‰å¾…ACKçš„åˆ°æ¥ã€‚ä¸€æ—¦æ”¶åˆ°ACKï¼ŒCPUå†ä»å†™ç¼“å†²åŒºä¸­å–å‡ºå†™å…¥æ“ä½œï¼Œå®é™…å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚è¿™æ ·ä¸ä»…ä¼˜åŒ–äº†CPUçš„å·¥ä½œæµç¨‹ï¼Œè¿˜æå‡äº†å¤„ç†å™¨çš„æ•´ä½“æ•ˆèƒ½ã€‚&lt;/p>
&lt;h4 id="å¤±æ•ˆé˜Ÿåˆ—invalidation-queue">å¤±æ•ˆé˜Ÿåˆ—ï¼ˆInvalidation Queueï¼‰ &lt;a href="#%e5%a4%b1%e6%95%88%e9%98%9f%e5%88%97invalidation-queue" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸ºäº†è§£å†³æ ¸å¿ƒåœ¨å¿™ç¢Œæ—¶æ— æ³•åŠæ—¶å“åº”RFOè¯·æ±‚çš„é—®é¢˜ï¼Œç°ä»£CPUå¼•å…¥äº†â€œå¤±æ•ˆé˜Ÿåˆ—â€æœºåˆ¶ã€‚æ”¶åˆ°çš„RFOè¯·æ±‚è¢«æ”¾å…¥å¤±æ•ˆé˜Ÿåˆ—ï¼Œå¹¶ç«‹å³å‘é€å›ACKï¼Œå¾…æ ¸å¿ƒå®Œæˆæ‰‹å¤´ä¸Šçš„ä»»åŠ¡åï¼Œå†å¤„ç†å¤±æ•ˆé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ã€‚è¿™ç§è®¾è®¡æœ‰æ•ˆåœ°ç¼©çŸ­äº†ç­‰å¾…æ—¶é—´ï¼ŒåŠ é€Ÿäº†æ•°æ®åŒæ­¥è¿‡ç¨‹ã€‚&lt;/p>
&lt;h3 id="mesiçš„æ½œåœ¨é—®é¢˜">MESIçš„æ½œåœ¨é—®é¢˜ &lt;a href="#mesi%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="false-sharing">False Sharing &lt;a href="#false-sharing" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç”±äºCPUä»¥64Bçš„Cache Lineä¸ºæœ€å°å•ä½ä»å†…å­˜ä¸­åŠ è½½æ•°æ®ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼š&lt;/p>
&lt;p>å‡è®¾å˜é‡aå’Œbä½äºåŒä¸€ä¸ªCache Lineä¸­ï¼Œå½“å‰CPU0å’ŒCPU1éƒ½å°†è¿™ä¸ªCache LineåŠ è½½åˆ°Cacheï¼ŒCPU0åªä¿®æ”¹å˜é‡aï¼ŒCPU1åªè¯»å–å˜é‡bã€‚å½“CPU0ä¿®æ”¹aæ—¶ï¼ŒCPU1çš„Cache Lineä¼šå˜ä¸ºInvalidçŠ¶æ€ï¼Œå³ä½¿CPU1å¹¶æ²¡æœ‰ä¿®æ”¹bï¼Œè¿™ä¼šå¯¼è‡´CPU1ä»å†…å­˜æˆ–å…¶å®ƒæ ¸å¿ƒé‡æ–°åŠ è½½Cache Lineä¸­çš„æ‰€æœ‰å˜é‡ï¼Œå½±å“æ€§èƒ½ã€‚è¿™å°±æ˜¯False Sharingã€‚&lt;/p>
&lt;p>è§£å†³False Sharingçš„å¸¸ç”¨æ–¹æ³•æ˜¯è¿›è¡Œå­—èŠ‚å¡«å……ï¼Œåœ¨aå’Œbä¹‹é—´å¡«å……æ— æ„ä¹‰çš„å˜é‡ï¼Œä½¿ä¸€ä¸ªå˜é‡å•ç‹¬å ç”¨ä¸€ä¸ªCache Lineã€‚&lt;/p>
&lt;h4 id="rmwæ“ä½œ">RMWæ“ä½œ &lt;a href="#rmw%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œè¯»-æ”¹-å†™ï¼ˆRMWï¼‰æ“ä½œï¼Œå¦‚æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCASï¼‰å’ŒåŸå­åŠ ï¼ˆADDï¼‰ï¼Œéœ€ä½œä¸ºå•ä¸€çš„åŸå­æ“ä½œæ‰§è¡Œä»¥é¿å…æ•°æ®ç«äº‰ã€‚&lt;/p>
&lt;p>å°½ç®¡MESIç¼“å­˜ä¸€è‡´æ€§åè®®ç¡®ä¿äº†å¤„ç†å™¨æ ¸å¿ƒé—´ç¼“å­˜è¡ŒçŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œå®ƒå¹¶ä¸è§£å†³æ“ä½œçš„åŸå­æ€§é—®é¢˜ã€‚åœ¨RMWæ“ä½œä¸­ï¼Œç”±äºä»è¯»å–åˆ°å†™å›çš„æ—¶é—´çª—å£å†…å¯èƒ½å‘ç”Ÿå…¶ä»–å¤„ç†å™¨çš„å¹²é¢„ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰å’ŒçŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>åœ¨ä¸ºæ­¤ï¼Œ&lt;code>LOCK&lt;/code>æŒ‡ä»¤è¢«ç”¨æ¥ç¡®ä¿RMWæ“ä½œçš„åŸå­æ€§ï¼Œé€šè¿‡é”å®šæ“ä½œæ¶‰åŠçš„ç¼“å­˜è¡Œï¼Œé˜²æ­¢åœ¨æ“ä½œå®Œæˆå‰è¢«å…¶ä»–å¤„ç†å™¨è®¿é—®ï¼Œä»è€Œæœ‰æ•ˆåœ°è§£å†³äº†æ•°æ®ç«äº‰é—®é¢˜ï¼Œä¿éšœäº†æ“ä½œçš„å®‰å…¨æ€§å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h4 id="å†™ç¼“å†²åŒºstore-bufferä¼˜åŒ–å¸¦æ¥çš„æ½œåœ¨é—®é¢˜">å†™ç¼“å†²åŒºï¼ˆStore Bufferï¼‰ä¼˜åŒ–å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ &lt;a href="#%e5%86%99%e7%bc%93%e5%86%b2%e5%8c%bastore-buffer%e4%bc%98%e5%8c%96%e5%b8%a6%e6%9d%a5%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å†™ç¼“å†²åŒºå¸¦æ¥çš„æœ€ä¸»è¦çš„é—®é¢˜æ˜¯ä¸å…¶ä»–æ ¸å¿ƒçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå†™æ“ä½œè¢«å»¶è¿Ÿæ‰§è¡Œï¼Œå…¶ä»–æ ¸å¿ƒå¯èƒ½åœ¨è¿™æ®µæ—¶é—´å†…è¯»å–åˆ°äº†æ—§çš„æ•°æ®å€¼ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œå†™ç¼“å†²åŒºå¯èƒ½å¯¼è‡´å†…å­˜é¡ºåºçš„é—®é¢˜ï¼Œå³ç¼–å†™çš„ç¨‹åºé€»è¾‘ä¸å®é™…æ‰§è¡Œé€»è¾‘ä¸ç¬¦ã€‚&lt;/p>
&lt;h4 id="å¤±æ•ˆé˜Ÿåˆ—invalidation-queueå¸¦æ¥çš„æ½œåœ¨é—®é¢˜">å¤±æ•ˆé˜Ÿåˆ—ï¼ˆInvalidation Queueï¼‰å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ &lt;a href="#%e5%a4%b1%e6%95%88%e9%98%9f%e5%88%97invalidation-queue%e5%b8%a6%e6%9d%a5%e7%9a%84%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¤±æ•ˆé˜Ÿåˆ—æé«˜äº†å“åº”é€Ÿåº¦ï¼Œä½†å®ƒä¹Ÿå¯èƒ½å¼•å…¥æ–°çš„é—®é¢˜ã€‚å¤±æ•ˆé˜Ÿåˆ—å…è®¸CPUæ ¸å¿ƒåœ¨ç¡®è®¤æ¥æ”¶åˆ°å¤±æ•ˆè¯·æ±‚åï¼Œå»¶è¿Ÿå¤„ç†è¿™äº›è¯·æ±‚ã€‚è¿™ç§å»¶è¿Ÿå¯èƒ½å¯¼è‡´æ•°æ®åœ¨ä¸åŒæ ¸å¿ƒé—´çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä¸€ä¸ªæ ¸å¿ƒå¯èƒ½ä¼šåœ¨çŸ­æ—¶é—´å†…ç»§ç»­ä½¿ç”¨å·²ç»å¤±æ•ˆçš„æ•°æ®ï¼Œè€Œè¿™æ®µæ—¶é—´å†…å…¶ä»–æ ¸å¿ƒå·²ç»ä¿®æ”¹äº†è¿™éƒ¨åˆ†æ•°æ®ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://zh.wikipedia.org/wiki/MESI%E5%8D%8F%E8%AE%AE">MESIåè®®&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/LeoYang90/Golang-Internal-Notes/blob/master/Go%20%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B.md#go-%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B">Go å†…å­˜ä¸€è‡´æ€§æ¨¡å‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://juejin.cn/post/7158395475362578462">12 å¼ å›¾çœ‹æ‡‚ CPU ç¼“å­˜ä¸€è‡´æ€§ä¸ MESI åè®®ï¼ŒçœŸçš„ä¸€è‡´å—ï¼Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wudaijun.com/2019/04/cache-coherence-and-memory-consistency/">Cacheä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.chongsheng.art/post/golang/cpu-cache-memory-barrier/">CPUç¼“å­˜æ¶æ„åˆ°å†…å­˜å±éšœ&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>[tl;dr] è®ºæ–‡é˜…è¯»ï¼šBorg - Large-scale cluster management at Google</title><link>https://wizmann.top/posts/tl-dr-borg/</link><pubDate>Wed, 27 Dec 2023 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/tl-dr-borg/</guid><description>&lt;ul>
&lt;li>
&lt;h2 id="ç³»ç»Ÿæ¦‚è§ˆ">ç³»ç»Ÿæ¦‚è§ˆ &lt;a href="#%e7%b3%bb%e7%bb%9f%e6%a6%82%e8%a7%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>Borgæ˜¯è°·æ­Œå¼€å‘çš„ä¸€ç§é«˜æ•ˆçš„é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œæ—¨åœ¨ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡å’Œæé«˜ç³»ç»Ÿçš„å¯é æ€§åŠå¯ç”¨æ€§
&lt;ul>
&lt;li>éšè—èµ„æºç®¡ç†ç»†èŠ‚ä¸æ•…éšœå¤„ç†ï¼Œå…è®¸ç”¨æˆ·ä¸“æ³¨äºåº”ç”¨ç¨‹åºçš„å¼€å‘&lt;/li>
&lt;li>ä¿è¯éå¸¸é«˜çš„å¯é æ€§å’Œå¯ç”¨æ€§ï¼Œä»¥æ”¯æŒç”¨æˆ·åº”ç”¨ç¨‹åºçš„é«˜å¯é æ€§å’Œé«˜å¯ç”¨æ€§&lt;/li>
&lt;li>æ”¯æŒè¿è¡Œæ¥è‡ªä¼—å¤šåº”ç”¨çš„æ•°åä¸‡ä¸ªä½œä¸šï¼Œå¹¶é«˜æ•ˆè¿è¡Œäºæ•°ä»¥ä¸‡è®¡çš„æœºå™¨ä¸Š&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç”¨æˆ·è§†è§’">ç”¨æˆ·è§†è§’ &lt;a href="#%e7%94%a8%e6%88%b7%e8%a7%86%e8%a7%92" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ç”¨æˆ·é€šè¿‡å®šä¹‰&lt;em>job&lt;/em>å’Œ&lt;em>task&lt;/em>ä¸Borgè¿›è¡Œäº¤äº’
&lt;ul>
&lt;li>ä¸€ä¸ª&lt;em>job&lt;/em>ç”±è¿è¡Œç›¸åŒç¨‹åºçš„ä¸€ä¸ªæˆ–å¤šä¸ª&lt;em>task&lt;/em>ç»„æˆ&lt;/li>
&lt;li>æ¯ä¸€ä¸ª&lt;em>job&lt;/em>è¿è¡Œäºä¸€ä¸ª&lt;em>Borg cell&lt;/em>ï¼ˆå•å…ƒï¼‰ä¹‹ä¸­ï¼Œ&lt;em>cell&lt;/em>æ˜¯ä¸€ç»„æœºå™¨çš„é›†åˆï¼Œæ˜¯Borgç®¡ç†çš„åŸºæœ¬å•å…ƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Borgçš„å·¥ä½œè´Ÿè½½
&lt;ul>
&lt;li>é•¿æœŸè¿è¡Œçš„æ—¶å»¶æ•æ„Ÿå‹æœåŠ¡&lt;/li>
&lt;li>æ‰¹å¤„ç†ä½œä¸š&lt;/li>
&lt;li>è¿è¡Œåœ¨å®ä½“æœºä¸Šï¼Œé¿å…VMçš„è™šæ‹ŸåŒ–å¼€é”€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;em>Allocs&lt;/em>
&lt;ul>
&lt;li>é¢„ç•™ç»™ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡çš„ä¸€ç»„èµ„æº&lt;/li>
&lt;li>&lt;em>Alloc&lt;/em>å¯ä»¥å°†ä¸åŒ &lt;em>jobs&lt;/em> çš„ &lt;em>tasks&lt;/em> èšé›†åˆ°åŒä¸€å°æœºå™¨ä¸Š&lt;/li>
&lt;li>å¦‚æœä¸€ä¸ª &lt;em>alloc&lt;/em> å¿…é¡»é‡æ–°åˆ†é…åˆ°å¦å¤–ä¸€å°ä¸»æœºï¼Œå±äºå®ƒçš„ &lt;em>task(s)&lt;/em> ä¹Ÿä¼šåŒå®ƒä¸€èµ·é‡æ–°è¢«è°ƒåº¦&lt;/li>
&lt;li>ä¸€æ—¦åˆ›å»ºä¸€ä¸ª &lt;em>alloc&lt;/em> é›†åˆï¼Œå°±å¯ä»¥æäº¤ä¸€ä¸ªæˆ–å¤šä¸ª jobs è¿è¡Œå…¶ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å‘½åæœåŠ¡å’Œç›‘æ§
&lt;ul>
&lt;li>BorgåŒ…å«ä¸€ä¸ªç¨³å®šçš„ &lt;em>Borgå‘½åæœåŠ¡&lt;/em> (BNS)ï¼ŒåŒ…æ‹¬ cell åï¼Œjob åå’Œ task id&lt;/li>
&lt;li>Borgå°† &lt;em>task&lt;/em> çš„ä¸»æœºåå’Œç«¯å£å†™å…¥ Chubbyï¼Œç”¨äº RPC ç³»ç»ŸæŸ¥æ‰¾ task endpoint&lt;/li>
&lt;li>Borgè¿˜ä¼šå°† &lt;em>job&lt;/em> sizeä¸å…¶è¿è¡ŒçŠ¶æ€å†™å…¥Chubbyï¼Œä¾¿äºload balancerå¹³è¡¡æµé‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="borgçš„æ¶æ„">Borgçš„æ¶æ„ &lt;a href="#borg%e7%9a%84%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;em>Borgmaster&lt;/em>
&lt;ul>
&lt;li>ä¸»ç®¡ç†è¿›ç¨‹
&lt;ul>
&lt;li>é€»è¾‘ä¸Šçš„â€œå•ç‚¹â€ï¼Œæœ‰5ä¸ªåœ¨çº¿å¤‡ä»½ï¼Œä½¿ç”¨Paxosé€‰ä¸¾master&lt;/li>
&lt;li>çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”å¤‡ä»½åœ¨é«˜å¯é æ€§çš„Paxoså­˜å‚¨ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è°ƒåº¦è¿›ç¨‹
&lt;ul>
&lt;li>å¯è¡Œæ€§æ£€æŸ¥
&lt;ul>
&lt;li>ç”¨äºæ‰¾åˆ°æ»¡è¶³ä»»åŠ¡çº¦æŸã€å…·å¤‡è¶³å¤Ÿå¯ç”¨èµ„æºçš„ä¸€ç»„æœºå™¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ‰“åˆ†ï¼ˆscoringï¼‰
&lt;ul>
&lt;li>åœ¨â€œå¯è¡Œæœºå™¨â€ä¸­æ ¹æ®ç”¨æˆ·åå¥½ï¼Œä¸ºæœºå™¨æ‰“åˆ†&lt;/li>
&lt;li>æ‰“åˆ†ç­–ç•¥
&lt;ul>
&lt;li>worst fitï¼ˆE-PVNçš„å˜ç§ï¼‰ä¼šå°†ä»»åŠ¡åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨ä¸Š
&lt;ul>
&lt;li>æœ‰ä½™é‡åº”å¯¹æµé‡çš„å°–å³°&lt;/li>
&lt;li>ä¼šå¯¼è‡´èµ„æºçš„ç¢ç‰‡åŒ–ï¼Œé˜»ç¢å¤§å‹&lt;em>task&lt;/em>çš„éƒ¨ç½²&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>best fitï¼Œä¼šå°½é‡â€œç´§å‡‘â€çš„ä½¿ç”¨æœºå™¨ï¼Œä»¥å‡å°‘èµ„æºç¢ç‰‡
&lt;ul>
&lt;li>ä¾¿äºå¤§å‹&lt;em>task&lt;/em>çš„éƒ¨ç½²&lt;/li>
&lt;li>é”™è¯¯çš„èµ„æºä¼°è®¡ä¼šè¢«â€œæƒ©ç½šâ€ï¼Œå°¤å…¶å½±å“çªå‘çš„è´Ÿè½½&lt;/li>
&lt;li>å½±å“åˆ©äºå¯Œè£•è®¡ç®—èµ„æºçš„batch jobs&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ··åˆæ¨¡å‹ï¼Œå°½é‡å‡å°‘â€œå—å›°èµ„æºâ€ï¼Œå³å› ä¸ºå…¶å®ƒèµ„æºè¢«å®Œå…¨å ç”¨è€Œæ— æ³•åˆ†é…å‡ºå»çš„èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¼˜åŒ–
&lt;ul>
&lt;li>å¯åŠ¨æ—¶é—´ä¼˜åŒ–
&lt;ul>
&lt;li>ä¸­ä½æ•°å¯åŠ¨æ—¶é—´ä¸º25sï¼Œ80%ç”¨äºå®‰è£…ç›¸å…³ä¾èµ–&lt;/li>
&lt;li>å°†ç›¸å…³&lt;em>task&lt;/em>ä¼˜å…ˆåˆ†é…åˆ°æ‹¥æœ‰ç›¸å…³ä¾èµ–çš„æœºå™¨ä¸Š&lt;/li>
&lt;li>ä½¿ç”¨ &lt;em>tree-like&lt;/em> æˆ– &lt;em>torrent-like&lt;/em> æœºåˆ¶ï¼Œå¹¶å‘çš„åˆ†å‘ç›¸å…³ä¾èµ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è®¡ç®—å¼€é”€ä¼˜åŒ–
&lt;ul>
&lt;li>ä½¿å¾—Borgèƒ½ç®¡ç†æ›´å¤šçš„æœºå™¨&lt;/li>
&lt;li>æ‰“åˆ†ç¼“å­˜ï¼šå°†å¯è¡Œæ€§æ£€æŸ¥å’Œæ‰“åˆ†ç»“æœç¼“å­˜&lt;/li>
&lt;li>ç­‰ä»·ç±»ï¼šåŒä¸€ &lt;em>job&lt;/em> ä¸­çš„ &lt;em>task&lt;/em> é€šå¸¸å…·æœ‰ç±»ä¼¼çš„çº¦æŸï¼Œå› æ­¤å¯ä»¥å°†å¤šä¸ªä»»åŠ¡è§†ä¸ºä¸€ä¸ªç­‰ä»·ç±»&lt;/li>
&lt;li>æ¾å¼›éšæœºåŒ–ï¼šè®¡ç®—æ‰€æœ‰æœºå™¨çš„å¯è¡Œæ€§å’Œå¾—åˆ†ä»£ä»·å¤ªé«˜ï¼Œå¯ä»¥éšæœºå–æ ·ä¸€æ‰¹æœºå™¨ï¼Œç„¶åé€‰æ‹©å…¶ä¸­ä¸€ä¸ªâ€œè¶³å¤Ÿå¥½â€çš„æœºå™¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;em>Borglet&lt;/em>
&lt;ul>
&lt;li>&lt;em>Borglet&lt;/em> æ˜¯è¿è¡Œåœ¨æ¯å°æœºå™¨ä¸Šçš„æœ¬åœ°ä»£ç†ï¼Œç®¡ç†æœ¬åœ°çš„ä»»åŠ¡å’Œèµ„æº&lt;/li>
&lt;li>&lt;em>Borgmaster&lt;/em> ä¼šå‘¨æœŸæ€§åœ°å‘æ¯ä¸€ä¸ªBorgletæ‹‰å–å½“å‰çŠ¶æ€ï¼Œæ˜“äºæ§åˆ¶é€šä¿¡é€Ÿåº¦ï¼Œé¿å…â€œæ¢å¤é£æš´â€&lt;/li>
&lt;li>ä¸ºäº†æ€§èƒ½å¯æ‰©å±•æ€§ï¼Œæ¯ä¸ªBorgmasterå‰¯æœ¬ä¼šè¿è¡Œæ— çŠ¶æ€çš„ &lt;em>link shard&lt;/em> å»å¤„ç†ä¸éƒ¨åˆ†Borgleté€šä¿¡
&lt;ul>
&lt;li>å½“ &lt;em>Borgmaster&lt;/em> é‡æ–°é€‰ä¸¾æ—¶ï¼Œ&lt;em>link shard&lt;/em> ä¼šé‡æ–°åˆ’åˆ†åˆ†åŒº&lt;/li>
&lt;li>&lt;em>link shard&lt;/em> ä¼šèšåˆå’Œå‹ç¼©ä¿¡æ¯ï¼Œä»…ä»…å‘è¢«BorgmasteræŠ¥å‘ŠçŠ¶æ€çš„æ›´æ–°ï¼Œä»¥æ­¤å‡å°‘æ›´æ–°è´Ÿè½½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¦‚æœ &lt;em>Borglet&lt;/em> å¤šè½®æ²¡æœ‰å“åº”èµ„æºæŸ¥è¯¢ï¼Œåˆ™ä¼šè¢«æ ‡è®°ä¸ºdownã€‚è¿è¡Œå…¶ä¸Šçš„ä»»åŠ¡ä¼šè¢«é‡æ–°è°ƒåº¦åˆ°å…¶ä»–æœºå™¨ã€‚å¦‚æœæ¢å¤é€šä¿¡ï¼Œåˆ™ &lt;em>Borgmaster&lt;/em> ä¼šé€šçŸ¥ &lt;em>Borglet&lt;/em> æ€æ­»å·²ç»é‡æ–°è°ƒåº¦çš„ä»»åŠ¡ï¼Œä»¥æ­¤ä¿è¯ä»»åŠ¡çš„å”¯ä¸€æ€§&lt;/li>
&lt;li>Borgletä¸Borgmasterå¤±å»è”ç³»æ—¶ï¼Œä»ä¼šç»§ç»­å¤„ç†ç›¸å…³ä»»åŠ¡ã€‚ä»¥åº”å¯¹ &lt;em>Borgmaster&lt;/em> çš„æš‚æ—¶å¤±æ•ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="å¯é æ€§">å¯é æ€§ &lt;a href="#%e5%8f%af%e9%9d%a0%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>è‡ªåŠ¨é‡æ–°è°ƒåº¦å™¨è¢«é©±é€çš„ä»»åŠ¡&lt;/li>
&lt;li>å°†ä»»åŠ¡åˆ†æ•£åˆ°ä¸åŒçš„å¤±è´¥åŸŸä¸­&lt;/li>
&lt;li>é™åˆ¶ä¸€ä¸ªä½œä¸šä¸­åŒæ—¶å¤±è´¥ä»»åŠ¡çš„ä¸ªæ•°å’Œä¸­æ–­ç‡&lt;/li>
&lt;li>ä½¿ç”¨å£°æ˜å¼çš„æœŸæœ›çŠ¶æ€è¡¨ç¤ºå’Œå¹‚ç­‰çš„å˜æ›´æ“ä½œï¼Œä»¥ä¾¿æ— å®³åœ°é‡æ–°æäº¤è¯·æ±‚&lt;/li>
&lt;li>å¯¹äºæœºå™¨çº§åˆ«çš„å¤±æ•ˆï¼Œé™åˆ¶å…¶é‡æ–°è°ƒåº¦çš„é€Ÿç‡ï¼Œå› ä¸ºéš¾ä»¥åŒºåˆ†å¤§è§„æ¨¡æœºå™¨æ•…éšœå’Œç½‘ç»œåˆ†åŒº&lt;/li>
&lt;li>é¿å…é‡è¯•å¼•å‘é”™è¯¯çš„&amp;lt;ä»»åŠ¡-æœºå™¨&amp;gt;åŒ¹é…å¯¹&lt;/li>
&lt;li>å…³é”®æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥ç£ç›˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="èµ„æºåˆ©ç”¨å’Œæ•ˆç‡">èµ„æºåˆ©ç”¨å’Œæ•ˆç‡ &lt;a href="#%e8%b5%84%e6%ba%90%e5%88%a9%e7%94%a8%e5%92%8c%e6%95%88%e7%8e%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>è¯„ä¼°æ–¹æ³•
&lt;ul>
&lt;li>&lt;em>cell compaction&lt;/em>ï¼šé€šè¿‡ç§»é™¤æœºå™¨æ¥æ‰¾å‡ºç»™å®šå·¥ä½œè´Ÿè½½èƒ½é€‚åº”çš„æœ€å°çš„å•å…ƒå¤§å°ï¼Œç„¶ååå¤ä»å¤´å¼€å§‹é‡æ–°æ‰“åŒ…å·¥ä½œè´Ÿè½½ï¼Œä»¥ç¡®ä¿ä¸ä¼šå› é”™è¯¯çš„é…ç½®è€Œé™·å…¥å›°å¢ƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>â€œå•å…ƒå…±äº«â€ï¼šåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œç”Ÿäº§ä»»åŠ¡å’Œéç”Ÿäº§ä»»åŠ¡ï¼Œä»¥ä¼˜åŒ–èµ„æºä½¿ç”¨
&lt;ul>
&lt;li>å®éªŒè¡¨æ˜ï¼Œå…±äº«èµ„æºä¼šå½±å“å®é™…çš„CPUè®¡ç®—æ€§èƒ½&lt;/li>
&lt;li>ä½†æ˜¯åœ¨èŠ‚çº¦æˆæœ¬çš„å·¨å¤§ä¼˜åŠ¿ä¸Šé¢ï¼ŒCPUæ€§èƒ½çš„é€€åŒ–æ˜¯å¯ä»¥å®¹å¿çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>â€œå¤§å‹å•å…ƒâ€ï¼šå…è®¸è¶…å¤§å‹è®¡ç®—ä»»åŠ¡ï¼Œå‡å°‘ä»»åŠ¡çš„ç¢ç‰‡åŒ–&lt;/li>
&lt;li>ç»†ç²’åº¦èµ„æºè¯·æ±‚
&lt;ul>
&lt;li>ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUæ ¸ï¼Œå’Œå†…å­˜ã€ç£ç›˜çš„å­—èŠ‚æ•°ä¸ºèµ„æºè¯·æ±‚çš„æœ€å°å•å…ƒ&lt;/li>
&lt;li>ç›¸æ¯”é¢„è®¾èµ„æºåˆ†é…ï¼ˆå¥—é¤ï¼‰ï¼Œå¯ä»¥é¿å…é¢å¤–çš„èµ„æºå¼€é”€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>èµ„æºå›æ”¶
&lt;ul>
&lt;li>å¯¹äºå¯ä»¥å®¹å¿ä½è´¨é‡èµ„æºçš„å·¥ä½œï¼ˆä¾‹å¦‚æ‰¹å¤„ç†ä½œä¸šï¼‰ï¼ŒBorgä¼šè¯„ä¼°ä»»åŠ¡å°†ä½¿ç”¨çš„èµ„æºï¼Œå¹¶å›æ”¶ç©ºé—²èµ„æº&lt;/li>
&lt;li>æœ€åˆçš„é¢„ç•™å€¼ä¸å…¶èµ„æºè¯·æ±‚ä¸€è‡´ï¼Œç„¶å300ç§’ä¹‹åï¼Œä¼šæ…¢æ…¢é™ä½åˆ°å®é™…ä½¿ç”¨ç‡å¤–åŠ ä¸€ä¸ªå®‰å…¨è¾¹ç¼˜&lt;/li>
&lt;li>å¦‚æœåˆ©ç”¨ç‡è¶…è¿‡èµ„æºé¢„ç•™å€¼ï¼Œé¢„ç•™å€¼ä¼šå¿«é€Ÿå¢é•¿ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="éš”ç¦»ä¸å®‰å…¨æ€§">éš”ç¦»ä¸å®‰å…¨æ€§ï¼š &lt;a href="#%e9%9a%94%e7%a6%bb%e4%b8%8e%e5%ae%89%e5%85%a8%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>å®‰å…¨éš”ç¦»
&lt;ul>
&lt;li>ä½¿ç”¨Linux chroot jailåœ¨å…±äº«åŒä¸€å°æœºå™¨çš„ä»»åŠ¡ä¹‹é—´ç¡®ä¿å®‰å…¨æ€§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ€§èƒ½éš”ç¦»
&lt;ul>
&lt;li>åŸºäºcgroupçš„èµ„æºå®¹å™¨ï¼Œå…è®¸è¯¦ç»†çš„èµ„æºæ ¸ç®—å¹¶æ‰§è¡Œé™åˆ¶ï¼Œé˜²æ­¢ä»»åŠ¡ç›¸äº’å¹²æ‰°ï¼Œç¡®ä¿ç¨³å®šå’Œå¯é¢„æµ‹çš„æ€§èƒ½&lt;/li>
&lt;li>ä½¿ç”¨&lt;em>appclass&lt;/em>ï¼Œå°½å¯èƒ½ä¿è¯å»¶è¿Ÿæ•æ„ŸæœåŠ¡çš„èµ„æºä½¿ç”¨&lt;/li>
&lt;li>åŒºåˆ†&lt;em>å¯å‹ç¼©èµ„æº&lt;/em> å’Œ &lt;em>ä¸å¯å‹ç¼©èµ„æº&lt;/em>
&lt;ul>
&lt;li>å¯å‹ç¼©èµ„æºï¼ˆcompressiableï¼‰ - CPU%å’ŒDisk IOï¼Œå¯ä»¥æš‚æ—¶é™æµ&lt;/li>
&lt;li>ä¸å¯å‹ç¼©èµ„æºï¼ˆnon-compressibleï¼‰ - å†…å­˜ã€ç£ç›˜å ç”¨ï¼Œéœ€è¦æ¸…é™¤ä¼˜å…ˆçº§ä½çš„çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å†…æ ¸çš„CPUè°ƒåº¦å™¨ï¼Œå…è®¸æ ¹æ®æ¯ä¸ªèµ„æºå®¹å™¨çš„è´Ÿè½½çŠ¶å†µæ¥åŠ¨æ€å†³å®šæ˜¯å¦è¦é©±é€ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼ŒåŒæ—¶é¿å…å¤šä¸ªé«˜ä¼˜å…ˆçº§ä»»åŠ¡åœ¨ä¸€ä¸ªcpuä¸Šäº‰æŠ¢
&lt;ul>
&lt;li>ä»åœ¨å°è¯•cpuè°ƒåº¦æ—¶æ›´å¥½çš„è€ƒè™‘çº¿ç¨‹äº²å’Œã€NUMAäº²å’Œç­‰ç­–ç•¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç»éªŒæ•™è®­">ç»éªŒæ•™è®­ï¼š &lt;a href="#%e7%bb%8f%e9%aa%8c%e6%95%99%e8%ae%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;h3 id="è´Ÿé¢ç»éªŒ">è´Ÿé¢ç»éªŒ &lt;a href="#%e8%b4%9f%e9%9d%a2%e7%bb%8f%e9%aa%8c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;em>Job&lt;/em>ä½œä¸º&lt;em>Task&lt;/em>çš„å”¯ä¸€åˆ†ç»„æœºåˆ¶çš„å±€é™æ€§
&lt;ul>
&lt;li>ç¼ºä¹å°†æ•´ä¸ªå¤š&lt;em>Job&lt;/em>æœåŠ¡ä½œä¸ºå•ä¸€å®ä½“è¿›è¡Œç®¡ç†ï¼Œæˆ–å¼•ç”¨æœåŠ¡ç›¸å…³&lt;em>Job&lt;/em>ï¼ˆå¦‚Canaryä¸Prodæ»šåŠ¨æ›´æ–°ï¼‰çš„æ–¹å¼&lt;/li>
&lt;li>ç”¨æˆ·ä¼šåœ¨&lt;em>Job&lt;/em>åç§°ä¸­ç¼–å…¥æ‹“æ‰‘ï¼Œå¹¶æ„å»ºå¤–éƒ¨ç®¡ç†å·¥å…·æ¥è§£æè¿™äº›åç§°ï¼Œè¿™å¯¼è‡´äº†æ»šåŠ¨æ›´æ–°å’Œä½œä¸šè°ƒæ•´å¤§å°ç­‰é—®é¢˜çš„ä¸çµæ´»è¯­ä¹‰&lt;/li>
&lt;li>Kubernetesé€šè¿‡ä½¿ç”¨æ ‡ç­¾ç»„ç»‡å…¶è°ƒåº¦å•å…ƒï¼ˆPodsï¼‰ï¼Œæä¾›äº†æ›´å¤šçµæ´»æ€§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å•ä¸ªIPåœ°å€å¸¦æ¥çš„å¤æ‚æ€§
&lt;ul>
&lt;li>åŒä¸€å°æœºå™¨ä¸Šçš„æ‰€æœ‰ä»»åŠ¡å…±äº«è¯¥æœºå™¨çš„å•ä¸ªIPåœ°å€å’Œç«¯å£ç©ºé—´&lt;/li>
&lt;li>å¯¼è‡´ç«¯å£ä¹Ÿæˆä¸ºä¸€ç§èµ„æºï¼Œåœ¨è°ƒåº¦æ—¶å€™éœ€è¦è¢«è€ƒè™‘&lt;/li>
&lt;li>Kubernetesé‡‡ç”¨äº†æ›´å‹å¥½çš„æ–¹æ³•ï¼Œæ¯ä¸ªPodå’ŒæœåŠ¡éƒ½è·å–è‡ªå·±çš„IPåœ°å€ï¼Œä»è€Œç®€åŒ–äº†è¿™äº›å¤æ‚æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åå‘äºé«˜çº§ç”¨æˆ·
&lt;ul>
&lt;li>Borgæä¾›äº†ä¸€æ•´å¥—é¢å‘â€œé«˜çº§ç”¨æˆ·â€çš„åŠŸèƒ½ï¼Œå…è®¸ä»–ä»¬ç»†è‡´è°ƒæ•´ç¨‹åºè¿è¡Œæ–¹å¼&lt;/li>
&lt;li>è¿™ç§APIçš„ä¸°å¯Œæ€§ä½¿å¾—å¯¹äºâ€œæ™®é€šâ€ç”¨æˆ·æ›´åŠ å›°éš¾ï¼Œå¹¶é™åˆ¶äº†å…¶æ¼”å˜&lt;/li>
&lt;li>Googleæ„å»ºäº†è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯¹äºå…è®¸â€œå¤±è´¥â€çš„åº”ç”¨ç¨‹åºï¼Œé€šè¿‡å®éªŒæ¥æ¢æµ‹é€‚å½“é…ç½®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç§¯æç»éªŒ">ç§¯æç»éªŒ &lt;a href="#%e7%a7%af%e6%9e%81%e7%bb%8f%e9%aa%8c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>Allocsæ˜¯æœ‰ç”¨çš„
&lt;ul>
&lt;li>Kubernetesä¸­çš„Allocç­‰æ•ˆç‰©æ˜¯Podï¼Œå®ƒæ˜¯ä¸€ä¸ªèµ„æºåŒ…ï¼Œç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œæ€»æ˜¯è¢«è°ƒåº¦åˆ°åŒä¸€å°æœºå™¨ä¸Šå¹¶å¯ä»¥å…±äº«èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é›†ç¾¤ç®¡ç†ä¸ä»…æ˜¯ä»»åŠ¡ç®¡ç†
&lt;ul>
&lt;li>å°½ç®¡Borgçš„ä¸»è¦è§’è‰²æ˜¯ç®¡ç†ä»»åŠ¡å’Œæœºå™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†è¿è¡Œåœ¨Borgä¸Šçš„åº”ç”¨ç¨‹åºä»è®¸å¤šå…¶ä»–é›†ç¾¤æœåŠ¡ä¸­å—ç›Šï¼ŒåŒ…æ‹¬å‘½åå’Œè´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>Kubernetesä½¿ç”¨æœåŠ¡æŠ½è±¡æ”¯æŒå‘½åå’Œè´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡æœ‰ä¸€ä¸ªåç§°å’Œä¸€ç»„ç”±æ ‡ç­¾é€‰æ‹©å™¨å®šä¹‰çš„åŠ¨æ€Podsã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è‡ªçœè‡³å…³é‡è¦
&lt;ul>
&lt;li>å°½ç®¡Borgå‡ ä¹æ€»æ˜¯â€œè¿è¡Œè‰¯å¥½â€ï¼Œä½†å½“å‡ºç°é—®é¢˜æ—¶ï¼Œæ‰¾åˆ°æ ¹æœ¬åŸå› å¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§&lt;/li>
&lt;li>Borgçš„é‡è¦è®¾è®¡å†³ç­–ä¹‹ä¸€æ˜¯å‘æ‰€æœ‰ç”¨æˆ·å±•ç¤ºè°ƒè¯•ä¿¡æ¯&lt;/li>
&lt;li>Kubernetesæ—¨åœ¨å¤åˆ¶Borgçš„è®¸å¤šå†…çœæŠ€æœ¯ï¼Œä¾‹å¦‚ï¼Œå®ƒé…å¤‡äº†cAdvisorç­‰å·¥å…·è¿›è¡Œèµ„æºç›‘æ§å’ŒåŸºäºElasticsearch/Kibanaå’ŒFluentdçš„æ—¥å¿—èšåˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸»æ§èŠ‚ç‚¹æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒ
&lt;ul>
&lt;li>Borgmasteræœ€åˆè¢«è®¾è®¡ä¸ºä¸€ä¸ªå•ä½“ç³»ç»Ÿï¼Œä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒå˜å¾—æ›´åƒæ˜¯ä¸€ä¸ªå†…æ ¸ï¼Œä½äºåä½œç®¡ç†ç”¨æˆ·ä½œä¸šçš„ä¸€ç³»åˆ—æœåŠ¡çš„ä¸­å¿ƒ&lt;/li>
&lt;li>Kubernetesæ¶æ„æ›´è¿›ä¸€æ­¥ï¼Œå®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒçš„APIæœåŠ¡å™¨ï¼Œä»…è´Ÿè´£å¤„ç†è¯·æ±‚å’Œæ“çºµåº•å±‚çŠ¶æ€å¯¹è±¡ï¼Œé›†ç¾¤ç®¡ç†é€»è¾‘è¢«æ„å»ºä¸ºå°å‹å¯ç»„åˆçš„å¾®æœåŠ¡ï¼Œè¿™äº›æœåŠ¡æ˜¯è¿™ä¸ªAPIæœåŠ¡å™¨çš„å®¢æˆ·ç«¯â€‹â€‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://research.google/pubs/large-scale-cluster-management-at-google-with-borg/">è®ºæ–‡&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>[TL;DR] è®ºæ–‡é˜…è¯»ï¼šAutopilot - è‡ªåŠ¨åŒ–æ•°æ®ä¸­å¿ƒç®¡ç†</title><link>https://wizmann.top/posts/tl-dr-autopilot-automatic-data-center-management/</link><pubDate>Fri, 22 Dec 2023 23:32:00 +0000</pubDate><guid>https://wizmann.top/posts/tl-dr-autopilot-automatic-data-center-management/</guid><description>&lt;ul>
&lt;li>
&lt;h2 id="tldr">TL;DR &lt;a href="#tldr" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>Autopilotæ˜¯å¾®è½¯ç”¨æ¥è‡ªåŠ¨åŒ–è¿è¥å¤§è§„æ¨¡ç½‘ç»œæœåŠ¡çš„åŸºç¡€æ¶æ„&lt;/li>
&lt;li>å…¶è®¾è®¡æ ¸å¿ƒæ˜¯Device Managerï¼Œä¸€ä¸ªåŸºäºPaxosçš„å¼ºä¸€è‡´æ€§åˆ†å¸ƒå¼çŠ¶æ€æœºï¼Œç”¨æ¥ä¿å­˜æ•´ä¸ªç³»ç»Ÿçš„â€œå®é™…çœŸç›¸â€ï¼ˆground truthï¼‰ï¼Œå¹¶ä¸”æ ¹æ®æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€ç¡®å®šä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨&lt;/li>
&lt;li>å…¶å®ƒå­æ¨¡å—é€šè¿‡ä¸Device Manageré€šä¿¡ï¼Œåœ¨â€œæœ€ç»ˆä¸€è‡´æ€§â€æ¨¡å‹ä¸‹è·å–ç³»ç»Ÿä¿¡æ¯å¹¶æ‰§è¡Œå‘½ä»¤ï¼Œç¡®ä¿æ›´æ–°å¯èƒ½ä¸æ˜¯å³æ—¶çš„ï¼Œä½†æœ€ç»ˆä¼šåœ¨ç³»ç»Ÿä¸­ä¼ æ’­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="æ¦‚è¿°">æ¦‚è¿°ï¼š &lt;a href="#%e6%a6%82%e8%bf%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>å¾®è½¯è¿è¥å¤§è§„æ¨¡ç½‘ç»œæœåŠ¡ï¼Œéœ€è¦å¯é çš„æ•°æ®ä¸­å¿ƒè‡ªåŠ¨ç®¡ç†â€‹â€‹&lt;/li>
&lt;li>ä¸ºäº†é™ä½æ•°æ®ä¸­å¿ƒçš„è¿è¥å’Œèµ„æœ¬æ”¯å‡ºè€Œè®¾è®¡â€‹â€‹&lt;/li>
&lt;li>è´Ÿè´£è‡ªåŠ¨åŒ–è½¯ä»¶é…ç½®å’Œéƒ¨ç½²ã€ç³»ç»Ÿç›‘æ§ï¼Œä»¥åŠæ‰§è¡Œä¿®å¤æ“ä½œæ¥å¤„ç†è½¯ä»¶å’Œç¡¬ä»¶çš„æ•…éšœ&lt;/li>
&lt;li>å¾®è§‚çš„ç­–ç•¥åˆ™äº¤ç”±å„ä¸ªåº”ç”¨ç¨‹åºæ¥ç¡®å®šã€‚ä¾‹å¦‚ï¼Œç¡®å®šå“ªäº›è®¡ç®—æœºåº”è¿è¡Œå“ªäº›è½¯ä»¶ï¼Œæˆ–è€…ç²¾ç¡®åœ°å®šä¹‰å’Œæ£€æµ‹éœ€è¦ä¿®å¤çš„æ•…éšœ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="è®¾è®¡åŸåˆ™">è®¾è®¡åŸåˆ™ï¼š &lt;a href="#%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>åŸºäºå¤§è§„æ¨¡â€œå•†å“çº§è®¡ç®—æœºç³»ç»Ÿâ€çš„ç»æµæ€§å’Œä¸å¯é æ€§ï¼ŒAutopiloté‡‡ç”¨å®¹é”™å’Œç®€åŒ–è®¾è®¡â€‹â€‹&lt;/li>
&lt;li>å®¹é”™è®¾è®¡ï¼šéæ‹œå åº­å¼æ•…éšœæ¨¡å‹ï¼Œè§£å†³æ•°æ®ä¸­å¿ƒçš„æ§åˆ¶ç¯å¢ƒé—®é¢˜
&lt;ul>
&lt;li>â€œéæ‹œå åº­å¼æ•…éšœæ¨¡å‹â€å‡è®¾ç³»ç»Ÿä¸­çš„é”™è¯¯ä¸æ˜¯æ¶æ„æˆ–æ¬ºè¯ˆæ€§çš„ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œç³»ç»Ÿçš„æ•…éšœè¢«è®¤ä¸ºæ˜¯ç”±äºä¸€äº›å¸¸è§„åŸå› ï¼Œå¦‚ç¡¬ä»¶æ•…éšœã€è½¯ä»¶ç¼ºé™·æˆ–ç½‘ç»œé—®é¢˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç®€åŒ–è®¾è®¡ï¼š
&lt;ul>
&lt;li>å¼ºè°ƒç®€å•æ€§å’Œå®¹é”™æ€§&lt;/li>
&lt;li>åœ¨æ„å»ºå¤§å‹çš„å¯é ã€å¯ç»´æŠ¤ç³»ç»Ÿæ—¶ï¼Œå¸¸å¸¸é€‰æ‹©ç®€å•è®¾è®¡è€Œéæ›´é«˜æ•ˆæˆ–çœ‹ä¼¼æ›´ä¼˜é›…ä½†æ›´å¤æ‚çš„è§£å†³æ¡ˆã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç³»ç»Ÿæ¦‚è§ˆ">ç³»ç»Ÿæ¦‚è§ˆï¼š &lt;a href="#%e7%b3%bb%e7%bb%9f%e6%a6%82%e8%a7%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>Autopilotåˆ†ä¸ºå¤šä¸ªç»„ä»¶
&lt;ul>
&lt;li>&lt;img src="https://github.com/Wizmann/assets/blob/master/wizmann-pic/image_1703238379499_0.png?raw=true" alt="image.png">&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¹³è¡¡å¼±ä¸€è‡´æ€§å’Œå¼ºä¸€è‡´æ€§ä¹‹é—´çš„æŠ‰æ‹©
&lt;ul>
&lt;li>å¼±ä¸€è‡´æ€§ï¼šå¢å¼ºå¯ç”¨æ€§&lt;/li>
&lt;li>å¼ºä¸€è‡´æ€§ï¼šç®€åŒ–è®¾è®¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Device Manager - çŠ¶æ€å’Œé€»è¾‘ç®¡ç†
&lt;ul>
&lt;li>æ‰€æœ‰å…³äºç³»ç»Ÿåº”å¤„äºçš„â€œå®é™…çœŸç›¸â€ï¼ˆground truthï¼‰çŠ¶æ€ä»¥åŠæ›´æ–°è¿™ä¸€çŠ¶æ€çš„é€»è¾‘ï¼Œéƒ½ä¿å­˜åœ¨ä¸€ä¸ªç§°ä¸º Device Manager çš„å¼ºä¸€è‡´æ€§çŠ¶æ€æœºä¸­ï¼Œé€šå¸¸åˆ†å¸ƒåœ¨5è‡³10å°è®¡ç®—æœºä¸Š&lt;/li>
&lt;li>ä½¿ç”¨ Paxos ç®—æ³•å®ç°å‰¯æœ¬é—´çš„ä¸€è‡´æ€§ï¼ŒåŒæ—¶é€šè¿‡æ‰¹å¤„ç†æ›´æ–°ä»¥å¹³è¡¡å»¶è¿Ÿå’Œååé‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Device Managerä¸â€œå«æ˜ŸæœåŠ¡â€
&lt;ul>
&lt;li>â€œå«æ˜ŸæœåŠ¡â€åœ¨å‘ç° Device Manager çŠ¶æ€éœ€è¦æ—¶ï¼Œæƒ°æ€§åœ°å‘è‡ªèº«æˆ–å…¶å®¢æˆ·ç«¯çš„åŒæ­¥ä¿¡æ¯&lt;/li>
&lt;li>å¦‚æœâ€œå«æ˜ŸæœåŠ¡â€å‘ç°é›†ç¾¤ä¸­çš„æ•…éšœæˆ–ä¸ä¸€è‡´ï¼Œå®ƒä¸ä¼šå°è¯•çº æ­£ï¼Œè€Œæ˜¯å°†é—®é¢˜æŠ¥å‘Šç»™ Device Manager
&lt;ul>
&lt;li>Autopilotä¼šç»¼åˆè¿™äº›ä¿¡æ¯åšå‡ºä¸‹ä¸€æ­¥å†³å®š&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å½“ Device Manager æ›´æ–°å…¶çŠ¶æ€æ—¶ï¼Œä¼šé€šçŸ¥â€œå«æ˜ŸæœåŠ¡â€ã€‚â€œå«æ˜ŸæœåŠ¡â€ä¹Ÿä¼šé€šè¿‡å¿ƒè·³ä¿¡æ¯å°è¯•æ‹‰å–æœ€æ–°çš„çŠ¶æ€ã€‚ç®€åŒ–è®¾è®¡çš„åŒæ—¶ï¼Œå¹¶ä¸”ä¿è¯æœ€ç»ˆä¸€è‡´æ€§/æ­£ç¡®æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="åº•å±‚æœåŠ¡">åº•å±‚æœåŠ¡ï¼š &lt;a href="#%e5%ba%95%e5%b1%82%e6%9c%8d%e5%8a%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ä½¿ç”¨ç¨³å®šçš„Windows Serveræ“ä½œç³»ç»Ÿé•œåƒï¼ŒåŒ…å«Autopiloté…ç½®æ–‡ä»¶å’ŒæœåŠ¡â€‹â€‹&lt;/li>
&lt;li>é…ç½®æœåŠ¡ï¼ˆProvisioningï¼‰åŒ…æ‹¬DHCPå’Œç½‘ç»œå¼•å¯¼ï¼Œä¸æ–­æ‰«æç½‘ç»œä¸­æ–°æ¥å…¥çš„è®¡ç®—æœºâ€‹â€‹
&lt;ul>
&lt;li>é€šè¿‡Device Manageræä¾›çš„ä¿¡æ¯æ¥å†³å®šéœ€è¦è¿è¡Œçš„æ“ä½œç³»ç»ŸåŠäºŒè¿›åˆ¶ç¨‹åº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åº”ç”¨éƒ¨ç½²
&lt;ul>
&lt;li>å®šä¹‰ä¸åŒæœºå™¨ç±»å‹ï¼Œå­˜å‚¨ä¸åŒé…ç½®æ–‡ä»¶å’Œåº”ç”¨äºŒè¿›åˆ¶æ–‡ä»¶â€‹â€‹&lt;/li>
&lt;li>éƒ¨ç½²æ–°ä»£ç æ—¶ï¼Œä»¥Scale unitä¸ºå•ä½æ›´æ–°/å›æ»šå„æœºå™¨ç±»å‹çš„é…ç½®â€‹â€‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="è‡ªåŠ¨ä¿®å¤æœåŠ¡">è‡ªåŠ¨ä¿®å¤æœåŠ¡ &lt;a href="#%e8%87%aa%e5%8a%a8%e4%bf%ae%e5%a4%8d%e6%9c%8d%e5%8a%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ä½¿ç”¨æœ€å°åŒ–çš„æ•…éšœæ£€æµ‹å’Œæ¢å¤æ¨¡å‹ï¼Œä»¥èŠ‚ç‚¹æˆ–äº¤æ¢æœºä¸ºå•ä½ï¼Œä¸å¤„ç†ç‰¹å®šè¿›ç¨‹çš„é”™è¯¯
&lt;ul>
&lt;li>åªåŒ…æ‹¬Reboot / ReImage / Replace ä¸‰ç§æ“ä½œ&lt;/li>
&lt;li>Autopilotæ— éœ€å¯¹é”™è¯¯å½’å› ï¼Œä¹Ÿä¸éœ€è¦ç›¸å…³çš„é”™è¯¯å¤„ç†é€»è¾‘&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç”¨çœ‹é—¨ç‹—è¿›è¡Œæ•…éšœæŠ¥å‘Šâ€‹â€‹ï¼Œæ£€æµ‹ç‰¹å®šçš„å±æ€§ï¼Œå¹¶ä¸ŠæŠ¥ç»™Device Manager&lt;/li>
&lt;li>Device Managerä½œä¸ºä¸€ä¸ªé›†ä¸­å¼ç¨‹åºï¼Œæ§åˆ¶æœºå™¨çš„è‡ªåŠ¨ä¿®å¤ï¼Œå¹¶ä¸”æ§åˆ¶åŒæ—¶è¿›è¡Œä¿®å¤æœºå™¨çš„æ•°é‡&lt;/li>
&lt;li>&lt;img src="https://github.com/Wizmann/assets/blob/master/wizmann-pic/image_1703254394216_0.png?raw=true" alt="image.png">&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç›‘æ§æœåŠ¡">ç›‘æ§æœåŠ¡ï¼š &lt;a href="#%e7%9b%91%e6%8e%a7%e6%9c%8d%e5%8a%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>è®°å½•æ€§èƒ½è®¡æ•°å™¨å’Œæ—¥å¿—ï¼Œæ”¶é›†æœåŠ¡å½¢æˆåˆ†å¸ƒå¼é›†åˆå’Œèšåˆæ ‘â€‹â€‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="æ¡ˆä¾‹ç ”ç©¶---indexserving">æ¡ˆä¾‹ç ”ç©¶ - IndexServingï¼š &lt;a href="#%e6%a1%88%e4%be%8b%e7%a0%94%e7%a9%b6---indexserving" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ä»‹ç»Windows Live Searchå¦‚ä½•ä¸Autopilotäº¤äº’ï¼Œä¿æŒé«˜å¯ç”¨æ€§â€‹â€‹&lt;/li>
&lt;li>å¯¹äºéœ€è¦é«˜å¯ç”¨æ€§å’Œä½å»¶è¿Ÿçš„é¢å‘å®¢æˆ·æœåŠ¡çš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦åœ¨åŸºç¡€çš„ Autopilot ç»„ä»¶ä¹‹ä¸Šå¢åŠ å®šåˆ¶çš„å®¹é”™å±‚
&lt;ul>
&lt;li>ä½¿ç”¨Load balancerå’Œå®šåˆ¶çš„ç›‘æ§æœåŠ¡æ¥æ¢æµ‹å¤±æ•ˆçš„æˆ–è€…æ…¢é€Ÿçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å°†ç»“è®ºä¸ŠæŠ¥åˆ°Autopilot&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ç»éªŒä¸æ•™è®­">ç»éªŒä¸æ•™è®­ï¼š &lt;a href="#%e7%bb%8f%e9%aa%8c%e4%b8%8e%e6%95%99%e8%ae%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>å¯¹äºå…³é”®çš„é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œchecksumæ£€æŸ¥æ˜¯å¿…é¡»çš„
&lt;ul>
&lt;li>é¿å…äººå·¥å¤±è¯¯ï¼ˆä¾‹å¦‚éƒ¨ç½²å› Debugè€Œä¸´æ—¶ä¿®æ”¹çš„é…ç½®ï¼‰æˆ–è€…å…¶å®ƒæ„å¤–é—®é¢˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç½‘ç»œæ˜¯ä¸å¯é çš„
&lt;ul>
&lt;li>TCP/IPçš„checksuméå¸¸å¼±ï¼Œæ‰€ä»¥éœ€è¦åº”ç”¨å±‚é¢çš„é¢å¤–æ£€æŸ¥&lt;/li>
&lt;li>ç½‘ç»œç¡¬ä»¶ç»å¸¸ç¿»è½¬æ•°æ®æµä¸­çš„bitä½ï¼Œå¯¼è‡´å¤§é‡çš„é‡è¯•æˆ–è€…æœªè¢«ç½‘ç»œå±‚æ£€æµ‹åˆ°çš„æ•°æ®é”™è¯¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸€äº›èŠ‚ç‚¹å¶å°”ä¼šè¿è¡Œçš„å¼‚å¸¸æ…¢ï¼Œä½†æ˜¯å¹¶ä¸ä¼šåœæ­¢å·¥ä½œã€‚è¿™ç§é—®é¢˜ä¸â€œå¤±è´¥åœæ­¢é”™è¯¯â€ä¸€æ ·éœ€è¦è¢«åŠæ—¶æ£€æµ‹åˆ°&lt;/li>
&lt;li>èŠ‚æµä¸è´Ÿè·å‰Šå‡å¯¹äºè‡ªåŠ¨åŒ–ç³»ç»Ÿéå¸¸é‡è¦
&lt;ul>
&lt;li>å¤±æ•ˆæ£€æµ‹æ¨¡å—éœ€è¦æœ‰æ•ˆçš„åŒºåˆ†èŠ‚ç‚¹å¤±æ•ˆä¸èŠ‚ç‚¹è¿‡è½½çš„åŒºåˆ«&lt;/li>
&lt;li>ç®€å•çš„ç§»é™¤èŠ‚ç‚¹å¯èƒ½ä¼šå¯¼è‡´çº§è”å¼çš„å¤±æ•ˆï¼Œè¿›è€Œä½¿æ•´ä¸ªç³»ç»Ÿå¤±æ•ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.semanticscholar.org/paper/Autopilot%3A-automatic-data-center-management-Isard/a531d33efc600a8770316db71dc06a7599f9547a">è®ºæ–‡&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>ä½¿ç”¨ SPIN/Promela å¯¹å¤šçº¿ç¨‹ Concurrent FIFO Queue è¿›è¡Œå»ºæ¨¡ä¸éªŒè¯</title><link>https://wizmann.top/posts/spin-promela-concurrent-queue-1/</link><pubDate>Sun, 17 Dec 2023 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/spin-promela-concurrent-queue-1/</guid><description>&lt;h2 id="å¼•è¨€">å¼•è¨€ &lt;a href="#%e5%bc%95%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¹¶å‘ç¼–ç¨‹ä¸­è®¾è®¡å’ŒéªŒè¯å¤šçº¿ç¨‹æ•°æ®ç»“æ„æ˜¯ä¸€é¡¹æå¤§çš„æŒ‘æˆ˜ï¼Œå³ä½¿æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®ç»“æ„ï¼ˆè§&lt;a href="https://wizmann.top/implement-non-blocking-queue.html">ã€Šå®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—ã€‹&lt;/a>ä¸€æ–‡ï¼‰ï¼Œéƒ½éœ€è¦ä¸å°‘çš„è„‘åŠ›ã€è®¨è®ºä¸å®è·µæ‰å¯ä»¥å°½å¯èƒ½ä¿è¯å…¶æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;p>æœ¬æ–‡å°è¯•ä½¿ç”¨ SPIN/Promela å¯¹å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„ Concurrent FIFO Queue çš„ä¸€ç§å®ç°è¿›è¡Œå»ºæ¨¡ä¸éªŒè¯ã€‚&lt;/p>
&lt;h2 id="concurrent-fifo-queue-çš„è®¾è®¡">Concurrent FIFO Queue çš„è®¾è®¡ &lt;a href="#concurrent-fifo-queue-%e7%9a%84%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸ºäº†ä¿è¯å¤šçº¿ç¨‹æ“ä½œçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹å…³é”®è®¾è®¡ï¼š&lt;/p>
&lt;ul>
&lt;li>Dummy Head å’Œ Dummy Tail èŠ‚ç‚¹ï¼šå¼•å…¥è¿™ä¸¤ä¸ªèŠ‚ç‚¹ç®€åŒ–äº†é˜Ÿåˆ—æ“ä½œé€»è¾‘ï¼Œé™ä½å¹¶å‘ä¸­çš„å¤æ‚æ€§&lt;/li>
&lt;li>Dummy Tail Data æŒ‡é’ˆä½œä¸ºâ€œé”â€ï¼šè¿™ä¸ªæ–¹æ³•ç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶æ“ä½œå°¾èŠ‚ç‚¹ï¼Œé™ä½äº†å¯¹é”çš„ä¾èµ–&lt;/li>
&lt;li>åˆ©ç”¨æŒ‡é’ˆèµ‹å€¼çš„åŸå­æ€§ï¼šé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‡å°‘äº†é”çš„ä½¿ç”¨ï¼Œæé«˜äº†æ•ˆç‡&lt;/li>
&lt;/ul>
&lt;h2 id="spinpromela-å»ºæ¨¡ä¸­çš„è€ƒè™‘å› ç´ ">SPIN/Promela å»ºæ¨¡ä¸­çš„è€ƒè™‘å› ç´  &lt;a href="#spinpromela-%e5%bb%ba%e6%a8%a1%e4%b8%ad%e7%9a%84%e8%80%83%e8%99%91%e5%9b%a0%e7%b4%a0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä½¿ç”¨ SPIN/Promela å»ºæ¨¡æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´äº†å‡ ä¸ªæŒ‘æˆ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>é™æ€å†…å­˜ç®¡ç†ï¼šSPIN/Promela ç¼ºä¹åŠ¨æ€å†…å­˜æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæç®€çš„æ‰‹åŠ¨ç®¡ç†çš„é™æ€å†…å­˜å †æ ˆã€‚&lt;/li>
&lt;li>å‡å°‘çŠ¶æ€ç©ºé—´ï¼šé˜Ÿåˆ—çš„é•¿åº¦å¯ä»¥æ˜¯æ— é™çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æ— é™çš„çŠ¶æ€ç©ºé—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦è®¾ä¸º3ï¼Œä»¥å‡å°‘çŠ¶æ€çš„ç©·ä¸¾ç©ºé—´ã€‚&lt;/li>
&lt;li>æ¨¡æ‹ŸCASæ“ä½œï¼šç”±äºç¼ºå°‘CASæŒ‡ä»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ do å¾ªç¯å’Œ atomic å—æ¥æ¨¡æ‹Ÿï¼ŒåŒæ—¶å¼€å¯ weak fairness é¿å…æ— é™å¾ªç¯ã€‚ï¼ˆè§&lt;a href="https://wizmann.top/simple-cas-model-in-spin-promela.html">ã€Šåœ¨SPIN/Promelaä¸­æ¨¡æ‹ŸCASã€‹&lt;/a>ä¸€æ–‡ï¼‰&lt;/li>
&lt;li>LTLè¡¨è¾¾å¼çš„ä½¿ç”¨ï¼šä½¿ç”¨ LTL è¡¨è¾¾å¼æ¥ç©·ä¸¾æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„ç¨‹åºçŠ¶æ€ï¼ŒåŒ…æ‹¬è¾¹ç¼˜æƒ…å†µã€‚
&lt;ul>
&lt;li>LTLè¡¨è¾¾å¼å¶å°”ä¼šæœ‰ä¸€äº›â€åç›´è§‰â€œçš„æƒ…å†µå‡ºç°&lt;/li>
&lt;li>ä¾‹å¦‚åœ¨ç¨‹åºéªŒè¯è·¯å¾„ä¸­ï¼Œè™½ç„¶ç†è®ºä¸Šé˜Ÿåˆ—å¤§å°å¯ä»¥ä¸º0~3å½“ä¸­çš„ä»»æ„æ•°ã€‚ä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€ç§å¯èƒ½ï¼Œå³é˜Ÿåˆ—å¤§å°å¯ä»¥åœ¨2å’Œ3ä¹‹é—´åå¤å˜åŒ–ã€‚å¦‚æœæˆ‘ä»¬å£°æ˜â€œ&lt;strong>æ°¸è¿œ&lt;/strong> &lt;strong>æœ€ç»ˆ&lt;/strong> ä¸€å®šå­˜åœ¨ queue size==1â€ çš„è¡¨è¾¾å¼ä¼šå¤±è´¥ï¼Œå› ä¸ºé˜Ÿåˆ—å¤§å°åœ¨è¿™ç§â€œäººé€ åœºæ™¯â€ä¸‹æ°¸è¿œä¸ä¼šä¸º1ã€‚&lt;/li>
&lt;li>è¿™ç§æƒ…å†µè¦æ±‚æˆ‘ä»¬éå¸¸ç²¾ç¡®åœ°è®¾è®¡ LTL è¡¨è¾¾å¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä»£ç ä¸æ–­è¨€çš„ç»“åˆï¼šå› ä¸º LTL è¡¨è¾¾å¼çš„è¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼Œéœ€è¦ç»“åˆä»£ç ä¸­çš„ assert è¯­å¥æ¥è¿›è¡Œæ›´å…¨é¢çš„éªŒè¯&lt;/li>
&lt;/ul>
&lt;h2 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹ &lt;a href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨äºå»ºæ¨¡å’ŒéªŒè¯ Concurrent FIFO Queue çš„ Promela ä»£ç ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-promela" data-lang="promela">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define MAX_CAPACITY 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define NUM_NODES MAX_CAPACITY + 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define EMPTY -1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define INVALID_PTR -1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define QUEUE_NOT_FULL (memptr &amp;gt; 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define QUEUE_NOT_EMPTY (memptr &amp;lt; MAX_CAPACITY)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define QUEUE_IS_EMPTY (memptr == MAX_CAPACITY)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define QUEUE_IS_FULL (memptr == 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HEAD 0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> QueueNode {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nextptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> data;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1 dummy head + 1 dummy tail + #(data nodes)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>QueueNode nodes[NUM_NODES];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// data nodes + dummy tail
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> memory[MAX_CAPACITY &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> memptr &lt;span style="color:#f92672">=&lt;/span> MAX_CAPACITY;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> tail;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> queue_size &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> running &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">init&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (i &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> .. NUM_NODES &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[i]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> INVALID_PTR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[i]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> EMPTY;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (i &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> .. MAX_CAPACITY &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memory[i] &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memory[MAX_CAPACITY] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">-1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> HEAD &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tail &lt;span style="color:#f92672">=&lt;/span> HEAD &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span> worker(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span> worker(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> running &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> update_queue_size() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">d_step&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cur &lt;span style="color:#f92672">=&lt;/span> HEAD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> size &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> nodes[cur]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> INVALID_PTR &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(cur &lt;span style="color:#f92672">!=&lt;/span> INVALID_PTR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur &lt;span style="color:#f92672">=&lt;/span> nodes[cur]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(nodes[cur]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">==&lt;/span> INVALID_PTR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size&lt;span style="color:#f92672">--&lt;/span>; &lt;span style="color:#75715e">// remove HEAD
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">assert&lt;/span>(size &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> size &lt;span style="color:#f92672">&amp;lt;=&lt;/span> MAX_CAPACITY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> queue_size &lt;span style="color:#f92672">=&lt;/span> size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> enqueue(workerId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cur1 &lt;span style="color:#f92672">=&lt;/span> INVALID_PTR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (memptr &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur1 &lt;span style="color:#f92672">=&lt;/span> memory[memptr &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memory[memptr &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">-1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memptr&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(nodes[cur1]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">==&lt;/span> EMPTY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(nodes[cur1]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">==&lt;/span> INVALID_PTR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> cur1 &lt;span style="color:#f92672">!=&lt;/span> INVALID_PTR &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (true) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// CAS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (nodes[tail]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">==&lt;/span> EMPTY) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[tail]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> workerId;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> update_queue_size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[tail]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> cur1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tail &lt;span style="color:#f92672">=&lt;/span> cur1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> dequeue(workerId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cur2 &lt;span style="color:#f92672">=&lt;/span> INVALID_PTR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (true) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nxt2 &lt;span style="color:#f92672">=&lt;/span> nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur2 &lt;span style="color:#f92672">=&lt;/span> INVALID_PTR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (nxt2 &lt;span style="color:#f92672">!=&lt;/span> tail) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur2 &lt;span style="color:#f92672">=&lt;/span> nxt2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> update_queue_size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">==&lt;/span> nxt2 &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nxt2 &lt;span style="color:#f92672">!=&lt;/span> tail) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> nodes[cur2]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[cur2]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> INVALID_PTR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodes[cur2]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> EMPTY;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> update_queue_size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (cur2 &lt;span style="color:#f92672">!=&lt;/span> INVALID_PTR) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">d_step&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(nodes[cur2]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">==&lt;/span> INVALID_PTR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(nodes[cur2]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">==&lt;/span> EMPTY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(memptr &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> MAX_CAPACITY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (i &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> .. memptr &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(memory[i] &lt;span style="color:#f92672">!=&lt;/span> cur2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">assert&lt;/span>(memory[memptr] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">-1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memory[memptr] &lt;span style="color:#f92672">=&lt;/span> cur2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memptr&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">proctype&lt;/span> worker(&lt;span style="color:#66d9ef">int&lt;/span> workerId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (QUEUE_NOT_FULL) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> enqueue(workerId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (QUEUE_NOT_EMPTY) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> dequeue(workerId);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ltl&lt;/span> valid_first_node { &lt;span style="color:#f92672">[]&lt;/span>( running &lt;span style="color:#f92672">-&amp;gt;&lt;/span> ((nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> INVALID_PTR) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (nodes[HEAD]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">nextptr&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> NUM_NODES)) ); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ltl&lt;/span> not_always_empty { &lt;span style="color:#f92672">[]&lt;/span>(running &lt;span style="color:#f92672">-&amp;gt;&lt;/span> (QUEUE_IS_EMPTY &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>QUEUE_NOT_EMPTY)); };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ltl&lt;/span> not_always_full { &lt;span style="color:#f92672">[]&lt;/span>(running &lt;span style="color:#f92672">-&amp;gt;&lt;/span> (QUEUE_IS_FULL &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>QUEUE_NOT_FULL)); };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ltl&lt;/span> size_change_by_1 { &lt;span style="color:#f92672">[]&lt;/span>(running &lt;span style="color:#f92672">-&amp;gt;&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">U&lt;/span> queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">U&lt;/span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>)) &lt;span style="color:#f92672">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">U&lt;/span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">||&lt;/span> queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>)) &lt;span style="color:#f92672">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">U&lt;/span> queue_size &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>))) }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è®¨è®º">è®¨è®º &lt;a href="#%e8%ae%a8%e8%ae%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æ··åˆç¼–ç¨‹çš„å¯èƒ½æ€§">æ··åˆç¼–ç¨‹çš„å¯èƒ½æ€§ &lt;a href="#%e6%b7%b7%e5%90%88%e7%bc%96%e7%a8%8b%e7%9a%84%e5%8f%af%e8%83%bd%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡ Promela ä¸ C/C++ çš„æ··åˆç¼–ç¨‹æ¥è§£å†³æ¨¡å‹ä¸­çš„ä¸€äº›å›°éš¾ï¼Ÿè¿™ç§æ–¹æ³•æˆ–è®¸èƒ½æä¾›æ›´åŠ çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œä½†ä»£ä»·åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="ltlè¯­å¥çš„åˆç†æ€§">LTLè¯­å¥çš„åˆç†æ€§ &lt;a href="#ltl%e8%af%ad%e5%8f%a5%e7%9a%84%e5%90%88%e7%90%86%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éªŒè¯æ•°æ®ç»“æ„çš„æ­£ç¡®æ€§å§‹ç»ˆæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚å¯¹äºä»£ç ä¸­ä½¿ç”¨çš„LTLè¯­å¥ï¼Œæ˜¯å¦éœ€è¦ç»§ç»­å®Œå–„ä»¥ä¿è¯å…¶åœ¨æ›´å¤šï¼ˆç”šè‡³æ‰€æœ‰ï¼‰åœºæ™¯ä¸‹çš„æ­£ç¡®æ€§?&lt;/p>
&lt;h3 id="å¯¹äºå…¶ä»–å®ç°çš„éªŒè¯">å¯¹äºå…¶ä»–å®ç°çš„éªŒè¯ &lt;a href="#%e5%af%b9%e4%ba%8e%e5%85%b6%e4%bb%96%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%aa%8c%e8%af%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨&lt;a href="https://wizmann.top/implement-non-blocking-queue.html">ã€Šå®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—ã€‹&lt;/a>ä¸€æ–‡ä¸­ï¼Œæ¶‰åŠäº†æ›´å¤šçš„å¤šçº¿ç¨‹é˜Ÿåˆ—æ¨¡å‹ï¼Œåç»­ä¼šå¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚&lt;/p>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>åœ¨SPIN/Promelaä¸­æ¨¡æ‹ŸCASï¼ˆCompare-and-Swapï¼‰</title><link>https://wizmann.top/posts/simple-cas-model-in-spin-promela/</link><pubDate>Fri, 15 Dec 2023 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/simple-cas-model-in-spin-promela/</guid><description>&lt;p>CASï¼ˆCompare-And-Swapï¼‰æ˜¯ä¸€ç§åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¸¸ç”¨çš„æ•°æ®åŒæ­¥æ–¹æ³•ï¼Œå®ƒé€šè¿‡æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç„¶è€Œï¼Œåœ¨SPIN/Promelaä¸­æ²¡æœ‰ç›´æ¥çš„CASå¯¹åº”å®ç°ã€‚&lt;/p>
&lt;p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚è€ƒè™‘ä»¥ä¸‹Promelaä»£ç ï¼Œå®ƒæ¨¡æ‹Ÿäº†ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ worker0 å’Œ worker1 ä½¿ç”¨CASæœºåˆ¶äº¤æ›¿ä¿®æ”¹å…±äº«å˜é‡ x çš„åœºæ™¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-promela" data-lang="promela">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> running &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">proctype&lt;/span> worker0() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (true) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (x &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> { x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">proctype&lt;/span> worker1() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (true) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> (x &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> { x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">::&lt;/span> else &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">skip&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">od&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">init&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">atomic&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span> worker0()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span> worker1();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> running &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">ltl&lt;/span> not_always_0 { &lt;span style="color:#f92672">[]&lt;/span>(running &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;gt;&lt;/span>(x &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)); };
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ç›´è§‚ä¸Šç†è§£ï¼ŒLTLè¡¨è¾¾å¼ not_always_0 åº”è¯¥è¢«æ»¡è¶³ï¼Œå› ä¸º worker0 å’Œ worker1 åº”è¯¥ä¼šäº¤æ›¿æ‰§è¡Œï¼Œä»è€Œåœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»ä½¿ x == 1 æˆç«‹ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œåœ¨SPINçš„å®é™…è¿è¡Œä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ worker0 åœ¨ä»»ä½•ç‚¹åœæ­¢æ‰§è¡Œï¼Œworker1 å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºâ€œé¥¥é¥¿â€ï¼ˆstarvationï¼‰ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨SPINä¸­ä½¿ç”¨ -f é€‰é¡¹æ¥ä¿è¯å¼±å…¬å¹³æ€§ï¼ˆweak fairnessï¼‰ã€‚å¼±å…¬å¹³æ€§æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªå¯æ‰§è¡Œçš„åŠ¨ä½œåœ¨æ— é™é•¿çš„æ‰§è¡Œåºåˆ—ä¸­æœ‰æ— é™æ¬¡çš„æ‰§è¡Œæœºä¼šï¼Œé‚£ä¹ˆå®ƒæœ€ç»ˆå¿…é¡»å¾—åˆ°æ‰§è¡Œã€‚è¿™ç¡®ä¿äº†å³ä½¿ä¸€ä¸ªåŠ¨ä½œæš‚æ—¶æ— æ³•æ‰§è¡Œï¼Œå®ƒæœ€ç»ˆä¹Ÿä¼šæœ‰æœºä¼šæ‰§è¡Œã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œåº”ç”¨å¼±å…¬å¹³æ€§å¯ä»¥ç¡®ä¿ worker0 å’Œ worker1 æœ€ç»ˆéƒ½æœ‰æœºä¼šäº¤æ›¿æ‰§è¡Œã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ¨¡æ‹Ÿç°å®çš„å¤šçº¿ç¨‹CPUæ‰§è¡Œåœºæ™¯ï¼Œä»è€ŒéªŒè¯äº†LTLå±æ€§ not_always_0 çš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>è¯¦ç»†å‘½ä»¤&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>spin -a simple-cas.pml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./pan -m10000 -a -f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å‚è€ƒé“¾æ¥
&lt;ul>
&lt;li>&lt;a href="https://spinroot.com/spin/Man/Quick.html">Concise Promela Reference &amp;gt; Executing a Promela system&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡å¤§ï¼ˆåˆ’æ‰ï¼‰éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>[tl;dr] è®ºæ–‡é˜…è¯»ï¼šRarest First and Choke Algorithms Are Enough</title><link>https://wizmann.top/posts/tl-dr-rarest-first-and-choke-algorithms-are-enough/</link><pubDate>Fri, 08 Dec 2023 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/tl-dr-rarest-first-and-choke-algorithms-are-enough/</guid><description>&lt;ul>
&lt;li>
&lt;h2 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ &lt;a href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;strong>Peer&lt;/strong>ï¼šBitTorrent P2Pä¸‹è½½çš„å‚ä¸è€…&lt;/li>
&lt;li>&lt;strong>Leecher&lt;/strong>ï¼šâ€œå¸è¡€è€…â€ï¼Œä»åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­çš„peer&lt;/li>
&lt;li>&lt;strong>Seeder&lt;/strong>ï¼šåšç§è€…ï¼Œä¸‹è½½å®Œæˆåè¿˜åœ¨ç»§ç»­åšç§çš„peer&lt;/li>
&lt;li>&lt;strong>Piece&lt;/strong>ï¼šPieceæ˜¯æ–‡ä»¶çš„æ•°æ®å•å…ƒã€‚å½“æ–‡ä»¶è¢«åˆ†äº«æ—¶ï¼Œå®ƒè¢«åˆ†å‰²æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‰‡æ®µï¼Œç§°ä¸º&amp;quot;pieces&amp;quot;ã€‚è¿™äº›piecesæ˜¯peeré—´ä¼ è¾“çš„åŸºæœ¬å•ä½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•rarest-first-algorithm">&amp;ldquo;æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•&amp;rdquo;ï¼ˆRarest First Algorithmï¼‰ &lt;a href="#%e6%9c%80%e7%a8%80%e6%9c%89%e4%bc%98%e5%85%88%e7%ae%97%e6%b3%95rarest-first-algorithm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&amp;ldquo;æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•&amp;rdquo;ï¼ˆRarest First Algorithmï¼‰æ˜¯BitTorrentåè®®ä¸­çš„ä¸€ä¸ªå…³é”®ç­–ç•¥ï¼Œç”¨äºå†³å®šå“ªäº›æ•°æ®å—ï¼ˆpieceï¼‰é¦–å…ˆè¢«ä¸‹è½½å’Œåˆ†äº«ã€‚è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒç›®æ ‡æ˜¯ä¼˜åŒ–æ•´ä¸ªç½‘ç»œä¸­æ•°æ®çš„åˆ†å¸ƒï¼Œç¡®ä¿æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦å’Œæ›´é«˜çš„æ•ˆç‡ã€‚&lt;/li>
&lt;li>
&lt;h3 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç† &lt;a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ•°æ®å—çš„ç¨€æœ‰åº¦&lt;/strong>
&lt;ul>
&lt;li>åœ¨BitTorrentç½‘ç»œä¸­ï¼Œæ–‡ä»¶è¢«åˆ†å‰²æˆè®¸å¤šå°çš„æ•°æ®å—ã€‚
&lt;ul>
&lt;li>â€œæœ€ç¨€æœ‰ä¼˜å…ˆâ€ç®—æ³•çš„ç›®çš„æ˜¯ä¼˜å…ˆä¸‹è½½é‚£äº›ç½‘ç»œä¸­æ•°é‡æœ€å°‘çš„æ•°æ®å—ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>é€‰æ‹©ä¸‹è½½çš„å—&lt;/strong>ï¼š
&lt;ul>
&lt;li>å½“ä¸€ä¸ªpeeråŠ å…¥Torrentç½‘ç»œï¼Œå¹¶å¼€å§‹ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå®ƒé¦–å…ˆä¼šä»æ‰€æœ‰è¿æ¥çš„peeré‚£é‡Œè·å–æœ‰å…³å“ªäº›æ•°æ®å—æ˜¯ç¨€æœ‰çš„ä¿¡æ¯ã€‚
&lt;ul>
&lt;li>ç„¶åï¼Œå®ƒä¼˜å…ˆè¯·æ±‚ä¸‹è½½é‚£äº›æœ€ç¨€æœ‰çš„æ•°æ®å—ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åŠ¨æ€è°ƒæ•´&lt;/strong>ï¼š
&lt;ul>
&lt;li>éšç€ä¸‹è½½çš„è¿›è¡Œï¼Œæ¯ä¸ªpeerä¼šä¸æ–­æ›´æ–°å’Œé‡æ–°è¯„ä¼°ç½‘ç»œä¸­æ¯ä¸ªæ•°æ®å—çš„ç¨€æœ‰åº¦ï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´å…¶ä¸‹è½½ä¼˜å…ˆçº§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç®—æ³•çš„é‡è¦æ€§">ç®—æ³•çš„é‡è¦æ€§ &lt;a href="#%e7%ae%97%e6%b3%95%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æé«˜æ•ˆç‡&lt;/strong>ï¼šé€šè¿‡ä¼˜å…ˆä¸‹è½½æœ€ç¨€æœ‰çš„å—ï¼Œè¿™ä¸ªç®—æ³•å¸®åŠ©åŠ å¿«äº†æ–‡ä»¶çš„æ•´ä½“ä¸‹è½½é€Ÿåº¦ã€‚ä¸€æ—¦æœ€ç¨€æœ‰çš„å—è¢«æ›´å¤špeerè·å–ï¼Œå®ƒä»¬å°±æ›´å®¹æ˜“è¢«è¿›ä¸€æ­¥åˆ†äº«å’Œåˆ†å‘ã€‚&lt;/li>
&lt;li>&lt;strong>é˜²æ­¢ç“¶é¢ˆ&lt;/strong>ï¼šå¦‚æœæ²¡æœ‰è¿™ä¸ªç®—æ³•ï¼ŒæŸäº›æ•°æ®å—å¯èƒ½ä¼šå˜å¾—å¾ˆéš¾è·å¾—ï¼Œå¯¼è‡´ä¸‹è½½è¿‡ç¨‹åœ¨æ¥è¿‘å®Œæˆæ—¶æ”¾æ…¢ï¼Œè¿™è¢«ç§°ä¸ºâ€œæœ€åä¸€å—é—®é¢˜â€ï¼ˆLast Piece Problemï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>ä¿ƒè¿›å¹³ç­‰åˆ†äº«&lt;/strong>ï¼šè¿™ç§æ–¹æ³•é¼“åŠ±peeråˆ†äº«å®ƒä»¬æ‹¥æœ‰çš„ç¨€æœ‰å—ï¼Œä»è€Œæé«˜äº†æ•´ä¸ªç½‘ç»œä¸­çš„åˆä½œå’Œèµ„æºå…±äº«ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å®é™…åº”ç”¨">å®é™…åº”ç”¨ &lt;a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>åœ¨BitTorrentç½‘ç»œä¸­ï¼Œè¿™ä¸ªç®—æ³•å¯¹äºç¡®ä¿é«˜æ•ˆçš„æ•°æ®åˆ†å‘è‡³å…³é‡è¦ã€‚å®ƒä¸ä»…æé«˜äº†å•ä¸ªç”¨æˆ·çš„ä¸‹è½½é€Ÿåº¦ï¼Œè€Œä¸”è¿˜æé«˜äº†æ•´ä¸ªç½‘ç»œçš„æ•ˆç‡ï¼Œç¡®ä¿äº†èµ„æºåœ¨ç”¨æˆ·ä¹‹é—´çš„å‡è¡¡åˆ†é…ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒBitTorrentç½‘ç»œèƒ½å¤Ÿæœ‰æ•ˆåœ°é¿å…ç“¶é¢ˆå’Œæé«˜æ•°æ®çš„å¯ç”¨æ€§ï¼Œå³ä½¿åœ¨é¢å¯¹å¤§é‡ç”¨æˆ·çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç»“è®º">ç»“è®º &lt;a href="#%e7%bb%93%e8%ae%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•æ˜¯BitTorrentç½‘ç»œé«˜æ•ˆè¿è¡Œçš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚å®ƒé€šè¿‡æ™ºèƒ½åœ°é€‰æ‹©ä¸‹è½½å’Œåˆ†äº«ç½‘ç»œä¸­æœ€ç¨€æœ‰çš„æ•°æ®å—ï¼Œæé«˜äº†èµ„æºçš„æ•´ä½“åˆ†å¸ƒå’Œå¯ç”¨æ€§ï¼Œç¡®ä¿äº†å¿«é€Ÿã€å¹³è¡¡çš„æ–‡ä»¶å…±äº«ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="çª’æ¯ç®—æ³•choking-algorithm">&amp;ldquo;çª’æ¯ç®—æ³•&amp;rdquo;ï¼ˆChoking Algorithmï¼‰ &lt;a href="#%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95choking-algorithm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&amp;ldquo;çª’æ¯ç®—æ³•&amp;rdquo;ï¼ˆChoking Algorithmï¼‰æ˜¯BitTorrentåè®®ä¸­çš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºç®¡ç†å¤šä¸ªpeerä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚è¿™ä¸ªç®—æ³•å¸®åŠ©ä¼˜åŒ–å¸¦å®½çš„ä½¿ç”¨ï¼Œç¡®ä¿ç½‘ç»œä¸­çš„èµ„æºè¢«é«˜æ•ˆåˆç†åœ°åˆ†é…ã€‚å…¶æ ¸å¿ƒç›®çš„æ˜¯ä¿ƒè¿›peeré—´çš„åˆä½œå’Œæ•°æ®çš„å¿«é€Ÿåˆ†å‘ã€‚&lt;/li>
&lt;li>
&lt;h3 id="çª’æ¯ç®—æ³•çš„åŸºæœ¬åŸç†">çª’æ¯ç®—æ³•çš„åŸºæœ¬åŸç† &lt;a href="#%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>é€‰æ‹©å’Œçª’æ¯ï¼ˆChoking and Unchokingï¼‰&lt;/strong>
&lt;ul>
&lt;li>åœ¨BitTorrentç½‘ç»œä¸­ï¼Œæ¯ä¸ªpeeråŒæ—¶ç»´æŠ¤ç€ä¸€ç»„â€œçª’æ¯â€ï¼ˆchokedï¼‰å’Œâ€œæœªçª’æ¯â€ï¼ˆunchokedï¼‰çš„peeråå•ã€‚
&lt;ul>
&lt;li>è¢«â€œçª’æ¯â€çš„peeræ— æ³•ä»çª’æ¯æ–¹æ¥æ”¶æ–‡ä»¶æ•°æ®ï¼Œè€Œâ€œæœªçª’æ¯â€çš„peerå¯ä»¥è¿›è¡Œæ•°æ®äº¤æ¢ã€‚&lt;/li>
&lt;li>è¿™ç§çŠ¶æ€æ˜¯åŠ¨æ€çš„ï¼Œpeeræ ¹æ®ç®—æ³•å®šæœŸæ›´æ–°å®ƒä»¬çš„çª’æ¯/æœªçª’æ¯peeråå•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åˆ©ç›Šé©±åŠ¨çš„å†³ç­–&lt;/strong>
&lt;ul>
&lt;li>ç®—æ³•æ ¸å¿ƒæ˜¯â€œåˆ©ç›Šé©±åŠ¨â€ï¼ˆtit-for-tatï¼‰ç­–ç•¥ï¼Œå³peeræ›´å€¾å‘äºå‘é‚£äº›èƒ½ç»™å®ƒæä¾›æ•°æ®çš„peeræä¾›æ•°æ®ã€‚
&lt;ul>
&lt;li>è¿™ç§æ–¹æ³•é¼“åŠ±peeråˆ†äº«æ•°æ®ï¼Œå› ä¸ºåˆ†äº«è¶Šå¤šï¼Œè·å¾—æ•°æ®çš„æœºä¼šä¹Ÿè¶Šå¤§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ä¼˜åŒ–å™¨&lt;/strong>ï¼š
&lt;ul>
&lt;li>é™¤äº†åŸºäºäº¤æ¢æ•°æ®çš„é‡æ¥å†³å®šçª’æ¯çŠ¶æ€å¤–ï¼Œå¤§å¤šæ•°BitTorrentå®¢æˆ·ç«¯è¿˜å®ç°äº†ä¸€ä¸ªâ€œä¼˜åŒ–å™¨â€ï¼ˆOptimizerï¼‰ï¼Œç”¨äºæ¢ç´¢æ–°çš„peerã€‚
&lt;ul>
&lt;li>é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡å®šæœŸâ€œæœªçª’æ¯â€ä¸€ä¸ªéšæœºé€‰æ‹©çš„peeræ¥å®ç°çš„ï¼Œå³ä½¿å®ƒåœ¨è¿‡å»çš„æ•°æ®äº¤æ¢ä¸­è¡¨ç°ä¸ä½³æˆ–æ²¡æœ‰æ•°æ®äº¤æ¢ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>çª’æ¯å‘¨æœŸ&lt;/strong>ï¼š
&lt;ul>
&lt;li>peerå®šæœŸè¯„ä¼°å…¶è¿æ¥ï¼Œå¹¶æ ¹æ®ä»å…¶ä»–peeræ¥æ”¶åˆ°çš„æ•°æ®é€Ÿç‡æ¥æ›´æ–°å…¶çª’æ¯/æœªçª’æ¯åå•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="çª’æ¯ç®—æ³•çš„é‡è¦æ€§">çª’æ¯ç®—æ³•çš„é‡è¦æ€§ &lt;a href="#%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>åˆä½œä¿ƒè¿›&lt;/strong>ï¼šé€šè¿‡å¥–åŠ±é‚£äº›åˆ†äº«èµ„æºçš„peerï¼Œçª’æ¯ç®—æ³•é¼“åŠ±åˆä½œï¼Œæé«˜äº†ç½‘ç»œä¸­çš„èµ„æºå…±äº«æ•ˆç‡ã€‚&lt;/li>
&lt;li>&lt;strong>é˜²æ­¢è‡ªç§è¡Œä¸º&lt;/strong>ï¼šç®—æ³•å‡å°‘äº†è‡ªç§peerï¼ˆåªä¸‹è½½ä¸ä¸Šä¼ çš„ï¼‰çš„ä¼˜åŠ¿ï¼Œå› ä¸ºè¿™äº›peerä¸å¤ªå¯èƒ½è¢«å…¶ä»–peerâ€œæœªçª’æ¯â€ã€‚&lt;/li>
&lt;li>&lt;strong>ç½‘ç»œæ‹¥å¡æ§åˆ¶&lt;/strong>ï¼šå®ƒå¸®åŠ©æ§åˆ¶ç½‘ç»œæ‹¥å¡ï¼Œé€šè¿‡é™åˆ¶peerçš„è¿æ¥æ•°é‡å’Œæ•°æ®ä¼ è¾“ï¼Œä¼˜åŒ–å¸¦å®½ä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç»“è®º-1">ç»“è®º &lt;a href="#%e7%bb%93%e8%ae%ba-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>çª’æ¯ç®—æ³•æ˜¯BitTorrentåè®®é«˜æ•ˆæ€§çš„å…³é”®ï¼Œå®ƒé€šè¿‡ä¸€ç§ç®€å•ä½†æœ‰æ•ˆçš„æ–¹å¼æ¥é¼“åŠ±æ•°æ®å…±äº«å’Œåˆä½œï¼Œä¿è¯äº†æ•´ä¸ªç½‘ç»œçš„å¥åº·å’Œé«˜æ•ˆè¿è¡Œã€‚é€šè¿‡è¿™ç§åŠ¨æ€çš„çª’æ¯/æœªçª’æ¯æœºåˆ¶ï¼ŒBitTorrentç½‘ç»œèƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†å¸¦å®½å’Œè¿æ¥ï¼Œç¡®ä¿èµ„æºåœ¨ç½‘ç»œä¸­çš„å¿«é€Ÿä¸”å…¬å¹³çš„åˆ†é…ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h2 id="ä¸ºä»€ä¹ˆè¯´å·²ç»è¶³å¤Ÿäº†">ä¸ºä»€ä¹ˆè¯´â€œå·²ç»è¶³å¤Ÿäº†â€ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%af%b4%e5%b7%b2%e7%bb%8f%e8%b6%b3%e5%a4%9f%e4%ba%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;blockquote>
&lt;p>å› ä¸ºè¿™æ˜¯ä¸€é—¨å®éªŒç§‘å­¦&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;h3 id="æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•rarest-first-algorithm-1">&amp;ldquo;æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•&amp;rdquo;ï¼ˆRarest First Algorithmï¼‰ &lt;a href="#%e6%9c%80%e7%a8%80%e6%9c%89%e4%bc%98%e5%85%88%e7%ae%97%e6%b3%95rarest-first-algorithm-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>
&lt;h3 id="ç§å­çš„ç†µ">ç§å­çš„ç†µ &lt;a href="#%e7%a7%8d%e5%ad%90%e7%9a%84%e7%86%b5" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æè¿°äº†ç§å­ä¸­å„ä¸ªæ•°æ®å—åœ¨æ‰€æœ‰peeré—´çš„åˆ†å¸ƒæƒ…å†µ&lt;/li>
&lt;li>é«˜ç†µæ„å‘³ç€æ•°æ®å—åœ¨æ‰€æœ‰peerä¸­åˆ†å¸ƒå¾—å¾ˆå‡åŒ€ï¼Œpeerä¹‹é—´æ›´æœ‰å¯èƒ½æ‹¥æœ‰å½¼æ­¤å°šæœªä¸‹è½½çš„å—&lt;/li>
&lt;li>é«˜ç†µçš„ç§å­é€šå¸¸æ„å‘³ç€æ›´é«˜çš„æ•°æ®äº¤æ¢æ•ˆç‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç†æƒ³ç†µideal-entrophy">ç†æƒ³ç†µï¼ˆIdeal Entrophyï¼‰ &lt;a href="#%e7%90%86%e6%83%b3%e7%86%b5ideal-entrophy" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ˜¯æŒ‡ç½‘ç»œä¸­çš„æ•°æ®å—ï¼ˆpiecesï¼‰åœ¨æ‰€æœ‰leechersä¹‹é—´å‡åŒ€åˆ†å¸ƒ&lt;/li>
&lt;li>æ¯ä¸ªleecherséƒ½æŒæœ‰ä¸€äº›å…¶ä»–leecherséœ€è¦çš„æ•°æ®å—ï¼Œä»è€Œç¡®ä¿äº†ç½‘ç»œä¸­çš„æ¯ä¸ªleecherséƒ½å¯¹å…¶ä»–leechersæ„Ÿå…´è¶£ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="å†·å¯åŠ¨transient-state">å†·å¯åŠ¨ï¼ˆTransient Stateï¼‰ &lt;a href="#%e5%86%b7%e5%90%af%e5%8a%a8transient-state" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å½“ç§å­åˆšå¼€å§‹ä¼ æ’­æ—¶çš„åŠ¨æ€ï¼Œä¼˜å…ˆä¼ æ’­ç¨€æœ‰å—ï¼Œæé«˜ä¸‹è½½æ•ˆç‡&lt;/li>
&lt;li>Rarest First Algorithmè§£å†³äº†ç§å­çš„å†·å¯åŠ¨é—®é¢˜ï¼Œç¡®ä¿äº†æœ€ä¸å¸¸è§çš„å—è¢«ä¼˜å…ˆä¼ æ’­ï¼Œæé«˜äº†æ•´ä¸ªç½‘ç»œçš„ä¸‹è½½æ•ˆç‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="ç¨³å®šæ€steady-state">ç¨³å®šæ€ï¼ˆSteady Stateï¼‰ &lt;a href="#%e7%a8%b3%e5%ae%9a%e6%80%81steady-state" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>ç½‘ç»œä¸­çš„å¤§éƒ¨åˆ†å—å·²ç»è¢«æ¯”è¾ƒå‡åŒ€åœ°ä¼ æ’­ã€‚æœ€ç¨€æœ‰ä¼˜å…ˆç®—æ³•åœ¨è¿™ä¸€é˜¶æ®µç»§ç»­ç¡®ä¿æ•°æ®å—çš„å¤šæ ·æ€§ï¼Œä»è€Œå‡å°‘äº†ä»»ä½•ç‰¹å®šå—æˆä¸ºç“¶é¢ˆçš„å¯èƒ½æ€§&lt;/li>
&lt;li>ç®—æ³•é¼“åŠ±peeré—´çš„æœ‰æ•ˆåˆä½œï¼Œå› ä¸ºæ¯ä¸ªpeeréƒ½å¯èƒ½æŒæœ‰å…¶ä»–peeréœ€è¦çš„ç¨€æœ‰å—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="æœ€åä¸€å—é—®é¢˜last-pieces-problem">â€œæœ€åä¸€å—â€é—®é¢˜ï¼ˆLast Pieces Problemï¼‰ &lt;a href="#%e6%9c%80%e5%90%8e%e4%b8%80%e5%9d%97%e9%97%ae%e9%a2%98last-pieces-problem" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>ä¸‹è½½æ¥è¿‘å®Œæˆæ—¶ï¼ŒæŸäº›å—å˜å¾—éå¸¸ç¨€æœ‰ï¼Œä»è€Œå»¶ç¼“æ•´ä¸ªä¸‹è½½è¿‡ç¨‹&lt;/li>
&lt;li>ç®—æ³•ç¡®ä¿å³ä½¿åœ¨ä¸‹è½½çš„åæœŸï¼Œæ‰€æœ‰å‚ä¸çš„peerä»ç„¶æœ‰æ¿€åŠ±å»äº¤æ¢å½¼æ­¤ä¹‹é—´ç¼ºå°‘çš„å—&lt;/li>
&lt;li>é¿å…äº†ä¸‹è½½æœ«æœŸçš„ç¨€æœ‰å—ç“¶é¢ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="çª’æ¯ç®—æ³•choking-algorithm-1">&amp;ldquo;çª’æ¯ç®—æ³•&amp;rdquo;ï¼ˆChoking Algorithmï¼‰ &lt;a href="#%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95choking-algorithm-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>
&lt;h3 id="å¯¹ç­‰åŸåˆ™tit-for-tat-fairness">â€œå¯¹ç­‰åŸåˆ™â€ï¼ˆTit-for-tat Fairnessï¼‰ &lt;a href="#%e5%af%b9%e7%ad%89%e5%8e%9f%e5%88%99tit-for-tat-fairness" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å¦‚æœAä»Bä¸‹è½½çš„æ•°æ®å°‘äºBä»Aä¸‹è½½çš„æ•°æ®ï¼ŒAä¼šæ‹’ç»ç»§ç»­ä¸Båˆ†äº«æ•°æ®&lt;/li>
&lt;li>ç”¨æ¥ä¿è¯å…¬å¹³æ€§ï¼Œæœç»free rider&lt;/li>
&lt;li>åœ¨åŠ¨æ€æˆ–éå¯¹ç§°ç½‘ç»œç¯å¢ƒä¸­å¯èƒ½æ•ˆç‡ä½ä¸‹&lt;/li>
&lt;li>ä¼šå¯¼è‡´ç½‘ç»œç©ºé—²èµ„æºçš„æµªè´¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="æ—§ç‰ˆçª’æ¯ç®—æ³•">æ—§ç‰ˆçª’æ¯ç®—æ³• &lt;a href="#%e6%97%a7%e7%89%88%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ—§ç‰ˆçª’æ¯ç®—æ³•åªè€ƒè™‘äº†peerä¹‹é—´çš„ä¸‹è½½é€Ÿåº¦ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„ä¸Šä¼ è´¡çŒ®
&lt;ul>
&lt;li>å°‘é‡ä¸Šä¼ é€Ÿåº¦å¿«çš„leecherä¼šå æ®å¤§é‡å¸¦å®½ï¼Œä¸åˆ©äºç§å­ç†µçš„å¢åŠ &lt;/li>
&lt;li>ä¸‹è½½é€Ÿåº¦å¿«çš„free riderså¾—åˆ°äº†æ¯”å®é™…è´¡çŒ®æ›´å¤šçš„å›æŠ¥&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åŸºäºæ›´å®è§‚çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆå¦‚æ•´ä½“ä¸Šä¼ è´¡çŒ®ï¼‰çš„ç­–ç•¥èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”è¿™äº›å˜åŒ–&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;h3 id="æ–°ç‰ˆçª’æ¯ç®—æ³•">æ–°ç‰ˆçª’æ¯ç®—æ³• &lt;a href="#%e6%96%b0%e7%89%88%e7%aa%92%e6%81%af%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>ä¸Šä¼ é€Ÿåº¦å¿«çš„leecherä¸€å®šæ¯”ä¸Šä¼ é€Ÿåº¦æ…¢çš„leecherè·å¾—æ›´å¤šçš„ä¸‹è½½é€Ÿåº¦ï¼Œä¿è¯äº†è¿‘ä¼¼çš„å¯¹ç­‰åŸåˆ™&lt;/li>
&lt;li>å¯¹äºseedï¼ˆåšç§è€…ï¼‰è€Œè¨€ï¼Œåº”è¯¥å¯¹æ¯ä¸ªleecheræä¾›ç›¸åŒçš„æœåŠ¡æ—¶é—´ã€‚ä¿è¯äº†ç½‘ç»œä¸­çš„å…¬å¹³æ€§å’Œæ•ˆç‡&lt;/li>
&lt;li>å› ä¸ºæ–‡ä»¶å—å¯ä»¥è¢«æ›´å¹³å‡çš„åˆ†é…ç»™äº†å…¶å®ƒpeerï¼Œåœ¨å†·å¯åŠ¨æ—¶çš„å¼¹æ€§æ›´å¼ºï¼Œå¯¹äºfree ridersçš„æŠµæŠ—æ€§ä¹Ÿæ›´å¼º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Link
&lt;ul>
&lt;li>&lt;a href="http://conferences.sigcomm.org/imc/2006/papers/p20-legout.pdf">Rarest First and Choke Algorithms Are Enough&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">æœ¬æ–‡éƒ¨åˆ†å†…å®¹ç”±ChatGPT4ç”Ÿæˆ&lt;/div></description></item><item><title>A2B Game Solutions</title><link>https://wizmann.top/posts/a2b/</link><pubDate>Thu, 18 Nov 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/a2b/</guid><description>&lt;p>A2B is a &amp;ldquo;zach-like&amp;rdquo; programming game, which let you to use a very simple &amp;ldquo;programming language&amp;rdquo; to solve different problems for strings.&lt;/p>
&lt;p>Personally, I highly recommand this game along with &amp;ldquo;Shenzhen IO&amp;rdquo; and &amp;ldquo;Factorio&amp;rdquo; as an beginner tutorial for anyone who wants to be a software engineer.&lt;/p>
&lt;iframe src="https://store.steampowered.com/widget/1720850/" frameborder="0" width="646" height="190">&lt;/iframe>
&lt;iframe src="https://store.steampowered.com/widget/504210/" frameborder="0" width="646" height="190">&lt;/iframe>
&lt;iframe src="https://store.steampowered.com/widget/427520/" frameborder="0" width="646" height="190">&lt;/iframe>
&lt;h2 id="spoiler-alert">Spoiler Alert &lt;a href="#spoiler-alert" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>** The following article includes huge spoilers for A=B Game. **&lt;/p>
&lt;p>If you have a different solution or a better solution. Feel free to share it with a comment.&lt;/p>
&lt;h2 id="cpt1-ab">Cpt1. A=B &lt;a href="#cpt1-ab" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="1-1-a-to-b">1-1. A to B &lt;a href="#1-1-a-to-b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>a=b
&lt;/code>&lt;/pre>&lt;h3 id="1-2-uppercase">1-2. Uppercase &lt;a href="#1-2-uppercase" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>a=A
b=B
c=C
&lt;/code>&lt;/pre>&lt;h3 id="1-3-singleton">1-3. Singleton &lt;a href="#1-3-singleton" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>aa=a
bb=b
cc=c
&lt;/code>&lt;/pre>&lt;h3 id="1-4-singleton-2">1-4. Singleton 2 &lt;a href="#1-4-singleton-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>aaa=aa
aa=
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>For all substring which has more than &lt;code>n&lt;/code> &amp;lsquo;a&amp;rsquo;s, replace them with &lt;code>n-1&lt;/code> &amp;lsquo;a&amp;rsquo;s.&lt;/li>
&lt;li>For all &amp;ldquo;aa&amp;quot;s, remove them.&lt;/li>
&lt;li>For all singleton &amp;ldquo;a&amp;quot;s, keep it as-is.&lt;/li>
&lt;/ul>
&lt;h3 id="1-5-sort">1-5. Sort &lt;a href="#1-5-sort" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
cb=bc
&lt;/code>&lt;/pre>&lt;p>Bubble sort.&lt;/p>
&lt;h3 id="1-6-compare">1-6. Compare &lt;a href="#1-6-compare" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
ab=
aa=a
bb=b
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Firstly, sort the string. Make it to &amp;ldquo;aaaa&amp;hellip;aabbb&amp;hellip;bb&amp;rdquo; pattern.&lt;/li>
&lt;li>If there&amp;rsquo;s an &amp;ldquo;ab&amp;rdquo; substring in the middle, remove it.&lt;/li>
&lt;li>After that, there will be only &amp;ldquo;a&amp;rdquo; or &amp;ldquo;b&amp;rdquo; in the string.&lt;/li>
&lt;li>Remove the redundant characters to make the answer.&lt;/li>
&lt;/ul>
&lt;h2 id="cpt2-keyword">Cpt2. Keyword &lt;a href="#cpt2-keyword" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="2-1-hello-world">2-1. Hello World &lt;a href="#2-1-hello-world" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>=(return)helloworld
&lt;/code>&lt;/pre>&lt;h3 id="2-2-aaa">2-2. AAA &lt;a href="#2-2-aaa" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>aaa=(return)true
b=
c=
=(return)false
&lt;/code>&lt;/pre>&lt;h3 id="2-3-exactly-three">2-3. Exactly Three &lt;a href="#2-3-exactly-three" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>b=a
c=a
aaaa=(return)false
aaa=(return)true
=(return)false
&lt;/code>&lt;/pre>&lt;h3 id="2-4-remainder">2-4. Remainder &lt;a href="#2-4-remainder" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>b=a
c=a
aaa=
aa=(return)2
a=(return)1
=(return)0
&lt;/code>&lt;/pre>&lt;h3 id="2-5-odd">2-5. Odd &lt;a href="#2-5-odd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
cb=bc
aaa=a
bbb=b
ccc=c
aa=(return)false
bb=(return)false
cc=(return)false
=(return)true
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Sort the string to &amp;ldquo;aa&amp;hellip;aabbb&amp;hellip;bbbcc&amp;hellip;cc&amp;rdquo; pattern.&lt;/li>
&lt;li>Remove all &amp;ldquo;aaa&amp;rdquo;, &amp;ldquo;bbb&amp;rdquo;, &amp;ldquo;ccc&amp;rdquo; substring, this will keep the &lt;a href="https://en.wikipedia.org/wiki/Parity_(mathematics)">parity&lt;/a> of each characters.&lt;/li>
&lt;li>If theres &amp;ldquo;aa&amp;rdquo;, &amp;ldquo;bb&amp;rdquo; or &amp;ldquo;cc&amp;rdquo; in the remaining string, it means that there&amp;rsquo;s at least one type of character has even number of appearances.&lt;/li>
&lt;/ul>
&lt;h3 id="2-6-the-only">2-6. The Only &lt;a href="#2-6-the-only" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>aaa=aa
bbb=bb
ccc=cc
aa=X
bb=X
cc=X
a=Y
b=Y
c=Y
X=
YY=(return)false
Y=(return)true
=(return)false
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Because for substring like &amp;ldquo;aaa..aa&amp;rdquo;, all &amp;ldquo;a&amp;quot;s has at least 1 neighbour which is same to itself.&lt;/li>
&lt;li>It means we can safely replace those substrings with a delimeter, marked as &amp;ldquo;X&amp;rdquo;.&lt;/li>
&lt;li>Check if the remaining string has exactly 1 character which is not &amp;ldquo;X&amp;rdquo;.&lt;/li>
&lt;/ul>
&lt;h3 id="2-7-ascend">2-7. Ascend &lt;a href="#2-7-ascend" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-9-lines">Solution1 (9 Lines) &lt;a href="#solution1-9-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>ba=ab
cb=bc
ca=ac
b=xy
yx=xy
ax=
yc=
xc=(return)true
=(return)false
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Sort string to parttern &amp;ldquo;aa&amp;hellip;bb..cc&amp;rdquo;.&lt;/li>
&lt;li>Split every character &amp;ldquo;b&amp;rdquo; to &amp;ldquo;xy&amp;rdquo;, then sort the string to &amp;ldquo;aaa&amp;hellip;xx&amp;hellip;yy..cc&amp;rdquo;.&lt;/li>
&lt;li>Remove all the occurrences of &amp;ldquo;ax&amp;rdquo; and &amp;ldquo;yc&amp;rdquo;.&lt;/li>
&lt;li>If:
&lt;ul>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;a&amp;quot;s means &lt;code>count(a) &amp;gt; count(b)&lt;/code>&lt;/li>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;x&amp;quot;s means &lt;code>count(b) &amp;gt; count(a)&lt;/code>&lt;/li>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;y&amp;quot;s means &lt;code>count(b) &amp;gt; count(c)&lt;/code>&lt;/li>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;c&amp;quot;s means &lt;code>count(b) &amp;gt; count(b)&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Only if there&amp;rsquo;re any &amp;ldquo;xc&amp;quot;s in the remaining string, we&amp;rsquo;ll return &lt;code>true&lt;/code>.&lt;/li>
&lt;li>Otherwise, return &lt;code>false&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h4 id="solution2-8-lines">Solution2 (8 Lines) &lt;a href="#solution2-8-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
bc=cb
cb=x
cx=xc
ax=
xc=(return)true
=(return)false
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Sort string to pattern &amp;ldquo;aaa&amp;hellip;cccc&amp;hellip;bb&amp;rdquo;.&lt;/li>
&lt;li>For every occurrence of &amp;ldquo;cb&amp;rdquo;, replace it with &amp;ldquo;x&amp;rdquo;. If there&amp;rsquo;re &lt;code>n&lt;/code> &amp;ldquo;x&amp;quot;s, means there&amp;rsquo;re &lt;code>n&lt;/code> &amp;ldquo;b&amp;quot;s and &lt;code>n&lt;/code> &amp;ldquo;c&amp;quot;s.&lt;/li>
&lt;li>Move every &amp;ldquo;x&amp;rdquo; to the front of &amp;ldquo;c&amp;quot;s.&lt;/li>
&lt;li>Eliminate every &amp;ldquo;a&amp;rdquo; with adjacent &amp;ldquo;x&amp;rdquo;.&lt;/li>
&lt;li>If:
&lt;ul>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;a&amp;quot;s means &lt;code>count(a) &amp;gt; count(b)&lt;/code>&lt;/li>
&lt;li>there&amp;rsquo;re remaining &amp;ldquo;x&amp;quot;s means &lt;code>count(b) &amp;gt; count(a)&lt;/code>&lt;/li>
&lt;li>there&amp;rsquo;s no remaining &amp;ldquo;c&amp;quot;s means &lt;code>count(b) &amp;gt; count(a)&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>We match the pattern &amp;ldquo;xc&amp;rdquo; as a signal for returning &amp;ldquo;true&amp;rdquo;.&lt;/li>
&lt;li>Otherwise, return &amp;ldquo;false&amp;rdquo;.&lt;/li>
&lt;/ul>
&lt;h3 id="2-8-most">2-8. Most &lt;a href="#2-8-most" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
cb=bc
b=xy
yx=xy
ax=
yc=
ac=
a=(return)a
y=(return)b
c=(return)c
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Similar idea from 2-7.&lt;/li>
&lt;li>Sort then split, make the string like &amp;ldquo;aaa&amp;hellip;xxx..yyy&amp;hellip;ccc&amp;rdquo;.&lt;/li>
&lt;li>It&amp;rsquo;s easy to know that &lt;code>count(x) == count(y) == count(b)&lt;/code>.&lt;/li>
&lt;li>Eliminate all occurances of &amp;ldquo;ax&amp;quot;s and &amp;ldquo;yc&amp;quot;s.&lt;/li>
&lt;li>It means:
&lt;ul>
&lt;li>&lt;code>count(remaining a) = count(a) - count(b)&lt;/code> if there&amp;rsquo;re remaining &amp;ldquo;a&amp;quot;s&lt;/li>
&lt;li>&lt;code>count(remaining x) = count(b) - count(a)&lt;/code> if there&amp;rsquo;re remaining &amp;ldquo;x&amp;quot;s&lt;/li>
&lt;li>&lt;code>count(remaining y) = count(b) - count(c)&lt;/code> if there&amp;rsquo;re remaining &amp;ldquo;y&amp;quot;s&lt;/li>
&lt;li>&lt;code>count(remaining c) = count(c) - count(b)&lt;/code> if there&amp;rsquo;re remaining &amp;ldquo;c&amp;quot;s&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>If there&amp;rsquo;re only &amp;ldquo;x&amp;quot;s and &amp;ldquo;y&amp;quot;s remain, it means &amp;ldquo;b&amp;rdquo; has the largests count&lt;/li>
&lt;li>If there&amp;rsquo;re only &amp;ldquo;a&amp;quot;s or &amp;ldquo;ay&amp;quot;s remain, it means &lt;code>count(a) &amp;gt; count(b) &amp;gt;= count(c)&lt;/code>&lt;/li>
&lt;li>If there&amp;rsquo;re only &amp;ldquo;c&amp;quot;s or &amp;ldquo;xc&amp;quot;s remain, it means &lt;code>count(c) &amp;gt; count(b) &amp;gt;= count(a)&lt;/code>&lt;/li>
&lt;li>If there&amp;rsquo;re only &amp;ldquo;a&amp;quot;s and &amp;ldquo;c&amp;quot;s remain, we will eliminate all &amp;ldquo;ac&amp;quot;s, the type of character left is the final answer.&lt;/li>
&lt;/ul>
&lt;h3 id="2-9-least">2-9. Least &lt;a href="#2-9-least" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-11-lines">Solution1 (11 Lines) &lt;a href="#solution1-11-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
cb=bc
b=xy
yx=xy
ax=
yc=
xy=
ac=(return)b
x=(return)a
y=(return)c
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Similar idea from 2-8&lt;/li>
&lt;/ul>
&lt;h4 id="solution2-9-lines">Solution2 (9 Lines) &lt;a href="#solution2-9-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>ba=ab
ca=ac
cb=bc
ab=x
xb=bx
xc=
bc=(return)a
x=(return)c
ac=(return)b
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>Similar idea from 2-7, solution2&lt;/li>
&lt;/ul>
&lt;h2 id="cpt3-start-and-end">Cpt3. Start and End &lt;a href="#cpt3-start-and-end" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="3-1-remove">3-1. Remove &lt;a href="#3-1-remove" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(start)a=
(end)a=
&lt;/code>&lt;/pre>&lt;h3 id="3-2-spin">3-2. Spin &lt;a href="#3-2-spin" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(start)b=(end)b
(start)c=(end)c
&lt;/code>&lt;/pre>&lt;h3 id="3-3-a-to-b-2">3-3. A to B 2 &lt;a href="#3-3-a-to-b-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-4-lines">Solution1 (4 Lines) &lt;a href="#solution1-4-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(end)a=(start)A
(start)A=(end)b
(start)a=(end)A
(end)A=(start)b
&lt;/code>&lt;/pre>&lt;h4 id="solution2-5-lines">Solution2 (5 Lines) &lt;a href="#solution2-5-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(end)a=X
aX=XX
(start)a=X
Xa=XX
X=b
&lt;/code>&lt;/pre>&lt;h3 id="3-4-swap">3-4. Swap &lt;a href="#3-4-swap" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(start)a=(end)XXXXXXXXa
bX=(start)b
X=
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>Move all starting &amp;ldquo;a&amp;quot;s to the end of the string, and make it &amp;ldquo;XXXXXXXXa&amp;rdquo;. e.g. &lt;code>aacbbb -&amp;gt; cbbbXXXXXXXXaXXXXXXXXa&lt;/code>.&lt;/li>
&lt;li>If there&amp;rsquo;re &amp;ldquo;b&amp;quot;s at the end of the original string, it will definitely followed with &amp;ldquo;X&amp;rdquo;. So we move &amp;ldquo;bX&amp;rdquo; to the beginning of the string.&lt;/li>
&lt;li>Remove all redundant &amp;ldquo;X&amp;quot;s.&lt;/li>
&lt;/ol>
&lt;h3 id="3-5-match">3-5. Match &lt;a href="#3-5-match" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(end)aXaY=(return)true
(end)bXbY=(return)true
(end)cXcY=(return)true
(start)a=(end)XaY
(start)b=(end)XbY
(start)c=(end)XcY
=(return)false
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>Say the original string is &amp;ldquo;uv&amp;hellip;w&amp;rdquo; (&amp;ldquo;u&amp;rdquo;, &amp;ldquo;v&amp;rdquo; and &amp;ldquo;w&amp;rdquo; could be arbitrary characters among &amp;ldquo;a&amp;rdquo;, &amp;ldquo;b&amp;rdquo; and &amp;ldquo;c&amp;rdquo;).&lt;/li>
&lt;li>Firstly move the starting &amp;ldquo;u&amp;rdquo; to the end of the string, added with &amp;ldquo;X&amp;rdquo; and &amp;ldquo;Y&amp;rdquo;, i.e. &lt;code>uv...w -&amp;gt; v...wXuY&lt;/code>.&lt;/li>
&lt;li>If &amp;ldquo;wXuY&amp;rdquo; is &amp;ldquo;aXaY&amp;rdquo;, &amp;ldquo;bXbY&amp;rdquo; or &amp;ldquo;cXcY&amp;rdquo;, return &lt;code>true&lt;/code>. Otherwise, return &lt;code>false&lt;/code>.&lt;/li>
&lt;/ol>
&lt;h3 id="3-6-most-2">3-6. Most 2 &lt;a href="#3-6-most-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h3 id="solution1-12-lines">Solution1 (12 Lines) &lt;a href="#solution1-12-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
cb=bc
ca=ac
ab=(start)X
Xa=aa
X=b
bc=(start)Y
Yb=bb
Y=c
ac=(start)Z
Za=aa
Z=c
&lt;/code>&lt;/pre>&lt;h3 id="solution2-11-lines">Solution2 (11 Lines) &lt;a href="#solution2-11-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>ba=ab
cb=bc
ca=ac
ab=(start)X
Xa=aa
X=b
bc=(start)Y
Yc=cc
ac=(start)Y
Ya=aa
Y=b
&lt;/code>&lt;/pre>&lt;h3 id="3-7-palindrome">3-7. Palindrome &lt;a href="#3-7-palindrome" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-10-lines">Solution1 (10 Lines) &lt;a href="#solution1-10-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>XaX=(return)false
XbX=(return)false
XcX=(return)false
(end)aXa=
(end)bXb=
(end)cXc=
(start)a=(end)Xa
(start)b=(end)Xb
(start)c=(end)Xc
=(return)true
&lt;/code>&lt;/pre>&lt;h4 id="solution2-8-lines-1">Solution2 (8 Lines) &lt;a href="#solution2-8-lines-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(end)aXaX=
(end)bXbX=
(end)cXcX=
(start)a=(end)XaX
(start)b=(end)XbX
(start)c=(end)XcX
XX=(return)false
=(return)true
&lt;/code>&lt;/pre>&lt;h2 id="cpt4-once-upon-a-time">Cpt4. Once Upon A Time &lt;a href="#cpt4-once-upon-a-time" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="4-1-hello-2">4-1. Hello 2 &lt;a href="#4-1-hello-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(start)hello
&lt;/code>&lt;/pre>&lt;h3 id="4-2-remove-2">4-2. Remove 2 &lt;a href="#4-2-remove-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)a=
(once)a=
(once)a=
&lt;/code>&lt;/pre>&lt;h3 id="4-3-cut">4-3. Cut &lt;a href="#4-3-cut" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(start)XXX
Xa=
Xb=
Xc=
&lt;/code>&lt;/pre>&lt;h3 id="4-4-remove-3">4-4. Remove 3 &lt;a href="#4-4-remove-3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(end)XXX
bX=Xb
cX=Xc
aX=
X=
&lt;/code>&lt;/pre>&lt;h3 id="4-5-reverse">4-5. Reverse &lt;a href="#4-5-reverse" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(start)X
Xa=(end)Ya
Xb=(end)Yb
Xc=(end)Yc
aY=(start)a
bY=(start)b
cY=(start)c
&lt;/code>&lt;/pre>&lt;h3 id="4-6-reverse-2">4-6. Reverse 2 &lt;a href="#4-6-reverse-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(end)XXXXXXXXXX
aX=(end)a
bX=(end)b
cX=(end)c
X=
&lt;/code>&lt;/pre>&lt;h3 id="4-7-cut-2">4-7. Cut 2 &lt;a href="#4-7-cut-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(start)XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXDXX
Xa=(end)a
Xb=(end)b
Xc=(end)c
Da=
Db=
Dc=
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&amp;ldquo;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXDXX&amp;rdquo; = 58 * &amp;ldquo;X&amp;rdquo; + &amp;ldquo;D&amp;rdquo; + 2 * &amp;ldquo;X&amp;rdquo;.&lt;/li>
&lt;li>60 &amp;ldquo;X&amp;quot;s is the &lt;a href="https://en.wikipedia.org/wiki/Least_common_multiple">LCM&lt;/a> of all possible length of the remaing string (2, 3, 4, 5, 6)&lt;/li>
&lt;/ul>
&lt;h3 id="4-8-clone">4-8. Clone &lt;a href="#4-8-clone" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-13-lines">Solution1 (13 Lines) &lt;a href="#solution1-13-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)XXX
Ya=(end)a
Yb=(end)b
Yc=(end)c
XXXa=YaaXX
XXXb=YbbXX
XXXc=YccXX
XXa=YaaX
XXb=YbbX
XXc=YccX
Xa=Yaa
Xb=Ybb
Xc=Ycc
&lt;/code>&lt;/pre>&lt;h4 id="solution2-16-lines">Solution2 (16 Lines) &lt;a href="#solution2-16-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)XXX
Xa=(end)aA
Xb=(end)bB
Xc=(end)cC
Aa=aA
Ab=bA
Ac=cA
Ba=aB
Bb=bB
Bc=cB
Cc=cC
Cb=bC
Ca=aC
(end)A=(start)a
(end)B=(start)b
(end)C=(start)c
&lt;/code>&lt;/pre>&lt;h4 id="solution3-10-lines">Solution3 (10 Lines) &lt;a href="#solution3-10-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)X
A=(end)a
B=(end)b
C=(end)c
Xa=AaY
Xb=BbY
Xc=CcY
(once)Y=X
(once)Y=X
Y=
&lt;/code>&lt;/pre>&lt;h3 id="4-9-a-to-b-3">4-9. A to B 3 &lt;a href="#4-9-a-to-b-3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(start)X
Xa=bX
Xb=aX
Xc=cX
X=
&lt;/code>&lt;/pre>&lt;h3 id="4-10-half">4-10. Half &lt;a href="#4-10-half" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-9-lines-1">Solution1 (9 Lines) &lt;a href="#solution1-9-lines-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)X
Xa=Y
Xb=Y
Xc=Y
Ya=aX
Yb=bX
Yc=cX
Y=
X=
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&amp;ldquo;X&amp;rdquo; is the operator to remove the character.&lt;/li>
&lt;li>&amp;ldquo;Y&amp;rdquo; is the operator to keep current character and remove the next character.&lt;/li>
&lt;/ul>
&lt;h4 id="solution2-8-lines-2">Solution2 (8 Lines) &lt;a href="#solution2-8-lines-2" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)XX
XXa=X
XXb=X
XXc=X
Xa=aXX
Xb=bXX
Xc=cXX
X=
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&amp;ldquo;XX&amp;rdquo; is the operator to remove the character.&lt;/li>
&lt;li>&amp;ldquo;X&amp;rdquo; is the operator to keep current character and remove the next character.&lt;/li>
&lt;li>This could help us to save 1 line of code.&lt;/li>
&lt;/ul>
&lt;h3 id="4-11-clone-2">4-11. Clone 2 &lt;a href="#4-11-clone-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=X
(once)=(end)Z
XZ=
AY=(end)a
BY=(end)b
CY=(end)c
Xa=AYaX
Xb=BYbX
Xc=CYcX
&lt;/code>&lt;/pre>&lt;h3 id="4-12-to-b-or-not-to-b">4-12. To B or not to B &lt;a href="#4-12-to-b-or-not-to-b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)b=bX
(once)=Y
X=(start)Y
YYa=bYY
Yb=bY
Yc=cY
Ya=cY
Y=
&lt;/code>&lt;/pre>&lt;h3 id="4-13-center">4-13. Center &lt;a href="#4-13-center" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(end)Y
(start)aY=(return)a
(start)bY=(return)b
(start)cY=(return)c
aYX=Y
bYX=Y
cYX=Y
(start)a=(end)X
(start)b=(end)X
(start)c=(end)X
&lt;/code>&lt;/pre>&lt;h3 id="4-14-center-2">4-14. Center 2 &lt;a href="#4-14-center-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=Lx
(once)=(end)R
LxaR=
LxbR=
LxcR=
Lxa=aLY
Lxb=bLY
Lxc=cLY
Y=(end)x
aRx=xRa
bRx=xRb
cRx=xRc
ax=xa
bx=xb
cx=xc
&lt;/code>&lt;/pre>&lt;h3 id="4-15-expansion">4-15. Expansion &lt;a href="#4-15-expansion" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=YYYYYYXXXXXYYYYYXXXXYYYYXXXYYYXXYYXY
(once)=(end)E
Xa=aa
Xb=bb
Xc=cc
Ya=(end)a
Yb=(end)b
Yc=(end)c
XE=E
YE=E
E=
&lt;/code>&lt;/pre>&lt;h3 id="4-16-merge">4-16. Merge &lt;a href="#4-16-merge" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-10-lines-1">Solution1 (10 Lines) &lt;a href="#solution1-10-lines-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once),=XXXXXXXXXXXZ
YXX=YX
YX=
Z=(start)Y
Ya=(end)a
Yb=(end)b
Yc=(end)c
Xa=(end)aZ
Xb=(end)bZ
Xc=(end)cZ
&lt;/code>&lt;/pre>&lt;h4 id="solution2-9-lines-1">Solution2 (9 Lines) &lt;a href="#solution2-9-lines-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(start)X
(start)Xa=(end)a
(start)Xb=(end)b
(start)Xc=(end)c
Xa=(start)XaX
Xb=(start)XbX
Xc=(start)XcX
X,=
,=,X
&lt;/code>&lt;/pre>&lt;h2 id="cpt5-math">Cpt5. Math &lt;a href="#cpt5-math" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="5-1-count">5-1. Count &lt;a href="#5-1-count" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="solution1-11-lines-1">Solution1 (11 Lines) &lt;a href="#solution1-11-lines-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(end)XYXXYXXXYXXXXYXXXXXYXXXXXXY
0X=0
0Y=
1XY=(start)a
1XXY=(start)aa
1XXXY=(start)aaaa
1XXXXY=(start)aaaaaaaa
1XXXXXY=(start)aaaaaaaaaaaaaaaa
1XXXXXXY=(start)aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
aX=a
Y=
&lt;/code>&lt;/pre>&lt;h4 id="solution2-8-lines-3">Solution2 (8 Lines) &lt;a href="#solution2-8-lines-3" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(end)XYXXYXXXXYXXXXXXXXYXXXXXXXXXXXXXXXXYXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXY
0X=0
0Y=
1X=AX1
1Y=
AX=(start)a
X=
Y=
&lt;/code>&lt;/pre>&lt;h4 id="solution3-7-lines">Solution3 (7 Lines) &lt;a href="#solution3-7-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=(end)XYXXYXXXXYXXXXXXXXYXXXXXXXXXXXXXXXXYXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXY
0X=0
0Y=
1X=aX1
1Y=
aX=(start)a
Y=
&lt;/code>&lt;/pre>&lt;h4 id="solution4-5-lines">Solution4 (5 Lines) &lt;a href="#solution4-5-lines" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code>(once)=X
X1=(start)aX
X0=(start)X
Xa=aaX
X=
&lt;/code>&lt;/pre>&lt;h3 id="5-2-a--1">5-2. A + 1 &lt;a href="#5-2-a--1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>(once)=(end)X
0X=1
1X=X0
X=1
&lt;/code>&lt;/pre>&lt;h3 id="5-3-a--b">5-3. A + B &lt;a href="#5-3-a--b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Not a good solution&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>(once)+=x+x+x+x+x+x+x+x+x+z
(start)y=(end)y
(end)0y=
(end)1y=(start)1
(end)y=
0x+=(start)y|
1x+=(start)y1|
x+=(start)y|
||z=|z0
|1|z=|z1
|11|z=1|z0
|111|z=1|z1
|z=
(start)0=
&lt;/code>&lt;/pre>&lt;h3 id="5-4-a---b">5-4. A - B &lt;a href="#5-4-a---b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Not a good solution, too&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>(once)-=x-x-x-x-x-x-x-x-x-z
(start)y=(end)y
(end)0y=
(end)1y=(start)G
(end)y=
0x-=(start)y|
1x-=(start)y1|
x-=(start)y|
||z=|z0
1G=G1
G1=
|1|z=|z1
|G|z=G|z1
|G1|z=|z0
|GG|z=G|z0
|z=
|=
(start)0=
&lt;/code>&lt;/pre>&lt;h3 id="5-5-a--b">5-5. A * B &lt;a href="#5-5-a--b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>No solution yet&lt;/p>&lt;/blockquote>
&lt;h3 id="5-6-a--b">5-6. A / B &lt;a href="#5-6-a--b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>No solution yet&lt;/p>&lt;/blockquote>
&lt;h2 id="cpt6-aftermath">Cpt6. Aftermath &lt;a href="#cpt6-aftermath" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="6-1-hello-again">6-1. Hello Again &lt;a href="#6-1-hello-again" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code>c=a
b=a
aa=a
a=helloworld
&lt;/code>&lt;/pre>&lt;h3 id="6-2-palinedrome-2">6-2. Palinedrome 2 &lt;a href="#6-2-palinedrome-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>No solution yet&lt;/p>&lt;/blockquote>
&lt;h3 id="6-3-to-b-or-not-to-b-2">6-3. To B or not to B 2 &lt;a href="#6-3-to-b-or-not-to-b-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>No solution yet&lt;/p>&lt;/blockquote>
&lt;h2 id="appendix">Appendix &lt;a href="#appendix" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="proof-of-turing-completeness-explained">Proof of Turing Completeness Explained &lt;a href="#proof-of-turing-completeness-explained" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://web.stanford.edu/class/archive/cs/cs103/cs103.1176/lectures/20/Small20.pdf">Ref&lt;/a>&lt;/p>
&lt;h3 id="implement-your-own-a2b-language">Implement Your Own A2B Language &lt;a href="#implement-your-own-a2b-language" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://github.com/Wizmann/a2b-lang">Wizmann/a2b-lang&lt;/a>&lt;/p></description></item><item><title>æµ…æ·¡TCP BBR</title><link>https://wizmann.top/posts/bbr-intro/</link><pubDate>Tue, 17 Aug 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/bbr-intro/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸€å¯¹è·¨åœ°åŸŸçš„æœºå™¨ï¼ˆç¾å›½&amp;lt;-&amp;gt;é¦™æ¸¯ï¼‰ï¼Œä½¿ç”¨TCPï¼ˆCubicæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼‰é€šä¿¡throughputæœ€é«˜2MB/sï¼Œä¸¢åŒ…ç‡0.02%ã€‚ä½¿ç”¨UDPé€šä¿¡throughputæœ€é«˜èƒ½è¾¾åˆ°140MB/sã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„é•¿è‚¥ç®¡é“ï¼ˆLFNï¼‰ï¼Œå¹¶ä¸”ä¸¢åŒ…ç‡æ¯”è¾ƒé«˜ã€‚å°è¯•ä½¿ç”¨BBRç®—æ³•åï¼Œthroughputå¯è¾¾50MB/s+ï¼ˆWindowsç³»ç»Ÿï¼Œé€šä¿¡åè®®ä½¿ç”¨ç”¨æˆ·æ€MsQuicï¼‰ã€‚&lt;/p>
&lt;h2 id="loss-based-congestion-control-algorithm">Loss-based Congestion Control Algorithm &lt;a href="#loss-based-congestion-control-algorithm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Renoå’ŒCubicæ˜¯æ¯”è¾ƒç»å…¸çš„ï¼Œç”¨äºTCPçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚è¿™ä¸€ç±»ç®—æ³•ä½¿ç”¨çš„æ˜¯åŸºäºä¸¢åŒ…åé¦ˆçš„æ€æƒ³ï¼Œå³ä¸€æ—¦äº§ç”Ÿäº†ä¸¢åŒ…ï¼Œå°±è®¤ä¸ºé“¾è·¯ä¸Šäº§ç”Ÿäº†æ‹¥å¡ã€‚å…ˆå°†æ‹¥å¡çª—å£å‡åŠï¼Œå†è¿›å…¥å¿«é€Ÿæ¢å¤æ¨¡å¼ã€‚&lt;/p>
&lt;p>åœ¨å¿«é€Ÿæ¢å¤å®Œæˆåä¸­ï¼Œå°±åˆä¼šé‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-16/2021-08-16_23-07-29.png" alt="TCP-Reno-Cubic">&lt;/p>
&lt;p>Renoå½“æ”¶åˆ°ä¸€ä¸ªACKåŒ…æ—¶ï¼Œä¼šå°†æ‹¥å¡çª—å£å¢å¤§ä¸€ä¸ªMSSï¼Œçª—å£å¤§å°çº¿æ€§å¢é•¿ã€‚è€ŒCubicä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåŸºäºä¸Šæ¬¡æ‹¥å¡äº‹ä»¶äº§ç”Ÿæ—¶é—´çš„ä¸‰æ¬¡å‡½æ•°ï¼Œæ‰€ä»¥æ‹¥å¡çª—å£èƒ½æ›´å¿«é€Ÿçš„æ¢å¤åˆ°æ‹¥å¡äº‹ä»¶å‘ç”Ÿä¹‹å‰çš„å¤§å°ã€‚&lt;/p>
&lt;p>ä½†æ— è®ºæ˜¯Renoè¿˜æ˜¯Cubicï¼Œåœ¨é­é‡é«˜ä¸¢åŒ…ç‡çš„æ—¶å€™ï¼Œå…¶æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°ä¼šä¸€ç›´å¤„äºä¸€ä¸ªéå¸¸å°çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>åœ¨RTTè¾ƒå¤§æ—¶ï¼Œæ‹¥å¡çª—å£çš„å¤§å°å¢é•¿é€Ÿåº¦æ›´åŠ ç¼“æ…¢ï¼Œä½¿å¾—å¸¦å®½åˆ©ç”¨ç‡é•¿æ—¶é—´ç»´æŒåœ¨ä¸€ä¸ªè¾ƒä½çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¸‹å›¾ä¸ºCubicåœ¨æœ‰ä¸¢åŒ…ï¼ˆ0.002%, 0.02%, 0.2%, 1%, 2%ï¼‰ï¼Œé«˜å»¶æ—¶ï¼ˆ200ms RTTï¼‰çš„ç½‘ç»œæ¡ä»¶ä¸‹throughputæ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_00-18-45.png" alt="cubic-bandwidth">&lt;/p>
&lt;h2 id="bbr---congestion-based-congestion-control">BBR - Congestion-based Congestion Control &lt;a href="#bbr---congestion-based-congestion-control" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸åŒäºRenoå’ŒCubicï¼ŒBBRå¹¶æ²¡æœ‰ä½¿ç”¨â€œä¸¢åŒ…â€åšä¸ºæ‹¥å¡äº§ç”Ÿçš„ä¿¡å·ï¼Œè€Œæ˜¯æ„å»ºäº†ä¸€ä¸ªåé¦ˆç³»ç»Ÿï¼Œé€šè¿‡æ—¶å»¶çš„å˜åŒ–æ¥ç¡®å®šé“¾è·¯ä¸Šæ˜¯å¦å‘ç”Ÿäº†æ‹¥å¡ã€‚&lt;/p>
&lt;h3 id="æ‹¥å¡äº§ç”Ÿçš„ä¸‰ä¸ªé˜¶æ®µ">æ‹¥å¡äº§ç”Ÿçš„ä¸‰ä¸ªé˜¶æ®µ &lt;a href="#%e6%8b%a5%e5%a1%9e%e4%ba%a7%e7%94%9f%e7%9a%84%e4%b8%89%e4%b8%aa%e9%98%b6%e6%ae%b5" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_00-58-34.png" alt="BBR-3-stages">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>App Limited åº”ç”¨é™åˆ¶é˜¶æ®µ &lt;br>
åœ¨æ­¤é˜¶æ®µï¼Œæ•°æ®ä¼ è¾“é€Ÿç‡ç”±ç”¨æˆ·ç¨‹åºå†³å®šã€‚ç”¨æˆ·ç¨‹åºå¹¶æ²¡æœ‰åˆ©ç”¨æ‰€æœ‰çš„å¸¦å®½ï¼ŒRTTç»´æŒç¨³å®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Bandwidth Limited å¸¦å®½é™åˆ¶é˜¶æ®µ &lt;br>
åœ¨æ­¤é˜¶æ®µï¼Œæ•°æ®ä¼ è¾“é€Ÿç‡ç”±é“¾è·¯å¸¦å®½æ‰€å†³å®šï¼Œæœ‰æ•ˆååé‡ç­‰äºé“¾è·¯å¸¦å®½ã€‚ä½†ç”±äºé“¾è·¯ç¼“å­˜çš„å­˜åœ¨ï¼Œå‘é€ç«¯çš„å‘é€é€Ÿç‡å¯ä»¥ç•¥å¤§äºé“¾è·¯å¸¦å®½ã€‚æ­¤æ—¶æ•°æ®å¼€å§‹åœ¨é“¾è·¯ç¼“å­˜ä¸Šå †ç§¯ï¼ŒRTTå¢åŠ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>Buffer Limited ç¼“å†²åŒºé™åˆ¶é˜¶æ®µ &lt;br>
å½“é“¾è·¯ç¼“å­˜æ— æ³•å®¹çº³æ‰€æœ‰çš„æ•°æ®åŒ…æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸¢åŒ…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Loss-basedæ‹¥å¡æ§åˆ¶ç®—æ³•ä¼šåœ¨é˜¶æ®µ3çš„æ—¶å€™äº§ç”Ÿâ€œæ‹¥å¡â€ä¿¡å·ï¼Œä½†æ˜¯æ­¤æ—¶å¤§æ¦‚ç‡ä¸ºæ—¶å·²æ™šã€‚å› ä¸ºé“¾è·¯ç¼“å­˜å †ç§¯çš„æ•°æ®å·²ç»å¼€å§‹å½±å“RTTï¼Œå¹¶ä¸”å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç¼“å­˜å¤§å°å·®å¼‚ï¼Œè¿˜ä¼šå¯¼è‡´çŸ­æ—¶é—´å†…çš„æŒç»­ä¸¢åŒ…ï¼Œä½¿å¾—æ‹¥å¡çª—å£å¤§å°æ€¥å‰§å‡å°ã€‚&lt;/p>
&lt;p>è€ŒBBRä¼šå°†æ‹¥å¡æ§åˆ¶åœ¨é˜¶æ®µ1å’Œé˜¶æ®µ2çš„äº¤ç•Œå¤„ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§åŒ–åˆ©ç”¨å¸¦å®½ï¼Œå¹¶ä¸”ä½¿å¾—é“¾è·¯æ—¶å»¶æœ€å°ã€‚&lt;/p>
&lt;h3 id="ç¡®å®šæ‹¥å¡çª—å£çš„å¤§å°">ç¡®å®šæ‹¥å¡çª—å£çš„å¤§å° &lt;a href="#%e7%a1%ae%e5%ae%9a%e6%8b%a5%e5%a1%9e%e7%aa%97%e5%8f%a3%e7%9a%84%e5%a4%a7%e5%b0%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»ç†è®ºä¸Šåˆ†æï¼Œè¦ä½¿ä¸€æ¡è¿æ¥åŒæ—¶ä¿æŒæœ€é«˜throughputå’Œæœ€å°çš„å»¶è¿Ÿï¼Œé‚£ä¹ˆå…¶å‘é€é€Ÿç‡ä¸€å®šç­‰äºç½‘ç»œå¸¦å®½ã€‚æ­¤æ—¶ï¼Œåœ¨é€”çš„æ•°æ®å¤§å°BDP = BtlBw Ã— RTpropï¼Œå°±å¯ä»¥ç”¨æ»¡é“¾è·¯çš„å¸¦å®½è€Œä¸äº§ç”Ÿæ‹¥å¡ã€‚&lt;/p>
&lt;p>BDPæ„ä¸ºâ€œå¸¦å®½æ—¶å»¶ä¹˜ç§¯â€ã€‚è€ŒBtlBwæ„ä¸ºâ€œç“¶é¢ˆå¸¦å®½â€ï¼Œå³ä¸ºæ•´æ¡é“¾è·¯ä¸­ï¼Œå¸¦å®½æœ€å°çš„éƒ¨åˆ†ã€‚RTpropæ„ä¸ºâ€œé“¾è·¯å›ºæœ‰ä¼ è¾“å»¶è¿Ÿâ€ã€‚&lt;/p>
&lt;blockquote>
&lt;p>RTTï¼ˆå¾€è¿”æ—¶å»¶ï¼‰ä¸RTpropï¼ˆé“¾è·¯å›ºæœ‰ä¼ è¾“å»¶è¿Ÿï¼‰çš„åŒºåˆ«æ˜¯ï¼šRTTåŒ…æ‹¬äº†æ”¶å‘ä¸¤ç«¯åº”ç”¨å±‚çš„æ—¶å»¶ï¼Œè€ŒRTpropåªåŒ…å«ç½‘ç»œä¼ æ’­çš„æ—¶å»¶&lt;/p>&lt;/blockquote>
&lt;p>ä¸å‡‘å·§çš„æ˜¯ï¼Œåœ¨é€šä¿¡ä¸­æˆ‘ä»¬å‡ ä¹æ— æ³•ç›´æ¥ç¡®å®šBtlBwå’ŒRTpropã€‚BBRå»ºç«‹äº†ä¸€ä¸ªæ¨¡å‹æ¥å¯¹å…¶è¿›è¡Œä¼°è®¡ã€‚å…¬å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_10-02-28.png" alt="rtprop-hat">&lt;/p>
&lt;p>Î·ä»£è¡¨çš„æ˜¯ç½‘ç»œé˜Ÿåˆ—çš„æŠ–åŠ¨ã€æ¥æ”¶æ–¹ACKæ—¶å»¶ç­‰ç­‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-17/2021-08-17_10-04-06.png" alt="btlbw-hat">&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæ—¶å»¶ä¸å¸¦å®½æ— æ³•åŒæ—¶æ¢æµ‹ã€‚å› ä¸ºæ¢æµ‹æ—¶å»¶æ—¶ï¼Œæˆ‘ä»¬å¿…ç„¶è¦å‡æ…¢å‘åŒ…é€Ÿåº¦ï¼Œæ’ç©ºé˜Ÿåˆ—é¿å…æ‹¥å¡ï¼›è€Œæ¢æµ‹å¸¦å®½æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡å æ»¡å¸¦å®½ï¼Œä»¥æ£€æµ‹ACKé€Ÿç‡æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥æ—¶å»¶ä¸å¸¦å®½çš„æ¢æµ‹éœ€è¦äº¤æ›¿è¿›è¡Œã€‚&lt;/p>
&lt;h4 id="probertt---æ—¶å»¶æ¢æµ‹">ProbeRTT - æ—¶å»¶æ¢æµ‹ &lt;a href="#probertt---%e6%97%b6%e5%bb%b6%e6%8e%a2%e6%b5%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>BBRæ¯10ç§’é’Ÿä¼šè¿›å…¥æ—¶å»¶æ¢æµ‹çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼ŒBBRä¼šé™åˆ¶æ‹¥å¡çª—å£çš„å¤§å°åˆ°4ä¸ªMSSï¼ˆ&lt;a href="https://blog.csdn.net/dog250/article/details/72042516">ä¸ºä»€ä¹ˆï¼Ÿ&lt;/a>ï¼‰ã€‚å½“æ”¶åˆ°ACKåŒ…åï¼Œä¼šæ›´æ–°MinRTTçš„å–æ ·å€¼ã€‚&lt;/p>
&lt;h4 id="probebw---å¸¦å®½æ¢æµ‹">ProbeBW - å¸¦å®½æ¢æµ‹ &lt;a href="#probebw---%e5%b8%a6%e5%ae%bd%e6%8e%a2%e6%b5%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>BBRå¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¼šå¤„äºProbeBWçŠ¶æ€ã€‚&lt;/p>
&lt;p>BBRé€šè¿‡è®¡ç®—åŒ…çš„å‘é€æ—¶é—´ä¸æ”¶åˆ°ACKæ—¶é—´çš„å·®æ¥ç¡®å®šå¸¦å®½ï¼Œä½¿ç”¨â€œé€è¾¾é€Ÿåº¦â€æ¥æ‹Ÿåˆå¸¦å®½ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/6b0dcc0d2f7b2446ea0c3ca6faec29da6f28dc7e/wizmann-pic/21-08-17/image.png" alt="bw-probe-pacing">&lt;/p>
&lt;p>åŒæ—¶ï¼ŒBBRä¼šé‡‡ç”¨gain cycleæ¥éšæœºå¾®è°ƒï¼ˆ+25%, -25%, ä¸å˜ï¼‰å‘é€é€Ÿç‡ï¼Œä»¥å®æ—¶æ£€æµ‹é“¾è·¯ä¸Šå¸¦å®½çš„å˜åŒ–ã€‚ï¼ˆå›¾ä¸­çš„ç»¿çº¿çœ‹èµ·æ¥åƒå¿ƒç”µå›¾çš„éƒ¨åˆ†ï¼‰&lt;/p>
&lt;h3 id="æ€§èƒ½æ¯”è¾ƒ">æ€§èƒ½æ¯”è¾ƒ &lt;a href="#%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é‡Œæ˜¯Cubicä¸BBRåœ¨æœ‰ä¸¢åŒ…ï¼ˆ0.002%, 0.02%, 0.2%, 1%, 2%ï¼‰ï¼Œé«˜å»¶æ—¶ï¼ˆ200ms RTTï¼‰çš„ç½‘ç»œæ¡ä»¶ä¸‹çš„throughputå¯¹æ¯”ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/8a78e8e7c7193f4bf5d6de01997f21491f3794ab/wizmann-pic/21-08-17/Snipaste_2021-08-17_14-54-21.png" alt="perf-bbr-cubic">&lt;/p>
&lt;h2 id="æ‚é¡¹">æ‚é¡¹ &lt;a href="#%e6%9d%82%e9%a1%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ä½¿ç”¨tcå‘½ä»¤æ¨¡æ‹Ÿä¸åŒçš„ç½‘ç»œçŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚100mså»¶è¿Ÿï¼ˆRTT=2*å»¶è¿Ÿï¼‰ï¼Œ1%ä¸¢åŒ…ç‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo tc qdisc add dev lo root handle 1:0 netem delay 100msec loss 1%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨Windowsä¸‹å¯ä»¥ä½¿ç”¨&lt;a href="http://jagt.github.io/clumsy/">Clumsy&lt;/a>è¿›è¡Œæ¨¡æ‹Ÿï¼Œä½†æ˜¯æœ‰æ€€ç–‘å…¶ä¼šä¸¥é‡å½±å“ç½‘ç»œæ€§èƒ½ï¼Œæ•ˆæœæœ‰å¾…è¿›ä¸€æ­¥æµ‹è¯•ã€‚&lt;/p>
&lt;p>åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›¿æ¢ç³»ç»Ÿcongestion controlç®—æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv4.tcp_congestion_control&lt;span style="color:#f92672">=&lt;/span>cubic
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv4.tcp_congestion_control&lt;span style="color:#f92672">=&lt;/span>bbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="references">References &lt;a href="#references" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://juejin.cn/post/6844904065759969287">æµ…è°ˆTCP/IPä¼ è¾“å±‚TCP BBRç®—æ³•&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/CUBIC_TCP">CUBIC TCP&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://queue.acm.org/detail.cfm?id=3022184">BBR: Congestion-Based Congestion Control&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/facebookincubator/mvfst">facebookincubator/mvfst&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://blog.csdn.net/dog250/article/details/72042516">ä½¿ç”¨TCPæ—¶åºå›¾è§£é‡ŠBBRæ‹¥å¡æ§åˆ¶ç®—æ³•çš„å‡ ä¸ªç»†èŠ‚&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>è®ºæ–‡é˜…è¯»-WiscKeyï¼šSSDå‹å¥½çš„KVåˆ†ç¦»å­˜å‚¨å¼•æ“</title><link>https://wizmann.top/posts/paper-wisckey/</link><pubDate>Sun, 15 Aug 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paper-wisckey/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åŸºäºlsm-treeçš„å­˜å‚¨å¼•æ“">åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ &lt;a href="#%e5%9f%ba%e4%ba%8elsm-tree%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Log-Structed Merge-Tree (a.k.a. LSM-Tree)æ˜¯å½“ä¸‹å¸¸ç”¨çš„ä¸€ç§åŸºäºç£ç›˜çš„å­˜å‚¨å¼•æ“ã€‚ä¸Hashç´¢å¼•å’ŒB-TreeåŒä¸ºæ•°æ®åº“æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;p>LSM-Treeçš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>æ— éœ€å°†æ‰€æœ‰çš„Keyç´¢å¼•åœ¨å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡åˆ†çº§æŸ¥æ‰¾çš„æ–¹å¼ï¼ŒæŸ¥è¯¢åˆ°ç‰¹å®šKVåœ¨ç£ç›˜ä¸­çš„åç§»é‡&lt;/li>
&lt;li>æ•°æ®å†™å…¥ä¸åˆå¹¶ä½¿ç”¨é¡ºåºè¿½åŠ å†™ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨ç£ç›˜çš„é¡ºåºå†™æ€§èƒ½&lt;/li>
&lt;li>å¯¹äºæ•°æ®å†™å…¥ï¼Œä¼šä½¿ç”¨batchæ–¹å¼å†™å…¥ç£ç›˜&lt;/li>
&lt;li>æ”¯æŒèŒƒå›´æŸ¥è¯¢&lt;/li>
&lt;/ol>
&lt;p>LSM-Treeçš„åŠ£åŠ¿åœ¨äºï¼š&lt;/p>
&lt;ol>
&lt;li>è¯»æ”¾å¤§ä¸å†™æ”¾å¤§&lt;/li>
&lt;li>æ— æ³•å¯¹å•æ¡æ•°æ®åŠ é”ï¼ˆäº‹åŠ¡æ”¯æŒï¼‰&lt;/li>
&lt;/ol>
&lt;p>ç°åœ¨å¸¸ç”¨çš„LevelDBå’ŒRocksDBï¼Œéƒ½æ˜¯åŸºäºLSM-Treeçš„å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_18-00-50.png" alt="LSM-Tree-Architecture">&lt;/p>
&lt;h3 id="wisckeyä¸»è¦è§£å†³çš„é—®é¢˜">WiscKeyä¸»è¦è§£å†³çš„é—®é¢˜ &lt;a href="#wisckey%e4%b8%bb%e8%a6%81%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>LSM-Treeåœ¨æ€§èƒ½ä¸Šé¢çš„ç“¶é¢ˆä¸»è¦åœ¨äºè¯»å†™çš„æ”¾å¤§ã€‚ç®€å•è¯´æ¥ï¼Œå‡è®¾ä½ çš„ç£ç›˜æœ€å¤§å¸¦å®½ä¸º4GB/sï¼Œè¯»å†™æ”¾å¤§å€æ•°ä¸º10ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨å±‚çš„æœ‰æ•ˆååé‡ï¼ˆ&lt;a href="https://en.wikipedia.org/wiki/Goodput">Goodput&lt;/a>ï¼‰æœ€å¤šåªèƒ½è¾¾åˆ°400MB/sã€‚å¹¶ä¸”ï¼Œå¯¹äºä¸€äº›å¤§æ•°æ®é›†ï¼Œè¯»å†™æ”¾å¤§çš„å€¼æœ‰å¯èƒ½ä¼šéå¸¸å¤§ï¼ˆå¤§äº100ï¼‰ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„è¯»å†™æ”¾å¤§å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹é¢åˆ†å¼€è®¨è®ºã€‚&lt;/p>
&lt;h4 id="è¯»æ”¾å¤§">è¯»æ”¾å¤§ &lt;a href="#%e8%af%bb%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹LSM-Treeçš„æŸ¥è¯¢æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆåœ¨mutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>ç„¶ååœ¨immutable memtableä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;li>æœ€ååœ¨ä¸åŒçš„LSM-Treeå±‚çº§ä¸­çš„SST fileä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;/ol>
&lt;p>å¯¹äº1å’Œ2ï¼Œéƒ½æ˜¯å†…å­˜æ“ä½œï¼Œå…¶è€—æ—¶ä¸è¯»å–ç£ç›˜ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚
å¯¹äº3ï¼ŒSST fileæ–‡ä»¶çš„æŸ¥æ‰¾ä¼šå…ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å®šä½ç‰¹å®šKVä½äºè¯¥å±‚çš„å“ªä¸€ä¸ªSSTæ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVä¸å­˜åœ¨äºæ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šè¢«å¸¸é©»å†…å­˜çš„bloom filterè¿‡æ»¤æ‰ï¼Œä¸ä¼šçœŸæ­£çš„è¯»å–æ–‡ä»¶ã€‚ï¼ˆå¤§æ¦‚ç‡ï¼Œbloom filterçš„åŸç†äº†è§£ä¸€ä¸‹ï¼‰&lt;/p>
&lt;p>å¦‚æœç‰¹å®šçš„KVåœ¨æ­¤SSTæ–‡ä»¶ä¸­ï¼Œä¼šé€šè¿‡index blockè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œç¡®å®šKVä½äºå“ªä¸ªblockã€‚ç„¶åè¿™ä¸ªblockä¼šè¢«ä»ç£ç›˜ä¸Šè¯»å–åˆ°å†…å­˜è¿›è¡Œè§£å‹ï¼Œæœ€åé€šè¿‡äºŒåˆ†+éå†æ‰¾åˆ°å¯¹åº”çš„KVã€‚&lt;/p>
&lt;blockquote>
&lt;p>è®ºæ–‡é‡Œå¯¹äºè¯»æ”¾å¤§çš„è®¡ç®—æ–¹æ³•æœ‰ç‚¹å¤¸å¤§äº†ã€‚å¯¹äºRocksDBæ¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹index blockå’Œbloom filteréƒ½æ˜¯å¸¸é©»å†…å­˜çš„ã€‚é™¤éæ˜¯å†…å­˜éå¸¸ç´§å¼ çš„åœºæ™¯ï¼Œå¦åˆ™å¹¶ä¸ä¼šäº§ç”Ÿè®ºæ–‡ä¸­å¦‚æ­¤å¤¸å¼ çš„ç£ç›˜è¯»æ”¾å¤§çš„ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥è¯»æ”¾å¤§ä¸»è¦å› ä¸ºè¯»å–ä¸€ä¸ªKVï¼Œéœ€è¦è¯»å–+è§£å‹æ•´ä¸ªblockã€‚å½“KVå¤§å°è¿œå°äºblock sizeçš„æ—¶å€™ï¼Œé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ã€‚&lt;/p>
&lt;h4 id="å†™æ”¾å¤§">å†™æ”¾å¤§ &lt;a href="#%e5%86%99%e6%94%be%e5%a4%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬å†é‡æ¸©ä¸€ä¸ªLSM-Treeçš„å†™å…¥æœºåˆ¶ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆå†™å…¥mutable memtable&lt;/li>
&lt;li>mutable memtableåç»­ä¼šè¢«sealedï¼Œæˆä¸ºimmutable memtable&lt;/li>
&lt;li>immutable memtableä¼šè¢«flushåˆ°ç£ç›˜ï¼Œæˆä¸ºL0&lt;/li>
&lt;li>L0ä¸­çš„æ•°æ®ä¼šåœ¨åå°ï¼Œé€å±‚å‘ä¸‹åˆå¹¶ï¼Œç›´åˆ°åˆå¹¶åˆ°æœ€åº•å±‚&lt;/li>
&lt;/ol>
&lt;p>å±‚æ¬¡æ•°æ®é€å±‚å‘ä¸‹åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚ï¼ˆå…·ä½“åŸç†è¿™é‡Œä¸å±•å¼€äº†ï¼‰&lt;/p>
&lt;p>å†™æ”¾å¤§å€¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¼°ç®—ã€‚å·²çŸ¥&lt;code>options.max_bytes_for_level_multiplier&lt;/code>ä»£è¡¨æ¯ä¸€å±‚å¤§å°çš„å€æ•°kï¼Œå¹¶ä¸”å‡è®¾L0ä¸L1çš„å¤§å°ç›¸ç­‰ï¼Œæ€»å…±æœ‰Nå±‚ã€‚é‚£ä¹ˆå†™æ”¾å¤§çº¦ä¸º&lt;code>(N - 1) * k + 1&lt;/code>ã€‚&lt;/p>
&lt;h2 id="æ­£æ–‡">æ­£æ–‡ &lt;a href="#%e6%ad%a3%e6%96%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å…¥æ´»äº†å…¥æ´»äº†ï¼&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡ç›®æ ‡">WiscKeyçš„è®¾è®¡ç›®æ ‡ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>é™ä½å†™æ”¾å¤§&lt;/li>
&lt;li>é™ä½è¯»æ”¾å¤§&lt;/li>
&lt;li>å¯¹SSDè¿›è¡Œä¼˜åŒ–&lt;/li>
&lt;li>æä¾›LSM-Treeå…¼å®¹çš„API&lt;/li>
&lt;li>é’ˆå¯¹ç°å®åœºæ™¯çš„KV size&lt;/li>
&lt;/ul>
&lt;h3 id="wisckeyçš„è®¾è®¡æ€è·¯kvåˆ†ç¦»">WiscKeyçš„è®¾è®¡æ€è·¯â€”â€”KVåˆ†ç¦» &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%afkv%e5%88%86%e7%a6%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€èˆ¬çš„åœºæ™¯ä¸­ï¼Œåœ¨ä¸€å¯¹KVä¸­ï¼ŒKeyçš„å¤§å°è¿œæ¯”Valueçš„è¦å°ã€‚å¦‚æœæˆ‘ä»¬åœ¨LSM-Treeä¸­åªä¿ç•™Keyï¼Œé‚£ä¹ˆå¯¹äºä¸€æ¬¡è¯»å†™ï¼Œæˆ‘ä»¬æ‰€è¦å¤„ç†çš„æ•°æ®å°±ä¼šå°‘å¾ˆå¤šï¼Œä»è€Œé™ä½äº†è¯»å†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>å¯¹äºValueï¼Œæˆ‘ä»¬ä¼šå°†å…¶å­˜å‚¨åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„vLogä¸­ã€‚æ¯ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šåœ¨LSM-Treeä¸­è®°å½•å…¶åœ¨vLogä¸­çš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code> ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯»å–Valueçš„æ“ä½œä¹Ÿåªæœ‰ä¸€æ¬¡ç£ç›˜è®¿é—®ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿå†™æ”¾å¤§ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-08-54.png" alt="WiscKey-data-layout">&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœæŒ‰è®ºæ–‡é‡Œé¢çš„è®¾è®¡ï¼ŒvLogé‡Œé¢çš„æ•°æ®æ˜¯ä¸ä¼šæ‰“åŒ…çš„blockè¿›è¡Œå‹ç¼©çš„ï¼Œå¿…ç„¶ä¼šæŸå¤±capacityã€‚å¦‚æœæ‰“åŒ…å‹ç¼©äº†ï¼Œé‚£ä¹ˆè¯»æ”¾å¤§å¹¶æ²¡æœ‰æ˜¾è‘—ä¼˜åŒ–ã€‚åˆå¦‚æœvalue size â‰ˆ block sizeï¼Œé‚£ä¹ˆå…¶å®åœ¨è¯»æ”¾å¤§ä¸Šé¢çš„ä¼˜åŒ–ä¹Ÿå°±æ¯”è¾ƒå¾®å¼±äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="wisckeyçš„è®¾è®¡æŒ‘æˆ˜">WiscKeyçš„è®¾è®¡æŒ‘æˆ˜ &lt;a href="#wisckey%e7%9a%84%e8%ae%be%e8%ae%a1%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="å¹¶å‘èŒƒå›´æŸ¥æ‰¾">å¹¶å‘èŒƒå›´æŸ¥æ‰¾ &lt;a href="#%e5%b9%b6%e5%8f%91%e8%8c%83%e5%9b%b4%e6%9f%a5%e6%89%be" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å› ä¸ºä½¿ç”¨äº†KVåˆ†ç¦»çš„å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥æ‰¾ï¼ˆrange queryï¼‰å¯¹äºvalueå°±ä¼šé€€åŒ–æˆå¾ˆå¤šæ¬¡éšæœºè¯»å–ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç”±äºSSDçš„å¹¶å‘è¯»å–ç‰¹æ€§ï¼ŒWiscKeyä¼šå°†æ‰€éœ€è¦è¯»å–çš„valueçš„&lt;code>&amp;lt;offset, length&amp;gt;&lt;/code>æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å–æ‰€éœ€è¦çš„valueã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-14/2021-08-14_23-42-44.png" alt="seq-rand-reads-on-ssd">&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œå¯¹äºè¾ƒå¤§çš„value sizeï¼Œé¡ºåºè¯»ä¸å¹¶å‘è¯»çš„throughputåŸºæœ¬ä¿æŒä¸€è‡´ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¤šçº¿ç¨‹å¹¶å‘è¯»ä¼šæ¶ˆè€—æ›´å¤šçš„CPUã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_16-02-21.png" alt="CPU-usage">&lt;/p>
&lt;blockquote>
&lt;p>ä¸è¿‡å¯¹äºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼ŒCPUå¤§æ¦‚æ˜¯æœ€ä¸é‡è¦çš„èµ„æºäº†å§ï¼ˆè§ä»è§æ™ºå’¯ï¼‰&lt;/p>&lt;/blockquote>
&lt;h4 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶ &lt;a href="#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¯¹äºé‡å¤å†™å…¥çš„KVï¼ŒLSM-Treeä¼šé€šè¿‡å±‚æ¬¡åˆå¹¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚è€ŒWiscKeyä¼šä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶æ¥å°†æ—§å€¼æ¢å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_00-11-06.png" alt="vlog-data-layout">&lt;/p>
&lt;p>vLogå¯ä»¥è§†ä½œä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ŒheadæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„å¼€å¤´ï¼ˆè¾ƒæ–°çš„æ•°æ®ï¼‰ï¼ŒtailæŒ‡é’ˆè¡¨ç¤ºæ•°æ®çš„ç»“å°¾ï¼ˆè¾ƒæ—§çš„æ•°æ®ï¼‰ã€‚åœ¨headå’ŒtailæŒ‡é’ˆä¹‹å¤–çš„ç©ºé—´éƒ½è§†ä½œfree spaceã€‚&lt;/p>
&lt;p>å½“ç©ºé—²æ•°æ®å°äºä¸€å®šé˜ˆå€¼ä¹‹åï¼Œä¼šè§¦å‘GCã€‚WiscKeyä¼šä»tailä¾æ¬¡è¯»å‡ºä¸€éƒ¨åˆ†æ—§æ•°æ®ï¼ˆbatch readï¼‰ï¼ŒæŸ¥è¯¢LSM-Treeï¼Œå¦‚æœè¿™æ¡æ•°æ®å·²ç»è¢«è¦†ç›–æˆ–åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒæ­¤æ•°æ®ï¼›å¦åˆ™ä»headæŒ‡é’ˆå¤„å†™å…¥æ­¤æ¡æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¿è¯åœ¨GCè¿‡ç¨‹ä¸­çš„crashä¸äº§ç”Ÿæ•°æ®çš„ä¸¢å¤±ï¼ŒGCçš„æµç¨‹ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>å°†tailå¤„çš„KVå†™å…¥åˆ°headå¤„ï¼Œå¹¶è°ƒç”¨&lt;code>fsync()&lt;/code>å°†å…¶æŒä¹…åŒ–&lt;/li>
&lt;li>åŒæ­¥çš„å°†KVçš„æ–°ä½ç½®ï¼Œå’Œhead/tailæŒ‡é’ˆçš„æœ€æ–°ä½ç½®å†™å…¥LSM-Tree&lt;/li>
&lt;/ol>
&lt;p>ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†LSM-Treeçš„WALï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰åœ¨LSM-Treeé‡Œçš„æ•°æ®éƒ½æ˜¯å¯ç”¨çš„ã€‚&lt;/p>
&lt;h4 id="å´©æºƒä¸€è‡´æ€§crash-consistency">å´©æºƒä¸€è‡´æ€§ï¼ˆCrash Consistencyï¼‰ &lt;a href="#%e5%b4%a9%e6%ba%83%e4%b8%80%e8%87%b4%e6%80%a7crash-consistency" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨åƒåœ¾å›æ”¶ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»é‡åˆ°äº†ä¸€è‡´æ€§çš„é—®é¢˜ã€‚å…¶æ ¹æœ¬åŸå› ï¼Œåœ¨äºLSM-Treeå’ŒvLogæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¨¡å—ï¼Œåœ¨å…¶é—´ä¿æŒä¸€è‡´æ€§å¿…ç„¶æ˜¯å›°éš¾çš„ã€‚&lt;/p>
&lt;p>WiscKeyä½¿ç”¨äº†ç°ä»£æ–‡ä»¶ç³»ç»Ÿï¼ˆext4ï¼Œbtrfså’Œxfsï¼‰çš„ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§ï¼Œå³å¯¹äºä¸€ä¸ªï¼ˆå°†è¦ï¼‰å†™å…¥æ–‡ä»¶çš„æ•°æ®æµï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šä¿è¯è¿™ä¸ªæ•°æ®æµçš„ä¸€ä¸ªå‰ç¼€ï¼ˆæˆ–è€…æ•´ä¸ªæ•°æ®æµï¼‰æˆåŠŸå†™å…¥æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„ä¼˜åŒ–">WiscKeyçš„ä¼˜åŒ– &lt;a href="#wisckey%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="vlogå†™å…¥buffer">vLogå†™å…¥Buffer &lt;a href="#vlog%e5%86%99%e5%85%a5buffer" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/21-08-15/2021-08-15_12-20-02.png" alt="impact-of-write-unit-size">&lt;/p>
&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç£ç›˜çš„åŒæ­¥å†™å…¥å¿…ç„¶ä¼šå¸¦æ¥ä¸€äº›overheadã€‚å¯¹äºå°æ•°æ®æ¥è¯´ï¼Œè¿™åœ¨æ€§èƒ½ä¸Šä¼šäº§ç”Ÿä¸¥é‡çš„æŸè€—ã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„ä¼˜åŒ–ç±»ä¼¼äºå°†vLogä¹Ÿæ·»åŠ ä¸€ä¸ªmemory tableï¼Œæ‰€æœ‰å†™å…¥vLogçš„æ•°æ®éƒ½å…ˆå†™å…¥è¿™ä¸ªmemory tableï¼Œç„¶åä¾æ¬¡flushåˆ°ç£ç›˜ä¸Šã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä¼˜åŠ¿åœ¨äºå°†å†™å…¥batchåŒ–ï¼Œå¯ä»¥å‡å°‘overheadï¼Œæå‡æ€§èƒ½ã€‚åŠ£åŠ¿åœ¨äºï¼Œåœ¨ç³»ç»Ÿå´©æºƒæ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ã€‚ä½†ä¸¢å¤±æ•°æ®æ—¶ï¼Œä»èƒ½æŠ±è¯ä¸Šæ–‡æåˆ°çš„å´©æºƒä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h4 id="ä¼˜åŒ–lsm-tree-wal">ä¼˜åŒ–LSM-Tree WAL &lt;a href="#%e4%bc%98%e5%8c%96lsm-tree-wal" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>LSM-Treeçš„WALè™½ç„¶ä¿è¯äº†å†™å…¥çš„æ•°æ®çš„æŒä¹…æ€§ï¼Œä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œå®ƒä¹Ÿä¼šæ¶ˆè€—ç£ç›˜çš„ä¸€éƒ¨åˆ†å¸¦å®½ã€‚&lt;/p>
&lt;p>å…³é—­WALï¼Œæ„å‘³ç€LSM-Tree memtableåœ¨è¿›ç¨‹é‡å¯æ—¶ä¸€å®šä¼šä¸¢å¤±æ•°æ®ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨vLogé‡å»ºLSM-Treeï¼ˆçš„memtableéƒ¨åˆ†ï¼‰ã€‚&lt;/p>
&lt;p>ç”±äºvLogä¹‹ä¸­å·²ç»åŒ…æ‹¬äº†æ‰€æœ‰çš„KVå¯¹ï¼Œæ‰€ä»¥åœ¨WiscKeyé‡å¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»headæŒ‡é’ˆå¤„æ‰«ævLogçš„æ•°æ®ï¼Œç”±äºå´©æºƒä¸€è‡´æ€§çš„ä¿è¯ï¼Œå½“æŒ‡é’ˆæ‰«æåˆ°å·²ç»å­˜åœ¨äºLSM-Treeçš„æ•°æ®æ—¶ï¼Œå¯ä»¥è®¤ä¸ºLSM-Treeå·²ç»é‡å»ºæˆåŠŸã€‚&lt;/p>
&lt;h4 id="æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–">æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ– &lt;a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>WiscKeyä½¿ç”¨&lt;code>posix_fadvice()&lt;/code>å‘OSå±‚é¢„å£°æ˜æ¥ä¸‹æ¥vLogçš„æ“ä½œç±»å‹ä»¥é€‚åº”ä¸åŒåœºæ™¯çš„ç£ç›˜è®¿é—®æ¨¡å¼ã€‚ä½¿ç”¨&lt;code>fallocate()&lt;/code>ï¼Œé€šè¿‡&amp;quot;hole-punching&amp;quot;åŠŸèƒ½è¿›è¡ŒGCï¼Œä»¥å‡å°‘æ•°æ®çš„ç§»åŠ¨ã€‚&lt;/p>
&lt;h3 id="wisckeyçš„æ€§èƒ½">WiscKeyçš„æ€§èƒ½ &lt;a href="#wisckey%e7%9a%84%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è®ºæ–‡çš„æœ€åç»™å‡ºäº†ä¸€ç³»åˆ—æ•°å­—ã€‚ç”±äºWiscKeyçš„è¯»å†™æ”¾å¤§å¾ˆå°ï¼Œæ‰€ä»¥åœ¨value sizeæ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼ˆ&amp;gt;= 1KBï¼‰ï¼Œæ€§èƒ½è¿œä¼˜äºä¼ ç»ŸLSM-Treeã€‚åŒæ—¶ï¼Œç£ç›˜ç©ºé—´çš„ä½¿ç”¨ä¹Ÿæ›´å‹å¥½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œè®ºæ–‡é‡Œåšmicrobenchmarkçš„æ—¶å€™ï¼Œå¯¹äºLevelDBå’ŒRocksDBï¼Œæ˜¯ä¸æ˜¯è¿˜å¼€ç€å‹ç¼©ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>WiscKeyåº”è¯¥æ˜¯â€œLSM-Tree + KVåˆ†ç¦»â€æ€è·¯çš„æ¯”è¾ƒæ—©æœŸçš„è®ºæ–‡ï¼Œå…¶ä¸­ä»æœ‰å¾ˆå¤šä¸æ˜ç¡®çš„ç»†èŠ‚ã€‚ä½†æ˜¯æ•´ä½“æ€è·¯æ˜¯å¯è¡Œçš„ã€‚&lt;/p>
&lt;p>PingCAPçš„&lt;a href="https://pingcap.com/zh/blog/titan-design-and-implementation">Titan&lt;/a>æ˜¯ä¸€ä¸ªåŸºäºWiscKeyæ€æƒ³çš„RocksDB KVåˆ†ç¦»å­˜å‚¨å¼•æ“ã€‚åç»­å¯ä»¥å‚è€ƒå…¶å®ç°å†äº†è§£æ›´å¤šçš„å®ç°æ€è·¯ä¸ç»†èŠ‚ã€‚&lt;/p></description></item><item><title>åˆ©ç”¨Arduinoåˆ¶ä½œè„šè¸æ¿Fnå±‚å¼€å…³</title><link>https://wizmann.top/posts/arduino-foot-pedal-for-fn-layer/</link><pubDate>Thu, 08 Apr 2021 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/arduino-foot-pedal-for-fn-layer/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¹‹å‰ç„Šäº†ä¸¤ä¸ªå®¢åˆ¶åŒ–é”®ç›˜ï¼Œä¸€ä¸ªæ˜¯ErgoDoneï¼Œä¸€ä¸ªæ˜¯ä»¿minilaé…åˆ—çš„60é”®ç›˜ã€‚è¿™ä¸¤ä¸ªé”®ç›˜çš„å…±åŒç‰¹ç‚¹æ˜¯åŒæ‰‹å¤§æ‹‡æŒ‡å„æœ‰ä¸€ä¸ªé¢å¤–çš„å¼€å…³ï¼Œæˆ‘å°†å…¶åšä¸ºFnå±‚çš„å¼€å…³ï¼Œç”¨æ¥å¼€å¯ä¸¤ä¸ªfnå±‚ï¼šVimå’ŒNumPadï¼ˆæ˜¯å•¥å¹¶ä¸é‡è¦ï¼Œå¯ä»¥ç†è§£ä¸ºåŠŸèƒ½é”®çš„é‡æ˜ å°„ï¼‰ã€‚&lt;/p>
&lt;p>è¿™ä¸¤æŠŠé”®ç›˜éƒ½æ˜¯Cherryçº¢è½´ã€‚æœ€è¿‘æƒ³æŠŠä¹‹å‰çš„é…·å†·æ‰°æ°‘é’è½´87é”®ç”¨èµ·æ¥ï¼Œä½†æ˜¯å› ä¸ºå®ƒæ˜¯æ ‡å‡†é…åˆ—ï¼Œæ‰€ä»¥æ²¡æœ‰Fné”®ã€‚é‡æ–°ç„Šä¸€æŠŠæ–°é”®ç›˜æˆ–è€…æ¢è½´åˆå¤ªè´µäº†ã€‚æ‰€ä»¥æƒ³ç”¨è½¯ç¡¬ç»“åˆçš„æ–¹æ³•ï¼Œé¢å¤–åšä¸¤ä¸ªè„šè¸æ¿æŒ‰é”®ï¼Œç”¨æ¥æ§åˆ¶ç›¸åº”çš„Fnå±‚ã€‚&lt;/p>
&lt;h2 id="æ‰€éœ€è¦çš„é›¶ä»¶">æ‰€éœ€è¦çš„é›¶ä»¶ &lt;a href="#%e6%89%80%e9%9c%80%e8%a6%81%e7%9a%84%e9%9b%b6%e4%bb%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>ä¸€æŠŠæ­£(yang)å¸¸(jian)é…åˆ—çš„é”®ç›˜&lt;/li>
&lt;li>Arduino Pro Micro ï¼ˆTBï¼Œ25åŒ…é‚®ï¼Œå¤§æ¦‚ä¹°è´µäº†ï¼‰&lt;/li>
&lt;li>ä¸¤ä¸ªè„šè¸æ¿ï¼ˆTBï¼Œ23ä¸¤ä¸ªåŒ…é‚®ï¼‰&lt;/li>
&lt;li>ä¸€æ ¹USB 2.0å…¬æ¯çº¿ï¼ˆPDDï¼Œ3å—é’±ã€‚ç”¨æ¥åˆ†ç¦»è„šè¸æ¿å¼€å…³å’Œé¢åŒ…æ¿ï¼‰&lt;/li>
&lt;li>å°å·é¢åŒ…æ¿ä¸€ä¸ªï¼ˆTBï¼Œ5å—ï¼‰&lt;/li>
&lt;li>1ä¸ª1Kæ¬§çš„ç”µé˜»ï¼ˆæˆæœ¬ä¸è®¡ï¼Œæˆ‘ç”¨äº†ä¸¤ä¸ªï¼‰&lt;/li>
&lt;li>ä¸€äº›è·³çº¿å’Œå¯¼çº¿ï¼ˆæˆæœ¬ä¸è®¡ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="ç”µè·¯è®¾è®¡">ç”µè·¯è®¾è®¡ &lt;a href="#%e7%94%b5%e8%b7%af%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/blob/df8691c2f4385919f024b7200a875485a8d0fb8b/wizmann-tk-pic/Snipaste_2021-04-08_00-23-08.png?raw=true" alt="circuit">&lt;/p>
&lt;blockquote>
&lt;p>ç”»å›¾ç½‘ç«™ä¸Šåªæœ‰Arduino Unoï¼Œè¿™é‡Œéœ€è¦Arduino Leonardoæˆ–è€…Arduino Pro Microä»¥æ”¯æŒé”®ç›˜æ¨¡æ‹Ÿ&lt;/p>&lt;/blockquote>
&lt;p>åƒæˆ‘ä¸Šé¢è¯´çš„ï¼Œå¯ä»¥åªä½¿ç”¨ä¸€ä¸ªä¸‹æ‹‰ç”µé˜»ã€‚æˆ‘ä¸ºäº†è·³çº¿å¥½çœ‹ï¼Œå°±ç”¨äº†ä¸¤ä¸ªã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/blob/abaecd1c3cc70e5860fb459345686eae18245580/wizmann-tk-pic/WeChat%20Image_20210408004402.jpg?raw=true" alt="realworld">&lt;/p>
&lt;p>ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;#34;Keyboard.h&amp;#34;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> F18_Pin &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> F19_Pin &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> RXLED &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">17&lt;/span>; &lt;span style="color:#75715e">// The RX LED has a defined Arduino pin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> TXLED &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>; &lt;span style="color:#75715e">// The TX LED has a defined Arduino pin
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> KEY_COUNT &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> PINS[&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> {F18_Pin, F19_Pin};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> LEDS[&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> {RXLED, TXLED};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MAPPED_KEYS[&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">0xF5&lt;/span>, &lt;span style="color:#ae81ff">0xF6&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> previousButtonState[&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> {HIGH, HIGH};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">setup&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> KEY_COUNT; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">pinMode&lt;/span>(PINS[i], INPUT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// initialize control over the keyboard:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Keyboard.&lt;span style="color:#a6e22e">begin&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">pinMode&lt;/span>(RXLED, OUTPUT); &lt;span style="color:#75715e">// Set RX LED as an output
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">pinMode&lt;/span>(TXLED, OUTPUT); &lt;span style="color:#75715e">// Set TX LED as an output
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">loop&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// read the pushbutton:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> KEY_COUNT; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> buttonPin &lt;span style="color:#f92672">=&lt;/span> PINS[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> buttonState &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">digitalRead&lt;/span>(buttonPin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (previousButtonState[i] &lt;span style="color:#f92672">!=&lt;/span> buttonState) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (buttonState &lt;span style="color:#f92672">==&lt;/span> HIGH) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//Keyboard.press(MAPPED_KEYS[i]);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Keyboard.&lt;span style="color:#a6e22e">press&lt;/span>(MAPPED_KEYS[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">digitalWrite&lt;/span>(LEDS[i], LOW);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Keyboard.&lt;span style="color:#a6e22e">release&lt;/span>(MAPPED_KEYS[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">digitalWrite&lt;/span>(LEDS[i], HIGH);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// save the current button state for comparison next time:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> previousButtonState[i] &lt;span style="color:#f92672">=&lt;/span> buttonState;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">delay&lt;/span>(&lt;span style="color:#ae81ff">100&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç…§ç€ç¤ºä¾‹ä»£ç æ”¹çš„ï¼Œç®€å•çš„å¾ˆï¼Œæœ‰æ‰‹å°±è¡Œã€‚&lt;/p>
&lt;h2 id="æ¥çº¿è®¾è®¡">æ¥çº¿è®¾è®¡ &lt;a href="#%e6%8e%a5%e7%ba%bf%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä½¿ç”¨äº†æ¥çº¿ç«¯å­è¿æ¥å¯¼çº¿ï¼Œä¼˜ç‚¹æ˜¯æ–¹ä¾¿ï¼Œç¼ºç‚¹æ˜¯éš¾çœ‹ï¼Œè€å¤§ä¸€å¨ï¼Œè¿˜ä¸ä¸€å®šç¨³å½“ã€‚åé¢ä¼šè€ƒè™‘ç”¨é«˜çº§ä¸€ç‚¹çš„æ¥çº¿æ–¹æ³•ã€‚&lt;/p>
&lt;p>è¿˜å‰ªäº†ä¸€æ ¹USB2.0å…¬æ¯çº¿ï¼Œç”¨æ¥åšâ€œé”®çº¿åˆ†ç¦»â€ã€‚å› ä¸ºUSB2.0é‡Œé¢æœ‰å››æ ¹çº¿ï¼Œä¸¤ä¸ªè„šè¸æ¿å¼€å…³å…±ç”¨GNDçº¿ï¼Œæ­£æå„ç”¨ä¸€æ ¹ï¼Œè¿˜æœ‰ä¸€æ ¹å¯Œè£•ã€‚å…¶å®ä¹Ÿå¯ä»¥ç”¨éŸ³é¢‘çº¿ã€‚&lt;/p>
&lt;h2 id="è½¯ä»¶è®¾è®¡">è½¯ä»¶è®¾è®¡ &lt;a href="#%e8%bd%af%e4%bb%b6%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºæˆ‘ä»¬å¹¶æ²¡æœ‰ä¿®æ”¹æ­£å¸¸é”®ç›˜çš„é…åˆ—ï¼Œæ‰€ä»¥éœ€è¦ç”¨è½¯ä»¶æ–¹æ³•æ¥å¯¹Fnå±‚è¿›è¡Œé‡æ˜ å°„ã€‚&lt;/p>
&lt;p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªè„šè¸æ¿å¼€å…³åˆ†åˆ«è¢«æ˜ å°„åˆ°äº†F18å’ŒF19ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æŠŠè¿™ä¸¤ä¸ªé”®å½“ä½œFnï¼Œä½¿ç”¨AutoHotKeyåˆ¶ä½œFnå±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ahk" data-lang="ahk">&lt;span style="display:flex;">&lt;span>#MaxHotkeysPerInterval &lt;span style="color:#ae81ff">1000&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>#NoEnv&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>#UseHook On&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>#SingleInstance force&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>#InstallKeybdHook&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>SendMode Input&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>F18::Return&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19::Return&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> h&lt;span style="color:#f92672">::&lt;/span>SendInput {Left}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> j&lt;span style="color:#f92672">::&lt;/span>SendInput {Down}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> k&lt;span style="color:#f92672">::&lt;/span>SendInput {Up}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> l&lt;span style="color:#f92672">::&lt;/span>SendInput {Right}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> a&lt;span style="color:#f92672">::&lt;/span>SendInput {Home}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> e&lt;span style="color:#f92672">::&lt;/span>SendInput {End}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> x&lt;span style="color:#f92672">::&lt;/span>SendInput {Delete}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> d&lt;span style="color:#f92672">::&lt;/span>SendInput {PgDn}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> m&lt;span style="color:#f92672">::&lt;/span>SendInput {AppsKey}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> u&lt;span style="color:#f92672">::&lt;/span>SendInput {PgUp}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> i&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> if &lt;span style="color:#a6e22e">GetKeyState&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;LShift&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;P&amp;#34;&lt;/span>)&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> SendInput &lt;span style="color:#f92672">+&lt;/span>{&lt;span style="color:#a6e22e">Insert&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> else&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> SendInput {&lt;span style="color:#a6e22e">Insert&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> return&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> b&lt;span style="color:#f92672">::&lt;/span>SendInput {Backspace}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F19 &lt;span style="color:#f92672">&amp;amp;&lt;/span> w&lt;span style="color:#f92672">::&lt;/span>SendInput &lt;span style="color:#f92672">^&lt;/span>{w}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F1}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F2}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F3}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F4}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F5}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F6}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F7}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F8}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F9}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {F10}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#f92672">-::&lt;/span>SendInput {F11}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#f92672">=::&lt;/span>SendInput {F12}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> a&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">1&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> s&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">2&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> d&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">3&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> f&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">4&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> g&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">5&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> h&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">6&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> j&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">7&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> k&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">8&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> l&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">9&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">`;&lt;/span>&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">0&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> q&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#f92672">!&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> w&lt;span style="color:#f92672">::&lt;/span>SendInput {@}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> e&lt;span style="color:#f92672">::&lt;/span>SendInput {#}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> r&lt;span style="color:#f92672">::&lt;/span>SendInput {$}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> t&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#ae81ff">`%&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> y&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#f92672">^&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> u&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#f92672">&amp;amp;&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> i&lt;span style="color:#f92672">::&lt;/span>SendInput {&lt;span style="color:#f92672">*&lt;/span>}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> o&lt;span style="color:#f92672">::&lt;/span>SendInput {(}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>F18 &lt;span style="color:#f92672">&amp;amp;&lt;/span> p&lt;span style="color:#f92672">::&lt;/span>SendInput {)}&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç ç®€å•ç²—æš´ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åˆè¦é‡å­¦æ‰“å­—äº†ï¼Œé™¤äº†ç”¨æ‰‹ä¹‹å¤–ï¼Œè¿˜è¦ç”¨è„šã€‚ã€‚ã€‚&lt;/p>
&lt;p>æ„Ÿè§‰è‡ªå·±ç¨‹åºå‘˜å½“ä¸ä¸‹å»ä¹‹åï¼Œå¯ä»¥å»ç”µå­å‚ä¸Šç­äº†ï¼ˆåšæ¢¦&lt;/p></description></item><item><title>æˆ‘åˆ°åº•ä»UW-CSE341å­¦åˆ°äº†ä»€ä¹ˆ</title><link>https://wizmann.top/posts/uw-cse341-au20/</link><pubDate>Tue, 29 Dec 2020 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/uw-cse341-au20/</guid><description>&lt;blockquote>
&lt;p>TL;DR ä»€ä¹ˆä¹Ÿæ²¡å­¦åˆ°&lt;/p>&lt;/blockquote>
&lt;p>&lt;a href="https://sites.google.com/cs.washington.edu/cse341au20/home">è¯¾ç¨‹é¦–é¡µ&lt;/a>&lt;/p>
&lt;p>Coursera-è¯¾ç¨‹-&lt;a href="https://www.coursera.org/learn/programming-languages">A&lt;/a>, &lt;a href="https://www.coursera.org/learn/programming-languages-part-b">B&lt;/a>, &lt;a href="https://www.coursera.org/learn/programming-languages-part-c">C&lt;/a>&lt;/p>
&lt;p>ä»‹ç»å½“ä¸­è¯´ï¼Œæœ¬è¯¾ç¨‹ä¸»è¦å†…å®¹æ˜¯FPï¼Œå¹¶ä¸”é¡ºé“è®¨è®ºä¸€ä¸‹ç¨‹åºè¯­è¨€çš„è®¾è®¡ã€‚&lt;/p>
&lt;p>UWå®˜æ–¹ä¸Šé¢çš„è¯¾ç¨‹åªæœ‰Slideså’Œassignmentsï¼Œvideoä¸æä¾›ã€‚Courseraæœ‰videoï¼Œä½†æ˜¯ç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œæ˜¯2013å¹´çš„ã€‚ä¸‹é¢çš„è®¨è®ºéƒ½æ˜¯åŸºäºau20çš„æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ç®€å•æ¥è¯´ï¼Œå‰åŠå­¦æœŸï¼ˆhw1-hw4)æ˜¯å…³äºOCamlï¼Œä¸€ç§é™æ€ç±»å‹çš„FPã€‚ååŠå­¦æœŸ(hw5-hw7)æ˜¯Racketï¼Œä¸€ç§åŠ¨æ€è¯­è¨€FPã€‚è¯¾ç¨‹é‡Œé¢80%+ï¼ˆçš„éš¾åº¦ï¼‰éƒ½åœ¨äºæ–°çš„FPç¼–ç¨‹è¯­è¨€ï¼ŒåªåŒ…å«å°‘æ•°PLçš„å†…å®¹ã€‚ä¾‹å¦‚HW4ä¸­ï¼Œéœ€è¦å®è·µä¸€ä¸ªç®€å•ç²—æš´çš„tokenizer/parserï¼›HW6å®ç°äº†ä¸€ä¸ªè™šå‡çš„ç¼–ç¨‹è¯­è¨€MUPLï¼Œè¿™ä¸ªå®ç°å¹¶ä¸éœ€è¦ä½ è§£æä»£ç ï¼Œè€Œæ˜¯æ‰‹å†™è§£æå¥½çš„è¯­æ³•æ ‘ï¼Œåœ¨ä¸Šé¢å®ç°æ±‚å€¼ã€é—­åŒ…ã€é€’å½’ç­‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è°ƒè¯•ä¸debugä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸è›‹ç–¼çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯Racketå†™é—­åŒ…çš„æ—¶å€™ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;p>å­¦ä¹ å»ºè®®ï¼š&lt;/p>
&lt;ol>
&lt;li>OCamlçš„éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œ7å¤©ä¸€ä¸ªå°é•¿å‡å°±å¯ä»¥æå®šã€‚åšä¸ºå¹³æ—¶çš„å¨±ä¹è°ƒå‰‚ä¹Ÿå¯ä»¥ï¼Œå‘¨æœŸä¸ä¼šè¶…è¿‡ä¸€ä¸ªæœˆã€‚&lt;/li>
&lt;li>å¦‚æœä¸æƒ³ä½¿ç”¨OCamlï¼Œå¯ä»¥å°è¯•F#ã€‚å› ä¸ºéƒ½æ˜¯ä¸€ä¸ªæµæ´¾çš„ï¼Œè¯­æ³•æ¥è¿‘ã€‚ä½¿ç”¨VSè¿˜å¯ä»¥æœ‰å®æ—¶çš„æç¤ºã€‚&lt;/li>
&lt;li>Racketçš„éƒ¨åˆ†éš¾åº¦è¾ƒå¤§ï¼Œä¸»è¦æ˜¯ä¸å¹³æ—¶æ‰€ä½¿ç”¨çš„è¯­è¨€å·®åˆ«è¾ƒå¤§ã€‚æ²¡å•¥å¥½åŠæ³•ï¼Œåªèƒ½å¤šæ‰“logã€‚&lt;/li>
&lt;li>HW7éš¾åº¦ä¸é«˜ï¼Œä½†æ˜¯æä¾›çš„ä»£ç é‡Œé¢æœ‰ä¸€ä¸ªåœ¨æ„é€ å‡½æ•°é‡Œé¢Callè™šå‡½æ•°çš„è¿·æƒ‘æ“ä½œã€‚&lt;/li>
&lt;li>å¤šå†™æµ‹è¯•ã€‚&lt;/li>
&lt;/ol>
&lt;p>Repoåœ°å€ï¼šhttps://github.com/Wizmann/UW-CSE341-au20&lt;/p>
&lt;p>ä»…ä¾›å‚è€ƒã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ„Ÿè°¢åå¤§ï¼ˆ&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-12-29/2020-12-29_16-42-28.png" alt="">&lt;/p></description></item><item><title>Introduction to Ceph</title><link>https://wizmann.top/posts/introduction-to-ceph/</link><pubDate>Sun, 29 Nov 2020 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/introduction-to-ceph/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯ceph">ä»€ä¹ˆæ˜¯Ceph &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afceph" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Cephæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚æä¾›äº†ä¸‰ç§ä¸åŒç±»å‹çš„æ¥å£ä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>block-based: å—å­˜å‚¨ï¼Œå¯ä»¥ç”¨åšVMçš„è™šæ‹Ÿç£ç›˜&lt;/li>
&lt;li>object-based: å¯¹è±¡å­˜å‚¨ï¼Œä¸Amazon S3ç­‰å¸¸ç”¨å¯¹è±¡å­˜å‚¨å…¼å®¹&lt;/li>
&lt;li>file system: POSIXå…¼å®¹çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥è¢«æœ¬åœ°ç³»ç»ŸæŒ‚è½½ï¼Œå¹¶ä¸”èƒ½è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-04-49.png" alt="">&lt;/p>
&lt;h3 id="cephçš„ç‰¹æ€§">Cephçš„ç‰¹æ€§ &lt;a href="#ceph%e7%9a%84%e7%89%b9%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºé‡‡ç”¨äº†CRUSHç®—æ³•ï¼ŒCephæœ‰ç€ä¼˜å¼‚çš„å¯æ‰©å±•æ€§ï¼ˆå®£ç§°å¯ä»¥æ— é™æ‰©å±•ï¼‰ã€‚å¹¶ä¸”å€ŸåŠ©å¯æ‰©å±•æ€§ï¼Œè¿›è€Œå®ç°é«˜æ€§èƒ½ã€é«˜å¯é æ€§å’Œé«˜å¯ç”¨æ€§ã€‚&lt;/p>
&lt;p>Cephæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„å­˜å‚¨ç³»ç»Ÿï¼Œæ— éœ€ä¸­å¿ƒèŠ‚ç‚¹è¿›è¡Œèµ„æºçš„ç®¡ç†ä¸è°ƒåº¦ï¼Œå…¨éƒ¨çš„ç®¡ç†åŠŸèƒ½ç”±å­˜å‚¨èŠ‚ç‚¹è‡ªæ²»å®Œæˆã€‚ä½¿å¾—æ•´ä¸ªç³»ç»Ÿå¯ä»¥è‡ªæˆ‘ç®¡ç†ä¸è‡ªæˆ‘æ¢å¤ï¼Œå‡å°‘è¿ç»´æˆæœ¬ä¸ç®¡ç†æˆæœ¬ã€‚&lt;/p>
&lt;h2 id="rados---cephçš„å­˜å‚¨å¼•æ“">RADOS - Cephçš„å­˜å‚¨å¼•æ“ &lt;a href="#rados---ceph%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>RADOS=Reliable Autonomic Distributed Object Storeã€‚RADOSæ˜¯Cephåº•å±‚çš„å­˜å‚¨å¼•æ“ï¼Œæ‰€æœ‰çš„æ¥å£éƒ½å»ºç«‹åœ¨RADOSçš„åŠŸèƒ½ä¹‹ä¸Šã€‚&lt;/p>
&lt;h3 id="radosä¸­çš„å­˜å‚¨ç»“æ„">RADOSä¸­çš„å­˜å‚¨ç»“æ„ &lt;a href="#rados%e4%b8%ad%e7%9a%84%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-24-56.png" alt="">&lt;/p>
&lt;ul>
&lt;li>å­˜å‚¨æ± ï¼ˆpoolï¼‰ï¼šé€»è¾‘å±‚ï¼Œæ¯ä¸€ä¸ªpoolé‡Œéƒ½åŒ…å«ä¸€äº›æ”¾ç½®ç»„&lt;/li>
&lt;li>æ”¾ç½®ç»„ï¼ˆplacement-group, PG)ï¼šé€»è¾‘å±‚ï¼Œä¸€ä»½æ•°æ®ä¼šåœ¨PGå½“ä¸­è¿›è¡Œç¾å¤‡å¤åˆ¶ã€‚æ¯ä¸€ä¸ªPGéƒ½å¯¹åº”ç€ä¸€ç³»åˆ—çš„å­˜å‚¨èŠ‚ç‚¹&lt;/li>
&lt;li>å­˜å‚¨èŠ‚ç‚¹ï¼ˆOSDï¼‰ï¼šç”¨ä»¥å­˜å‚¨æ•°æ®çš„ç‰©ç†èŠ‚ç‚¹ã€‚ä¸PGä¹‹é—´å½¢æˆå¤šå¯¹å¤šçš„å…³ç³»ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä»½æ•°æ®åœ¨å†™å…¥RADOSæ—¶ï¼Œä¼šå…ˆé€‰ä¸­ä¸€ä¸ªpoolã€‚Poolä¸­å†ä½¿ç”¨ä¸€å®šçš„hashè§„åˆ™ï¼Œä¼ªéšæœºçš„é€‰ä¸­æŸä¸€ä¸ªPGã€‚PGä¼šå°†æ•°æ®å†™å…¥å¤šä¸ªOSDä¸­ã€‚è¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„è§„åˆ™ã€‚&lt;/p>
&lt;p>Poolæ˜¯ç”¨æˆ·å¯è§çš„ç®¡ç†æ•°æ®çš„åŸºæœ¬å•ä½ï¼Œç”¨æˆ·å¯ä»¥å¯¹Poolè¿›è¡Œä¸€ç³»åˆ—çš„é…ç½®ï¼ˆæƒé™æ§åˆ¶ã€ä½¿ç”¨SSD or HDDã€ä½¿ç”¨æ•°æ®æ‹·è´ or çº åˆ ç ï¼Œetc.ï¼‰ã€‚è€ŒPGä¸OSDå¯¹äºç”¨æˆ·æ˜¯ä¸å¯è§çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_23-00-51.png" alt="">&lt;/p>
&lt;h4 id="pgçš„ç»„ç»‡">PGçš„ç»„ç»‡ &lt;a href="#pg%e7%9a%84%e7%bb%84%e7%bb%87" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨ä¸€è‡´æ€§å“ˆå¸Œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨èŠ‚ç‚¹æ¥åˆ’åˆ†å“ˆå¸Œå€¼åŸŸã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœäº§ç”Ÿäº†æ•°æ®ä¸å¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è¿›è¡Œåˆ’åˆ†å€¼åŸŸæ¥è¿›è¡Œå†å¹³è¡¡ã€‚è¿™ä¼šé€ æˆå¤§é‡çš„æ•°æ®è¿ç§»ã€‚&lt;/p>
&lt;p>CRUSHé‡‡ç”¨äº†è™šæ‹ŸèŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯PGï¼‰å°†å“ˆå¸Œå€¼åŸŸåˆ’åˆ†æˆäº†å›ºå®šçš„ç­‰é•¿åŒºåŸŸã€‚è¿™ç§æ–¹æ³•åœ¨å•æ¡æ•°æ®ä¸ç‰©ç†èŠ‚ç‚¹ä¹‹é—´åŠ å…¥äº†ä¸€ä¸ªè™šæ‹Ÿå±‚ã€‚ä¹‹åï¼Œå†ä½¿ç”¨å“ˆå¸Œå–æ¨¡çš„ç®—æ³•ç¡®å®šæ•°æ®å±äºå“ªä¸ªPGã€‚ä½¿å¾—æ•°æ®çš„è¿ç§»æ˜¯ä»¥è™šæ‹ŸèŠ‚ç‚¹ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸€æ¡æ•°æ®éƒ½é‡æ–°è®¡ç®—ã€‚Cephå®˜æ–¹çš„å»ºè®®æ˜¯ï¼Œæ¯1ä¸ªOSDå¯¹åº”ç€100ä¸ªPGã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨è§„åˆ’çš„åˆæœŸéœ€è¦ç¡®å®šPGçš„æ•°ç›®ï¼Œå¦‚æœåæœŸéœ€è¦è°ƒæ•´PGï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œç”šè‡³éœ€è¦æœåŠ¡æš‚æ—¶åœæ­¢æœåŠ¡ã€‚&lt;/p>
&lt;h3 id="ç›‘æ§å­é›†ç¾¤monä¸cluster-map">ç›‘æ§å­é›†ç¾¤ï¼ˆMONï¼‰ä¸Cluster Map &lt;a href="#%e7%9b%91%e6%8e%a7%e5%ad%90%e9%9b%86%e7%be%a4mon%e4%b8%8ecluster-map" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-28/2020-11-28_22-48-10.png" alt="">&lt;/p>
&lt;p>RADOSé›†ç¾¤ä¸­é™¤äº†OSDå­˜å‚¨èŠ‚ç‚¹ä¹‹å¤–ï¼Œè¿˜æœ‰ç›‘æ§å­é›†ç¾¤ï¼ˆMONï¼‰ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿçš„æ‹“æ‰‘ç»“æ„â€”â€”Cluster Mapã€‚&lt;/p>
&lt;blockquote>
&lt;p>å…ƒæ•°ç»„ç®¡ç†ï¼ˆMDSï¼‰èŠ‚ç‚¹ç”¨äºç®¡ç†CephFSä¸­çš„æ–‡ä»¶å…ƒä¿¡æ¯ï¼Œåæ–‡ä¼šæœ‰ä»‹ç»ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ä¸åŒäºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–ç®¡ç†èŠ‚ç‚¹ï¼ŒMONå¹¶ä¸ä¼šå¯¹èµ„æºè¿›è¡Œè°ƒé…ä¸è°ƒåº¦ï¼Œè€Œä»…ä»…æ˜¯ä¸€ä¸ªè§‚æµ‹è€…ï¼Œç”¨ä»¥å­˜å‚¨ç³»ç»Ÿå½“å‰çš„æ‹“æ‰‘ä¸çŠ¶æ€ã€‚&lt;/p>
&lt;p>MONä¸OSDã€OSDä¸OSDä¹‹é—´ä¼šå®šæ—¶å‘é€å¿ƒè·³åŒ…ï¼Œæ£€æµ‹OSDæ˜¯å¦å¥åº·ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹å¤±æ•ˆï¼ŒMONä¼šæ›´æ–°å†…éƒ¨å­˜å‚¨çš„æ‹“æ‰‘ç»“æ„ä¿¡æ¯ï¼ˆClusterMapï¼‰ï¼Œå¹¶ä¸”é€šè¿‡P2Påè®®å¹¿æ’­å‡ºå»ï¼Œä»è€Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿéƒ½æœ‰ç€ï¼ˆæœ€ç»ˆï¼‰ä¸€è‡´çš„æ‹“æ‰‘ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="ä¸»ä»åŒæ­¥ä¸èŠ‚ç‚¹è‡ªæ²»">ä¸»ä»åŒæ­¥ä¸èŠ‚ç‚¹è‡ªæ²» &lt;a href="#%e4%b8%bb%e4%bb%8e%e5%90%8c%e6%ad%a5%e4%b8%8e%e8%8a%82%e7%82%b9%e8%87%aa%e6%b2%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€ä¸ªPGä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ•°æ®å¤åˆ¶ï¼ˆreplicationï¼‰ã€å¤±æ•ˆæ£€æµ‹ï¼ˆfailure detectionï¼‰å’Œå¤±æ•ˆæ¢å¤ï¼ˆfailure recoveryï¼‰ã€‚&lt;/p>
&lt;h2 id="crush---cephçš‡å† ä¸Šçš„æ˜ç ">CRUSH - Cephçš‡å† ä¸Šçš„æ˜ç  &lt;a href="#crush---ceph%e7%9a%87%e5%86%a0%e4%b8%8a%e7%9a%84%e6%98%8e%e7%8f%a0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>CRUSHæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œä¼ªéšæœºçš„æ•°æ®æ”¾ç½®ç®—æ³•ã€‚ä»¥å»ä¸­å¿ƒåŒ–æ–¹æ³•ï¼Œå°†PGæŒ‰è§„åˆ™æ˜ å°„åˆ°ç›¸åº”çš„å­˜å‚¨è®¾å¤‡ä¸Šã€‚å¹¶ä¸”ç³»ç»Ÿçš„æ‹“æ‰‘ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°½å¯èƒ½çš„å‡å°‘æ•°æ®çš„è¿ç§»ã€‚&lt;/p>
&lt;h3 id="crushçš„ä¼˜åŠ¿">CRUSHçš„ä¼˜åŠ¿ &lt;a href="#crush%e7%9a%84%e4%bc%98%e5%8a%bf" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CRUSHå¯¹äºæ¯ä¸€ä¸ªæ•°æ®å…ƒç´ ä½¿ç”¨ä¸€ä¸ªä¼ªéšæœºç®—æ³•ï¼Œå†³å®šå…¶æ”¾ç½®çš„ä½ç½®ã€‚æ‰€ä»¥ï¼Œåªè¦æ‰€æœ‰å‚ä¸è€…éƒ½æ‹¥æœ‰ç›¸åŒçš„ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ä¿¡æ¯ï¼Œé‚£ä¹ˆæ•°æ®çš„ä½ç½®å°±æ˜¯ä¸€å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œé‡‡ç”¨P2Pçš„æ–¹æ³•æ¥è¿›è¡Œæ•°æ®çš„å­˜å‚¨ä¸æ£€ç´¢ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ï¼Œç”±äºä¼ªéšæœºç®—æ³•åªä¸å•ä¸ªPGç›¸å…³ï¼Œå¦‚æœæˆ‘ä»¬æ“ä½œå¾—å½“ï¼ŒèŠ‚ç‚¹æ•°é‡çš„å˜åŒ–å¹¶ä¸ä¼šå¼•èµ·å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œè€Œæ˜¯ä¼šæ¥è¿‘ç†è®ºæœ€ä¼˜å€¼ã€‚&lt;/p>
&lt;h3 id="æ•°æ®æ”¾ç½®data-placement">æ•°æ®æ”¾ç½®ï¼ˆData Placementï¼‰ &lt;a href="#%e6%95%b0%e6%8d%ae%e6%94%be%e7%bd%aedata-placement" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CRUSHçš„æ•°æ®æ”¾ç½®ç®—æ³•æœ‰å¾ˆå¤šä¸åŒçš„å®ç°ï¼Œè¿™é‡Œåªä»‹ç»æœ€å¸¸ç”¨çš„strawç®—æ³•ã€‚&lt;/p>
&lt;p>Cephä¸­ï¼Œæ¯ä¸€ä¸ªOSDèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼wï¼Œä»£è¡¨ç€æŸä¸ªèŠ‚ç‚¹èƒ½æ”¯æŒå¤šå°‘æ•°æ®çš„å­˜å‚¨ä¸æ£€ç´¢ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæƒå€¼ä¸èŠ‚ç‚¹çš„å®¹é‡æˆæ­£æ¯”ã€‚&lt;/p>
&lt;p>å‡è®¾ä¸€ä¸ªpoolé‡Œé¢æœ‰nä¸ªPGï¼Œåœ¨ä¸€æ¡æ–°çš„æ•°æ®å†™å…¥æ—¶ï¼Œæˆ‘ä»¬åˆ†åˆ«ä¼šè®¡ç®—è¿™nä¸ªPGçš„lengthå€¼ã€‚&lt;/p>
&lt;p>$$ length_{i} = f(w_{i}) * hash(x) $$&lt;/p>
&lt;p>$f(w_{i})$æ˜¯ä¸€ä¸ªåªäºå½“å‰OSDèŠ‚ç‚¹æƒå€¼æœ‰å…³çš„å‡½æ•°ã€‚$hash(x)$ä»£è¡¨å½“å‰PGçš„å“ˆå¸Œå€¼ã€‚æ‰€ä»¥ï¼ŒPGä¼šæ”¾ç½®åœ¨å“ªä¸ªOSDä¸Šï¼Œä»…ä¸å…¶æƒå€¼ç›¸å…³ã€‚&lt;/p>
&lt;p>å‡è®¾æŸä¸ªOSDèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ–°åŠ ã€åˆ é™¤ã€æƒå€¼å˜åŒ–ï¼‰ï¼Œåœ¨æ­¤å—å½±å“èŠ‚ç‚¹çš„æ•°æ®ä¼šè¿ç§»åˆ°å…¶å®ƒçš„OSDèŠ‚ç‚¹ã€‚å…¶å®ƒOSDèŠ‚ç‚¹çš„åŸæœ‰æ•°æ®å¹¶ä¸ä¼šå—åˆ°å½±å“ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Cephå½“ä¸­çš„strawç®—æ³•æœ‰&lt;code>straw1&lt;/code>å’Œ&lt;code>straw2&lt;/code>ã€‚&lt;code>straw1&lt;/code>çš„å®ç°é‡‡ç”¨äº†æœ‰ç¼ºé™·f(w)å‡½æ•°ï¼Œä¼šå¯¼è‡´æ„å¤–çš„æ•°æ®è¿ç§»ã€‚&lt;code>straw2&lt;/code>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
è¯¦æƒ…è¯·æˆ³&lt;a href="https://www.spinics.net/lists/ceph-devel/msg21635.html">è¿™é‡Œ&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h4 id="ä¸»ä»æ¶æ„">ä¸»ä»æ¶æ„ &lt;a href="#%e4%b8%bb%e4%bb%8e%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ¯ä¸ªPGæ‰€åŒ…å«çš„OSDéƒ½ç”±CRUSHç®—æ³•è®¡ç®—å¾—å‡ºï¼Œå¹¶æ ¹æ®é…ç½®é€‰å‡ºå‰rä¸ªOSDè¿›è¡Œä¸»ä»é…å¯¹ã€‚åˆ—è¡¨ä¸­çš„ç¬¬1ä¸ªOSDåšä¸ºä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰ï¼Œå…¶å®ƒçš„èŠ‚ç‚¹ä¸ºä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰ã€‚&lt;/p>
&lt;p>ä¸»ä»èŠ‚ç‚¹çš„åˆ†é…ä¸ç®¡ç†ç”±PGå†…éƒ¨è¿›è¡Œè‡ªæ²»ï¼Œä¸éœ€è¦é¢å¤–çš„å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;h2 id="cephfs">CephFS &lt;a href="#cephfs" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>CephFSæ˜¯ä¸€ä¸ªPOSIXå…¼å®¹çš„ï¼ˆå…±äº«ï¼‰æ–‡ä»¶ç³»ç»Ÿã€‚CephFSåˆ©ç”¨æ–‡ä»¶å…ƒæ•°æ®å­ç³»ç»Ÿï¼ˆMDSï¼‰æ¥ç»´æŠ¤ç›®å½•æ ‘ç»“æ„å’Œæ–‡ä»¶å’Œç›®å½•çš„å…ƒä¿¡æ¯ï¼ˆowner, timestamps, inodes, etc.)ç­‰ã€‚&lt;/p>
&lt;p>MDSå­ç³»ç»Ÿä¼šåœ¨å†…å­˜é‡Œé¢ç»´æŠ¤ä¸€ä»½Cacheï¼Œå¯¹äºéœ€è¦æŒä¹…åŒ–çš„ä¿¡æ¯ï¼Œä¼šä½¿ç”¨WALçš„æ–¹å¼å†™å…¥RADOSé‡Œä¸€ä¸ªä¸“ç”¨çš„Poolå½“ä¸­ã€‚&lt;/p>
&lt;h3 id="åŠ¨æ€æ ‘åˆ’åˆ†dynamic-tree-partitioningdtp">åŠ¨æ€æ ‘åˆ’åˆ†ï¼ˆDynamic Tree Partitioningï¼ŒDTPï¼‰ &lt;a href="#%e5%8a%a8%e6%80%81%e6%a0%91%e5%88%92%e5%88%86dynamic-tree-partitioningdtp" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CephFSçš„æ‰©å±•æ€§çš„å…³é”®ä¹‹ä¸€ï¼Œåœ¨äºå…ƒä¿¡æ¯å­ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚CephFSå®ç°äº†åŠ¨æ€æ ‘åˆ’åˆ†çš„ç®—æ³•ï¼Œå°†ç›®å½•æ ‘ç»“æ„æ ¹æ®å½“å‰ç³»ç»Ÿçš„è´Ÿè½½ï¼Œå°†å…¶åˆ’åˆ†åˆ°ä¸åŒçš„MDSèŠ‚ç‚¹ä¸Šå»ã€‚&lt;/p>
&lt;p>ç»´æŠ¤ç›®å½•æ ‘ç»“æ„çš„ä¼˜åŠ¿åœ¨äºåˆ©ç”¨äº†æ–‡ä»¶ç³»ç»Ÿçš„å±€éƒ¨æ€§ï¼ˆlocalityï¼‰ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œé¢„å–ï¼ˆprefetchï¼‰ã€‚åŠ¨æ€çš„æ ‘åˆ’åˆ†ï¼Œå¯ä»¥ä¿è¯å…ƒä¿¡æ¯å¯ä»¥çº¿æ€§å¢é•¿ï¼Œä»¥ä¿æŒé«˜å¯æ‰©å±•æ€§ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-11-29/2020-11-29_18-53-09.png" alt="">&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ¬æ–‡åŸºäºCephçš„ä¸‰ç¯‡è®ºæ–‡ç»¼åˆè€Œæˆï¼ˆCephFSã€RADOSã€CRUSHï¼‰ã€‚å…¶ä¸­åŠ å…¥äº†ä¸€äº›è‡ªå·±çš„çœ‹æ³•ï¼Œä½¿å…¶é€»è¾‘é€šé¡ºï¼Œå¹¶ä¸ä¿è¯ä¸è®ºæ–‡çš„æ€è·¯å®Œå…¨ä¸€è‡´ã€‚&lt;/p>
&lt;p>è¿™ä¸‰ç¯‡è®ºæ–‡å¹¶æ²¡æœ‰æ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œæ¢å¥è¯è¯´ï¼Œéœ€è¦ç»¼åˆé˜…è¯»ï¼Œæ‰èƒ½æœ‰æ¯”è¾ƒæ˜ç¡®çš„ç†è§£ã€‚&lt;/p>
&lt;p>å»ºè®®åœ¨é€šè¯»è®ºæ–‡åï¼Œå»å­¦ä¹ ä¸€ä¸‹&lt;a href="https://www.youtube.com/watch?v=PmLPbrf-x9g&amp;amp;ab_channel=Ceph">è¿™ä¸ªè§†é¢‘&lt;/a>ï¼Œä¼šå¯¹ç†è§£Cephæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚Youtubeä¸Šé¢è¿˜æœ‰å¾ˆå¤šCephçš„tech talkï¼Œå¯ä»¥ä¸€å¹¶çš„äº†è§£ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>Cephç›¸å…³çš„ä¹¦ç±ä»¥å®è·µå±…å¤šï¼Œåªæ¨è&lt;a href="https://www.oreilly.com/library/view/learning-ceph-/9781787127913/">Learning Ceph&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://crossoverjie.top/2018/01/08/Consistent-Hash/">ä¸€è‡´æ€§ Hash ç®—æ³•åˆ†æ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/60963885">ä»ä¸€è‡´æ€§ hash åˆ° ceph crush&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://ceph.io/publications/">Ceph Publications&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>2020 è®¡è’œä¹‹é“ çº¿ä¸Šå†³èµ› - C. æ”€ç™»å±±å³°</title><link>https://wizmann.top/posts/jisuanke-climb-the-hill/</link><pubDate>Mon, 26 Oct 2020 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/jisuanke-climb-the-hill/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡ä½¿ç”¨äº†ä¸€ç§æ¦‚ç‡ç®—æ³•ï¼Œä¸æ˜¯æ­£è§£ï¼Œåªæ±‚éª—åˆ†ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="é¢˜æ„">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://nanti.jisuanke.com/t/49111">åŸé¢˜&lt;/a>&lt;/p>
&lt;p>ç»™ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„A[1&amp;hellip;n]ã€‚&lt;/p>
&lt;p>ç°åœ¨æœ‰qä¸ªæŸ¥è¯¢è¯·æ±‚ï¼ˆq &amp;lt;= 1e5ï¼‰ï¼Œæ¯ä¸ªè¯·æ±‚ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºmçš„å­æ•°ç»„A[i&amp;hellip;j]å’Œä¸€ä¸ªæ•´æ•°tã€‚é—®åœ¨å­æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡m/tçš„æ•°å­—ä¸­ï¼ˆt &amp;lt;= 20ï¼‰ï¼Œæœ€å¤§çš„æ•°æ˜¯å¤šå°‘ã€‚&lt;/p>
&lt;h2 id="é¢˜æ„ä¸­çš„å‘">é¢˜æ„ä¸­çš„å‘ &lt;a href="#%e9%a2%98%e6%84%8f%e4%b8%ad%e7%9a%84%e5%9d%91" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é˜ˆå€¼m / tæ˜¯ä¸€ä¸ªå®æ•°ã€‚ï¼ˆé¢˜æ„ä¸æ˜å…ˆæ­»ä¸ªğŸ´å¥½å—ï¼Ÿï¼‰&lt;/p>
&lt;h2 id="è§£æ³•">è§£æ³• &lt;a href="#%e8%a7%a3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¦–å…ˆæˆ‘ä»¬å°†æ¯ç§æ•°å­—å‡ºç°çš„ä½ç½®ç®€å†ä¸€ä¸ªç´¢å¼•ï¼Œæ­¤æ—¶å¯¹äºä»»æ„ä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨äºŒåˆ†æ³•åœ¨O(logn)çš„æ—¶é—´å†…æ±‚å‡ºå…¶åœ¨æŸä¸ªåŒºé—´å†…å‡ºç°çš„æ¬¡æ•°ã€‚&lt;/p>
&lt;p>å› ä¸ºtæœ€å¤§æ˜¯20ï¼Œä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬éšæœºå–æ•°ï¼Œé‚£ä¹ˆå–åˆ°ä¸€ä¸ªç¬¦åˆå‡ºç°æ¬¡æ•°é™åˆ¶çš„ï¼ˆè¶…è¿‡m/tæ¬¡ï¼‰æ•°å­—çš„æ¦‚ç‡æ˜¯1/tã€‚å¦‚æœæˆ‘ä»¬è¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œå¹¶ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œå‡ ä¹å¯ä»¥ä¿è¯æˆ‘ä»¬ä¸€å®šå¯ä»¥å–åˆ°æ­£ç¡®çš„é‚£ä¸€ä¸ªã€‚&lt;/p>
&lt;p>é‚£ä¹ˆâ€œå¤šæ¬¡å°è¯•â€æ˜¯å¤šå°‘æ¬¡å‘¢ï¼Ÿæˆ‘ä»¬æšä¸¾æ‰€æœ‰çš„tï¼Œç„¶åè®¡ç®—å…¶åœ¨q=1e5çš„æƒ…å†µä¸‹çš„æˆåŠŸç‡ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªéšæœºç®—æ³•ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ†åˆ«è®¡ç®—ä¸€ä¸‹æˆåŠŸç‡ä¸º10%å’Œ50%çš„æœŸæœ›å°è¯•æ¬¡æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#coding=utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">21&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fail &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> (&lt;span style="color:#ae81ff">1.&lt;/span> &lt;span style="color:#f92672">/&lt;/span> i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">3000&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ff &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> fail &lt;span style="color:#f92672">**&lt;/span> j
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> pow(ff, &lt;span style="color:#ae81ff">100000&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0.1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print i, j, pow(ff, &lt;span style="color:#ae81ff">100000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/20-10-27/1603729521727_2020-10-27_00-25-20.png" alt="">&lt;/p>
&lt;p>ç”±ä¸Šè¡¨æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯¹äºä¸åŒçš„tï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„å°è¯•æ¬¡æ•°ä»¥è¾¾åˆ°é¢„æœŸçš„èƒœç‡ã€‚&lt;/p>
&lt;p>æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(q * logn * attempt)ï¼Œå¯¹äºæé™æ•°æ®å¯èƒ½ä¼šæœ‰è¶…æ—¶çš„é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨éšæœºå°è¯•æ—¶å¯ä»¥åŠ å…¥äº›è®¸çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚åŠ ä¸Šè¾“å…¥è¾“å‡ºå¤–æŒ‚ï¼Œä»¥åŠä¸è®¡ç®—é‡å¤å€¼ä¸å°äºæœ€å¤§å€¼çš„å€¼ç­‰ã€‚å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å­œå­œä¸å€¦çš„æäº¤ï¼Œç›´åˆ°è·å¾—ACä¸ºæ­¢ã€‚ï¼ˆè¯„æµ‹æœºä½ è¾›è‹¦äº†ï¼‰&lt;/p>
&lt;p>ä»¥åŠï¼Œè®°å¾—åŠ ä¸Šåˆå§‹åŒ–éšæœºæ•°ç§å­&lt;code>srand(time(NULL));&lt;/code>ï¼Œå¦åˆ™ä½ çš„éšæœºæ•°æ¯æ¬¡éƒ½ä¸€æ ·ã€‚ã€‚ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šæ€»çš„èƒœç‡è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œè¯´æ˜æ•°æ®å¹¶æ²¡æœ‰è¾¾åˆ°æé™ï¼Œå‡ºé¢˜äººæ‰‹ä¸‹ç•™æƒ…åšäº†ä¸ªäººï¼ˆ&lt;/p>
&lt;p>ä»£ç è¯·è§&lt;a href="https://github.com/Wizmann/ACM-ICPC/blob/master/Jisuanke/T49111-%E6%94%80%E7%99%BB%E5%B1%B1%E5%B3%B0.cc">è¿™é‡Œ&lt;/a>&lt;/p></description></item><item><title>6.824 Lab 2: Raftåè®®å®ç°æŒ‡å— ï¼ˆæ— å‰§é€ç‰ˆï¼‰</title><link>https://wizmann.top/posts/raft-lab-mit-6.824/</link><pubDate>Thu, 02 May 2019 21:33:00 +0000</pubDate><guid>https://wizmann.top/posts/raft-lab-mit-6.824/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>MIT6.824æ˜¯ä¸€ä¸ªç”¨æ¥å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿçš„éå¸¸å¥½çš„èµ„æºã€‚å…¶ä¸­ç¬¬äºŒä¸ªè¯¾ç¨‹ä½œä¸šå°±æ˜¯å…³äº&lt;a href="https://pdos.csail.mit.edu/6.824/labs/lab-raft.html">Raftç®—æ³•&lt;/a>ã€‚&lt;/p>
&lt;p>ç”±äºåœ¨å·¥ä½œä¸­æ¶‰åŠåˆ°åˆ†å¸ƒä¸€è‡´æ€§ç®—æ³•çš„è°ƒç ”ï¼Œæ¥è§¦äº†paxos/raftç®—æ³•ã€‚ç„¶åè¢«@neutronestå®‰åˆ©äº†ä¸€å‘ï¼Œäºæ˜¯å¼€å§‹ç€æ‰‹å®ç°è¿™ä¸ªä½œä¸šã€‚&lt;/p>
&lt;p>æœ¬æ–‡æ˜¯æˆ‘å¯¹è¿™ä¸ªé¡¹ç›®çš„å®ç°æ€»ç»“ã€‚å¸Œæœ›èƒ½åœ¨åˆ’å‡ºé‡ç‚¹çš„åŒæ—¶ï¼Œä¸æ¶‰åŠå®ç°ç»†èŠ‚ï¼Œé¿å…ç ´åå¤§å®¶çš„å†™ä»£ç ä½“éªŒã€‚&lt;/p>
&lt;p>æœ¬æ–‡å”¯ä¸€å‚è€ƒèµ„æ–™ï¼š&lt;a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm&lt;/a>&lt;/p>
&lt;h2 id="ä»»åŠ¡åˆ†è§£">ä»»åŠ¡åˆ†è§£ &lt;a href="#%e4%bb%bb%e5%8a%a1%e5%88%86%e8%a7%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨å®˜æ–¹æ–‡æ¡£é‡Œï¼Œæ•´ä¸ªé¡¹ç›®è¢«åˆ†æˆäº†2Aã€2Bã€2Cä¸‰ä¸ªéƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>2A - æŠ•ç¥¨ä¸é€‰ä¸¾&lt;/li>
&lt;li>2B - ä¸€è‡´æ€§&lt;/li>
&lt;li>2C - å¯æŒä¹…åŒ–&lt;/li>
&lt;/ul>
&lt;p>å®é™…ä¸Šï¼Œ2Cçš„å·¥ä½œé‡éå¸¸å°‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ2Bå’Œ2Cåˆæˆä¸€ä¸ªã€‚ç„¶åå•ç‹¬æå‡ºå‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ’åˆ†æˆå­é¡¹ç›®ã€‚ä»»åŠ¡åˆ†è§£å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>2A - æŠ•ç¥¨ä¸é€‰ä¸¾&lt;/li>
&lt;li>2B/2C - ä¸€è‡´æ€§å’Œå¯æŒä¹…åŒ–&lt;/li>
&lt;li>ä¸‰ä¸ªéš¾åº¦æ¯”è¾ƒé«˜çš„Case
&lt;ul>
&lt;li>Test (2B): leader backs up quickly over incorrect follower logs &lt;br>
éªŒè¯åè®®å®ç°çš„æ­£ç¡®æ€§&lt;/li>
&lt;li>Test (2B): RPC counts aren&amp;rsquo;t too high &lt;br>
æµ‹è¯•åè®®æ˜¯å¦äº§ç”Ÿäº†è¿‡å¤šçš„RPCè¯·æ±‚ã€‚éªŒè¯åè®®çš„æ€§èƒ½ã€‚&lt;/li>
&lt;li>Test (2C): Figure 8 (unreliable) &lt;br>
æµ‹è¯•åœ¨æç«¯æ··ä¹±çš„æƒ…å†µä¸‹ï¼ŒRaftåè®®æ˜¯å¦èƒ½åŠæ—¶æ¢å¤æ­£å¸¸å·¥ä½œã€‚éªŒè¯åè®®å®ç°çš„æ­£ç¡®æ€§å’Œæ€§èƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥æ¨èå¤§å®¶æŒ‰é¡ºåºä»¥ä¸Šé¡ºåºè¿›è¡Œå®ç°ã€‚å¹¶ä¸”å……åˆ†åˆ©ç”¨ç‰ˆæœ¬æ§åˆ¶å¯¹ä»£ç è¿›è¡Œå¼€å‘å’Œé‡æ„ã€‚&lt;/p>
&lt;h2 id="éœ€è¦å…³æ³¨çš„çŸ¥è¯†ç‚¹">éœ€è¦å…³æ³¨çš„çŸ¥è¯†ç‚¹ &lt;a href="#%e9%9c%80%e8%a6%81%e5%85%b3%e6%b3%a8%e7%9a%84%e7%9f%a5%e8%af%86%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸‹ä¼šä»‹ç»æ¯ä¸€ä¸ªéƒ¨åˆ†éœ€è¦é‡ç‚¹å…³æ³¨çš„çŸ¥è¯†ç‚¹ï¼Œå†…å®¹åŒ…æ‹¬golangåŸºç¡€å’Œè®ºæ–‡ä¸­çš„çŸ¥è¯†ç‚¹ï¼Œæ— å‰§é€ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨ã€‚&lt;/p>
&lt;h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ &lt;a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>golangæ˜¯ä¸€é—¨å‚²æ…¢çš„è¯­è¨€ï¼Œå…¶æ ‡å‡†åº“çš„ç¼ºä¹å®åœ¨æ˜¯è®©äººæ„Ÿåˆ°TMDè›‹ç–¼ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªè¯¾ç¨‹ä½œä¸šæ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¿…è¦å¼•å…¥ä¸€ç³»åˆ—ç¬¬ä¸‰æ–¹åº“ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆè¦æ‰©å……&lt;code>util.go&lt;/code>æ–‡ä»¶ï¼Œä½¿å…¶ä¸ºæˆ‘ä»¬çš„å¼€å‘æä¾›æ›´å¤šçš„ä¾¿åˆ©ã€‚&lt;/p>
&lt;h4 id="logæ¨¡å—">Logæ¨¡å— &lt;a href="#log%e6%a8%a1%e5%9d%97" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é¡¹ç›®ç»™å‡ºçš„&lt;code>DPrintf&lt;/code>å‡½æ•°éå¸¸ç®€å•ï¼Œåªæä¾›äº†ä¸€ä¸ª&lt;code>fmt.Printf&lt;/code>çš„å°è£…ã€‚å¹¶ä¸èƒ½æ‰“å°è¡Œå·å’Œæ–‡ä»¶åã€‚è¿™é‡Œæä¾›ä¸€ä¸ªæ‰©å±•ç‰ˆæœ¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">DPrintf&lt;/span>(&lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">Debug&lt;/span> &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">path&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">runtime&lt;/span>.&lt;span style="color:#a6e22e">Caller&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">filepath&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#a6e22e">path&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">ok&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Now&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> = append([]&lt;span style="color:#66d9ef">interface&lt;/span>{} { &lt;span style="color:#a6e22e">t&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2006-01-02 15:04:05.00&amp;#34;&lt;/span>), &lt;span style="color:#a6e22e">file&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span> }, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s [%s:%d] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶è¾“å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>2019-05-02 09:28:35.04 [raft.go:652] Node[1] is processing, state: [LEADER], term 1, commitIndex: 12, logCount: 12, leader 1
&lt;/code>&lt;/pre>&lt;h4 id="maxå’Œminå‡½æ•°">Maxå’ŒMinå‡½æ•° &lt;a href="#max%e5%92%8cmin%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>golangæ˜¯æ²¡æœ‰å¯¹äºintå€¼çš„&lt;code>max&lt;/code>å’Œ&lt;code>min&lt;/code>å‡½æ•°çš„ï¼Œè¿™é‡Œçœç•¥è„è¯100å¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Min&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &amp;lt; &lt;span style="color:#a6e22e">b&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Max&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &amp;gt; &lt;span style="color:#a6e22e">b&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="assertå‡½æ•°">Assertå‡½æ•° &lt;a href="#assert%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œgolangä¹Ÿæ²¡æœ‰æä¾›&lt;code>assert&lt;/code>å‡½æ•°ã€‚å¦‚æœä½ å«Œåˆ°å¤„å†™&lt;code>if&lt;/code>å’Œ&lt;code>panic&lt;/code>å¤ªä¸‘çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª&lt;code>assert&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Assert&lt;/span>(&lt;span style="color:#a6e22e">flag&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span>, &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (!&lt;span style="color:#a6e22e">flag&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">path&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">runtime&lt;/span>.&lt;span style="color:#a6e22e">Caller&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">filepath&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#a6e22e">path&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">ok&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Now&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> = append([]&lt;span style="color:#66d9ef">interface&lt;/span>{} { &lt;span style="color:#a6e22e">t&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2006-01-02 15:04:05.00&amp;#34;&lt;/span>), &lt;span style="color:#a6e22e">file&lt;/span>, &lt;span style="color:#a6e22e">lineno&lt;/span> }, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">reason&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;%s [%s:%d] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">format&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>&lt;span style="color:#f92672">...&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#a6e22e">reason&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="log-id">Log Id &lt;a href="#log-id" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸ºäº†éªŒè¯æ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬åœ¨æ—¥å¿—ä¸­é¢å¤–åŠ å…¥ä¸€ä¸ªUUIDæ¥è¿›è¡Œæ ‡è¯†ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>import &amp;#34;math/rand&amp;#34;
func CreateLogId() (uuid string) {
b := make([]byte, 16)
_, err := rand.Read(b)
if err != nil {
fmt.Println(&amp;#34;Error: &amp;#34;, err)
return
}
uuid = fmt.Sprintf(&amp;#34;%X-%X-%X-%X-%X&amp;#34;, b[0:4], b[4:6], b[6:8], b[8:10], b[10:])
return uuid
}
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šä»£ç å¯ä»¥ç”Ÿæˆä¸€ä¸ªï¼ˆä¼ªï¼‰UUIDå¯¹æ—¥å¿—è¿›è¡Œæ ‡è¯†ã€‚æ¨èä½¿ç”¨&lt;code>math/rand&lt;/code>ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¼ªéšæœºæ•°å°±å¤Ÿäº†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨ï¼šè¿™é‡Œçš„UUIDåªæ˜¯çœ‹èµ·æ¥åƒä¸€ä¸ªUUIDï¼Œå®é™…ä¸ŠUUIDæœ‰å…¶ç‰¹æ®Šçš„è§„èŒƒä¸æ ¼å¼ã€‚ä½†æ˜¯ç”±äºgolangå†…éƒ¨æ²¡æœ‰æä¾›å¯ç”¨çš„UUIDåº“ï¼Œæ‰€ä»¥åªå¥½éšæ‰‹æ¨¡æ‹Ÿäº†ä¸€ä¸ªã€‚&lt;/p>&lt;/blockquote>
&lt;h4 id="æ–‡ä»¶ç»„ç»‡">æ–‡ä»¶ç»„ç»‡ &lt;a href="#%e6%96%87%e4%bb%b6%e7%bb%84%e7%bb%87" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é»˜è®¤çš„å®ç°æ˜¯æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½å†™åˆ°äº†&lt;code>raft.go&lt;/code>æ–‡ä»¶é‡Œã€‚ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶å¯èƒ½ä¼šç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥è´Ÿæ‹…ï¼Œæ‰€ä»¥æˆ‘çš„åšæ³•æ˜¯æŠŠæ‰€æœ‰çš„ç±»å£°æ˜æ”¾åˆ°&lt;code>models.go&lt;/code>æ–‡ä»¶é‡Œã€‚ä»¥é¿å…æ–‡ä»¶çš„è†¨èƒ€ã€‚&lt;/p>
&lt;h4 id="é”ä¸defer">é”ä¸defer &lt;a href="#%e9%94%81%e4%b8%8edefer" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨raftå®ç°ä¸­ï¼Œé”å¯ä»¥ç”¨æ¥ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„æ­£ç¡®æ€§ã€‚æ‰€ä»¥åªè¦åœ¨æ¶‰åŠåˆ°raftå†…éƒ¨çŠ¶æ€çš„å˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦åŠ é”ã€‚ä¸€ä¸ªå¸¸è§çš„åŠ é”patternæ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>() &lt;span style="color:#75715e">// åŠ é”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>() &lt;span style="color:#75715e">// åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆåè§£é”&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæ¨èä½¿ç”¨deferï¼Œå› ä¸ºæ‰‹åŠ¨æ§åˆ¶é”å®ç°æ˜¯è¿‡äºå®¹æ˜“å‡ºé”™ã€‚ä½†æ˜¯deferä¹Ÿæ˜¯æœ‰å‘çš„ï¼&lt;/p>
&lt;p>ä¸åŒäºC++çš„å¤§æ‹¬å·ä½œç”¨åŸŸï¼Œdeferçš„è§¦å‘æ—¶é—´æ˜¯åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œè€Œå¹¶ä¸æ˜¯é€€å‡ºå½“å‰å¤§æ‹¬å·æ—¶ã€‚è¿™ç‚¹éå¸¸éœ€è¦æ³¨æ„ï¼Œå¦åˆ™ææ˜“å‡ºç°æ­»é”ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬æƒ³å®ç°C++ä¸­&lt;code>do { ... } while (0);&lt;/code>ç±»ä¼¼çš„lock guard patternï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">mu&lt;/span>.&lt;span style="color:#a6e22e">Unlock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// do something here&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨æ‰§è¡Œå®Œå½“å‰lambdaä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨è§£é”ã€‚&lt;/p>
&lt;h4 id="åˆ·æ–°å®šæ—¶å™¨">åˆ·æ–°å®šæ—¶å™¨ &lt;a href="#%e5%88%b7%e6%96%b0%e5%ae%9a%e6%97%b6%e5%99%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç”±äºraftç®—æ³•é‡Œé¢ä½¿ç”¨äº†å®šæ—¶å™¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªåˆ·æ–°å®šæ—¶å™¨çš„golangä»£ç ã€‚è¿™æ ·å®ç°æ˜¯ä¸ºäº†æ¯æ¬¡åœ¨åˆ·æ–°çš„æ—¶å€™ï¼Œæ¸…ç©ºå®šæ—¶å™¨ä¸­åŸæœ‰çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…æ··ä¹±ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">rf&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Raft&lt;/span>) &lt;span style="color:#a6e22e">renewTimer&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span> &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Duration&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span> = &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">NewTimer&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (!&lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">Stop&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">select&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">C&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rf&lt;/span>.&lt;span style="color:#a6e22e">timer&lt;/span>.&lt;span style="color:#a6e22e">Reset&lt;/span>(&lt;span style="color:#a6e22e">timeout&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥åŠï¼Œåœ¨å®šæ—¶å™¨è¶…æ—¶ä¹‹åï¼Œä¸è¦å¿˜äº†æ›´æ–°å®šæ—¶å™¨ã€‚&lt;/p>
&lt;h3 id="2a---æŠ•ç¥¨ä¸é€‰ä¸¾">2A - æŠ•ç¥¨ä¸é€‰ä¸¾ &lt;a href="#2a---%e6%8a%95%e7%a5%a8%e4%b8%8e%e9%80%89%e4%b8%be" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="æ‰€éœ€è¦ç±»çš„å£°æ˜">æ‰€éœ€è¦ç±»çš„å£°æ˜ &lt;a href="#%e6%89%80%e9%9c%80%e8%a6%81%e7%b1%bb%e7%9a%84%e5%a3%b0%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è®ºæ–‡ä¸­çš„&lt;code>Figure2&lt;/code>åŒ…å«äº†ç®—æ³•ä¸­æ‰€æœ‰çš„ç±»ä»¥åŠåŸºæœ¬ç®—æ³•ã€‚åœ¨2Aä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šè¢«ç”¨åˆ°ã€‚ç”±äº2Aä¸­åªåŒ…æ‹¬æŠ•ç¥¨ä¸é€‰ä¸¾ï¼Œæ‰€ä»¥å’Œæ—¥å¿—ç›¸å…³çš„å­—æ®µå¯ä»¥å…ˆå¿½ç•¥æ‰ã€‚&lt;/p>
&lt;h4 id="checklist-for-2a">Checklist for 2A &lt;a href="#checklist-for-2a" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>å®ç°raftçŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€ï¼šleaderï¼Œfollowerå’Œcandidate&lt;/li>
&lt;li>å®ç°RPCå‡½æ•°ï¼š&lt;code>sendRequestVote&lt;/code>ï¼ˆå‘é€ç«¯ï¼‰å’Œ&lt;code>RequestVote&lt;/code>ï¼ˆæ¥æ”¶ç«¯çš„å›è°ƒå‡½æ•°ï¼‰&lt;/li>
&lt;li>å®ç°RPCå‡½æ•°ï¼š&lt;code>sendAppendEntries&lt;/code>ï¼ˆå‘é€ç«¯ï¼‰å’Œ&lt;code>AppendEntries&lt;/code>ï¼ˆæ¥æ”¶ç«¯çš„å›è°ƒå‡½æ•°ï¼‰&lt;/li>
&lt;li>ä¿è¯raftçŠ¶æ€æœºçš„ä»»æœŸå·ï¼ˆ&lt;code>currentTerm&lt;/code>ï¼‰æ˜¯å•è°ƒé€’å¢çš„&lt;/li>
&lt;li>ä¸€ä¸ªFollowerå¯¹äºæŸä¸€ä¸ªTermåªèƒ½æŠ•å‡ºä¸€ç¥¨&lt;/li>
&lt;li>å®ç°Leaderå¿ƒè·³ï¼Œç»´æŠ¤å½“å‰ä»»æœŸï¼ˆTermï¼‰ã€‚&lt;/li>
&lt;li>å®ç°Followeré€‰ä¸¾è¶…æ—¶ï¼ˆelection timeoutï¼‰&lt;/li>
&lt;li>å®ç°Candidateé€‰ä¸¾çš„ä¸‰ç§åœºæ™¯
&lt;ul>
&lt;li>è·å¾—å¤šæ•°é€‰ç¥¨ï¼Œèµ¢å¾—é€‰ä¸¾ã€‚çŠ¶æ€åˆ‡æ¢ä¸ºLeader&lt;/li>
&lt;li>å…¶å®ƒçš„èŠ‚ç‚¹å·²ç»è¢«é€‰ä¸ºLeaderã€‚çŠ¶æ€åˆ‡æ¢ä¸ºFollower&lt;/li>
&lt;li>åœ¨é€‰ä¸¾ä¸­å¹¶æœªè·å¾—å¤šæ•°é€‰ç¥¨ï¼ŒçŠ¶æ€åˆ‡æ¢ä¸ºFollower&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å®ç°Candidateéšæœºé€‰ä¸¾è¶…æ—¶ï¼ˆrandomized election timeoutï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="2b2c---æ—¥å¿—å¤åˆ¶ä¸æŒä¹…åŒ–">2B/2C - æ—¥å¿—å¤åˆ¶ä¸æŒä¹…åŒ– &lt;a href="#2b2c---%e6%97%a5%e5%bf%97%e5%a4%8d%e5%88%b6%e4%b8%8e%e6%8c%81%e4%b9%85%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="åŸºæœ¬å·¥ä½œæµ">åŸºæœ¬å·¥ä½œæµ &lt;a href="#%e5%9f%ba%e6%9c%ac%e5%b7%a5%e4%bd%9c%e6%b5%81" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ—¥å¿—å¤åˆ¶çš„åŸºæœ¬å·¥ä½œæµå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>Leaderæ¥å—ç”¨æˆ·è¯·æ±‚ï¼Œå°†çŠ¶æ€å˜åŒ–å†™å…¥æœ¬æœºçš„æ—¥å¿—æµä¸­ï¼Œå¹¶ä¸”æŠŠæ—¥å¿—å¤åˆ¶åˆ°Followersã€‚å¦‚æœæœ¬æ¡æ—¥å¿—åˆæ³•ï¼ŒFollowersä¼šå°†è¿™æ¡æ—¥å¿—æ ‡è®°ä¸ºâ€œæäº¤â€ï¼ˆcommittedï¼‰ï¼Œç„¶åå†å°†è¿™æ¡æ—¥å¿—â€œåº”ç”¨â€ï¼ˆapplyï¼‰åˆ°Raftåè®®ä¹‹å¤–çš„çŠ¶æ€æœºã€‚Followeråœ¨æäº¤æ—¥å¿—ä¹‹åï¼Œå°±å¯ä»¥å‘Leaderå›æŠ¥è¿™æ¡æ—¥å¿—å·²ç»è¢«æäº¤ã€‚åœ¨æœ¬æ¡æ—¥å¿—è¢«å¤šæ•°èŠ‚ç‚¹æäº¤ä¹‹åï¼ŒLeaderå†å°†è¿™æ¡æ—¥å¿—æ ‡è®°ä¸ºæäº¤ã€‚æ­¤æ—¶ï¼Œç”¨æˆ·çš„è¯·æ±‚å°±å¯ä»¥è¢«ç¡®è®¤ï¼ˆACKï¼‰äº†ã€‚&lt;/p>
&lt;p>Raftçš„è®ºæ–‡ä¸­ï¼ŒLeaderéœ€è¦ç»´æŠ¤&lt;code>commitIndex&lt;/code>å’Œ&lt;code>lastApplied&lt;/code>è¿™ä¸¤ä¸ªçŠ¶æ€ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥â€œåº”ç”¨â€ï¼ˆapplyï¼‰è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸¤ä¸ªçŠ¶æ€æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤&lt;code>commitIndex&lt;/code>å³å¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Raftåè®®ä¸æ˜¯2PCï¼Œåƒä¸‡ä¸è¦ææ··äº†å“¦ï½&lt;/p>&lt;/blockquote>
&lt;h4 id="å›æ»šä¸æ»šå›æ¥">å›æ»šä¸æ»šå›æ¥ &lt;a href="#%e5%9b%9e%e6%bb%9a%e4%b8%8e%e6%bb%9a%e5%9b%9e%e6%9d%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/3f1056d6f142755204092fb89a474dc964608bab/wizmann-pic/2019-05-02_14-40-52.png" alt="rollback">&lt;/p>
&lt;p>ä»ä¸Šé¢çš„å·¥ä½œæµæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºå·²ç»committedçš„æ—¥å¿—ï¼Œä»ç„¶æœ‰å¯èƒ½æ˜¯ä¸å¯é çš„ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œåœ¨Term1æ—¶ï¼ŒèŠ‚ç‚¹1ä½œä¸šLeaderæäº¤åˆ°äº†æ—¥å¿—(1, 2)ï¼Œè€ŒFollowerèŠ‚ç‚¹Node2å’ŒNode3åˆ†åˆ«æäº¤åˆ°äº†æ—¥å¿—(1, 2)å’Œ(1, 3)ã€‚æ­¤æ—¶LeaderçŸ­æš‚æ–­çº¿ï¼Œå‡ºå‘é€‰ä¸¾è¶…æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„é€‰ä¸¾ã€‚å¦‚æœèŠ‚ç‚¹Node2è¢«é€‰ä¸ºLeaderï¼Œé‚£ä¹ˆèŠ‚ç‚¹Node3å°±ä¼šè¢«Leaderå¤šå‡ºä¸€æ¡æ—¥å¿—ï¼Œè¿™æ˜¯ä¸è¢«å…è®¸çš„ã€‚å¦‚æœèŠ‚ç‚¹Node3è¢«é€‰ä¸ºLeaderï¼Œé‚£ä¹ˆNode2å°±æ¯”Leaderåœ¨Term1å°‘ä¸€æ¡æ—¥å¿—ï¼Œéœ€è¦è¡¥é½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰äººå¯èƒ½ä¼šæ€€ç–‘ï¼ŒèŠ‚ç‚¹2æ¯”èŠ‚ç‚¹3å°‘ä¸€æ¡æ—¥å¿—ï¼Œé‚£ä¹ˆæŒ‰ç…§è®ºæ–‡é‡Œçš„è¯´æ³•ï¼Œå› ä¸ºèŠ‚ç‚¹3çš„æ—¥å¿—æ¯”è¾ƒèŠ‚ç‚¹2è¦å¤šï¼Œæ‰€ä»¥åªæœ‰èŠ‚ç‚¹3æ‰èƒ½èµ¢å¾—ä¸‹ä¸€è½®é€‰ä¸¾ã€‚è¿™å…¶å®æ˜¯ä¸å¯¹çš„ï¼Œå¦‚æœèŠ‚ç‚¹3æ–­çº¿ï¼ŒèŠ‚ç‚¹1å’ŒèŠ‚ç‚¹2ä»ç„¶å¯ä»¥ç»„æˆä¸€ä¸ªquorumï¼Œé€‰ä¸¾å‡ºLeaderã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘å°†å·²committedçš„æ—¥å¿—å›æ»šï¼ˆå‘å·¦æ»šï¼‰ï¼Œä»¥åŠç¼ºå¤±çš„æ—¥å¿—è¡¥é½ï¼ˆå‘å³æ»šï¼‰ã€‚è¿™é‡Œå…¶å®æœ‰ä¸€äº›ä¼˜åŒ–çš„ç‚¹ï¼Œæˆ‘ä»¬åæ–‡å†è¯´ã€‚&lt;/p>
&lt;p>å†æ¬¡æ³¨æ„ï¼Œä¿è¯æ—¥å¿—çš„ä¸€è‡´æ€§æ˜¯Raftåè®®æ­£ç¡®æ€§çš„å¿…é¡»ä¿è¯ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šä¸€å®šè¦æ³¨æ„ã€‚&lt;/p>
&lt;h4 id="ä¹±åºè¯·æ±‚">ä¹±åºè¯·æ±‚ &lt;a href="#%e4%b9%b1%e5%ba%8f%e8%af%b7%e6%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æœ¬é¡¹ç›®ä¸­ï¼Œæ¨¡æ‹Ÿçš„RPCåè®®å¹¶ä¸èƒ½ä¿è¯å¯é æ€§ï¼ˆä¼šä¸¢åŒ…ï¼‰ã€æœ‰åºæ€§ï¼ˆä¼šä¹±åºï¼‰ï¼Œä¹Ÿæ²¡æœ‰SLAï¼ˆæ²¡æœ‰è¶…æ—¶æ—¶é—´çš„ä¸Šé™ï¼‰ï¼Œæ›´ä¸ç”¨æƒ³æ‹¥å¡æ§åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®ƒåœ¨åº•å±‚ä½¿ç”¨äº†UDPåè®®ï¼Œè€Œä¸æ˜¯TCPã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åšå‡ºä»»ä½•å‡è®¾ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œä¸¤ä¸ªè¯·æ±‚å…ˆåæ¥åˆ°Leaderç«¯ï¼ŒAè¯·æ±‚ç¼–å·(1,100)ï¼ŒBè¯·æ±‚ç¼–å·(1,110)ã€‚ç„¶åæˆ‘ä»¬ä¾æ¬¡å°†Logå¤åˆ¶åˆ°Followerç«¯ï¼ˆAå…ˆBåï¼‰ï¼Œä½†æ˜¯åœ¨Followerç«¯æœ‰å¯èƒ½æ”¶åˆ°çš„é¡ºåºæ˜¯Bå…ˆAåã€‚ç”šè‡³åªæ”¶åˆ°Bï¼Œæ²¡æ”¶åˆ°Aã€‚è¿™ç§æƒ…å†µæ—¥å¸¸å·¥ç¨‹ä¸­çš„TCPåè®®ä¸‹å‡ ä¹ä¸èƒ½å‘ç”Ÿï¼Œä½†æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¦ååˆ†å°å¿ƒã€‚&lt;/p>
&lt;h4 id="checklist-for-2b2c">Checklist for 2B/2C &lt;a href="#checklist-for-2b2c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>æ—¥å¿—çš„çŠ¶æ€ä¼šå½±å“Leaderé€‰ä¸¾ &lt;br>
å¦‚æœä¸¤ä»½æ—¥å¿—æµçš„æœ€åä¸€æ¡æ—¥å¿—çš„Termä¸ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºTermå·å¤§çš„æ—¥å¿—â€œæ¯”è¾ƒæ–°â€ã€‚å¦‚æœTermå·ä¸€æ ·ï¼Œé‚£ä¹ˆIndexå¤§çš„æ—¥å¿—â€œæ¯”è¾ƒæ–°â€&lt;/li>
&lt;li>å¦‚æœLeaderå’ŒFollowerçš„æ—¥å¿—ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆFolloweréœ€è¦æ‹·è´Leaderçš„æ—¥å¿—ï¼ˆå‘å·¦æ»šæˆ–å‘å³æ»šçš„æ­£ç¡®æ€§ï¼‰ &lt;br>
è¿™é‡Œæ¨èä½¿ç”¨AssertåŠ æ–­è¨€è¿›è¡Œä¿è¯ï¼Œå¦‚æœå‡ºé”™å¯ä»¥è·å¾—å®æ—¶çš„ç°åœº&lt;/li>
&lt;li>å¯¹äºå°äºå½“å‰Termçš„æ—¥å¿—ï¼ŒLeaderä¸éœ€è¦ç­‰å¤šæ•°Followerç¡®è®¤å°±å¯ä»¥ç›´æ¥commit&lt;/li>
&lt;li>ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šå¦‚æœä¸¤ä¸ªæ—¥å¿—çš„(Term, Index)ä¸€è‡´ï¼Œé‚£ä¹ˆå…¶å†…å®¹ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚å¹¶ä¸”åœ¨æ­¤æ—¥å¿—ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—éƒ½å¿…é¡»æ˜¯ä¸€è‡´çš„&lt;/li>
&lt;li>å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šRPCè¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡é‡å¤å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶ä¸ä¼šç ´åRaftåè®®çš„çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;h3 id="æœ€åçš„3ä¸ªcase">æœ€åçš„3ä¸ªCase &lt;a href="#%e6%9c%80%e5%90%8e%e7%9a%843%e4%b8%aacase" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ€åçš„ä¸‰ä¸ªCaseæœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå°±æ˜¯å¯¹åè®®çš„æ•ˆç‡å’Œæ­£ç¡®æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ã€‚å³ä½¿å‰é¢çš„ä»£ç é‡Œä½ çš„å®ç°æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿæœ‰å¯èƒ½å› ä¸ºå„ç§å…¶å®ƒçš„åŸå› é€ æˆCaseæŒ‚æ‰ã€‚&lt;/p>
&lt;p>å»ºè®®é¦–å…ˆè§£å†³æ­£ç¡®æ€§é—®é¢˜ï¼Œå†æå‡æ•ˆç‡ã€‚&lt;/p>
&lt;h4 id="å‘å·¦æ»šçš„ä¼˜åŒ–é‡è¦">å‘å·¦æ»šçš„ä¼˜åŒ–ï¼ˆé‡è¦ï¼ï¼‰ &lt;a href="#%e5%90%91%e5%b7%a6%e6%bb%9a%e7%9a%84%e4%bc%98%e5%8c%96%e9%87%8d%e8%a6%81" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨è®ºæ–‡çš„5.3èŠ‚ï¼Œä»‹ç»äº†ä¸€ç§å›æ»šçš„ä¼˜åŒ–ã€‚å¦‚æœLeaderå’ŒFolloweråœ¨æŸä¸ªIndexä¸Šçš„æ—¥å¿—ä¸ä¸€è‡´ï¼ŒLeaderçš„ç‰ˆæœ¬è®°ä¸º(Term1, Index)ï¼ŒFollowerçš„ç‰ˆæœ¬è®°ä¸º(Term2, Index)ã€‚é‚£ä¹ˆFolloweréœ€è¦å›æ»šæ‰€æœ‰æ—¥å¿—ï¼Œç›´åˆ°Termå°äº&lt;code>Min(Term1, Term2)&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥åŠ å¿«å›æ»šçš„æ•ˆç‡ã€‚è™½ç„¶è®ºæ–‡ä¸Šè¡¨ç¤ºè¿™ç§ä¼˜åŒ–å¹¶éå¿…è¦ï¼Œä½†æ˜¯åœ¨æ¨¡æ‹Ÿå‡ºæ¥çš„æç«¯ç½‘ç»œç¯å¢ƒä¸‹ï¼Œè¿™æ ·çš„ä¼˜åŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€äº›æ¯”è¾ƒå˜æ€çš„Caseã€‚&lt;/p>
&lt;h4 id="å…¶å®ƒçš„éå®˜æ–¹ä¼˜åŒ–">å…¶å®ƒçš„éå®˜æ–¹ä¼˜åŒ– &lt;a href="#%e5%85%b6%e5%ae%83%e7%9a%84%e9%9d%9e%e5%ae%98%e6%96%b9%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è¿™é‡Œè¿˜æœ‰ä¸€äº›è®ºæ–‡é‡Œæ²¡çš„æåˆ°çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä¸ä¿è¯ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä¸å‰§é€ï¼Œæ”¾åˆ°å•ç‹¬çš„é“¾æ¥é‡Œäº†ï¼š&lt;a href="https://github.com/Wizmann/assets/blob/master/wizmann-pic/19-05-02/raft-hints.md">å‰§é€è­¦å‘Šï¼&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>è¿˜æœ‰ä¸€ä¸ªBonusæŒ‘æˆ˜ï¼Œè°æ¯”è¾ƒé—²å¯ä»¥è¯•ä¸€ä¸‹ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ &lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/e35dd59aa533ddd19065f070dcb85a3734cc035d/wizmann-pic/19-05-02/2019-05-02_21-37-14.png" alt="tests">&lt;/p>
&lt;p>åœ¨Travis CIä¸Šé¢è¿è¡Œçš„æµ‹è¯•ã€‚è‡ªæˆ‘æ„Ÿè§‰å®ç°çš„æ¯”è¾ƒä¸€èˆ¬ï¼Œæ‰€ä»¥ä½ ä»¬çš„ç¨‹åºåº”è¯¥è·‘çš„æ¯”æˆ‘å¿«ä¸€ç‚¹æ‰æ­£å¸¸ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æƒ³è¦å®Œæ•´æ­£ç¡®çš„å®ç°è¿™ä¸ªé¡¹ç›®ï¼Œé¦–å…ˆä¸€å®šè¦æŠŠè®ºæ–‡è¯»æ‡‚ã€‚å¹¶ä¸”åˆ’å‡ºå®ç°ä¸Šåº”è¯¥æ³¨æ„çš„é‡ç‚¹ã€‚&lt;/p>
&lt;p>å½“é‡åˆ°æ­£ç¡®æ€§é—®é¢˜æ—¶ï¼Œä¸€å®šè¦å›å½’è®ºæ–‡ï¼Œå¤§éƒ¨åˆ†çš„é—®é¢˜éƒ½å¯ä»¥è·å¾—è§£ç­”ã€‚å½“é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥å‚è€ƒä½œä¸šä¸Šé¢çš„Hintsï¼Œé‡Œé¢ä¹Ÿæœ‰éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>MITçš„è¿™ä¸ªè¯¾ç¨‹è¿˜æœ‰åŸºäºraftå®ç°kv storageçš„é¡¹ç›®ï¼Œåç»­å¦‚æœæœ‰æ—¶é—´åº”è¯¥è¿˜ä¼šåšå§ã€‚&lt;/p></description></item><item><title>ç™½è¯ä¸€è‡´æ€§åè®® - Paxosã€Raftå’ŒPacificA[2]</title><link>https://wizmann.top/posts/paxos-raft-pecifaca2/</link><pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paxos-raft-pecifaca2/</guid><description>&lt;h2 id="pacificaæ˜¯ä¸€ä¸ªæ¡†æ¶">PacificAæ˜¯ä¸€ä¸ªæ¡†æ¶ &lt;a href="#pacifica%e6%98%af%e4%b8%80%e4%b8%aa%e6%a1%86%e6%9e%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è™½ç„¶åœ¨é¢˜ç›®ä¸­æˆ‘ä»¬æŠŠPaxosã€Raftå’ŒPacificAå¹¶åˆ—ï¼Œä½†æ˜¯Paxoså’ŒRaftåœ¨è®ºæ–‡ä¸­ç§°è‡ªå·±ä¸ºä¸€ç§â€œç®—æ³•â€ï¼ˆalgorithmï¼‰ï¼›è€ŒPacificAå¯¹è‡ªå·±çš„å®šä½æ˜¯ä¸€ç§é€šç”¨çš„ï¼Œå¼ºä¸€è‡´çš„æ•°æ®åŒæ­¥&lt;strong>æ¡†æ¶&lt;/strong>ã€‚&lt;/p>
&lt;p>åœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…æåˆ°ç°æœ‰çš„å¯è¯æ˜çš„æ•°æ®åŒæ­¥åè®®å¾€å¾€è¿‡åˆ†ç®€åŒ–äº†æ€§èƒ½é—®é¢˜ï¼Œå¯¼è‡´çœ‹èµ·æ¥å¾ˆç¾çš„ç†è®ºè®¾è®¡æ— æ³•è½¬å˜æœ‰å®é™…çš„ç³»ç»Ÿï¼ˆæ³¨ï¼šæœ¬ç¯‡è®ºæ–‡åº”è¯¥æ—©äºRaftçš„è®ºæ–‡ï¼‰ã€‚æ‰€ä»¥ä½œè€…çš„ç›®æ ‡æ˜¯å°†ç®—æ³•ç†è®ºä¸å®é™…ç›¸ç»“åˆï¼Œè¿›è¡Œç›¸åº”çš„ç³»ç»Ÿè®¾è®¡ã€‚&lt;/p>
&lt;h2 id="pacificaçš„å®ç°">PacificAçš„å®ç° &lt;a href="#pacifica%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸Paxoså’ŒRaftä¸åŒçš„æ˜¯ï¼ŒPacificAé‡‡ç”¨çš„ç®—æ³•éå¸¸ç®€å•ã€‚æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä¸è¿›è¡Œå¤ªå¤šé“ºå«ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ã€‚&lt;/p>
&lt;h3 id="ä¸»ä»åŒæ­¥">ä¸»ä»åŒæ­¥ &lt;a href="#%e4%b8%bb%e4%bb%8e%e5%90%8c%e6%ad%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>PacificAä½¿ç”¨äº†ä¸»ä»åŒæ­¥æ¨¡å‹ï¼Œç”¨æˆ·çš„è¯»å†™è¯·æ±‚éƒ½ä¼šå‘å¾€ä¸»èŠ‚ç‚¹ï¼Œä»¥ä¿è¯å¼ºä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>ä¸»èŠ‚ç‚¹ä¼šå¯¹å‘æ¥çš„å†™è¯·æ±‚è¿›è¡Œç¼–å·ï¼Œä½¿å¾—æ‰€æœ‰å†™è¯·æ±‚ç¼–å·å”¯ä¸€ä¸”å•è°ƒé€’å¢ã€‚è¿™ä¸ªç¼–å·ä¹Ÿä¼šåŒæ­¥åˆ°ä»èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>æ— è®ºæ˜¯ä¸»èŠ‚ç‚¹è¿˜æ˜¯ä»èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å†™è¯·æ±‚éƒ½å†™å…¥ä¸€ä¸ªåªè¿½åŠ çš„æ—¥å¿—ã€‚ä¸»ä»èŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤&lt;code>committed&lt;/code>æŒ‡é’ˆï¼Œä»£è¡¨åœ¨è¿™ä¸ªæŒ‡é’ˆä¹‹å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ‰€æœ‰èŠ‚ç‚¹æ‰€è®¤å¯ï¼Œå¤„ç†â€œå·²ç¡®è®¤â€çŠ¶æ€ã€‚ä»èŠ‚ç‚¹éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ª&lt;code>prepared&lt;/code>æŒ‡é’ˆï¼Œä»£è¡¨åœ¨è¿™ä¸ªæŒ‡é’ˆä¹‹å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤„äºâ€œå¾…ç¡®è®¤â€çŠ¶æ€ï¼Œè€Œåœ¨&lt;code>prepared&lt;/code>æŒ‡é’ˆä¹‹åçš„æ•°æ®ï¼Œéƒ½æ˜¯â€œå¾…åŒæ­¥â€çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä¸»ä»ä¹‹é—´çš„æ•°æ®åŒæ­¥ä½¿ç”¨ä¸¤æ­¥æäº¤æ¨¡å‹ï¼ˆ2-PCï¼‰ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸»èŠ‚ç‚¹é¦–å…ˆæŠŠå†™è¯·æ±‚å†™å…¥æ—¥å¿—&lt;/li>
&lt;li>ä¸»èŠ‚ç‚¹å‘é€&lt;code>prepare&lt;/code>è¯·æ±‚åˆ°ä»èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¯·æ±‚ä¸­åŒ…å«å†™å…¥çš„æ•°æ®&lt;/li>
&lt;li>ä»èŠ‚ç‚¹æ”¶åˆ°&lt;code>prepare&lt;/code>è¯·æ±‚åï¼Œå°†æ•°æ®åŠ å…¥æ—¥å¿—ï¼Œå¹¶ç§»åŠ¨&lt;code>prepared&lt;/code>æŒ‡é’ˆï¼Œå°†å…¶æ ‡è®°ä¸ºâ€œå¾…ç¡®è®¤â€&lt;/li>
&lt;li>å½“æ‰€æœ‰ä»èŠ‚ç‚¹è¿”å›ACKåï¼Œä¸»èŠ‚ç‚¹ç§»åŠ¨&lt;code>committed&lt;/code>æŒ‡é’ˆï¼Œè¡¨æ˜è¿™ä¸ªæ•°æ®å¤„äºâ€œå¾…ç¡®è®¤â€çŠ¶æ€&lt;/li>
&lt;li>ä¸»èŠ‚ç‚¹å‘æ‰€æœ‰ä»èŠ‚ç‚¹å‘é€ACKæ¶ˆæ¯ï¼Œç¡®è®¤è¿™æ¡è¯·æ±‚å·²ç»è¢«æœ€ç»ˆç¡®è®¤&lt;/li>
&lt;li>ä»èŠ‚ç‚¹æ”¶åˆ°ACKæ¶ˆæ¯åï¼Œç§»åŠ¨&lt;code>committed&lt;/code>æŒ‡é’ˆï¼Œç¡®è®¤è¯·æ±‚&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ€»ä¼šæœ‰:&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/19-02-18/1902180052.PNG" alt="">&lt;/p>
&lt;h3 id="å…¨å±€é…ç½®ç®¡ç†å™¨">å…¨å±€é…ç½®ç®¡ç†å™¨ &lt;a href="#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86%e5%99%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>PacificAä½¿ç”¨äº†ä¸€ä¸ªâ€œä¸­å¿ƒåŒ–çš„â€å…¨å±€é…ç½®ç®¡ç†å™¨ã€‚è¿™ä¸ªç®¡ç†å™¨ç”¨äºæ¢æµ‹ç³»ç»Ÿå†…çš„å¤±æ•ˆèŠ‚ç‚¹ï¼Œç®¡ç†ã€æ›´æ–°èŠ‚ç‚¹çš„é…ç½®ã€‚è€ŒRaftæ˜¯â€œå»ä¸­å¿ƒåŒ–çš„â€ï¼Œé€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„é€‰ä¸¾é€šä¿¡æ¥ç®¡ç†é…ç½®ã€‚&lt;/p>
&lt;p>PacificAçš„å…¨å±€é…ç½®ç®¡ç†å™¨ä¿è¯åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå½“ä¸”ä»…å½“å…¨å±€é…ç½®ç®¡ç†å™¨è®¤å¯èŠ‚ç‚¹&lt;code>s&lt;/code>ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹&lt;code>s&lt;/code>æ‰ä¼šè®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>å…¨å±€é…ç½®ç®¡ç†å™¨åœ¨â€œé’¦ç‚¹â€äº†ä¸»èŠ‚ç‚¹åï¼Œä¸»èŠ‚ç‚¹ä¼šä¸ä»èŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ï¼ˆbeaconsï¼‰ï¼Œç»´æŠ¤ä¸€ä¸ªç§ŸæœŸï¼ˆleaseï¼‰ã€‚åœ¨ç§ŸæœŸå†…ï¼Œä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½ä¼šäº’ç›¸æ‰¿è®¤ç›¸äº’ä¹‹é—´çš„ä¸»ä»å…³ç³»ã€‚å½“ç§ŸæœŸå¤±æ•ˆæ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šå‘å…¨å±€é…ç½®ç®¡ç†å™¨æŠ¥å‘Šä»èŠ‚ç‚¹å¤±æ•ˆã€‚å½“ä»èŠ‚ç‚¹æ”¶ä¸åˆ°å¿ƒè·³åŒ…æ—¶ï¼Œä»èŠ‚ç‚¹ä¼šæŠ¥å‘Šä¸»èŠ‚ç‚¹å¤±æ•ˆã€‚&lt;/p>
&lt;p>ä¸€ä¸ªä¸­å¿ƒåŒ–çš„é…ç½®ç®¡ç†å™¨ä¼šè®©æ•´ä¸ªç³»ç»Ÿçš„ç»´æŠ¤å˜çš„éå¸¸ç®€å•ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å•ç‚¹å¤±æ•ˆçš„éšæ‚£ã€‚è¿™é‡Œï¼Œå…¨å±€é…ç½®ç®¡ç†å™¨ä½¿ç”¨äº†Paxosç®—æ³•æ¥ä¿è¯ç®¡ç†å™¨èŠ‚ç‚¹ä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥å®¹å¿å°‘äºåŠæ•°èŠ‚ç‚¹çš„å¤±æ•ˆã€‚&lt;/p>
&lt;h3 id="é…ç½®å˜åŒ–ä¸ç¾éš¾æ¢å¤">é…ç½®å˜åŒ–ä¸ç¾éš¾æ¢å¤ &lt;a href="#%e9%85%8d%e7%bd%ae%e5%8f%98%e5%8c%96%e4%b8%8e%e7%81%be%e9%9a%be%e6%81%a2%e5%a4%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„å…¨å±€çš„é…ç½®ç®¡ç†å™¨ï¼Œæ‰€ä»¥æ·»åŠ åˆ é™¤ä»èŠ‚ç‚¹ä¼šæ˜¯éå¸¸ç®€å•çš„äº‹æƒ…ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºä¸»èŠ‚ç‚¹çš„å¤±æ•ˆä¸ç¾éš¾æ¢å¤ã€‚&lt;/p>
&lt;p>å½“ä¸»èŠ‚ç‚¹å¤±æ•ˆä¹‹åï¼Œä»èŠ‚ç‚¹ä¼šæ­ç«¿è€Œèµ·ï¼Œå‘é…ç½®ç®¡ç†å™¨ç”³è¯·æˆä¸ºä¸»èŠ‚ç‚¹ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œæ ¹æ®ä¸Šé¢çš„è®¨è®ºï¼Œä»èŠ‚ç‚¹ä¸­çš„&lt;code>committed&lt;/code>æŒ‡é’ˆæœ‰å¯èƒ½ä¼šè½åäºä¸»èŠ‚ç‚¹ï¼Œä»¥åŠä¸åŒä»èŠ‚ç‚¹ä¸­çš„&lt;code>committed&lt;/code>æŒ‡é’ˆå¯èƒ½ä¼šä¸ä¸€è‡´ã€‚ä½†æ˜¯è¢«ä¸»èŠ‚ç‚¹ACKçš„æ•°æ®ï¼Œä¸€å®šä½äºä»èŠ‚ç‚¹çš„æ—¥å¿—ä¸­ï¼Œå¹¶å¤„äºâ€œå¾…ç¡®è®¤â€çŠ¶æ€ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åœ¨æ–°çš„ä¸»èŠ‚ç‚¹è¢«æŒ‡æ´¾ä¹‹åï¼Œä¼šé‡æ–°çš„å‘å…¶å®ƒçš„ä»èŠ‚ç‚¹å‘å‡º&lt;code>prepare&lt;/code>æŒ‡ä»¤ï¼Œè¦æ±‚ç¡®è®¤å…¶æ—¥å¿—ä¸­å¾…ç¡®è®¤çš„æ•°æ®ã€‚ä»è€Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§&lt;/p>
&lt;h2 id="pacificaçš„æ­£ç¡®æ€§çš„ç®€å•è®¨è®º">PacificAçš„æ­£ç¡®æ€§çš„ç®€å•è®¨è®º &lt;a href="#pacifica%e7%9a%84%e6%ad%a3%e7%a1%ae%e6%80%a7%e7%9a%84%e7%ae%80%e5%8d%95%e8%ae%a8%e8%ae%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸€ä¸ªå¼ºä¸€è‡´æ€§çš„ç³»ç»Ÿä¸€å®šä¼šåŒ…å«ä»¥ä¸‹ä¸‰ç§ç‰¹æ€§ï¼š&lt;/p>
&lt;ol>
&lt;li>çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰ &lt;br>
ç”±äºæˆ‘ä»¬çš„å†™è¯·æ±‚ä½äºä¸€ä¸ªåªå¯è¿½åŠ å†™çš„æ—¥å¿—å½“ä¸­ï¼Œå¹¶ä¸”ä¸åŒçš„å‰¯æœ¬çš„æ—¥å¿—ä¿æŒå¼ºä¸€è‡´ã€‚æ‰€ä»¥ä¸åŒçš„å‰¯æœ¬çš„çŠ¶æ€ä¹Ÿåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚&lt;/li>
&lt;li>å¯æŒä¹…æ€§ï¼ˆDurabilityï¼‰ &lt;br>
å¦‚æœç”¨æˆ·æ”¶åˆ°äº†ACKï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚ä¸€å®šå·²ç»æŒä¹…åŒ–åˆ°æ‰€æœ‰çš„å‰¯æœ¬ä¹‹ä¸Šäº†ã€‚å³ä½¿å‘ç”Ÿäº†ä¸»èŠ‚ç‚¹å¤±æ•ˆï¼Œæ–°çš„ä¸»èŠ‚ç‚¹ä»ä¼šç»´æŒå·²ACKçš„æ•°æ®ã€‚&lt;/li>
&lt;li>å‰è¿›æ€§ï¼ˆProgressï¼Œä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼‰ &lt;br>
å…¨å±€é…ç½®ç®¡ç†å™¨åœ¨å¤„ç†å®Œé…ç½®æ›´æ–°è¯·æ±‚åï¼Œä¸€å®šå¯ä»¥å‰”é™¤å¤±æ•ˆçš„èŠ‚ç‚¹ã€‚ä½¿å¾—æ•´ä¸ªç³»ç»Ÿå¯ä»¥å¤„ç†ç”¨æˆ·çš„è¯»å†™è¯·æ±‚ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="ä¸€äº›å…¶å®ƒçš„è®¨è®º">ä¸€äº›å…¶å®ƒçš„è®¨è®º &lt;a href="#%e4%b8%80%e4%ba%9b%e5%85%b6%e5%ae%83%e7%9a%84%e8%ae%a8%e8%ae%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="å…¨å±€é…ç½®ç®¡ç†å™¨çš„å¯ç”¨æ€§å’Œæ€§èƒ½">å…¨å±€é…ç½®ç®¡ç†å™¨çš„å¯ç”¨æ€§å’Œæ€§èƒ½ &lt;a href="#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86%e5%99%a8%e7%9a%84%e5%8f%af%e7%94%a8%e6%80%a7%e5%92%8c%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºå…¨å±€é…ç½®ç®¡ç†å™¨åœ¨é€»è¾‘ä¸Šæ˜¯æ•´ä¸ªç³»ç»Ÿçš„å•ç‚¹ï¼Œæ‰€ä»¥å…¶å¯ç”¨æ€§å’Œæ€§èƒ½æ˜¯éå¸¸å€¼å¾—å…³æ³¨çš„ã€‚&lt;/p>
&lt;p>å…¨å±€é…ç½®ç®¡ç†å™¨äº†Paxosç®—æ³•ï¼Œæ‰€ä»¥åœ¨å°‘äºä¸€åŠçš„èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œå®ƒä»èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œå…¨å±€é…ç½®ç®¡ç†å™¨çš„å¤„ç†ä¸åœ¨æ•´ä¸ªç³»ç»Ÿçš„å…³é”®è·¯å¾„ä¸Šï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚åŒæ—¶ï¼Œåœ¨ç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå³ä½¿é…ç½®ç®¡ç†å™¨æš‚æ—¶å¤±æ•ˆï¼Œä¹Ÿä¸ä¼šå½±å“ç³»ç»Ÿçš„è¿è¡Œã€‚&lt;/p>
&lt;h3 id="å¯æŒä¹…æ€§">å¯æŒä¹…æ€§ &lt;a href="#%e5%8f%af%e6%8c%81%e4%b9%85%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>PacificAçš„æ—¥å¿—åŒæ­¥é‡‡ç”¨äº†ä¸¤æ­¥æäº¤ï¼Œæ‰€ä»¥ç”¨æˆ·æ”¶åˆ°ACKæ—¶ï¼Œè¯´æ˜ç”¨æˆ·çš„å†™è¯·æ±‚å·²ç»è¢«æŒä¹…åŒ–åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¹‹ä¸Šäº†ã€‚&lt;/p>
&lt;p>è¿™æ„å‘³ç€ï¼Œåœ¨ä¸€ä¸ªæœ‰nå°æœºå™¨çš„é›†ç¾¤é‡Œï¼Œå³ä½¿æœ‰n - 1å°èŠ‚ç‚¹å¤±æ•ˆï¼Œæˆ‘ä»¬ä»èƒ½æä¾›å¯ç”¨çš„æœåŠ¡ã€‚ï¼ˆä½†æ˜¯ä¸€èˆ¬åªæä¾›åªè¯»æœåŠ¡ï¼‰&lt;/p>
&lt;h3 id="ä¸»ä»å¤åˆ¶-vs-paxos">ä¸»ä»å¤åˆ¶ vs. Paxos &lt;a href="#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6-vs-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨PaxosèŒƒå¼çš„å®ç°ä¸­ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç”¨æˆ·ç«¯è¿”å›ACKï¼Œå£°æ˜è¿™ä¸ªè¯·æ±‚å·²ç»è¢«æ•´ä¸ªç³»ç»Ÿæ‰€è®¤å¯ã€‚ä½†æ˜¯åœ¨ä¸»ä»å¤åˆ¶çš„èŒƒå¼ä¸‹ï¼Œå¿…é¡»è¦æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è®¤å¯è¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬æ‰å¯ä»¥è¯´è¿™ä¸ªè¯·æ±‚è¢«æ•´ä¸ªç³»ç»Ÿæ‰€è®¤å¯ã€‚&lt;/p>
&lt;p>å› ä¸ºè¿™ä¸¤ç§èŒƒå¼ä¹‹é—´çš„ä¸åŒç­–ç•¥å¯¼è‡´äº†å¾®å¦™çš„å·®åˆ«ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºï¼ŒPaxosèŒƒå¼ä¸­å¯¹äºå•ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½æ³¢åŠ¨å¹¶ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¸»ä»å¤åˆ¶çš„ä¸€ä¸ªæ…¢èŠ‚ç‚¹å¯èƒ½ä¼šæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œå¦‚æœç³»ç»Ÿä¸­å¤šæ•°èŠ‚ç‚¹å…¨éƒ¨å¤±æ•ˆï¼Œé‚£ä¹ˆPaxosèŒƒå¼å°±æ— æ³•æä¾›æœåŠ¡äº†ï¼ˆè¯»/å†™éƒ½ä¸å¯ä»¥çš„ï¼‰ï¼›å¯¹äºä¸»ä»å¤åˆ¶èŒƒå¼ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å­˜æ´»çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä¿æŒå¼ºä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>æ›´é‡è¦çš„æ˜¯ï¼Œä½¿ç”¨å•ç‚¹æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„é…ç½®ï¼Œå¹¶è®©å¼€å‘ä¸è¿ç»´çš„æˆæœ¬é™ä½ã€‚æ¢åšPaxosèŒƒå¼ï¼Œä¸€ä¸ªèŠ‚ç‚¹è‹¥è¦æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦åŒå¤šæ•°èŠ‚ç‚¹è¿›è¡Œåå•†ã€‚&lt;/p>
&lt;p>è¿™ä¸¤ç§èŒƒå¼çš„é€‰æ‹©æ˜¯éå¸¸æœ‰äº‰è®®çš„ï¼ŒPecificAé€‰æ‹©ä¸»ä»å¤åˆ¶çš„ä¸»è¦åŸå› å°±æ˜¯å› ä¸ºå®ƒç®€å•ã€‚ï¼ˆå¤ªå®åœ¨äº†ï¼‰&lt;/p>
&lt;h3 id="åœ¨å¼ºä¸€è‡´æ€§ä¸Šçš„å¦¥å">åœ¨å¼ºä¸€è‡´æ€§ä¸Šçš„å¦¥å &lt;a href="#%e5%9c%a8%e5%bc%ba%e4%b8%80%e8%87%b4%e6%80%a7%e4%b8%8a%e7%9a%84%e5%a6%a5%e5%8d%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœéœ€è¦æ”¾æ¾å¯¹å¼ºä¸€è‡´æ€§çš„è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä»èŠ‚ç‚¹æ”¯æŒè¯»è¯·æ±‚ã€‚è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯æˆ‘ä»¬æœ‰å¯èƒ½è¯»åˆ°é™ˆæ—§çš„æ•°æ®ï¼Œç”±å¼ºä¸€è‡´æ€§é€€åŒ–åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>æœ€ç»ˆä¸€è‡´æ€§ä»æœ¬è´¨ä¸Šè¯´éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè¦æ±‚ï¼š&lt;/p>
&lt;ol>
&lt;li>æ‰€æœ‰çš„èŠ‚ç‚¹éœ€è¦ä»¥åŒæ ·çš„é¡ºåºæ‰§è¡ŒåŒæ ·çš„çŠ¶æ€æ›´æ–°æ“ä½œ&lt;/li>
&lt;li>åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œå¿…é¡»è¿”å›æœ€æ–°çš„çŠ¶æ€&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœæ”¾æ¾ç¬¬ä¸€ä¸ªè¦æ±‚ï¼Œå°±ä¼šé¢ä¸´â€œçŠ¶æ€åˆ†å‰â€çš„é—®é¢˜ï¼ˆåƒgit branchä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†è¿™ç§ä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆåƒgit rebaseä¸€æ ·ï¼‰ã€‚è¿™å°±ä¼šå¸¦æ¥é¢å¤–çš„å¤æ‚æ€§å’Œä¸ç¡®å®šæ€§ã€‚&lt;/p>
&lt;p>æ”¾æ¾ç¬¬äºŒä¸ªè¦æ±‚æ˜¯æ›´åŠ ç†æ€§çš„ï¼Œå› ä¸ºåœ¨PecificAä¸­ï¼Œæ‰€æœ‰çš„çŠ¶æ€å˜åŒ–å…¨éƒ½è¢«å†™å…¥ä¸€ä¸ªâ€œåªå¯è¿½åŠ å†™â€çš„æ—¥å¿—ä¸­ã€‚å¹¶ä¸”å½“å‰çš„çŠ¶æ€å˜åŒ–é€šè¿‡æ—¥å¿—æŒ‡é’ˆçš„ç§»åŠ¨æ¥è¡¨ç¤ºã€‚åˆå› ä¸ºä»èŠ‚ç‚¹çš„æ—¥å¿—ä¸€å®šæ˜¯ä¸»èŠ‚ç‚¹çš„å‰è¾ï¼Œå¹¶ä¸”æ—¥å¿—æŒ‡é’ˆç¨å¾®è½åä¸ä¸»èŠ‚ç‚¹ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥æ”¾æ¾å¼ºä¸€è‡´æ€§çš„è¦æ±‚ï¼Œå°±å¯ä»¥è®©ä»èŠ‚ç‚¹æ¥å¤„ç†è¯»è¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿˜æœ‰å¥½å¤šä¸œè¥¿æ²¡è¯»é€å‘¢ã€‚è¦ä¸å†é¥¶ä¸€ç¯‡ï¼Ÿ&lt;/p></description></item><item><title>C++ç±»å‹æ“¦é™¤ä¸`std::function`æ€§èƒ½æ¢ç´¢</title><link>https://wizmann.top/posts/cpp-type-erasure-and-std-function/</link><pubDate>Fri, 01 Feb 2019 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/cpp-type-erasure-and-std-function/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤">ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤ &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºPythonè¿™ç§åŠ¨æ€ç±»å‹è¯­è¨€æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨â€œç±»å‹æ“¦é™¤â€è¿™ä¸ªæ¦‚å¿µçš„ã€‚Pythonå¯¹è±¡çš„è¡Œä¸ºå¹¶ä¸ç”±æ¥å£å®šä¹‰ï¼Œè€Œæ˜¯ç”±â€œå½“å‰æ–¹æ³•å’Œå±æ€§çš„é›†åˆâ€å†³å®šã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œä»¥ä¸‹çš„ä»£ç æ˜¯å®Œå…¨åˆæ³•çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">print&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">print&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;bar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(obj):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print obj&lt;span style="color:#f92672">.&lt;/span>print()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Foo()) &lt;span style="color:#f92672">//&lt;/span> print &lt;span style="color:#e6db74">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Bar()) &lt;span style="color:#f92672">//&lt;/span> print &lt;span style="color:#e6db74">&amp;#39;bar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯å¯¹äºC++è¿™ç§é™æ€ç±»å‹è¯­è¨€æ¥è®²ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨è¿™ç§è¯­æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(&lt;span style="color:#f92672">???&lt;/span> obj) { &lt;span style="color:#75715e">// &amp;lt;--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> obj.print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Foo());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>do_print(Bar());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç†Ÿæ‚‰C++çš„åŒå­¦ä»¬éƒ½çŸ¥é“ï¼Œå› ä¸º&lt;code>Foo&lt;/code>å’Œ&lt;code>Bar&lt;/code>çš„ç±»å‹ä¸åŒï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†ä¸åŒç±»å‹çš„å®ä¾‹ä¼ å…¥&lt;code>do_print(obj)&lt;/code>å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ“¦é™¤ç±»å‹ä¿¡æ¯ï¼Œæä¾›ä¸€ç§ç±»å‹çš„æŠ½è±¡ã€‚ä½¿å¾—å®ç°ä¸ä¾èµ–äºå…·ä½“ç±»å‹ï¼Œè€Œæ˜¯ä¾èµ–äºç±»å‹æŠ½è±¡ã€‚&lt;/p>
&lt;h2 id="cä¸­ç±»å‹æ“¦é™¤çš„å®ç°">C++ä¸­ç±»å‹æ“¦é™¤çš„å®ç° &lt;a href="#c%e4%b8%ad%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ç®€å•ç²—æš´---void">ç®€å•ç²—æš´ - &lt;code>void*&lt;/code> &lt;a href="#%e7%ae%80%e5%8d%95%e7%b2%97%e6%9a%b4---void" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å†™è¿‡Cè¯­è¨€åŒå­¦ä»¬ä¸€å®šéå¸¸ç†Ÿæ‚‰&lt;code>qsort&lt;/code>å‡½æ•°çš„å†™æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// http://www.cplusplus.com/reference/cstdlib/qsort/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">compare&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ( &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)a &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)b );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> values[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">qsort&lt;/span> (values, &lt;span style="color:#ae81ff">6&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>), compare);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>; i&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">printf&lt;/span> (&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>,values[n]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„&lt;code>compare(const void*, const void*)&lt;/code>å‡½æ•°å°±æ˜¯Cè¯­è¨€é£æ ¼çš„ç±»å‹æ“¦é™¤ï¼Œå¯ä»¥æ”¯æŒä¸åŒç±»å‹çš„æŒ‡é’ˆç±»å‹ä¼ å…¥ã€‚ä½†æ˜¯ç¼ºé™·æ˜¯åœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å°†å·²æ“¦é™¤çš„ç±»å‹æ¢å¤ï¼Œä»¥è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;p>è¿™ç§ç±»å‹æ“¦é™¤æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå¸¦å¼€é¢å¤–çš„å¼€é”€ã€‚ä½†æ˜¯è¿™æ ·çš„å¼ºåˆ¶ç±»å‹éšå«ç€ç±»å‹ä¸åŒ¹é…çš„é£é™©ï¼Œéœ€è¦ç¨‹åºå‘˜æ ¼å¤–æ³¨æ„ã€‚&lt;/p>
&lt;h3 id="é¢å‘å¯¹è±¡çš„ç»å…¸æ–¹æ³•---è™šå‡½æ•°virtual-function">é¢å‘å¯¹è±¡çš„ç»å…¸æ–¹æ³• - è™šå‡½æ•°ï¼ˆvirtual functionï¼‰ &lt;a href="#%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bb%8f%e5%85%b8%e6%96%b9%e6%b3%95---%e8%99%9a%e5%87%bd%e6%95%b0virtual-function" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>C++åšä¸ºCè¯­è¨€çš„è¿›åŒ–ï¼Œå¼•å…¥äº†é¢å‘å¯¹è±¡çš„ç†å¿µã€‚è€Œå¤šæ€ï¼Œåšä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œä¸ºæˆ‘ä»¬çš„ä»£ç å¸¦æ¥äº†æ›´å¤šçš„å¼¹æ€§ã€‚&lt;/p>
&lt;p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ¥å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">IPrintable&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IPrintable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Bar&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> IPrintable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> print() { cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bar&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> endl; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">do_print&lt;/span>(IPrintable&lt;span style="color:#f92672">*&lt;/span> obj) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obj&lt;span style="color:#f92672">-&amp;gt;&lt;/span>print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_print(&lt;span style="color:#66d9ef">new&lt;/span> Foo());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_print(&lt;span style="color:#66d9ef">new&lt;/span> Bar());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª&lt;code>IPrintable&lt;/code>åŸºç±»ï¼Œæ“¦é™¤äº†å­ç±»&lt;code>Foo&lt;/code>å’Œ&lt;code>Bar&lt;/code>çš„å…·ä½“ç±»å‹ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å­ç±»å®ç°äº†åŸºç±»çš„æ¥å£ï¼Œå°±å¯ä»¥åšä¸ºå‚æ•°ä¼ å…¥&lt;code>do_print(obj)&lt;/code>ä¸­ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬åªéœ€è¦ä¸ºç»§æ‰¿åŒæ ·æ¥å£çš„ç±»å‹å®Œæˆä¸€å¥—å®ç°ï¼Œæä¾›äº†æ›´å¥½çš„å°è£…ä¸æŠ½è±¡ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œè¿™ç§å®ç°çš„é—®é¢˜åœ¨äºè™šå‡½æ•°çš„è°ƒç”¨æ˜¯æœ‰é¢å¤–çš„å¼€é”€çš„ã€‚éœ€è¦è¿›è¡Œä¸€æ¬¡è¿è¡Œæ—¶è™šè¡¨çš„æŸ¥æ‰¾ï¼Œæ‰å¯ä»¥ç¡®å®šå¯¹è±¡éœ€è¦è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ¨¡æ¿template">ä½¿ç”¨æ¨¡æ¿ï¼ˆtemplateï¼‰ &lt;a href="#%e4%bd%bf%e7%94%a8%e6%a8%a1%e6%9d%bftemplate" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>C++æä¾›äº†æ¨¡æ¿ï¼Œæ”¯æŒå°†ç±»å‹ä»¥æ¨¡æ¿å‚æ•°å½¢å¼ä¼ å…¥å‚æ•°ã€‚ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥ä¸€ç§ç‹¬ç«‹äºç‰¹å®šç±»å‹çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ”¹å†™ä¸Šæ–‡ä¸­çš„&lt;code>do_print(obj)&lt;/code>å‡½æ•°ï¼Œä½¿å…¶å¯ä»¥æ”¯æŒä¸åŒçš„ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> do_print(T obj) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> obj.print();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œï¼Œä¼ å…¥å‚æ•°çš„ç±»å‹&lt;code>T&lt;/code>æ— éœ€ç»§æ‰¿&lt;code>IPrintable&lt;/code>æ¥å£ï¼Œåªè¦å…¶å®ç°äº†&lt;code>print()&lt;/code>æˆå‘˜å‡½æ•°å³å¯åšä¸ºå¯¹è±¡ä¼ å…¥ã€‚&lt;/p>
&lt;p>C++æ¨¡æ¿çš„ç±»å‹æ“¦é™¤ä½œç”¨äºç¼–è¯‘æœŸï¼Œå¯ä»¥å°½æ—©çš„å‘ç°é£é™©ï¼ŒåŒæ—¶ï¼ˆä¸€èˆ¬æ¥è¯´ï¼‰ä¸å½±å“è¿è¡Œæ—¶çš„æ€§èƒ½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨æ„ï¼šJava/C#çš„æ³›å‹(generic)è¯­æ³•ä¸C++çš„æ¨¡æ¿éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯Java/C#çš„æ³›å‹æ˜¯ä½œç”¨äºè¿è¡Œæ—¶çš„ã€‚è¿™é‡Œæ³¨æ„åŒºåˆ†äºŒè€…çš„åŒºåˆ«ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ä½†æ˜¯æ¨¡æ¿ä¹Ÿæœ‰å…¶å±€é™æ€§ã€‚æ¨¡æ¿æœ‰éšå«çš„æ¥å£è¯­ä¹‰ï¼Œä½†æ˜¯ç”±äºæ¨¡æ¿æ‰€ä½¿ç”¨çš„å¯¹è±¡å¹¶æ²¡æœ‰å…±åŒçš„åŸºç±»ï¼ˆæ¥å£ï¼‰ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„å®¹å™¨æ¥å‚¨å­˜å¯¹è±¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">???&lt;/span> objs[] &lt;span style="color:#f92672">=&lt;/span> { &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">Foo&lt;/span>(), &lt;span style="color:#66d9ef">new&lt;/span> Bar() };
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cç±»å‹æ“¦é™¤å®æˆ˜--stdfunction">C++ç±»å‹æ“¦é™¤å®æˆ˜ â€”â€” &lt;code>std::function&lt;/code> &lt;a href="#c%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4%e5%ae%9e%e6%88%98--stdfunction" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ªå‡½æ•°å¯¹è±¡åªèƒ½ä½¿ç”¨å‡½æ•°æœ¬èº«ä»¥åŠå‡½æ•°æŒ‡é’ˆã€‚ä½†æ˜¯åœ¨C++ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†æ›´å¤šçš„é€‰æ‹©ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡½æ•°&lt;/li>
&lt;li>inline lambda&lt;/li>
&lt;li>å‡½æ•°æŒ‡é’ˆï¼ˆC-styleï¼‰&lt;/li>
&lt;li>ä»¿å‡½æ•°ï¼ˆfactor classï¼‰&lt;/li>
&lt;li>&lt;code>std::bind&lt;/code>&lt;/li>
&lt;li>&lt;code>std::function&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢çš„è¿™äº›å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸ºå¯è°ƒç”¨ï¼ˆcallableï¼‰å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼&lt;code>f(obj)&lt;/code>çš„è¯­æ³•ï¼Œä»¥å‡½æ•°å½¢å¼è°ƒç”¨è¿™äº›å¯¹è±¡ã€‚&lt;/p>
&lt;p>æ€è€ƒä»¥ä¸‹çš„åœºæ™¯ï¼šæˆ‘ä»¬æƒ³è¦å®ç°ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œå¯ä»¥æ˜¯ä»¥ä¸Šå¯è°ƒç”¨å¯¹è±¡çš„ä»»æ„ä¸€ç§ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ç”¨ä»€ä¹ˆç±»å‹æ¥è¡¨ç¤ºè¿™ä¸ªå›è°ƒå‡½æ•°å¯¹è±¡å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ˜¯çš„ï¼Œç­”æ¡ˆå°±æ˜¯&lt;code>std::function&lt;/code>ã€‚C++ä¸­çš„&lt;code>std::function&lt;/code>ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹å¯è°ƒç”¨å¯¹è±¡çš„æŠ½è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>std::function&lt;/code>å°è£…å¯è°ƒç”¨å¯¹è±¡ï¼Œä»è€Œæ“¦é™¤å…¶ç±»å‹ä¿¡æ¯ï¼Œä½¿ç”¨ç»Ÿä¸€çš„æ–¹æ³•å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚&lt;/p>
&lt;p>è¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// http://www.cplusplus.com/reference/functional/function/function/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e"> &lt;/span>&lt;span style="color:#75715e">// std::cout
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;functional&amp;gt;&lt;/span>&lt;span style="color:#75715e"> &lt;/span>&lt;span style="color:#75715e">// std::function, std::negate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a function:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">half&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a function object class:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">third_t&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">operator&lt;/span>()(&lt;span style="color:#66d9ef">int&lt;/span> x) {&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a class with data members:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyValue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">fifth&lt;/span>() {&lt;span style="color:#66d9ef">return&lt;/span> value&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>;}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn1 &lt;span style="color:#f92672">=&lt;/span> half; &lt;span style="color:#75715e">// function
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>half; &lt;span style="color:#75715e">// function pointer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn3 &lt;span style="color:#f92672">=&lt;/span> third_t(); &lt;span style="color:#75715e">// function object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn4 &lt;span style="color:#f92672">=&lt;/span> [](&lt;span style="color:#66d9ef">int&lt;/span> x){&lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>;}; &lt;span style="color:#75715e">// lambda expression
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fn5 &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>negate&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>(); &lt;span style="color:#75715e">// standard function object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn1(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn1(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn2(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn2(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn3(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn3(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn4(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn4(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fn5(60): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fn5(&lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// stuff with members:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(MyValue&lt;span style="color:#f92672">&amp;amp;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>MyValue&lt;span style="color:#f92672">::&lt;/span>value; &lt;span style="color:#75715e">// pointer to data member
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>function&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>(MyValue&lt;span style="color:#f92672">&amp;amp;&lt;/span>)&lt;span style="color:#f92672">&amp;gt;&lt;/span> fifth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>MyValue&lt;span style="color:#f92672">::&lt;/span>fifth; &lt;span style="color:#75715e">// pointer to member function
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyValue sixty {&lt;span style="color:#ae81ff">60&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;value(sixty): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> value(sixty) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fifth(sixty): &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> fifth(sixty) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\n&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="stdfunctionçš„ç¼ºé™·">&lt;code>std::function&lt;/code>çš„ç¼ºé™· &lt;a href="#stdfunction%e7%9a%84%e7%bc%ba%e9%99%b7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>std::function&lt;/code>çš„ç±»å‹æ“¦é™¤åŠŸèƒ½å¼‚å¸¸å¼ºå¤§ï¼Œå‡ ä¹å¯ä»¥å°è£…æ‰€æœ‰çš„å¯è°ƒç”¨ç±»å‹ã€‚ä½†æ˜¯ï¼Œè¯­æ³•ä¸Šé¢çš„ä¾¿åˆ©å´ä¼šå¸¦æ¥äº†æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚&lt;/p>
&lt;p>ä»&lt;a href="https://gist.github.com/Wizmann/30073037f31d796efd6f42798dd85aee">benchmark&lt;/a>ç»“æœä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨&lt;code>O2&lt;/code>çš„ä¼˜åŒ–å‚æ•°ä¸‹ï¼Œå‡½æ•°è°ƒç”¨ï¼ˆåŒ…æ‹¬å‡½æ•°ã€å‡½æ•°æ¨¡æ¿å’Œä»¿å‡½æ•°ï¼‰ã€å‡½æ•°æŒ‡é’ˆå’Œlambdaçš„æ€§èƒ½ç›¸ä»¿ã€‚è€Œè™šå‡½æ•°å¤§æ¦‚éœ€è¦èŠ±è´¹5å€å·¦å³çš„æ—¶é—´ï¼Œè€Œ&lt;code>std::function&lt;/code>åˆ™éœ€è¦èŠ±è´¹6å€ä»¥ä¸Šçš„æ—¶é—´ã€‚å¯¹äºä¸€ä¸ªä¼šè¢«ç»å¸¸è°ƒç”¨åˆ°çš„å‡½æ•°ï¼Œå¸¦æ¥çš„é¢å¤–çš„æ€§èƒ½å¼€é”€æ˜¯ä¸å¯ä»¥å¿½ç•¥çš„ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>method&lt;/th>
&lt;th style="text-align: right">Linux (Azure VM, E5-2673 v3, -O0)&lt;/th>
&lt;th style="text-align: right">Linux (Azure VM, E5-2673 v3, -O2)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Function&lt;/td>
&lt;td style="text-align: right">12.4s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Function Ptr&lt;/td>
&lt;td style="text-align: right">13.5s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Inline Lambda&lt;/td>
&lt;td style="text-align: right">12.7s&lt;/td>
&lt;td style="text-align: right">1.2s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Virtual Function&lt;/td>
&lt;td style="text-align: right">14.1s&lt;/td>
&lt;td style="text-align: right">6.3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>std::function&lt;/td>
&lt;td style="text-align: right">77.3s&lt;/td>
&lt;td style="text-align: right">7.2s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ç©¶å…¶åŸå› ï¼Œæ˜¯ç”±äº&lt;code>std::function&lt;/code>çš„æ¨¡æ¿å‚æ•°ä¸­åªæä¾›äº†å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹ï¼Œæ‰€ä»¥ä¸ºäº†è¿›è¡Œç±»å‹æ“¦é™¤ï¼Œå…¶ä¸­å†…ç½®äº†ä¸€ä¸ªè™šå‡½æ•°ã€‚æ‰€ä»¥ä¸€æ¬¡&lt;code>std::function&lt;/code>è°ƒç”¨ä¼šå¼•å‘éšå¼çš„å¤šæ¬¡å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­è¿˜åŒ…å«ç€ä¸€æ¬¡è™šå‡½æ•°çš„è°ƒç”¨ã€‚æ‰€ä»¥æ€§èƒ½ä¸‹é™ä¹Ÿå°±ä¸éš¾è§£é‡Šäº†ã€‚&lt;/p>
&lt;h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œé™¤éå¿…è¦ï¼Œä¸è¦ä½¿ç”¨&lt;code>std::function&lt;/code>ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œåœ¨&lt;code>std::sort&lt;/code>ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿ä¼ å…¥å¯è°ƒç”¨ç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…&lt;code>std::function&lt;/code>çš„é¢å¤–å¼€é”€ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RandomIt&lt;/span>, &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Compare&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> sort( RandomIt first, RandomIt last, Compare comp );
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨ä¸åŒçš„å¯è°ƒç”¨ç±»å‹æ¥è§„é¿ç±»å‹æ“¦é™¤ï¼Œå¦‚ç»Ÿä¸€ä½¿ç”¨å‡½æ•°æŒ‡é’ˆã€‚åœ¨C++14ä¹‹åï¼Œinline lambdaä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºå‡½æ•°æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é—­åŒ…æ¥å°è£…å…¶å®ƒçš„å¯è°ƒç”¨å¯¹è±¡äº†ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±é€ ä¸ª&lt;a href="https://codereview.stackexchange.com/questions/14730/impossibly-fast-delegate-in-c11">è½®å­&lt;/a>ï¼Œè¿™å°±åˆæ˜¯å¦ä¸€ä¸ªæ•…äº‹äº†ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ–°çš„C++è§„èŒƒç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šçš„è¯­æ³•ç³–ã€‚å¯¹äºä¼ ç»ŸC++ç¨‹åºå‘˜æ¥è¯´ï¼Œå¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥å†™å‡ºæ›´èˆ’æœçš„ï¼Œæ›´ç¬¦åˆç›´è§‰çš„ä»£ç ï¼Œä½†ç¼ºç‚¹æ˜¯æˆ‘ä»¬éœ€è¦äº†è§£æ›´å¤šè¯­è¨€èƒŒåçš„ä¸œè¥¿ã€‚æ‰€ä»¥å¯¹äºè‡ªå·±ä¸ç†Ÿæ‚‰çš„æ–°å¼è¯­æ³•ï¼Œæ— è®ºçœ‹èµ·æ¥å¤šä¹ˆè¯±äººï¼Œä¹Ÿéœ€è¦å¤šåŠ è°¨æ…ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/Wizmann/30073037f31d796efd6f42798dd85aee">Benchmark for &amp;ldquo;function pointer&amp;rdquo;, &amp;ldquo;virtual function&amp;rdquo; and &amp;ldquo;std::function&amp;rdquo;&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.modernescpp.com/index.php/c-core-guidelines-type-erasure">C++ Core Guidelines: Type Erasure&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://davekilian.com/cpp-type-erasure.html">C++ &amp;lsquo;Type Erasure&amp;rsquo; Explained&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>åœ¨WSLä¸­è·å–Windowså‰ªè´´æ¿ä¸­çš„å›¾ç‰‡</title><link>https://wizmann.top/posts/get-image-from-clipboard-in-wsl.md/</link><pubDate>Fri, 04 Jan 2019 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/get-image-from-clipboard-in-wsl.md/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Win10é‡Œé¢çš„WSLï¼ˆWindows Subsystem For Linux)ç®—æ˜¯ä¸€ä¸ªå¼€å‘ç¥å™¨äº†ï¼Œè™½ç„¶åŠŸèƒ½ä¸æ˜¯100%å®Œå–„ï¼Œä½†æ˜¯å¯¹äºè½»åº¦å¼€å‘å·²ç»è¶³å¤Ÿäº†ã€‚ç°åœ¨æˆ‘çš„æ—¥å¸¸å¼€å‘ï¼Œå°±æ˜¯ä¸€ä¸ªå…¨å±CMDè·‘å†…éƒ¨å·¥å…·ï¼Œä¸€ä¸ªå…¨å±WSLè·‘tmux+vimã€‚&lt;/p>
&lt;p>ï¼ˆè·‘é¢˜äº†ï¼‰&lt;/p>
&lt;h2 id="é—®é¢˜">é—®é¢˜ &lt;a href="#%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘æœ‰å†™åˆ°ä½¿ç”¨githubåšä¸ºå›¾åºŠï¼Œå¹¶ä¸”ä½¿ç”¨pythonè„šæœ¬è¿›è¡Œå›¾ç‰‡ä¸Šä¼ ã€‚ä½†æ˜¯ä»æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå°±æ˜¯ä¹‹å‰çš„è„šæœ¬åªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥ä¸Šä¼ å‰ªè´´æ¿é‡Œçš„å›¾ç‰‡ã€‚&lt;/p>
&lt;h2 id="è§£å†³">è§£å†³ &lt;a href="#%e8%a7%a3%e5%86%b3" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å‘ç°Windowsé‡Œé¢æœ‰å†…ç½®çš„è®¿é—®å‰ªè´´æ¿å·¥å…·ï¼Œä½†æ˜¯åªåœ¨powershellä¸‹å¯ç”¨ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨WSLé‡Œç›´æ¥è°ƒç”¨exeæ–‡ä»¶ï¼ˆè¿™ç‚¹éå¸¸ç¥å¥‡ï¼‰ï¼Œç„¶åè¯»å‡ºå›¾ç‰‡æ–‡ä»¶æ”¾å…¥ä¸´æ—¶æ–‡ä»¶å¤¹ã€‚ç„¶åæˆ‘ä»¬å†è¯»å‡ºè¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¸Šä¼ ã€‚&lt;/p>
&lt;p>æ€»çš„æµç¨‹ä»ç„¶æ˜¯ä¸Šä¼ å·²æœ‰çš„å›¾ç‰‡æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹å¹¶éšè—äº†èµ·æ¥ã€‚çœ‹èµ·æ¥å°±æ˜¯å®ç°äº†WSLå’ŒWindowså‰ªè´´æ¿çš„äº’æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TMP&lt;span style="color:#f92672">=&lt;/span>/mnt/c/Users/me/AppData/Local/Temp/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TMPWIN&lt;span style="color:#f92672">=&lt;/span>C:&lt;span style="color:#ae81ff">\\&lt;/span>Users&lt;span style="color:#ae81ff">\\&lt;/span>me&lt;span style="color:#ae81ff">\\&lt;/span>AppData&lt;span style="color:#ae81ff">\\&lt;/span>Local&lt;span style="color:#ae81ff">\\&lt;/span>Temp&lt;span style="color:#ae81ff">\\&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ts&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>date +&lt;span style="color:#e6db74">&amp;#34;%Y-%m-%d_%H-%M-%S&amp;#34;&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;(Get-Clipboard -Format Image).Save(\&amp;#34;&lt;/span>$TMPWIN&lt;span style="color:#e6db74">\\&lt;/span>$ts&lt;span style="color:#e6db74">.png\&amp;#34;)&amp;#34;&lt;/span> | /mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe &amp;amp;&amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> $? -ne &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo &lt;span style="color:#e6db74">&amp;#34;no image in clipboard&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> python upload.py $TMP/$ts.png
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç™½è¯ä¸€è‡´æ€§åè®® - Paxosã€Raftå’ŒPacificA[1]</title><link>https://wizmann.top/posts/paxos-raft-pecifaca1/</link><pubDate>Wed, 05 Dec 2018 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paxos-raft-pecifaca1/</guid><description>&lt;h2 id="ä¹¦æ¥ä¸Šæ–‡---multi-paxos">ä¹¦æ¥ä¸Šæ–‡ - Multi Paxos &lt;a href="#%e4%b9%a6%e6%8e%a5%e4%b8%8a%e6%96%87---multi-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†Basic Paxoså’ŒMulti Paxosçš„å¼‚åŒã€‚åœ¨&lt;a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">Paxos Made Simple&lt;/a>è®ºæ–‡ä¸­ï¼Œä½œè€…æåˆ°äº†Multi Paxosçš„ä¸€ç§å®ç°ã€‚è¿™ä¸ªå®ç°å…è®¸æˆ‘ä»¬å¯¹ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºå¤åˆ¶æ—¥å¿—ï¼Œreplicated logï¼‰è¾¾æˆå…±è¯†ï¼Œä»è€Œå®ç°èŠ‚ç‚¹çŠ¶æ€çš„ä¸€è‡´æ€§å¤åˆ¶ã€‚&lt;/p>
&lt;h3 id="ç¡®å®šæ€§çŠ¶æ€æœº">ç¡®å®šæ€§çŠ¶æ€æœº &lt;a href="#%e7%a1%ae%e5%ae%9a%e6%80%a7%e7%8a%b6%e6%80%81%e6%9c%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å¯ä»¥å°†ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æŠ½è±¡ä¸ºä¸€ä¸ªæœ‰ç€ç¡®å®šæ€§çŠ¶æ€æœºï¼Œå³ç»™å®šå¤šä¸ªçŠ¶æ€ä¸€è‡´çš„çŠ¶æ€æœºï¼Œåœ¨æ‰§è¡ŒåŒä¸€ä¸ªå‘½ä»¤ä¹‹åï¼Œå…¶çŠ¶æ€ä»ä¿æŒä¸€è‡´ã€‚ï¼ˆå¯ä»¥æƒ³ä¸€æƒ³ç¼–è¯‘åŸç†é‡Œé¢çš„DFAï¼‰&lt;/p>
&lt;h3 id="leader---ç³»ç»Ÿä¸­å”¯ä¸€çš„proposer">Leader - ç³»ç»Ÿä¸­å”¯ä¸€çš„proposer &lt;a href="#leader---%e7%b3%bb%e7%bb%9f%e4%b8%ad%e5%94%af%e4%b8%80%e7%9a%84proposer" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨æœ‰å¤šä¸ªproposerï¼Œé‚£ä¹ˆå°±å¾ˆå¯èƒ½ä¼šå‡ºç°å¤šä¸ªææ¡ˆç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚è™½ç„¶æ ¹æ®è¯æ˜ï¼Œæœ€ç»ˆè¿™äº›ææ¡ˆéƒ½ä¼šæ”¶æ•›åˆ°ä¸€è‡´ï¼Œä½†æ˜¯æ€§èƒ½ä¼šéå¸¸ä½ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­é€šè¿‡é€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªleaderåšä¸ºä¸»proposerï¼ˆdistinguishied proposerï¼‰ï¼Œæ‰€æœ‰çš„ææ¡ˆéƒ½ç”±leaderæå‡ºã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸ä¼šå‡ºç°ææ¡ˆç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚åªæœ‰åœ¨leaderåˆ‡æ¢çš„ç¬é—´ï¼Œå¯èƒ½ä¼šå‡ºç°ç›¸åŒç¼–å·çš„ä¸åŒææ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç®—æ³•å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™ç§æƒ…å†µã€‚&lt;/p>
&lt;h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„tcp">åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„â€œTCPâ€ &lt;a href="#%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%ad%e7%9a%84tcp" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç±»ä¼¼äºTCPåè®®ä¸­åºåˆ—å·ï¼ŒMulti Paxosä¸­çš„æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æœ‰ä¸€ä¸ªé€’å¢çš„ç¼–å·ã€‚å³æˆ‘ä»¬å‰ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤æ˜¯100å·ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ä¸€å®šæ˜¯101å·ã€‚æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸€ä¸ªPaxoså®ä¾‹ï¼ŒLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘å¸ƒè¿™ä¸ªææ¡ˆï¼Œåœ¨ææ¡ˆè¾¾æˆä¸€è‡´ä¹‹åï¼ˆå¤šæ•°èŠ‚ç‚¹è¿”å›ACKï¼‰ï¼Œå°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªå‘½ä»¤å·²ç»è¾¾æˆäº†ä¸€è‡´ã€‚&lt;/p>
&lt;p>å’ŒTCPä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬é¡ºåºçš„å‘å¸ƒå¹¶è¡¨å†³ææ¡ˆï¼Œæ•ˆç‡ä¼šéå¸¸ä½ä¸‹ï¼ˆTCPåœç­‰æ¨¡å‹ï¼‰ã€‚æ‰€ä»¥ï¼ŒMulti Paxosé‡‡ç”¨ç±»ä¼¼æ»‘åŠ¨çª—å£çš„æ–¹æ¡ˆï¼Œæ¯æ¬¡å¯¹Nä¸ªææ¡ˆè¿›è¡Œè¡¨å†³ï¼Œä»¥å¢åŠ è¡¨å†³çš„å¸¦å®½ã€‚&lt;/p>
&lt;p>å’ŒTCPä¸åŒçš„æ˜¯ï¼Œå¦‚æœæŸäº›åºå·çš„TCPåŒ…åœ¨ä¼ è¾“ä¸­ä¸¢å¤±ï¼Œæœ€åçš„æƒ…å†µæ˜¯æˆ‘ä»¬ä¼šRSTè¿™æ¡é“¾æ¥ï¼Œå…¶å®ƒçš„å·¥ä½œéƒ½äº¤ç»™åº”ç”¨å±‚é€»è¾‘æ¥è§£å†³ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¯¹äºMulti Paxosæ¥è¯´ï¼Œå¦‚æœæŸäº›ææ¡ˆæ²¡æœ‰è¢«è¡¨å†³ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨æ—¥å¿—ä¸­ç•™ä¸‹ç©ºæ´ï¼ˆgapï¼‰ã€‚è¿™ä¼šç›´æ¥å½±å“ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚å¦‚æœæ°å·§è¿™ä¸ªæ—¶å€™å‘ç”Ÿäº†Leaderå¤±æ•ˆï¼Œé‚£ä¹ˆæ–°é€‰ä¸¾å‡ºæ¥çš„LeaderèŠ‚ç‚¹å°±è¦å¤„ç†æ—¥å¿—ä¸­çš„ç©ºæ´ã€‚&lt;/p>
&lt;p>è§£å†³ç©ºæ´çš„åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯Leaderå‘æ‰€æœ‰æˆå‘˜è¯¢é—®ï¼Œå¯¹äºè¿™ä¸ªææ¡ˆï¼Œæ˜¯å¦å·²ç»æœ‰è¾¾æˆå…±è¯†çš„å€¼ã€‚å¦‚æœæœ‰çš„è¯ï¼Œå°±ä½¿ç”¨è¿™ä¸ªå€¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨ä¸€ä¸ªno-opï¼ˆæ— æ“ä½œï¼‰å‘½ä»¤æ¥å¡«è¡¥è¿™ä¸ªç©ºä½ã€‚ä½†æ˜¯ï¼Œå¯¹äºå®é™…å·¥ç¨‹ä¸­æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³æœªè¾¾æˆå…±è¯†æ—¶å€¼çš„å†²çªç­‰æƒ…å†µã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦raft">ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦Raftï¼Ÿ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e4%bb%ac%e8%bf%98%e9%9c%80%e8%a6%81raft" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Multi-Paxosåœ¨ç°å®çš„å·¥ç¨‹å½“ä¸­æ›´å¤šçš„æ˜¯ä¸€ç§ç¬¦å·ã€‚å› ä¸ºç†è®ºä¸å®è·µä¸Šçš„éš”é˜‚æ˜¯å¦‚æ­¤ä¹‹å¤§ï¼Œå¦‚æœæƒ³åœ¨å·¥ç¨‹æ„ä¹‰ä¸Šå®ç°ä¸€ä¸ªå¯ç”¨çš„Multi-Paxosç®—æ³•ï¼Œå¿…ç„¶ä¼šåœ¨åŸç®—æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€ç³»åˆ—çš„é­”æ”¹ï¼Œè¿™äº›é­”æ”¹è™½ç„¶å‡å£°ç§°è‡ªå·±å®ç°äº†Multi-Paxosç®—æ³•ï¼Œä½†æ˜¯è¿™äº›ç®—æ³•å¤§å¤šä¸èƒ½è¢«è¯æ˜æ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>Raftçš„ç›®æ ‡æ˜¯ï¼Œå³è®©ç®—æ³•æ»¡è¶³å·¥ç¨‹åŒ–éœ€è¦ï¼Œåˆèƒ½ä¿è¯å…¶æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Raftè®ºæ–‡å½“ä¸­è¯´Paxosç®—æ³•éš¾ä»¥ç†è§£ï¼Œæˆ‘å¹¶ä¸è¿™ä¹ˆè§‰å¾—ã€‚å› ä¸ºPaxosè®ºæ–‡é‡Œé¢æŠŠå›°éš¾çš„éƒ¨åˆ†éƒ½ä¸€ç¬”å¸¦è¿‡äº†ã€‚åªå‰©ä¸‹ç®€å•çš„é‚£éƒ¨åˆ†äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="raft-vs-paxos">Raft vs. Paxos &lt;a href="#raft-vs-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="leaderé€‰ä¸¾">Leaderé€‰ä¸¾ &lt;a href="#leader%e9%80%89%e4%b8%be" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨Paxosè®ºæ–‡ä¸­ï¼ŒLeaderé€‰ä¸¾è¢«è§†ä½œä¸€ç§ç‰¹æ®Šçš„â€œææ¡ˆé€‰ä¸¾â€ã€‚åªéœ€è¦Proposerå’ŒAcceptorè¿›è¡Œä¸€è½®æˆ–å¤šè½®ï¼ˆå–å†³äºè¿æ°”ï¼‰æŠ•ç¥¨ï¼Œå°±å¯ä»¥ç¡®å®šLeaderã€‚&lt;/p>
&lt;p>ä½†åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä»¥ä¸‹çš„é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¦‚ä½•åˆ¤æ–­Leaderæ˜¯å¦å­˜æ´»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¯å¦æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æ‹…å½“Leader&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="leaderçš„ä»»æœŸ">Leaderçš„ä»»æœŸ &lt;a href="#leader%e7%9a%84%e4%bb%bb%e6%9c%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Leaderåœ¨è¢«é€‰ä¸¾å‡ºæ¥ä¹‹åï¼Œéƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªä»»æœŸç¼–å·ï¼ˆtermï¼‰ã€‚åœ¨ä»»æœŸé‡Œï¼ŒLeaderä¼šå‘æ‰€æœ‰æˆå‘˜å‘é€å¿ƒè·³åŒ…ä»¥å»¶ç»­è‡ªå·±çš„ä»»æœŸã€‚&lt;/p>
&lt;p>å¦‚æœLeaderå¤±æ•ˆæ— æ³•å‘é€å¿ƒè·³åŒ…çš„è¯ï¼Œæˆå‘˜å°±ä¼šäº§ç”Ÿä¸€ä¸ªâ€œé€‰ä¸¾è¶…æ—¶â€ï¼Œæ­¤æ—¶å°±ä¼šé‡æ–°è§¦å‘ä¸€è½®é€‰ä¸¾ã€‚&lt;/p>
&lt;p>é€‰ä¸¾çš„æµç¨‹å’ŒBasic-Paxosç®—æ³•ç±»ä¼¼ï¼Œproposerå‘æ‰€æœ‰æˆå‘˜å‘é€â€œæˆ‘è¦å½“è€å¤§â€çš„ææ¡ˆï¼Œæˆå‘˜ä»¬ä¼šé…Œæƒ…å›å¤ã€‚å¦‚æœå¾—åˆ°äº†å¤šæ•°æˆå‘˜çš„è‚¯å®šï¼Œè¿™ä¸ªproposerå°±æ˜¯ä¸‹ä¸€ä¸ªä»»æœŸçš„Leaderäº†ã€‚&lt;/p>
&lt;p>ä»æœ¬è´¨ä¸Šè¯´ï¼Œæ¯ä¸€ä¸ªä»»æœŸçš„Leaderé€‰ä¸¾ï¼Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Basic-Paxoså®ä¾‹ã€‚ä»»æœŸå·ç›¸å½“äºPaxosé‡Œé¢çš„ææ¡ˆç¼–å·ã€‚&lt;/p>
&lt;h4 id="leaderèµ„æ ¼çš„è®¤å®š">Leaderèµ„æ ¼çš„è®¤å®š &lt;a href="#leader%e8%b5%84%e6%a0%bc%e7%9a%84%e8%ae%a4%e5%ae%9a" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Rafté‡‡ç”¨å¼ºä¸€è‡´æ€§çš„æ¨¡å‹ï¼Œå¯¹äºå·²ç»ACKçš„ç”¨æˆ·è¯·æ±‚ï¼Œè¦å°½åŠ›ä¿è¯å…¶çŠ¶æ€ä¸ä¸¢å¤±ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¦‚æœä½ é—®æˆ‘ï¼Œç°åœ¨æ¥ä¸€æ ¸å¼¹æŠŠæœºæˆ¿ç‚¸äº†ï¼Œæ•°æ®éƒ½ä¸¢äº†ï¼Œé‚£ä½ æ€ä¹ˆèƒ½ä¿è¯å¼ºä¸€è‡´æ€§ã€‚ &lt;br>
å…¶å®è¿™ä¸ªé—®é¢˜éå¸¸ç®€å•ã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¿è¯äº†ä¸¢æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬è¦é€‰å‡ºä¸€ä¸ªLeaderï¼Œä½¿å…¶èƒ½å¤ŸåŒ…å«æ‰€æœ‰å·²ç»ACKçš„ææ¡ˆã€‚å½“ä¸€ä¸ªproposerå‘å…¶å®ƒèŠ‚ç‚¹å‘é€ææ¡ˆæ—¶ï¼Œå°±ä¼šæ”¶åˆ°å…¶å®ƒèŠ‚ç‚¹çš„å“åº”ã€‚å› ä¸ºä¸€ä¸ªå·²ç»ACKçš„ææ¡ˆå¿…ç„¶è¢«å¤šæ•°èŠ‚ç‚¹æ‰€è®¤å¯ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªproposeræ²¡æœ‰åŒ…å«æ‰€æœ‰è¢«ACKçš„ææ¡ˆæ—¶ï¼Œå®ƒçš„ææ¡ˆå°±ä¼šè¢«å…¶å®ƒåŒ…å«æ›´å¤šçŠ¶æ€çš„èŠ‚ç‚¹é©³å›ã€‚æœ€åè¢«é€‰å‡ºæ¥çš„Leaderï¼Œä¸€å®šæ˜¯åŒ…å«æ‰€æœ‰è¢«ACKçš„çŠ¶æ€çš„èŠ‚ç‚¹ã€‚&lt;/p>
&lt;h3 id="æ—¥å¿—å¤åˆ¶">æ—¥å¿—å¤åˆ¶ &lt;a href="#%e6%97%a5%e5%bf%97%e5%a4%8d%e5%88%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å½“Leaderè¢«é€‰å‡ºåï¼ŒLeaderå°±ä¼šå¼€å§‹å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚ç”¨æˆ·çš„è¯·æ±‚å¯ä»¥çœ‹åšä¸€ç³»åˆ—çš„å‘½ä»¤ï¼Œåœ¨æ¥æ”¶åˆ°ææ¡ˆåï¼Œææ¡ˆé¦–å…ˆè¢«åˆ†å‘åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€æœºé¡ºåºæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚åœ¨å¤šæ•°èŠ‚ç‚¹è¿”å›ACKåï¼Œè¿™ä¸ªå‘½ä»¤å°±è¢«è§†ä¸ºâ€œå·²æäº¤â€ï¼ˆcommitedï¼‰ã€‚&lt;/p>
&lt;p>ä¸Šæ–‡ä¸­å·²ç»æåˆ°äº†ä¸€è‡´æ€§ç®—æ³•ä¸­çš„æ—¥å¿—éå¸¸ç±»ä¼¼äºç½‘ç»œåè®®ä¸­çš„TCPã€‚å³å¦‚æœä¸¤ä¸ªå‘½ä»¤çš„IDä¸€æ ·ï¼Œé‚£ä¹ˆå…¶å†…å®¹å¿…å®šä¹Ÿä¸€æ ·ï¼›å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½æœ‰è®¤å¯äº†ç¼–å·ä¸ºpçš„å‘½ä»¤ï¼Œé‚£ä¹ˆæ‰€æœ‰ç¼–å·å°äºpçš„å‘½ä»¤ä¹Ÿå¿…å®šä¿æŒä¸€è‡´ã€‚ï¼ˆè¢«ç§°ä¸ºLog Matching Propertyï¼‰&lt;/p>
&lt;p>Raftä¸ºäº†ç®€åŒ–ç®—æ³•çš„å·¥ç¨‹å®ç°ï¼ŒæŠŠèŠ‚ç‚¹çš„çŠ¶æ€æŠ½è±¡ä¸ºä¸¥æ ¼append onlyçš„æ—¥å¿—ã€‚å³æˆ‘ä»¬å¯ä»¥å°†æ—¥å¿—æŒ‡é’ˆå‘åæˆ–å‘å‰ç§»åŠ¨ï¼Œæ¥â€œå›æ»šâ€æˆ–â€œæ›´æ–°â€çŠ¶æ€ã€‚ä½†æ˜¯ç»å¯¹ä¸å…è®¸åœ¨æ—¥å¿—ä¸­é—´æ·»åŠ æˆ–åˆ é™¤æ—¥å¿—æ¡ç›®ã€‚æ‰€ä»¥ï¼Œåœ¨Leaderå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æœleaderå’Œå…¶ä»–followerä¹‹é—´çš„æ—¥å¿—ä¸åŒï¼Œé‚£ä¹ˆfolloweréœ€è¦å›æ»šæ—¥å¿—ä»¥ä¿æŒå’Œleaderæ—¥å¿—çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h3 id="å®‰å…¨æ€§">å®‰å…¨æ€§ &lt;a href="#%e5%ae%89%e5%85%a8%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="ä¸å½’æˆ‘ç®¡çš„äº‹æˆ‘ä¸æ‹¿ä¸»æ„">ä¸å½’æˆ‘ç®¡çš„äº‹æˆ‘ä¸æ‹¿ä¸»æ„ &lt;a href="#%e4%b8%8d%e5%bd%92%e6%88%91%e7%ae%a1%e7%9a%84%e4%ba%8b%e6%88%91%e4%b8%8d%e6%8b%bf%e4%b8%bb%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å‰æ–‡æˆ‘ä»¬è¯´åˆ°ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¦æˆä¸ºLeaderï¼Œä¸€å®šè¦æ‹¥æœ‰æ‰€æœ‰å·²ç»è¢«ACKçš„çŠ¶æ€ï¼Œå¦åˆ™å°±ä¼šè¢«å…¶å®ƒèŠ‚ç‚¹é©³å›ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç°å®éƒ½ä¼šå‡ºç°ä¸€äº›å°å°çš„æ„å¤–ã€‚åœ¨ç³»ç»Ÿçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€äº›ææ¡ˆåªè¢«å°‘æ•°èŠ‚ç‚¹è®¤å¯ï¼Œä¸æ­¤åŒæ—¶å‘èµ·ææ¡ˆçš„Leaderæ„å¤–é€€å‡ºã€‚é‚£ä¹ˆåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ—¥å¿—ä¼šäº§ç”Ÿâ€œåˆ†å‰â€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³æ—¥å¿—å½“ä¸­çš„å†²çªå‘¢ï¼Ÿ&lt;/p>
&lt;p>å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºè¿™äº›ä»¥å°‘æ•°èŠ‚ç‚¹è®¤å¯çš„ææ¡ˆå¹¶æ²¡æœ‰è¢«ç¡®è®¤ã€‚æ‰€ä»¥æˆ‘ä»¬æ— è®ºæ˜¯æ¥å—ææ¡ˆè¿˜æ˜¯é©³å›ææ¡ˆï¼Œéƒ½ä¸å½±å“æˆ‘ä»¬å¼ºä¸€è‡´æ€§çš„è¦æ±‚ã€‚æ‰€ä»¥å…³é”®æ˜¯å¤„ç†å†²çªï¼Œä½¿å…¶ä¸äº§ç”Ÿå½±å“ç³»ç»Ÿä¸€è‡´æ€§çš„åæ•ˆã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_17-34-59.png" alt="">&lt;/p>
&lt;p>å‡è®¾åœ¨Term1ï¼Œæœ€åä¸€ä¸ªææ¡ˆæ˜¯&amp;quot;Value:3&amp;quot;ï¼Œè¿™ä¸ªææ¡ˆå¹¶æ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼ŒLeaderå°±æŒ‚æ‰äº†ã€‚é€‰å‡ºæ¥äº†ä¸€ä¸ªæ–°Leaderï¼ŒTermæ•°åŠ 1ã€‚åœ¨Term2ï¼Œè¢«æå‡ºçš„ç¬¬ä¸€ä¸ªææ¡ˆæ˜¯&amp;quot;Value:1&amp;quot;ï¼Œè¿™ä¸ªææ¡ˆä¹Ÿæ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼ŒLeaderä¹ŸæŒ‚æ‰äº†ã€‚&lt;/p>
&lt;p>å› ä¸ºè¿™ä¸¤ä¸ªåˆ†å‰çš„ææ¡ˆéƒ½æ²¡æœ‰å¾—åˆ°å¤šæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªLeaderå¯èƒ½å·²ç»ç¡®è®¤è¿™ä¸¤ä¸ªææ¡ˆï¼Œæˆ–è€…ä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªéƒ½æ²¡æœ‰ç¡®è®¤ã€‚æ–°çš„Leaderåœ¨è¢«é€‰å‡ºåï¼Œéœ€è¦é¢å¯¹çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•å¤„ç†å±äºæ—§Termçš„ææ¡ˆã€‚&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š&lt;/p>
&lt;ol>
&lt;li>æ–°Leaderå°†æ—¥å¿—ä¸­ä»æ²¡æœ‰è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯çš„ææ¡ˆé‡æ–°æå‡ºï¼Œç›´åˆ°è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯ä¸ºæ­¢&lt;/li>
&lt;li>æ–°Leaderå¿½ç•¥å±äºæ—§çš„Termçš„ææ¡ˆï¼Œåªæäº¤å±äºæœ¬Termçš„ææ¡ˆï¼›å¯¹äºæ—¥å¿—å†²çªï¼Œä½¿ç”¨å¤åˆ¶æ—¥å¿—çš„æ–¹æ³•è§£å†³ï¼Œä½†ä¸ä¼šæ˜¾å¼è®¤å¯æ—§Termçš„ææ¡ˆã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_22-02-45.png" alt="">&lt;/p>
&lt;p>å¯¹äºæ–¹æ¡ˆ1ï¼Œæœ‰ä¸€ä¸ªéšå«çš„é—®é¢˜ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨æ—¶é—´ç‚¹1ï¼ŒS2ä¸ºLeaderï¼Œæ ‡çº¢çš„ä¸¤ä¸ªææ¡ˆå¹¶æ²¡æœ‰è¢«ç¡®è®¤ã€‚æ­¤æ—¶å¦‚æœLeaderåœ¨æ—¶é—´ç‚¹2é‡æ–°æå‡º&amp;quot;Term1/Value3&amp;quot;ï¼Œå¹¶ä¸”å¾—åˆ°äº†S1å’ŒS2çš„è®¤å¯ï¼Œé‚£ä¹ˆè¿™æ¡ææ¡ˆå·²ç»è¢«å¤šæ•°èŠ‚ç‚¹è®¤å¯ã€‚ä½†æ˜¯åœ¨æ—¶é—´ç‚¹3ï¼ŒS3è¢«é€‰ä¸¾ä¸ºäº†Leaderã€‚S1å’ŒS2éœ€è¦å›æ»šæ—¥å¿—ä»¥ä¿æŒä¸S3æ—¥å¿—çš„ä¸€è‡´ã€‚æ­¤æ—¶å°±å‡ºç°äº†ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯å·²ç»è¢«ç¡®è®¤çš„æ—¥å¿—è¢«å›æ»šæ‰äº†ï¼Œå¼ºä¸€è‡´æ€§å°±ä¸èƒ½æ»¡è¶³äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-12-02/Snipaste_2018-12-02_22-12-50.png" alt="">&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆ2ï¼Œé‚£ä¹ˆè¢«é€‰å‡ºçš„æ–°Leaderæå‡ºçš„ç¬¬ä¸€ä¸ªææ¡ˆçš„Termä¸€å®šä¸º3ã€‚ç¡®è®¤æ–°ææ¡ˆçš„èŠ‚ç‚¹æ¥ä¸‹æ¥ä¼šå¤åˆ¶Leaderçš„æ—¥å¿—ï¼Œå›æ»šæ‰æ²¡æœ‰è¢«è®¤å¯çš„ææ¡ˆ&amp;quot;Term2/Value1&amp;quot;ã€‚å¯¹äºæ ‡ç»¿çš„&amp;quot;Term1/Value3&amp;quot;ï¼Œè™½ç„¶è¢«å¤åˆ¶åˆ°äº†å…¶å®ƒçš„èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯è¿™ä¸ªå€¼å¹¶ä¸ä¼šè¢«ç¡®è®¤ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ—¢ä¿è¯äº†å·²ç»è¢«ç¡®è®¤çš„ææ¡ˆä¸ä¼šè¢«å›æ»šï¼Œåˆä¿è¯äº†æ—¥å¿—çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>åœ¨å…·ä½“å®ç°ä¸­ï¼Œâ€œT3/V1â€å¾€å¾€æ˜¯ä¸€ä¸ªç©ºå‘½ä»¤(no-op)ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ²¡æœ‰å†™è¯·æ±‚ï¼ŒLeaderå°±å¯ä»¥æ›´å¿«çš„ç¡®è®¤æ–°çš„ä»»æœŸå¹¶åŒæ­¥Logäº†ã€‚&lt;/p>
&lt;h4 id="å¦‚ä½•è¯æ˜">å¦‚ä½•è¯æ˜ &lt;a href="#%e5%a6%82%e4%bd%95%e8%af%81%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸Šé¢çš„ä½œæ³•å®ƒæ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>å‡è®¾å½“å‰ä»»æœŸä¸ºT1ï¼Œæ­¤æ—¶ç”±äºç³»ç»Ÿæ•…éšœï¼Œæˆ‘ä»¬é€‰å‡ºäº†æ–°çš„Leader - S2ï¼Œå¹¶è®°Termä¸ºT2ã€‚å› ä¸ºæˆ‘ä»¬ä¸¥æ ¼éµå®ˆäº†Log Matching Propertyã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¯¹äºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/p>
&lt;ol>
&lt;li>T2çš„Leaderå’ŒVoterçš„Logä¸­æœ€åä¸€ä¸ªææ¡ˆçš„ç¼–å·æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ä»–ä»¬æ—¥å¿—ä¸­çš„ææ¡ˆéƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„&lt;/li>
&lt;li>T2ä¸­Leaderçš„Logæ¯”Voteræ›´æ–°ï¼Œé‚£ä¹ˆLeaderä¸€å®šåŒ…å«æ¯”Voteræ›´å¤šçš„ææ¡ˆï¼›å¦åˆ™Voterå°±ä¸ä¼šç»™LeaderæŠ•ç¥¨&lt;/li>
&lt;/ol>
&lt;p>æˆ‘ä»¬éƒ½å¯ä»¥è¯æ˜ï¼Œå¯¹äºå‰ä¸€ä¸ªTermå·²ç»è¢«ç¡®è®¤çš„ææ¡ˆï¼Œä¸€å®šä¼šè¢«åŒ…å«åœ¨åä¸€ä¸ªTermçš„æ—¥å¿—ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè¢«ç¡®è®¤çš„ææ¡ˆä¸ä¼šä¸­é€”ä¸¢å¤±ã€‚&lt;/p>
&lt;h2 id="æˆå‘˜å˜åŒ–">æˆå‘˜å˜åŒ– &lt;a href="#%e6%88%90%e5%91%98%e5%8f%98%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸Šæˆ‘ä»¬çš„è®¨è®ºéƒ½åŸºäºç³»ç»Ÿçš„èŠ‚ç‚¹ä¸ä¼šå‘ç”Ÿå˜æ›´ï¼Œä½†æ˜¯åœ¨ç°å®å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾å¯¹æ­¤è¿›è¡Œä»»ä½•ä¿è¯ã€‚æ‰€ä»¥ä¸€ä¸ªå®ç”¨çš„ç³»ç»Ÿï¼Œä¸€å®šèƒ½è§£å†³æˆå‘˜å˜åŒ–çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆå‘˜å˜åŒ–é—®é¢˜çš„æœ¬è´¨æ˜¯ç³»ç»Ÿä¸­ä¸èƒ½åŒæ—¶å‡ºç°ä¸¤ä¸ªLeaderã€‚&lt;/p>
&lt;p>åœ¨Raftä¸­ï¼Œæˆ‘ä»¬å°†è¿‡æ¸¡æœŸçš„é…ç½®ç§°ä¸ºâ€œå…±åŒä¸€è‡´â€ï¼ˆjoint consensusï¼‰ï¼Œä¸€ä½†å®ƒè¢«ç¡®è®¤ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»è¿‡æ¸¡åˆ°äº†æ–°çš„æˆå‘˜é…ç½®ã€‚&lt;/p>
&lt;p>å…·ä½“çš„ç­–ç•¥å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ç³»ç»Ÿä¸­åªæœ‰æ—§çš„é…ç½®C_oldï¼Œæ–°åŠ å…¥çš„æˆå‘˜ä¸å¯èƒ½æˆä¸ºLeader&lt;/li>
&lt;li>å½“å‰ç³»ç»Ÿçš„Leaderæ¥å—åˆ°æ–°çš„é…ç½®C_newã€‚ç„¶åLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·ä¿®æ”¹é…ç½®ä¸ºC_old+newçš„ææ¡ˆã€‚&lt;/li>
&lt;li>å³ä½¿è¿™ä¸ªæ—¶é—´ç‚¹LeaderæŒ‚æ‰äº†ï¼Œæ–°çš„Leaderä¹Ÿåªä¼šæ‹¥æœ‰æ—§é…ç½®C_oldæˆ–è€…è¿‡æ¸¡æœŸé…ç½®C_old+newã€‚è¿™å–å†³äºLeaderé€‰ä¸¾çš„æ—¶æœºï¼ˆå’Œè¿æ°”ï¼‰ã€‚&lt;/li>
&lt;li>å½“è¿‡æ¸¡æœŸé…ç½®C_old+newè¢«å¤šæ•°èŠ‚ç‚¹ç¡®è®¤åï¼ŒLeaderå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·ä¿®æ”¹é…ç½®ä¸ºC_newçš„ææ¡ˆã€‚&lt;/li>
&lt;li>å¦‚æœè¿™ä¸ªæ—¶é—´ç‚¹LeaderæŒ‚æ‰äº†ï¼Œæ–°Leaderä¼šä»æ‹¥æœ‰C_old+newå’ŒC_newçš„èŠ‚ç‚¹ä¸­é€‰å‡ºã€‚æ–°çš„Leaderä»ç„¶å¯ä»¥è¿›è¡Œé…ç½®çš„å˜æ›´ï¼Œè€Œä¸å½±å“æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚&lt;/li>
&lt;li>ç›´åˆ°C_newè¢«ç¡®è®¤ï¼Œé…ç½®æ›´æ¢å®£å‘Šå®Œæˆã€‚&lt;/li>
&lt;/ol>
&lt;p>â€œå…±åŒä¸€è‡´â€å…è®¸èŠ‚ç‚¹æ— éœ€è€ƒè™‘å®‰å…¨æ€§çš„æƒ…å†µä¸‹ï¼Œåœ¨ä»»æ„æ—¶é—´è¿›è¡Œé…ç½®çš„æ›´æ¢ã€‚é…ç½®çš„æ›´æ¢ä¹Ÿä¸ä¼šå½±å“å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šæˆ‘ä»¬è§£å†³çš„æ˜¯å®‰å…¨æ€§é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ç¨‹ä¸­æˆ‘ä»¬è¿˜éœ€è¦å…¼é¡¾æ•ˆç‡é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æ–°åŠ å…¥çš„èŠ‚ç‚¹å¯ä»¥è§†ä½œâ€œnon-voting membersâ€ï¼ŒåªåŒæ­¥æ•°æ®ï¼Œä¸èƒ½å¯¹ææ¡ˆè¿›è¡ŒæŠ•ç¥¨ã€‚ç›´åˆ°æ•°æ®åŒæ­¥åŸºæœ¬å®Œæˆï¼Œæ‰è¿›è¡Œé…ç½®å˜æ›´ã€‚è¿™æ ·é¿å…äº†æ–°çš„èŠ‚ç‚¹ç”±äºç¼ºå°‘Logä¸èƒ½åŠæ—¶çš„å¤„ç†ææ¡ˆã€‚&lt;/p>
&lt;p>åˆå¦‚æ–°çš„æˆå‘˜åˆ—è¡¨ä¸­ï¼Œä¸åŒ…å«åŸå…ˆçš„LeaderèŠ‚ç‚¹ã€‚åœ¨æ—§Leaderè®¤å¯äº†æ–°çš„é…ç½®ææ¡ˆä¹‹åï¼Œå°±å¯ä»¥é€€ä½è®©è´¤ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°çš„Leaderã€‚&lt;/p>
&lt;p>ä»¥åŠè¢«æ¸…é™¤å‡ºæˆå‘˜åˆ—è¡¨çš„èŠ‚ç‚¹ï¼Œä¸ä¼šæ”¶åˆ°åç»­çš„å¿ƒè·³ï¼Œå®ƒä»¬ä¼šè®¤ä¸ºLeaderå·²ç»å¤±æ•ˆï¼Œæ‰€ä»¥è‡ªå·±è·³å‡ºæ¥ç«é€‰Leaderã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šè§¦å‘æ–°çš„ï¼ˆæ— æ„ä¹‰ çš„ï¼‰Leaderé€‰ä¸¾ï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…æ”¶åˆ°äº†Leaderçš„å¿ƒè·³ï¼Œé‚£ä¹ˆå°±ä¼šå¿½ç•¥Leaderçš„ç«é€‰è¯·æ±‚ã€‚è¿™æ ·æ—¢ä¸ä¼šå½±å“æ­£å¸¸çš„é€‰ä¸¾ï¼Œåˆå¯ä»¥å±è”½æ— æ•ˆçš„é€‰ä¸¾è¯·æ±‚ã€‚&lt;/p>
&lt;h2 id="å¿«ç…§">å¿«ç…§ &lt;a href="#%e5%bf%ab%e7%85%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬çš„ææ¡ˆè¶Šæ¥è¶Šå¤šï¼Œæ—¥å¿—ä¹Ÿè¶Šæ¥è¶Šé•¿ã€‚éšä¹‹è€Œæ¥çš„æ˜¯æ¼«é•¿çš„æ¢å¤æ—¶é—´ä»¥åŠç£ç›˜ç©ºé—´çš„æµªè´¹ã€‚å¿«ç…§æŠ€æœ¯å¯ä»¥å¸®æˆ‘ä»¬æ¸…é™¤æ—§çš„æ— ç”¨æ—¥å¿—ï¼Œåªä¿ç•™æœ‰ç”¨çš„çŠ¶æ€ä¿¡æ¯ã€‚&lt;/p>
&lt;p>åœ¨Raftç®—æ³•ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½è‡ªä¸»çš„ç”Ÿæˆå¿«ç…§ã€‚å¥½å¤„æ˜¯é¿å…Leaderåˆ†å‘å¿«ç…§é€ æˆçš„æ•ˆç‡é™ä½ï¼Œä¹Ÿç®€åŒ–äº†Leaderçš„åŠŸèƒ½å’ŒèŒè´£ã€‚åˆç”±äºæ—¥å¿—çš„â€œTCPç‰¹æ€§â€ï¼Œæ‰€ä»¥ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œåªè¦ä¿è¯ææ¡ˆç¼–å·ä¸€è‡´ï¼Œé‚£ä¹ˆå…¶å†…å®¹å°±å¯ä»¥ä¿è¯ä¸€è‡´ã€‚&lt;/p>
&lt;h2 id="å®¢æˆ·ç«¯äº¤äº’">å®¢æˆ·ç«¯äº¤äº’ &lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e4%ba%a4%e4%ba%92" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºå®¢æˆ·ç«¯ä¸äº†è§£ç³»ç»Ÿå†…éƒ¨çš„é€‰ä¸¾æƒ…å†µï¼Œæ‰€ä»¥åœ¨å¼€å§‹é€šä¿¡æ—¶ï¼Œä¼šéšæœºé€‰ä¸€å°èŠ‚ç‚¹å‘é€è¯·æ±‚ã€‚å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸æ˜¯Leaderï¼Œå°±ä¼šæ‹’ç»è¿™ä¸ªè¯·æ±‚ï¼Œä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯å“ªä¸ªèŠ‚ç‚¹æ˜¯å½“å‰ä»»æœŸçš„Leaderã€‚å¦‚æœLeaderå¤±æ•ˆï¼Œå®¢æˆ·ç«¯è¯·æ±‚è¶…æ—¶ï¼Œå°±ä¼šé‡æ–°éšæœºé€‰æ‹©èŠ‚ç‚¹ï¼Œè·å–æ–°ä»»Leaderä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¯¹äºå®¢æˆ·ç«¯å‘é€çš„å†™è¯·æ±‚ï¼ŒLeaderéœ€è¦è®°å½•å…¶å”¯ä¸€çš„è¯·æ±‚IDï¼Œä»¥é¿å…å®¢æˆ·ç«¯å‘é€çš„é‡å¤è¯·æ±‚ã€‚&lt;/p>
&lt;p>å¯¹äºå®¢æˆ·ç«¯å‘é€çš„è¯»è¯·æ±‚ï¼ŒLeaderéœ€è¦å†æ¬¡ç¡®è®¤å®ƒæ˜¯ä»æ˜¯å½“å‰ä»»æœŸçš„Leaderï¼Œé¿å…å‘å®¢æˆ·ç«¯å‘é€è¿‡æœŸæ•°æ®ã€‚å¦‚æœå¯¹æ•°æ®æ­£ç¡®æ€§å’Œæ—¶æ•ˆæ€§çš„æ•æ„Ÿæ€§ä¸é«˜ï¼Œå°±å¯ä»¥å‘ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œ&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Paxosçš„äº®ç‚¹åœ¨äºæŠŠå¤æ‚çš„ä¸œè¥¿è¯´ç®€å•äº†ã€‚è€ŒRaftçš„äº®ç‚¹æ˜¯æŠŠç®€å•çš„ä¸œè¥¿å…·ä½“åŒ–ï¼Œä½¿ä¹‹æˆä¸ºèƒ½è½åœ°çš„å·¥ç¨‹é¡¹ç›®ã€‚&lt;/p>
&lt;p>ä½†æ˜¯Paxosåšä¸ºä¸€ç§Quorumåè®®ï¼ˆä¿—ç§°P2Pï¼‰ï¼Œå…¶å·¥ç¨‹å¤æ‚æ€§æ˜¯éš¾ä»¥é¿å…çš„ã€‚Raftåœ¨Paxosåè®®ä¸Šé¢åŠ å…¥äº†å¾ˆå¤šé™åˆ¶ä»¥ç®€åŒ–å®ç°ï¼Œä½†æ˜¯æƒ³è¦å®Œæ•´çš„å®ç°å…¶åŠŸèƒ½ä»ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚ï¼ˆæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥&lt;a href="https://pdos.csail.mit.edu/6.824/labs/lab-raft.html">æŒ‘æˆ˜ä¸€ä¸‹è‡ªå·±&lt;/a>ï¼‰&lt;/p>
&lt;p>ä¸‹é¢ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šæ¢ä¸€ç§æ–°æ€è·¯ï¼Œå­¦ä¹ PecificAç®—æ³•ï¼Œçœ‹ä¸€çœ‹å¦‚ä½•ä½¿ç”¨Paxoså®ç°ä¸€ä¸ªä¸»ä»å¤åˆ¶åè®®ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æ›´åé¢">å†™åœ¨æ›´åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e6%9b%b4%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸ªäººè§‰å¾—ï¼ŒRaftè®ºæ–‡çš„ä¸€ä¸ªæ›´å¤§äº®ç‚¹æ˜¯å……åˆ†çš„æ€è€ƒäº†Paxos/Multi-Paxosåœ¨å·¥ç¨‹å®è·µä¸Šçš„ç¼ºé™·ã€‚æ€è€ƒå¹¶æå‡ºæœ‰ä»·å€¼çš„è´¨ç–‘ï¼Œè€Œä¸æ˜¯è¢«ä»–äººçš„è§‚ç‚¹å¸¦ç€èµ°ï¼ŒçœŸçš„æ˜¯æœ€é‡è¦çš„èƒ½åŠ›ä¹‹ä¸€äº†ã€‚&lt;/p>
&lt;p>å¤§èƒ†çŒœæµ‹æ˜¯å› ä¸ºæœ‰è¶³å¤Ÿçš„ç†è§£èƒ½åŠ›ï¼Œæœ‰é¢å¤–çš„å¸¦å®½å»å‘é—®ï¼Ÿè¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ã€‚&lt;/p></description></item><item><title>ç™½è¯ä¸€è‡´æ€§åè®® - Paxosã€Raftå’ŒPacificA[0]</title><link>https://wizmann.top/posts/paxos-raft-pecifaca0/</link><pubDate>Sun, 25 Nov 2018 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/paxos-raft-pecifaca0/</guid><description>&lt;h2 id="ä¸€è‡´æ€§åè®®---paxos">ä¸€è‡´æ€§åè®® - Paxos &lt;a href="#%e4%b8%80%e8%87%b4%e6%80%a7%e5%8d%8f%e8%ae%ae---paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå½“ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¿æŒèŠ‚ç‚¹ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è®©ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹ç›¸äº’åè°ƒé€šåŠ›åˆä½œï¼Œæœ‰å¯èƒ½çš„è®©ç³»ç»Ÿæ­£ç¡®çš„å·¥ä½œã€‚ä½†æ˜¯ï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿæœ¬èº«çš„ç‰¹æ€§ï¼Œéœ€è¦æˆ‘ä»¬åœ¨ä¸å¯é çš„ç¡¬ä»¶ä¸Šå°½å¯èƒ½çš„æ„å»ºå¯é çš„ç³»ç»Ÿã€‚æ‰€ä»¥ï¼Œçœ‹ä¼¼ç®€å•çš„ä¸€è‡´æ€§é—®é¢˜æˆä¸ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸçš„ä¸€ä¸ªé‡è¦çš„è¯¾é¢˜ã€‚&lt;/p>
&lt;p>Paxosç®—æ³•æ˜¯Leslie Lamportäº1990å¹´æå‡ºçš„ä¸€ç§ä¸€è‡´æ€§ç®—æ³•ã€‚ä¹Ÿæ˜¯ç›®å‰å…¬è®¤è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜æœ€æœ‰æ•ˆçš„ç®—æ³•ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>Paxosç®—æ³•çš„ç›®æ ‡æ˜¯åœ¨ä¸€ä¸ªä¸å¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿå†…ï¼Œåªé€šè¿‡ç½‘ç»œé€šä¿¡ï¼Œèƒ½å¤Ÿå¿«é€Ÿä¸”æ­£ç¡®åœ°åœ¨é›†ç¾¤å†…éƒ¨å¯¹æŸä¸ªæ•°æ®çš„å€¼è¾¾æˆä¸€è‡´ã€‚å¹¶ä¸”ä¿è¯ä¸è®ºå‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h2 id="paxosç®—æ³•">Paxosç®—æ³• &lt;a href="#paxos%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="å¦ä¸€ç§ç®€åŒ–äº†çš„å½¢è±¡çš„é—®é¢˜æè¿°---ä¹°è½¦ä½">å¦ä¸€ç§ï¼ˆç®€åŒ–äº†çš„ï¼‰å½¢è±¡çš„é—®é¢˜æè¿° - ä¹°è½¦ä½ &lt;a href="#%e5%8f%a6%e4%b8%80%e7%a7%8d%e7%ae%80%e5%8c%96%e4%ba%86%e7%9a%84%e5%bd%a2%e8%b1%a1%e7%9a%84%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0---%e4%b9%b0%e8%bd%a6%e4%bd%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æŸå°åŒºçš„ä¸€äº›å±…æ°‘åœ¨æŠ¢è½¦ä½ï¼Œè€Œè½¦ä½åªæœ‰ä¸€ä¸ªã€‚å±…æ°‘ä»¬è¾¾æˆåè®®ï¼Œåªè¦ä¸€ä¸ªæŠ¥ä»·è·å¾—åŠæ•°ä»¥ä¸Šå±…æ°‘è®¤å¯ï¼Œé‚£ä¹ˆæå‡ºè¿™ä¸ªå‡ºä»·çš„å±…æ°‘åˆ™è·å¾—äº†è½¦ä½çš„æ‰€æœ‰æƒã€‚&lt;/p>
&lt;p>å±…æ°‘ä¹‹é—´éå¸¸å‹å–„ï¼Œå¦‚æœçŸ¥é“äº†è½¦ä½å·²ç»æœ‰äº†ä¹°å®¶ï¼Œå°±ä¸ä¼šç»§ç»­å‡ºä»·è´­ä¹°ï¼Œå¹¶ä¸”ä¼šå¸®å¿™ä¼ æ’­è¿™ä¸ªä¿¡æ¯ã€‚&lt;/p>
&lt;p>å±…æ°‘ä»¬éƒ½æ˜¯éµçºªå®ˆæ³•çš„å¥½å…¬æ°‘ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½åªä¼šå¦‚å®çš„ä¸å…¶å®ƒç”¨æˆ·åˆ†äº«ä¿¡æ¯ã€‚ä¿¡æ¯çš„åˆ†äº«æ˜¯åœ¨ç½‘ä¸Šï¼Œé€šè¿‡ä¸€å¯¹ä¸€çš„ç§å¯†èŠå¤©è¿›è¡Œã€‚ä½†æ˜¯å°åŒºçš„æ‰‹æœºä¿¡å·éå¸¸å·®ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯é€šä¿¡çš„è´¨é‡ï¼Œä¸€äº›ä¿¡æ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚ä½†æ˜¯å±…æ°‘ä¸ä¼šæ‰çº¿ã€‚ä¹Ÿä¸ä¼šå¤±å»è®°å¿†ï¼Œå¹¶ä¸”é€šä¿¡çš„å†…å®¹æ˜¯å®Œæ•´çš„ï¼Œä¸ä¼šè¢«ç¯¡æ”¹çš„ã€‚&lt;/p>
&lt;p>åˆ’é‡ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>éœ€è¦åŠæ•°ä»¥ä¸Šå±…æ°‘çš„è®¤å¯ï¼Œæ‰èƒ½å£°ç§°æ‹¥æœ‰è½¦ä½ã€‚è¿™ä¸ªå±…æ°‘è¢«ç§°ä¸ºè½¦ä½çš„â€œå…¬è®¤æ‹¥æœ‰è€…â€&lt;/li>
&lt;li>è½¦ä½æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸€ä¸ªè½¦ä½ä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªâ€œå…¬è®¤æ‹¥æœ‰è€…â€&lt;/li>
&lt;li>è½¦ä½å¯ä»¥æš‚æ—¶æ²¡æœ‰æ‹¥æœ‰è€…ï¼Œä½†æ˜¯éœ€è¦å°½å¿«é€‰å‡ºä¸€ä¸ª&lt;/li>
&lt;li>é€šä¿¡æ˜¯ä¸å¯é çš„(not-reliable)ï¼Œä½†æ˜¯æ­£ç¡®æ€§(integrity)å’Œå¯æŒä¹…æ€§ï¼ˆdurabilityï¼‰æ˜¯å¯ä»¥ä¿è¯çš„&lt;/li>
&lt;li>æ•´ä¸ªæµç¨‹çš„ç›®æ ‡æ˜¯ç¡®å®šè½¦ä½çš„æ‹¥æœ‰è€…ã€‚æµç¨‹çš„å‚ä¸è€…ä¸ä¼šä»¥è‡ªå·±æ‹¥æœ‰è½¦ä½ä¸ºæœ€ç»ˆç›®æ ‡&lt;/li>
&lt;/ol>
&lt;h3 id="å¦‚ä½•é€‰å‡ºæœ€ç»ˆçš„ä¹°å®¶">å¦‚ä½•é€‰å‡ºæœ€ç»ˆçš„ä¹°å®¶ &lt;a href="#%e5%a6%82%e4%bd%95%e9%80%89%e5%87%ba%e6%9c%80%e7%bb%88%e7%9a%84%e4%b9%b0%e5%ae%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºé€šä¿¡æ˜¯ä¸€å¯¹ä¸€çš„ï¼Œå¯¹äºæ‰€æœ‰å‚ä¸è€…æ¥è¯´ï¼Œä»–ä»¬å¯¹æ•´ä¸ªç³»ç»Ÿçš„äº†è§£éƒ½æ˜¯ç‰‡é¢çš„ã€è¿‡æ—¶çš„ã€‚ä½†æ˜¯å‚ä¸è€…ä¼šé€šè¿‡ä¸å…¶å®ƒå‚ä¸è€…è¿›è¡Œé€šä¿¡ï¼Œä¸æ–­è·å¾—æ›´åŠæ—¶çš„ä¿¡æ¯ï¼Œä»è€Œæœ€ç»ˆè¾¾æˆä¸€è‡´ã€‚&lt;/p>
&lt;p>å¯¹äºæ™®é€šå±…æ°‘ï¼Œä¼šè®°å½•â€œå·²çŸ¥æœ€é«˜æŠ¥ä»·â€å’Œâ€œå·²ç¡®è®¤æŠ¥ä»·â€ä¸¤ä¸ªçŠ¶æ€ã€‚ä¼šå¤„ç†ä¸¤ç§è¯·æ±‚ï¼š&lt;/p>
&lt;ol>
&lt;li>è¯¢ä»·ï¼šå¦‚æœå±…æ°‘å·²ç¡®è®¤äº†æŸä¸ªæŠ¥ä»·ï¼Œåˆ™è¿”å›è¿™ä¸ªæŠ¥ä»·ã€‚å¦åˆ™ä¼šå°è¯•æ›´æ–°å·²çŸ¥æœ€é«˜æŠ¥ä»·ï¼Œå¹¶æŠ¥å‘Šä¹°å®¶å½“å‰çš„æœ€é«˜æŠ¥ä»·&lt;/li>
&lt;li>æŠ¥ä»·ï¼šå±…æ°‘ä¼šå°†è¯·æ±‚ä¸­çš„æŠ¥ä»·ä¸è‡ªå·±å·²çŸ¥çš„æœ€é«˜æŠ¥ä»·è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœé«˜äºæˆ–ç­‰äºæœ¬åœ°å·²ç»æŠ¥ä»·ï¼Œæ— è®ºæ˜¯å¦å·²ç»æœ‰å·²ç¡®è®¤æŠ¥ä»·ï¼Œéƒ½ä¼šç¡®è®¤è¿™ä¸ªæŠ¥ä»·&lt;/li>
&lt;/ol>
&lt;p>è€Œå¯¹äºä¹°å®¶ï¼Œä¼šå‘å‡ºä¸¤ç§ä¸åŒçš„ä¿¡æ¯ï¼š&lt;/p>
&lt;ol>
&lt;li>è¯¢ä»·ï¼šä»¥æŸä¸€ä¸ªæŠ¥ä»·é—®è¯¢å¤šæ•°å±…æ°‘ï¼Œå¦‚æœæœ‰å·²ç¡®è®¤çš„æŠ¥ä»·ï¼Œåˆ™æ”¾å¼ƒè‡ªå·±çš„æŠ¥ä»·ã€‚å¦‚æœè¿™ä¸ªæŠ¥ä»·ä½äºå±…æ°‘å·²çŸ¥çš„æŠ¥ä»·ï¼Œåˆ™æé«˜æŠ¥ä»·ã€‚&lt;/li>
&lt;li>æŠ¥ä»·ï¼šå¦‚æœè¯¢ä»·è¿‡ç¨‹ä¸­æ”¶åˆ°äº†å·²ç¡®è®¤çš„æŠ¥ä»·ï¼Œåˆ™å¸®å¿™è½¬å‘è¿™ä¸ªæŠ¥ä»·ã€‚å¦åˆ™å‘é€è‡ªå·±çš„æŠ¥ä»·ï¼Œå¦‚æœæŠ¥ä»·è·å¾—äº†å¤šæ•°å±…æ°‘çš„è®¤å¯ï¼Œå³å¯ä»¥è®¤ä¸ºæ‰€æœ‰æƒå·²ç»æ›´æ–°&lt;/li>
&lt;/ol>
&lt;h3 id="ä¸€è‡´æ€§çš„ç›´è§‚è¯æ˜">ä¸€è‡´æ€§çš„ç›´è§‚è¯æ˜ &lt;a href="#%e4%b8%80%e8%87%b4%e6%80%a7%e7%9a%84%e7%9b%b4%e8%a7%82%e8%af%81%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æŠ¥ä»·é˜¶æ®µï¼Œé™¤äº†ä¿è¯æ­£ç¡®æ€§ä¹‹å¤–ï¼Œå¯¹äºå±…æ°‘å’Œä¹°å®¶å¹¶æ²¡æœ‰ä»»ä½•çº¦æŸã€‚å…¶æœ¬è´¨å‚ä¸è€…ä¹‹é—´åŒæ­¥ä¿¡æ¯çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>è€Œä¸€è‡´æ€§åœ¨æŠ¥ä»·é˜¶æ®µå¯ä»¥è¢«å¾ˆå¥½çš„ä¿è¯&lt;/p>
&lt;ul>
&lt;li>å¦‚æœè½¦ä½è¿˜æ²¡æœ‰ä¸»äººï¼Œé‚£ä¹ˆå¤§å®¶å°±æ‹¼ä¸€æ‹¼è¿æ°”å’Œæ‰‹é€Ÿï¼Œç›´åˆ°æœ‰ä¸€ä¸ªä¹°å®¶è·å¾—äº†åŠæ•°å±…æ°‘çš„è®¤å¯ã€‚&lt;/li>
&lt;li>å¦‚æœç”¨æˆ·Aå·²ç»å£°æ˜ä»¥ä»·æ ¼Pä¹°å…¥è½¦ä½ï¼ˆè®°ä¸º&lt;code>(P, A)&lt;/code>ï¼‰ï¼Œæ­¤æ—¶å¿…æœ‰å¤šæ•°å±…æ°‘å·²ç»è®¤å¯&lt;code>(P, A)&lt;/code>ã€‚å¦‚æœç”¨æˆ·Bæƒ³è¦å£°æ˜ä»¥ä»·æ ¼Q(Q &amp;gt;= P)ä¹°å…¥è½¦ä½ï¼Œé¦–å…ˆéœ€è¦å‘å¤šæ•°å±…æ°‘è¯¢ä»·ï¼Œåœ¨è¯¢ä»·çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šæ”¶åˆ°ç”¨æˆ·Aå·²ç»æ‹¥æœ‰è½¦ä½çš„ä¿¡æ¯ï¼Œæ­¤æ—¶Båªä¼šå¸®Aæ‰©æ•£ä¿¡æ¯ï¼Œè€Œä¸ä¼šå»äº‰å¤ºæ‹¥æœ‰æƒã€‚ç³»ç»Ÿæœ€ç»ˆä¼šè¾¾åˆ°ä¸€ä¸ªç¨³å®šçš„çŠ¶æ€ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="å¤±å¿†---æ”¾æ¾å¯æŒä¹…æ€§è¦æ±‚">å¤±å¿† - æ”¾æ¾å¯æŒä¹…æ€§è¦æ±‚ &lt;a href="#%e5%a4%b1%e5%bf%86---%e6%94%be%e6%9d%be%e5%8f%af%e6%8c%81%e4%b9%85%e6%80%a7%e8%a6%81%e6%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœæˆ‘ä»¬æ”¾æ¾å¯æŒä¹…æ€§çš„é™åˆ¶ã€‚å³å±…æ°‘å¯ä»¥æ‰çº¿ï¼Œæˆ–è€…æ¸…ç©ºè‡ªå·±çš„è®°å¿†ã€‚é‚£æ­¤æ—¶æœ€å·®æƒ…å†µæ˜¯å¤šæ•°å·²ç»ç¡®è®¤æŠ¥ä»·çš„å±…æ°‘ä¸å†æ‰¿è®¤æŠ¥ä»·ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±æœ‰å¯èƒ½é€€åŒ–åˆ°â€œä»æ²¡æœ‰äººæ‹¥æœ‰è½¦ä½â€çš„çŠ¶æ€ã€‚æ­¤æ—¶æˆ‘ä»¬åªéœ€è¦å†è¿›è¡Œä¸€è½®é€‰ä¸¾ï¼Œé€‰å‡ºè½¦ä½æ–°çš„ä¸»äººå³å¯ã€‚è¿™å¹¶ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h3 id="æ—è§‚è€…è§†è§’">æ—è§‚è€…è§†è§’ &lt;a href="#%e6%97%81%e8%a7%82%e8%80%85%e8%a7%86%e8%a7%92" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‡å¦‚æˆ‘ä»¬åšä¸ºæ—è§‚è€…ï¼Œæƒ³è¦è§‚å¯Ÿæ˜¯è°æœ€ç»ˆæ‹¥æœ‰äº†è½¦ä½ã€‚å¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>â€œæ¨â€æ¨¡å‹&lt;/li>
&lt;/ol>
&lt;p>å½“æ–°çš„ä¹°å®¶è¢«é€‰ä¸¾å‡ºæ¥æ—¶ï¼Œæ–°ä¹°å®¶ä¼šé€šçŸ¥æ‰€æœ‰æ—è§‚è€…è½¦ä½çš„æ‹¥æœ‰è€…å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™æ ·è§‚å¯Ÿè€…ä»¬å¯ä»¥å®æ—¶çš„è·å¾—çŠ¶æ€çš„å˜åŒ–ï¼Œä½†æ˜¯ç”±äºé€šä¿¡æ˜¯ä¸å¯é çš„ï¼Œæ—è§‚è€…å¯èƒ½ä¼šé”™è¿‡çŠ¶æ€å˜åŒ–çš„ä¿¡æ¯ã€‚å¦‚æœè¿™ç§æƒ…å†µå‡ºç°ï¼Œè§‚å¯Ÿè€…åªèƒ½ç­‰å¾…ä¸‹æ¬¡çŠ¶æ€å˜åŒ–ï¼Œæ‰èƒ½æ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>â€œæ‹‰â€æ¨¡å‹&lt;/li>
&lt;/ol>
&lt;p>æ—è§‚è€…å¯ä»¥å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ªä¹°å®¶ï¼Œå‘å¤šæ•°å±…æ°‘è¿›è¡Œè¯¢ä»·ã€‚å¦‚æœæœ€ç»ˆä¹°å®¶å·²ç»ç¡®å®šï¼Œé‚£ä¹ˆè¯¢ä»·çš„å“åº”ä¸­ä¸€å®šåŒ…å«ç€æœ€æ–°çš„æ‹¥æœ‰è€…ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="paxoså¦‚ä½•è§£å†³æ´»é”é—®é¢˜">Paxoså¦‚ä½•è§£å†³æ´»é”é—®é¢˜ &lt;a href="#paxos%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e6%b4%bb%e9%94%81%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‡è®¾å±…æ°‘é‡Œæœ‰ä¹°å®¶Aã€Bï¼ŒåŒæ—¶å‘å…¶å®ƒå±…æ°‘æå‡ºè¯¢ä»·/æŠ¥ä»·ã€‚å¦‚æœä»–ä»¬çš„è¯¢ä»·/æŠ¥ä»·é¡ºåºæ’åˆ—å¦‚ä¸‹ï¼Œä¼šå‡ºç°ä»€ä¹ˆçŠ¶å†µå‘¢ï¼Ÿ&lt;/p>
&lt;pre tabindex="0">&lt;code>A: è¯¢ä»·ï¼Œ1å—
ä¼—å±…æ°‘ï¼šå¥½çš„ï¼Œæœ€é«˜ä»·ä¸º1å—
Bï¼šåŠ é’±ï¼Œ2å—
ä¼—å±…æ°‘ï¼šæ”¶åˆ°ï¼Œæœ€é«˜ä»·ä¸º2å—
ï¼ˆæ­¤æ—¶Aä»æ—§è®¤ä¸º1å—æ˜¯æœ€é«˜æŠ¥ä»·ï¼‰
Aï¼šæœ€ç»ˆæŠ¥ä»·ï¼Œ1å—
ä¼—å±…æ°‘ï¼šä¸è¡Œä¸è¡Œï¼ŒBå·²ç»åŠ åˆ°ä¸¤å—é’±äº†
Aï¼šï¼ˆå†…å¿ƒmmpï¼‰è¯¢ä»·ï¼Œ3å—
ï¼ˆBå¯¹Aæé«˜äº†æŠ¥ä»·ä¹Ÿæ¯«æ— å‡†å¤‡ï¼‰
Bï¼šæœ€ç»ˆæŠ¥ä»·ï¼Œ2å—
ä¼—å±…æ°‘ï¼šæ»šç²—ï¼ŒAå·²ç»æŠ¥ä»·3å—äº†
Bï¼šæˆ‘åŠ é’±
Aï¼šæˆ‘å†åŠ 
Bï¼šæˆ‘åŠ é’±
Aï¼šæˆ‘å†åŠ 
ä¼—å±…æ°‘ï¼šã€‚ã€‚ã€‚ï¼ˆä½ ä»¬ç©ä¸ªçƒå•Šï¼‰
&lt;/code>&lt;/pre>&lt;p>éœ‡æƒŠï¼Œè¿™å¸®æ— èŠçš„äººå±…ç„¶ä¸ºäº†è¿™å‡ å—é’±å¯ä»¥ç©ä¸€å¤©ï¼&lt;/p>
&lt;p>ä»¥è¿™æ ·çš„æµç¨‹è¿›è¡Œä¸‹å»ï¼Œç³»ç»Ÿä¼šé™·å…¥æ´»é”ï¼Œå‡ ä¹ä¸èƒ½è¾¾æˆä¸€è‡´äº†ã€‚æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†Aå’ŒBçš„è¯¢ä»·é‡è¯•æ—¶é—´åŠ å…¥éšæœºåŒ–å› å­ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©æ›´å¿«çš„è®©å±…æ°‘ä»¬è¾¾æˆä¸€è‡´ã€‚&lt;/p>
&lt;h3 id="paxoså¦‚ä½•è§£å†³æŠ•ç¥¨åˆ†è£‚é—®é¢˜">Paxoså¦‚ä½•è§£å†³æŠ•ç¥¨åˆ†è£‚é—®é¢˜ &lt;a href="#paxos%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e6%8a%95%e7%a5%a8%e5%88%86%e8%a3%82%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-11-25/split-vots.png" alt="">&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œå±…æ°‘ä»¬çš„æŠ•ç¥¨å¯èƒ½ä¼šå‘ç”Ÿåˆ†è£‚ï¼Œå³æ²¡æœ‰ä¸€ä¸ªå€¼è¾¾åˆ°äº†åŠæ•°ã€‚è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯è®©ä¹°å®¶é‡æ–°è¿›è¡Œè¯¢ä»·ï¼ŒåŒæ—¶åŠ å…¥éšæœºåŒ–å› å­ï¼Œä½¿å¾—æŠ•ç¥¨è¾¾æˆåŠæ•°ä»¥ä¸Šçš„æ¦‚ç‡æ›´å¤§ã€‚&lt;/p>
&lt;h2 id="è¯´æ­£ç»çš„">è¯´æ­£ç»çš„ &lt;a href="#%e8%af%b4%e6%ad%a3%e7%bb%8f%e7%9a%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºPaxosç®—æ³•çš„å®˜æ–¹æè¿°å’Œæ­£ç¡®æ€§çš„è¯¦ç»†è¯æ˜å¯ä»¥å‚è€ƒ&lt;a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">åŸè®ºæ–‡&lt;/a>ã€‚è¿™é‡Œå°±ä¸æ¬è¿äº†ï¼Œåªæ˜¯æŠŠæˆ‘çš„ä¾‹å­å’Œå®˜æ–¹é€šç”¨æœ¯è¯­è¿›è¡Œä¸€ä¸‹è®²è§£ï¼Œé¿å…æŠŠå¤§å®¶å¸¦è·‘åäº†ã€‚&lt;/p>
&lt;p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œâ€œè½¦ä½â€çš„é€šç”¨æœ¯è¯­è¢«ç§°ä¸ºâ€œå…±è¯†â€ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­æœ€å¤šæœ‰ä¸€ä¸ªå…±è¯†ã€‚è€Œâ€œè¯¢ä»·è¯·æ±‚â€è¢«ç§°ä¸ºâ€œprepareè¯·æ±‚â€ï¼Œâ€œæŠ¥ä»·è¯·æ±‚â€è¢«ç§°ä¸ºâ€œacceptè¯·æ±‚â€ã€‚&lt;/p>
&lt;p>æ¯ä¸ªè¯·æ±‚çš„ä»·æ ¼è¢«ç§°ä¸ºâ€œç¼–å·â€ï¼Œç¼–å·å¤§çš„è¯·æ±‚å¯ä»¥è¦†ç›–ç¼–å·å°çš„è¯·æ±‚ï¼Œå’Œâ€œä»·é«˜è€…å¾—â€æ˜¯ä¸€ä¸ªé“ç†ã€‚è¯·æ±‚ä¸­æ‰€å¸¦çš„ä¿¡æ¯è¢«ç§°ä¸ºâ€œvalueâ€ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä»£è¡¨ç€è´­ä¹°è€…çš„èº«ä»½ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="basic-paxoså’Œmulti-paxos">Basic Paxoså’ŒMulti Paxos &lt;a href="#basic-paxos%e5%92%8cmulti-paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸Šé¢æˆ‘ä»¬æè¿°çš„Paxosç®—æ³•åˆè¢«ç§°ä¸ºBasic Paxosï¼Œå› ä¸ºæ¯ä¸€è½®æµç¨‹æ‰§è¡Œå®Œï¼Œæ‰€æœ‰çš„å‚ä¸è€…éƒ½ä¼šï¼ˆä¸”åªä¼šï¼‰è¾¾æˆä¸€ä¸ªå…±è¯†ã€‚è€Œåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿ç»­ä¸æ–­çš„å¯¹å¤šä¸ªå€¼è¾¾æˆå…±è¯†ã€‚è¿™æ—¶Basic Paxosç®—æ³•å°±åŠ›ä¸èƒ½åŠäº†ï¼Œä¸€æ¥æ¯ä¸€ä¸ªå€¼çš„å…±è¯†éƒ½è‡³å°‘éœ€è¦ä¸¤æ¬¡å¹¿æ’­ç½‘ç»œè¯·æ±‚ï¼Œæ€§èƒ½å¤ªä½ï¼ŒäºŒæ¥åŒæ—¶å­˜åœ¨çš„å¤šä¸ªææ¡ˆä¼šäº’ç›¸ç«äº‰ï¼Œä½¿å¾—é€šä¿¡çš„æ•ˆç‡ä¸‹é™ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMulti Paxosç®—æ³•åº”è¿è€Œç”Ÿï¼Œå³ä¸€ç§å¯ä»¥é«˜æ•ˆçš„ã€è¿ç»­ä¸æ–­çš„å¯¹å¤šä¸ªå€¼è¾¾æˆå…±è¯†çš„ç®—æ³•ã€‚&lt;/p>
&lt;p>ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šä»‹ç»ä¸€ç§è¢«æ™®éè®¤å¯ï¼Œä»¥åŠå·²ç»è¢«å·¥ä¸šç•Œåº”ç”¨çš„Multi Paxosçš„å®ç° â€”â€” Raftç®—æ³•ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">Paxos Made Simple&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://book.douban.com/subject/26292004/">ä»Paxosåˆ°Zookeeper&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/31780743">çŸ¥ä¹ï¼šPaxosç®—æ³•è¯¦è§£&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä¸ƒç‰›äº‘å›¾åºŠè‡ªæ•‘æŒ‡å—ï¼ˆé™„githubå›¾åºŠå°å·¥å…·ï¼‰</title><link>https://wizmann.top/posts/qnsaver/</link><pubDate>Fri, 16 Nov 2018 22:23:00 +0000</pubDate><guid>https://wizmann.top/posts/qnsaver/</guid><description>&lt;h2 id="èƒŒæ™¯">èƒŒæ™¯ &lt;a href="#%e8%83%8c%e6%99%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¹‹å‰ä¸€ç›´åœ¨ç”¨ä¸ƒç‰›äº‘çš„å­˜å‚¨åšå›¾åºŠï¼ˆç®€ç§°ç™½å«–ï¼‰ã€‚ä½†æ˜¯å…è´¹çš„åˆé¤å¿…ç„¶ä¸ä¼šé•¿ä¹…ï¼Œä¸ƒç‰›è¦æ±‚æ‰€æœ‰bucketéƒ½è¦ç»‘å®šå¤‡æ¡ˆè¿‡çš„åŸŸåï¼Œå¦åˆ™å°±åœæ‰ä½ çš„bucketçš„å¤–é“¾ã€‚è¿™äº‹æˆ‘ä¹Ÿä¸åæ§½ï¼Œæ¯•ç«Ÿæ˜¯ç™½å«–ï¼Œä¹Ÿä¸èƒ½è¦æ±‚å•¥ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æœ€æ™ºéšœçš„æ˜¯ï¼Œä½ å¤–é“¾åœäº†æ²¡å…³ç³»ï¼Œä½†æ˜¯æˆ‘åœ¨åå°portalæŸ¥çœ‹æ–‡ä»¶ï¼Œä¸Šé¢çš„å›¾è¿˜æ˜¯æ˜¾ç¤ºä¸äº†ï¼Œç‚¹ä¸‹è½½ä¹Ÿæ²¡æœ‰ååº”ï¼Œåªæ˜¾ç¤ºâ€œ [5402] è·å– bucket åŸŸåå¤±è´¥â€ã€‚è¯´å¥½ä¸å«–äº†ï¼Œä½ å´åˆä¸è®©æˆ‘èµ°äº†ï¼Œéƒ½æ²¡åŠæ³•æ•°æ®è¿ç§»çš„ã€‚&lt;/p>
&lt;p>å› ä¸ºåšå®¢é‡Œçš„å›¾å…¨éƒ½å­˜åœ¨äº†ä¸ƒç‰›çš„å›¾åºŠä¸Šï¼Œè¿™ä¹ˆä¸€æ³¢æä¸‹æ¥å°±éå¸¸ä¼¤ã€‚äºæ˜¯æˆ‘ç§¯æå±•å¼€è‡ªæ•‘è¡ŒåŠ¨ã€‚&lt;/p>
&lt;h2 id="å¤§ä¾¦æ¢æ¯›åˆ©å°äº”éƒ">å¤§ä¾¦æ¢æ¯›åˆ©å°äº”éƒ &lt;a href="#%e5%a4%a7%e4%be%a6%e6%8e%a2%e6%af%9b%e5%88%a9%e5%b0%8f%e4%ba%94%e9%83%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>æˆ‘ï¼šä½ çœ‹æˆ‘ä»¬å¤©å¤©æŸ¥é—®é¢˜ï¼Œåƒä¸åƒæŸ¯å—åœ¨æŸ¥æ¡ˆå­ï¼Ÿ &lt;br>
åŒäº‹ï¼šæˆ‘è§‰å¾—æˆ‘ä»¬æ›´åƒæ¯›åˆ©å°äº”éƒã€‚&lt;/p>&lt;/blockquote>
&lt;p>å¤§èƒ†çŒœæµ‹ä¸ƒç‰›çš„portalä¹Ÿæ˜¯ä½¿ç”¨äº†å¤–é“¾çš„URLï¼Œå¦‚æœä¸ç»‘åŸŸåçš„è¯ï¼Œæ˜¯æ²¡æœ‰æ–‡ä»¶çš„URLçš„ã€‚ä½†æ˜¯æˆ‘æ‰‹é‡Œåˆæ²¡æœ‰å¤‡æ¡ˆåçš„åŸŸåã€‚äº‹æƒ…å°±é™·å…¥äº†åƒµå±€ã€‚&lt;/p>
&lt;p>ä¸ƒç‰›æä¾›äº†å°å·¥å…·ï¼ˆqrsctlï¼‰è®©æˆ‘ä»¬ç®¡ç†æ–‡ä»¶ï¼Œæˆ‘è§‰å¾—è¿™å¯èƒ½æ˜¯ä¸ªçªç ´ç‚¹ï¼Œä¸‡ä¸€å°å·¥å…·å¯ä»¥æŠŠæ•°æ®ä¸‹è½½ä¸‹æ¥å‘¢ï¼Ÿç»“æœä¹Ÿæ˜¯ä¸è¡Œï¼Œè¿™å°±éå¸¸GGäº†ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ï¼Œæˆ‘åˆå‘ç°å°å·¥å…·æœ‰æ‹·è´æ•°æ®çš„åŠŸèƒ½ï¼Œå¯ä»¥æŠŠè·¨bucketæ‹·è´æ•°æ®ï¼Œä½†æ˜¯æˆ‘çš„æ‰€æœ‰çš„bucketéƒ½æ²¡æœ‰ç»‘åŸŸåã€‚ä¹Ÿå¹¶ä¸èƒ½è§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘çªç„¶åˆæƒ³åˆ°ï¼Œä¸ƒç‰›äº‘å…¶å®å¹¶æ²¡æœ‰å®Œå…¨ç¦æ­¢å¤–é“¾ã€‚å¯¹äºä¸€ä¸ªå…¨æ–°çš„bucketï¼Œä¸ƒç‰›ä¼šå…è´¹æä¾›30å¤©çš„æµ‹è¯•åŸŸåï¼Œæ‰€ä»¥æ–°çš„bucketæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸‹è½½çš„ã€‚&lt;/p>
&lt;p>è¿™æ ·é—®é¢˜å°±è§£å†³äº†ï¼Œæˆ‘æ–°å»ºä¸€ä¸ªbucketï¼ŒæŒ‚ä¸Šæµ‹è¯•åŸŸåï¼Œç„¶åæŠŠæ–‡ä»¶éƒ½ä¸‹è½½ä¸‹æ¥ã€‚è¿™æ ·æ•°æ®å°±ä¿ä½äº†ã€‚&lt;/p>
&lt;h2 id="ä¸€æ³¢è‡ªä¿¡æ“ä½œ">ä¸€æ³¢è‡ªä¿¡æ“ä½œ &lt;a href="#%e4%b8%80%e6%b3%a2%e8%87%aa%e4%bf%a1%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¦–å…ˆæˆ‘ä»¬å…ˆä»portalä¸Šè·å–akå’Œskã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-11-16/20181116221134.png" alt="">&lt;/p>
&lt;p>ç„¶åä½¿ç”¨qrsctlï¼Œç™»å½•ï¼Œå¹¶è·å–bucketä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./qshell_linux_x64 account &lt;span style="color:#f92672">{&lt;/span>ak&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#f92672">{&lt;/span>sk&lt;span style="color:#f92672">}&lt;/span> youname@example.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./qshell_linux_x64 listbucket &lt;span style="color:#f92672">{&lt;/span> bucket_name &lt;span style="color:#f92672">}&lt;/span> | awk -F&lt;span style="color:#e6db74">&amp;#34;\t&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;{print $1}&amp;#39;&lt;/span> &amp;gt; files.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥æŠŠæ–‡ä»¶æ‹·è´åˆ°æ–°çš„bucketä¸‹é¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./qshell_linux_x64 batchcopy &lt;span style="color:#f92672">{&lt;/span> bucket_name &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#f92672">{&lt;/span> new_bucket_name &lt;span style="color:#f92672">}&lt;/span> -i files.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶éœ€è¦ç™»å½•portalï¼Œè·å–æ–°çš„bucketçš„æµ‹è¯•åŸŸåã€‚ç„¶åå¡«å…¥ä¸‹è½½é…ç½®æ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;dest_dir&amp;#34;&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;./dest_dir&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;bucket&amp;#34;&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;{ new_bucket_name }&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;cdn_domain&amp;#34;&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;{ your_test_domain.clouddn.com }&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;prefix&amp;#34;&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;suffixes&amp;#34;&lt;/span> : &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åæŠŠæ–‡ä»¶ç»Ÿç»Ÿä¸‹è½½ä¸‹æ¥ï¼Œå¤§åŠŸå‘Šæˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./qshell_linux_x64 qdownload qdisk_down.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é™„å½•ä½¿ç”¨githubåšå›¾åºŠ">é™„å½•ï¼šä½¿ç”¨Githubåšå›¾åºŠ &lt;a href="#%e9%99%84%e5%bd%95%e4%bd%bf%e7%94%a8github%e5%81%9a%e5%9b%be%e5%ba%8a" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Githubçš„Blobæ–‡ä»¶éƒ½æ˜¯å­˜åœ¨S3çš„ï¼Œå¢™å¤–æ€§èƒ½è¿˜æ˜¯å¯ä»¥çš„ã€‚å¯¹äºåšå®¢è¿™ç§è½»é‡ä½¿ç”¨åœºæ™¯å·²ç»è¶³å¤Ÿç”¨äº†ï¼Œè€Œä¸”é‡è¦çš„æ˜¯Githubä¸ä¼šæä¸ªæ™ºéšœæ“ä½œå¼ºè¡Œé”ä½ æ•°æ®ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦ç”³è¯·ä¸€ä¸ª&amp;quot;Personal access token&amp;quot;.&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-11-19/WeChat%20Screenshot_20181119143629.png" alt="">&lt;/p>
&lt;p>ç„¶åå…è®¸è¿™ä¸ªtokenæ“çºµæˆ‘ä»¬çš„å…¬å¼€reposã€‚æ³¨æ„ï¼Œè¿™ä¸ªtokenéå¸¸é‡è¦ï¼Œè¯·ä¸è¦æ³„éœ²ï¼&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/wizmann-pic/18-11-19/WeChat%20Screenshot_20181119143932.png" alt="">&lt;/p>
&lt;p>æœ€åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ®µä»£ç ä¸Šä¼ å›¾ç‰‡ï¼ˆæˆ–è€…å…¶å®ƒæ–‡ä»¶ï¼‰äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#coding=utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> sys
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> base64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> requests
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> datetime
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fn &lt;span style="color:#f92672">=&lt;/span> sys&lt;span style="color:#f92672">.&lt;/span>argv[&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">with&lt;/span> open(fn, &lt;span style="color:#e6db74">&amp;#39;rb&amp;#39;&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> f:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> content &lt;span style="color:#f92672">=&lt;/span> base64&lt;span style="color:#f92672">.&lt;/span>b64encode(f&lt;span style="color:#f92672">.&lt;/span>read())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> prefix &lt;span style="color:#f92672">=&lt;/span> datetime&lt;span style="color:#f92672">.&lt;/span>datetime&lt;span style="color:#f92672">.&lt;/span>now()&lt;span style="color:#f92672">.&lt;/span>strftime(&lt;span style="color:#e6db74">&amp;#34;%y-%m-&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> upload_name &lt;span style="color:#f92672">=&lt;/span> fn&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>)[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r &lt;span style="color:#f92672">=&lt;/span> requests&lt;span style="color:#f92672">.&lt;/span>put(&lt;span style="color:#e6db74">&amp;#39;https://api.github.com/repos/{{ your_id }}/{{ your_repo }}/contents/{{ path_in_repo }}/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> prefix &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> upload_name,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> headers &lt;span style="color:#f92672">=&lt;/span> { &lt;span style="color:#e6db74">&amp;#34;Authorization&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;token {{ your_token }}&amp;#34;&lt;/span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data &lt;span style="color:#f92672">=&lt;/span> json&lt;span style="color:#f92672">.&lt;/span>dumps({ &lt;span style="color:#e6db74">&amp;#39;message&amp;#39;&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;upload data&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;content&amp;#39;&lt;/span>: content, &lt;span style="color:#e6db74">&amp;#39;branch&amp;#39;&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;master&amp;#39;&lt;/span> }))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> info &lt;span style="color:#f92672">=&lt;/span> r&lt;span style="color:#f92672">.&lt;/span>json()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#e6db74">&amp;#39;content&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> info:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print info[&lt;span style="color:#e6db74">&amp;#39;content&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;download_url&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print info
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>å®¹æ–¥åŸç†ä»¥åŠä¸€äº›é¢˜ç›®</title><link>https://wizmann.top/posts/inclusive-exclusive-principle/</link><pubDate>Sun, 14 Oct 2018 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/inclusive-exclusive-principle/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯å®¹æ–¥åŸç†">ä»€ä¹ˆæ˜¯å®¹æ–¥åŸç† &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%ae%b9%e6%96%a5%e5%8e%9f%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å®¹æ–¥åŸç†æ˜¯ä¸€ç§è®¡æ•°æ‰‹æ®µã€‚ä¾‹å¦‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬æƒ³&lt;strong>ä¸é‡å¤ã€ä¸é—æ¼&lt;/strong>çš„æ±‚å‡ºåŒ…å«åœ¨ABCä¸‰ä¸ªé›†åˆä¸­æ‰€åŒ…å«çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œåº”è¯¥ä½¿ç”¨æ€ä¹ˆæ ·çš„æ–¹æ³•å‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/Wizmann/assets/master/blog/181007-Inclusion-exclusion-principle/500px-Inclusion-exclusion.svg.png" alt="image">&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/blog/181007-Inclusion-exclusion-principle/formula.PNG" alt="formula">&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜å¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œå½“ç„¶ä¹Ÿå¹¶ä¸å›°éš¾ã€‚ç›´è§‚çš„æ–¹æ³•æ˜¯æŠŠæ‰€æœ‰çš„å…ƒç´ è®¡æ•°ï¼Œå†æŠŠé‡å¤çš„å…ƒç´ æ’é™¤å‡ºå»ã€‚è¿™ç§è®¡æ•°çš„æ–¹æ³•ï¼Œæœ‰â€œå®¹â€æœ‰â€œæ–¥â€ï¼Œæˆ‘ä»¬è®²å…¶ç§°åšâ€œå®¹æ–¥åŸç†â€ã€‚&lt;/p>
&lt;h2 id="å®¹æ–¥åŸç†çš„åº”ç”¨">å®¹æ–¥åŸç†çš„åº”ç”¨ &lt;a href="#%e5%ae%b9%e6%96%a5%e5%8e%9f%e7%90%86%e7%9a%84%e5%ba%94%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å°è§„æ¨¡çš„è®¡æ•°é—®é¢˜è‡ªç„¶éš¾ä¸å€’æˆ‘ä»¬ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨&lt;code>visit[]&lt;/code>æ•°ç»„æ¥è®°å½•æŸå…ƒç´ æ˜¯å¦å‡ºç°ã€‚ä½†æ˜¯å½“é—®é¢˜çš„è§„æ¨¡å¢å¤§æ—¶ï¼Œä½¿ç”¨æ•°ç»„è®°å½•è¿™ç§æ–¹å¼éœ€è¦ä½¿ç”¨æ›´å¤šçš„å†…å­˜ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸èƒ½æ¥å—çš„ã€‚&lt;/p>
&lt;h3 id="è€ƒè™‘ä¸€ä¸ªé—®é¢˜">è€ƒè™‘ä¸€ä¸ªé—®é¢˜ &lt;a href="#%e8%80%83%e8%99%91%e4%b8%80%e4%b8%aa%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>é—®é¢˜ï¼šç»Ÿè®¡åœ¨1~Nä¸­çš„ï¼Œèƒ½è¢«2æˆ–3æ•´é™¤çš„æ•°ã€‚(1 &amp;lt;= N &amp;lt;= 1e9)&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªé—®é¢˜æ‹†æˆä¸¤éƒ¨åˆ†æ¥çœ‹ï¼š&lt;/p>
&lt;ol>
&lt;li>Nä»¥å†…çš„ï¼Œèƒ½è¢«2æ•´é™¤çš„æ•°&lt;/li>
&lt;li>Nä»¥å†…çš„ï¼Œèƒ½è¢«3æ•´é™¤çš„æ•°&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸¤ä¸ªé—®é¢˜éƒ½éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨é™¤æ³•è¿›è¡Œæ±‚è§£ï¼Œå…¶ç»“æœåˆ†åˆ«ä¸º&lt;code>N/2&lt;/code>å’Œ&lt;code>N/3&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¿½ç•¥åŒæ—¶èƒ½è¢«2å’Œ3æ•´é™¤çš„æ•°ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆæ±‚å¾—2å’Œ3çš„æœ€å°å…¬å€æ•°6ï¼Œç„¶ååº”ç”¨å®¹æ–¥åŸç†ï¼Œå°†é‡å¤è®¡æ•°çš„ï¼Œèƒ½åŒæ—¶è¢«2å’Œ3æ•´é™¤çš„æ•°å‡å»ï¼Œå³å¾—åˆ°æœ€åçš„ç»“æœã€‚&lt;/p>
&lt;h3 id="ä¸€ä¸ªæ›´å¤æ‚çš„é—®é¢˜-hdu-2204eddyçš„çˆ±å¥½">ä¸€ä¸ªæ›´å¤æ‚çš„é—®é¢˜ ï¼ˆHDU-2204ï¼ŒEddyçš„çˆ±å¥½ï¼‰ &lt;a href="#%e4%b8%80%e4%b8%aa%e6%9b%b4%e5%a4%8d%e6%9d%82%e7%9a%84%e9%97%ae%e9%a2%98-hdu-2204eddy%e7%9a%84%e7%88%b1%e5%a5%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•°Nï¼Œç¡®å®šåœ¨1åˆ°Nä¹‹é—´æœ‰å¤šå°‘ä¸ªå¯ä»¥è¡¨ç¤ºæˆM^Kï¼ˆK&amp;gt;1)çš„æ•°ã€‚ (1 &amp;lt;= N &amp;lt;=1e18)&lt;/p>&lt;/blockquote>
&lt;p>è¿™é‡Œæˆ‘ä»¬å…ˆè€ƒè™‘K=2å’Œ3æ—¶çš„æƒ…å†µã€‚å¯¹äºæ­£æ•´æ•°Nï¼Œæˆ‘ä»¬æœ‰&lt;code>pow(K, 1.0/2)&lt;/code>ä¸ªæ•°å¯ä»¥è¡¨ç¤ºä¸º&lt;code>2^K&lt;/code>ï¼›æœ‰&lt;code>pow(K, 1.0/3)&lt;/code>ä¸ªæ•°å¯ä»¥è¡¨ç¤ºä¸º&lt;code>3^K&lt;/code>ã€‚è¿™ä¸ªåŸç†éå¸¸ç®€å•ï¼Œè¿™é‡Œä¸åšå±•å¼€ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œå¯¹äºN=64æ¥è¯´ï¼Œæ—¢å¯ä»¥è¡¨ç¤ºä¸º&lt;code>4^3&lt;/code>ï¼Œåˆå¯ä»¥è¡¨ç¤ºä¸º&lt;code>8^2&lt;/code>ã€‚é‚£ä¹ˆåœ¨ä¸Šé¢è®¡æ•°çš„æ—¶å€™ä¸€å®šå‡ºç°äº†é‡å¤è®¡æ•°çš„æƒ…å†µã€‚æ‰€ä»¥æ ¹æ®å®¹æ–¥åŸç†ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰6çš„ä¹˜æ–¹å…¨éƒ¨æ’é™¤ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆå¯¹äºN=4096çš„æƒ…å†µï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸º&lt;code>2^12&lt;/code>ã€‚é‚£ä¹ˆåœ¨è®¡æ•°ä¸­æˆ‘ä»¬æ˜¯å¦éœ€è¦è€ƒè™‘12çš„ä¹˜æ–¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸º12çš„ä¹˜æ–¹ä¸€å®šæ˜¯6çš„ä¹˜æ–¹ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å·²ç»å¤„ç†è¿‡äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å†æ¬¡å¤„ç†ã€‚æ¨è€Œå¹¿ä¹‹ï¼Œè‹¥Kå¯ä»¥åˆ†è§£è´¨å› æ•°ä¸º&lt;code>a^k1 + b^k2 + c^k3&lt;/code>ï¼Œå½“ä¸”ä»…å½“&lt;code>k1 == k2 == k3 == 1&lt;/code>æ—¶ï¼Œæˆ‘ä»¬æ‰è¿›è¡Œè®¡æ•°ã€‚&lt;/p>
&lt;p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘æ›´æ™®éçš„æƒ…å†µï¼Œå¯¹äºä»»æ„Kï¼Œæˆ‘ä»¬å…ˆå¯¹å…¶è¿›è¡Œè´¨å› æ•°åˆ†è§£ã€‚æ ¹æ®å®¹æ–¥åŸç†ï¼Œå½“å…¶è´¨å› æ•°çš„ä¸ªæ•°ä¸ºå¥‡æ•°æ—¶ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œè®¡æ•°ï¼›ä¸ºå¶æ•°æ—¶ï¼Œæˆ‘ä»¬ä»è®¡æ•°ä¸­æ’é™¤è¿™ç§é‡å¤æƒ…å†µã€‚&lt;/p>
&lt;h2 id="æ›´å¤šçš„ä¾‹é¢˜">æ›´å¤šçš„ä¾‹é¢˜ &lt;a href="#%e6%9b%b4%e5%a4%9a%e7%9a%84%e4%be%8b%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="è®¡æ•°ä¸èƒ½è¢«é›†åˆé‡Œçš„æ•°æ•´é™¤çš„æ•°hdu---1796">è®¡æ•°ï¼šä¸èƒ½è¢«é›†åˆé‡Œçš„æ•°æ•´é™¤çš„æ•°ï¼ˆHDU - 1796ï¼‰ &lt;a href="#%e8%ae%a1%e6%95%b0%e4%b8%8d%e8%83%bd%e8%a2%ab%e9%9b%86%e5%90%88%e9%87%8c%e7%9a%84%e6%95%b0%e6%95%b4%e9%99%a4%e7%9a%84%e6%95%b0hdu---1796" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•°é›†åˆï¼Œæ±‚åœ¨1~Nä¸­ï¼Œæœ‰å¤šå°‘ä¸ªæ•°ä¸èƒ½è¢«é›†åˆä¸­çš„æ•°æ•´é™¤ã€‚&lt;/p>&lt;/blockquote>
&lt;p>è¿™é“é¢˜æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­çš„æ‰©å±•ã€‚æˆ‘ä»¬æšä¸¾é›†åˆçš„å­é›†åˆï¼Œå¹¶æ±‚å‡ºå­é›†åˆçš„æœ€å°å…¬å€æ•°ï¼Œä½¿ç”¨å®¹æ–¥åŸç†è¿›è¡Œè®¡æ•°å³å¯ã€‚&lt;/p>
&lt;h3 id="è®¡æ•°é›†åˆä¸­è‡³å°‘æœ‰ä¸€å¯¹æ•°çš„æœ€å¤§å…¬çº¦æ•°ä¸º1çš„é›†åˆæ•°poj---1091">è®¡æ•°ï¼šé›†åˆä¸­è‡³å°‘æœ‰ä¸€å¯¹æ•°çš„æœ€å¤§å…¬çº¦æ•°ä¸º1çš„é›†åˆæ•°ï¼ˆPOJ - 1091ï¼‰ &lt;a href="#%e8%ae%a1%e6%95%b0%e9%9b%86%e5%90%88%e4%b8%ad%e8%87%b3%e5%b0%91%e6%9c%89%e4%b8%80%e5%af%b9%e6%95%b0%e7%9a%84%e6%9c%80%e5%a4%a7%e5%85%ac%e7%ba%a6%e6%95%b0%e4%b8%ba1%e7%9a%84%e9%9b%86%e5%90%88%e6%95%b0poj---1091" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>æ±‚å¤§å°ä¸ºN+1çš„é›†åˆA[N + 1]ï¼Œå¯¹äºä»»æ„A[i]æœ‰ A[i] &amp;lt;= Mï¼Œä¸”A[N + 1]ä¸€å®šåŒ…å«æ•´æ•°Mï¼Œé›†åˆå†…çš„æ•°å¯ä»¥é‡å¤ã€‚é—®æœ‰å¤šå°‘æ•°è¿™æ ·çš„é›†åˆï¼Œä½¿å¾—é›†åˆä¸­è‡³å°‘æœ‰ä¸€å¯¹æ•°çš„æœ€å¤§å…¬çº¦æ•°ä¸º1ã€‚&lt;/p>&lt;/blockquote>
&lt;p>è¿™é“é¢˜çš„å…³é”®åœ¨äºæ¯ä¸€ä¸ªé›†åˆéƒ½å¿…é¡»åŒ…å«Mã€‚æˆ‘ä»¬å¯ä»¥åå‘æ±‚è§£ï¼Œâ€œè‡³å°‘æœ‰ä¸€å¯¹çš„æœ€å¤§å…¬çº¦æ•°ä¸º1â€çš„å¦å‘½é¢˜ä¸ºâ€œæ‰€æœ‰çš„æ•°å¯¹çš„æœ€å¤§å…¬çº¦æ•°å‡ä¸ä¸º1â€ã€‚è¿™é‡Œæšä¸¾æ‰€æœ‰çš„æœ€å¤§å…¬çº¦æ•°çš„å€¼ï¼Œå¹¶ä¸”ä½¿ç”¨å®¹æ–¥åŸç†æ’é™¤é‡å¤è®°æ•°ã€‚&lt;/p>
&lt;h3 id="è®¡æ•°å¹³é¢ä¸Šæ–œç‡ä¸åŒçš„ç‚¹hdu---2841">è®¡æ•°ï¼šå¹³é¢ä¸Šæ–œç‡ä¸åŒçš„ç‚¹ï¼ˆHDU - 2841ï¼‰ &lt;a href="#%e8%ae%a1%e6%95%b0%e5%b9%b3%e9%9d%a2%e4%b8%8a%e6%96%9c%e7%8e%87%e4%b8%8d%e5%90%8c%e7%9a%84%e7%82%b9hdu---2841" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ç»™å®šæ•´æ•°Nã€Mã€‚æ±‚ä¸€å…±æœ‰å¤šå°‘ç§ä¸åŒçš„k=n/mï¼Œä½¿å¾— 1 &amp;lt;= n &amp;lt;= Nï¼Œ1 &amp;lt;= m &amp;lt;= Mã€‚&lt;/p>&lt;/blockquote>
&lt;p>å› ä¸ºk=n/mï¼Œæ‰€ä»¥åœ¨nå’Œmçš„å–å€¼ä¸äº’è´¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è¿›è¡Œçº¦åˆ†ï¼Œå°±ä¼šäº§ç”Ÿå¯èƒ½çš„è®¡æ•°é‡å¤ã€‚æ‰€ä»¥æœ¬é¢˜å¯ä»¥è½¬åŒ–ä¸ºæ±‚â€œä¸€å…±æœ‰å¤šå°‘å¯¹äº’è´¨çš„nã€mâ€ã€‚æˆ‘ä»¬å¯ä»¥æšä¸¾mæ¥æ±‚nï¼Œå°±åˆå¯ä»¥è½¬åŒ–ä¸ºâ€œå¯¹äºç»™å®šçš„mï¼Œæœ‰å¤šå°‘ä¸ªnä¸å…¶äº’è´¨â€ã€‚æ­¤æ—¶å¯ä»¥å¯¹mè¿›è¡Œåˆ†è§£è´¨å› æ•°ï¼Œä½¿ç”¨å®¹æ–¥åŸç†è¿›è¡Œç»Ÿè®¡ã€‚&lt;/p>
&lt;h3 id="å®¹æ–¥åŸç†--dp-leetcode---920-number-of-music-playlists">å®¹æ–¥åŸç† + DP ï¼ˆLeetcode - 920. Number of Music Playlistsï¼‰ &lt;a href="#%e5%ae%b9%e6%96%a5%e5%8e%9f%e7%90%86--dp-leetcode---920-number-of-music-playlists" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ç»™å®šNç§ä¸åŒçš„å…ƒç´ ï¼Œè®©ä½ ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸ºLçš„åˆ—è¡¨ï¼Œé—®æœ‰å¤šå°‘ç§ä¸åŒçš„åˆ—è¡¨ç»„åˆæ»¡è¶³ï¼š&lt;/p>&lt;/blockquote>
&lt;ol>
&lt;li>æ‰€æœ‰çš„å…ƒç´ è‡³å°‘å‡ºç°ä¸€æ¬¡&lt;/li>
&lt;li>ç›¸åŒçš„å…ƒç´ ä¹‹é—´è‡³å°‘è·ç¦»K&lt;/li>
&lt;/ol>
&lt;p>æœ¬é¢˜çš„éš¾åº¦åœ¨äºâ€œæ‰€æœ‰çš„å…ƒç´ è‡³å°‘å‡ºç°ä¸€æ¬¡â€ï¼Œå¦‚æœæ— è„‘DPçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç»´çš„DPæ¥è®°å½•å…ƒç´ å‡ºç°çš„æƒ…å†µã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™ä¸ªæ¡ä»¶ï¼Œç›´æ¥æ±‚æ„ä¸ºâ€œé•¿åº¦ä¸ºLçš„åˆ—è¡¨ï¼Œæœ‰å¤šå°‘ä¸ªç»„åˆæ»¡è¶³ç›¸åŒå…ƒç´ ä¹‹é—´è‡³å°‘è·ç¦»Kâ€ã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨O(N)çš„DPæ¥è§£å†³ã€‚&lt;/p>
&lt;p>æ­¤æ—¶çš„é—®é¢˜æ˜¯æˆ‘ä»¬æ±‚å‡ºæ¥çš„ç»“æœå¯èƒ½ä¸æ»¡è¶³â€œæ‰€æœ‰çš„å…ƒç´ è‡³å°‘å‡ºç°ä¸€æ¬¡â€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„åˆ—è¡¨é‡Œå¯èƒ½æœ‰ä¸è¶³Nä¸ªå…ƒç´ ã€‚æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨å®¹æ–¥åŸç†ï¼Œå‡å»åˆ—è¡¨ä¸­ä¸è¶³Nä¸ªå…ƒç´ çš„æƒ…å†µã€‚&lt;/p>
&lt;h2 id="å¦‚æœæˆ‘ä»¬æ¥å‡ºé¢˜">å¦‚æœæˆ‘ä»¬æ¥å‡ºé¢˜&amp;hellip; &lt;a href="#%e5%a6%82%e6%9e%9c%e6%88%91%e4%bb%ac%e6%9d%a5%e5%87%ba%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºå®¹æ–¥åŸç†ï¼Œå¦‚æœæˆ‘ä»¬ç«™åœ¨å‡ºé¢˜äººçš„è§’åº¦ï¼Œå¯ä»¥å°†å…¶åº”ç”¨åœ¨å¦‚ä¸‹å‡ ç±»â€œæ±‚å¹¶é›†çš„å¤§å°â€çš„ï¼ˆä¼ªï¼‰æ•°è®ºé—®é¢˜ä¸Šï¼šæ±‚èƒ½è¢«é›†åˆä¸­çš„æ•°æ•´æ•°çš„æ•°ã€æ±‚èƒ½è¡¨ç¤ºä¸ºé›†åˆä¸­çš„æ•°çš„ä¹˜æ–¹çš„æ•°ã€æ±‚ä¸ç»™å®šçš„æ•°äº’è´¨çš„æ•°ç­‰ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥é…åˆDPæ±‚ç»„åˆæ•°ã€‚&lt;/p>
&lt;p>ä½†æ— è®ºåŒ…è£…æˆä»€ä¹ˆæ ·å­çš„é¢˜ç›®ï¼Œå¦‚æœå®ƒçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªè®¡æ•°é—®é¢˜ï¼Œå¹¶ä¸”æ¶‰åŠåˆ°â€œæ±‚å¹¶é›†çš„å¤§å°â€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä½¿ç”¨å®¹æ–¥åŸç†æ¥æ±‚è§£ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://zh.wikipedia.org/wiki/%E6%8E%92%E5%AE%B9%E5%8E%9F%E7%90%86">å®¹æ–¥åŸç† - Wikipedia&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://vjudge.net/contest/253352#overview">ACMè€å¹´é˜Ÿå®¹æ–¥åŸç†&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å®ç°ä¸€ä¸ªæ— é”æ¶ˆæ¯é˜Ÿåˆ—</title><link>https://wizmann.top/posts/implement-non-blocking-queue/</link><pubDate>Wed, 02 May 2018 00:39:00 +0000</pubDate><guid>https://wizmann.top/posts/implement-non-blocking-queue/</guid><description>&lt;blockquote>
&lt;p>240414æ›´æ–°ï¼šåç»­è¡¥å……äº†ä¸€ç¯‡å‹˜è¯¯æ–‡ç« ï¼Œè§&lt;a href="https://wizmann.top/implement-non-blocking-queue-2.html">è¿™é‡Œ&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="ç›®æ ‡">ç›®æ ‡ &lt;a href="#%e7%9b%ae%e6%a0%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å®ç°ä¸€ä¸ªå¤šè¯»å¤šå†™çš„æ— é”æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/p>
&lt;h2 id="cmpxchg---æ¯”è¾ƒå¹¶æ›¿æ¢">cmpxchg - æ¯”è¾ƒå¹¶æ›¿æ¢ &lt;a href="#cmpxchg---%e6%af%94%e8%be%83%e5%b9%b6%e6%9b%bf%e6%8d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆcompare-and-swap, CASï¼‰æ˜¯ä¸€ä¸ªç”¨äºå¤šçº¿ç¨‹åŒæ­¥çš„åŸå­æ“ä½œã€‚&lt;/p>
&lt;p>å…¶å·¥ä½œæµç¨‹æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">cmpxchg&lt;/span>(val, oldval, newval):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> val &lt;span style="color:#f92672">==&lt;/span> oldval:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val &lt;span style="color:#f92672">=&lt;/span> newval
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“&lt;code>val&lt;/code>ç­‰äº&lt;code>oldval&lt;/code>æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šå°†&lt;code>val&lt;/code>çš„å€¼æ›¿æ¢æˆ&lt;code>newval&lt;/code>ã€‚åœ¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸‹ï¼Œcmpxchgç”¨æ¥ä¿è¯å¤šçº¿ç¨‹å†™çš„åŸå­æ€§ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2éƒ½è¦å†™å…¥&lt;code>val&lt;/code>å˜é‡ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™æˆåŠŸã€‚ä½¿ç”¨cmpxchgï¼Œèƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸçš„å°†&lt;code>val&lt;/code>å˜é‡æ›¿æ¢æˆæ–°å€¼ï¼Œå†™å¤±è´¥çš„çº¿ç¨‹ä¼šå¾—åˆ°&lt;code>False&lt;/code>çš„è¿”å›å€¼ã€‚&lt;/p>
&lt;h2 id="access_once---æ¶ˆé™¤ä¼˜åŒ–æ­§ä¹‰">ACCESS_ONCE - æ¶ˆé™¤ä¼˜åŒ–æ­§ä¹‰ &lt;a href="#access_once---%e6%b6%88%e9%99%a4%e4%bc%98%e5%8c%96%e6%ad%a7%e4%b9%89" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ACCESS_ONCE(x) (*(volatile typeof(x) *)&amp;amp;(x))ï¼›
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ACCESS_ONCE&lt;/code>çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæŒ‡é’ˆè½¬åŒ–æˆ&lt;code>volatile&lt;/code>æŒ‡é’ˆï¼Œä½¿å¾—è¯»å–æ“ä½œâ€œçœŸçš„â€å»è¯»å–æŒ‡é’ˆçš„å€¼è€Œä¸è¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰ã€‚&lt;/p>
&lt;h2 id="å®ç°">å®ç° &lt;a href="#%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åŸå­æ“ä½œä¸nullable">åŸå­æ“ä½œä¸Nullable &lt;a href="#%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c%e4%b8%8enullable" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¯´åˆ°å¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä¸è°ˆåŸå­æ“ä½œã€‚å¯¹äºä¸€ä¸ªé˜Ÿåˆ—æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨ä»»æ„å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯è¿™äº›æ•°æ®ç»“æ„å¤§éƒ¨åˆ†éƒ½ä¸æ”¯æŒåŸå­æ“ä½œã€‚&lt;/p>
&lt;p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä¸€ç§æœ‰æ•ˆçš„æ‰‹æ®µæ¥æ ‡è¯†ä¸€ä¸ªå€¼æ˜¯â€œä¸å­˜åœ¨çš„â€ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ª&lt;code>Nullable&amp;lt;T&amp;gt;&lt;/code>çš„æ¨¡æ¿ï¼Œä½†æ˜¯å¸¦æ¥çš„é¢å¤–æˆæœ¬å°±æ˜¯å¯¹äºä»»æ„&lt;code>Nullable&amp;lt;T&amp;gt;&lt;/code>çš„èµ‹å€¼éƒ½è¦ç»è¿‡ä¸¤æ­¥ä»¥ä¸Šçš„ä¸­é—´æ­¥éª¤ï¼Œè¿™ç®€ç›´å°±æ˜¯ç«æ€bugäº§ç”Ÿçš„æ¸©åºŠã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œåœ¨C++ä¸­è‡ªå¸¦ç€ä¸€ä¸ªæœ‰ç€&amp;quot;Nullable&amp;quot;è¯­æ„çš„æ•°æ®ç»“æ„ â€”â€” æŒ‡é’ˆã€‚å½“æŒ‡é’ˆä¸ºNULLæ—¶ï¼Œæ„å‘³ç€å€¼æ˜¯ä¸å­˜åœ¨çš„ï¼Œè€ŒæŒ‡é’ˆä¸ä¸ºNULLæ—¶ï¼Œå®ƒä»£è¡¨ç€å®ƒæ‰€æŒ‡å‘çš„å€¼ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒæŒ‡é’ˆçš„èµ‹å€¼ã€è¯»å–ã€æ‹·è´éƒ½æ˜¯åŸå­çš„ï¼Œè¿™ç»™æˆ‘ä»¬çš„ä»£ç å®ç°æä¾›äº†éå¸¸å¤§çš„ä¾¿åˆ©ã€‚&lt;/p>
&lt;h3 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„ &lt;a href="#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/18-5-1/40471673.jpg" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨å•é“¾è¡¨åšä¸ºåŸºç¡€æ•°æ®ç»“æ„ï¼Œé“¾è¡¨çš„å¤´ä»£è¡¨ç€é˜Ÿåˆ—çš„å¤´ï¼Œé“¾è¡¨çš„å°¾å¯¹åº”ç€é˜Ÿåˆ—çš„å°¾ã€‚è¿™æ ·æ·»åŠ æ•°æ®æ—¶ï¼Œæˆ‘ä»¬åœ¨TAILèŠ‚ç‚¹å¤„å†™å…¥ï¼Œå¼¹å‡ºæ•°æ®æ—¶ä»HEADèŠ‚ç‚¹å¤„å¼¹å‡ºã€‚&lt;/p>
&lt;p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨å•çº¿ç¨‹ä¸‹ï¼Œç»´æŠ¤å¤´å°¾èŠ‚ç‚¹æ˜¯éå¸¸å®¹æ˜“çš„æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">ç»´æŠ¤å¤´èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cur &lt;span style="color:#f92672">=&lt;/span> HEAD&lt;span style="color:#f92672">.&lt;/span>next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HEAD&lt;span style="color:#f92672">.&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> HEAD&lt;span style="color:#f92672">.&lt;/span>next&lt;span style="color:#f92672">.&lt;/span>next &lt;span style="color:#75715e"># æ“ä½œé“¾è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">ç»´æŠ¤å°¾èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>newnode &lt;span style="color:#f92672">=&lt;/span> Node(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TAIL&lt;span style="color:#f92672">.&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> newnode &lt;span style="color:#75715e"># æ“ä½œé“¾è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TAIL &lt;span style="color:#f92672">=&lt;/span> TAIL&lt;span style="color:#f92672">.&lt;/span>next &lt;span style="color:#75715e"># æ“ä½œé“¾è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç»´æŠ¤å°¾èŠ‚ç‚¹éœ€è¦å¯¹é“¾è¡¨è¿›è¡Œä¸¤æ¬¡æ“ä½œï¼Œæˆ‘ä»¬å¾ˆéš¾æŠŠå®ƒåšä¸ºåŸå­çš„ã€‚è¿™å¤§æ¦‚æ˜¯å®ç°æ— é”é˜Ÿåˆ—æœ€å¤§çš„éš¾ç‚¹ä¹‹ä¸€ã€‚&lt;/p>
&lt;h3 id="æ¡†æ¶ä»£ç ">æ¡†æ¶ä»£ç  &lt;a href="#%e6%a1%86%e6%9e%b6%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ— é”é˜Ÿåˆ—ä¸­ï¼Œ&lt;code>push&lt;/code>å’Œ&lt;code>pop&lt;/code>ä¸¤ä¸ªå‡½æ•°æ˜¯æ ¸å¿ƒä»£ç ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦å…ˆæŠŠæ¡†æ¶ä»£ç å…ˆæ­å¥½ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">NonBlockingQueue&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> NonBlockingQueue() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>dummy;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tail &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> InnerNode();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dummy.next &lt;span style="color:#f92672">=&lt;/span> tail;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(T&lt;span style="color:#f92672">*&amp;amp;&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">InnerNode&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> value_ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode dummy;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> tail;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„&lt;code>dummy&lt;/code>æ˜¯ä¸€ä¸ªå‡çš„å¤´èŠ‚ç‚¹ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿èŠ‚ç‚¹çš„æ’å…¥çš„ï¼Œå¯ä»¥æ›¿æ¢æˆä¸€ä¸ªå¤´èŠ‚ç‚¹æŒ‡é’ˆã€‚&lt;code>tail&lt;/code>æ˜¯å°¾èŠ‚ç‚¹ï¼Œåœ¨æ„é€ å‡½æ•°é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå°†å…¶ç½®ä¸ºä¸€ä¸ªå‡çš„å°¾èŠ‚ç‚¹ï¼Œæ³¨æ„è¿™é‡Œå°¾èŠ‚ç‚¹çš„è®¾è®¡ï¼Œåæ–‡ä¼šå†æ¬¡æåˆ°ã€‚&lt;/p>
&lt;h3 id="å‡ºé˜Ÿæ“ä½œ">å‡ºé˜Ÿæ“ä½œ &lt;a href="#%e5%87%ba%e9%98%9f%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„å‡ºé˜Ÿæ“ä½œå¼€å§‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(T&lt;span style="color:#f92672">*&amp;amp;&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> cur &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur &lt;span style="color:#f92672">=&lt;/span> ACCESS_ONCE(head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cur &lt;span style="color:#f92672">==&lt;/span> tail) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>__sync_bool_compare_and_swap(&lt;span style="color:#f92672">&amp;amp;&lt;/span>(head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next), cur, cur&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> item &lt;span style="color:#f92672">=&lt;/span> cur&lt;span style="color:#f92672">-&amp;gt;&lt;/span>value_ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// delete(cur); &amp;lt;- why?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç ä¸­çš„&lt;code>__sync_bool_compare_and_swap&lt;/code>å³ä¸Šæ–‡æ‰€è¯´çš„&lt;code>cmpxchg&lt;/code>å‡½æ•°ï¼Œä¿è¯äº†èµ‹å€¼çš„åŸå­æ€§ã€‚&lt;/p>
&lt;p>æ“ä½œè¿‡ç¨‹éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°ä½äºé˜Ÿåˆ—å¤´çš„å€¼ï¼ˆHEADèŠ‚ç‚¹åé¢çš„ç¬¬ä¸€ä¸ªï¼‰ã€‚ç„¶åä½¿ç”¨CASæ“ä½œå°†å…¶æ¢å‡ºé“¾è¡¨ã€‚&lt;/p>
&lt;p>ç”±äºtailèŠ‚ç‚¹æ˜¯å‡çš„å°¾èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨&lt;code>head-&amp;gt;next == tail&lt;/code>æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å›falseã€‚&lt;/p>
&lt;p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œ&lt;code>cur&lt;/code>æŒ‡é’ˆåœ¨whileå¾ªç¯å¤–çœ‹ä¼¼å·²ç»è„±ç¦»äº†é“¾è¡¨ï¼Œå¯ä»¥æ”¾å¿ƒçš„åˆ é™¤äº†ã€‚ä½†æ˜¯ç”±äºå…¶å®ƒçº¿ç¨‹ä»æœ‰å¯èƒ½æŒæœ‰è¯¥æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™é‡Œå¯¹å®ƒè¿›è¡Œåˆ é™¤æ“ä½œã€‚&lt;/p>
&lt;p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¾ç½®äºä¸€ä¸ªå›æ”¶é˜Ÿåˆ—ä¸­ï¼Œå¾…ä¸€å°æ®µæ—¶é—´åï¼ˆå¦‚500msï¼‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¸æŒæœ‰è¯¥æŒ‡é’ˆæ—¶ï¼Œå°±å¯ä»¥å®‰å…¨çš„å°†å…¶å›æ”¶äº†ã€‚è¿™é‡Œç”±äºç¯‡å¹…åŸå› ï¼ˆæ³¨é‡Šï¼šæ‡’ï¼‰ï¼Œå°±ä¸å®ç°äº†ã€‚&lt;/p>
&lt;h3 id="å…¥é˜Ÿæ“ä½œ">å…¥é˜Ÿæ“ä½œ &lt;a href="#%e5%85%a5%e9%98%9f%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> item) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert (item &lt;span style="color:#f92672">!=&lt;/span> NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> cur &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> InnerNode&lt;span style="color:#f92672">*&lt;/span> newNode &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> InnerNode();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur &lt;span style="color:#f92672">=&lt;/span> ACCESS_ONCE(tail);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (__sync_bool_compare_and_swap(&lt;span style="color:#f92672">&amp;amp;&lt;/span>(cur&lt;span style="color:#f92672">-&amp;gt;&lt;/span>value_ptr), NULL, item)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> newNode;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tail &lt;span style="color:#f92672">=&lt;/span> tail&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„&lt;code>push&lt;/code>æ“ä½œæœ‰ä¸€ä¸ªtrickï¼Œæˆ‘ä»¬å°†&lt;code>tail-&amp;gt;value_ptr&lt;/code>åšä¸ºâ€œä¸€æŠŠé”â€ã€‚å½“&lt;code>value_ptr&lt;/code>ä¸ºç©ºæ—¶ï¼ŒtailæŒ‡é’ˆä»£è¡¨ç€ä¸€ä¸ªâ€œå‡å°¾èŠ‚ç‚¹â€ã€‚å½“æˆ‘ä»¬å‘å°¾éƒ¨è¿½åŠ æ•°æ®æ—¶ï¼Œå…ˆå°†æ•°æ®å†™å…¥&lt;code>value_ptr&lt;/code>ï¼Œä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹å·²ç»è¢«â€œå é¢†â€ã€‚ç„¶åå†å‘å®ƒçš„åé¢è¿½åŠ æ–°çš„â€œå‡å°¾èŠ‚ç‚¹â€ï¼Œæœ€åå°†æŒ‡é’ˆç§»åŠ¨è¿‡å»ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œè¿›å…¥&lt;code>if&lt;/code>ä»£ç å—çš„çº¿ç¨‹ä¸€å®šæ˜¯å†™å…¥&lt;code>tail-&amp;gt;value_ptr&lt;/code>æˆåŠŸçš„é‚£ä¸€ä¸ªï¼Œåé¢çš„æŒ‡é’ˆç§»åŠ¨ä¹Ÿæ˜¯å•çº¿ç¨‹çš„äº†ã€‚&lt;/p>
&lt;h2 id="æ„Ÿæ‚Ÿä¸å¯èƒ½çš„æ”¹è¿›">æ„Ÿæ‚Ÿä¸å¯èƒ½çš„æ”¹è¿› &lt;a href="#%e6%84%9f%e6%82%9f%e4%b8%8e%e5%8f%af%e8%83%bd%e7%9a%84%e6%94%b9%e8%bf%9b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ€è¿‘ç¡®å®å¥½ä¹…ä¸å†™è¿™ä¹ˆåº•å±‚çš„ä»£ç ï¼Œæ‰‹ç”Ÿçš„å‰å®³ï¼Œå¯¹äºå¤šçº¿ç¨‹çŠ¶æ€çš„åˆ†æä¹Ÿä¸æ˜¯å¾ˆçµå…‰ã€‚ç¡®å®éœ€è¦å¤šåŠªåŠ›äº†ã€‚æœ¬æ–‡ä¸­çš„ä»£ç ä¹Ÿè®¸è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥æ¬¢è¿å¤§å®¶æŒ‡æ­£ã€‚&lt;/p>
&lt;p>åœ¨å†™è¿™æ®µä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰æœ‰å¦‚ä¸‹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ææ„ä¸€å—å†…å­˜æ˜¯å¦æ˜¯å®‰å…¨çš„ï¼Œä¼šä¸ä¼šåˆ«çš„çº¿ç¨‹ä»åœ¨æŒæœ‰è¿™å—å†…å­˜çš„æŒ‡é’ˆ&lt;/li>
&lt;li>ç¼–è¯‘å™¨ä¼šä¸ä¼šç»™æˆ‘ä»¬æ£ä¹±ï¼Œæ¯”å¦‚é‡æ’æŒ‡ä»¤ç­‰&lt;/li>
&lt;li>åˆ©ç”¨CASçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé”çš„ç»“æ„ï¼Œä½†æ˜¯ä»¥å“ªä¸ªå˜é‡/æŒ‡é’ˆåšä¸ºé”å¯ä»¥è·å¾—æœ€å¥½çš„æ•ˆæœ&lt;/li>
&lt;/ul>
&lt;p>é™¤äº†ç”¨é“¾è¡¨å®ç°é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¯å‹æ•°ç»„ã€‚æ„Ÿè§‰ä¸Šæ¥è¯´æ¯”ä½¿ç”¨é“¾è¡¨æ›´ä¼˜é›…ä¸€ç‚¹ã€‚å…³é”®åœ¨äºç¯å‹æ•°ç»„ä¸­éšå«ç€å‰é©±æŒ‡é’ˆå’Œåç»§èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå¤æ‚çš„å†…å­˜ç®¡ç†å·¥ä½œã€‚&lt;/p>
&lt;p>å®Œæ•´å®ç°è¯·å‚è€ƒ&lt;a href="https://paste.ubuntu.com/p/vYD6h5sm9n/">é“¾æ¥&lt;/a>ï¼Œäº²æµ‹åœ¨Ubuntu 16.04ä¸‹ä½¿ç”¨&lt;code>g++ main.cc -lpthread&lt;/code>ç¼–è¯‘è¿è¡ŒæˆåŠŸã€‚ï¼ˆp.s. ä¸è¦åŠ C++11æ ‡ç­¾ï¼Œç¼–ä¸è¿‡çš„ï¼‰&lt;/p>
&lt;h2 id="ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥ &lt;a href="#%e7%9b%b8%e5%85%b3%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://coolshell.cn/articles/8239.html">æ— é”é˜Ÿåˆ—çš„å®ç° - é…·å£³&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å¼±å¼±æ„Ÿè§‰æ–‡ç« é‡Œè¯´çš„å®ç°æœ‰é—®é¢˜ï¼ˆ240414æ›´æ–°ï¼šå…¶å®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè§å‹˜è¯¯æ–‡ç« ï¼‰&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>&lt;a href="https://cloud.tencent.com/developer/article/1006241">å…±äº«å†…å­˜æ— é”é˜Ÿåˆ—çš„å®ç°&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æŒ‡å‡ºäº†å®ç°ä¸Šé¢å¯èƒ½è¸©åˆ°çš„å‘&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>&lt;a href="https://cloud.tencent.com/developer/article/1071029">ä¸€ç§é«˜æ•ˆæ— é”å†…å­˜é˜Ÿåˆ—çš„å®ç°&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ç¯å½¢æ•°ç»„çš„å®ç°&lt;/p>&lt;/blockquote></description></item><item><title>ä¸€ç§åŒºé—´äº¤é—®é¢˜çš„å¥‡æ€ªå§¿åŠ¿</title><link>https://wizmann.top/posts/range-problem/</link><pubDate>Tue, 20 Feb 2018 22:59:47 +0000</pubDate><guid>https://wizmann.top/posts/range-problem/</guid><description>&lt;blockquote>
&lt;p>Update[220504]: åŸæ¥è¿™ç§æ•°æ®ç»“æ„å«&lt;a href="https://oi-wiki.org/ds/odt/">ç‚æœµè‰æ ‘&lt;/a>å•Šï¼ŒçœŸç¥å¥‡ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜">æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ &lt;a href="#%e6%88%91%e4%bb%ac%e8%a6%81%e8%a7%a3%e5%86%b3%e4%bb%80%e4%b9%88%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åŒºé—´äº¤é—®é¢˜ï¼Œæ˜¯æˆ‘ä»¬åœ¨åšé¢˜ä¸­ç»å¸¸é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œ&lt;a href="https://leetcode.com/problems/insert-interval/description/">Insert Interval&lt;/a>ä¸€é¢˜ï¼Œå°±æ˜¯æ¯”è¾ƒç›´ç™½çš„åŒºé—´äº¤é—®é¢˜ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šä¸€ç³»åˆ—çš„æ•´æ•°åŒºé—´ï¼Œå†æ’å…¥ä¸€ä¸ªæ–°çš„åŒºé—´ï¼Œé—®åˆå¹¶åçš„æ•´æ•°åŒºé—´æ˜¯ä»€ä¹ˆ&lt;/p>&lt;/blockquote>
&lt;p>ç±»ä¼¼çš„è¿˜æœ‰&lt;a href="https://leetcode.com/problems/merge-intervals/description/">Merge Intervals&lt;/a>ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šä¸€ç³»åˆ—å¯èƒ½æœ‰é‡å çš„æ•´æ•°åŒºé—´ï¼Œæ±‚åˆå¹¶åçš„æ•´æ•°åŒºé—´&lt;/p>&lt;/blockquote>
&lt;p>å¦ä¸€ç§åŒºé—´äº¤é—®é¢˜çš„æè¿°æ˜¯æ—¶é—´åŒºé—´ç›¸å…³çš„é—®é¢˜ï¼Œå¦‚&lt;a href="http://lintcode.com/en/problem/time-intersection/">Time Intersection&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šç”¨æˆ·Aå’Œç”¨æˆ·Bçš„åœ¨çº¿æ—¶é—´åŒºé—´ï¼Œé—®ä¸¤äººåŒæ—¶åœ¨çº¿çš„æ—¶é—´åŒºé—´&lt;/p>&lt;/blockquote>
&lt;p>åˆå¦‚ç»å…¸çš„ä¼šè®®å®¤å®‰æ’é—®é¢˜&lt;a href="https://segmentfault.com/a/1190000003894670">Meeting Rooms&lt;/a>å’Œ&lt;a href="http://www.cnblogs.com/grandyang/p/5244720.html">Meeting Rooms II&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šNä¸ªä¼šè®®çš„æ—¶é—´åŒºé—´ï¼Œé—®ä¸€ä¸ªäººèƒ½å¦å‚åŠ æ‰€æœ‰çš„ä¼šè®®&lt;/p>&lt;/blockquote>
&lt;p>ä»¥åŠ&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šNä¸ªä¼šè®®çš„æ—¶é—´åŒºé—´ï¼Œé—®æœ€å°‘éœ€è¦å¤šå°‘ä¸ªä¼šè®®å®¤&lt;/p>&lt;/blockquote>
&lt;p>è¿˜æœ‰ç³»ç»Ÿè®¾è®¡ä¸APIè®¾è®¡åŒ…è£…åçš„ç®—æ³•é¢˜&lt;a href="https://leetcode.com/problems/range-module/description/">Range Module&lt;/a>ã€‚å½’æ ¹ç»“åº•ï¼Œéƒ½æ˜¯æ•´æ•°åŒºé—´é—®é¢˜çš„å˜å½¢æˆ–è€…åŒ…è£…ã€‚&lt;/p>
&lt;h2 id="ä¼ ç»Ÿè§£æ³•">ä¼ ç»Ÿè§£æ³• &lt;a href="#%e4%bc%a0%e7%bb%9f%e8%a7%a3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºè¿™ç±»åŒºé—´é—®é¢˜ï¼Œä¼ ç»Ÿçš„è§£æ³•æ˜¯å°†åŒºé—´ä½¿ç”¨é¡ºåºå®¹å™¨ï¼ˆå¦‚&lt;code>vector&lt;/code>ï¼‰ä¿å­˜ï¼Œåœ¨æŸ¥è¯¢å’Œä¿®æ”¹æ—¶ï¼Œä½¿ç”¨â€œæ’åº+éå†â€æˆ–è€…â€œæ’åº+äºŒåˆ†â€ã€‚&lt;/p>
&lt;p>è¿™ç§è§£å†³åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯åŒºé—´é—®é¢˜çš„é€šè§£ï¼Œä½†æ˜¯è¿™æ ·åšä¹Ÿæœ‰å®ƒçš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸€æ¥åŒºé—´é—®é¢˜æœ‰å¾ˆå¤šå¯¹åŒºé—´åºåˆ—è¿›è¡Œéšæœºå¢åŠ ã€åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¯¹äºé¡ºåºå®¹å™¨æ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚&lt;/p>
&lt;p>äºŒæ¥å¯¹äºä½¿ç”¨â€œèµ·ç‚¹â€æˆ–â€œç»ˆç‚¹â€æ’åºçš„åŒºé—´ï¼ŒäºŒåˆ†æŸ¥æ‰¾éœ€è¦å¤„ç†å¾ˆå¤šé‡å¤å€¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‘ç”Ÿå¤æ‚åº¦çš„é€€åŒ–ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¼˜åŒ–æˆ‘ä»¬çš„å®ç°æ¥è§£å†³ä»¥ä¸Šçš„é—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;h2 id="ä½¿ç”¨stdsetinterval">ä½¿ç”¨&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code> &lt;a href="#%e4%bd%bf%e7%94%a8stdsetinterval" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬ä»¥&lt;a href="https://leetcode.com/problems/merge-intervals/description/">Merge Intervals&lt;/a>ä¸€é¢˜ä¸ºä¾‹ã€‚åªè¦ä¸¤ä¸ªåŒºé—´æœ‰äº¤é›†ï¼Œæ— è®ºæ˜¯å“ªä¸€ç§å½¢å¼çš„ç›¸äº¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æŠŠè¿™ä¸¤ä¸ªåŒºé—´åˆå¹¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/18-2-20/85403056.jpg" alt="">&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦èƒ½é«˜æ•ˆçš„åˆ¤æ–­ä¸¤ä¸ªåŒºé—´&lt;strong>æ˜¯å¦ç›¸äº¤&lt;/strong>ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åå…¶é“è€Œè¡Œä¹‹ï¼Œå…ˆæ¥è®¨è®ºä¸€ä¸‹&lt;strong>ä¸ç›¸äº¤&lt;/strong>çš„æƒ…å†µã€‚å¯¹äºä¸¤ä¸ªä¸ç›¸äº¤çš„åŒºé—´&lt;code>A&lt;/code>å’Œ&lt;code>B&lt;/code>ï¼Œåªå­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œä¸€æ˜¯&lt;code>A&lt;/code>åœ¨&lt;code>B&lt;/code>å·¦é¢ï¼ŒäºŒæ˜¯&lt;code>A&lt;/code>åœ¨&lt;code>B&lt;/code>å³é¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/18-2-20/87075632.jpg" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æŠŠåŒºé—´çš„å·¦å³å…³ç³»çœ‹æˆä¸ç›¸äº¤åŒºé—´çš„é¡ºåºå…³ç³»ï¼Œå³ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœåŒºé—´&lt;code>A&lt;/code>åœ¨åŒºé—´&lt;code>B&lt;/code>çš„â€œå·¦è¾¹â€ï¼Œæˆ‘ä»¬è¯´&lt;code>A &amp;lt; B&lt;/code>&lt;/li>
&lt;li>å¦‚æœåŒºé—´&lt;code>A&lt;/code>åœ¨åŒºé—´&lt;code>B&lt;/code>çš„â€œå³è¾¹â€ï¼Œæˆ‘ä»¬è¯´&lt;code>A &amp;gt; B&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥ï¼Œæ ¹æ®ä¸ç›¸äº¤åŒºé—´çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè‡ªç„¶çš„å°†å®ƒä»¬å­˜å‚¨åœ¨&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>å½“ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨&lt;code>O(logN)&lt;/code>æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ã€éšæœºæ’å…¥ä¸éšæœºåˆ é™¤ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå›åˆ°æœ€å¼€å§‹åˆ¤æ–­åŒºé—´&lt;strong>æ˜¯å¦ç›¸äº¤&lt;/strong>çš„é—®é¢˜ã€‚å¯¹äºç›¸äº¤çš„åŒºé—´&lt;code>A&lt;/code>å’Œ&lt;code>B&lt;/code>ï¼Œéå¸¸æ˜æ˜¾ï¼Œ&lt;code>A &amp;lt; B&lt;/code>ä¸&lt;code>A &amp;gt; B&lt;/code>éƒ½æ˜¯ä¸æˆç«‹çš„ã€‚åœ¨&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>ä¸­ï¼Œè¿™ç§å…³ç³»è¢«åˆ¤å®šä¸º&lt;strong>ç›¸ç­‰&lt;/strong>ã€‚&lt;/p>
&lt;p>è™½ç„¶è¿™ç§&lt;strong>ç›¸ç­‰&lt;/strong>å…³ç³»æ˜¯ä¸ç¬¦åˆå¸¸è§„é€»è¾‘çš„ï¼Œä½†æ˜¯å´éå¸¸å®ç”¨ã€‚å¦‚æœä¸¤ä¸ªåŒºé—´æœ‰â€œå¤§å°â€å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åŒºé—´çš„ç›¸å¯¹ä½ç½®ã€‚è€Œå¦‚æœä¸¤ä¸ªåŒºé—´â€œç›¸ç­‰â€ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸¤ä¸ªåŒºé—´ä¸€å®šç›¸äº¤ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œåœ¨è¿™ç±»é¢˜ç›®ä¸­ï¼Œä¸¤ä¸ªç›¸äº¤çš„åŒºé—´æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨çš„ã€‚è¿™ä¸&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>ä¸­å…ƒç´ çš„å”¯ä¸€æ€§ç›¸å‘¼åº”ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>æ¥å­˜å‚¨åŒºé—´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ€§è´¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>find()&lt;/code>å‡½æ•°æ¥æŸ¥æ‰¾ç›¸äº¤åŒºé—´ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œç›¸äº¤çš„åŒºé—´å¯èƒ½æœ‰å¤šä¸ª&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>insert()&lt;/code>æ¥æ’å…¥åŒºé—´ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œå…ˆè¦åˆ¤æ–­æ˜¯å¦æœ‰åŒºé—´ä¸æ–°æ’å…¥çš„åŒºé—´ç›¸äº¤&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>erase()&lt;/code>æ¥åˆ é™¤åŒºé—´ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å®æˆ˜---merge-intervals">å®æˆ˜ - Merge Intervals &lt;a href="#%e5%ae%9e%e6%88%98---merge-intervals" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>åœ¨Merge Intervalsä¸€é¢˜ä¸­ä½¿ç”¨std::set&lt;Interval>å¹¶ä¸æ˜¯æœ€ä¼˜çš„è§£æ³•ã€‚è¿™é‡Œåªåšä¸¾ä¾‹ã€‚&lt;/p>&lt;/blockquote>
&lt;p>é¢˜ç›®é“¾æ¥ï¼š&lt;a href="https://leetcode.com/problems/merge-intervals/description/">Merge Intervals&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Definition for an interval.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * struct Interval {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * int start;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * int end;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Interval() : start(0), end(0) {}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Interval(int s, int e) : start(s), end(e) {}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * };
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// overload the comparator for std::set
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> Interval&lt;span style="color:#f92672">&amp;amp;&lt;/span> i1, &lt;span style="color:#66d9ef">const&lt;/span> Interval&lt;span style="color:#f92672">&amp;amp;&lt;/span> i2) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> i1.end &lt;span style="color:#f92672">&amp;lt;&lt;/span> i2.start;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Interval&lt;span style="color:#f92672">&amp;gt;&lt;/span> merge(vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Interval&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> intervals) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> set&lt;span style="color:#f92672">&amp;lt;&lt;/span>Interval&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> interval: intervals) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// merge intervals which are overlaped
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> st.find(interval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (iter &lt;span style="color:#f92672">==&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interval &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> min(interval.start, iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>start),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max(interval.end, iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>end)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.erase(iter);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// add the new interval to std::set
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> st.insert(interval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// copy the intervals to a vector
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Interval&lt;span style="color:#f92672">&amp;gt;&lt;/span> result;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> copy(st.begin(), st.end(), back_inserter(result));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> result;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>ä¸­å­˜å‚¨äº†å·²ç»åˆå¹¶å¥½çš„åŒºé—´ã€‚å½“åŠ å…¥æ–°çš„åŒºé—´æ—¶ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆ¤æ–­æ–°åŒºé—´æ˜¯å¦ä¸å·²æœ‰åŒºé—´ç›¸å…³ï¼Œå¦‚æœç›¸äº¤ï¼Œåˆ™è¿›è¡Œåˆå¹¶ã€‚&lt;/p>
&lt;h2 id="å®æˆ˜---range-module">å®æˆ˜ - Range Module &lt;a href="#%e5%ae%9e%e6%88%98---range-module" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¢˜ç›®é“¾æ¥ï¼š&lt;a href="https://leetcode.com/problems/range-module/description/">Range Module&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>é¢˜æ„ï¼š &lt;br>
è®¾è®¡ä¸€ä¸ªç±»ï¼Œæä¾›ä¸‰ä¸ªæ¥å£ï¼š &lt;br>&lt;br>
æ¥å£1ï¼š&lt;code>void addRange(int left, int right)&lt;/code> &lt;br>
å°†åŒºé—´&lt;code>[left, right - 1]&lt;/code>åŠ å…¥åŒºé—´é›†åˆ &lt;br>&lt;br>
æ¥å£2ï¼š&lt;code>bool queryRange(int left, int right)&lt;/code> &lt;br>
æŸ¥è¯¢æ˜¯å¦å·²æœ‰åŒºé—´ä¸åŒºé—´&lt;code>[left, right - 1]&lt;/code>ç›¸äº¤ &lt;br>&lt;br>
æ¥å£3ï¼š&lt;code>void removeRange(int left, int right)&lt;/code>
ç§»é™¤å·²æœ‰åŒºé—´å†…ï¼Œä½äº&lt;code>[left, right - 1]&lt;/code>èŒƒå›´å†…çš„æ‰€æœ‰æ•°&lt;/p>&lt;/blockquote>
&lt;p>è¿™ä¸ªé¢˜ç›®çœ‹ä¼¼å¯ä»¥å®Œå…¨å¥—ç”¨æˆ‘ä»¬ä¸Šé¢è®²åˆ°çš„&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>çš„å®ç°ï¼Œä½†æ˜¯è¿™é‡Œæœ‰å‡ ä¸ªæš—å‘éœ€è¦æ³¨æ„ã€‚&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹æ¥å£3ï¼Œè¿™é‡Œçš„åˆ é™¤å¹¶ä¸æ˜¯åˆ é™¤åŒºé—´ï¼Œè€Œæ˜¯åˆ é™¤æ•´æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>find()&lt;/code>å‡½æ•°ï¼Œä½†æ˜¯ä¸ä¹‹å‰çš„åˆå¹¶æ“ä½œä¸åŒï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦åˆ é™¤åŒºé—´ä¸­çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>åœ¨åˆ é™¤æ•´æ•°æ“ä½œè¿›è¡Œå®Œä¹‹åï¼Œä¼šå¼•å…¥ä¸€ä¸ªæ–°é—®é¢˜ï¼Œè¿™å°±æ˜¯ä¸€äº›è¿ç»­çš„æ•´æ•°åŒºé—´ï¼Œä¼šåœ¨&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>ä¸­è¡¨ç°ä¸ºç‹¬ç«‹çš„å¤šä¸ªåŒºé—´ã€‚ä¾‹å¦‚ï¼ŒåŒºé—´&lt;code>[1, 5]&lt;/code>ï¼Œåœ¨åˆ é™¤äº†&lt;code>[2, 3]&lt;/code>ä¹‹åï¼Œä¼šå½¢æˆä¸¤ä¸ªåŒºé—´&lt;code>[1, 1]&lt;/code> å’Œ &lt;code>[4, 5]&lt;/code>ã€‚æˆ‘ä»¬å†æŠŠåŒºé—´&lt;code>[2, 3]&lt;/code>åŠ å›æ¥ï¼Œå¦‚æœä¸è¿›è¡Œç‰¹æ®Šæ“ä½œï¼Œå°±ä¼šäº§ç”Ÿä¸‰ä¸ªä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;code>[1, 1]&lt;/code>ã€&lt;code>[2, 3]&lt;/code>å’Œ&lt;code>[4, 5]&lt;/code>ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ’å…¥åŒºé—´æ—¶ï¼Œè¦å¤šåšä¸€æ­¥åŒºé—´åˆå¹¶çš„æ“ä½œã€‚&lt;/p>
&lt;p>å…·ä½“çš„å®ç°ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨æ’å…¥åŒºé—´&lt;code>[l, r]&lt;/code>ä¹‹å‰ï¼Œå…ˆæŸ¥æ‰¾æ˜¯ä¸å­˜åœ¨åŒºé—´åŒ…å«&lt;code>[l - 1, l - 1]&lt;/code>æˆ–&lt;code>[r + 1, r + 1]&lt;/code>ã€‚å¦‚æœæœ‰ï¼Œåˆ™å…ˆå°†å·²æœ‰çš„ç›¸é‚»åŒºé—´åˆå¹¶çš„æ–°åŒºé—´é‡Œ&lt;/li>
&lt;li>å°†æ–°çš„åŒºé—´è¿›è¡Œåˆå¹¶æ“ä½œï¼Œæ’å…¥&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>æ­£ç¡®æ€§è¯æ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>å·²çŸ¥1ï¼šç©ºåŒºé—´é›†åˆä¸åŒ…å«&lt;strong>ä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;/strong>&lt;/li>
&lt;li>å·²çŸ¥2ï¼šåªæœ‰æ’å…¥æ“ä½œä¼šäº§ç”Ÿ&lt;strong>ä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;/strong>&lt;/li>
&lt;li>å½’çº³å‡è®¾ï¼šæˆ‘ä»¬ä¿è¯åœ¨ä»»ä½•æ’å…¥æ–°åŒºé—´çš„æ“ä½œä¹‹å‰ï¼Œ&lt;code>std::set&amp;lt;Interval&amp;gt;&lt;/code>ä¸­å‡ä¸åŒ…å«&lt;strong>ä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;/strong>ã€‚&lt;/li>
&lt;li>è¯æ˜ï¼š&lt;br>
å¦‚æœåŒºé—´é›†åˆå†…ä¸åŒ…å«&lt;strong>ä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;/strong>ï¼Œé‚£ä¹ˆå¯¹äºæ–°åŠ åŒºé—´ï¼Œæˆ‘ä»¬åªéœ€è¦å°è¯•åˆå¹¶å…¶è¿‘é‚»åŒºé—´&lt;code>[l - 1, l - 1]&lt;/code>å’Œ&lt;code>[r + 1, r + 1]&lt;/code>ï¼Œå°±ä¸ä¼šäº§ç”Ÿ&lt;strong>ä¸ç›¸äº¤ä½†è¿ç»­çš„åŒºé—´&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»£ç å®ç°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">MyInterval&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> left, right;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> MyInterval&lt;span style="color:#f92672">&amp;amp;&lt;/span> other) &lt;span style="color:#66d9ef">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right &lt;span style="color:#f92672">&amp;lt;&lt;/span> other.left;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">RangeModule&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RangeModule() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">addRange&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> left, &lt;span style="color:#66d9ef">int&lt;/span> right) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyInterval ll &lt;span style="color:#f92672">=&lt;/span> {left &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, left &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> liter &lt;span style="color:#f92672">=&lt;/span> st.find(ll);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (liter &lt;span style="color:#f92672">!=&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> left &lt;span style="color:#f92672">=&lt;/span> liter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>left;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyInterval rr &lt;span style="color:#f92672">=&lt;/span> {right &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, right &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> riter &lt;span style="color:#f92672">=&lt;/span> st.find(rr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (riter &lt;span style="color:#f92672">!=&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right &lt;span style="color:#f92672">=&lt;/span> riter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> doAddRange(left, right);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">doAddRange&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> left, &lt;span style="color:#66d9ef">int&lt;/span> right) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyInterval newInterval &lt;span style="color:#f92672">=&lt;/span> {left, right};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> st.find(newInterval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (iter &lt;span style="color:#f92672">==&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> newInterval.left &lt;span style="color:#f92672">=&lt;/span> min(newInterval.left, iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>left);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> newInterval.right &lt;span style="color:#f92672">=&lt;/span> max(newInterval.right, iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.erase(iter);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.insert(newInterval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">queryRange&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> left, &lt;span style="color:#66d9ef">int&lt;/span> right) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyInterval interval &lt;span style="color:#f92672">=&lt;/span> {left, right};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> st.find(interval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (iter &lt;span style="color:#f92672">==&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>left &lt;span style="color:#f92672">&amp;lt;=&lt;/span> left &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> right &lt;span style="color:#f92672">&amp;lt;=&lt;/span> iter&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">removeRange&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> left, &lt;span style="color:#66d9ef">int&lt;/span> right) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyInterval newInterval &lt;span style="color:#f92672">=&lt;/span> {left, right};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> st.find(newInterval);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (iter &lt;span style="color:#f92672">==&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> cur &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">*&lt;/span>iter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.erase(iter);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cur.left &lt;span style="color:#f92672">&amp;lt;&lt;/span> newInterval.left) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.insert({cur.left, newInterval.left &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cur.right &lt;span style="color:#f92672">&amp;gt;&lt;/span> newInterval.right) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.insert({newInterval.right &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, cur.right});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> set&lt;span style="color:#f92672">&amp;lt;&lt;/span>MyInterval&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Bw-Treeï¼šåœ¨æ–°ç¡¬ä»¶å¹³å°ä¸Šçš„æ–°B-Tree</title><link>https://wizmann.top/posts/bw-tree/</link><pubDate>Mon, 18 Dec 2017 00:49:00 +0000</pubDate><guid>https://wizmann.top/posts/bw-tree/</guid><description>&lt;h2 id="ars-ä¸-bw-tree">ARS ä¸ Bw-Tree &lt;a href="#ars-%e4%b8%8e-bw-tree" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>nosqlæ•°æ®åº“ä»æœ¬è´¨ä¸Šè¯´ï¼Œéƒ½å±äºARSï¼ˆAtomic Record Storesï¼Œâ€œåŸå­è®°å½•å­˜å‚¨â€ï¼‰ã€‚&lt;/p>
&lt;p>æœ€å¸¸è§çš„â€œåŸå­è®°å½•å­˜å‚¨â€ä¸€ç§å®ç°å°±æ˜¯æœ´ç´ çš„Hashè¡¨ï¼šé€šè¿‡ä¸€ä¸ªç‰¹å®šçš„keyï¼Œæ¥è¯»å†™ä¸€æ¡ç‹¬ç«‹çš„æ•°æ®è®°å½•ã€‚&lt;/p>
&lt;p>ä¸€äº›åŸºäºkey-valueï¼ˆé”®-å€¼ï¼‰æ¨¡å‹çš„nosqlçš„å†…éƒ¨å®ç°æ­£æ˜¯ä½¿ç”¨äº†Hashè¡¨ï¼Œä¾‹å¦‚Redis&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>ã€memcacheã€Riakç­‰ã€‚&lt;/p>
&lt;p>è€Œæœ‰ä¸€äº›nosqlæ•°æ®åº“ä¸ºäº†æ”¯æŒé«˜æ•ˆçš„key-sequentialï¼ˆé”®-åºåˆ—ï¼‰æŸ¥æ‰¾ï¼Œé‡‡ç”¨äº†tree-based&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>æ•°æ®ç»“æ„è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ‰€ä»¥B-Treeæˆä¸ºäº†ä¸€äº›æ•°æ®åº“ï¼ˆboth nosql and sqlï¼‰çš„é¦–é€‰ã€‚&lt;/p>
&lt;p>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§åŸºäºæ–°å‹ç¡¬ä»¶çš„é«˜æ€§èƒ½ARSå®ç°ï¼Œå…¶æ ¸å¿ƒæŠ€æœ¯æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>é¡µå¼å†…å­˜ç®¡ç†&lt;/li>
&lt;li>Bw-Treeï¼Œä¸€ç§åŸºäºB-Treeçš„æ ‘å­˜å‚¨ç»“æ„&lt;/li>
&lt;li>åŸºäºæ—¥å¿—çš„å­˜å‚¨ç®¡ç†&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-8/19953353.jpg" alt="">&lt;/p>
&lt;h2 id="åœ¨ç°ä»£ç¡¬ä»¶ä¸Šçš„bw-tree">åœ¨ç°ä»£ç¡¬ä»¶ä¸Šçš„Bw-Tree &lt;a href="#%e5%9c%a8%e7%8e%b0%e4%bb%a3%e7%a1%ac%e4%bb%b6%e4%b8%8a%e7%9a%84bw-tree" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ç°ä»£å¤šæ ¸cpu">ç°ä»£å¤šæ ¸CPU &lt;a href="#%e7%8e%b0%e4%bb%a3%e5%a4%9a%e6%a0%b8cpu" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¤šæ ¸CPUå¸¦æ¥äº†é«˜å¹¶å‘ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¼•å…¥äº†é”ç«äº‰å’Œç¼“å­˜å¤±æ•ˆé—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†è®²è§£é”ç«äº‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼šå¤šçº¿ç¨‹è®¡æ•°å™¨ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœä¸ä½¿ç”¨é”æ¥ä¿æŠ¤è®¡æ•°å™¨å˜é‡çš„è¯ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç»“æœå‡ ä¹ä¸å¯èƒ½æ˜¯æ­£ç¡®çš„ã€‚å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œåªèƒ½æœ‰å”¯ä¸€ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŒæœ‰é”ï¼Œå…¶å®ƒçš„çº¿ç¨‹éƒ½éœ€è¦ç­‰å¾…ã€‚è¿™æ ·å°±å½±å“åˆ°äº†ç¨‹åºçš„å¹¶å‘åº¦ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œä¸€äº›é«˜çº§ç©å®¶ä¼šæåˆ°CASï¼ˆcompare-and-swapï¼‰å‘½ä»¤ã€‚CASç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œæ¯”è¾ƒå¹¶äº¤æ¢â€ï¼Œç”¨åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å®ç°æ•°æ®äº¤æ¢æ“ä½œã€‚è¯¦æƒ…è¯·è§ï¼š&lt;a href="https://en.wikipedia.org/wiki/Compare-and-swap">æ¯”è¾ƒå¹¶äº¤æ¢&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>ç¼“å­˜å¤±æ•ˆäº§ç”Ÿäºä¸¤ç§åœºæ™¯ã€‚ä¸€æ˜¯ä¸Šæ–‡æåˆ°çš„é”äº‰ç”¨ï¼Œå³æ¯æ¬¡é”äº‰ç”¨éƒ½ä¼šè®©å½“å‰çº¿ç¨‹é™·å…¥å†…æ ¸æ€ï¼Œäº§ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¼è‡´CPUç¼“å­˜çš„å¤±æ•ˆã€‚äºŒæ˜¯ç¼“å­˜ä¸€è‡´æ€§åè®®å¯¼è‡´çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œå³å¤šä¸ªCPUåœ¨å…±äº«ä¸€ä¸ªå…±åŒçš„ä¸»å­˜èµ„æºæ—¶ï¼Œä¸ºäº†ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨ä¸»å­˜èµ„æºè¢«ä¿®æ”¹åï¼Œç›¸åº”çš„ç¼“å­˜è¡Œä¹Ÿä¼šå¤±æ•ˆã€‚&lt;/p>
&lt;p>Bw-Treeä¸ºäº†è§£å†³ä»¥ä¸Šçš„é—®é¢˜ï¼Œä½¿ç”¨äº†ä»¥ä¸‹ä¸¤ä¸ªæªæ–½ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ— é”æ•°æ®ç»“æ„ &lt;br>
é¿å…äº†ç³»ç»Ÿé˜»å¡åœ¨é”ä¸Šï¼Œæ›´é¿å…äº†ç”±äºé”äº‰ç”¨å¯¼è‡´çš„ç¼“å­˜å¤±æ•ˆä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢é‡æ›´æ–° &lt;br>
ä½¿ç”¨å¢é‡æ›´æ–°è€Œä¸æ˜¯åŸåœ°æ›´æ–°ï¼Œé¿å…ä¿®æ”¹å…±äº«çš„ä¸»å­˜èµ„æºï¼Œè§„é¿ç¼“å­˜ä¸€è‡´æ€§äº§ç”Ÿçš„ç¼“å­˜å¤±æ•ˆé—®é¢˜ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="ç°ä»£å­˜å‚¨è®¾å¤‡">ç°ä»£å­˜å‚¨è®¾å¤‡ &lt;a href="#%e7%8e%b0%e4%bb%a3%e5%ad%98%e5%82%a8%e8%ae%be%e5%a4%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ•°æ®åº“ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç“¶é¢ˆå°±æ˜¯IOæ€§èƒ½ã€‚SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰æä¾›äº†æ¯”ä¼ ç»Ÿæœºæ¢° ç¡¬ç›˜æ›´å¥½çš„è¯»å†™æ€§èƒ½ï¼Œè™½ç„¶è¡¨é¢ä¸Šç¼“è§£äº†é—®é¢˜ï¼Œä½†æ˜¯IOä»ç„¶å¯èƒ½æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼ŒBw-Treeä½¿ç”¨å¤§å†…å­˜åšä¸ºè¯»ç¼“å­˜ï¼ŒåŒæ—¶é‡‡ç”¨append-onlyç»“æ„ä¿å­˜å†™ä¿¡æ¯ã€‚å› ä¸ºä¸è®ºæ˜¯SSDè¿˜æ˜¯æœºæ¢°ç¡¬ç›˜ï¼Œé¡ºåºè¯»å†™çš„æ€§èƒ½éƒ½éå¸¸å‡ºè‰²ã€‚&lt;/p>
&lt;h2 id="bw-treeçš„é¡µå¼å­˜å‚¨ç»“æ„">Bw-Treeçš„é¡µå¼å­˜å‚¨ç»“æ„ &lt;a href="#bw-tree%e7%9a%84%e9%a1%b5%e5%bc%8f%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æ˜ å°„è¡¨mapping-table">æ˜ å°„è¡¨ï¼ˆMapping Tableï¼‰ &lt;a href="#%e6%98%a0%e5%b0%84%e8%a1%a8mapping-table" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°äº†ç¼“å­˜ä¸€è‡´æ€§ï¼ˆcache coheranceï¼‰ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“æˆ‘ä»¬ä¿®æ”¹å¤šä¸ªCPUå…±äº«çš„å†…å­˜èµ„æºæ—¶ï¼Œä¼šå¯¼è‡´ç¼“å­˜çš„å¤±æ•ˆï¼Œè¿›è€Œå½±å“æŒ‡ä»¤çš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p>
&lt;p>Bw-Treeä½¿ç”¨é¡µå¼ï¼ˆpaginatedï¼‰å­˜å‚¨ç®¡ç†ä¸æ˜ å°„è¡¨è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚Bw-Treeä»¥â€œé¡µâ€åšä¸ºå­˜å‚¨çš„å•å…ƒï¼Œæ¯ä¸€é¡µéƒ½æœ‰ä¸€ä¸ªPIDã€‚é¡µçš„ç‰©ç†ä½ç½®å¯ä»¥å­˜å‚¨åœ¨ä¸»å­˜ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚&lt;/p>
&lt;p>æ˜ å°„è¡¨å°†PIDæ‰€ä»£è¡¨çš„æ˜ å°„åˆ°é¡µæ‰€åœ¨çš„å…·ä½“ç‰©ç†ä½ç½®ã€‚æ‰€ä»¥å½“é¡µçš„ç‰©ç†ä½ç½®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä»ç„¶ä¿æŒPIDä¸€è‡´ï¼Œä¸éœ€è¦å¯¹Bw-Treeçš„ç»“æ„è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚&lt;/p>
&lt;h3 id="å¢é‡ä¿®æ”¹delta-updating">å¢é‡ä¿®æ”¹ï¼ˆDelta Updatingï¼‰ &lt;a href="#%e5%a2%9e%e9%87%8f%e4%bf%ae%e6%94%b9delta-updating" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-10/18893113.jpg" alt="">&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰æ•°æ®&lt;code>D&lt;/code>ï¼Œå½“æœ‰ä¿®æ”¹è¯·æ±‚&lt;code>delta&lt;/code>åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®&lt;code>D&lt;/code>&lt;strong>åŸåœ°&lt;/strong>ä¿®æ”¹ä¸º&lt;code>D'&lt;/code>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å¢é‡æ›´æ–°çš„æ–¹æ³•å°†å…¶ä¿å­˜ä¸º&lt;code>delta + D&lt;/code>çš„å½¢å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-18/98762144.jpg" alt="">&lt;/p>
&lt;p>å¢é‡æ›´æ–°çœ‹èµ·æ¥æ¯”åŸåœ°æ›´æ–°è€—è´¹äº†æ›´å¤šçš„å†…å­˜ï¼Œä½†å…¶ä¼˜åŠ¿ä¹Ÿéå¸¸æ˜æ˜¾ã€‚ä¸€æ˜¯ä¿®æ”¹ä¸éœ€è¦å¯¹é¡µåŠ é”ï¼Œå¯ä»¥ä½¿ç”¨CASæ— é”æ–¹æ³•å®‰å…¨çš„æ›´æ–°å…±äº«èµ„æºã€‚äºŒæ˜¯ä¸éœ€è¦ä¿®æ”¹é¡µå†…å­˜ï¼Œä¸ä¼šå¯¼è‡´ç°æœ‰cacheå¤±æ•ˆã€‚&lt;/p>
&lt;p>å½“å¢é‡è¿‡å¤šæ—¶ï¼ŒBw-Treeä¼šè‡ªåŠ¨åˆå¹¶å¢é‡å’Œé¡µå†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒæ ·æ˜¯æ— é”çš„ã€‚&lt;/p>
&lt;h3 id="å¼¹æ€§è™šæ‹Ÿé¡µelastic-virtual-pages">å¼¹æ€§è™šæ‹Ÿé¡µï¼ˆElastic Virtual Pagesï¼‰ &lt;a href="#%e5%bc%b9%e6%80%a7%e8%99%9a%e6%8b%9f%e9%a1%b5elastic-virtual-pages" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-10/91449803.jpg" alt="image">&lt;/p>
&lt;blockquote>
&lt;p>B+-Treeï¼Œå›¾ç‰‡æ¥æºï¼š&lt;a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">B+ Trees Visualization&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>B+-Treeçš„ç‰¹æ€§æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>æ‰€æœ‰è®°å½•éƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸ºé¡µï¼‰ä¸Šï¼Œå¹¶ä¸”æ˜¯é¡ºåºå­˜æ”¾çš„&lt;/li>
&lt;li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹åŒ…å«å…³é”®å­—ï¼ˆreferencesï¼‰ä¸å­©å­æŒ‡é’ˆ&lt;/li>
&lt;li>å¶å­èŠ‚ç‚¹æœ‰ä¸€ä¸ªæŒ‡å‘å·¦å³å…„å¼Ÿçš„æŒ‡é’ˆï¼Œæ–¹ä¾¿é¡ºåºéå†æ•°æ®&lt;/li>
&lt;/ol>
&lt;p>Bw-Treeåœ¨B+-Treeçš„åŸºç¡€ä¸Šæ·»åŠ äº†ï¼š&lt;/p>
&lt;ol>
&lt;li>low/high keyï¼Œç”¨æ¥æ ‡æ˜æœ¬èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„æ•°æ®èŒƒå›´&lt;/li>
&lt;li>æ¯ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å¶å­èŠ‚ç‚¹å’Œä¸­é—´èŠ‚ç‚¹ï¼‰éƒ½æœ‰ä¸€ä¸ªside pointeræŒ‡å‘å…¶å³é¢çš„å…„å¼ŸèŠ‚ç‚¹&lt;/li>
&lt;/ol>
&lt;h3 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢ &lt;a href="#%e8%8c%83%e5%9b%b4%e6%9f%a5%e8%af%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºBw-Treeçš„æ•°æ®éƒ½åˆ†å¸ƒåœ¨å¶å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹ä¹‹é—´å¯ä»¥é€šè¿‡å…„å¼ŸæŒ‡é’ˆè¿›è¡Œéå†ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨æ¸¸æ ‡ï¼ˆcursorï¼‰æ¥æ ‡è®°å½“å‰æ£€ç´¢çš„ä½ç½®ã€‚å¹¶ä¸”ä½¿ç”¨ç¼“å­˜å½“å‰é¡µä¸Šç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚è¿™æ ·å¯ä»¥åŠ é€Ÿé€æ¡éå†æ“ä½œï¼ˆ&amp;ldquo;next-record&amp;rdquo; functionalityï¼‰ã€‚&lt;/p>
&lt;p>é€æ¡éå†æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†æ˜¯é€æ¡éå†æŸä¸€æ®µæ•°æ®åˆ™ä¸æ˜¯åŸå­çš„ã€‚å¦‚æœè¯»å†™åŒæ—¶å‘ç”Ÿåœ¨åŒä¸€é¡µï¼Œåˆ™æˆ‘ä»¬ä¼šæ ¹æ®äº‹åŠ¡çš„åŒæ­¥çº§åˆ«æ¥å†³å®šæ˜¯å¦éœ€è¦é‡å»ºæ£€ç´¢ç¼“å­˜ã€‚&lt;/p>
&lt;h3 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶ &lt;a href="#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ— é”æ•°æ®ç»“æ„å¯¼è‡´çš„ä¸€ä¸ªç»“æœï¼Œæ˜¯æˆ‘ä»¬æ— æ³•æ˜¾å¼çš„è®©æŸä¸ªé¡µå¤±æ•ˆã€‚è¿™æ„å‘³ç€ï¼Œä¸€äº›çº¿ç¨‹ä¼šæŒæœ‰è¿‡æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨åˆ é™¤è¿™äº›è¿‡æ—¶çš„æ•°æ®æ—¶è¦éå¸¸å°å¿ƒã€‚&lt;/p>
&lt;p>æ‰€ä»¥è¿™é‡Œå¼•å…¥äº†â€œä»£â€ï¼ˆepochï¼‰çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ¯ä¸€ä¸ªæ“ä½œéƒ½åœ¨æŸä¸€ä¸ªä»£ä¸­ï¼Œå¹¶ä¸”è¿™ä¸€ä»£ä¸­çš„æ‰€æœ‰æ•°æ®ä»¥åŠè¿‡æ—¶æ•°æ®éƒ½ä¸ä¼šè¢«åˆ é™¤ã€‚å½“æŸä¸€ä»£ä¸­æ‰€æœ‰çº¿ç¨‹æ“ä½œéƒ½è¢«æ‰§è¡Œå®Œæ¯•åï¼Œè¿™ä¸€ä»£å°±ä¼šç»“æŸï¼Œå…¶ä¸­çš„è¿‡æ—¶æ•°æ®å°±ä¼šè¢«å®‰å…¨çš„å›æ”¶ã€‚&lt;/p>
&lt;h2 id="bw-treeçš„ç»“æ„æ”¹å˜">Bw-Treeçš„ç»“æ„æ”¹å˜ &lt;a href="#bw-tree%e7%9a%84%e7%bb%93%e6%9e%84%e6%94%b9%e5%8f%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Bw-Treeçš„ç»“æ„ä¼šåœ¨æŸäº›æ“ä½œä¸‹è¿›è¡Œæ”¹å˜ï¼Œä»¥ç»´æŠ¤å…¶æ€§è´¨ã€‚ç»“æ„æ”¹å˜çš„æ“ä½œä»ç„¶æ˜¯æ— é”çš„ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å‡è®¾ç»“æ„æ”¹å˜çš„å†™æ“ä½œä¸æ˜¯å¹¶å‘çš„ã€‚&lt;/p>
&lt;h3 id="èŠ‚ç‚¹åˆ†è£‚">èŠ‚ç‚¹åˆ†è£‚ &lt;a href="#%e8%8a%82%e7%82%b9%e5%88%86%e8%a3%82" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å½“æŸçº¿ç¨‹å‘ç°Bw-Treeä¸­æŸä¸ªèŠ‚ç‚¹çš„å¤§å°è¶…å‡ºäº†ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼åï¼Œåœ¨æ‰§è¡Œå®Œå…¶é¢„å®šçš„ä»»åŠ¡åï¼Œå°±ä¼šè§¦å‘èŠ‚ç‚¹çš„åˆ†è£‚æ“ä½œã€‚&lt;/p>
&lt;p>èŠ‚ç‚¹åˆ†è£‚åˆ†ä¸ºä¸¤æ­¥æ‰§è¡Œï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯åŸå­çš„ï¼š&lt;/p>
&lt;ol>
&lt;li>å­èŠ‚ç‚¹åˆ†è£‚&lt;/li>
&lt;li>å­èŠ‚ç‚¹æ›´æ–°åï¼Œå‘ä¸Šæ›´æ–°çˆ¶èŠ‚ç‚¹&lt;/li>
&lt;/ol>
&lt;h4 id="å­èŠ‚ç‚¹åˆ†è£‚">å­èŠ‚ç‚¹åˆ†è£‚ &lt;a href="#%e5%ad%90%e8%8a%82%e7%82%b9%e5%88%86%e8%a3%82" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-13/53138696.jpg" alt="">&lt;/p>
&lt;p>ä¸Šå›¾æ˜¯Bw-Treeä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç°åœ¨æˆ‘ä»¬æƒ³åˆ†è£‚&lt;code>PQ&lt;/code>èŠ‚ç‚¹ä¸º&lt;code>P&lt;/code>å’Œ&lt;code>Q&lt;/code>ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚å³å¤§äºæŸä¸ªå€¼&lt;code>KP&lt;/code>çš„æ•°æ®å…¨éƒ¨è¿ç§»åˆ°æ–°èŠ‚ç‚¹&lt;code>Q&lt;/code>ã€‚&lt;/p>
&lt;p>èŠ‚ç‚¹åˆ†è£‚çš„æ“ä½œå¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>å…ˆæ‹·è´Qä¸­çš„æ•°æ®åˆ°ä¸€ä¸ªæ–°çš„æ•°æ®é¡µ&lt;code>Q'&lt;/code>ï¼Œè¿™ä¸€æ­¥å¹¶ä¸ä¼šå½±å“åˆ°å…¶å®ƒçš„çº¿ç¨‹ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-13/52526691.jpg" alt="">&lt;/p>
&lt;ol start="2">
&lt;li>åœ¨PèŠ‚ç‚¹ï¼Œä½¿ç”¨CASæ“ä½œï¼Œæ·»åŠ åˆ†è£‚çš„ä¿¡æ¯Î”ï¼Œæ ‡æ˜è¯¥èŠ‚ç‚¹å·²ç»åˆ†è£‚ï¼Œå…¶ä¸­åŒ…å«ç€&lt;code>KP&lt;/code>çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å½“æŸ¥è¯¢çš„Keyå¤§äº&lt;code>KP&lt;/code>æ—¶ï¼Œä¼šè·³è½¬åˆ°æ–°èŠ‚ç‚¹&lt;code>Q'&lt;/code>è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-13/7152787.jpg" alt="">&lt;/p>
&lt;h4 id="çˆ¶èŠ‚ç‚¹æ›´æ–°">çˆ¶èŠ‚ç‚¹æ›´æ–° &lt;a href="#%e7%88%b6%e8%8a%82%e7%82%b9%e6%9b%b4%e6%96%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åŒæ ·ï¼Œçˆ¶èŠ‚ç‚¹çš„æ›´æ–°ä»ç„¶æ˜¯é‡‡ç”¨å¢é‡ä¿®æ”¹çš„æ¨¡å¼ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨çˆ¶èŠ‚ç‚¹ä½¿ç”¨CASæ“ä½œæ·»åŠ ä¸€æ¡ä¿®æ”¹å¢é‡ï¼ˆindex term delta recordï¼‰ã€‚å½“æŸ¥è¯¢è¯·æ±‚è½åœ¨&lt;code>Q&lt;/code>èŠ‚ç‚¹çš„èŒƒå›´å†…æ—¶ï¼Œä¼šç›´æ¥è·³è½¬åˆ°&lt;code>Q'&lt;/code>èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-13/29669418.jpg" alt="">&lt;/p>
&lt;h4 id="æ›´æ–°åˆå¹¶">æ›´æ–°åˆå¹¶ &lt;a href="#%e6%9b%b4%e6%96%b0%e5%90%88%e5%b9%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä½¿ç”¨å¢é‡æ›´æ–°å¯ä»¥å‡å°‘æ•°æ®æ›´æ–°ã€èŠ‚ç‚¹åˆ†è£‚æ—¶çš„æ—¶é—´å¼€é”€ï¼Œä»è€Œé¿å…å¤±è´¥çš„åˆ†è£‚æ“ä½œï¼ˆfailed splitsï¼‰ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æœ€ç»ˆï¼Œæˆ‘ä»¬ä»ä¼šå°†äº§ç”Ÿçš„æ›´æ–°å¢é‡åˆå¹¶æˆä¸€æ¡å®Œæ•´çš„è®°å½•ï¼Œä»¥é¿å…è¿‡å¤šçš„ç©ºé—´æµªè´¹å’ŒæŒ‡é’ˆè·³è½¬ã€‚&lt;/p>
&lt;h3 id="å­èŠ‚ç‚¹åˆå¹¶">å­èŠ‚ç‚¹åˆå¹¶ &lt;a href="#%e5%ad%90%e8%8a%82%e7%82%b9%e5%90%88%e5%b9%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨Bw-Treeæ•°æ®å‡å°‘æ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†é¿å…è¿‡å¤šçš„æŒ‡é’ˆè·³è½¬ï¼Œéœ€è¦è¿›è¡ŒèŠ‚ç‚¹åˆå¹¶ã€‚èŠ‚ç‚¹åˆå¹¶æ¯”èŠ‚ç‚¹åˆ†è£‚å¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç³»åˆ—çš„åŸå­æ“ä½œæ¥è¿›è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-14/37353459.jpg" alt="">&lt;/p>
&lt;ol>
&lt;li>åˆ é™¤èŠ‚ç‚¹&lt;/li>
&lt;/ol>
&lt;p>åˆ é™¤èŠ‚ç‚¹æ—¶ä½¿ç”¨æ ‡è®°åˆ é™¤ï¼Œä»ç„¶æ˜¯CASæ“ä½œï¼Œæ·»åŠ ä¸€ä¸ªåˆ é™¤å¢é‡ï¼ˆremove node deltaï¼‰åˆ°&lt;code>Q&lt;/code>ã€‚ä¹‹åæ‰€æœ‰çš„è¯»å†™è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°å…¶å·¦å…„å¼Ÿ&lt;code>P&lt;/code>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œæœ‰ä¸ªçŒœæµ‹ï¼Œåœ¨Qä¸­åŸæœ‰çš„æ•°æ®ä»ç„¶æ˜¯è¦åˆ°QèŠ‚ç‚¹è¿›è¡Œè®¿é—®çš„ã€‚è®ºæ–‡é‡Œæ²¡æœ‰è¯´ï¼Œé€šè¿‡å¸¸è¯†æ¨æ–­ä¸€ä¸‹åº”è¯¥å¦‚æ­¤ã€‚&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-14/79837579.jpg" alt="">&lt;/p>
&lt;ol start="2">
&lt;li>åˆå¹¶å­èŠ‚ç‚¹&lt;/li>
&lt;/ol>
&lt;p>åœ¨&lt;code>P&lt;/code>èŠ‚ç‚¹ä¹‹å‰ç”¨CASæ“ä½œæ·»åŠ åˆå¹¶å¢é‡ï¼ˆnode merge deltaï¼‰ã€‚åˆå¹¶å¢é‡å°†&lt;code>P&lt;/code>èŠ‚ç‚¹å’Œ&lt;code>Q&lt;/code>èŠ‚ç‚¹ä»é€»è¾‘ä¸Šåˆä¸ºä¸€ä¸ªï¼Œå¹¶ä¸”è´Ÿè´£è½¬å‘è¯»å†™è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-14/81902381.jpg" alt="">&lt;/p>
&lt;h4 id="çˆ¶èŠ‚ç‚¹æ›´æ–°-1">çˆ¶èŠ‚ç‚¹æ›´æ–° &lt;a href="#%e7%88%b6%e8%8a%82%e7%82%b9%e6%9b%b4%e6%96%b0-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è¿™ä¸ªå°±éå¸¸ç®€å•ï¼Œå°±æ˜¯CASæ“ä½œåœ¨çˆ¶èŠ‚ç‚¹æ ‡è®°åˆ é™¤&lt;code>Q&lt;/code>èŠ‚ç‚¹çš„Keyå³å¯ã€‚&lt;/p>
&lt;h3 id="åºåˆ—åŒ–ç»“æ„ä¿®æ”¹">åºåˆ—åŒ–ç»“æ„ä¿®æ”¹ &lt;a href="#%e5%ba%8f%e5%88%97%e5%8c%96%e7%bb%93%e6%9e%84%e4%bf%ae%e6%94%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢çš„Bw-Treeç»“æ„ä¿®æ”¹çš„å®ç°éƒ½åŸºäºä¸€ä¸ªå‡è®¾ï¼šæ•°æ®åº“çš„åŒæ­¥æœºåˆ¶ä¼šå¤„ç†å¥½æ•°æ®æ›´æ–°å†²çªé—®é¢˜ã€‚&lt;/p>
&lt;p>åŒæ­¥æœºåˆ¶åŒ…æ‹¬æ•°æ®åº“ç³»ç»Ÿçš„é”ç®¡ç†å™¨ï¼ˆlock managerï¼‰ã€äº‹åŠ¡ç®¡ç†ç»„ä»¶ï¼ˆtransactional componentï¼‰ï¼›æˆ–è€…æ˜¯é‡‡ç”¨å¼ƒç–—æ–¹æ¡ˆï¼Œå…è®¸éšæœºäº¤å‰å†™ã€‚&lt;/p>
&lt;p>ä½†æ˜¯åœ¨Bw-Treeå†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦åºåˆ—åŒ–æ ‘çš„ç»“æ„ä¿®æ”¹ï¼ˆä¿—ç§°æ’é˜Ÿï¼‰ã€‚å½“ä¸€ä¸ªSMOæ“ä½œé‡åˆ°äº†æœªå®Œæˆçš„SMOæ“ä½œæ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šç­‰å¾…ä¹‹å‰çš„SMOæ“ä½œå®Œæˆåå†ç»§ç»­å½“å‰æ“ä½œã€‚&lt;/p>
&lt;p>è¿™æ ·çš„æ–¹æ¡ˆå¯èƒ½ä¼šå½¢æˆä¸€ä¸ªâ€œSMOæ ˆâ€ï¼Œä½†æ˜¯è¿™ç§åœºæ™¯æ¯”è¾ƒå°‘è§ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&lt;/p>
&lt;h2 id="ç¼“å­˜ç®¡ç†">ç¼“å­˜ç®¡ç† &lt;a href="#%e7%bc%93%e5%ad%98%e7%ae%a1%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç¼“å­˜å±‚è´Ÿè´£å†…å­˜ä¸SSDç£ç›˜ä¹‹é—´çš„è¯»ã€å†™å›ä»¥åŠæ¢é¡µæ“ä½œã€‚ç¼“å­˜å±‚ä¸ºBw-Treeå±‚æä¾›äº†é€»è¾‘é¡µçš„æŠ½è±¡ã€‚&lt;/p>
&lt;p>Bw-Treeä½¿ç”¨PIDè®¿é—®é€»è¾‘é¡µï¼Œå½“é€»è¾‘é¡µä½äºç£ç›˜ä¸­æ—¶ï¼Œç¼“å­˜å±‚å…ˆæŠŠé¡µè¯»å–åˆ°å†…å­˜ä¸­ï¼Œå†ä½¿ç”¨CASæ“ä½œå°†PIDæŒ‡é’ˆä»ç£ç›˜åç§»é‡æŒ‡å‘å†…å­˜åç§»é‡ã€‚&lt;/p>
&lt;h3 id="é¢„å†™æ—¥å¿—åè®®ä¸æ—¥å¿—åºåˆ—å·lsn">é¢„å†™æ—¥å¿—åè®®ä¸æ—¥å¿—åºåˆ—å·ï¼ˆLSNï¼‰ &lt;a href="#%e9%a2%84%e5%86%99%e6%97%a5%e5%bf%97%e5%8d%8f%e8%ae%ae%e4%b8%8e%e6%97%a5%e5%bf%97%e5%ba%8f%e5%88%97%e5%8f%b7lsn" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ—¥å¿—åºåˆ—å·ï¼ˆLSNï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ’å…¥æˆ–ä¿®æ”¹Bw-Treeçš„å¢é‡éƒ½ä¼šè¢«æ‰“ä¸Šæ—¥å¿—åºåˆ—å·ã€‚æ—¥å¿—åºåˆ—å·ç”±äº‹åŠ¡å­ç³»ç»Ÿäº§ç”Ÿã€‚&lt;/p>
&lt;p>åœ¨é¡µçš„åˆ·å†™å¢é‡ï¼ˆflush deltaï¼‰ä¸­ï¼Œè®°å½•ç€æœ€åè¢«åˆ·å…¥ï¼ˆflushï¼‰ç£ç›˜çš„æ—¥å¿—åºåˆ—å·ã€‚&lt;/p>
&lt;ul>
&lt;li>äº‹åŠ¡æ—¥å¿—åè°ƒ&lt;/li>
&lt;/ul>
&lt;p>äº‹åŠ¡å­ç³»ç»Ÿç»´æŠ¤ç€ä¸€ä¸ªâ€œæœ€å¤§å†™å…¥æ—¥å¿—åºåˆ—å·â€ï¼ˆEnd of Stable Log, ESLï¼‰ã€‚äº‹åŠ¡å­ç³»ç»Ÿé€šè¿‡ESLæ¥é™åˆ¶æ•°æ®ç®¡ç†å­ç³»ç»Ÿçš„æŒä¹…åŒ–è¿›åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ç®¡ç†å­ç³»ç»Ÿåªèƒ½æŒä¹…åŒ–äº‹åŠ¡å·å°äºESLçš„äº‹åŠ¡ã€‚è¿™ä¿è¯äº†é¢„å†™æ—¥å¿—åè®®çš„å› æœæ€§ã€‚&lt;/p>
&lt;p>æ•°æ®ç®¡ç†å­ç³»ç»Ÿé€šè¿‡å‘äº‹åŠ¡å­ç³»ç»Ÿåé¦ˆæœ€ååˆ·å†™çš„äº‹åŠ¡åºå·ä»¥æä¾›åé¦ˆã€‚å½“äº‹åŠ¡å­ç³»ç»Ÿæƒ³è¦å‘å‰ç§»åŠ¨â€œäº‹åŠ¡é‡åšæŒ‡é’ˆâ€ï¼ˆRedo-Scan-Start-Point, RSSPï¼‰æ—¶ï¼Œä¼šå‘äº‹åŠ¡å­ç³»ç»Ÿå‘é€è¯·æ±‚ã€‚å½“äº‹åŠ¡åºå·å¤§äºRSSPï¼Œä¸”å°äºESLçš„æ‰€ä»¥äº‹åŠ¡å…¨éƒ¨åˆ·å†™åˆ°ç£ç›˜ä¹‹åï¼Œæ•°æ®ç®¡ç†å­ç³»ç»Ÿä¼šå‘äº‹åŠ¡å­ç³»ç»Ÿå‘é€ACKä¿¡å·ã€‚æœ€åäº‹åŠ¡å­ç³»ç»Ÿå‘å‰ç§»åŠ¨RSSPï¼Œå·²ç»è½ç›˜çš„äº‹åŠ¡ä¿¡æ¯æŠ›å¼ƒã€‚&lt;/p>
&lt;ul>
&lt;li>Bw-Treeçš„ç»“æ„ä¿®æ”¹&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬å°†Bw-Treeçš„ç»“æ„ä¿®æ”¹ï¼ˆSMOï¼‰å°è£…æˆä¸ºä¸€ä¸ªç³»ç»Ÿäº‹åŠ¡ã€‚ç”±äºBw-Treeçš„ç»“æ„ä¿®æ”¹æ˜¯æ— é”çš„ï¼Œæ‰€ä»¥ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€é¡µçš„æƒ…å†µã€‚&lt;/p>
&lt;p>å°†SMOè§†åšäº‹åŠ¡ï¼Œå…è®¸æˆ‘ä»¬å¹¶å‘çš„æ‰§è¡ŒSMOæ“ä½œï¼Œå½“ä¸”ä»…å½“æŸä¸€ä¸ªSMOæ“ä½œâ€œèƒœå‡ºâ€æ—¶ï¼Œæ‰å°†äº‹åŠ¡æäº¤ã€‚&lt;/p>
&lt;h3 id="å°†é¡µå†™å›æ—¥å¿—å¼å­˜å‚¨lss">å°†é¡µå†™å›æ—¥å¿—å¼å­˜å‚¨ï¼ˆLSSï¼‰ &lt;a href="#%e5%b0%86%e9%a1%b5%e5%86%99%e5%9b%9e%e6%97%a5%e5%bf%97%e5%bc%8f%e5%ad%98%e5%82%a8lss" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>é¡µå°è£…ï¼ˆPage Marshallingï¼‰&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬å¦‚æœè¦å°†é¡µå†™å›LSSï¼Œé¦–å…ˆè¦å…ˆé€»è¾‘é¡µè½¬åŒ–æˆçº¿æ€§é¡ºåºå­˜å‚¨çš„ç»“æ„ï¼Œä¾¿äºæˆ‘ä»¬å°†å…¶å­˜å‚¨åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬è¦å°†é¡µçš„çŠ¶æ€è®¾å®šä¸ºâ€œé”å®šâ€ï¼ˆcapturedï¼‰ï¼Œä»¥é˜²æ­¢åç»­çš„ä¿®æ”¹ç ´åé¢„å†™æ—¥å¿—åè®®ã€‚&lt;/p>
&lt;ul>
&lt;li>å¢é‡åˆ·å†™ï¼ˆIncremental Flushingï¼‰&lt;/li>
&lt;/ul>
&lt;p>å½“åˆ·å†™é¡µé¢æ—¶ï¼Œç¼“å­˜ç®¡ç†å™¨åªä¼šåˆ·å†™ESLä¹‹å‰çš„æ•°æ®è®°å½•ã€‚è¿™æ ·çš„å¥½å¤„æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>å‡å°‘ç£ç›˜çš„ä½¿ç”¨&lt;/li>
&lt;li>é¿å…äº§ç”Ÿè¿‡å¤šçš„ç£ç›˜åƒåœ¾&lt;/li>
&lt;li>é¿å…SSDçš„å†™å…¥æ”¾å¤§å¼€é”€&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>åˆ·å†™æ“ä½œ&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨åŒBufferè¿›è¡Œç£ç›˜åˆ·å†™ï¼Œå¯ä»¥é¿å…çº¿ç¨‹ç­‰å¾…IOæ“ä½œã€‚&lt;/p>
&lt;p>åœ¨åˆ·å†™æ“ä½œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¼šæ›´æ–°mapping tableï¼Œå°†é¡µæŒ‡é’ˆæ”¹å˜æˆç£ç›˜çš„åç§»é‡ã€‚å¹¶å°†å†…å­˜ä¸­çš„é¡µæ¢å‡ºã€‚&lt;/p>
&lt;p>ç¼“å­˜ç®¡ç†å™¨ä¼šç›‘è§†ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿç”¨ï¼Œå°±å°†ä¸€éƒ¨åˆ†é¡µä»è‡ªåŠ¨å†…å­˜ä¸­æ¢å‡ºã€‚&lt;/p>
&lt;h2 id="æ€§èƒ½">æ€§èƒ½ &lt;a href="#%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æˆ‘ä»¬çš„å¯¹æ‰‹">æˆ‘ä»¬çš„å¯¹æ‰‹ &lt;a href="#%e6%88%91%e4%bb%ac%e7%9a%84%e5%af%b9%e6%89%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>BerkeleyDB&lt;/li>
&lt;/ul>
&lt;p>æ€§èƒ½è‰¯å¥½çš„ç‹¬ç«‹å­˜å‚¨å¼•æ“ã€‚æˆ‘ä»¬ä½¿ç”¨Cè¯­è¨€å®ç°ç‰ˆæœ¬ï¼Œå†…ç½®å­˜å‚¨å¼•æ“ä¸ºB-Treeã€‚&lt;/p>
&lt;p>è¿è¡Œæ¨¡å¼ä¸ºæ€§èƒ½è¾ƒå¥½çš„â€œæ— äº‹åŠ¡æ¨¡å¼â€ï¼Œæ”¯æŒä¸€å†™å¤šè¯»ã€‚&lt;/p>
&lt;p>åœ¨æ•´ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬å°†BerkeleyDBçš„ç¼“å­˜å¼€åˆ°è¶³å¤Ÿå¤§ï¼Œå…¨éƒ¨ä½¿ç”¨ä¸»å­˜è¿›è¡Œå­˜å‚¨ä¸æŸ¥è¯¢æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>SkipList&lt;/li>
&lt;/ul>
&lt;p>æ— é”çš„è·³è¡¨å®ç°ã€‚&lt;/p>
&lt;h3 id="æµ‹è¯•æ•°æ®é›†">æµ‹è¯•æ•°æ®é›† &lt;a href="#%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae%e9%9b%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>XBox Live &lt;br>
ç½‘æ¸¸æ•°æ®ã€‚Keyçš„å¹³å‡å¤§å°æ˜¯94Bytesï¼ŒValueçš„å¹³å‡å¤§å°æ˜¯1.2Kã€‚è¯»å†™æ¯”å¤§æ¦‚æ˜¯7.5: 1&lt;/li>
&lt;li>å•†ä¸šæ•°æ®åº“çš„å¤‡ä»½æµ &lt;br>
æ€»å…±æœ‰27Mæ•°æ®å—ï¼Œå»é‡åæœ‰12Mã€‚è¯»å†™æ¯”ä¸º2.2ï¼š1ï¼ŒKeyæ˜¯20Bytesçš„SHA1å“ˆå¸Œå€¼ï¼ŒValueæ˜¯44Bytesçš„å…ƒä¿¡æ¯ã€‚&lt;/li>
&lt;li>ç»¼åˆKVæ•°æ® &lt;br>
8Bytesæ•´æ•°Keyï¼Œ8Bytesæ•´æ•°Valueã€‚è¯»å†™æ¯”ä»5ï¼š1ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="æ¯”èµ›é¡¹ç›®">æ¯”èµ›é¡¹ç›® &lt;a href="#%e6%af%94%e8%b5%9b%e9%a1%b9%e7%9b%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="å¢é‡é“¾é•¿åº¦é˜ˆå€¼å¯¹æ€§èƒ½çš„å½±å“">å¢é‡é“¾é•¿åº¦é˜ˆå€¼å¯¹æ€§èƒ½çš„å½±å“ &lt;a href="#%e5%a2%9e%e9%87%8f%e9%93%be%e9%95%bf%e5%ba%a6%e9%98%88%e5%80%bc%e5%af%b9%e6%80%a7%e8%83%bd%e7%9a%84%e5%bd%b1%e5%93%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-17/40340311.jpg" alt="">&lt;/p>
&lt;p>å¢é‡é“¾é•¿åº¦é˜ˆå€¼å½±å“è§¦å‘é¡µåˆå¹¶ï¼ˆconsolidationï¼‰çš„é¢‘ç‡ã€‚ä»å›¾ä¸­æˆ‘ä»¬åšå‡ºå¦‚ä¸‹æ¨æµ‹ï¼š&lt;/p>
&lt;ol>
&lt;li>å¢é‡é“¾é•¿åº¦è¾ƒçŸ­æ—¶ï¼Œè¯»å†™æ€§èƒ½å¥½ï¼Œä½†é¡µåˆå¹¶å¼€é”€å¤§&lt;/li>
&lt;li>å¢é‡é“¾é•¿åº¦è½¬é•¿æ—¶ï¼Œè¯»å†™å¼€é”€å¤§ï¼Œé¡µåˆå¹¶å¼€é”€å°&lt;/li>
&lt;/ol>
&lt;p>ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å°±åœ¨è¿™ä¸¤ä¸ªå› ç´ ä¸‹é¢å–ä¸€ä¸ªå¹³è¡¡ã€‚&lt;/p>
&lt;h4 id="æ— é”ç¯å¢ƒä¸‹çš„æ›´æ–°å¤±è´¥">æ— é”ç¯å¢ƒä¸‹çš„æ›´æ–°å¤±è´¥ &lt;a href="#%e6%97%a0%e9%94%81%e7%8e%af%e5%a2%83%e4%b8%8b%e7%9a%84%e6%9b%b4%e6%96%b0%e5%a4%b1%e8%b4%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-17/63409936.jpg" alt="">&lt;/p>
&lt;p>æ•°æ®ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒBw-Treeå†™å…¥å¤±è´¥ï¼ˆFailed Updatesï¼‰æ˜¯éå¸¸å°‘çš„ã€‚ä½†æ˜¯â€œç»¼åˆâ€æ•°æ®é›†çš„â€œé¡µæ‹†åˆ†å¤±è´¥â€å’Œâ€œé¡µåˆå¹¶å¤±è´¥â€æ˜æ˜¾é«˜äºå…¶å®ƒæ•°æ®é›†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯å› ä¸ºâ€œç»¼åˆâ€æ•°æ®é›†ä¸­çš„æ•°æ®éƒ½æ¯”è¾ƒå°ï¼Œæ›´æ–°èµ·æ¥æ¯”è¾ƒå¿«ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„çº¿ç¨‹ç«äº‰ã€‚&lt;/p>
&lt;h4 id="ä¸ä¼ ç»Ÿb-treeçš„æ¯”è¾ƒ">ä¸ä¼ ç»ŸB-Treeçš„æ¯”è¾ƒ &lt;a href="#%e4%b8%8e%e4%bc%a0%e7%bb%9fb-tree%e7%9a%84%e6%af%94%e8%be%83" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-17/63409936.jpg" alt="">&lt;/p>
&lt;p>Bw-Treeæ˜æ˜¾èƒœå‡ºï¼Œå…¶åŸå› æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>Bw-Treeæ˜¯æ— é”çš„ï¼Œæ‰€ä»¥å¹¶å‘ç¨‹åº¦æ›´é«˜&lt;/li>
&lt;li>Bw-Treeå¯¹CPU cacheæ›´åŠ å‹å¥½&lt;/li>
&lt;/ol>
&lt;h4 id="bw-treeä¸æ— é”è·³è¡¨æ¯”è¾ƒ">Bw-Treeä¸æ— é”è·³è¡¨æ¯”è¾ƒ &lt;a href="#bw-tree%e4%b8%8e%e6%97%a0%e9%94%81%e8%b7%b3%e8%a1%a8%e6%af%94%e8%be%83" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-17/63409936.jpg" alt="">&lt;/p>
&lt;p>Bw-Treeä»ç„¶æ˜æ˜¾èƒœå‡ºï¼Œå…¶åŸå› å½’äºBw-Treeæ›´å‹å¥½ä½¿ç”¨äº†CPU cacheã€‚&lt;/p>
&lt;h4 id="ç¼“å­˜æ€§èƒ½">ç¼“å­˜æ€§èƒ½ &lt;a href="#%e7%bc%93%e5%ad%98%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-12-17/63354469.jpg" alt="">&lt;/p>
&lt;p>Bw-Treeçš„ä¼˜åŠ¿æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸è·³è¡¨ç›¸æ¯”ä¸éœ€è¦è¿‡å¤šçš„æŒ‡é’ˆè·³è½¬&lt;/li>
&lt;li>å†…å­˜ä½¿ç”¨æ›´åŠ é«˜æ•ˆ&lt;/li>
&lt;/ol>
&lt;h2 id="åç»­201026">åç»­ï¼ˆ201026ï¼‰ &lt;a href="#%e5%90%8e%e7%bb%ad201026" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åˆ°äº†æ–°ç»„ä¹‹åï¼Œå‘ç°äº†ä¸€ä¸ªä½¿ç”¨BW-Treeçš„å­˜å‚¨å¼•æ“ã€‚ä¸è¿‡å·²ç»å³å°†åºŸå¼ƒäº†ï¼ˆæŒ¥æ‰‹&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>ç‰¹æŒ‡Redisçš„ä¸€äº›ä¸»è¦åŠŸèƒ½&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>tree-basedæ•°æ®ç»“æ„çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å›¾ä¹¦é¦†ã€‚å›¾ä¹¦é¦†ç”¨A-Zä»£è¡¨å¤§ç±»ï¼Œç„¶åä½¿ç”¨æ•°å­—ä»£è¡¨å°ç±»ï¼Œæœ€ååŠ ä¸Šä¸€ä¸ªæ•°å­—ç¡®å®šè¿™æœ¬ä¹¦çš„ä¹¦å·ã€‚ &lt;br>
å›¾ä¹¦é¦†è—ä¹¦çš„é¡ºåºæ˜¯æŒ‰ç…§ä¹¦å·çš„é¡ºåºè¿›è¡Œæ’åºçš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æŸ¥æ‰¾ä¸€æœ¬ä¹¦çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ä¹¦å·ï¼Œåˆ©ç”¨å…¶ä¸­çš„å±‚æ¬¡ä¿¡æ¯æŸ¥æ‰¾æŸä¸€æœ¬ä¹¦ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æŸä¸€ä¸ªä¹¦å·èŒƒå›´è¿›è¡ŒæŸ¥æ‰¾ä¸€ç³»åˆ—è¿ç»­çš„ä¹¦ã€‚ &lt;br>
å¦‚æœè¿˜å¼„ä¸æ˜ç™½çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨&lt;a href="http://www.ztflh.com/">ä¸­å›½å›¾ä¹¦é¦†åˆ†ç±»æ³•ç½‘ç«™&lt;/a>åŠ æ·±ä¸€ä¸‹ç†è§£ã€‚&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Windows Azure Storage Made Simple</title><link>https://wizmann.top/posts/azure-storage-made-simple/</link><pubDate>Wed, 11 Oct 2017 21:12:15 +0000</pubDate><guid>https://wizmann.top/posts/azure-storage-made-simple/</guid><description>&lt;h2 id="åŠ æœºå™¨å°±æ˜¯ä¸€æŠŠæ¢­">åŠ æœºå™¨å°±æ˜¯ä¸€æŠŠæ¢­ &lt;a href="#%e5%8a%a0%e6%9c%ba%e5%99%a8%e5%b0%b1%e6%98%af%e4%b8%80%e6%8a%8a%e6%a2%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>æ²¡æœ‰ä»€ä¹ˆé—®é¢˜æ˜¯åŠ ä¸€åƒå°æœºå™¨è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰ï¼Œå°±å†åŠ ä¸€åƒå°ã€‚ &lt;br>
â€”â€” ã€Š21å¤©ç²¾é€šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹&lt;/p>&lt;/blockquote>
&lt;p>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨è®¾è®¡ä¹‹åˆï¼Œæ˜¯ä¸ºäº†è§£å†³å•æœºç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜çš„ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼Œå•æœºç³»ç»Ÿå°±æ˜¯é›‡ä¸€ä¸ªå°å¼Ÿæ›¿ä½ å¹²æ´»ï¼Œä½†æ˜¯è¿™ä¸ªå°å¼Ÿä¸å¤ªé è°±ï¼Œå¶å°”æ³¡ä¸ªç—…å·ä¸ä¸Šç­ï¼Œå¶å°”å·¥ä½œå¤ªå¤šä¸€ä¸ªäººå¹²ä¸è¿‡æ¥ã€‚&lt;/p>
&lt;p>åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯é›‡ä¸€ç¾¤å°å¼Ÿå¸®ä½ å¹²æ´»ï¼Œå¶å°”æœ‰ä¸€ä¸¤ä¸ªå°å¼Ÿæ³¡ç—…å·ï¼Œæˆ‘ä»¬ä¼šæœ‰å¯Œè£•çš„äººåŠ›é¡¶ä¸Šï¼Œå·¥ä½œå¤ªå¤šæˆ‘ä»¬å¯ä»¥ç»§ç»­æ‹‰æ–°çš„å°å¼Ÿå…¥ä¼™ï¼Œç¾æ»‹æ»‹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¯”å–»å¾ˆå¥½çš„æè¿°äº†å•æœºç³»ç»Ÿå’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„å…³ç³»ã€‚æ‰€ä»¥ä¸€ç§å¯èƒ½çš„åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-25/28278606.jpg" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å°†ç›¸åŒåŠŸèƒ½çš„æœåŠ¡å™¨ç»„æˆä¸€ä¸ªæ•´ä½“ï¼Œé€šè¿‡ä¸€ä¸ªload balancerå¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ç³»ç»Ÿåˆæ­¥è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼Œåœ¨é¢å¯¹å¯æ‰©å±•æ€§å’Œå¯ç”¨æ€§çš„é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¼šï¼š&lt;/p>
&lt;ul>
&lt;li>å®¹é‡ä¸è¶³å°±åŠ æœºå™¨&lt;/li>
&lt;li>å•æœºæŒ‚æ‰äº†å°±æŠŠæµé‡è°ƒåº¦åˆ°å…¶å®ƒçš„èŠ‚ç‚¹ä¸Š&lt;/li>
&lt;/ul>
&lt;p>ä¸è¿‡å•çº¯çš„åŠ æœºå™¨å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚å¯¹äºCPUå¯†é›†å‹çš„æœåŠ¡ï¼Œå¢åŠ å‰¯æœ¬æ•°å¯ä»¥æœ‰æ•ˆçš„å‡æ‘Šè®¡ç®—å‹åŠ›ï¼Œä½†æ˜¯å¯¹äºå­˜å‚¨å¯†é›†å‹çš„æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ åˆ†åº“é€»è¾‘æ‰èƒ½æœ‰æ•ˆçš„å¢åŠ ç³»ç»Ÿçš„è®¡ç®—èƒ½åŠ›ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æˆ‘ä»¬æœ‰100Gçš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®åº“çš„å®¹é‡æœ€å¤šåªæ”¯æŒ50Gã€‚è¿™æ ·æ— è®ºæ€ä¹ˆæ ·å¢åŠ å‰¯æœ¬éƒ½ä¸èƒ½è§£å†³é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬å°†100Gçš„æ•°æ®å‡åˆ†ï¼Œå­˜å‚¨åœ¨ä¸¤ä¸ª50Gçš„åˆ†åº“ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¯æŒå•æœºç³»ç»Ÿå®¹çº³ä¸äº†çš„æ•°æ®äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-22/14141171.jpg" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå¤šä¸ªè¿™æ ·çš„åˆ†å¸ƒå¼å­ç³»ç»Ÿç»„åˆèµ·æ¥ï¼Œå°±å¯ä»¥ç»„æˆä¸€ä¸ªå°æœ‰è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿäº†ã€‚ç°åœ¨æˆ‘ä»¬åœ¨ä½¿ç”¨çš„ä¸€äº›æœåŠ¡ï¼Œä»åœ¨ä½¿ç”¨è¿™ç§æ¨¡å‹ã€‚&lt;/p>
&lt;p>ä¸Šé¢åˆ†å¸ƒå¼æ¨¡å‹è™½ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å¼•å…¥äº†ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼šå› ä¸ºèŠ‚ç‚¹ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ä¸åè°ƒï¼Œæ‰€ä»¥åŸºæœ¬æ— æ³•å®Œå…¨ä¿è¯å‰¯æœ¬ä¹‹é—´ä¿æŒä¸€è‡´çš„å†…éƒ¨çŠ¶æ€ã€‚&lt;/p>
&lt;p>è¿™å°±æ˜¯æ‰€è°“çš„ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="è¡¥å……ä¸€ç‚¹ç†è®ºçŸ¥è¯†">è¡¥å……ä¸€ç‚¹ç†è®ºçŸ¥è¯† &lt;a href="#%e8%a1%a5%e5%85%85%e4%b8%80%e7%82%b9%e7%90%86%e8%ae%ba%e7%9f%a5%e8%af%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="capç†è®º">CAPç†è®º &lt;a href="#cap%e7%90%86%e8%ae%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>CAPç†è®ºæŒ‡çš„æ˜¯ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰ä¸ªåŸºæœ¬è¦æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ã€‚&lt;/p>&lt;/blockquote>
&lt;p>CAPç†è®ºç”±Eric Breweråœ¨2000å¹´é¦–æ¬¡æå‡ºï¼Œå¹¶ä¸”2å¹´åè¢«Seth Gilbertå’ŒNancy Lynchä»ç†è®ºä¸Šè¯æ˜è¿™ä¸ªç†è®ºã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸€è‡´æ€§æ˜¯æŒ‡æ•°æ®çš„å¤šä¸ªå‰¯æœ¬ä¹‹é—´ä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼›&lt;/li>
&lt;li>å¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿçš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€;&lt;/li>
&lt;li>è€Œåˆ†åŒºå®¹é”™æ€§æ˜¯æŒ‡ç³»ç»Ÿåœ¨é­é‡ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ä»ç„¶èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœ;&lt;/li>
&lt;/ul>
&lt;p>æŠ›å¼€ä¸€è‡´æ€§é—®é¢˜ä¸è°ˆï¼Œâ€œå¯ç”¨æ€§â€å’Œâ€œåˆ†åŒºå®¹é”™æ€§â€ä»æŸç§æ„ä¹‰ä¸Šè®²æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„â€œæ ‡é…â€ï¼šå•æœºå’Œç½‘ç»œè¿æ¥å¹¶ä¸å¯é ï¼Œä»ä¸€å †ä¸å¯é çš„ç¡¬ä»¶ä¸Šå±‚å»ºç«‹ä¸€ä¸ªä¸å¯é çš„ç³»ç»Ÿå¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ä¸€è‡´æ€§å¸¸å¸¸è¢«ç‰ºç‰²ï¼Œæ¥ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ã€‚&lt;/p>
&lt;h3 id="paxosç®—æ³•">Paxosç®—æ³• &lt;a href="#paxos%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Paxosæ˜¯Leslie Lamportåœ¨1990å¹´æå‡ºçš„ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™æ€§çš„ä¸€è‡´æ€§ç®—æ³•ã€‚&lt;/p>
&lt;p>Paxosè§£å†³çš„é—®é¢˜æ˜¯å¦‚ä½•åœ¨ä¸€ä¸ªå¯èƒ½å‘ç”Ÿä¸Šè¿°å¼‚å¸¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿«é€Ÿä¸”æ­£ç¡®åœ°åœ¨é›†ç¾¤å†…éƒ¨å¯¹æŸä¸ªæ•°æ®çš„å€¼è¾¾æˆä¸€è‡´ï¼Œå¹¶ä¸”ä¿è¯ä¸è®ºå‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>Paxosçš„æè¿°å’Œè¯æ˜æœ‰ä¸€äº›å¤æ‚ï¼Œè¿™é‡Œä¸åšå±•å¼€ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç³»ç»Ÿä¸­çš„å„ä¸ªèŠ‚ç‚¹ä½¿ç”¨ç±»ä¼¼äºé€‰ä¸¾æŠ•ç¥¨çš„ç®—æ³•æ¥è¾¾æˆä¸€è‡´ï¼Œé€‰ä¸¾è¿‡ç¨‹ä¸­ä¼šæœ‰çŸ­æš‚çš„æ•°æ®ä¸å¯ç”¨ä¸­é—´çŠ¶æ€ã€‚&lt;/p>
&lt;h2 id="æˆ‘æœ€è®¨åŒæˆ‘æƒ³åšçš„äº‹æƒ…åšä¸æˆ">â€œæˆ‘æœ€è®¨åŒæˆ‘æƒ³åšçš„äº‹æƒ…åšä¸æˆâ€ &lt;a href="#%e6%88%91%e6%9c%80%e8%ae%a8%e5%8e%8c%e6%88%91%e6%83%b3%e5%81%9a%e7%9a%84%e4%ba%8b%e6%83%85%e5%81%9a%e4%b8%8d%e6%88%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸€è‡´æ€§æ˜¯æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´æ˜¯å¦èƒ½å¤Ÿä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚åœ¨ä¸€è‡´æ€§çš„éœ€æ±‚ä¸‹ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿåœ¨æ•°æ®ä¸€è‡´çš„çŠ¶æ€ä¸‹æ‰§è¡Œæ›´æ–°æ“ä½œåï¼Œåº”è¯¥ä¿è¯ç³»ç»Ÿçš„æ•°æ®ä»ç„¶å¤„äºä¸€è‡´çš„çŠ¶æ€ã€‚ &lt;br>
â€”â€” ã€Šä»Paxosåˆ°ZooKeeperã€‹&lt;/p>&lt;/blockquote>
&lt;p>æ— æ•°çš„ç†è®ºå’Œå®è·µè¯æ˜ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜æ˜¯éå¸¸å›°éš¾çš„ã€‚ä»æœ€ç›´è§‚ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬æ‰¾ä¸åˆ°ä¸¤ç‰‡ä¸€æ ·çš„æ ‘å¶ï¼Œä¹Ÿæ‰¾ä¸åˆ°ä¸¤å°çŠ¶æ€å®Œå…¨ä¸€è‡´çš„åˆ†å¸ƒå¼èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å‰äººçš„æ™ºæ…§æ˜¯æ— ç©·çš„ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼š&lt;/p>
&lt;h3 id="2pc-and-3pc">2PC and 3PC &lt;a href="#2pc-and-3pc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>2PCï¼ˆTwo-phase Commitï¼Œä¸¤é˜¶æ®µæäº¤ï¼‰æ˜¯ç”¨æ¥ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„ä¸€ä¸ªåè®®ã€‚å…¶æµç¨‹å¯ä»¥ç”±è¿™ä¸ªä¾‹å­æ¥è¡¨ç¤ºï¼š&lt;/p>
&lt;blockquote>
&lt;p>PMï¼ˆåè°ƒè€…ï¼‰: æˆ‘è¦åŠ ä¸ªéœ€æ±‚ï¼ï¼ˆé˜¶æ®µ1ï¼Œæäº¤äº‹åŠ¡è¯·æ±‚ï¼‰ &lt;br>
Dev1ï¼ˆå‚ä¸è€…ï¼‰ï¼šä½ åŠ å§ &lt;br>
Dev2ï¼ˆå‚ä¸è€…ï¼‰ï¼šä½ åŠ å§ &lt;br>
PMï¼ˆåè°ƒè€…ï¼‰ï¼šæˆ‘çœŸåŠ äº†ï¼ï¼ˆé˜¶æ®µ2ï¼Œæ‰§è¡Œäº‹åŠ¡æäº¤ï¼‰ &lt;br>
Dev1ï¼ˆå‚ä¸è€…ï¼‰ï¼šåŠ å®Œäº† &lt;br>
Dev2ï¼ˆå‚ä¸è€…ï¼‰ï¼šåŠ å®Œäº†&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>æ³¨ï¼šPMå’ŒDevæ˜¯ç¨‹åºå‘˜è€æ¢—è€Œå·²ã€‚å„ä¸ªèŒä¸šåªæ˜¯åˆ†å·¥ä¸åŒï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ºäººæ°‘æœåŠ¡ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ•´ä¸ªæµç¨‹çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>åŒæ­¥é˜»å¡ &lt;br>
åœ¨æäº¤è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿéœ€è¦ç­‰å¾…æ‰€æœ‰å‚ä¸è€…çš„å“åº”ï¼Œæ‰€ä»¥ç³»ç»Ÿæ•´ä½“å¤„äºä¸€ç§é˜»å¡çŠ¶æ€ï¼Œå½±å“æ•ˆç‡ã€‚&lt;/li>
&lt;li>å•ç‚¹é—®é¢˜ &lt;br>
åè°ƒè€…æ˜¯ç³»ç»Ÿçš„å•ç‚¹ï¼Œå¦‚æœå½“æ‰ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚&lt;/li>
&lt;li>æ•°æ®ä¸ä¸€è‡´ &lt;br>
ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§åè®®ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œç¡®å®æ˜¯éå¸¸è®½åˆºçš„äº‹æƒ…ã€‚åœ¨æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µï¼Œå¦‚æœåè°ƒè€…ä¸å‚ä¸è€…çš„é€šä¿¡ä¸­æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ï¼š
&lt;ul>
&lt;li>å½“åè°ƒè€…å‘å¾€éƒ¨åˆ†å‚ä¸è€…çš„Commitæ¶ˆæ¯ä¸¢å¤±ï¼Œæ²¡æœ‰æ”¶åˆ°Commitçš„å‚ä¸è€…ä¼šå› ä¸ºè¶…æ—¶è€Œè®¤ä¸ºè¿™æ¬¡è¯·æ±‚å¤±è´¥è€Œè¿›è¡Œå›æ»š&lt;/li>
&lt;li>å½“å‚ä¸è€…å‘å¾€åè°ƒè€…çš„ACKæ¶ˆæ¯ä¸¢å¤±ï¼Œåè°ƒè€…ä¼šè®¤ä¸ºè¿™æ¬¡è¯·æ±‚å¤±è´¥ï¼Œä½†æ˜¯å‚ä¸è€…ç¡®å®å·²ç»Commitäº†æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>3PCï¼ˆThree-phace Commitï¼Œä¸‰é˜¶æ®µæäº¤ï¼‰æ˜¯2PCåè®®çš„æ”¹è¿›ç‰ˆï¼Œå°†æ•´ä¸ªè¯·æ±‚åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>äº‹åŠ¡è¯¢é—®&lt;/li>
&lt;li>é¢„æäº¤&lt;/li>
&lt;li>æ‰§è¡Œæäº¤&lt;/li>
&lt;/ul>
&lt;p>è¿™æ ·çš„æ”¹è¿›å‡å°‘äº†åŒæ­¥é˜»å¡çš„ç²’åº¦ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰è§£å†³å•ç‚¹é—®é¢˜å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ‰€ä»¥2PCå’Œ3PCéƒ½ä¸æ˜¯éå¸¸ç†æƒ³çš„æ•°æ®ä¸€è‡´æ€§åè®®ã€‚&lt;/p>
&lt;h3 id="paxos">Paxos &lt;a href="#paxos" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°Paxosæ˜¯ä¸€ç§è¢«æ•°å­¦è¯æ˜è¿‡çš„ï¼Œå…·æœ‰é«˜åº¦å®¹é”™æ€§çš„ä¸€è‡´æ€§ç®—æ³•ã€‚ä½†æ˜¯å…¶æµç¨‹å¤æ‚ï¼Œé€šä¿¡æ¬¡æ•°è¾ƒå¤šï¼Œå¹¶ä¸”åœ¨ææ¡ˆæœªè¢«é€‰ä¸­ä¹‹å‰ä¸èƒ½ä¿è¯æ•°æ®çš„å¯ç”¨æ€§ã€‚&lt;/p>
&lt;p>æ‰€ä»¥Paxosçš„åº”ç”¨åœºæ™¯å¤šä¸ºå‘½åæœåŠ¡ã€é…ç½®ç®¡ç†ã€åˆ†å¸ƒå¼é”ç­‰è½»é‡çº§ä½†æ˜¯è€Œåˆéå¸¸æ ¸å¿ƒçš„æœåŠ¡ï¼Œä»è€Œæ‰¬é•¿é¿çŸ­ï¼Œæ›´å¥½çš„ä¸ºäººæ°‘æœåŠ¡ï¼Œ&lt;del>æ›´å¥½çš„åä¸‰ä¿—&lt;/del>ã€‚ã€‚&lt;/p>
&lt;h3 id="quorum-like-algorithm-amazon-dynamo">Quorum-like Algorithm (Amazon Dynamo) &lt;a href="#quorum-like-algorithm-amazon-dynamo" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œæœ€ç›´è§‚çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨ä¿®æ”¹èŠ‚ç‚¹çŠ¶æ€æ—¶ï¼Œå°†ä¿®æ”¹å¹¿æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·ä»ç†è®ºä¸Šè®²ï¼Œå°±å¯ä»¥ä¿æŒèŠ‚ç‚¹çš„ä¸€è‡´æ€§äº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯åœ¨ç°å®å·¥ç¨‹å½“ä¸­ï¼Œå¹¿æ’­ä¿®æ”¹æ˜¯æœ€ä¸å¯é çš„æ–¹æ¡ˆï¼Œå› ä¸ºé€šä¿¡å¯èƒ½å¤±è´¥ï¼ŒèŠ‚ç‚¹å¯èƒ½å¤±æ•ˆï¼Œæˆ‘ä»¬çš„ä¿®æ”¹å¾ˆæœ‰å¯èƒ½ä¸ä¼šåŒæ­¥åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šï¼ˆå‡è®¾æ¯ä¸ªèŠ‚ç‚¹çš„å¯é æ€§ä¸º99.9%ï¼Œé‚£ä¹ˆ10ä¸ªèŠ‚ç‚¹åŒæ—¶å¯é æ¦‚ç‡åªæœ‰99%ï¼Œ100ä¸ªèŠ‚ç‚¹åŒæ—¶å¯é çš„æ¦‚ç‡ä¸º90%ï¼‰ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¿æŒå®Œå…¨ä¸€è‡´è™½ç„¶å¾ˆå®Œç¾ï¼Œä½†æ˜¯å…¶ä»˜å‡ºçš„ä»£ä»·ä¹Ÿè®¸æ˜¯ç°æœ‰ çš„ç³»ç»Ÿéš¾ä»¥æ‰¿å—çš„ã€‚Amazon Dynamoä½¿ç”¨äº†ä¸€ç§ç±»ä¼¼é€‰ä¸¾çš„ç®—æ³•æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>è®¾æˆ‘ä»¬æœ‰Nä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å†æŒ‡å®šä¸¤ä¸ªæ•°Rå’ŒWï¼Œä½¿å¾— R + W &amp;gt; Nã€‚åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŒæ—¶å‘Nä¸ªèŠ‚ç‚¹å†™å…¥ï¼Œå½“æœ‰Wä¸ªï¼ˆåŠä»¥ä¸Šï¼‰èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸï¼›åœ¨è¯»å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘Rä¸ªèŠ‚ç‚¹è¯·æ±‚æ•°æ®ï¼Œæ­¤æ—¶ä¸€å®šä¼šè¯»åˆ°åˆšåˆšå†™å…¥æ–°æ•°æ®çš„èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬å°†æœ€æ–°çš„æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;p>ä¸è¿‡è¿™ç§è®¾è®¡å¹¶ä¸å®Œå–„ï¼Œå½“å‡ºç°ç½‘ç»œé”™è¯¯æˆ–è€…å¤§è§„æ¨¡èŠ‚ç‚¹å¤±æ•ˆçš„æ—¶å€™ï¼Œæ•°æ®ä¸€è‡´æ€§å°±å¾ˆéš¾ä¿è¯äº†ã€‚&lt;/p>
&lt;p>æˆ‘ç§°è¿™ç§ä¸€è‡´æ€§æ¨¡å‹ä¸º â€”â€” â€œå°½åŠ›ä¸€è‡´æ€§â€ã€‚&lt;/p>
&lt;h3 id="event-stream-for-eventual-consistency-apache-kafka">Event Stream for Eventual Consistency (Apache Kafka) &lt;a href="#event-stream-for-eventual-consistency-apache-kafka" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»Dynamoçš„ç»éªŒä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç›´æ¥å°†çŠ¶æ€çš„ä¿®æ”¹å¹¿æ’­åˆ°ä¸åŒçš„èŠ‚ç‚¹æ˜¯ä¸å¯é çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;p>Apache Kafkaä½¿ç”¨äº†ç±»ä¼¼â€œé¢„å†™å¼æ—¥å¿—â€çš„æ–¹æ³•æ¥ä¿è¯ä¸€è‡´æ€§ã€‚å½“çŠ¶æ€ä¿®æ”¹è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå…ˆå†™å…¥ä¸€æ¡å…¬å…±çš„æ•°æ®æµï¼Œè¿™æ¡æ•°æ®æµå¾€å¾€æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚ç„¶åä¸åŒçš„èŠ‚ç‚¹å†è®¿é—®æ•°æ®æµï¼Œæ‰§è¡ŒåŒæ ·çš„çŠ¶æ€ä¿®æ”¹è¯·æ±‚ï¼Œä¿è¯èŠ‚ç‚¹çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-27/17974300.jpg" alt="">&lt;/p>
&lt;p>è¿™ç§è®¾è®¡çš„ç¼ºé™·æ˜¯è™½ç„¶æœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šä¾æ¬¡æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œä½†æ˜¯èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çš„é€Ÿåº¦æœ‰å¿«æœ‰æ…¢ï¼Œæ‰€ä»¥åœ¨ç¬æ—¶ä¼šæœ‰ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p>
&lt;p>è¿™ç§ä¸€è‡´æ€§æ¨¡å‹è¢«ç§°ä¸º â€”â€” â€œæœ€ç»ˆä¸€è‡´æ€§â€ã€‚&lt;/p>
&lt;h2 id="ä¸»è§’ç™»åœºwindows-azure-storage">ä¸»è§’ç™»åœºï¼šWindows Azure Storage &lt;a href="#%e4%b8%bb%e8%a7%92%e7%99%bb%e5%9c%bawindows-azure-storage" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Windows Azure Storageï¼ˆä»¥ä¸‹ç®€ç§°WASï¼‰é‡‡ç”¨äº†å¤šç§ä¸€è‡´æ€§ç®—æ³•ï¼Œåœ¨æä¾›è¾ƒé«˜æ€§èƒ½æœåŠ¡çš„åŒæ—¶ï¼Œæ¥åŠªåŠ›ä¿è¯å­˜å‚¨ç³»ç»Ÿçš„CAPæ€§è´¨ã€‚&lt;/p>
&lt;p>å…¶ä¸­WASä½¿ç”¨äº†ä¸€äº›åˆ›æ–°æ€§çš„ç®—æ³•ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å…ˆä»å®ƒçš„æ•´ä½“æ¶æ„è°ˆèµ·ã€‚&lt;/p>
&lt;ul>
&lt;li>Windows Azure Storageçš„æ¶æ„&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-19/98830090.jpg" alt="">&lt;/p>
&lt;p>WASä»æ¶æ„ä¸Šåˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯å‰ç«¯ï¼ˆFE Layerï¼‰ï¼Œåˆ†åŒºå±‚ï¼ˆPartition Layerï¼‰å’Œæ•°æ®æµå±‚ï¼ˆStream Layerï¼‰ã€‚è¿™ä¸‰å±‚ä»åŠŸèƒ½ä¸Šå„æœ‰åˆ†å·¥ï¼Œä½†æ˜¯åˆåˆ†åˆ«è§£è€¦ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¬è‡ªåº•å‘ä¸Šçš„è®¨è®ºä¸€ä¸‹å„å±‚ä¹‹é—´çš„åŠŸèƒ½ä¸è”ç³»ã€‚&lt;/p>
&lt;h2 id="was---æ•°æ®æµå±‚">WAS - æ•°æ®æµå±‚ &lt;a href="#was---%e6%95%b0%e6%8d%ae%e6%b5%81%e5%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ•°æ®æµåŒ…å«ç€å„ç§æ•°æ®æ“ä½œï¼Œæ“ä½œåŒ…å«æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰åŸºæœ¬æ“ä½œï¼Œâ€œæµâ€åˆ™å¯ä»¥çœ‹åšæ˜¯ä¸€æ¡æ— é™é•¿çš„é˜Ÿåˆ—ã€‚&lt;/p>
&lt;h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æµç»“æ„">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æµç»“æ„ï¼Ÿ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e4%bd%bf%e7%94%a8%e6%b5%81%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸ºä»€ä¹ˆè¦ç”¨æµç»“æ„å‘¢ï¼ŒåŸå› éå¸¸ç®€å•ï¼Œå› ä¸ºæµä¸­çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼Œå¦åˆ™ä¼šé€ æˆä¸ç¡®å®šçš„ç»“æœã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªæ“ä½œï¼š&lt;/p>
&lt;p>æ“ä½œ1ï¼šæ’å…¥å€¼x=1 &lt;br>
æ“ä½œ2ï¼šä¿®æ”¹è¯¥å€¼ä¸ºx=2 &lt;br>
æ“ä½œ3ï¼šä¿®æ”¹è¯¥å€¼ä¸ºx=5&lt;/p>
&lt;p>å¦‚æœæ“ä½œæ˜¯æŒ‰ç…§é¡ºåºæ¥åšçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·å¾—çš„å€¼ä¸ºx=5ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†æ“ä½œ2å’Œæ“ä½œ3è°ƒæ¢ä¹‹åï¼Œé‚£ä¹ˆæˆ‘ä»¬è·å¾—çš„å€¼ä¸ºx=2ï¼›å¦‚æœæˆ‘ä»¬å°†æ“ä½œ1æ”¾ç½®åœ¨æ“ä½œ2æˆ–æ“ä½œ3ä¹‹åï¼Œæˆ‘ä»¬å°±åœ¨ä¿®æ”¹ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼ï¼Œè¿™åŠ¿å¿…ä¼šé€ æˆé”™è¯¯ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæ•°æ®æµçš„æœ‰åºæ€§ä¿è¯äº†æ“ä½œçš„â€œå›æ”¾ä¸€è‡´æ€§â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åŒçš„æ•°æ®æµåº”ç”¨åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè·å¾—çš„æœ€ç»ˆçŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œç”±äºHDDçš„é¡ºåºè¯»å†™æ€§èƒ½ä¼˜äºéšæœºè¯»å†™æ€§èƒ½ã€‚ä½¿ç”¨æµæ•°æ®ç»“æ„å¯ä»¥å°†å†™å…¥è¯·æ±‚é¡ºåºåŒ–ï¼Œè¿½åŠ å†™å…¥ç£ç›˜ï¼Œåœ¨å»‰ä»·çš„ç¡¬ä»¶ä¸Šè·å¾—æœ€å¥½çš„æ€§èƒ½ã€‚&lt;/p>
&lt;h5 id="ç§‘æ™®æ—¶é—´hddä¸ssd">ç§‘æ™®æ—¶é—´ï¼šHDDä¸SSD &lt;a href="#%e7%a7%91%e6%99%ae%e6%97%b6%e9%97%b4hdd%e4%b8%8essd" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-10/63227271.jpg" alt="image">&lt;/p>
&lt;p>HDDæŒ‡çš„æ˜¯Hard Disk Driveï¼Œåˆç§°Spinning Diskï¼Œæ˜¯è®¡ç®—æœºä½¿ç”¨çš„ä¸€ç§ä»¥ç£æ€§ç¢Ÿç‰‡å­˜å‚¨æ•°æ®çš„ä¸€ç§éæ˜“å¤±æ€§å­˜å‚¨è®¾å¤‡ï¼ˆäººè¯å°±æ˜¯ï¼šæ–­ç”µåä¸ä¸¢æ•°æ®ï¼‰ã€‚æ•°æ®å­˜å‚¨åœ¨åŒå¿ƒåœ†ç£é“ä¸Šï¼Œå·¥ä½œæ—¶ç¢Ÿç‰‡ä¼šæ—‹è½¬ï¼ˆå’ŒCDæœºä¸€æ ·ï¼‰ï¼Œç£å¤´ä¼šç§»åŠ¨åˆ°ç›¸åº”çš„ç£é“ä¸Šè¿›è¡Œæ•°æ®çš„è¯»å†™ï¼ˆCDæœºç”¨çš„æ˜¯å…‰å¤´ï¼‰ã€‚æ‰€ä»¥ï¼Œé¡ºåºè¯»å†™æ—¶ï¼ŒHDDçš„æ€§èƒ½ä¼šæ¯”éšæœºè¯»å†™è¦å¥½ï¼Œå› ä¸ºéšæœºè¯»å†™å¸¦æ¥çš„å¤§é‡ç£ç›˜å¯»å€ä¼šè®©ç£å¤´ä¸æ–­ç§»åŠ¨ï¼Œä»è€Œæ‹–æ…¢æ€§èƒ½ã€‚&lt;/p>
&lt;p>ä¸æ­¤åŒæ—¶ï¼Œç”±äºç¢Ÿç‰‡å†…å¼§çš„æ—‹è½¬&lt;strong>çº¿é€Ÿåº¦&lt;/strong>è¦å°äºå¤–å¼§ï¼Œæ‰€ä»¥å¤–å¼§çš„è¯»å†™æ€§èƒ½ä¼šä¼˜äºå†…å¼§ã€‚&lt;/p>
&lt;p>SSDæŒ‡çš„æ˜¯Solid State Diskï¼Œå³å›ºæ€ç¡¬ç›˜ï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„éæ˜“å¤±æ€§å­˜å‚¨è®¾å¤‡ã€‚å…¶ä½¿ç”¨é—ªå­˜èŠ¯ç‰‡æ¥å­˜å‚¨æ•°æ®ã€‚ç”±äºå…¶å¹¶ä¸åƒHDDä¸€æ ·éœ€è¦ç‰©ç†ä¸Šç§»åŠ¨ç£å¤´æ¥è¿›è¡Œå¯»å€ï¼Œåœ¨é¡ºåºå†™å…¥ä¸HDDæˆ–ç•¥å¼ºäºHDDç£ç›˜çš„åŒæ—¶ï¼Œéšæœºå†™å…¥æ€§èƒ½è¦è¿œè¿œå¼ºäºHDDï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è£…ç”µè„‘éƒ½å–œæ¬¢æŠŠç³»ç»Ÿè£…åˆ°SSDç›˜ä¸Šï¼‰ã€‚&lt;/p>
&lt;p>ä½†æ˜¯SSDåœ¨æˆæœ¬å’Œè´¨é‡ä¸Šå¼±äºHDDç£ç›˜ã€‚1TBçš„SSDçš„ä»·æ ¼çº¦ä¸º400åˆ€ï¼Œè€Œ1TBçš„HHDä»·æ ¼ä»…ä¸º80~100åˆ€ï¼ˆ2017å¹´10æœˆ&lt;a href="https://pcpartpicker.com/trends/internal-hard-drive/">æ•°æ®&lt;/a>ï¼‰ï¼›SSDæœ‰å†™å…¥æ¬¡æ•°çš„é™åˆ¶ï¼Œå½“é—ªå­˜èŠ¯ç‰‡æŸåæ—¶ï¼Œä¼šå½±å“SSDçš„æ€§èƒ½ã€‚ç›¸æ¯”è€Œè¨€ï¼ŒHDDçš„æŠ€æœ¯çš„æ€§èƒ½æ›´ç¨³å®šï¼ŒæŠ€æœ¯æ›´ä¸ºæˆç†Ÿï¼Œè´¨é‡ä¼šæ›´å¥½ä¸€äº›ã€‚&lt;/p>
&lt;h3 id="æ•°æ®æµçš„ä¸€è‡´æ€§ç®—æ³•">æ•°æ®æµçš„ä¸€è‡´æ€§ç®—æ³• &lt;a href="#%e6%95%b0%e6%8d%ae%e6%b5%81%e7%9a%84%e4%b8%80%e8%87%b4%e6%80%a7%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å› ä¸ºè¦ä¿è¯å¯ç”¨æ€§ï¼Œæ‰€ä»¥æ•°æ®æµå¿…é¡»è¦æ˜¯å¤šæœºçš„ï¼Œè€Œå¤šæœºç³»ç»Ÿå°±è¦é¢ä¸´ä¸€è‡´æ€§é—®é¢˜ã€‚WASæå‡ºäº†ä¸€ç§â€œé“¾å¼æäº¤â€æ–¹æ³•æ¥ä¿è¯äº†åˆ†å¸ƒå¼æ•°æ®æµçš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-7/32688212.jpg" alt="">&lt;/p>
&lt;p>ä¸ä¹‹å‰æåˆ°çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„å¤šæœºå¹¶è¡Œçš„ç®—æ³•ä¸åŒï¼ŒWASåœ¨æ•°æ®æµå±‚é‡‡ç”¨äº†ä¸€ç§â€œé“¾å¼â€çš„æäº¤ç®—æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>å½“å‰¯æœ¬1æ¥å—åˆ°æ•°æ®åï¼Œä¼šé¦–å…ˆå°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¹‹åå†å°†ç›¸åŒçš„è¯·æ±‚è½¬å‘ç»™å‰¯æœ¬2ï¼›&lt;/li>
&lt;li>å‰¯æœ¬2è·å¾—æ•°æ®åï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå†è¯·è¯·æ±‚è½¬å‘ç»™å‰¯æœ¬3ï¼›&lt;/li>
&lt;li>å‰¯æœ¬3å°†æ•°æ®æˆåŠŸæŒä¹…åŒ–åï¼Œè¿”å›ACKï¼›&lt;/li>
&lt;li>å‰¯æœ¬2æ¥æ”¶åˆ°å‰¯æœ¬3çš„ACKæ¶ˆæ¯åï¼ŒåŒæ ·è¿”å›ACKï¼›&lt;/li>
&lt;li>å‰¯æœ¬1æ¥æ”¶åˆ°å‰¯æœ¬2çš„ACKæ¶ˆæ¯åï¼Œå‘è¯·æ±‚æ–¹è¿”å›ACKã€‚&lt;/li>
&lt;/ol>
&lt;p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“æ•°æ®è¯·æ±‚è¿”å›ACKåï¼Œä¸€å®šæœ‰ä¸‰ä¸ªï¼ˆæˆ–ä»¥ä¸Šï¼Œæ ¹æ®ç³»ç»Ÿçš„å‚æ•°è€Œå®šï¼‰å‰¯æœ¬åŒæ—¶å†™å…¥å¹¶æŒä¹…åŒ–è¿™æ¡è¯·æ±‚ã€‚æ­¤æ—¶ä¸‰ä¸ªå‰¯æœ¬ä¸€å®šæ˜¯â€œå¼ºä¸€è‡´â€çš„ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œå¦‚æœé“¾å¼æäº¤å½“ä¸­æœ‰ä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºç°äº†é—®é¢˜ï¼Œæ¯”å¦‚æœºå™¨å¤±æ•ˆã€ç½‘ç»œè¶…æ—¶ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦é¢ä¸´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚WASä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†è¢«ç§°ä¸ºâ€œå°å­˜â€çš„æœºåˆ¶ã€‚&lt;/p>
&lt;h3 id="å°å­˜sealingæœºåˆ¶">å°å­˜ï¼ˆsealingï¼‰æœºåˆ¶ &lt;a href="#%e5%b0%81%e5%ad%98sealing%e6%9c%ba%e5%88%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸Šæ–‡è¯´åˆ°ï¼Œæ•°æ®æµæ˜¯ä¸€ä¸ªæ— é™é•¿çš„é˜Ÿåˆ—ï¼Œåªèƒ½åœ¨å°¾éƒ¨è¿½åŠ å†™å…¥ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœæƒ³è¦å­˜å‚¨è¿™æ¡æ•°æ®æµï¼Œå°±åŠ¿å¿…è¦æŠŠè¿™æ¡æ•°æ®æµåˆ†ä¸ºå¤šä¸ªèŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚å¦åˆ™æ•°æ®æµçš„å¤§å°å°±è¦å—é™äºå•æœºçš„å­˜å‚¨å®¹é‡ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„ã€‚&lt;/p>
&lt;p>åˆç”±äºæ•°æ®æµçš„å°¾éƒ¨è¿½åŠ å†™å…¥ç‰¹æ€§ï¼Œæ‰€ä»¥æ•°æ®æµè¢«åˆ†ä¸ºå¤šä¸ªèŠ‚ä¹‹åï¼Œåªæœ‰æœ€åä¸€ä¸ªèŠ‚æ˜¯å¯è¯»å†™çš„ï¼Œå…¶å®ƒçš„æ‰€æœ‰èŠ‚éƒ½æ˜¯åªè¯»çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-7/46032879.jpg" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å°†æŠŠå¯è¯»å¯è¿½åŠ çš„æ•°æ®æµè½¬åŒ–ä¸ºåªè¯»çš„æ•°æ®æµçš„æ“ä½œç§°ä¸ºâ€œå°å­˜â€ã€‚&lt;/p>
&lt;p>å°å­˜çš„ä½œç”¨ä¹‹ä¸€ï¼Œå°±æ˜¯åœ¨æ•°æ®æµçš„ä¸€èŠ‚è¿‡å¤§çš„æ—¶å€™ï¼Œåœæ­¢å†™å…¥è¯¥èŠ‚ï¼Œä½¿å¾—æ•°æ®èŠ‚çš„å¤§å°å¯æ§ã€‚&lt;/p>
&lt;p>ç¬¬äºŒä¸ªä½œç”¨ï¼Œæ˜¯ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ï¼Œåœ¨â€œé“¾å¼æäº¤â€å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰çš„æ•°æ®æµå‰¯æœ¬å°å­˜ï¼Œå°å­˜çš„æ—¶å€™å–æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®çš„äº¤é›†ã€‚è¿™æ ·å°±èƒ½æ’é™¤å› ä¸ºå†™å…¥å¤±è´¥è€Œä¸ä¸€è‡´çš„æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-12/93804080.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>æ­¤æ—¶æœ‰åŒå­¦ä¼šé—®ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æˆåŠŸçš„å†™å…¥äº†ä¸‰ä¸ªå‰¯æœ¬ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› å¹¶æ²¡èƒ½å‘è¯·æ±‚æ–¹è¿”å›ACKã€‚è¯·æ±‚æ–¹ä¼šè®¤ä¸ºè¿™æ®µæ•°æ®å†™å…¥å¤±è´¥ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨å°å­˜çš„æ—¶å€™ï¼Œä»ç„¶ä¼šå°†è¿™éƒ¨åˆ†æ•°æ®å°å­˜åœ¨æ•°æ®èŠ‚ä¸­ã€‚è¿™ç§æƒ…å†µæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ &lt;br>
è¿™ä¸ªé—®é¢˜åé¢ä¼šæœ‰è§£ç­”ï¼Œè¯·è€å¿ƒé˜…è¯»å“¦~&lt;/p>&lt;/blockquote>
&lt;h3 id="æ•°æ®æµå±‚çš„æ¶æ„">æ•°æ®æµå±‚çš„æ¶æ„ &lt;a href="#%e6%95%b0%e6%8d%ae%e6%b5%81%e5%b1%82%e7%9a%84%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-8/29641653.jpg" alt="">&lt;/p>
&lt;p>åœ¨å‰é¢çš„æ–‡ç« é‡Œï¼Œæ²¡æœ‰æåˆ°â€œæ•°æ®æµç®¡ç†å™¨â€ï¼ˆStream Managerï¼Œç®€ç§°SMï¼‰è¿™ä¸ªè§’è‰²ã€‚è¿™ä¸ªè§’è‰²åœ¨æ•´ä¸ªæ•°æ®æµå±‚æ‰®æ¼”äº†ä¸€ä¸ªå¾ˆé‡è¦çš„è§’è‰²ã€‚&lt;/p>
&lt;p>SMæ˜¯ç”±ä¸€ä¸ªå°å‹é›†ç¾¤ä½¿ç”¨paxosé€‰ä¸¾å‡ºæ¥çš„masterèŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹å¤‡ç”¨ã€‚SMåªç”¨æ¥ç®¡ç†æ•´ä¸ªæ•°æ®æµçš„çŠ¶æ€ï¼Œå¹¶ä¸è´Ÿè´£å…·ä½“çš„è¯»å†™æ“ä½œã€‚&lt;/p>
&lt;p>SMçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š&lt;/p>
&lt;ol>
&lt;li>ç»Ÿè®¡èŠ‚ç‚¹çŠ¶æ€&lt;/li>
&lt;li>ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶å†µ&lt;/li>
&lt;li>è´Ÿè½½å‡è¡¡&lt;/li>
&lt;li>å°å­˜ã€åˆ›å»ºæ–°çš„æ•°æ®èŠ‚&lt;/li>
&lt;li>å¤‡ä»½ä¸åƒåœ¾å›æ”¶&lt;/li>
&lt;/ol>
&lt;p>SMç®¡ç†ç€ä¸€æ‰¹å­˜å‚¨ç€æ•°æ®èŠ‚çš„èŠ‚ç‚¹ï¼ˆExtent Nodeï¼Œç®€ç§°ENï¼‰ï¼Œè¿™äº›èŠ‚ç‚¹å­˜å‚¨ç€æ•°æ®æµä¸­çš„èŠ‚ã€‚è¿™äº›èŠ‚ç‚¹ç›¸äº’é€šä¿¡ï¼Œä»¥å®Œæˆæäº¤ã€å¤‡ä»½ç­‰åŠŸèƒ½ã€‚&lt;/p>
&lt;p>ENèŠ‚ç‚¹ä¸­é‡‡ç”¨äº†é¢„å†™å…¥æ—¥å¿—ã€‚æ¯ä¸€æ¬¡å†™å…¥æ“ä½œï¼ŒENä¼šå¹¶å‘çš„&lt;/p>
&lt;ol>
&lt;li>è¿½åŠ å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†æ–°æ•°æ®å†™å…¥å†…å­˜ç¼“å­˜&lt;/li>
&lt;li>å†™å…¥æŒä¹…åŒ–å­˜å‚¨&lt;/li>
&lt;/ol>
&lt;p>å½“äºŒè€…æœ‰ä¸€ä¸ªå®Œæˆï¼Œå°±è¿”å›æˆåŠŸæ ‡è®°ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œç”±äºHDDè¿½åŠ å†™å…¥çš„æ€§èƒ½éå¸¸å¥½å¹¶ä¸”ç¨³å®šï¼Œæ‰€ä»¥æ­¥éª¤1çš„å“åº”æ—¶é—´æ˜¯ç¨³å®šçš„å¹¶ä¸”å¯ä»¥ä¼°è®¡çš„ã€‚ä¿è¯äº†ç³»ç»Ÿæ•´ä½“çš„å“åº”æ—¶é—´ä¸å‡ºç°å¤§çš„é¢ ç°¸ã€‚&lt;/p>
&lt;h2 id="was---åˆ†åŒºå±‚">WAS - åˆ†åŒºå±‚ &lt;a href="#was---%e5%88%86%e5%8c%ba%e5%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åˆ†åŒºå±‚ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¢«ç§°ä¸ºâ€œå¯¹è±¡è¡¨â€ï¼ˆObject Tableï¼‰çš„æŠ½è±¡ã€‚å¯¹è±¡è¡¨æä¾›äº†æ’å…¥ã€æ›´æ–°ã€åˆ é™¤åŠŸèƒ½ã€‚&lt;/p>
&lt;p>ä¸ºäº†æä¾›å®¹é‡æ”¯æŒï¼Œä¸€ä¸ªå¯¹è±¡è¡¨ä¼šè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼ˆè¿™å°±æ˜¯â€œåˆ†åŒºå±‚â€åå­—çš„æ¥æºï¼‰ã€‚åˆ†åŒºä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚&lt;/p>
&lt;p>å¯¹è±¡è¡¨æ„å»ºåœ¨æ•°æ®æµå±‚ä¹‹ä¸Šã€‚ä½†æ˜¯ä»ç›´è§‚ä¸Šæ¥è®²ï¼Œè¡¨ç»“æ„å’Œæµç»“æ„æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œé‚£ä¹ˆåˆ†åŒºå±‚æ˜¯å¦‚ä½•å°†è¡¨å­˜å‚¨åœ¨æ•°æ®æµå±‚çš„å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="lsm-treelog-structed-merge-tree">LSM Treeï¼ˆLog-Structed Merge-Treeï¼‰ &lt;a href="#lsm-treelog-structed-merge-tree" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>æ®µå­ï¼š &lt;br>
ä¸€ä¸ªå­¦ç”ŸèƒŒç€æ»¡ä¹¦åŒ…çš„ä¹¦è¿›å…¥å›¾ä¹¦é¦†ï¼Œå®å®å®ï¼Œå›¾ä¹¦é¦†çš„æŠ¥è­¦å™¨å“äº†ï¼Œå­¦ç”Ÿèµ¶ç´§æŠŠä¹¦ä»ä¹¦åŒ…å€’å‡ºæ¥ï¼Œå‡†å¤‡ä¸€æœ¬ä¸€æœ¬çš„éªŒè¯ï¼Œçœ‹æ˜¯å“ªæœ¬ä¹¦æœ‰é—®é¢˜ã€‚ &lt;br>
ä¸€æ—æ‰«åœ°çš„é˜¿å§¨çœ‹ä¸ä¸‹å»äº†ï¼Œè¿‡æ¥æŠŠä¹¦åˆ†æˆäº†ä¸¤æŒªï¼Œå…ˆæ£€æŸ¥ç¬¬ä¸€æŒªï¼Œå®å®å®ï¼ŒæŠ¥è­¦å™¨å“äº†ï¼Œè¯´æ˜è¿™ä¸€æŒªæœ‰é—®é¢˜ï¼ŒåˆæŠŠè¿™ä¸€æŒªåˆ†æˆä¸¤æŒªï¼Œå…ˆæ£€æŸ¥å…¶ä¸­ä¸€æŒªï¼Œè¦æ˜¯å“ªä¸€æŒªå“äº†ï¼Œå°±æŠŠè¿™ä¸€æŒªç»§ç»­åˆ†æˆä¸¤æŒªï¼Œç»§ç»­æ£€æŸ¥ï¼Œä¸åˆ°ä¸‰å›åˆï¼Œå¤§å¦ˆå°±æŠŠæœ‰é—®é¢˜çš„å“ªæœ¬ä¹¦æ‰¾å‡ºæ¥äº†ã€‚ &lt;br>
å¤§å¦ˆç”¨é„™è§†çš„çœ¼ç¥çœ‹ç€é‚£å­¦ç”Ÿï¼Œä»¿ä½›åœ¨è¯´è¿Oï¼ˆnï¼‰è·ŸOï¼ˆlog nï¼‰éƒ½åˆ†ä¸æ¸…æ¥šã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬ä¸Šæ–‡ä¸­æåˆ°ï¼ŒHDDç£ç›˜å¯ä»¥åœ¨è¾ƒä½æˆæœ¬ä¸‹æä¾›å¾ˆå¥½çš„è¿½åŠ å†™å…¥æ€§èƒ½ï¼Œä½†æ˜¯å¯¹äºéšæœºè¯»å†™çš„æ€§èƒ½ä¸ä½³ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¯¹äºè¡¨ç»“æ„æ¥è¯´ï¼Œå¿…ç„¶æ¶‰åŠåˆ°å¤§é‡çš„éšæœºè¯»å†™ã€‚å› ä¸ºè¾“å…¥æ•°æ®å°±åƒæ‰“ä¹±è¿‡çš„æ‰‘å…‹ç‰Œï¼Œå¾ˆéš¾ä¿è¯è§„å¾‹æ€§ï¼›è€Œæˆ‘ä»¬åˆè¦æŠŠç‰¹å®šçš„è¾“å…¥æ•°æ®æ”¾åˆ°ç‰¹å®šçš„è¡Œä¸Šï¼Œæ‰€ä»¥æ•°æ®çš„å†™å…¥ä½ç½®å¿…ç„¶æ˜¯éšæœºçš„ã€‚æ‰€ä»¥ï¼Œç›´æ¥åœ¨ç£ç›˜ä¸­å­˜å‚¨è¡¨ç»“æ„æ˜¯éå¸¸ä½æ•ˆçš„ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆLSM Treeæ˜¯æ€ä¹ˆè§£å†³é—®é¢˜çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬æŠŠå·²æœ‰çš„æ•°æ®æ ¹æ®keyè¿›è¡Œæ’åºï¼Œå­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œæ ‡è®°ç¬¬0ä»£ã€‚æ‰€æœ‰å†™å…¥ç£ç›˜çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ã€åªè¯»çš„ã€‚&lt;/p>
&lt;p>å½“æœ‰æ–°çš„æ•°æ®å†™å…¥æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆå°†å…¶ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚å½“æ•°æ®è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬å°†å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ’åºï¼Œå¹¶å†™å…¥ç£ç›˜ã€‚è¿™ä¸€éƒ¨åˆ†æ•°æ®è¢«æ ‡è®°ä¸ºç¬¬1ä»£ã€‚&lt;/p>
&lt;p>ä¹‹åçš„æ•°æ®ä¾æ¬¡ç±»æ¨ï¼Œè¢«æ ‡è®°ä¸ºç¬¬2ä»£ï¼Œç¬¬3ä»£&amp;hellip;ç¬¬nä»£ã€‚ä»£æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºæ•°æ®è¶Šæ–°ã€‚å¹¶ä¸”ä»£æ•°é«˜çš„æ•°æ®åœ¨é€»è¾‘ä¸Šå¯ä»¥è¦†ç›–ä»£æ•°ä½çš„æ•°æ®ã€‚&lt;/p>
&lt;p>åœ¨æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€ç´¢å†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¾æ¬¡ä»ç¬¬nä»£çš„æ•°æ®æŸ¥è¯¢åˆ°ç¬¬0ä»£ã€‚å¦‚æœä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¿”å›æœªæ‰¾åˆ°ã€‚ç”±äºæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨[å¸ƒéš†è¿‡æ»¤å™¨][6]ï¼Œå¿«é€Ÿåˆ¤å®šä¸€ä¸ªkeyæ˜¯å¦åœ¨LSM Treeä¸­ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼ŒæŒ‰ç…§ä¸Šé¢æè¿°çš„ç®—æ³•ï¼ŒLSM Treeçš„ä»£æ•°ä¼šæ— é™è†¨èƒ€ä¸‹å»ï¼Œæœ€ç»ˆå¯¼è‡´éå¸¸å·®çš„çš„æ£€ç´¢æ•ˆæœã€‚åœ¨è®ºæ–‡ä¸­æ²¡æœ‰æ˜ç¡®æåˆ°LSM Treeçš„è°ƒæ•™å‚æ•°ï¼Œä½†æ˜¯æˆ‘çŒœæµ‹å…¶ä»£æ•°ä¸ä¼šå¤ªå¤šã€‚å¹¶ä¸”åœ¨å†—ä½™æ•°æ®è¿‡å¤šæ—¶ï¼Œä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä¿è¯æ£€ç´¢çš„æ•ˆç‡ã€‚ &lt;br>
åŒæ—¶è¿™ä¹Ÿæé†’æˆ‘ä»¬åœ¨ä½¿ç”¨WASçš„æ—¶å€™ï¼Œå°½é‡ä¸è¦å‘æŸä¸€ä¸ªæˆ–æŸä¸€äº›è¿ç»­çš„åˆ†åŒºè¿ç»­å†™å…¥å¤§é‡æ•°æ®ï¼Œå¦åˆ™ä¼šå¯¼è‡´åˆ†åŒºå±‚çš„æ€§èƒ½é€€åŒ–ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="åˆ†åŒºå±‚ä½¿ç”¨çš„æ•°æ®æµ">åˆ†åŒºå±‚ä½¿ç”¨çš„æ•°æ®æµ &lt;a href="#%e5%88%86%e5%8c%ba%e5%b1%82%e4%bd%bf%e7%94%a8%e7%9a%84%e6%95%b0%e6%8d%ae%e6%b5%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åˆ†åŒºå±‚ä½¿ç”¨æ•°æ®æµæ¥ä¿å­˜LSM Treeï¼Œä½¿ç”¨é¡ºåºå†™å…¥ä»£æ›¿éšæœºå†™å…¥ä»¥è·å¾—æ€§èƒ½æå‡ï¼Œè¿™æ¡æµè¢«ç§°ä¸ºâ€œè¡Œæ•°æ®æµâ€ï¼ˆRow Data Streamï¼‰ã€‚&lt;/p>
&lt;p>ä¸æ­¤åŒæ—¶ï¼Œåˆ†åŒºå±‚è¿˜ä½¿ç”¨äº†â€œäºŒè¿›åˆ¶æ•°æ®æµâ€ï¼ˆBlob Data Streamï¼‰æ¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚ä»¥åŠâ€œæäº¤æ—¥å¿—æµâ€ï¼ˆCommit Log Streamï¼‰æ¥æŒä¹…åŒ–é¢„å†™å…¥æ—¥å¿—ã€‚&lt;/p>
&lt;p>åˆ†åŒºå±‚å‘æ•°æ®æµå±‚å†™å…¥æ—¶ï¼Œåªæœ‰å½“æ•°æ®æµå±‚è¿”å›ACKåï¼Œæ‰è®¤ä¸ºå†™å…¥æˆåŠŸã€‚æ‰€ä»¥ï¼Œåœ¨æ•°æ®æµå±‚å†™å…¥æˆåŠŸï¼Œä½†æœªèƒ½è¿”å›ACKæ—¶ï¼Œè™½ç„¶æ•°æ®æµå±‚ä¿ç•™äº†æ•°æ®ï¼Œä½†æ˜¯åˆ†åŒºå±‚å¹¶ä¸èƒ½è®¿é—®è¿™éƒ¨åˆ†æ•°æ®ï¼Œæˆ‘ä»¬å°±åœ¨åˆ†åŒºå±‚ä¿è¯äº†æ•°æ®çš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;h3 id="åˆ†åŒºå±‚çš„ä¸€è‡´æ€§ä¿è¯">åˆ†åŒºå±‚çš„ä¸€è‡´æ€§ä¿è¯ &lt;a href="#%e5%88%86%e5%8c%ba%e5%b1%82%e7%9a%84%e4%b8%80%e8%87%b4%e6%80%a7%e4%bf%9d%e8%af%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åˆ†åŒºå±‚çš„æŒä¹…åŒ–ä¿¡æ¯ä¾èµ–äºæ•°æ®æµå±‚ï¼Œæ‰€ä»¥å¦‚æœåˆ†åŒºå±‚ä½¿ç”¨åœ¨çº¿å¤šå‰¯æœ¬ï¼Œå°±ä¼šé‡åˆ°èŠ‚ç‚¹çŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ä¸åŒçš„èŠ‚ç‚¹åŠ è½½äº†ç›¸åŒçš„æ•°æ®ï¼Œä½†æ˜¯åŠ è½½é€Ÿåº¦æœ‰å¿«æœ‰æ…¢ï¼Œå¾ˆéš¾ä¿è¯èŠ‚ç‚¹ä¹‹é—´ä»¥ä¸€ä¸ªåŒæ ·çš„çŠ¶æ€å¯¹å¤–æœåŠ¡ã€‚åŒæ—¶ï¼Œåœ¨çº¿å¤šå‰¯æœ¬çš„å†™å…¥ä¼šå¼•å…¥ç«æ€ï¼Œå¦‚æœå†åŠ é”ï¼Œå°±ä¼šå¤§å¤§çš„å½±å“ç³»ç»Ÿçš„æ•ˆç‡ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆWASæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>ç­”ï¼šä¸èƒ½ä¿è¯ä¸€è‡´æ€§å°±ä¸è¦ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä¸è¦ä¸€è‡´æ€§å¹¶ä¸æ˜¯æ”¾ä»»èŠ‚ç‚¹é—´çš„çŠ¶æ€ä¸åŒæ­¥ï¼Œè€Œæ˜¯æ¯ä¸€ä¸ªåˆ†åŒºåªä½¿ç”¨ä¸€ä¸ªåœ¨çº¿æœåŠ¡èŠ‚ç‚¹ã€‚å¯¹äºå”¯ä¸€ä¸€ä¸ªèŠ‚ç‚¹æ¥è¯´ï¼Œä¸€è‡´æ€§å°±æ˜¯ä¸å­˜åœ¨çš„ã€‚ï¼ˆæ˜¯ä¸æ˜¯éå¸¸æš´åŠ›ï¼‰&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œåœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœºå™¨å¯¹å¤–æä¾›æœåŠ¡ï¼ˆè¯»+å†™ï¼‰ã€‚å…¶å®ƒçš„å‰¯æœ¬æ˜¯åœ¨çº¿å¤‡ä»½ï¼Œåœ¨å¯¹å¤–æä¾›æœåŠ¡çš„æœºå™¨åœ¨è®¡åˆ’å†…ä¸‹çº¿æˆ–æ„å¤–å½“æ‰æ—¶ï¼Œå°±ä¼šå¯ç”¨å¦ä¸€å°å‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚å½“ç„¶è¿™ä¹Ÿä¼šé€ æˆä¸€è‡´æ€§é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œç‰ºç‰²äº†ä¸€ç‚¹å¯ç”¨æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨æ—§èŠ‚ç‚¹ä¸‹çº¿åï¼Œæ–°èŠ‚ç‚¹å¿…é¡»åŠ è½½å®Œæ‰€æœ‰çš„æ•°æ®æ‰å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚ä¸­é—´çš„ä¸€æ®µæ—¶é—´è¿™ä¸ªåˆ†åŒºæ˜¯ä¸å¯ç”¨çš„ã€‚&lt;/p>
&lt;h3 id="åˆ†åŒºå±‚çš„æ¶æ„">åˆ†åŒºå±‚çš„æ¶æ„ &lt;a href="#%e5%88%86%e5%8c%ba%e5%b1%82%e7%9a%84%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-10/51400577.jpg" alt="">&lt;/p>
&lt;p>å›¾ä¸­çš„PSæŒ‡çš„å°±æ˜¯ä¸Šæ–‡æåˆ°çš„åˆ†åŒºæœåŠ¡ï¼Œæ¯ä¸ªPSç»´æŠ¤ç€å¯¹è±¡è¡¨çš„ä¸€ä¸ªåˆ†åŒºï¼Œå…¶æŒä¹…åŒ–ä¿¡æ¯éƒ½å‚¨å­˜åœ¨æ•°æ®æµå±‚ä¸Šã€‚&lt;/p>
&lt;p>PMï¼ˆPartition Managerï¼‰ä¹Ÿæ˜¯ä½¿ç”¨paxosç®—æ³•é€‰ä¸¾å‡ºæ¥çš„masterèŠ‚ç‚¹ï¼Œç”¨æ¥ç®¡ç†åˆ†åŒºæœåŠ¡çš„è´Ÿè½½å‡è¡¡ã€ç¾å¤‡ç­‰æ“ä½œã€‚&lt;/p>
&lt;p>Lock Serviceç”¨æ¥å¯¹åˆ†åŒºèŠ‚ç‚¹è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºçš„å”¯ä¸€masterèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>Partion Map Tableç”¨æ¥å­˜å‚¨ä¸æ£€ç´¢åˆ†åŒºæ‰€å¯¹åº”çš„èŠ‚ç‚¹ã€‚&lt;/p>
&lt;h2 id="was---å‰ç«¯å±‚">WAS - å‰ç«¯å±‚ &lt;a href="#was---%e5%89%8d%e7%ab%af%e5%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å‰ç«¯å±‚åªæ˜¯è–„è–„çš„ä¸€å±‚REST APIå°è£…ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå…¶å®ƒç‰¹æ®ŠåŠŸèƒ½ã€‚è¿™é‡Œä¸€ç¬”å¸¦è¿‡ã€‚&lt;/p>
&lt;h2 id="æˆ˜èƒœcapç†è®ºä½ ä»–å¨˜çš„çœŸæ˜¯ä¸ªå¤©æ‰">æˆ˜èƒœCAPç†è®ºï¼Ÿä½ ä»–å¨˜çš„çœŸæ˜¯ä¸ªå¤©æ‰ï¼ &lt;a href="#%e6%88%98%e8%83%9ccap%e7%90%86%e8%ae%ba%e4%bd%a0%e4%bb%96%e5%a8%98%e7%9a%84%e7%9c%9f%e6%98%af%e4%b8%aa%e5%a4%a9%e6%89%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-9-20/10049124.jpg" alt="">&lt;/p>
&lt;p>WASå®£ç§°è‡ªå·±æˆ˜èƒœäº†CAPç†è®ºï¼Œæä¾›äº†é«˜å¯ç”¨æ€§å’Œå¼ºä¸€è‡´æ€§ã€‚WASèƒ½åšåˆ°è¿™ç‚¹ä¸»è¦æ˜¯å› ä¸ºæ•°æ®æµå±‚è®¾è®¡çš„å¥½ã€‚&lt;/p>
&lt;p>æ•°æ®æµå±‚ä½¿ç”¨äº†åªè¿½åŠ å†™çš„æ•°æ®æ¨¡å‹ï¼ŒåŠ ä¸Šé“¾å¼æäº¤æä¾›çš„é«˜ä¸€è‡´æ€§ï¼Œæ‰€ä»¥èƒ½åº”å¯¹èŠ‚ç‚¹å¤±æ•ˆï¼ˆå¯ç”¨æ€§ï¼‰å’Œç½‘ç»œå¤±æ•ˆï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰çš„æ•…éšœã€‚&lt;/p>
&lt;p>æ•°æ®æµå±‚ä¹‹ä¸Šçš„åˆ†åŒºå±‚åˆ©ç”¨äº†å…¶ç‰¹æ€§ï¼Œå¾ˆå®¹æ˜“çš„å®ç°äº†é«˜å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ã€‚åŒæ—¶ï¼Œåˆç”±äºå…¶ä½¿ç”¨å•ç‚¹å‘å¤–æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ä¸€è‡´æ€§ä¹Ÿæœ‰äº†ä¿éšœã€‚&lt;/p>
&lt;p>æ‰€ä»¥WASå®£ç§°è‡ªå·±æˆ˜èƒœäº†CAPç†è®ºï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰é“ç†ã€‚ä½†æ˜¯ä¸ªäººæ„Ÿè§‰WASåœ¨åˆ†åŒºå±‚çš„å•ç‚¹è®¾å®šï¼Œæ˜¯ä»¥ç‰ºç‰²å¯ç”¨æ€§ï¼ˆAï¼‰æ¢å–ä¸€è‡´æ€§ï¼ˆCï¼‰çš„ä¸€ç§å¦¥åï¼Œåªæ˜¯ç”±äºæœºå™¨æ•…éšœå¹¶éå¤šå‘ï¼Œè§¦å‘é—®é¢˜çš„æœºç‡æ¯”è¾ƒå°ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ¬æ–‡æ˜¯ã€ŠWindows Azure Storage: A Highly Available Cloud Storage Service with Strong Consistencyã€‹ä¸€æ–‡çš„è¯»åæ„Ÿï¼Œåˆ èŠ‚äº†ä¸€éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£çš„ç»†èŠ‚ã€‚æƒ³è¦æ›´è¯¦å°½çš„ç†è§£WASçš„è®¾è®¡æ€æƒ³ï¼Œè¯·é˜…è¯»è®ºæ–‡åŸæ–‡ä»¥åŠå®˜æ–¹æ–‡æ¡£ã€‚ä¸€åˆ‡å†…å®¹å’Œç†è§£ä¸Šçš„å†²çªï¼Œä»¥åŸæ–‡å’Œå®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚&lt;/p>
&lt;p>æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘ä½¿ç”¨Atreus2tapè¿·ä¹‹å°é”®ç›˜ï¼Œåœ¨å­¦ä¹ å‰äººç»éªŒæ•™è®­çš„åŒæ—¶ï¼Œé‡æ–°å­¦ä¹ äº†æ‰“å­—ã€‚&lt;/p>
&lt;p>å°é”®ç›˜çš„å¥½å¤„æ˜¯ä¾¿æºï¼Œä»¥åŠé¿å…æ‰‹æŒ‡ç§»åŠ¨å¸¦æ¥çš„åŠ³æŸã€‚ç¼ºç‚¹æ˜¯éœ€è¦ç²¾å¿ƒè®¾è®¡å¹¶ç»ƒä¹ å¤§é‡çš„ç»„åˆé”®ï¼ŒåŒæ—¶æˆå¥—çš„é”®å¸½çœŸæ˜¯ä¸å¥½ä¹°ã€‚&lt;/p>
&lt;p>ä¸Šä¸€å¼ å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-10-10/71011744.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å¬è¯´ç”¨è¿™ç§å¥‡æ€ªé”®ç›˜çš„äººéƒ½æ³¨å­¤äº†ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://wetest.qq.com/lab/view/105.html">åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„æ±‚ç”Ÿä¹‹è·¯&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://waylau.com/talk-about-distributed-system/">ç”¨å¤§ç™½è¯èŠèŠåˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://book.douban.com/subject/26292004/">ã€Šä»Paxosåˆ°Zookeeperã€‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf">Dynamo: Amazonâ€™s Highly Available Key-value Store&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Metaprogramming in .NET è¯»ä¹¦ç¬”è®° - 1</title><link>https://wizmann.top/posts/metaprogramming-in-dotnet-1/</link><pubDate>Wed, 26 Jul 2017 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/metaprogramming-in-dotnet-1/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯-metaprogramming-å…ƒç¼–ç¨‹">ä»€ä¹ˆæ˜¯ Metaprogramming (å…ƒç¼–ç¨‹) &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af-metaprogramming-%e5%85%83%e7%bc%96%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-2-15/1418894-file_1487139497158_1868c.jpg" alt="">&lt;/p>
&lt;p>å…ƒç¼–ç¨‹ä»å­—é¢ä¸Šç†è§£å°±æ˜¯â€œèƒ½å¤„ç†ç¨‹åºçš„ç¨‹åºâ€ã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„â€œå¤„ç†â€ï¼Œæœ‰ä¸¤ä¸ªæ„æ€ã€‚&lt;/p>
&lt;p>ä¸€æ˜¯â€œç¼–å†™â€ã€â€œç”Ÿæˆâ€ï¼Œæœ€ç»å…¸ä¾‹å­å°±æ˜¯ç¼–è¯‘å™¨ï¼Œå®ƒå°†æˆ‘ä»¬çš„æ‰€ç¼–å†™çš„é«˜çº§è¯­è¨€ç¿»è¯‘æˆæœºå™¨ä»£ç ã€‚ç¼–è¯‘å™¨å°±åƒå»ºç­‘å·¥äººï¼Œå°†â€œè“å›¾â€ï¼ˆé«˜çº§è¯­è¨€ï¼‰è½¬åŒ–æˆâ€œé«˜æ¥¼å¤§å¦â€ï¼ˆæœºå™¨è¯­è¨€ï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„å°±æ˜¯â€œå®â€(Macro)ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨é¢„å…ˆç¼–å†™å¥½çš„å®ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œå®ä¼šè¢«è‡ªåŠ¨å±•å¼€æˆç›¸åº”çš„ä»£ç ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ç”¨æœºå™¨å¸¦æ›¿äººç±»åŠ³åŠ¨ã€‚&lt;/p>
&lt;p>â€œå¤„ç†â€çš„å¦å¤–ä¸€ä¸ªæ„æ€å°±æ˜¯â€œå¤„ç†è‡ªå·±â€ï¼Œå…ƒç¼–ç¨‹è®©ç¨‹åºåœ¨è¿è¡Œæ—¶äº†è§£è‡ªå·±çš„çŠ¶æ€ï¼Œå¹¶åŠ¨æ€çš„æ‰©å±•å¹¶æ‰§è¡Œçš„ç›¸åº”é€»è¾‘ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œæœ€é«˜çº§çš„â€œå¤„ç†â€å°±æ˜¯èƒ½å®Œå…¨ä»£æ›¿äººè„‘çš„äººå·¥æ™ºèƒ½ã€‚å¦‚æœé‚£ä¸€å¤©åˆ°æ¥ï¼Œæˆ‘ä»¬å°±è·ç¦»ç”Ÿæ´»åœ¨Matrixé‡Œä¸è¿œäº†ã€‚&lt;/p>
&lt;h2 id="å…ƒç¼–ç¨‹çš„å®ç°">å…ƒç¼–ç¨‹çš„å®ç° &lt;a href="#%e5%85%83%e7%bc%96%e7%a8%8b%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å…ƒç¼–ç¨‹ä¸»è¦å®ç°åœ¨ç¼–è¯‘æœŸå‰åä»¥åŠè¿è¡Œæ—¶ã€‚&lt;/p>
&lt;p>å…ƒç¼–ç¨‹ä¸»è¦ä¾èµ–äºä»¥ä¸‹æŠ€æœ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»£ç ç”Ÿæˆ(code generation)&lt;/li>
&lt;li>åå°„(reflection)&lt;/li>
&lt;li>æ±‡ç¼–é‡å†™(assembly rewriting)&lt;/li>
&lt;li>è¡¨è¾¾å¼(expression)&lt;/li>
&lt;li>ä»£ç åˆ†æ(code analysis)&lt;/li>
&lt;/ul>
&lt;h2 id="ä»£ç ç”Ÿæˆcode-generation">ä»£ç ç”Ÿæˆ(code generation) &lt;a href="#%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90code-generation" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>â€œæ‹³æœ‰å®šåŠ¿ï¼Œè€Œç”¨æ—¶åˆ™æ— å®šåŠ¿ã€‚ç„¶å½“å…¶ç”¨ä¹Ÿï¼Œå˜æ— å®šåŠ¿ï¼Œè€Œå®ä¸å¤±åŠ¿â€&lt;/p>&lt;/blockquote>
&lt;p>è™½ç„¶å†™ä»£ç æ˜¯ä¸€é¡¹åˆ›é€ æ€§å·¥ä½œï¼Œä½†æ˜¯è¿™ä¸æ„å‘³ç€å¯¹äºæ¯ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éƒ½è¦ä»é›¶å¼€å§‹ã€‚åœ¨è½¯ä»¶å·¥ç¨‹çš„å‘å±•è¿‡ç¨‹ä¸­ï¼Œå‰äººå·²ç»ä¸ºæˆ‘ä»¬æ€»ç»“äº†ä¸€äº›å¸¸ç”¨çš„â€œæœ€ä½³å®è·µâ€(best practise)ã€‚åœ¨æˆ‘ä»¬çš„å¼€å‘å·¥ç¨‹ä¸­ï¼Œçµæ´»æ°å½“çš„åº”ç”¨è¿™äº›â€œå®šåŠ¿â€ï¼Œä¼šå¤§å¤§ç®€åŒ–æˆ‘ä»¬çš„å·¥ä½œï¼Œé™ä½äººåŠ›æˆæœ¬ã€‚&lt;/p>
&lt;p>â€œå®šåŠ¿â€æ„å‘³ç€â€œé‡å¤â€ã€‚è€Œé‡å¤å·¥ä½œå¾€å¾€æ˜¯å¤æ‚è€Œæ˜“å‡ºé”™çš„ï¼Œæ‰€ä»¥æœ‰äººæå‡ºäº†DRYåŸåˆ™ï¼šDon&amp;rsquo;t Repeat Yourselfã€‚ä»£ç ç”Ÿæˆå·¥å…·åˆ™æ˜¯è¿™ä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>å¯¹äºçµæ´»å¤šå˜è€Œåˆéµä»å®šåŠ¿çš„ä»£ç ï¼Œä½¿ç”¨ä»£ç ç”Ÿæˆå¯ä»¥æé«˜å¼€å‘é€Ÿåº¦ï¼Œé™ä½å­¦ä¹ æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ï¼Œä½¿ä»£ç ç»´æŠ¤åŒä¸€ç§æŠ½è±¡æ–¹æ³•ï¼Œéµä»é¢„å…ˆç¡®å®šçš„æ¨¡å¼ï¼Œä¹Ÿæ›´æ–¹ä¾¿ç®¡ç†ã€‚&lt;/p>
&lt;h3 id="ä¸¾ä¸€ä¸ªä¾‹å­">ä¸¾ä¸€ä¸ªä¾‹å­ &lt;a href="#%e4%b8%be%e4%b8%80%e4%b8%aa%e4%be%8b%e5%ad%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨C++é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ä¸€ä¸ª&lt;code>max(a, b)&lt;/code>å‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define max(a, b) ((a) &amp;gt; (b)? (a): (b))
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ï¼Œæœ‰ç»éªŒçš„è€å¸æœºéƒ½çŸ¥é“è¿™æ ·å†™çš„é—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¢ä¸€ç§æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> max(&lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">&amp;gt;&lt;/span> b&lt;span style="color:#f92672">?&lt;/span> a: b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯åœ¨C#é‡Œï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½è¿™ä¹ˆåšã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¼ºè¡Œå¥—ç”¨C++çš„è¯­æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> T MyMax&amp;lt;T&amp;gt;(T a, T b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a &amp;gt; b ? a : b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„ä»£ç ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½æ”¯æŒ&lt;code>&amp;gt;&lt;/code>æ¯”è¾ƒæ“ä½œã€‚è¿›ä¸€æ­¥è¯´ï¼ŒC++çš„templateå±•å¼€æ˜¯ç¼–è¯‘æ—¶è¿›è¡Œçš„ï¼Œæ ¹æ®ä¸åŒçš„æ¨¡æ¿å‚æ•°ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„ä»£ç ï¼Œè¿è¡Œæ—¶çš„é€»è¾‘æ˜¯ç¡®å®šçš„ã€‚è€ŒC#çš„æ³›å‹åœ¨è¿è¡Œæ—¶ä»æ˜¯â€œæ³›å‹â€çš„ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶ï¼ŒC#ç¼–è¯‘å™¨éœ€è¦çŸ¥é“æ›´å¤šçš„ä¿¡æ¯æ¥ä¿è¯è¿è¡Œæ—¶çš„ç±»å‹å®‰å…¨(type-safe)ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬è¦ç»™&lt;code>&amp;lt;T&amp;gt;&lt;/code>åŠ ä¸€ä¸ªé™åˆ¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒC#ä¸­å¯ä»¥ç»§æ‰¿&lt;code>IComparable&amp;lt;T&amp;gt;&lt;/code>æ¥å£æ¥å®ç°&amp;quot;æ¯”è¾ƒ&amp;quot;(compare)æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> T MyMax&amp;lt;T&amp;gt;(T a, T b) &lt;span style="color:#66d9ef">where&lt;/span> T: IComparable&amp;lt;T&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a.CompareTo(b) &amp;gt; &lt;span style="color:#ae81ff">0&lt;/span> ? a : b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¼¼ä¹è§£å†³äº†é—®é¢˜ï¼Œå¯¹äºå®ç°äº†&lt;code>IComparable&amp;lt;T&amp;gt;&lt;/code>æ¥å£çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>MyMax&amp;lt;T&amp;gt;&lt;/code>æ¥å–ä¸¤ä¸ªå…ƒç´ çš„æœ€å¤§å€¼ã€‚ä½†æ˜¯ï¼Œå¯¹äºåªå®ç°äº†&lt;code>IComparable&lt;/code>çš„ç±»ï¼Œæˆ‘ä»¬ä»ä¸èƒ½ä½¿ç”¨&lt;code>MyMax&amp;lt;T&amp;gt;&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å®ç°ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„&lt;code>MyMax&amp;lt;T&amp;gt;&lt;/code>å‡½æ•°ï¼Œæ¥åŒ¹é…&lt;code>IComparable&lt;/code>å’Œ&lt;code>IComparable&amp;lt;T&amp;gt;&lt;/code>ä¸¤ä¸ªä¸åŒçš„æ¥å£ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•é¢„çŸ¥ä¸€åˆ‡ï¼Œå‡å¦‚ä¸Šæ¸¸å›¢é˜Ÿä½¿ç”¨äº†ä¸€ä¸ªç§æœ‰çš„æ¯”è¾ƒæ¥å£ï¼Œæˆ–è€…ç›´æ¥ç¡¬ç¼–ç äº†&lt;code>CompareTo(other)&lt;/code>å‡½æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="ä»£ç ç”Ÿæˆçš„ä¼˜ç‚¹">ä»£ç ç”Ÿæˆçš„ä¼˜ç‚¹ &lt;a href="#%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90%e7%9a%84%e4%bc%98%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åˆ©ç”¨ä»£ç ç”Ÿæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥çªç ´ç¼–ç¨‹è¯­è¨€å¯¹æˆ‘ä»¬çš„é™åˆ¶ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç©·ä¸¾å¯èƒ½è¢«æ¯”è¾ƒçš„ç±»å‹ï¼Œç”Ÿæˆç›¸åº”çš„å‡½æ•°é‡è½½ï¼Œå®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯­è¨€çš„ä¸€äº›åŠ¨æ€ç‰¹æ€§æ¥ç»•è¿‡é™åˆ¶ï¼Œä½†æ˜¯åŠ¨æ€ç‰¹æ€§å¸¦æ¥çš„æ€§èƒ½æŸå¤±æ˜¯ä¸å¯å¿½ç•¥çš„ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œä»£ç ç”Ÿæˆå¯ä»¥è½»æ¾çš„ç”Ÿæˆå¤§æ®µçš„é‡å¤æ€§é€»è¾‘ä»£ç ï¼Œæ¯”å¦‚æ•°æ®è¡¨æŸ¥è¯¢ï¼Œä¸šåŠ¡æµç¨‹ç­‰ã€‚è¿™æ˜¯ä»£ç ç”Ÿæˆçš„ä¸å¯æ›¿ä»£çš„ç‰¹é•¿ã€‚&lt;/p>
&lt;h3 id="t4æ¨¡æ¿å¼•æ“">T4æ¨¡æ¿å¼•æ“ &lt;a href="#t4%e6%a8%a1%e6%9d%bf%e5%bc%95%e6%93%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>T4çš„å…¨ç§°æ˜¯â€œText Template Transformation Toolkitâ€ã€‚æ˜¯å¾®è½¯å‡ºå“çš„åŸºäºæ¨¡æ¿çš„æ–‡æœ¬ç”Ÿæˆæ¡†æ¶ï¼Œæœ€æ—©åœ¨VS2008ä¸­è¢«å¼•å…¥ã€‚&lt;/p>
&lt;p>T4å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥è¿›è¡Œç¼–ç ï¼ŒåŒ…æ‹¬C#, VB, F#ç­‰ï¼Œç›®æ ‡æ ¼å¼æ²¡æœ‰é™åˆ¶ã€‚&lt;/p>
&lt;p>å¯¹äºæ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šå±•å¼€ã€‚å¦å¤–ï¼Œæˆ‘æœ€å–œæ¬¢çš„å¼•æ“æ˜¯Jinja2ã€‚ï¼ˆ&lt;/p>
&lt;h3 id="codedom">CodeDOM &lt;a href="#codedom" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é€šå¸¸æ„ä¹‰ä¸Šçš„DOMæ˜¯ç”¨æ¥æè¿°æµè§ˆå™¨ä¸­å±•ç¤ºçš„å…ƒç´ ã€‚CodeDOMå’ŒDOMå®šä¹‰ç±»ä¼¼ï¼Œæ˜¯ç”¨æ¥æè¿°ä»£ç ä¸­çš„ç»“æ„çš„ã€‚&lt;/p>
&lt;p>CodeDOMæ¯”ä¸€èˆ¬çš„æ¨¡æ¿å¼•æ“è¦æ›´ä¸¥è°¨ï¼ŒåŒæ—¶æ˜¯è¯­è¨€æ— å…³çš„ï¼Œå³æ”¯æŒå°†ä¸€ä»½CodeDOMç”Ÿæˆä¸ºä¸åŒçš„è¯­è¨€ã€‚åŒæ—¶ï¼Œè¿˜æ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€çš„ç”Ÿæˆä»£ç ã€‚&lt;/p>
&lt;p>CodeDOMçš„åº”ç”¨å¾ˆå¹¿æ³›ï¼Œä¾‹å¦‚.NETä¸­çš„è¡¨è¾¾å¼æ ‘(expression treeï¼Œåä¼šä¸­ä¼šæåˆ°)ï¼Œä»¥åŠå‰æ–‡ä¸­æåˆ°çš„T4ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.CodeDom;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.CodeDom.Compiler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.IO;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.CSharp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.VisualBasic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeCompileUnit lUnit = &lt;span style="color:#66d9ef">new&lt;/span> CodeCompileUnit();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeNamespace lNamespace = &lt;span style="color:#66d9ef">new&lt;/span> CodeNamespace(&lt;span style="color:#e6db74">&amp;#34;MyNamespace&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lNamespace.Imports.Add(&lt;span style="color:#66d9ef">new&lt;/span> CodeNamespaceImport(&lt;span style="color:#e6db74">&amp;#34;System&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lNamespace.Imports.Add(&lt;span style="color:#66d9ef">new&lt;/span> CodeNamespaceImport(&lt;span style="color:#e6db74">&amp;#34;System.IO&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lUnit.Namespaces.Add(lNamespace);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeTypeDeclaration lClass = &lt;span style="color:#66d9ef">new&lt;/span> CodeTypeDeclaration(&lt;span style="color:#e6db74">&amp;#34;MyClass&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeMethodInvokeExpression lExpression = &lt;span style="color:#66d9ef">new&lt;/span> CodeMethodInvokeExpression(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">new&lt;/span> CodeTypeReferenceExpression(&lt;span style="color:#e6db74">&amp;#34;Console&amp;#34;&lt;/span>), &lt;span style="color:#e6db74">&amp;#34;WriteLine&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> CodePrimitiveExpression(&lt;span style="color:#e6db74">&amp;#34;hello world !&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lNamespace.Types.Add(lClass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeEntryPointMethod lMain = &lt;span style="color:#66d9ef">new&lt;/span> CodeEntryPointMethod();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lMain.Statements.Add(lExpression);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lClass.Members.Add(lMain);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> lDesktopPath = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory) + &lt;span style="color:#e6db74">@&amp;#34;\&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CodeGeneratorOptions lOptions = &lt;span style="color:#66d9ef">new&lt;/span> CodeGeneratorOptions();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lOptions.IndentString = &lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lOptions.BlankLinesBetweenMembers = &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// generate a C# source code file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CSharpCodeProvider lCSharpCodeProvider = &lt;span style="color:#66d9ef">new&lt;/span> CSharpCodeProvider();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> (StreamWriter lStreamWriter = &lt;span style="color:#66d9ef">new&lt;/span> StreamWriter(lDesktopPath + &lt;span style="color:#e6db74">&amp;#34;HelloWorld.cs&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lCSharpCodeProvider.GenerateCodeFromCompileUnit(lUnit, lStreamWriter, lOptions);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// generate a VB source code file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> VBCodeProvider lVBCodeProvider = &lt;span style="color:#66d9ef">new&lt;/span> VBCodeProvider();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> (StreamWriter lStreamWriter = &lt;span style="color:#66d9ef">new&lt;/span> StreamWriter(lDesktopPath + &lt;span style="color:#e6db74">&amp;#34;HelloWorld.vb&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVBCodeProvider.GenerateCodeFromCompileUnit(lUnit, lStreamWriter, lOptions);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”Ÿæˆçš„C#ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> MyNamespace {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">using&lt;/span> System.IO;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyClass&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;hello world !&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”Ÿæˆçš„VBä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vb" data-lang="vb">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Option Strict Off&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Option Explicit On&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Imports&lt;/span> System
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Imports&lt;/span> System.IO
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Namespace&lt;/span> MyNamespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">Public&lt;/span> &lt;span style="color:#66d9ef">Class&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">[&lt;/span>&lt;span style="color:#a6e22e">MyClass&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">Public&lt;/span> &lt;span style="color:#66d9ef">Shared&lt;/span> &lt;span style="color:#66d9ef">Sub&lt;/span> &lt;span style="color:#a6e22e">Main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;hello world !&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">End&lt;/span> &lt;span style="color:#66d9ef">Sub&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">End&lt;/span> &lt;span style="color:#66d9ef">Class&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">End&lt;/span> &lt;span style="color:#66d9ef">Namespace&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸æ¨¡æ¿å¼•æ“ç›¸æ¯”ï¼ŒCodeDOMæ›´å¤æ‚ï¼Œä¹Ÿæ›´ä¸ç›´è§‚ã€‚ä½†æ˜¯ç”±äºå®ƒçš„è¯­è¨€æ— å…³æ€§ï¼Œéå¸¸é€‚åˆç”¨æ¥ç”Ÿæˆä¸€äº›å·¥å…·ä»£ç ï¼Œæ¯”å¦‚SDKç­‰ã€‚&lt;/p>
&lt;h2 id="whats-next">What&amp;rsquo;s next? &lt;a href="#whats-next" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äº.NETå…ƒç¼–ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è¯é¢˜ï¼Œæ‰€ä»¥è¯»ä¹¦ç¬”è®°å†™ä¼šåšæˆä¸€ä¸ªå°ç³»åˆ—ä¸€ç¯‡ä¸€ç¯‡å‘å‡ºã€‚&lt;/p>
&lt;p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬ä¼šæ›´è¿›æ­¥ï¼Œè®¨è®ºILçº§åˆ«çš„ä»£ç ç”Ÿæˆã€‚&lt;/p>
&lt;h2 id="ä¸€äº›æµ‹è¯•ä»£ç ">ä¸€äº›æµ‹è¯•ä»£ç  &lt;a href="#%e4%b8%80%e4%ba%9b%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://code.wizmann.tk/Home/Code?guid=81cb583a-2498-4f2a-8eff-b17a1af9b5e5">&lt;code>max(a, b)&lt;/code> function with template in C++&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://code.wizmann.tk/Home/Code?guid=1a30e464-c08c-45bd-b9ca-da2675de19df">Generate code with CodeDOM&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://blogs.msdn.microsoft.com/csharpfaq/2004/03/12/how-do-c-generics-compare-to-c-templates/">How do C# generics compare to C++ templates?&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.pl-enthusiast.net/2014/08/05/type-safety/">What is type safety?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://csharphardcoreprogramming.wordpress.com/tag/codedom/">Reflection (part 5, professional), CodeDOM (&amp;amp; lambda expression tree)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Why do I quit Leetcode contest?</title><link>https://wizmann.top/posts/why-do-i-quit-leetcode-contest/</link><pubDate>Wed, 07 Jun 2017 01:53:42 +0000</pubDate><guid>https://wizmann.top/posts/why-do-i-quit-leetcode-contest/</guid><description>&lt;h2 id="foreword">Foreword &lt;a href="#foreword" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The title is quite &amp;ldquo;Yin-ish&amp;rdquo; as it seems, but I&amp;rsquo;m not a &amp;ldquo;Yin-ist&amp;rdquo;. You know what I mean.&lt;/p>
&lt;h2 id="why-i-quit">Why I quit? &lt;a href="#why-i-quit" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>I did a quite a good job in Leetcode Weekly Contest, at least in my point of view. I won a 4th place and a 6th place in my 19 contests, and my highest global ranking is 49th.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-6-7/15859142.jpg" alt="">&lt;/p>
&lt;p>It&amp;rsquo;s remarkable! According to all my poor results among all the online/offline programming contests, there is no reason for me to give up Leetcode contest which seems perfectly suitable for my capabilities.&lt;/p>
&lt;p>But I do make that decision. The quitting is of course not the kind of &amp;ldquo;throw in the towel&amp;rdquo; quitting, which is something I quite excel at, however. I quit because this contest lost its original meaning for all the contestants.&lt;/p>
&lt;p>Here I&amp;rsquo;m not criticizing the contest itself, because it&amp;rsquo;s still a fair and interesting contest for us to participate in. But there is always a significant distinction between the &amp;ldquo;programming contest problems&amp;rdquo; and &amp;ldquo;programming interview problems&amp;rdquo;.&lt;/p>
&lt;p>In programming contest, we are indifferent to the coding style, the extra time/memory space, testability and even the correctness. We come up with a theory, program it and submit it to the judging system, if there comes an &amp;ldquo;Accepted&amp;rdquo;. Boom! This is our happy ending.&lt;/p>
&lt;p>In real-world practise, it&amp;rsquo;s hard for the judging system to tell the differences between the time complexity &lt;code>O(n)&lt;/code> and &lt;code>O(n * logn)&lt;/code>, and the extra space complexity &lt;code>O(1)&lt;/code> and &lt;code>O(n)&lt;/code>. This is because the judging system can&amp;rsquo;t implement a strict restriction as there are always some kinds of differences between diffrent &amp;ldquo;correct&amp;rdquo; implementations, differnet progamming languages and diffrent compilers. To avoid hurting the &amp;ldquo;innocents&amp;rdquo;, the judging system can do nothing but turn a bind eye on some &amp;ldquo;less-good&amp;rdquo; solutions for the problems.&lt;/p>
&lt;p>But for the interviews, there are only several &amp;ldquo;correct answers&amp;rdquo; with least time complexity, least space complexity and least lines of codes. The interviewer wants you to implement the solution with the way he/she expected. There is no need to finish 4 problems in 15 minutes or less. What is actually wanted here is how you come up with your best solution, and how to prove the correctness and something else more to show that you are a equipped programmer for the company and for the team. And Leetcode contest leads us to a wrong way.&lt;/p>
&lt;p>Leetcode is famous because of it&amp;rsquo;s a set of programming interview problems. On average, the problems are too easy for a real programming contest like ACM-ICPC, Codeforces, Google Code Jam, etc. But the problems on Leetcode do have some subtle details which we should pay much attention during a programming interview. We just can&amp;rsquo;t make a juice from these two kinds of problems with a blender. It will only cultivate incapable contestants and incapable interviewees.&lt;/p>
&lt;p>So that&amp;rsquo;s my understanding of truth and the reason why I quit the series of contests.&lt;/p></description></item><item><title>STUP - the Implementation (3)</title><link>https://wizmann.top/posts/stup-3/</link><pubDate>Mon, 08 May 2017 22:15:58 +0000</pubDate><guid>https://wizmann.top/posts/stup-3/</guid><description>&lt;h2 id="throughput-and-window-size">throughput and window size &lt;a href="#throughput-and-window-size" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The wisdom of STUP protocol is all about the window size. The throughput of a TCP communication is limited by two windows: the congestion window and the receive window. The congestion window can determine how many bytes that can be send a simple piece of time, and the receive window indicates the capacity of the receiver to process data.&lt;/p>
&lt;p>Both windows influence the throughput of our connection. As the size of receive window is already set after 3-way handshake process, the congestion window is the critical influence. But why?&lt;/p>
&lt;p>TCP use congestion control to achieve high performance (really?) and avoid congestion collapse. But here in STUP, we have different situations.&lt;/p>
&lt;p>Firstly, we need real high performance. We don&amp;rsquo;t want the window size cut into half when there is a lost / timeout packet, which is very normal in our &amp;ldquo;long thin pipe&amp;rdquo;. Secondly, STUP is not a protocol for general usage, by the initial design, it should be used in an exclusive, non-production environment. So we don&amp;rsquo;t need to care about our neighbors, we can just use up a reserved, reasonable bandwidth.&lt;/p>
&lt;p>However, be aware of the number in &lt;code>Config.py&lt;/code>. Our router was down once because of a wrong configuration. :)&lt;/p>
&lt;h2 id="other-mechanisms-and-algorithms-in-stup">other mechanisms and algorithms in STUP &lt;a href="#other-mechanisms-and-algorithms-in-stup" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>Keep Alive&lt;/li>
&lt;li>Nagle algorithm&lt;/li>
&lt;li>Piggybacking&lt;/li>
&lt;li>Fast retransmission&lt;/li>
&lt;/ul>
&lt;p>These features are copied from TCP protocol and absolutely a clichÃ© to have a discuss here. If you have any problem about these, just look it up in Wikipedia.&lt;/p>
&lt;h2 id="twisted-twisted-framework">twisted Twisted Framework &lt;a href="#twisted-twisted-framework" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>STUP protocol takes me about a whole year to do the development work (and it&amp;rsquo;s not finished yet). But for more than half of the time, I was struggling with the Twisted framework. For people who want to learn more about Twisted Framework, you can read the &lt;a href="http://twistedmatrix.com/trac/wiki/Documentation">official manual&lt;/a> or look through &lt;a href="https://wizmann.top/twisted-defer-and-deferredqueue.html">this blog&lt;/a> for a quick start.&lt;/p>
&lt;p>What a pun!&lt;/p>
&lt;h2 id="future-of-stup">future of STUP &lt;a href="#future-of-stup" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Since STUP protocol is written in Python, one of the main problem is the performance. As a result, I&amp;rsquo;m planning to rewrite this with C++ (and golang, perhaps) to gain a better performance. I call it: STUPP (STUP in cpp).&lt;/p>
&lt;p>In STUPP, several features are to be added:&lt;/p>
&lt;ul>
&lt;li>Selective ACK&lt;/li>
&lt;li>Monotonic strictly increasing sequence number to prevent replay attacks&lt;/li>
&lt;li>Multiple socks5 connections share a single STUP connection&lt;/li>
&lt;/ul></description></item><item><title>STUP - Packet Structure and State Machine (2)</title><link>https://wizmann.top/posts/stup-2/</link><pubDate>Thu, 04 May 2017 00:53:03 +0000</pubDate><guid>https://wizmann.top/posts/stup-2/</guid><description>&lt;h2 id="stup-packet-structure">STUP Packet Structure &lt;a href="#stup-packet-structure" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="brief-introduction-of-tcp--udp-packet-structure">Brief Introduction of TCP &amp;amp; UDP Packet Structure &lt;a href="#brief-introduction-of-tcp--udp-packet-structure" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-4-24/73808256-file_1493006773118_a335.png" alt="">&lt;/p>
&lt;p>STUP pretend itself as a protocol at the Transmission Layer, but actually it&amp;rsquo;s absolutely an Application Layer protocol. So before we start, I&amp;rsquo;d like to recall some knowledge of two important Transmission Layer protocol: TCP &amp;amp; UDP.&lt;/p>
&lt;p>It is well known that TCP is a &amp;ldquo;connection-oriented&amp;rdquo;, &amp;ldquo;reliable&amp;rdquo;, &amp;ldquo;ordered&amp;rdquo;. To make an analogy (a little bit inappropriate), TCP is like a phone call (good cell signal strength):&lt;/p>
&lt;ol>
&lt;li>you are keeping a connection&lt;/li>
&lt;li>your words and sentences are well-received and well-ordered&lt;/li>
&lt;/ol>
&lt;p>As a result, each TCP packet has a unique and ordered sequence number, and your partner has to reply an &amp;ldquo;ACK&amp;rdquo; (short of &amp;ldquo;ACKnowledgement&amp;rdquo;) when it receive a packet. And it has to keep a connection and control the flow, a lot of control header is added to the header, so as the &amp;ldquo;window size&amp;rdquo;.&lt;/p>
&lt;p>In a word, TCP is a heavy-weight protocol which offers high reliability. But the performance is highly depend on the network condition.&lt;/p>
&lt;p>UDP is on the other way around, it&amp;rsquo;s &amp;ldquo;connectionless&amp;rdquo;, &amp;ldquo;unreliable&amp;rdquo; and &amp;ldquo;unordered&amp;rdquo;. To make another analogy, UDP is like a SMS message:&lt;/p>
&lt;ol>
&lt;li>there is no connection&lt;/li>
&lt;li>there is no guarantee that your partner will receive the message&lt;/li>
&lt;li>there is no guarantee of the order of messages, espiecially on a bad network&lt;/li>
&lt;/ol>
&lt;p>UDP is a lightweight protocol who doesn&amp;rsquo;t care about the connection and reliability, it just does it best to serve. And, of course, the performance is better than TCP.&lt;/p>
&lt;h3 id="stup-packet-structure--why">STUP Packet Structure &amp;amp; Why? &lt;a href="#stup-packet-structure--why" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>As I mentioned before, the only problem for me in TCP is the flow control. But that part is deep in the kernel, it is unnecessarily complicated to hack the kernel, a user application is good enough here for me.&lt;/p>
&lt;p>So, I build STUP over UDP to make everything simple. Firstly, UDP is a commonly used and well-known protocol, we can take advantages of existing infrastructure, framwork and libs. Secondly, UDP is lightweighted protocol, the overhead to build a new protocol over it is almost nothing.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-5-2/38201062-file_1493708415970_dc40.png" alt="">&lt;/p>
&lt;p>The chart above shows STUP packet structure. And the bits in green are plain-text and the others in red are encrypted.&lt;/p>
&lt;ul>
&lt;li>Random IV (16bits): plain text, used to assemble the encrypt key&lt;/li>
&lt;li>Version (3 bits): for compatibility use, currently is &amp;ldquo;000&amp;rdquo;&lt;/li>
&lt;li>Nonce (6 bits): indicate the length of random trail padding data, used for data confusion&lt;/li>
&lt;li>URG (1 bit): urgent flag, internal use&lt;/li>
&lt;li>LIV (1 bit): keep-alive flag&lt;/li>
&lt;li>ACK (1 bit): acknowledgement flag&lt;/li>
&lt;li>PSH (1 bit): temporarily prohibit nagle algorithm for this packet&lt;/li>
&lt;li>RST (1 bit): reset flag&lt;/li>
&lt;li>SYN (1 bit): sync flag&lt;/li>
&lt;li>FIN (1 bit): finalize flag&lt;/li>
&lt;li>Seq number (32 bits): same as TCP&lt;/li>
&lt;li>Ack number (32 bits): same as TCP&lt;/li>
&lt;/ul>
&lt;p>The structure of STUP packet is quite similar to TCP packet, because we are imitating TCP, literally.&lt;/p>
&lt;h3 id="data-obfuscation-of-stup-packets">Data obfuscation of STUP packets &lt;a href="#data-obfuscation-of-stup-packets" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>One of the most important part of STUP protocol is obfuscation. We try to hide our intend of the network traffic to bypass the G*W. Except obfuscate the data, we also need to hide some patterns, for example, the handshack process, ack mechanism, etc.&lt;/p>
&lt;p>The first step is encryption, of course. It can help us the hide the feature inside data, for example, the pattern of a HTTP request can be easily detected. We use AES-ECB to encrypt the content of our packet.&lt;/p>
&lt;p>But why AES-ECB? There are a lot of saying on the internet that AES-ECB sucks, because it leaks plaintext data patterns.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-5-2/19737252-file_1493708926479_15add.png" alt="">&lt;/p>
&lt;p>It is because we ecrypt the STUP packet &lt;strong>as a whole&lt;/strong>, it means there is no way to get the sequence number to order the packets before we decrypt it. As a solution, we add a &amp;ldquo;random IV&amp;rdquo; as a plain text in the STUP header. So the key to ecrypt is a combination of 48 bits pre-defined key and 16 bits random key. It might lead to a risk of small key space, but actually it&amp;rsquo;s more than enough to keep out traffic safe as we are not VIP who worth a brute force hacking.&lt;/p>
&lt;p>And still, there is another problem that we can&amp;rsquo;t hide the length information of our packet with a symmetric encryption. The solution is to append random padding bytes at the tail of every packets for data obfuscation, and use the &lt;code>nonce&lt;/code> field to mark the length of the paddings, then enrypt it. When receiver get the packets, firstly decrypt the packet, then drop the useless padding bytes and get the real data.&lt;/p>
&lt;h2 id="stup-state-machine">STUP State Machine &lt;a href="#stup-state-machine" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-4-24/70104484-file_1493025532333_338c.png" alt="">&lt;/p>
&lt;p>STUP state machine is also a simplify TCP state machine. And, in essence, they behave exactly the same.&lt;/p>
&lt;h2 id="whats-next">What&amp;rsquo;s next? &lt;a href="#whats-next" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>In next blog (maybe the last one for STUP series), we will talk about some details about the implementation, and future plan for this protocol.&lt;/p></description></item><item><title>STUP - another (stupid) TCP over UDP protocol (1)</title><link>https://wizmann.top/posts/stup-1/</link><pubDate>Thu, 20 Apr 2017 23:17:45 +0000</pubDate><guid>https://wizmann.top/posts/stup-1/</guid><description>&lt;h2 id="what-is-stup">What is STUP? &lt;a href="#what-is-stup" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>STUP is the abbreviation of &amp;ldquo;Speeded/Secure Tcp-like Udp Protocol&amp;rdquo;, which means that it&amp;rsquo;s another TCP over UDP protocol.&lt;/p>
&lt;p>Why TCP over UDP?&lt;/p>
&lt;p>TCP is a network protocol for general purpose, and it&amp;rsquo;s one of the most commonly used internet protocol on this planet. It is reliable, ordered and well optimized with decades of efforts.&lt;/p>
&lt;p>But, there&amp;rsquo;s plenty of reasons to replace that protocol for my scenario.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;del>Firstly, create my own network protocol is something geeky-nerdy, yep, suits me perfectly.&lt;/del>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Firstly, TCP is not &amp;ldquo;secure&amp;rdquo; (enough to bypass G*W). &lt;br>
Of course, it&amp;rsquo;s not TCP&amp;rsquo;s fault, because the security job is for the application layer. But &amp;ldquo;å¤§æ¸…è‡ªæœ‰å›½æƒ…åœ¨&amp;rdquo;, we are in urgent need for a secure network protocol to obfuscate our network packet to bypass the firewall to get access to the &amp;ldquo;free internet&amp;rdquo;. &lt;br>
Shado*socks is one of the commonly used &amp;ldquo;secure&amp;rdquo; network protocol which based on socks5 proxy protocol and TCP. But still, it has its own problem.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Secondly, TCP performs badly on harsh transmission condition. &lt;br>
Because of the flow control and congestion control, the sliding window of TCP will be cut into half when packet is lost or timeout, which is very common on a harsh network connection as the jitter is inevitable. &lt;br>
It&amp;rsquo;s understandble that TCP has to negotiate the sliding window size with zero knowledge to achieve intra- and inter- protocol fairness, and make a stable network. But for us, we may have enough knowledge for our network, and we may not have too many connections at the same time, so here we don&amp;rsquo;t need control, we need speed. We come up with our own control mechanism - no control is best the control.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="how-it-works">How it works? &lt;a href="#how-it-works" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-4-20/98249887-file_1492687602713_f658.png" alt="">&lt;/p>
&lt;p>Our local application behavess like a socks5 proxy client, and send its data to a local adapter which will translate socks5 packet into STUP packet. The adapter doesn&amp;rsquo;t need to understand the &amp;ldquo;meaning&amp;rdquo; of socks5 packets, it just take it as a byte-flow, then encapsulate the data into the STUP packet.&lt;/p>
&lt;p>The local STUP client will encrypt the outgoing UDP packet. More precisely, the job of the encryption is to obfuscate the packet to bypass the detector of the G*W. We will talk about this later.&lt;/p>
&lt;p>Then the remote STUP protocol server received the encrypted packet, then it unpack the data and translate it back into the same byte-flow. After that, the socks5 server will get the message and retrieve what we want from the free internet.&lt;/p>
&lt;p>In a word, STUP procotol is a secure tunnel between the socks5 client and socks5 server. This design reduces the complexity of the whole system, and make it easy to implement.&lt;/p>
&lt;h2 id="how-we-implement-it-big-picture">How we implement it? (Big picture) &lt;a href="#how-we-implement-it-big-picture" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>We use Twisted framework to implement our protocol. The good parts of twisted is it hides the details of network programming and turn everything into events. But twisted is aptly named and it is really &amp;ldquo;twisted&amp;rdquo;, especially for the new comers.&lt;/p>
&lt;p>We implemented our simplfied &amp;ldquo;TCP stack&amp;rdquo; with fixed-size sliding window, nagle algorithm, retry mechanism, encrypting, etc. But with the help of Python, one of my favorite programming language &amp;hellip; it&amp;rsquo;s still a complex task to do. And it takes me a year to make it work.&lt;/p>
&lt;p>I say thankya.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-4-20/89638264-file_1492701304939_10484.png" alt="">&lt;/p></description></item><item><title>WorkflowyMd Release Note</title><link>https://wizmann.top/posts/workflowymd/</link><pubDate>Thu, 26 Jan 2017 21:07:28 +0000</pubDate><guid>https://wizmann.top/posts/workflowymd/</guid><description>&lt;h2 id="what-is-it">What is it? &lt;a href="#what-is-it" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>I&amp;rsquo;ve writen several workflowy enhance plugins by UserScript. The very first one is show the full content of the note of a bullet. The second one is to show images under the bullet. Then I worked on the background image to make a more colorful workflowy.&lt;/p>
&lt;p>Yeah, workflowy is a powerful tool for noting and orgainizing your knowledge. And it is &lt;strong>FREE&lt;/strong>! (Say thankee) And the only drawback of this tool is the text format.&lt;/p>
&lt;p>In the original version of workflowy (without any plugins), we can only add plain text as note for a bullet. It&amp;rsquo;s, of course, less expressive than the rich text notes which we&amp;rsquo;re used to. But now, WorkflowyMd solve that problem.&lt;/p>
&lt;p>WorkflowyMd is a suite of usersciprt and stylesheet to enhance the original workflowy with Markdown support. As we know, markdown is one of the most popular lightweight markup language which can create rich text from plain text. We can add headers, images, table, list in the notes, and the original plain text can be fully synced to the server of workflowy.&lt;/p>
&lt;p>Here follows the detail and usage of WorkflowyMd.&lt;/p>
&lt;h2 id="markdown-support">Markdown support &lt;a href="#markdown-support" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>You have to add &lt;code>[md]&lt;/code> tag at the end of the bullet to let the plugin render your markdown note. If you delete the tag, your note will return to the plain text note.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-26/48097654-file_1485411968675_15abe.gif" alt="">&lt;/p>
&lt;h2 id="edit-mode">Edit mode &lt;a href="#edit-mode" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>If you want to edit your markdown note. There is no need to type and delete the &lt;code>[md]&lt;/code> tag every time. Just double click on the note, the notes will toggle between the markdown style (read-only) and plain text style (editable).&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-26/59010877-file_1485412203554_8eea.gif" alt="">&lt;/p>
&lt;h2 id="better-image-support">Better image support &lt;a href="#better-image-support" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>There always one annoy stuff about the image - the size. Sometimes the image size is too large for the page, and some oter time we need an image with full size so we can see every details in the image.&lt;/p>
&lt;p>Workflowy solve the problem. The image will be displayed in the style &lt;code>max-width: 20%&lt;/code> by default. And on a double click, the image will scale to &lt;code>max-width: 100%&lt;/code> for us to show the details.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-26/95527913-file_1485412578590_104ab.gif" alt="">&lt;/p>
&lt;h2 id="syntax-highlight">Syntax Highlight &lt;a href="#syntax-highlight" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>This is the killer feature for this plugin. Syntax highlight! No more explain, let me show you!&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-26/104624-file_1485412763869_931a.gif" alt="">&lt;/p>
&lt;h2 id="get-the-code">Get the code &lt;a href="#get-the-code" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>JS: &lt;a href="https://github.com/Wizmann/Utils/blob/master/UserScript/WorkflowyMd.js">https://github.com/Wizmann/Utils/blob/master/UserScript/WorkflowyMd.js&lt;/a>&lt;/p>
&lt;p>CSS: &lt;a href="https://github.com/Wizmann/Utils/blob/master/UserScript/WorkflowyMd.css">https://github.com/Wizmann/Utils/blob/master/UserScript/WorkflowyMd.css&lt;/a>&lt;/p>
&lt;p>This plugin might conflict with my previous plugins, and I strongly recommand you to drop the previous versions.&lt;/p>
&lt;p>If there are bugs in the plguin, please feel free to contact me. (Or you can fix it yourself, it&amp;rsquo;s easy)&lt;/p>
&lt;h2 id="thanks">Thanks &lt;a href="#thanks" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>This work based on TamperMonkey and Stylish. These two are both commonly used Chrome extension which are easy to get in Chrome App Store. Also, &amp;ldquo;Markdown-it&amp;rdquo; is used here for render the markdown notes and &amp;ldquo;Highlight.js&amp;rdquo; is used to highlight the source code. And of course, thanks to jQuery to make everything simple.&lt;/p>
&lt;p>Have fun with workflowy and WorkflowyMd!&lt;/p>
&lt;h2 id="special-thanks">Special Thanks &lt;a href="#special-thanks" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Special thanks to Bach and Glenn Gould. :)&lt;/p></description></item><item><title>Parallel patterns in C#</title><link>https://wizmann.top/posts/parallel-in-csharp/</link><pubDate>Sun, 22 Jan 2017 22:52:28 +0000</pubDate><guid>https://wizmann.top/posts/parallel-in-csharp/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸C/C++æ‰€ä½¿ç”¨çš„ï¼Œä¼ ç»Ÿçš„åŸºäºçº¿ç¨‹çš„å¹¶è¡Œæ¨¡å¼ä¸åŒï¼ŒC#å®ç°äº†ä¸°å¯Œçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œå…¶ä¸­ä»¥å¼‚æ­¥æ¨¡å‹æœ€ä¸ºæµè¡Œã€‚&lt;/p>
&lt;p>æœ¬æ–‡ä¸­æˆ‘ä»¬é‡ç‚¹è®¨è®ºC#åœ¨å‘å±•è¿‡ç¨‹ä¸­å‡ºç°çš„å‡ ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Async Programming Modelï¼ˆAPMï¼‰&lt;/li>
&lt;li>Event-based Async Pattern (EAP)&lt;/li>
&lt;li>Task-based Async Patternï¼ˆTAPï¼‰&lt;/li>
&lt;li>async/awaitè¯­æ³•ç³–&lt;/li>
&lt;/ul>
&lt;h2 id="å¼‚æ­¥ç¼–ç¨‹å…¥é—¨">å¼‚æ­¥ç¼–ç¨‹å…¥é—¨ &lt;a href="#%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%e5%85%a5%e9%97%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åŒæ­¥æ¨¡å¼æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€è¢«äººç†ŸçŸ¥çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚&lt;/p>
&lt;p>å¼‚æ­¥ç¼–ç¨‹å’ŒåŒæ­¥ç¼–ç¨‹ä¸åŒï¼Œç¨‹åºçš„æ‰§è¡Œæµç¨‹æ˜¯ç”±â€œäº‹ä»¶â€æ‰€é©±åŠ¨çš„ã€‚å¼‚æ­¥ç¼–ç¨‹æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œå›è°ƒä¸futureæ¨¡å¼ã€‚&lt;/p>
&lt;p>å›è°ƒå‡½æ•°åœ¨Javascriptä¸­è¢«å¤§é‡ä½¿ç”¨ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ä¸ä¼šé™Œç”Ÿã€‚ä½†æ˜¯å¤§é‡çš„å›è°ƒå‡½æ•°ä¼šè®©ä»£ç å¤±å»å¯è¯»æ€§ï¼Œé™·å…¥â€œCallback hellâ€ã€‚&lt;/p>
&lt;p>Promiseæ¨¡å¼æ˜¯å›è°ƒå‡½æ•°çš„ä¸€ç§â€œåŒ…è£…â€ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦æ¥è¡¨ç¤ºâ€œæœªæ¥â€å°†ä¼šäº§ç”Ÿçš„ä¸€ä¸ªå¼‚æ­¥å¤„ç†ç»“æœã€‚&lt;/p>
&lt;p>è¿™ä¸ªå ä½ç¬¦åœ¨ä¸åŒçš„è¯­è¨€/æ¡†æ¶é‡Œé¢æœ‰ä¸åŒçš„åå­—ï¼Œå…¶å®šä¹‰ä¹Ÿä¸å°½ç›¸åŒï¼š&lt;/p>
&lt;ul>
&lt;li>Task - C#&lt;/li>
&lt;li>Deferred - Python Twisted&lt;/li>
&lt;li>Promise - Javascript&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä»»åŠ¡ç»“æŸåï¼Œä¼šè§¦å‘ç»‘å®šåœ¨è¿™ä¸ªå ä½ç¬¦ä¸Šå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œç»§ç»­é¢„å®šä¹‰å¥½çš„é€»è¾‘ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŒæ­¥æ¨¡å‹å°±æ˜¯ä½ ï¼š&lt;/p>
&lt;p>å®…å®¶æƒ³åƒé¥­ -&amp;gt; ä¸‹æ¥¼ä¹°é¥­ -&amp;gt; ä¸Šæ¥¼ -&amp;gt; åƒé¥­ -&amp;gt; æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ã€‚&lt;/p>
&lt;p>è€Œå¼‚æ­¥æ¨¡å‹å‘¢ï¼Œå°±æ˜¯ï¼š&lt;/p>
&lt;p>å®…å®¶æƒ³åƒé¥­ -&amp;gt; æ‰‹æœºå«å¤–å– -&amp;gt; æ‹¿åˆ°äº†å¤–å–å®šå•ï¼ˆæ‹¿åˆ°å ä½ç¬¦ æˆ– æ³¨å†Œå›è°ƒï¼‰-&amp;gt; æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ -&amp;gt; å¤–å–å°å“¥æŠŠé¥­é€ä¸Šé—¨ï¼ˆå¯åŠ¨å›è°ƒï¼‰ -&amp;gt; åƒé¥­ -&amp;gt; ç»§ç»­æ‰“æ¸¸æˆçœ‹æ¼‚äº®å°å§å§ã€‚&lt;/p>
&lt;p>è™½ç„¶ä»ä¸Šé¢çœ‹ï¼Œå¼‚æ­¥æ¨¡å‹æ¯”åŒæ­¥æ¨¡å‹è¦å¤æ‚ä¸€äº›ã€‚ä½†æ˜¯å®ƒå´èŠ‚çœäº†è€—æ—¶çš„â€œä¸Šä¸‹æ¥¼ä¹°é¥­â€çš„æ—¶é—´ï¼Œè®©ä½ å¯ä»¥åˆ†é…æ›´å¤šçš„æ—¶é—´ç”¨æ¥çœ‹æ¼‚äº®å°å§å§ã€‚è¿™å’Œæˆ‘ä»¬å†™ç¨‹åºæ—¶çš„æ€è·¯æ˜¯ä¸€è‡´çš„ï¼ŒèŠ‚çœåŠ¨è¾„åå‡ å‡ åæ¯«ç§’è€—æ—¶çš„IOæ—¶é—´ï¼Œå°†æ›´å¤šçš„æ—¶é—´ç”¨åœ¨CPUä¸Šã€‚&lt;/p>
&lt;h2 id="thread-based-parallel">Thread Based Parallel &lt;a href="#thread-based-parallel" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åŸºäºçº¿ç¨‹çš„å¹¶å‘æ¨¡å‹æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„å¹¶å‘æ¨¡å‹äº†ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæ”¯æŒã€‚C#ä¸­Threadçš„ç”¨æ³•ä¸Javaç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšå±•å¼€ã€‚&lt;/p>
&lt;p>ä¸æ­¤åŒæ—¶ï¼ŒC#è¿˜æ”¯æŒThread poolï¼Œç”¨æ¥è¿è¡Œ&amp;quot;long-running processor-bound tasks&amp;quot;ã€‚&lt;/p>
&lt;p>ç›´æ¥æ“ä½œçº¿ç¨‹ä¹Ÿè®¸æ˜¯ä¸­å¹´ç¨‹åºå‘˜çš„å¿…ä¿®è¯¾ï¼Œä½†æ˜¯æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ä¼šç»™ç¨‹åºå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ã€‚æ‰€ä»¥å„ç§æ¨¡å‹ä¸æ¡†æ¶åº”è¿è€Œç”Ÿï¼Œè¯•å›¾é™ä½å¹¶å‘ç¼–ç¨‹çš„å¤æ‚åº¦ã€‚&lt;/p>
&lt;h2 id="async-programming-model-apm">Async Programming Model (APM) &lt;a href="#async-programming-model-apm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„async/awaitè¯­æ³•ç³–å‡ºç°ä¹‹å‰ï¼ŒC#ä¸­ä½¿ç”¨APMæ¥è¡¨ç¤ºå¼‚æ­¥æ“ä½œã€‚è™½ç„¶è¿™æ˜¯ä¸€ç§ä¸Šå¤æ—¶æœŸçš„å›è°ƒæ¨¡å¼è¯­æ³•ï¼Œä½†æ˜¯ç°åœ¨æœ‰å¾ˆå¤šåº“ä»æ—§æ”¯æŒè¿™ç§é£æ ¼ã€‚å¦‚Azure Storage SDKä¸­çš„&lt;code>CloudTable.BeginExecute&lt;/code>ç­‰ä¸€ç³»åˆ—å‡½æ•°ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨APMæ¨¡å¼çš„ä»£ç èŒƒä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Runtime.Remoting.Messaging;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Runtime.Remoting.Proxies;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">delegate&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> AsyncInvoke();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> SI = &lt;span style="color:#66d9ef">new&lt;/span> AsyncInvoke(MyCall);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> ar = SI.BeginInvoke(MyCallback, &lt;span style="color:#66d9ef">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main()&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (!ar.AsyncWaitHandle.WaitOne(&lt;span style="color:#ae81ff">1000&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main() waiting...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main() done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MyCall()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i = &lt;span style="color:#ae81ff">0&lt;/span>; i &amp;lt; &lt;span style="color:#ae81ff">5&lt;/span>; i++)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;running...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">500&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> MyCallback(IAsyncResult iResult)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> result = iResult &lt;span style="color:#66d9ef">as&lt;/span> AsyncResult;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> si = (AsyncInvoke) result.AsyncDelegate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ret = si.EndInvoke(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(ret);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-19/26234044-file_1484828912411_150f3.gif" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p>
&lt;ol>
&lt;li>æˆ‘ä»¬å°†&lt;code>MyCall()&lt;/code>â€œåŒ…è£…â€åœ¨ä¸€ä¸ª&lt;code>delegate&lt;/code>ä¸­ï¼Œç„¶åè°ƒç”¨&lt;code>BeginInvoke&lt;/code>å‡½æ•°å®ç°å¼‚æ­¥æ‰§è¡Œã€‚è¿™ä¸ªdelegateçš„æ‰§è¡Œä¸ä¼šé˜»å¡main threadã€‚&lt;/li>
&lt;li>ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„&lt;code>delegate&lt;/code>å¯ä»¥æœ‰ä¸€ä¸ªå›è°ƒï¼Œè¿™ä¸ªå›è°ƒåœ¨delegateæ‰§è¡Œå®Œåè¢«è§¦å‘ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬å¯ä»¥&amp;quot;long-polling&amp;quot;ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨æ‰§è¡Œå®Œã€‚è¿™é‡Œçš„â€œæ‰§è¡Œå®Œâ€ä¸åŒ…æ‹¬æ¡ç›®2æåˆ°çš„å›è°ƒï¼ˆå°å¿ƒrace conditionï¼ï¼‰ã€‚&lt;/li>
&lt;li>å¼‚æ­¥æ‰§è¡Œçš„ç»“æœå¯ä»¥é€šè¿‡&lt;code>delegate.EndInvoke(IAsyncResult)&lt;/code>å‡½æ•°è·å–åˆ°å¼‚æ­¥è°ƒç”¨çš„ç»“æœã€‚&lt;/li>
&lt;li>ç”±æ¡ç›®3æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨callbackå‡½æ•°ä¸­è·å–å¼‚æ­¥è°ƒç”¨çš„ç»“æœæ˜¯æœ€åˆé€‚çš„ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥APMé£æ ¼çš„ä»£ç å†™èµ·æ¥éå¸¸åƒjavascriptä¸­çš„å›è°ƒå†™æ³•ï¼Œå¦‚æœé€»è¾‘å¤æ‚çš„è¯ï¼Œç»´æŠ¤èµ·æ¥ä¼šæ˜¯ä¸€ä¸ªå¤§å‘ã€‚&lt;/p>
&lt;h2 id="event-asynchronous-pattern-eap">Event Asynchronous Pattern (EAP) &lt;a href="#event-asynchronous-pattern-eap" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>EAPæ˜¯å›è°ƒå‡½æ•°çš„å¦ä¸€ç§å°è£…ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.ComponentModel;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">StringEventArgs&lt;/span> : EventArgs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> Content { &lt;span style="color:#66d9ef">get&lt;/span>; &lt;span style="color:#66d9ef">set&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">event&lt;/span> EventHandler&amp;lt;StringEventArgs&amp;gt; _eventHandler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> Solution()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler += Handle1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler += Handle2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Run()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _eventHandler?.Invoke(&lt;span style="color:#66d9ef">this&lt;/span>, &lt;span style="color:#66d9ef">new&lt;/span> StringEventArgs()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Content = &lt;span style="color:#e6db74">&amp;#34;123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> Handle1(&lt;span style="color:#66d9ef">object&lt;/span> sender, StringEventArgs args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Handle1 &amp;#34;&lt;/span> + args.Content);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> Handle2(&lt;span style="color:#66d9ef">object&lt;/span> sender, StringEventArgs args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Handle2 &amp;#34;&lt;/span> + args.Content);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Solution sol = &lt;span style="color:#66d9ef">new&lt;/span> Solution();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sol.Run();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/17-1-20/46892581-file_1484911655343_68ae.gif" alt="">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ‰§è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šã€‚å¹¶ä¸”&lt;code>Handle1&lt;/code>å’Œ&lt;code>Handle2&lt;/code>é¡ºåºæ‰§è¡Œã€‚&lt;/p>
&lt;p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬fire eventçš„ä»£ç å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œä¹‹å&lt;code>EventHandler&lt;/code>ï¼Œä¹Ÿå°±æ˜¯callbackå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚&lt;/p>
&lt;p>EventåŒæ—¶æ”¯æŒ&lt;code>BeginInvoke&lt;/code>å’Œ&lt;code>EndInvoke&lt;/code>å‡½æ•°ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¼‚æ­¥çš„fireç›¸åº”çš„å›è°ƒã€‚ä½†æ˜¯æ³¨æ„æ­¤æ—¶æˆ‘ä»¬åªèƒ½æ³¨å†Œå”¯ä¸€çš„å›è°ƒï¼Œå› ä¸º&lt;code>BeginInvoke&lt;/code>åªèƒ½æœ‰ä¸€ä¸ªç›®æ ‡å›è°ƒï¼ˆåŸç†ï¼šåœ¨åŒä¸€æ—¶é—´åŒä¸€çº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼‰ã€‚&lt;/p>
&lt;h2 id="task-asynchronous-pattern-tap">Task Asynchronous Pattern (TAP) &lt;a href="#task-asynchronous-pattern-tap" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨.NET 4.0ï¼ˆç°åœ¨å·²ç»åˆ°6.0äº†å“¦ï¼‰ï¼ŒC#å¼•å…¥äº†TPLï¼ŒTask Parallel Libraryã€‚Taskçš„ç›®æ ‡æ˜¯ç»Ÿä¸€C#ä¸­çš„ä¸åŒå¼‚æ­¥ç¼–ç¨‹é£æ ¼ã€‚&lt;/p>
&lt;p>TPLä¸­çš„Taskéå¸¸åƒJSä¸­çš„promiseå’Œtwistedä¸­çš„deferredï¼Œæ˜¯â€œæœªæ¥ä¼šå®Œæˆçš„æ“ä½œçš„ç»“æœâ€çš„å ä½ç¬¦ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µç®€å•ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Task t = Task.Run(() =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Task start&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">2000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Task end&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (!t.IsCompleted)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Main(): Task is running...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">1000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Done&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç æˆ‘ä»¬å‰é¢æåˆ°çš„APMå’ŒEAPé£æ ¼çš„ä»£ç æœ‰æ˜æ˜¾çš„ä¸åŒï¼ŒTAPæ›´æ˜“è¯»ï¼Œå¹¶ä¸”ä¿æŒäº†æ§åˆ¶æµçš„å®Œæ•´æ€§ã€‚ä¸åƒAPMéœ€è¦åœ¨&lt;code>EndInvoke&lt;/code>å‡½æ•°ä¸­è·å–è¿”å›å€¼ä»¥åŠè¿›è¡Œåç»­æ“ä½œï¼Œä¹Ÿä¸åƒEAPä¸€æ ·éœ€è¦æ ¹æ®ä¸åŒçš„eventå£°æ˜ä¸åŒçš„å›è°ƒã€‚&lt;/p>
&lt;p>Taskä¹Ÿå¯èƒ½â€œä¸²èµ·æ¥â€ï¼Œå®ç°å¤šçº§å›è°ƒçš„æœºåˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Text;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> ConsoleApplication4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t0 = Task.Run(() =&amp;gt; &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t1 = t0.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t2 = t1.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> t3 = t2.ContinueWith((antecedent) =&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(antecedent.Result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> antecedent.Result + &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.ReadLine();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå›è°ƒå†™æˆä¸€æ£µæ ‘çŠ¶ç»“æ„ï¼Œç„¶åä¸€å±‚ä¸€å±‚çš„æ‰§è¡Œï¼Œä¸è¿‡ç”Ÿå‘½æ˜¯å¦‚æ­¤å®è´µï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å……åˆ†çš„ç†ç”±è¦è¿™ä¹ˆåšã€‚&lt;/p>
&lt;h2 id="asyncawaitè¯­æ³•ç³–">async/awaitè¯­æ³•ç³– &lt;a href="#asyncawait%e8%af%ad%e6%b3%95%e7%b3%96" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>async/awaitè¯­æ³•ç³–åœ¨C# 5.0ä¸­è¢«å¼•å…¥ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†é¿å…å›è°ƒå¸¦æ¥çš„ä»£ç å¤æ‚åº¦ã€‚å°±åƒTwistedä¸­çš„&lt;code>@inlineCallbacks&lt;/code>ä¸€æ ·ï¼Œçœå»äº†deferå¤æ‚çš„å›è°ƒé“¾ã€‚&lt;/p>
&lt;p>&lt;code>await&lt;/code>ä¸­æœ‰ä¸€ä¸ª&amp;quot;wait&amp;quot;ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªâ€œç­‰å¾…â€æ“ä½œã€‚å®ƒç­‰å¾…çš„æ˜¯ç›¸åº”çš„Taskæ‰§è¡Œå®Œæˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> DumpWebPageAsync(&lt;span style="color:#66d9ef">string&lt;/span> uri)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebClient webClient = &lt;span style="color:#66d9ef">new&lt;/span> WebClient();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> page = &lt;span style="color:#66d9ef">await&lt;/span> webClient.DownloadStringTaskAsync(uri);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(page);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä»£ç æ‰§è¡Œåˆ°&lt;code>await&lt;/code>ä¸€è¡Œæ—¶ï¼Œå½“å‰å‡½æ•°ä¼šä¸»åŠ¨æ”¾å¼ƒå½“å‰çš„æ§åˆ¶æµã€‚å½“ä½¿ç”¨&lt;code>await&lt;/code>ä¿®é¥°çš„Taskå®Œæˆåï¼Œå½“å‰å‡½æ•°ä¼šä»ä¹‹å‰ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>è¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å†™å‡ºå’ŒåŒæ­¥ç‰ˆæœ¬éå¸¸ç›¸ä¼¼çš„å¼‚æ­¥ä»£ç ï¼Œåªéœ€è¦åœ¨å¿…é¡»çš„åœ°æ–¹åŠ ä¸Š&lt;code>await&lt;/code>å…³é”®å­—ï¼Œæé†’ç¼–è¯‘å™¨è¿™é‡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œéœ€è¦é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œä½†è¿™ä¸€åˆ‡éƒ½æ˜¯å¯¹å¼€å‘è€…é€æ˜çš„ã€‚&lt;/p>
&lt;h3 id="asyncawaitå¹²äº†ä»€ä¹ˆ">async/awaitå¹²äº†ä»€ä¹ˆ &lt;a href="#asyncawait%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æƒ³å¼„æ¸…æ¥šasync/awaitåˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œé¦–å…ˆæˆ‘ä»¬è¦æƒ³æ˜ç™½çº¿ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆã€å¹²äº†ä»€ä¹ˆã€‚&lt;/p>
&lt;p>çº¿ç¨‹æ˜¯è¿›ç¨‹å†…ä¸€æ¡æ‰§è¡Œæµçš„çŠ¶æ€ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ç¡¬ä»¶çŠ¶æ€ï¼ˆIPã€Registersç­‰ï¼‰ä»¥åŠå †æ ˆï¼ˆæ ˆä¸Šçš„å±€éƒ¨å˜é‡å’Œå †ä¸Šçš„è¿›ç¨‹çº§å†…å­˜ï¼‰ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³å®ç°æŒ‚èµ·/å¯åŠ¨ï¼ˆHibernating and Resumingï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ä¿å­˜å½“å‰çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å½“ä½ å†™ä¸‹äº†async/awaitå…³é”®å­—åï¼Œç¼–è¯‘å™¨åœ¨åé¢å¸®åŠ©ä½ ç”Ÿæˆäº†çŠ¶æ€ä¿å­˜å’Œæ¢å¤è¿è¡Œä¸Šä¸‹æ–‡çš„ä»£ç ã€‚&lt;/p>
&lt;h3 id="asyncawaitåˆ°åº•å¹²äº†ä»€ä¹ˆ">async/awaitåˆ°åº•å¹²äº†ä»€ä¹ˆ &lt;a href="#asyncawait%e5%88%b0%e5%ba%95%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æƒ³åƒæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤æ‚çš„asyncå‡½æ•°ï¼Œé‡Œé¢æœ‰å¾ˆå¤šä¸ªawaitè°ƒç”¨ï¼Œé‚£å°±æ„å‘³ç€è¿™ä¸ªå‡½æ•°ä¸­ä¼šæœ‰å¤šæ¬¡æŒ‚èµ·/ç»§ç»­æ“ä½œã€‚åŒæ—¶æˆ‘ä»¬è¿˜è¦ç»´æŠ¤è¿™ä¸ªå‡½æ•°çš„çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬æ˜¯è¿™ä¸ªè¯­æ³•ç³–çš„è®¾è®¡è€…ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ€ä¹ˆæ ·çš„æ‰‹æ®µæ¥å¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ˜¯çš„ï¼ŒçŠ¶æ€æœºã€‚async/awaité¿å…äº†ä»£ç çš„ç¢ç‰‡åŒ–ï¼Œå®ƒçš„è§£å†³æ–¹æ¡ˆå¹¶ä¸æ˜¯æ¶ˆç­äº†å›è°ƒå‡½æ•°å’ŒContinuation Tasksï¼Œè€Œæ˜¯ä½¿ç”¨å·¥å…·ï¼ˆç¼–è¯‘å™¨ï¼‰æ¥å¸®åŠ©äººç±»è¿›è¡Œé‡å¤åŠ³åŠ¨ã€‚å½“asyncå‡½æ•°ä»æŒ‚èµ·ä¸­æ¢å¤æ—¶ï¼Œä¼šè°ƒç”¨&lt;code>MoveNext&lt;/code>å‡½æ•°ï¼ˆç›¸ä¿¡çœ‹è¿‡asyncå‡½æ•°é‚£ä¸€é•¿ä¸²çš„tracebackçš„åŒå­¦è‚¯å®šå¯¹è¿™ä¸ªå‡½æ•°éå¸¸çœ¼ç†Ÿï¼‰ï¼Œ&lt;code>MoveNext&lt;/code>å‡½æ•°ä¼šåœ¨asyncå‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨ä»¥åŠä»æŒ‚èµ·ä¸­æ¢å¤æ—¶è¢«è°ƒç”¨ã€‚çŠ¶æ€æœºä¿å­˜äº†å½“å‰å‡½æ•°çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå½“&lt;code>MoveNext&lt;/code>å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šæ ¹æ®å½“å‰çŠ¶æ€æ¥åˆ¤æ–­æ¥ä¸‹æ¥æ‰§è¡Œä»€ä¹ˆä»£ç ã€‚&lt;/p>
&lt;h3 id="asycnawaitåˆ°åº•tmdå¹²äº†ä»€ä¹ˆ">asycn/awaitåˆ°åº•TMDå¹²äº†ä»€ä¹ˆ &lt;a href="#asycnawait%e5%88%b0%e5%ba%95tmd%e5%b9%b2%e4%ba%86%e4%bb%80%e4%b9%88" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºasync/awaicè¯­æ³•ç³–æ˜¯åœ¨ç¼–è¯‘æœŸæ‰è¢«ç¿»è¯‘æˆç›¸åº”çš„ç¨‹åºä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä½¿ç”¨ILåç¼–è¯‘å™¨æ¥çª¥æ¢ç¼–è¯‘å™¨åˆ°åº•åšäº†æ€æ ·çš„å¤„ç†ä¸ä¼˜åŒ–ã€‚ä¸è¿‡åç¼–è¯‘å™¨ä½ æ‡‚å¾—ï¼Œç”Ÿæˆçš„ä»£ç åŸºæœ¬æ²¡æ³•çœ‹ï¼Œè®²è§£èµ·æ¥ä¹Ÿä¼šéå¸¸æ™¦æ¶©ã€‚&lt;/p>
&lt;p>å¹¸å¥½åœ¨99%çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦çŸ¥é“async/awaitæ˜¯æ€æ ·è¢«å±•å¼€çš„ã€‚å¦‚æœä½ ç¡®å®å¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š&lt;a href="https://www.codeproject.com/Articles/535635/Async-Await-and-the-Generated-StateMachine">Async Await and the Generated StateMachine&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å‡ ä¸ªå¸¸è§çš„å‘">å‡ ä¸ªå¸¸è§çš„å‘ &lt;a href="#%e5%87%a0%e4%b8%aa%e5%b8%b8%e8%a7%81%e7%9a%84%e5%9d%91" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="await-ä¸-é”">await ä¸ é” &lt;a href="#await-%e4%b8%8e-%e9%94%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äºawaitä¼šä¸­æ–­å½“å‰å‡½æ•°åœ¨å½“å‰çº¿ç¨‹çš„æ‰§è¡Œæµï¼Œå¹¶ä¸”å¯èƒ½åœ¨æ¢å¤æ—¶ï¼Œè¢«æŒ‡æ´¾åˆ°å¦å¤–çš„çº¿ç¨‹ã€‚æ‰€ä»¥å¯¹awaitåŠ é”æ˜æ˜¾æ˜¯å¤šæ­¤ä¸€ä¸¾çš„ã€‚å¹¶ä¸”å¦‚æœæ“ä½œä¸å½“ï¼Œè¿˜ä¼šé€ æˆæ­»é”ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠawaitæ”¾åˆ°åŠ é”çš„åŒºåŸŸå¤–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">lock&lt;/span> (sync)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Prepare for async operation&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> myNum = &lt;span style="color:#66d9ef">await&lt;/span> AlexsMethodAsync();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">lock&lt;/span> (sync)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Use result of async operation&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="there-is-an--unfired-task-between-us">&amp;ldquo;There is an &amp;hellip; unfired Task between us&amp;rdquo; &lt;a href="#there-is-an--unfired-task-between-us" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸€ä¸ªasyncå‡½æ•°å¦‚æœè¿”å›çš„æ˜¯Taskï¼Œé‚£ä¹ˆå®ƒè¿”å›çš„ä¸€å®šæ˜¯ä¸€ä¸ªhot taskï¼Œå³å·²ç»è¢«å¯åŠ¨äº†çš„Taskã€‚&lt;/p>
&lt;p>å¹¶ä¸”awaitåªå¯èƒ½ç­‰å¾…ä¸€ä¸ªå¯åŠ¨äº†çš„Taskï¼Œå¦åˆ™awaitæ“ä½œå°†ä¼šhangä½ï¼Œç ´åç¨‹åºæ—¢å®šçš„æ‰§è¡Œæµã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨tpl-task-parallel-library">ä½¿ç”¨TPL (Task parallel library) &lt;a href="#%e4%bd%bf%e7%94%a8tpl-task-parallel-library" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Async methods are synchronous util needed.&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æ‰§è¡Œå‡ ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½¿ç”¨foræ¥éå†æ‰§è¡Œå¯ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å› ä¸ºè¿™æ ·å‡½æ•°æ‰§è¡Œæµä»ç„¶æ˜¯é¡ºåºæ‰§è¡Œç›¸åº”çš„å‡½æ•°ã€‚&lt;/p>
&lt;p>TPLæä¾›äº†&lt;code>WhenAll&lt;/code>ã€&lt;code>WhenAny&lt;/code>ç­‰å‡½æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥æœ‰å¼¹æ€§çš„å¹¶å‘æ‰§è¡ŒTaskã€‚&lt;/p>
&lt;p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨PLINQï¼Œä¸è¿‡è¿™å°±æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://www.codeproject.com/Articles/535635/Async-Await-and-the-Generated-StateMachine">Async Await and the Generated StateMachine&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://blog.stephencleary.com/2012/07/async-interop-with-iasyncresult.html">Async Interop with IAsyncResult&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://msdn.microsoft.com/en-us/library/wewwczdw(v=vs.110).aspx">Event-based Asynchronous Pattern Overview&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.safaribooksonline.com/library/view/async-in-c/9781449337155/">Async in C# 5.0&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.safaribooksonline.com/library/view/essential-c-60/9780134176147/">Essential C# 6.0&lt;/a> Cpt18&lt;/li>
&lt;/ul></description></item><item><title>Twisted Defer and DeferredQueue</title><link>https://wizmann.top/posts/twisted-defer-and-deferredqueue/</link><pubDate>Sat, 10 Dec 2016 11:34:38 +0000</pubDate><guid>https://wizmann.top/posts/twisted-defer-and-deferredqueue/</guid><description>&lt;h2 id="å†™åœ¨æœ€å‰é¢">å†™åœ¨æœ€å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ç¯‡æ–‡ç« æœ¬æ¥æ˜¯æƒ³ç”¨è‹±æ–‡å†™çš„ï¼Œä½†æ˜¯æœ€è¿‘è‹±æ–‡æ°´å¹³ä¸‹é™çš„å’Œç‹—ä¸€æ ·ã€‚è¿˜æ˜¯æ€‚ä¸€æ³¢å§ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ€è¿‘åœ¨ç”¨Twistedåº“å†™ä¸€ä¸ªè¯¡å¼‚çš„é¡¹ç›®ï¼Œå…·ä½“å†…å®¹æš‚ä¸”ä¸åœ¨è¿™é‡Œè®¨è®ºã€‚åœ¨å†™çš„è¿‡ç¨‹ä¸­ï¼Œè¢«Twistedé‡Œé¢çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µ â€”â€” deferï¼ŒæŠ˜è…¾çš„ä¸è¡Œã€‚æœ€ç»ˆé€šè¿‡é˜…è¯»twistedçš„éƒ¨åˆ†æºç ï¼Œä»¥åŠä¸ä»£ç åšæ–—äº‰çš„ä¸°å¯Œç»éªŒï¼Œæœ€ç»ˆç®—æ˜¯è§£å†³äº†é—®é¢˜ã€‚&lt;/p>
&lt;p>æœ¬æ–‡ç®—æ˜¯ä½¿ç”¨twistedå¼€å‘è¸©å‘çš„ä¸€ä¸ªå°å°æ€»ç»“ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œåé¢ä¼šæœ‰å¤§èœã€‚ï¼šï¼‰&lt;/p>
&lt;h2 id="twistedä»‹ç»">Twistedä»‹ç» &lt;a href="#twisted%e4%bb%8b%e7%bb%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Twisted is an event-driven networking engine written in Python.&lt;/p>&lt;/blockquote>
&lt;p>Twistedæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œæ¡†æ¶ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œäº‹ä»¶é©±åŠ¨â€å‘¢ï¼Ÿ&lt;/p>
&lt;p>äº‹ä»¶é©±åŠ¨æŒ‡çš„æ˜¯å°†äº‹ä»¶ä¸äº‹ä»¶å›è°ƒç»‘å®šèµ·æ¥ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶æ ¹æ®å®æ—¶çš„äº‹ä»¶è§¦å‘ç›¸åº”çš„å“åº”çš„ä¸€ç§æœºåˆ¶ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚select/poll/epollè¿™äº›IOå¤ç”¨å‡½æ•°ï¼Œåœ¨æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰å¯è¯»/å¯å†™/å‡ºé”™æ—¶ï¼Œä¼šç«‹å³è¿”å›ï¼Œç”±ç›¸åº”çš„å¤„ç†å‡½æ•°æ¥å¯¹æ–°äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚äº‹å®ä¸Šï¼Œtwistedçš„äº‹ä»¶é©±åŠ¨åŠŸèƒ½ï¼Œæ­£æ˜¯ç”±è¿™äº›IOå¤ç”¨å‡½æ•°æä¾›çš„ã€‚&lt;/p>
&lt;p>ä½†ä¸IOå¤ç”¨å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œtwistedä¸­çš„äº‹ä»¶å¯ä»¥æ˜¯â€œæ›´é«˜å±‚æ¬¡çš„äº‹ä»¶â€ï¼Œå³å¯¹ç½‘ç»œçš„è¯»/å†™/é”™ç­‰åŸºç¡€äº‹ä»¶è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„å°è£…ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä»¥&lt;code>LineReceiver&lt;/code>ä¸ºä¾‹ï¼ˆ&lt;a href="http://twistedmatrix.com/documents/current/api/twisted.protocols.basic.LineReceiver.html">APIæ–‡æ¡£&lt;/a>ï¼‰ã€‚&lt;code>LineReceiver&lt;/code>æ˜¯å¯¹ä¼ è¾“å±‚åè®®çš„äºŒæ¬¡å°è£…ï¼Œå½“æˆ‘ä»¬è¯»å®Œä¸€æ•´è¡Œä¹‹åï¼Œå°±è§¦å‘&lt;code>lineReceived&lt;/code>äº‹ä»¶ï¼Œå¯¹è·å–çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>è¿™ç§å°è£…ï¼Œå°†å¼€å‘è€…ä¸åº•å±‚çš„ç½‘ç»œäº¤äº’éš”ç¦»å¼€æ¥ã€‚åˆ©ç”¨è¿™äº›â€œé«˜çº§äº‹ä»¶â€ï¼Œå¼€å‘è€…å¯ä»¥å°†æ›´å¤šçš„ç²¾åŠ›æ”¾åˆ°ç¨‹åºæœ¬èº«é€»è¾‘çš„å¼€å‘ä¹‹ä¸­ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç‚¹ï¼Œæ­£å¦‚Pythonè¯­è¨€æœ¬èº«çš„ä¸€å¤§ä¼˜ç‚¹ä¸€æ ·ï¼ŒTwistedç°æˆçš„åè®®å®ç°çš„éå¸¸ä¸°å¯Œï¼ŒåŒæ—¶åœ¨å·¥ä¸šç•Œä¹Ÿè¾ƒä¸ºå¹¿æ³›çš„ä½¿ç”¨ã€‚è™½ç„¶èµ¶ä¸ä¸Šgolangè¿™ç§â€œæ˜æ˜Ÿè¯­è¨€â€ï¼Œä½†æ˜¯ä¹Ÿè¿˜æ˜¯å¯ä»¥â€œè‡ªæˆä¸€æ´¾â€ï¼Œæç‚¹äº‹æƒ…ã€‚&lt;/p>
&lt;h2 id="deferä¸å›è°ƒ">Deferä¸å›è°ƒ &lt;a href="#defer%e4%b8%8e%e5%9b%9e%e8%b0%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Twistedä½¿ç”¨Deferæ¥ç®¡ç†callbacké“¾ï¼Œå¦‚æœä½ å†™è¿‡jsï¼Œå°±å¯èƒ½å¯¹è¢«å›è°ƒé“¾ï¼ˆcallback chainsï¼‰æ‰€æ”¯é…çš„ææƒ§è®°å¿†æ·±åˆ»ã€‚å½“ç„¶ï¼ŒTwistedçš„deferä¹Ÿå¹¶æ²¡æœ‰å¥½åˆ°å“ªé‡Œå»ã€‚ï¼ˆè›¤ï¼ï¼‰&lt;/p>
&lt;p>Seriouslyï¼Œdeferå…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€èˆ¬çš„é¡ºåºå‹ç¼–ç¨‹æ¨¡å‹æ¥ç¼–å†™å›è°ƒä»£ç ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå‡½æ•°æŒ‰ç…§é¡ºåºæ³¨å†Œåˆ°deferå½“ä¸­ï¼Œå°±å¯ä»¥å®Œæ•´çš„å®ç°ä¸€ä¸ªå›è°ƒé“¾äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/public/16-12-9/90670835.jpg" alt="">&lt;/p>
&lt;p>æœ¬æ–‡ä¸ä¼šå¯¹deferè¿›è¡Œè¿‡å¤šè®²è§£ï¼Œå¦‚æœæƒ³è¦äº†è§£æ›´å¤šçš„è¯ï¼Œå¯ä»¥å‚è€ƒtwistedçš„&lt;a href="https://twistedmatrix.com/documents/current/core/howto/defer.html">å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;p>deferåšä¸ºä¸€ä¸ªå›è°ƒé“¾çš„æŠ½è±¡ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§è´¨ï¼Œå°±æ˜¯ä½ ä¸fireå®ƒï¼Œå®ƒæ˜¯ä¸ä¼šè°ƒç”¨å®ƒçš„callbacksçš„ã€‚æ­£åƒä¿—è¯è¯´çš„ä¸€æ ·ï¼š&lt;/p>
&lt;blockquote>
&lt;p>äº‹ä¸è¯´ä¸çŸ¥ï¼Œæœ¨ä¸é’»ä¸é€ï¼Œç ‚é”…ä¸æ‰“ä¸€è¾ˆå­ä¸æ¼&lt;/p>&lt;/blockquote>
&lt;p>åˆæœ‰äººè¯´è¿‡ï¼ˆå¼‚æ­¥å‘å¡ï¼‰ï¼š&lt;/p>
&lt;blockquote>
&lt;p>A: There&amp;rsquo;s something between us. &lt;br>
B: What is it? &lt;br>
A: An unfired defer.&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æœä½ æƒ³æ¿€æ´»deferä¸­çš„callbacksï¼Œå°±éœ€è¦æ‰‹åŠ¨çš„fireå®ƒã€‚é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ¥fireå®ƒå‘¢ï¼Ÿå½“ç„¶æ˜¯åœ¨éœ€è¦çš„æ—¶å€™å•¦ã€‚&lt;/p>
&lt;h3 id="ä¸€ä¸ªå…¸å‹çš„deferä½¿ç”¨åœºæ™¯---txmongo">ä¸€ä¸ªå…¸å‹çš„deferä½¿ç”¨åœºæ™¯ - txmongo &lt;a href="#%e4%b8%80%e4%b8%aa%e5%85%b8%e5%9e%8b%e7%9a%84defer%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af---txmongo" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>txmongoæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„mongodb python sdkã€‚è€Œæˆ‘ä»¬å¸¸ç”¨çš„pymongoåº“åˆ™æ˜¯åŒæ­¥çš„ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è¦åŒæ­¥ç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœã€‚&lt;/p>
&lt;p>ç”±äºæ˜¯å¼‚æ­¥çš„sdkï¼Œæ‰€ä»¥åœ¨åŒä¸€æ—¶é—´ï¼Œtxmongoä¼šåŒæ—¶æŒæœ‰å¤šä¸ªmongodbè¿æ¥ï¼ˆè¿æ¥æ± ï¼‰ã€‚å¹¶ä¸”ç”±äºæˆ‘ä»¬ä¸èƒ½é¢„æµ‹mongodbçš„å“åº”æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ”¶åˆ°mongodbå“åº”åï¼Œå¯åŠ¨ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œä»¥è§¦å‘æ›´é«˜çº§åˆ«çš„æ¶ˆæ¯äº‹ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># txmongo/protocol.py#L368&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">handle_REPLY&lt;/span>(self, request):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> request&lt;span style="color:#f92672">.&lt;/span>response_to &lt;span style="color:#f92672">in&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>__deferreds:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> df &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>__deferreds&lt;span style="color:#f92672">.&lt;/span>pop(request&lt;span style="color:#f92672">.&lt;/span>response_to)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> request&lt;span style="color:#f92672">.&lt;/span>response_flags &lt;span style="color:#f92672">&amp;amp;&lt;/span> REPLY_QUERY_FAILURE:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># some error handling code&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> df&lt;span style="color:#f92672">.&lt;/span>callback(request)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä»è¿™æ®µä»£ç ä¸­çœ‹å‡ºï¼Œå½“txmongoæ”¶åˆ°å“åº”åï¼Œä¼šå…ˆä»&lt;code>self.__deferreds&lt;/code>å­—å…¸ä¸­å–å‡ºç›¸åº”çš„deferï¼Œä¹‹åä½¿ç”¨&lt;code>request&lt;/code>åšä¸ºå‚æ•°ï¼Œå¯åŠ¨deferä¸­çš„callbacksï¼Œå°†æŸ¥åˆ°çš„æ•°æ®è¿”å›ç»™è°ƒç”¨è€…ã€‚&lt;/p>
&lt;h3 id="æ–°æ‰‹ä¼šé‡åˆ°çš„deferå‘--æµ‹è¯•">æ–°æ‰‹ä¼šé‡åˆ°çš„deferå‘ â€”â€” æµ‹è¯• &lt;a href="#%e6%96%b0%e6%89%8b%e4%bc%9a%e9%81%87%e5%88%b0%e7%9a%84defer%e5%9d%91--%e6%b5%8b%e8%af%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åšä¸ºä¸€ä¸ªé©¬ä¸Šå°±è¦æ­¥å…¥ä¸­å¹´çš„ç¨‹åºå‘˜ï¼Œæˆ‘æœ€å¤§çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸ç›¸ä¿¡è‡ªå·±ï¼ˆæ±—ï¼‰ã€‚æ‰€ä»¥åœ¨å¼€å‘æ—¶ä¼šåŠæ—¶å†™å•å…ƒæµ‹è¯•æ¥å°½å¯èƒ½ä¿è¯ä»£ç çš„æ­£ç¡®æ€§ã€‚äºæ˜¯åœ¨å¼€å‘çš„å¾ˆæ—©å°±è¸©åˆ°äº†deferçš„å‘ï¼ŒåŒ…æ‹¬ï¼š&lt;/p>
&lt;ol>
&lt;li>æµ‹è¯•hangä½&lt;/li>
&lt;li>æµ‹è¯•é€šè¿‡ï¼Œä½†æ˜¯æŠ¥é”™&amp;quot;reactor was unclean&amp;quot;&lt;/li>
&lt;li>ç”±äºå›è°ƒæ²¡æœ‰æ‰§è¡Œï¼Œæµ‹è¯•æŒ‚æ‰&lt;/li>
&lt;/ol>
&lt;p>å‘1æ¯”è¾ƒå¥½è§£å†³ï¼Œdeferæ²¡æœ‰callbackï¼Œhangä½äº†åªèƒ½æ€ªè‡ªå·±ã€‚ä¸è¿‡æŸ¥å“ªé‡Œhangä½äº†ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å¤šæ‰“logï¼Œä»logé‡Œå¾ˆå®¹æ˜“å°±çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜ã€‚&lt;/p>
&lt;p>å‘2å’Œå‘3éƒ½å±äºæˆ‘ä»¬ä½¿ç”¨deferçš„å§¿åŠ¿ä¸å¯¹ã€‚deferæ˜¯â€œå»¶æ—¶â€çš„ï¼Œæˆ‘ä»¬ä¸èƒ½åƒè°ƒç”¨å‡½æ•°ä¸€æ ·çš„ç›´æ¥è°ƒç”¨ï¼Œæµ‹è¯•ä»£ç éœ€è¦deferæ‰§è¡Œå®Œæœ€åä¸€ä¸ªcallbackå‡½æ•°åå†ç»§ç»­æ‰§è¡Œã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŠŠæµ‹è¯•ä»£ç ä¹Ÿå†™æˆcallbacksï¼Œç„¶åé™„åœ¨éœ€è¦æµ‹è¯•çš„deferåé¢å—ï¼Ÿ&lt;/p>
&lt;p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œtwistedä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç¥å¥‡çš„å·¥å…·&lt;code>@defer.inlineCallbacks&lt;/code>ã€‚è¿™ä¸ªè£…é¥°å™¨å¯ä»¥ç”¨äºå¼€å‘ç¯å¢ƒä¸æµ‹è¯•ç¯å¢ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨yieldç­‰å¾…deferæ‰§è¡Œå®Œæˆï¼Œå¹¶ä¸”å¯ä»¥è·å¾—deferçš„è¿”å›å€¼ã€‚è¿™ç±»ä¼¼äºC#çš„async/awaitè¯­æ³•ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åœ¨æˆ‘ä»¬çš„æµ‹è¯•å½“ä¸­å¦‚æœä½¿ç”¨äº†deferï¼Œå°±éœ€è¦å°†æµ‹è¯•caseä½¿ç”¨&lt;code>inlineCallbacks&lt;/code>è£…é¥°èµ·æ¥ï¼Œåœ¨ç­‰å¾…deferæ—¶ï¼Œéœ€è¦ä½¿ç”¨yieldè¯­æ³•ï¼Œç­‰å¾…å¼‚æ­¥ä»£ç çš„æ‰§è¡Œã€‚åœ¨caseçš„æœ€åï¼Œå°†ä¸éœ€è¦çš„defer cancelæ‰å³å¯ã€‚&lt;/p>
&lt;h2 id="deferredqueueä¸å¾ªç¯">DeferredQueueä¸å¾ªç¯ &lt;a href="#deferredqueue%e4%b8%8e%e5%be%aa%e7%8e%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Queueçš„ä¸€ä¸ªé‡è¦ç”¨æ³•å°±æ˜¯å¾ªç¯ã€‚åŒ…æ‹¬çº¿ç¨‹/è¿›ç¨‹é€šä¿¡çš„Queueï¼ŒBFSä¸­ä½¿ç”¨çš„Queueï¼Œéƒ½æ˜¯éœ€è¦å¾ªç¯è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>DeferredQueueæ˜¯Twistedä¸­é€šä¿¡çš„ä¸€ä¸ªé‡è¦æ•°æ®ç»“æ„ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å’Œä¸€èˆ¬çš„Queueä»é€»è¾‘ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ¥å£ä¹Ÿåªæœ‰ä¸¤ä¸ªï¼š&lt;code>put&lt;/code>å’Œ&lt;code>get&lt;/code>ã€‚&lt;/p>
&lt;p>DeferredQueueä¹‹æ‰€ä»¥æœ‰ä¸€ä¸ªDeferredå‰è¾ï¼Œæ˜¯å› ä¸ºå®ƒçš„getå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªdeferã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªdeferä¸Šç»‘å®šcallbacksï¼Œå³æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œè§¦å‘ç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“å°±æŠŠä»£ç å†™æˆäº†è¿™æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>q &lt;span style="color:#f92672">=&lt;/span> defer&lt;span style="color:#f92672">.&lt;/span>DeferredQueue()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_and_print&lt;/span>(item):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print item
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q&lt;span style="color:#f92672">.&lt;/span>get()&lt;span style="color:#f92672">.&lt;/span>addCallback(get_and_print)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>q&lt;span style="color:#f92672">.&lt;/span>get()&lt;span style="color:#f92672">.&lt;/span>addCallback(get_and_print)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">100&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q&lt;span style="color:#f92672">.&lt;/span>put(i)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™ä¸ªä»£ç æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå¾ªç¯çš„ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶æ‰“å°ã€‚ä½†å®é™…ä¸Šï¼Œè¿™æ®µä»£ç æœ‰ä¸€ä¸ªç¥å¥‡çš„å‘ã€‚&lt;/p>
&lt;p>è¯´ä¸€ä¸‹è¿™ä¸ªå‘æ˜¯æ€ä¹ˆå‘ç°çš„å§ï¼Œæˆ‘æŠŠä»£ç å†™çš„å·®ä¸å¤šä¹‹åï¼Œå°±æƒ³è·‘benchmarkæ¥æµ‹æ€§èƒ½ã€‚ç„¶åå‘ç°CPythonçš„æ€§èƒ½ä¸€èˆ¬ï¼Œå°±æƒ³è¯•è¯•pypyã€‚ç„¶åå´æ€ä¹ˆä¹Ÿå¾—ä¸åˆ°æ­£ç¡®çš„ç»“æœï¼Œæœ€åå‘ç°æ˜¯å› ä¸ºDeferredQueueå¼•å‘äº†é€’å½’è¿‡æ·±çš„å¼‚å¸¸ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆCPythonæ²¡æœ‰è¿™ä¸ªé—®é¢˜å‘¢ã€‚åŸå› åœ¨äºCPythonçš„é€’å½’æ ˆæ˜¯æŒ‰æ·±åº¦ç®—çš„ï¼Œè€Œpypyçš„é€’å½’æ ˆæ˜¯æŒ‰å¤§å°ç®—çš„ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå‚æ•°çš„æ ‡é‡æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥pypyçš„é€’å½’æ ˆå°±è¿œå°äºCPythonçš„ã€‚è¿™æ‰æš´éœ²äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸è¿‡å•çº¯çš„æ‰©æ ˆä¹Ÿæ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆéš¾ä¼°è®¡æç«¯æƒ…å†µï¼Œå¹¶ä¸”Pythonçš„é€’å½’æ€§èƒ½éå¸¸å·®ã€‚&lt;/p>
&lt;p>æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»å‚è€ƒ&lt;a href="https://github.com/twisted/twisted/blob/twisted-16.5.0/src/twisted/internet/defer.py#L1600">æºç &lt;/a>ï¼Œè¿™é‡Œå°±ç›´æ¥è¯´ç»“è®ºäº†ã€‚å½“é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ—¶ï¼Œ&lt;code>q.get().addCallback(get_and_print)&lt;/code>ä¼šç›´æ¥è°ƒç”¨&lt;code>get_and_print&lt;/code>å‡½æ•°æœ¬èº«ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­çš„å…ƒç´ éå¸¸å¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰é€’å½’è¿‡æ·±çš„å±é™©äº†ã€‚&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œä¸å…¶è®©TwistedæŠŠæˆ‘ä»¬çš„å¾ªç¯å†™æˆé€’å½’ï¼Œè¿˜ä¸å¦‚æˆ‘ä»¬è‡ªå·±å®ç°Queueçš„å¾ªç¯ã€‚è‡³äºæ–¹æ³•ï¼Œçœ‹çœ‹DeferredQueueçš„å†…éƒ¨å®ç°å°±æ¸…æ¥šäº†ï¼Œç„¶åæˆ‘ä»¬å°±å‘ç°äº†å¦å¤–ä¸€ä¸ªå‘ã€‚&lt;/p>
&lt;h2 id="deferredqueueä¸æ€§èƒ½">DeferredQueueä¸æ€§èƒ½ &lt;a href="#deferredqueue%e4%b8%8e%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘å•¥éƒ½ä¸è¯´ï¼Œå°±è´´ä¸€è¡Œ&lt;a href="https://github.com/twisted/twisted/blob/twisted-16.5.0/src/twisted/internet/defer.py#L1665">ä»£ç &lt;/a>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> succeed(self&lt;span style="color:#f92672">.&lt;/span>pending&lt;span style="color:#f92672">.&lt;/span>pop(&lt;span style="color:#ae81ff">0&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‚¨è¿™å°±æ˜¯åœ¨é€—æˆ‘ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/public/16-12-9/36902015.jpg" alt="">&lt;/p>
&lt;p>å†è´´ä¸ªæ€§èƒ½å¯¹æ¯”ï¼Œä½¿ç”¨&lt;code>list.pop(0)&lt;/code>å¼¹å‡º10^5ä¸ªæ•°æ®éœ€è¦2.23sï¼Œè€Œä½¿ç”¨&lt;code>deque.popleft()&lt;/code>åªéœ€è¦0.12sã€‚&lt;/p>
&lt;p>ä¸è¦åŠŸèƒ½å®ç°äº†å°±ä¸ç®¡æ€§èƒ½äº†å˜›åŒå­¦ã€‚&lt;/p></description></item><item><title>Moscaæºç é˜…è¯»</title><link>https://wizmann.top/posts/mosca/</link><pubDate>Fri, 11 Nov 2016 22:04:13 +0000</pubDate><guid>https://wizmann.top/posts/mosca/</guid><description>&lt;h2 id="å…ˆåœ¨å‰é¢">å…ˆåœ¨å‰é¢ &lt;a href="#%e5%85%88%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ€è¿‘å¿ƒè¡€æ¥æ½®çœ‹äº†çœ‹ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„å¼€æºMQTT broker â€”â€” Moscaã€‚ä¸è¯»ä¸çŸ¥é“ï¼Œè¯»å®Œæ‰æç„¶å¤§æ‚Ÿ â€”â€” è¿™æ˜¯å•¥ç ´ç©æ„ï¼ˆå“ˆå“ˆï¼‰ã€‚&lt;/p>
&lt;p>ç”±äºæˆ‘æ˜¯nodejsçš„è¶…çº§åˆå­¦è€…ï¼Œæ‰€ä»¥æœ¬æ–‡ä¼šæ¯”è¾ƒæµ…æ˜¾ï¼Œå¹¶ä¸”åªå…³æ³¨big pictureï¼Œä¸é™·å…¥ç»†èŠ‚ã€‚&lt;/p>
&lt;p>è¿™é‡Œå…ˆè§„å®šå‡ ä¸ªç¼©å†™ï¼Œè®©åé¢è¡Œæ–‡æ—¶å°‘æ‰“ä¸€ç‚¹å­—ï¼š&lt;/p>
&lt;ul>
&lt;li>MQ - MessageQueue&lt;/li>
&lt;li>Asco - Ascoltatori&lt;/li>
&lt;/ul>
&lt;h2 id="ascoltatori---å¬è€…">Ascoltatori - å¬è€… &lt;a href="#ascoltatori---%e5%90%ac%e8%80%85" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Ascoltatoriæ˜¯ä¸€ä¸ªæ„å¤§åˆ©è¯­å•è¯ï¼Œç¿»è¯‘æˆè‹±æ–‡å°±æ˜¯listenerã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œä¸¥é‡åæ§½ä½œè€…å–åå­—çš„æ–¹å¼ï¼Œmoscaè¿™ç§çŸ­å°çš„å¤–è¯­å•è¯æˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½ è¯´ascoltatoriè¿™ä¹ˆé•¿çš„æ„å¤§åˆ©è¯­å•è¯ï¼Œä½ è®©æˆ‘ä»¬æ€ä¹ˆè®°ã€‚ &lt;br>
å·®è¯„ï¼Œé€€æ¬¾ï¼Œé‚®è´¹ä¹Ÿè¦é€€ï¼&lt;/p>&lt;/blockquote>
&lt;p>Ascoæ¨¡å—çš„ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªä¸€è‡´çš„MQçš„æŠ½è±¡ï¼Œä¾›ä¸Šå±‚brokerä½¿ç”¨ã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬åªåˆ†æåŸºäºRedisçš„å®ç°ï¼ŒåŸå› æ˜¯Redisæˆ‘ç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&lt;/p>
&lt;h3 id="æ¥å£åˆ†æ">æ¥å£åˆ†æ &lt;a href="#%e6%8e%a5%e5%8f%a3%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>RedisAscoltatore&lt;/code>æœ‰ä¸‰ä¸ªåŠæ¥å£ï¼š&lt;/p>
&lt;ul>
&lt;li>subscribe&lt;/li>
&lt;li>unsubscribe&lt;/li>
&lt;li>publish&lt;/li>
&lt;/ul>
&lt;p>å‰©ä¸‹çš„é‚£åŠä¸ªæ˜¯æ¨¡å—çš„æ„é€ å‡½æ•°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«åˆ†ææ¥å£çš„åŠŸèƒ½åŠå…¶å®ç°ã€‚&lt;/p>
&lt;h3 id="subscribeæ¥å£">Subscribeæ¥å£ &lt;a href="#subscribe%e6%8e%a5%e5%8f%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>this._sub&lt;/code>æ˜¯&lt;code>RedisAscoltatore&lt;/code>ç”¨æ¥subscribeçš„è¿æ¥ã€‚é¦–å…ˆæˆ‘ä»¬è¦å‘MQè®¢é˜…æŒ‡å®šçš„topicã€‚&lt;/p>
&lt;p>ä¹‹åæˆ‘ä»¬è¦åœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ª&lt;code>topic&lt;/code>åˆ°&lt;code>callback&lt;/code>sçš„æ˜ å°„å…³ç³»ã€‚å› ä¸ºMoscaæ˜¯ä¸€ä¸ªbrokerï¼Œéœ€è¦å°†end userè®¢é˜…çš„topicçš„å†…å®¹å®Œæ•´çš„å‘é€åˆ°ç”¨æˆ·é‚£é‡Œå»ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·åœ¨Ascoé‡Œï¼Œç”¨ä¸€ä¸ªcallbackå‡½æ•°æ¥ä»£è¡¨ã€‚&lt;/p>
&lt;p>ç”¨æˆ·å¯ä»¥è®¢é˜…ä¸€ä¸ªç‰¹å®šçš„topicï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªpatternæ¥è®¢é˜…ä¸€ç³»åˆ—çš„topicã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/public/16-11-10/27730251.jpg" alt="">&lt;/p>
&lt;p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå³ä¸Šæ–¹çš„clientè®¢é˜…äº†&lt;code>h?llo&lt;/code>ï¼ˆç›¸å½“äºregexä¸­çš„&lt;code>h.llo&lt;/code>ï¼‰ã€‚å³ä¸‹æ–¹çš„clientè®¢é˜…äº†&lt;code>h[abcde]llo&lt;/code>ã€‚è€Œå·¦è¾¹çš„clientå‘&lt;code>hello&lt;/code> topicå‘å¸ƒäº†ä¸€ä¸ªæ¶ˆæ¯ã€‚æ­¤æ—¶å³è¾¹çš„ä¸¤ä¸ªclientéƒ½æ”¶åˆ°äº†è¿™æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­pmessageä»£è¡¨è¿™æ¡æ¶ˆæ¯æ˜¯æœ‰patternçš„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨äº†clientè®¢é˜…çš„pattern topicï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨äº†è¿™æ¡æ¶ˆæ¯çš„å®é™…topicï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯çš„æ­£æ–‡ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åœ¨ç»´æŠ¤topic-clientåˆ—è¡¨æ—¶ï¼Œåªéœ€è¦ç»´æŠ¤pattern topicï¼ˆæ²¡æœ‰patternçš„topicå¯ä»¥è§†åšåªåŒ¹é…å½“å‰topicçš„patterï¼‰ã€‚å½“æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨pattern topicæ˜ å°„åˆ°clientsï¼Œä¹‹åå†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚&lt;/p>
&lt;p>è¿™é‡ŒAscoä½¿ç”¨äº†ä¸€ä¸ªå«åš&lt;a href="https://github.com/davedoesdev/qlobber">&lt;code>qlobber&lt;/code>&lt;/a>çš„åº“ï¼Œå®ƒä½¿ç”¨Trieæ ‘å¯¹topicè¿›è¡ŒåŒ¹é…ã€‚æˆ‘ä»¬åœ¨ä¸Šæ–‡å·²ç»è¯´åˆ°ï¼ŒAscoæ˜¯ä¸€ä¸ªç»Ÿä¸€åŒ–çš„MQæŠ½è±¡å±‚ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„MQä¸­æ‰€ä½¿ç”¨çš„ä¸åŒçš„patternï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°†å…¶ç»Ÿä¸€æˆåŒä¸€ç§è¯­æ³•è¿›è¡ŒåŒ¹é…ã€‚è€Œqlobberï¼Œåœ¨Ascoä¸­è¢«å°è£…æˆ&lt;code>RedisAscoltatore&lt;/code>ï¼Œå°±æ˜¯ç”¨æ¥ç»Ÿä¸€ä¸åŒçš„è¯­æ³•çš„ã€‚&lt;/p>
&lt;h3 id="unsubscribeæ¥å£">Unsubscribeæ¥å£ &lt;a href="#unsubscribe%e6%8e%a5%e5%8f%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ‰è®¢é˜…å°±æœ‰é€€è®¢ï¼Œè¿™ä¸ªæ¥å£ä¸ä¸Šé¢çš„æ˜¯å¯¹åº”çš„å…³ç³»ã€‚æˆ‘ä»¬åªéœ€è¦å°†è®¢é˜…çš„é¡ºåºåè¿‡æ¥åšä¸€éå°±å¯ä»¥äº†ã€‚è¿™ä¸ªå‡½æ•°ç›¸å¯¹ç®€å•ï¼Œå°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;h3 id="publishæ¥å£">Publishæ¥å£ &lt;a href="#publish%e6%8e%a5%e5%8f%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é‡Œçš„publishï¼Œä»£è¡¨æ˜¯ç”¨æˆ·çš„publishçš„æ“ä½œã€‚ç”¨æˆ·æ•°æ®åœ¨â€œå»MQç‰¹è‰²åŒ–â€ä¹‹åï¼Œä¼šç»ç”±&lt;code>this._client&lt;/code>å‘å¸ƒåˆ°ç›¸åº”çš„redisæœåŠ¡ã€‚æœ€åè°ƒç”¨ç”¨æˆ·çš„callbackã€‚&lt;/p>
&lt;p>è¿™é‡Œå†åä¸€ä¸ªæ§½ï¼Œä¸ºå•¥è®¢é˜…è¿æ¥å«&lt;code>this._sub&lt;/code>ï¼Œå‘å¸ƒè¿æ¥å«&lt;code>this._client&lt;/code>ã€‚éš¾é“ä½ ä¸é€ pub/subæ‰æ˜¯çœŸæ­£çš„å¯¹åº”å—ï¼Ÿ&lt;/p>
&lt;h3 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•° &lt;a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ„é€ å‡½æ•°è™½ç„¶è¯´æ˜¯â€œåŠä¸ªæ¥å£â€ï¼Œä½†æ˜¯ä»£ç é‡å’Œé‡è¦æ€§ï¼Œå´é«˜äºä¸Šé¢çš„æ¥å£ã€‚å› ä¸ºredisçš„pub/subæ¨¡å‹æ˜¯å•å·¥çš„ï¼Œéœ€è¦ä¸¤ä¸ªè¿æ¥æ‰å¯ä»¥å®Œæˆã€‚æ‰€ä»¥ä¸¤æ¡è¿æ¥éœ€è¦å•ç‹¬åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h4 id="this_startpub">this._startPub &lt;a href="#this_startpub" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æˆ‘ä»¬å…ˆä»ç®€å•çš„å¼€å§‹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå¤ªç®€å•äº†ï¼Œæ²¡çš„å¯è¯´ã€‚å°±æ˜¯æ‹‰ä¸€æ¡ç”µè¯çº¿ï¼ŒæˆåŠŸäº†ä¹‹åæ”¹ä¸€ä¸‹çŠ¶æ€ã€‚&lt;/p>
&lt;p>æ²¡äº†ã€‚&lt;/p>
&lt;h4 id="this_startsub">this._startSub &lt;a href="#this_startsub" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è¿™ä¸ªæ¯”pubè¦å¤æ‚ä¸€ç‚¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ‹‰ä¸€æ¡åˆ°redisçš„ç”µè¯çº¿ï¼ˆè¿æ¥ï¼‰ã€‚ä¹‹åæ³¨å†Œæ¶ˆæ¯åˆ°æ¥æ—¶çš„å›è°ƒã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹è¿™ä¸ªå›è°ƒæ˜¯æ€æ ·çš„æµç¨‹ã€‚&lt;/p>
&lt;p>é¦–å…ˆè¿˜æ˜¯â€œå»MQç‰¹è‰²åŒ–â€ï¼Œå°†Redisçš„patternè¯­æ³•åŒ–å½’æˆAscoçš„å†…éƒ¨è¯­æ³•ã€‚å†é€šè¿‡patternå–å‡ºç›¸åº”çš„callbacksï¼Œå°†æ¶ˆæ¯é€šè¿‡callbacksä¼ é€’ç»™ç›¸åº”çš„ç”¨æˆ·ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼Œ&lt;code>(sub, topic, payload)&lt;/code>ä¸‰ä¸ªå‚æ•°å¦‚æœå‘½åä¸º&lt;code>(pattern, topic, payload)&lt;/code>å…¶å®ä¼šæ›´æ¸…æ™°ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç±»å…¶å®åŸç†ä¸Šå¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯ç”±äºå…¶éœ€è¦å°†ä¸åŒMQçš„patternè½¬æ¢ä¸ºç»Ÿä¸€çš„è¯­æ³•ï¼Œæ‰€ä»¥åœ¨ä¸­é—´åŠ äº†ä¸€å±‚ï¼Œå¯¼è‡´å¤æ‚æ€§çš„æå‡ã€‚å¦‚æœæˆ‘ä»¬åªåšä¸€ä¸ªä¸“ç”¨çš„brokerï¼Œä»£ç å…¶å®å¯ä»¥å†™çš„æ›´æ˜æœ—çš„ã€‚&lt;/p>
&lt;h2 id="mosca---è‹è‡">Mosca - è‹è‡ &lt;a href="#mosca---%e8%8b%8d%e8%9d%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸Mosquitoç›¸å¯¹ï¼ŒMoscaæ˜¯è‹è‡çš„æ„æ€ã€‚Moscaæ˜¯Ascoçš„ä¸Šå±‚å°è£…ï¼Œä¸å…¶ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªMQTT brokerï¼Œä¸end userç›´æ¥äº¤äº’ã€‚&lt;/p>
&lt;p>MQçš„å•ä¸€èŒè´£æ˜¯è´Ÿè´£æ¶ˆæ¯çš„å‘å¸ƒ/è®¢é˜…ï¼ŒMoscaåœ¨å…¶ä¸Šæ·»åŠ äº†ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨çº¿ç¦»çº¿çŠ¶æ€æ£€æµ‹&lt;/li>
&lt;li>ç¦»çº¿æ¶ˆæ¯çš„æ”¯æŒ&lt;/li>
&lt;li>å®¢æˆ·ç«¯æŒä¹…åŒ–&lt;/li>
&lt;li>ä¸€äº›æƒé™æ£€æµ‹æ¥å£&lt;/li>
&lt;/ol>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»Moscaçš„å·¥ä½œæµç¨‹å‡ºå‘ï¼Œä¸»è¦å…³æ³¨ç¦»çº¿æ¶ˆæ¯å’Œå®¢æˆ·ç«¯æŒä¹…åŒ–è¿™ä¸¤ä¸ªbrokerä¸­éå¸¸é‡è¦çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="æŒä¹…åŒ–">æŒä¹…åŒ– &lt;a href="#%e6%8c%81%e4%b9%85%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯åªçœ‹Redisçš„å®ç°ã€‚å…¶å®Rediså¹¶ä¸æ˜¯çœŸæ­£çš„æŒä¹…åŒ–ï¼Œä¸è¿‡who caresã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„æŒä¹…åŒ–å°±åŒ…æ‹¬äº†ç¦»çº¿æ¶ˆæ¯å’Œå®¢æˆ·ç«¯æŒä¹…åŒ–ä¸¤ä¸ªæ¦‚å¿µã€‚&lt;/p>
&lt;p>ç¦»çº¿æ¶ˆæ¯ä½¿ç”¨&lt;code>packet:{client_id}&lt;/code>ä¸ºkeyè¿›è¡Œä¿å­˜ï¼Œå½“ç”¨æˆ·ç¦»çº¿æ—¶ï¼Œbrokerä¼šå°†æ¶ˆæ¯å…ˆä¿å­˜åœ¨redisä¸­ï¼Œå½“ç”¨æˆ·é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°±å°†ä¿å­˜å¥½çš„æ¶ˆæ¯ä¸€å£æ°”æ¨é€è¿‡å»ã€‚&lt;/p>
&lt;p>å®¢æˆ·ç«¯æŒä¹…åŒ–ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚å®¢æˆ·ç«¯åœ¨brokerä¸­çš„çŠ¶æ€æ˜¯å…¶è®¢é˜…çš„topicï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œbrokerä¼šä¸€ç›´ä¿å­˜ç”¨æˆ·æ‰€è®¢é˜…çš„topicï¼Œä»¥ä¾¿ä¿å­˜ç”¨æˆ·çš„ç¦»çº¿ä¿¡æ¯ã€‚å½“brokeræ‰ç”µæˆ–é‡å¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä»æŒä¹…åŒ–å±‚å°†ç”¨æˆ·çš„çŠ¶æ€é‡æ–°loadåˆ°å†…å­˜ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code>client:sub:{client_id}&lt;/code>ä¸ºkeyè¿›è¡Œä¿å­˜ã€‚&lt;/p>
&lt;h3 id="æ•´ä½“å·¥ä½œæµç¨‹">æ•´ä½“å·¥ä½œæµç¨‹ &lt;a href="#%e6%95%b4%e4%bd%93%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨Moscaå¯åŠ¨æ—¶ï¼Œå…ˆä¼šæ³¨å†Œä¸€äº›äº‹ä»¶ï¼Œæ¯”å¦‚â€œç”¨æˆ·ç™»å½•â€ï¼Œâ€œç”¨æˆ·ä¸‹çº¿â€ï¼Œâ€œç”¨æˆ·è®¢é˜…â€ç­‰ã€‚è¿™äº›æ¶ˆæ¯ç”±é…ç½®æ–‡ä»¶å†³å®šæ˜¯å¦ä¸‹å‘ã€‚&lt;/p>
&lt;p>è¿™ç§è®¾è®¡æ˜¯ä¸ºäº†æ–¹ä¾¿brokerçš„scale outï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªMQä¸Šé¢éƒ¨ç½²å¤šä¸ªbrokerï¼Œè¿™äº›brokeré€šè¿‡MQçš„&lt;code>$SYS&lt;/code>ä¿¡é“è¿›è¡Œé€šä¿¡ã€‚&lt;/p>
&lt;p>å½“Moscaå¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬åƒä¸Šé¢ä¸€æ ·ï¼Œé‡ç‚¹å…³æ³¨brokerçš„ä¸‰ä¸ªé‡è¦äº‹ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>subscribe&lt;/li>
&lt;li>publish&lt;/li>
&lt;li>unsubscribe&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›äº‹ä»¶ç†è®ºä¸Šæ˜¯Ascoçš„å°è£…ï¼Œæ·»åŠ äº†æƒé™æ§åˆ¶æ¥å£ã€æ›´å¤æ‚çš„äº‹ä»¶ï¼Œå½“ç„¶è¿˜æœ‰æŒä¹…åŒ–çš„æ”¯æŒã€‚ä¾‹å¦‚&lt;code>subscribe&lt;/code>äº‹ä»¶ï¼Œé™¤äº†è°ƒç”¨Ascoä¹‹å¤–ï¼Œè¿˜å°†ç”¨æˆ·çš„è¿™æ¬¡è®¢é˜…è®°å½•åœ¨äº†æŒä¹…å±‚é‡Œã€‚&lt;/p>
&lt;p>&lt;code>publish&lt;/code>äº‹ä»¶åˆ™æ˜¯å…ˆå°†æ•°æ®åŒ…å­˜æ”¾åœ¨æŒä¹…å±‚ï¼Œå†è°ƒç”¨Ascoçš„publishå‡½æ•°ã€‚&lt;code>unsubscribe&lt;/code>ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚&lt;/p>
&lt;h3 id="è¡¥ä¸€å¼ ç»“æ„å›¾">è¡¥ä¸€å¼ ç»“æ„å›¾ &lt;a href="#%e8%a1%a5%e4%b8%80%e5%bc%a0%e7%bb%93%e6%9e%84%e5%9b%be" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/public/16-11-11/55787779.jpg" alt="">&lt;/p>
&lt;h3 id="moscaçš„å¯æ‰©å±•æ€§">Moscaçš„å¯æ‰©å±•æ€§ &lt;a href="#mosca%e7%9a%84%e5%8f%af%e6%89%a9%e5%b1%95%e6%80%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ ¹æ®æˆ‘æµ…è–„çš„ç†è§£ï¼ŒMoscaæ˜¯å¯ä»¥æ”¯æŒscale outçš„ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªMQï¼ˆæˆ–åŒä¸€ä¸ªMQæŠ½è±¡ï¼‰ä¸Šéƒ¨ç½²å¤šä¸ªMoscaï¼Œä»¥æœåŠ¡æ›´å¤šçš„ç”¨æˆ·ã€‚ä½†æ˜¯ä¸€ä¸ªç”¨æˆ·å¿…é¡»ä¸¥æ ¼å¯¹åº”ä¸€ä¸ªshardï¼Œå¦åˆ™ä¼šå‡ºç°æ¶ˆæ¯çš„é‡å¤ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥åœ¨Clientç«¯è§£å†³ï¼Œä½†æ˜¯ä¸åº”è¯¥æ˜¯ä¸€ç§å¸¸æ€ï¼Œåªåº”è¯¥åœ¨ç”¨æˆ·è¿ç§»æˆ–è€…æ¯”è¾ƒå¤§çš„ç³»ç»Ÿå˜åŠ¨çš„æ—¶å€™æ‰å‡ºç°ã€‚&lt;/p>
&lt;p>ç”±äºMoscaçš„æŒä¹…åŒ–å±‚æ˜¯ä»¥Clientä¸ºKeyçš„ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¤šMQçš„æ¨¡å¼ã€‚MQçš„æ‰©å±•éœ€è¦ç”±MQè‡ªå·±æ¥å®Œæˆï¼Œå¯¹å¤–æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡å³å¯ã€‚ä¸è¿‡è¿™ç§åŠŸèƒ½ï¼Œå¹¶ä¸è¢«æ‰€æœ‰MQæ‰€æ”¯æŒã€‚&lt;/p>
&lt;h2 id="disclaimer">Disclaimer &lt;a href="#disclaimer" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>çœŸæ˜¯nodejså°ç™½ä»¥åŠMQå°ç™½ï¼Œä¸Šé¢è¯´çš„å“ªé‡Œä¸å¯¹ï¼Œè¯·å¸®å¿™æå‡ºæ¥ã€‚å¼ºçƒˆå»ºè®®ä¸è¦ä»¥æœ¬æ–‡ä¸­çš„ä»»ä½•è§‚ç‚¹ä¸åŠ æµ‹è¯•çš„åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒå½“ä¸­å»ã€‚&lt;/p></description></item><item><title>æ€»ç»“ - phxrpcä»£ç é˜…è¯»(8)</title><link>https://wizmann.top/posts/phxrpc-8/</link><pubDate>Sun, 23 Oct 2016 15:50:44 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-8/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™åº”è¯¥æ˜¯phxrpcä»£ç é˜…è¯»ç³»åˆ—æ­£æ–‡çš„æœ€åä¸€ç¯‡ã€‚é€šè¿‡é˜…è¯»ä»£ç ï¼Œå‘ç°äº†è‡ªå·±åœ¨çŸ¥è¯†ä¸Šçš„è‹¥å¹²ä¸è¶³ã€‚&lt;/p>
&lt;p>ä¸´æ¸Šç¾¡é±¼ï¼Œä¸å¦‚é€€è€Œç»“ç½‘ã€‚æ¥ä¸‹æ¥å¯èƒ½ä¼šåœ¨ç½‘ç»œç¼–ç¨‹æ–¹é¢å†ä¸‹ä¸€ç‚¹å·¥å¤«ã€‚è¯·å¤§å®¶æœŸå¾…ä¸‹ä¸€ä¸ªç³»åˆ—å§ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å…¶å®çœŸæ²¡äººè¯»ï¼Œæˆ‘å°±æ˜¯åœ¨éª—è‡ªå·±ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="å…ˆè¡¥å……ä¸€ç‚¹---ä»£ç ç”Ÿæˆ">å…ˆè¡¥å……ä¸€ç‚¹ - ä»£ç ç”Ÿæˆ &lt;a href="#%e5%85%88%e8%a1%a5%e5%85%85%e4%b8%80%e7%82%b9---%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>protobufå¹¶ä¸åŒ…å«RPCçš„å®ç°ï¼Œä½†æ˜¯å®ƒå¯ä»¥å£°æ˜rpcã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦å®ç°RPCæ¥å£ï¼Œæ¥å®ç°é€šä¿¡ã€‚&lt;/p>
&lt;p>phxrpcä½¿ç”¨protoæ–‡ä»¶æ¥å®šä¹‰æ¥å£ï¼Œç„¶åè§£æå¹¶ä½¿ç”¨ä»£ç æ¨¡æ¿è¿›è¡Œç”Ÿæˆã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä¸è®¨è®ºä»£ç ç”Ÿæˆçš„ç»†èŠ‚ï¼Œå› ä¸ºpbå®åœ¨å¤ªè¿‡æµè¡Œï¼Œä»£ç ç”Ÿæˆçš„æ–¹æ³•ä¹Ÿæœ‰ä¸å°‘çš„æµæ´¾ã€‚å¹¶ä¸”ç”¨C++æ¥åšä»£ç ç”Ÿæˆï¼ŒçœŸå¿ƒä¸æ˜¯æˆ‘çš„èœã€‚&lt;/p>
&lt;p>æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥å‚è€ƒ&lt;a href="http://codemacro.com/2014/08/31/protobuf-rpc/">è¿™ç¯‡åšå®¢&lt;/a>ã€‚&lt;/p>
&lt;h2 id="å·¥ä½œæµç¨‹---å®¢æˆ·ç«¯">å·¥ä½œæµç¨‹ - å®¢æˆ·ç«¯ &lt;a href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b---%e5%ae%a2%e6%88%b7%e7%ab%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>è¿æ¥å°‘&lt;/li>
&lt;li>è´Ÿè½½å°‘&lt;/li>
&lt;li>é€šä¿¡çš„ä¸»åŠ¨æ–¹&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥ï¼Œæ‰€æœ‰çš„ç½‘ç»œäº¤äº’ç›¸å…³çš„å†…å®¹å¯ä»¥æ‰˜ç®¡ç»™ç½‘ç»œåº“ä¸­çš„åç¨‹ã€‚æ¯ä¸ªåç¨‹ä¸»åŠ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¸»åŠ¨æ”¾å¼ƒCPUæ—¶é—´ï¼Œå°†æ§åˆ¶æƒäº¤è¿˜ç»™ä¸»æ§åˆ¶æµçš„epollã€‚&lt;/p>
&lt;p>æ‰€ä»¥åç¨‹ä¸­ä¸èƒ½æœ‰CPUå¯†é›†çš„è¿ç®—ï¼Œå¹¸å¥½é¢å¯¹å¼€å‘è€…ï¼Œphxrpcå¹¶ä¸æš´éœ²å†…éƒ¨å‡½æ•°ï¼Œè€Œæ˜¯å°†CPUå¯†é›†çš„è¿ç®—åˆ†é…ç»™å·¥ä½œçº¿ç¨‹æ¥å®Œæˆã€‚&lt;/p>
&lt;h2 id="å·¥ä½œæµç¨‹---æœåŠ¡ç«¯">å·¥ä½œæµç¨‹ - æœåŠ¡ç«¯ &lt;a href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b---%e6%9c%8d%e5%8a%a1%e7%ab%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœåŠ¡å™¨çš„é€šä¿¡æœ‰ä»¥ä¸‹çš„ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>è¿æ¥å¤š&lt;/li>
&lt;li>è´Ÿè½½å¤š&lt;/li>
&lt;li>é€šä¿¡çš„è¢«åŠ¨æ–¹&lt;/li>
&lt;li>å“åº”æ—¶é—´æ•æ„Ÿ&lt;/li>
&lt;/ol>
&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹å“åº”æ—¶é—´çš„é—®é¢˜ï¼Œå“åº”æ—¶é—´æ˜¯å’Œè´Ÿè½½å¤šå¯¹åº”çš„ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬åªè´Ÿè´£å‘è¯·æ±‚ï¼Œå…¶å“åº”æ—¶é—´å¹¶ä¸åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å ä¸»å¯¼åœ°ä½ï¼Œæ¢å¥è¯è¯´ï¼Œå®¢æˆ·ç«¯å‘è¯·æ±‚æ˜¯å®Œå…¨æœ‰ä¸»åŠ¨æƒçš„ã€‚è€ŒæœåŠ¡ç«¯è´Ÿè´£å“åº”è¯·æ±‚ï¼Œéœ€è¦ç»è¿‡CPUè¿ç®—ï¼Œæˆ–è€…æœ‰ä¸€äº›æœåŠ¡çš„çº§è”æˆ–æ‰‡å‡ºæ“ä½œï¼Œæ‰€ä»¥å“åº”æ—¶é—´æ˜¯ä¸å¯æ§çš„ã€‚&lt;/p>
&lt;p>ç”±ä¸Šé¢æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼ŒæœåŠ¡å™¨ç«¯è‚¯å®šéœ€è¦ä¸å®¢æˆ·ç«¯ä¸åŒçš„ç­–ç•¥æ¥å¤„ç†è¿æ¥ä¸å“åº”ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥&lt;strong>åŒæ­¥&lt;/strong>acceptè¯·æ±‚ï¼Œè¿™ä¸ªçº¿ç¨‹å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½blockåœ¨&lt;code>accept()&lt;/code>é‡Œï¼Œè´Ÿè½½æ¯”è¾ƒä½ã€‚&lt;/p>
&lt;p>åœ¨acceptåˆ°fdåï¼Œå°†å…¶å‹å…¥åˆ°è°ƒåº¦å™¨ä¸­ã€‚ä¹‹åfdä¼šhangåœ¨IOå¾ªç¯ä¸Šï¼Œç›´åˆ°æœ‰è¯·æ±‚åˆ°æ¥ã€‚ä¸æ­¤åŒæ—¶ï¼Œåç¨‹ä¼šè°ƒåº¦å…¶å®ƒçš„fdã€‚&lt;/p>
&lt;p>è¯·æ±‚åˆ°æ¥åï¼ŒIOçº¿ç¨‹ä¼šæŠŠè¯·æ±‚åŠ å…¥é˜Ÿåˆ—ä¸­ï¼ŒæŠŠè‡ªå·±ä»epollè°ƒåº¦ä¸­åˆ é™¤ã€‚ä¹‹åå°±å¼€å§‹ç¡è§‰è§‰ã€‚ç¡é†’äº†ä¹‹åï¼Œå‘ç°å“åº”æ²¡åˆ°ç¢—é‡Œæ¥ï¼Œå°±shutdownè¿æ¥ã€‚(æˆ‘è§‰å¾—è¿™é‡Œåº”è¯¥åŠ å…¥é‡è¯•ï¼Œä¾‹å¦‚ä¸‰æ¬¡å¤±è´¥å†æ–­çº¿)&lt;/p>
&lt;p>å¦‚æœå“åº”æ¥äº†ï¼Œå…ˆä¼šè°ƒç”¨ä¸€ä¸ªæ¿€æ´»fdçš„æ“ä½œï¼Œå°†å“åº”æ”¾åˆ°å°è£…fdçš„ç»“æ„ä½“ä¸­ï¼Œå†å°†è‡ªå·±æ”¾å›åˆ°epollè°ƒåº¦ï¼Œæœ€åé¡ºæ‰‹ç»™epollå‘ä¸€ä¸ªä¿¡å·ã€‚å½“fdå¯å†™æ—¶ï¼Œå†æŠŠå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>ç”±äºphxrpcä½¿ç”¨çš„é€šä¿¡åè®®æ˜¯HTTPï¼Œæ‰€ä»¥ä¸éœ€è¦è€ƒè™‘åˆ†åŒ…çš„é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="å¯èƒ½çš„æ”¹è¿›">å¯èƒ½çš„æ”¹è¿› &lt;a href="#%e5%8f%af%e8%83%bd%e7%9a%84%e6%94%b9%e8%bf%9b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="è°ƒåº¦å™¨çš„è¶…æ—¶">è°ƒåº¦å™¨çš„è¶…æ—¶ &lt;a href="#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e8%b6%85%e6%97%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> nfds &lt;span style="color:#f92672">=&lt;/span> epoll_wait(epoll_fd_, events, max_task_, &lt;span style="color:#ae81ff">4&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µè°ƒåº¦å™¨ä¸­çš„ä»£ç ï¼Œç”Ÿç”Ÿçš„æŠŠIOå¤ç”¨æ¨¡å‹æ”¹æˆäº†è½®è¯¢ã€‚çŒœæµ‹è¿™æ˜¯ä¸ºäº†ç…§é¡¾è¶…æ—¶å®šæ—¶å™¨ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå¹¶æ— å¿…è¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>timerfd&lt;/code>å’Œ&lt;code>eventfd&lt;/code>æ¥å–ä»£å®šæ—¶å™¨ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ç§çŒœæµ‹ï¼Œè¿™ç§å†™æ³•å¯èƒ½ä¹Ÿæ˜¯æœ‰æ€§èƒ½ä¸Šçš„è€ƒè™‘å§ã€‚&lt;/p>
&lt;h3 id="ä»£ç é£æ ¼">ä»£ç é£æ ¼ &lt;a href="#%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»£ç é£æ ¼å¯èƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ³›çš„é—®é¢˜ï¼Œä½†æ˜¯phxrpcçš„ä»£ç æˆ‘èƒ½æ˜æ˜¾çš„æ„Ÿè§‰åˆ°ç¼–ç é£æ ¼çš„ä¸åŒã€‚ä»¥åŠå…ƒç´ å±‚æ¬¡ä¸æ˜æœ—ï¼Œä¸Šä¸‹çº§æ¨¡å—ç›¸äº’è€¦åˆçš„æƒ…å†µã€‚&lt;/p>
&lt;h3 id="æ²¡æœ‰æµ‹è¯•æ²¡æœ‰æµ‹è¯•æ²¡æœ‰æµ‹è¯•">æ²¡æœ‰æµ‹è¯•ï¼æ²¡æœ‰æµ‹è¯•ï¼æ²¡æœ‰æµ‹è¯•ï¼ &lt;a href="#%e6%b2%a1%e6%9c%89%e6%b5%8b%e8%af%95%e6%b2%a1%e6%9c%89%e6%b5%8b%e8%af%95%e6%b2%a1%e6%9c%89%e6%b5%8b%e8%af%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å› ä¸ºphxrpcæ²¡æœ‰æµ‹è¯•ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä¸¥é‡æ€€ç–‘è¿™å°±æ˜¯ä¸€ä¸ªç©ç¥¨çš„é¡¹ç›®ï¼Œæ²¡æœ‰ï¼ˆæˆ–æš‚æ—¶æ²¡æœ‰ï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šè¿è¡Œã€‚&lt;/p>
&lt;p>å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œè¯·åŠ ä¸Šæ€§èƒ½æµ‹è¯•ï¼è¯·åŠ ä¸ŠåŠŸèƒ½æµ‹è¯•ï¼è¯·åŠ ä¸Šæ€§åŠŸèƒ½æµ‹è¯•ï¼&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ—¶é—´ä»“ä¿ƒï¼Œæ°´å¹³æœ‰é™ã€‚å†™ç‚¹ä¸œè¥¿ï¼Œæ–¹ä¾¿å¤§å®¶å­¦ä¹ äº¤æµã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘å†™çš„å“ªé‡Œä¸å¯¹ï¼Œ99%çš„é”…å½’æˆ‘å‚»é€¼ï¼Œ1%çš„é”…å½’phxrpcä»£ç æ²¡å†™æµ‹è¯•ã€‚æ¬¢è¿å¤§å®¶å¤šåšè‡ªæˆ‘æ‰¹è¯„ã€‚&lt;/p>
&lt;p>å¥½å•¦å¥½å•¦ï¼Œå°±åˆ°è¿™é‡Œå§ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-23/91802175.jpg" alt="">&lt;/p></description></item><item><title>RPC - phxrpcä»£ç é˜…è¯»(7)</title><link>https://wizmann.top/posts/phxrpc-7/</link><pubDate>Sat, 22 Oct 2016 23:03:36 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-7/</guid><description>&lt;h2 id="å‰è¨€">å‰è¨€ &lt;a href="#%e5%89%8d%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>çœ‹äº†è¿™ä¹ˆä¹…ä»£ç ï¼Œç»ˆäºæˆ‘ä»¬è¦æ¥è¿‘phxrpcçš„æ ¸å¿ƒéƒ¨åˆ†äº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å‡ºäººæ„æ–™çš„æ˜¯ï¼Œrpcéƒ¨åˆ†å¹¶æ²¡æœ‰è¿‡å¤šçš„æ¦‚å¿µå’Œmagic trickã€‚è€Œä¸”å› ä¸ºucontextå·²ç»è¢«å°è£…å¥½äº†ï¼Œæ‰€ä»¥åœ¨rpcé‡Œçš„æ“ä½œï¼Œå¯ä»¥å®Œå…¨æŒ‰ç…§åŒæ­¥çš„å†™æ³•æ¥æï¼Œå¼€å‘è€…ä»¬ä¸éœ€è¦åˆ‡æ¢åŒæ­¥å¼‚æ­¥çš„æ€ç»´æ¨¡å¼ï¼Œå°±å¯ä»¥åœ¨åº•å±‚çš„å°è£…ä¹‹ä¸Šï¼Œåšè‡ªå·±æƒ³åšçš„äº‹äº†ã€‚&lt;/p>
&lt;h2 id="çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—---threadqueue">çº¿ç¨‹å®‰å…¨(?)çš„é˜Ÿåˆ— - ThreadQueue &lt;a href="#%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%9a%84%e9%98%9f%e5%88%97---threadqueue" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä¸çŸ¥é“å¼€å‘è€…ä¸ºå•¥è¦èµ·&lt;code>ThdQueue&lt;/code>è¿™æ ·ä»¤äººè¿·æƒ‘çš„åå­—ï¼Œè¿™ç§è¯¡å¼‚çš„å‘½åé£æ ¼è´¯ç©¿äº†æ•´ä¸ªä»£ç ã€‚å’‹ä¸€çœ‹è¿™ä¸ªç±»æ˜¯maintainä¸€å †çº¿ç¨‹çš„ï¼Œç±»ä¼¼äºçº¿ç¨‹æ± ï¼Œä½†å…¶å®è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ª&lt;code>BlockingQueue&lt;/code>çš„å®ç°ã€‚&lt;/p>
&lt;p>ä¹‹åï¼Œè¿™ä¸ªé˜Ÿåˆ—æœ‰ä¸‰ç§æ“ä½œï¼Œ&lt;code>push&lt;/code>ã€&lt;code>pluck&lt;/code>å’Œ&lt;code>break_out&lt;/code>ã€‚pushæ“ä½œä¸ç”¨å¤šè¯´ï¼Œpluckå¯¹åº”çš„æˆ‘ä»¬æ‰€ç†è§£çš„popæ“ä½œï¼Œå³ä»é˜Ÿåˆ—ä¸­å¼¹å‡ºå…ƒç´ ï¼ˆpluckè¿™ä¸ªè¯è²Œä¼¼æ˜¯ä»grpcé‡Œé¢æ¥çš„ï¼Œé‚£æˆ‘å°±ä¸åæ§½äº†ï¼Œæ¯•ç«ŸGoogleçˆ¸çˆ¸ï¼‰ã€‚&lt;/p>
&lt;p>æ›´ä»¤äººç–‘æƒ‘çš„æ˜¯&lt;code>break_out&lt;/code>è¿™ä¸ªæ“ä½œã€‚ä»ä»£ç æ¥çœ‹ï¼Œåƒæ˜¯æ¸…ç©ºé˜Ÿåˆ—ï¼Œå¹¶ä¸”åœ¨dtorä¸­ä¹Ÿæ˜¾å¼çš„è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æœ‰ä»¥ä¸‹çš„å‡ ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸€ï¼Œ&lt;code>break_out_&lt;/code>æ˜¯ä¸€ä¸ªboolå˜é‡ï¼Œä¸”åœ¨ä¸åŒçº¿ç¨‹é—´å…±äº«ï¼Œé—®é¢˜åœ¨äºè¿™ä¸ªå˜é‡å¯èƒ½è¢«cacheä½ï¼Œç›´æ¥è®¿é—®å¯èƒ½ä¼šé€ æˆéé¢„æœŸçš„ç»“æœï¼Œå¯èƒ½éœ€è¦&lt;code>volitaile&lt;/code>ï¼Œæˆ–è€…åœ¨&lt;code>pluck&lt;/code>å‡½æ•°é‡ŒåŠ ä¸€ä¸ªmem barrierã€‚&lt;/p>
&lt;p>äºŒæ¥ï¼Œåœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨&lt;code>break_out_&lt;/code>ï¼Œæœ‰å¯èƒ½çš„ä¸€ç§æƒ…å†µæ˜¯æœ‰å…¶å®ƒçº¿ç¨‹è¿˜åœ¨&lt;code>pluck&lt;/code>å‡½æ•°ä¸­ï¼Œè€Œ&lt;code>ThdQueue&lt;/code>å¯¹è±¡å·²ç»è¢«ææ„äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¿æ‹…è¿™ç§ä¸å®‰å…¨è¡Œä¸ºçš„åæœï¼ˆæ­¤å¤„æœ‰å¹¿å‘Šï¼šå¤§é“æ£å­åŒ»é™¢æ…ä¸»ä»»ï¼Œå¼ å§å»äº†éƒ½è¯´å¥½ï¼‰ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°åªåœ¨ç»“æŸè¿›ç¨‹æ—¶ä½¿ç”¨ï¼Œå…¶å®å†™çš„ç³™ä¸€ç‚¹ä¹Ÿæ— æ‰€è°“ï¼Œå› ä¸ºæ¯•ç«Ÿçº¿ä¸ŠæœåŠ¡æ˜¯æ²¡æœ‰â€œé€€å‡ºâ€è¿™ç§çŠ¶æ€çš„ã€‚å½“æˆ‘ä»¬è¦æ¸…ç©ºé˜Ÿåˆ—æ—¶ï¼Œå·²ç»ä¸éœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¹‹åç›´æ¥&lt;code>kill -9&lt;/code>å°±å¥½ï¼Œä¸ä¼šè§¦å‘å¤šçº¿ç¨‹çš„å‘ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæˆ‘è§‰å¾—åº”è¯¥è¿˜æ˜¯è¦åŠ å°å¿ƒã€‚&lt;/p>
&lt;h2 id="uthreadcaller">UThreadCaller &lt;a href="#uthreadcaller" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªç ´ç±»è®©æˆ‘çœ‹äº†ä¸€å°æ—¶ï¼Œåˆ†æå®ƒçš„keepaliveæ˜¯æ€ä¹ˆå®ç°çš„ã€‚ç»“æœå‘ç°è¿™ä¸ªç±»è¢«æ²¡æœ‰è¢«è°ƒç”¨ã€‚&lt;/p>
&lt;p>GGã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-22/54117736.jpg" alt="">&lt;/p>
&lt;h2 id="ä¸€ä¸ªè¶…çº§æ–‡ä»¶---hshaserver">ä¸€ä¸ªè¶…çº§æ–‡ä»¶ - HshaServer &lt;a href="#%e4%b8%80%e4%b8%aa%e8%b6%85%e7%ba%a7%e6%96%87%e4%bb%b6---hshaserver" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ä¸çŸ¥é“ä¸ºå•¥å¼€å‘è€…è¦æŠŠè¿™ä¹ˆå¤šæ–‡ä»¶å†™ä¸€å—ï¼Œæ‹†å¼€ä¸å¥½å—ï¼Ÿ&lt;/p>&lt;/blockquote>
&lt;h3 id="dataflow">DataFlow &lt;a href="#dataflow" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>DataFlowåŒ…å«äº†Requestå’ŒResponseä¸¤ä¸ªQueueï¼Œè¿˜é™„åŠ äº†å…¥é˜Ÿçš„æ—¶é—´æˆ³å’Œä¸€ä¸ªargså‚æ•°æŒ‡é’ˆã€‚&lt;/p>
&lt;h3 id="hshaserverstat">HshaServerStat &lt;a href="#hshaserverstat" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸€ä¸ªç»Ÿè®¡ç±»ã€‚ä¼šåœ¨åå°æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œçº¦æ¯ä¸€ç§’æ‰“å°ä¸€æ¬¡ç»Ÿè®¡æ—¥å¿—ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç±»é‡Œæœ‰ä¸€ä¸ªæŠ€å·§ï¼Œåœ¨&lt;code>CallFunc()&lt;/code>å‡½æ•°ä¸­ï¼Œæ¯ä¸€ç§’å¾ªç¯ä¸€æ¬¡å¹¶æ²¡æœ‰ä½¿ç”¨sleepå®¶æ—çš„å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨selectçš„è¶…æ—¶ã€‚è€Œæ˜¯ä½¿ç”¨äº†&lt;code>condtional variable&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>std::condition_variable::wait_for&lt;/code>å‡½æ•°ï¼Œå®è´¨æ˜¯å°±æ˜¯å¸¦è¶…æ—¶çš„ç­‰å¾…ã€‚è€Œè¿™é‡Œï¼Œåœ¨ä¸€èˆ¬çŠ¶æ€ä¸‹ï¼Œæ˜¯æ²¡æœ‰çº¿ç¨‹ä¼šnotifyçš„ï¼Œæ‰€ä»¥wait_forå‡½æ•°ä¼šç¡æ»¡1sã€‚ä½†æ˜¯åœ¨é€€å‡ºæ—¶ï¼Œä¼šæ˜¾å¼çš„notifyç»Ÿè®¡çº¿ç¨‹ï¼Œç ´åç­‰å¾…çŠ¶æ€ï¼Œä½¿ç»Ÿè®¡çº¿ç¨‹é€€å‡ºã€‚&lt;/p>
&lt;p>&lt;code>wait_for&lt;/code>å‡½æ•°çš„å…·ä½“ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ&lt;a href="http://en.cppreference.com/w/cpp/thread/condition_variable/wait_for">æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸‹é¢çš„&lt;code>HshaServerQos&lt;/code>ä¹Ÿæ˜¯ä¸€æ ·çš„æ€è·¯ï¼ŒQoså³â€œQuality of serviceâ€ã€‚&lt;/p>
&lt;h3 id="workerå’Œworkerpool">Workerå’ŒWorkerPool &lt;a href="#worker%e5%92%8cworkerpool" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸¤ä¸ªç±»å…¶å®æ˜¯ä¸€ä¸ªå’Œä¸€å †çš„å…³ç³»ï¼Œä¸è¿‡ç”±äºè¿™é‡Œçš„è¯¡å¼‚çš„å†™æ³•ï¼Œå¯¼è‡´ä¸€ä¸ªä¾èµ–ä¸€å †ï¼Œä¸€å †è°ƒç”¨ä¸€ä¸ªã€‚&lt;/p>
&lt;p>WorkerPoolæ˜¯ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± ï¼Œé‡Œé¢æœ‰çº¿ç¨‹ï¼ˆåºŸè¯ï¼‰ï¼Œè¾“å…¥è¾“å‡ºé˜Ÿåˆ—ï¼ŒDisipatcherå’Œè°ƒåº¦å™¨ã€‚æ‰€ä»¥Workerè¦åè¿‡æ¥ä¾èµ–WorkerPoolé‡Œé¢çš„æ•°æ®ã€‚é€ æˆäº†å¾ˆå¤§çš„è€¦åˆæ€§ã€‚&lt;/p>
&lt;p>Workerä»è¾“å…¥é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨&lt;code>dispatcher&lt;/code>è¿›è¡ŒCPUå¯†é›†çš„å¤„ç†ï¼ˆæˆ‘è§‰å¾—&lt;code>dispatcher&lt;/code>è¿™ä¸ªåå­—èµ·çš„ä¹Ÿæœ‰é—®é¢˜ï¼‰ã€‚ä¹‹åå°†ç»“æœæ”¾å…¥è¾“å‡ºé˜Ÿåˆ—ï¼Œç”±åé¢çš„&lt;code>HshaServerIO::ActiveSocketFunc&lt;/code>é©±åŠ¨åç¨‹åº“è¿›è¡Œä¹‹åçš„IOæ“ä½œã€‚&lt;/p>
&lt;h3 id="å®Œæˆè°ƒåº¦å™¨---hshaserverio">å®Œæˆè°ƒåº¦å™¨ - HshaServerIO &lt;a href="#%e5%ae%8c%e6%88%90%e8%b0%83%e5%ba%a6%e5%99%a8---hshaserverio" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨å°±æ˜¯è¡¥å…¨è°ƒåº¦å™¨ç¼ºå°‘çš„å‡½æ•°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªIOçš„å·¥ä½œå‡½æ•°&lt;code>HshaServerIO::IOFunc&lt;/code>ã€‚&lt;/p>
&lt;p>è°ƒåº¦å™¨çš„å·¥ä½œæµç¨‹å‰é¢å·²ç»è¯´è¿‡äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±ä»æ›´å…·ä½“åŒ–çš„å®ç°ä¸Šæ¥é˜…è¯»ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;code>HshaServerIO :: AddAcceptedFd&lt;/code>ï¼Œè¿™ä¸ªå‡½æ•°ç”±å¤–éƒ¨è°ƒç”¨ï¼Œä¼ å…¥å·²ç»acceptçš„fdï¼Œä¹‹å&lt;code>HshaServerIO::HandlerAcceptedFd&lt;/code>å°†è¿™ä¸ªfdï¼Œå’ŒIOå·¥ä½œå‡½æ•°&lt;code>IOFunc&lt;/code>ä¸€èµ·æ”¾å…¥è°ƒåº¦å™¨ä¸­è¿›è¡Œè°ƒåº¦ã€‚&lt;/p>
&lt;p>å·¥ä½œå‡½æ•°&lt;code>IOFunc&lt;/code>åªè´Ÿè´£å°†è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ï¼Œè€Œå¹¶ä¸è´Ÿè´£ä»è¾“å‡ºé˜Ÿåˆ—ä¸­å–å‡ºå“åº”ã€‚è¿™ä¸ªäº‹æƒ…ç”±&lt;code>HshaServerIO::ActiveSocketFunc&lt;/code>è´Ÿè´£ã€‚&lt;/p>
&lt;p>æ¢å¥è¯è¯´ï¼Œåœ¨è°ƒåº¦å™¨çš„å·¥ä½œå¾ªç¯ä¸­ï¼Œ&lt;code>epoll_wait&lt;/code>ä¸­ç­‰å¾…çš„åªæœ‰åœ¨è¿›è¡ŒIOçš„ä¸¤ç§fdï¼Œä¸€æ˜¯è¯»è¿˜æ²¡è¯»å®Œçš„ï¼ŒäºŒæ˜¯å†™è¿˜æ²¡å†™å®Œçš„ã€‚&lt;/p>
&lt;p>è¿›è¡Œå®ŒCPUæ“ä½œçš„fdï¼Œç”±&lt;code>active_socket_func_&lt;/code>å‡½æ•°é‡æ–°æ¿€æ´»ï¼Œå‘å®¢æˆ·ç«¯å†™å›å“åº”ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°åº”è¯¥å«&lt;code>activate_socket_with_resp_func_&lt;/code>æ›´åˆé€‚ä¸€äº›ã€‚ï¼ˆè‡³å°‘ç¬¬ä¸€ä¸ªå•è¯å¾—æ˜¯ä¸ªåŠ¨è¯å¥½ä¸ã€‚ï¼‰&lt;/p>
&lt;p>åé¢çš„keepaliveçš„å¤„ç†ä¹Ÿæ˜¯éå¸¸æµ…æ˜¾çš„ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;h3 id="å¤šçº¿ç¨‹io---hshaserverunitå’Œhshaserver">å¤šçº¿ç¨‹IO - HshaServerUnitå’ŒHshaServer &lt;a href="#%e5%a4%9a%e7%ba%bf%e7%a8%8bio---hshaserverunit%e5%92%8chshaserver" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‰é¢æˆ‘ä»¬è¯´äº†ä¸å°‘åç¨‹çš„äº‹ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨æˆ‘ä»¬ä¸ä½¿ç”¨å¤šçº¿ç¨‹å¸¦æ¥çš„çº¢åˆ©ã€‚æˆ–è€…è‡³å°‘åœ¨æ€§èƒ½ä¸ç¬¦åˆé¢„æœŸçš„æ—¶å€™ï¼Œç”¨å¤šçº¿ç¨‹æ¥tuningä¸€ä¸‹ã€‚&lt;/p>
&lt;p>HashServerUnitåŒ…è£…äº†ä¸€ç»„çº¿ç¨‹ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªIOçº¿ç¨‹å’Œè‹¥å¹²CPUçº¿ç¨‹ã€‚æˆ‘ä»¬åœ¨HshaServerä¸­ï¼Œè¿˜å¯ä»¥é…ç½®å¤šä¸ªUnitï¼Œä½¿å¾—æˆ‘ä»¬æœ‰å¤šä¸ªIOçº¿ç¨‹ï¼Œå……åˆ†æ¦¨å¹²CPUå’ŒIOçš„æ¯ä¸€æ»´æ±—æ°´ã€‚&lt;/p>
&lt;p>ç”±äºæ‰‹é‡Œä¹Ÿæ²¡æœ‰æµ‹è¯•æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½æ›´è¯¦ç»†çš„æ¥è¯´é…ç½®æœåŠ¡å‚æ•°çš„ç­–ç•¥ã€‚ä½†æ˜¯æ— è´£ä»»çŒœæµ‹ï¼ŒIOçº¿ç¨‹åº”è¯¥ä¸è¶…è¿‡3ä¸ªã€‚CPUçº¿ç¨‹æ•°ç›®åº”è¯¥ç•¥å¤šäºCPUæ ¸æ•°ã€‚&lt;/p>
&lt;h3 id="ä¸€ä¸ªç‹¬ç«‹çš„acceptor">ä¸€ä¸ªç‹¬ç«‹çš„Acceptor &lt;a href="#%e4%b8%80%e4%b8%aa%e7%8b%ac%e7%ab%8b%e7%9a%84acceptor" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>HshaServerAcceptor&lt;/code>ç±»ç›¸å¯¹æ¯”è¾ƒç‹¬ç«‹ï¼Œå®ƒæ˜¯ç”¨æ¥æ¥å—è®¿é—®è¯·æ±‚ã€‚æ˜¯ä¸»çº¿ç¨‹çš„å·¥ä½œå¾ªç¯ã€‚&lt;/p>
&lt;p>è¿™é‡Œæ¯”è¾ƒå¥‡æ€ªçš„æ˜¯ï¼Œ&lt;code>LoopAccept&lt;/code>å‡½æ•°è®¾ç½®äº†CPUäº²å’Œæ€§ã€‚ä½¿å¾—æ§åˆ¶çº¿ç¨‹åªåœ¨CPU0ä¸Šè¿è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span> cpu_set_t mask;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_ZERO(&lt;span style="color:#f92672">&amp;amp;&lt;/span>mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_SET(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pid_t thread_id &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ret &lt;span style="color:#f92672">=&lt;/span> sched_setaffinity(thread_id, &lt;span style="color:#66d9ef">sizeof&lt;/span>(mask), &lt;span style="color:#f92672">&amp;amp;&lt;/span>mask);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“åŸå› æœ‰å¾…æ¢è®¨ï¼Œå¯èƒ½æ˜¯å’Œä¸­æ–­äº²å’Œæ€§æœ‰å…³ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨åé¢">å†™åœ¨åé¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%90%8e%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ€»ç®—å›«å›µåæ£çš„æŠŠè¿™RPCè¯»å®Œäº†ï¼Œå…¶å®è¿™é‡Œè¿˜æ˜¯æœ‰å¥½å¤šç–‘é—®çš„ã€‚ä½†æ˜¯ç”±äºphxrpcçš„æ–‡æ¡£å®åœ¨æ˜¯ã€‚ã€‚ã€‚åŸºæœ¬ç®—æ˜¯æ²¡æœ‰å§ã€‚æ‰€ä»¥å¯èƒ½è¿˜è¦å»Githubä¸Šæä¸€æ³¢Issueã€‚&lt;/p>
&lt;p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼ŒçœŸçš„æ„Ÿè§‰è‡ªå·±æ‡‚çš„è¿˜æ˜¯å¤ªå°‘ã€‚ç®€ç›´è¯ä¸¸ã€‚&lt;/p>
&lt;p>è¿˜éœ€è¦æ›´åŠ åŠªåŠ›æ‰å¥½ã€‚&lt;/p></description></item><item><title>éé˜»å¡TCPæµå’ŒHttpClient - phxrpcä»£ç é˜…è¯»(6)</title><link>https://wizmann.top/posts/phxrpc-6/</link><pubDate>Wed, 19 Oct 2016 00:03:12 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-6/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å…¶å®è¿™ç‚¹ä¸œè¥¿æœ‰ç‚¹é¸¡è‚‹ã€‚å› ä¸ºTCPæµåœ¨å‰é¢å·²ç»è®²è¿‡ï¼Œéš¾ç‚¹åœ¨äºâ€œæµâ€å’Œâ€œæµç¼“å†²åŒºâ€éƒ¨åˆ†ã€‚è€ŒHttpClientåªæ˜¯TCPæµçš„ä¸€ä¸ªåº”ç”¨ï¼Œä»£ç ä¸å¤šï¼Œä¸”é‡ç‚¹åœ¨äºHTTPåè®®çš„è°ƒæ•™ä¸Šé¢ã€‚&lt;/p>
&lt;p>ä¸è¿‡å› ä¸ºå‰é¢æœ‰å†™é˜»å¡TCPæµï¼Œè¿˜æ˜¯å‰åå‘¼åº”ï¼ŒæŠŠéé˜»å¡TCPæµä¹Ÿå°å°çš„è®²è§£ä¸€ä¸‹ã€‚é¡ºä¾¿é¥¶ä¸€æ®µHttpClientçš„è®²è§£ï¼Œç®—æ˜¯å……å®ä¸€ä¸‹å†…å®¹å§ã€‚&lt;/p>
&lt;h2 id="éé˜»å¡tcpæµç¼“å†²åŒº---uthreadtcpstreambuf">éé˜»å¡TCPæµç¼“å†²åŒº - &lt;code>UThreadTcpStreamBuf&lt;/code> &lt;a href="#%e9%9d%9e%e9%98%bb%e5%a1%9etcp%e6%b5%81%e7%bc%93%e5%86%b2%e5%8c%ba---uthreadtcpstreambuf" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªå…¶å®æ²¡å•¥å¯è®²çš„ï¼Œä¼ å…¥ä¸€ä¸ª&lt;code>socket&lt;/code>ï¼Œç„¶åè¯»å†™åˆ†åˆ«è°ƒç”¨&lt;code>UThreadRecv&lt;/code>å’Œ&lt;code>UThreadSend&lt;/code>ï¼ŒIOå¤ç”¨å’Œåç¨‹åˆ‡æ¢çš„å¤æ‚æ“ä½œéƒ½è¢«å°è£…åœ¨é‡Œé¢äº†ã€‚å‰©ä¸‹çš„æ“ä½œéƒ½ç”±åŸºç±»å‡½æ•°æ¥è§£å†³ã€‚&lt;/p>
&lt;h2 id="éé˜»å¡tcpæµ---uthreadtcpstream">éé˜»å¡TCPæµ - &lt;code>UThreadTcpStream&lt;/code> &lt;a href="#%e9%9d%9e%e9%98%bb%e5%a1%9etcp%e6%b5%81---uthreadtcpstream" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ç¡®å®æ²¡å•¥å¯è¯´çš„ï¼Œä½ ä»¬è‡ªå·±å»è¯»ä»£ç å§ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;p>éé˜»å¡TCPæµå’Œé˜»å¡TCPæµçš„åŒºåˆ«æ˜¯&lt;del>å®ƒä¸é˜»å¡&lt;/del>ï¼Œåœ¨é˜»å¡TCPæµä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯ä¸€ä¸ªTCPæµï¼Œè€Œéé˜»å¡TCPæµä¼ å…¥çš„æ˜¯ä¸€ä¸ªåç¨‹è°ƒåº¦å™¨å’Œä¸€ä¸ªTCPæµã€‚&lt;/p>
&lt;p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªé˜»å¡æµè‡ªç„¶ä¼šå æ»¡ä¸€ä¸ªçº¿ç¨‹çš„IOå’ŒCPU â€”â€” åœ¨é˜»å¡æµIOè¯»å†™æ—¶ï¼ŒCPUç©ºé—²ï¼›åœ¨CPUå¿™æ—¶ï¼ŒIOç©ºé—²ã€‚&lt;/p>
&lt;p>è€Œéé˜»å¡æµä¼šå°†è‡ªå·±IO waitçš„æ—¶é—´æ‰˜ç®¡ç»™epollï¼ŒæŠŠå‰©ä¸‹çš„æ—¶é—´ç”¨äºCPUè®¡ç®—ï¼ˆå’Œä¸€äº›overheadä¸Šï¼‰ã€‚æ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹å¯ä»¥handleå¤šä¸ªsocketï¼Œåç¨‹è°ƒåº¦å™¨å°±æ˜¯å¿…é¡»çš„äº†ã€‚ä¹‹åçš„è¯»å†™æ“ä½œå°±äº¤ç”±æˆ‘ä»¬å‰é¢è®¨è®ºè¿‡çš„epollå’Œucontextåç¨‹æ¥å…±åŒå®Œæˆäº†ã€‚&lt;/p>
&lt;h2 id="httpclient">HttpClient &lt;a href="#httpclient" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å…¶å®è¿™é‡Œåˆ†æHttpClientçš„æ„ä¹‰ä¸æ˜¯å¾ˆå¤§ï¼Œå› ä¸ºHttpæ¯•ç«Ÿæ˜¯ä¸€ä¸ªæˆç†Ÿçš„åè®®ï¼Œç„¶åç›¸åº”çš„è®¾ç½®å«ä¹‰è™½ç„¶æ˜ç¡®ï¼Œä½†æ˜¯æ”¾åˆ°ç›¸åº”çš„ä¸Šä¸‹æ–‡ä¸­åˆ†ææ¯”è¾ƒå¥½ã€‚&lt;/p>
&lt;p>è¿™ç¯‡åšæ–‡&lt;a href="https://www.byvoid.com/blog/http-keep-alive-header">ã€ŠHTTPåè®®å¤´éƒ¨ä¸Keep-Aliveæ¨¡å¼è¯¦è§£ã€‹&lt;/a>ä¸­æœ‰ä¸€éƒ¨åˆ†èƒŒæ™¯çŸ¥è¯†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="åœ¨httpdispatcherä¸­ä½¿ç”¨çš„ä¸€ä¸ªå°æŠ€å·§">åœ¨HttpDispatcherä¸­ä½¿ç”¨çš„ä¸€ä¸ªå°æŠ€å·§ &lt;a href="#%e5%9c%a8httpdispatcher%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%9a%84%e4%b8%80%e4%b8%aa%e5%b0%8f%e6%8a%80%e5%b7%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨&lt;code>http_dispatcher.h&lt;/code>æ–‡ä»¶ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†ä¸€ä¸ªæ¯”è¾ƒæ–°å¥‡çš„æŠ€å·§ï¼šâ€œ&lt;a href="http://tipsandtricks.runicsoft.com/Cpp/MemberFunctionPointers.html">Function Pointers to Member Functions&lt;/a>â€ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä»£ç ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>typedef int (Dispatcher::*URIFunc_t)(const HttpRequest &amp;amp; request, HttpResponse * response);
&lt;/code>&lt;/pre>&lt;p>è¿™è¡Œä»£ç çš„æ„æ€æ˜¯ï¼Œä¸ºä¸€ä¸ªå‚æ•°ä¸º&lt;code>(const HttpRequest&amp;amp;, HttpResponse*)&lt;/code>ä¸”è¿”å›å€¼ä¸º&lt;code>int&lt;/code>çš„å‡½æ•°å£°æ˜ä¸€ä¸ªåˆ«å&lt;code>URIFunc_t&lt;/code>ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°ï¼Œä¸€å®šæ˜¯&lt;code>Dispatcher&lt;/code>ç±»çš„æˆå‘˜å‡½æ•°ã€‚&lt;/p>
&lt;p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½è¿˜æ˜¯æ­£å¸¸çš„æ ·å­ï¼Œè¯­æ³•ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è§çš„ç±»å‹ã€‚ä½†æ˜¯ä¸‹é¢è¿™ç§å†™æ³•ï¼Œç¡®å®æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>if (uri_func_map_.end() != iter) {
ret = (dispatcher_.*iter-&amp;gt;second)(request, response);
}
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œçš„&lt;code>(dispatcher_.*iter-&amp;gt;second)&lt;/code>ï¼Œ&lt;code>iter-&amp;gt;second&lt;/code>æ˜¯ä»mapä¸­æ‹¿å‡ºæ¥çš„ï¼Œåœ¨&lt;code>dispatcher_&lt;/code>å¯¹è±¡ä¸­çš„æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆã€‚æˆ‘ä»¬ä½¿ç”¨æ˜Ÿå·è§£å¼•ç”¨ï¼Œå†æŠŠå®ƒå’Œ&lt;code>dispatcher_&lt;/code>å¯¹è±¡æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œåƒæ­£å¸¸è°ƒç”¨æˆå‘˜å‡½æ•°ä¸€æ ·è°ƒç”¨å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h2 id="è²Œä¼¼å†™çš„æœ‰ç‚¹å°‘å†é¥¶ä¸€æ®µå§---epollæµ‹è¯•æœåŠ¡ç«¯å®¢æˆ·ç«¯">è²Œä¼¼å†™çš„æœ‰ç‚¹å°‘ï¼Œå†é¥¶ä¸€æ®µå§ - epollæµ‹è¯•æœåŠ¡ç«¯/å®¢æˆ·ç«¯ &lt;a href="#%e8%b2%8c%e4%bc%bc%e5%86%99%e7%9a%84%e6%9c%89%e7%82%b9%e5%b0%91%e5%86%8d%e9%a5%b6%e4%b8%80%e6%ae%b5%e5%90%a7---epoll%e6%b5%8b%e8%af%95%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%ae%a2%e6%88%b7%e7%ab%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬ç¿»ç¯‡å›åˆ°&lt;code>network&lt;/code>æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œçœ‹ä¸€ä¸‹&lt;code>test_epoll_[server|client].[h|cpp]&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="epollæµ‹è¯•å®¢æˆ·ç«¯">epollæµ‹è¯•å®¢æˆ·ç«¯ &lt;a href="#epoll%e6%b5%8b%e8%af%95%e5%ae%a2%e6%88%b7%e7%ab%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼Œæ–°å»ºä¸€ä¸ªè°ƒåº¦å™¨ï¼Œç”±å‚æ•°å†³å®šè°ƒåº¦å™¨çš„wokeråç¨‹æ•°é‡ã€‚ä¹‹åæ–°å»º&lt;code>UThreadEpollArgs_t&lt;/code>ï¼ŒæŠŠè°ƒåº¦å™¨æŒ‡é’ˆå¡è¿›å»ã€‚å†ä¹‹åæŠŠ&lt;code>echoclient&lt;/code>å·¥ä½œå‡½æ•°å’Œ&lt;code>args&lt;/code>å‚æ•°æ”¾ç”±è°ƒåº¦å™¨ä¸­è¿›è¡Œè°ƒåº¦ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å·¥ä½œå‡½æ•°&lt;code>echoclient&lt;/code>ã€‚&lt;/p>
&lt;p>å·¥ä½œå‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯ç”³è¯·ä¸€ä¸ªsocket fdï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>int fd = ::socket(AF_INET, SOCK_STREAM, IPPROTO_IP);
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹æœ€åä¸€ä¸ªå‚æ•°&lt;code>IPPROTO_IP&lt;/code>ï¼š&lt;/p>
&lt;blockquote>
&lt;p>In the in.h file, the comment says: Dummy protocol for TCP. &lt;br>
This constant has the value 0. It&amp;rsquo;s actually an automatic choice depending on socket type and family. &lt;br>
If you use it, and if the socket type is SOCK_STREAM and the family is AF_INET, then the protocol will automatically be TCP (exactly the same as if you&amp;rsquo;d used IPPROTO_TCP). Buf if you use IPPROTO_IP together with AF_INET and SOCK_RAW, you will have an error, because the kernel cannot choose a protocol automatically in this case.&lt;/p>&lt;/blockquote>
&lt;p>è¿™ä¸ªå‚æ•°çš„æ„ä¹‰æ˜¯å‘Šè¯‰å†…æ ¸ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªé€‰é¡¹çš„è¯ï¼Œä½ ç‰¹ä¹ˆçˆ±ç”¨å“ªä¸ªåè®®å°±ç”¨å“ªä¸ªå§ã€‚æ‰€ä»¥æœ‰ä¸€äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç›´æ¥æŠŠæœ€åä¸€ä¸ªå‚æ•°å†™æˆ0ï¼Œè¿™å°±æ˜¯&lt;code>IPPROTO_IP&lt;/code>å®çš„å­—é¢å€¼ã€‚&lt;/p>
&lt;p>æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª&lt;a href="http://stackoverflow.com/questions/24590818/what-is-the-difference-between-ipproto-ip-and-ipproto-raw">é—®é¢˜&lt;/a>ã€‚&lt;/p>
&lt;p>åé¢çš„æµç¨‹éå¸¸ç®€å•ï¼Œå…ˆæ¥æ”¶serverå‘æ¥çš„æ¬¢è¿ä¿¡æ¯ï¼Œä¹‹åping pongåæ¬¡ï¼Œå‘é€â€œquitâ€åŒ…åç»“æŸåç¨‹ã€‚&lt;/p>
&lt;h3 id="epollæµ‹è¯•æœåŠ¡ç«¯">epollæµ‹è¯•æœåŠ¡ç«¯ &lt;a href="#epoll%e6%b5%8b%e8%af%95%e6%9c%8d%e5%8a%a1%e7%ab%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŒºåˆ«ä¸å¤§ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå®¢æˆ·ç«¯åœ¨ä¸€å¼€å§‹åªæœ‰ä¸€ä¸ªåç¨‹ã€‚ä¹‹ååœ¨acceptè¿æ¥æ—¶ï¼Œä¼šä¸»åŠ¨æ–°å»ºå·¥ä½œåç¨‹ã€‚&lt;/p>
&lt;p>è¿™é‡Œè§£é‡Šä¸€ä¸‹&lt;code>listen(fd, backlog)&lt;/code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°&lt;code>backlog&lt;/code>ï¼š&lt;/p>
&lt;p>backlogæ„ä¸ºå†…æ ¸ä¸ºç›¸åº”å¥—æ¥å­—æ’é˜Ÿçš„æœ€å¤§è¿æ¥ä¸ªæ•°ã€‚å†…æ ¸ä¸ºä»»ä½•ä¸€ä¸ªç»™å®šçš„ç›‘å¬å¥—æ¥å­—ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ï¼š&lt;/p>
&lt;ul>
&lt;li>æœªå®Œæˆè¿æ¥é˜Ÿåˆ—(incomplete connection queue) &lt;br>
å·²ç”±æŸä¸ªå®¢æˆ·å‘å‡ºå¹¶åˆ°è¾¾æœåŠ¡å™¨ï¼Œè€ŒæœåŠ¡å™¨æ­£åœ¨ç­‰å¾…å®Œæˆç›¸åº”çš„TCPä¸‰è·¯æ¡æ‰‹è¿‡ç¨‹ã€‚è¿™äº›å¥—æ¥å­—å¤„äºSYN_RCVDçŠ¶æ€&lt;/li>
&lt;li>å·²å®Œæˆè¿æ¥é˜Ÿåˆ—(completed connection queue) &lt;br>
æ¯ä¸ªå·²å®ŒæˆTCPä¸‰è·¯æ¡æ‰‹è¿‡ç¨‹çš„å®¢æˆ·å¯¹åº”å…¶ä¸­ä¸€é¡¹ã€‚è¿™äº›å¥—æ¥å­—å¤„äºESTABLISHEDçŠ¶æ€&lt;/li>
&lt;/ul>
&lt;p>å½“é˜Ÿåˆ—æ»¡æ—¶ï¼ŒTCPä¼šå¿½ç•¥æ”¹åˆ†èŠ‚ï¼Œä½†æ˜¯ä¸å‘é€RSTã€‚æœåŠ¡ç«¯ä¼šæœŸæœ›å®¢æˆ·ç«¯é‡å‘SYNï¼Œé‡‡ç”¨æ­£å¸¸çš„é‡ä¼ æœºåˆ¶æ¥å¤„ç†&lt;/p>
&lt;p>é˜Ÿåˆ—çš„çœŸå®å¤§å°å¾€å¾€æ¯”è®¾å®šbacklogå€¼è¦å¤§ä¸€äº›ï¼ˆ~1.5å€ï¼‰&lt;/p>
&lt;p>æˆ‘ä»¬ç»§ç»­çœ‹å·¥ä½œå‡½æ•°&lt;code>echoaccept&lt;/code>ã€‚ç¬¬ä¸€æ­¥æ˜¯æ–°å»ºä¸€ä¸ª&lt;code>UThreadSocket_t&lt;/code>å¯¹è±¡ï¼Œç”¨æ¥ç›‘å¬acceptäº‹ä»¶ã€‚å½“æœ‰æ–°çš„è¿æ¥è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±å°†æ–°çš„è¿æ¥ï¼Œä»¥åŠè¿æ¥æ‰€ç”¨çš„å·¥ä½œå‡½æ•°&lt;code>echoserver&lt;/code>åŠ å…¥åˆ°è°ƒåº¦å™¨ä¸­ã€‚&lt;/p>
&lt;p>&lt;code>echoserver&lt;/code>å‡½æ•°é¦–å…ˆå‘é€ä¸€ä¸ªæ¬¢è¿ä¿¡æ¯ï¼Œä¹‹åå°±å’Œå®¢æˆ·ç«¯æ‰“èµ·ä¹’ä¹“çƒæ¥ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘æ¥quitï¼Œå°±ç»“æŸè¿™ä¸ªå·¥ä½œåç¨‹ã€‚&lt;/p>
&lt;p>å…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå‘ç”Ÿäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ‹†æˆä¸¤åŠå‘çš„ç°è±¡ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªåŒ…æ˜¯â€œblahblahquitqâ€ï¼Œä¹‹åä¸€ä¸ªåŒ…æ˜¯â€œuitâ€ï¼Œé‚£ä¹ˆè¿™ä¸ªåç¨‹æ°¸è¿œå°±ä¸ä¼šåœæ­¢äº†ã€‚ç”±äºTCPæ˜¯ä¸€ä¸ªæµåè®®ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯æ¯ä¸€æ¬¡recvå›æ¥çš„ä¿¡æ¯éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„â€œåŒ…â€ã€‚ä¸åšä¸å¿…è¦çš„å‡è®¾ï¼Œä¸ç»™è‡ªå·±æ‰¾éº»çƒ¦ã€‚&lt;/p>
&lt;p>ä¸è¿‡å› ä¸ºè¿™é‡Œping pongçš„æ¶ˆæ¯éƒ½æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥å¼ºè¡Œè®¤ä¸ºæ¯ä¸€ä¸ªåŒ…éƒ½åŒ…å«ç€ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚å½“ç„¶ï¼Œè¿™ç§å‡è®¾ä¹Ÿæ˜¯æ— æ„ä¹‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç•™æ„phxrpcåœ¨çœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒï¼Œæ˜¯æ€æ ·å¤„ç†è¿™ç§â€œç²˜åŒ…â€çš„é—®é¢˜çš„ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸Šä¸€å¼ å¥³ç¥çš„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-19/89151689.jpg" alt="">&lt;/p>
&lt;p>æ²¡å•¦~&lt;/p></description></item><item><title>ä½¿ç”¨epollé©±åŠ¨ucontext - phxrpcä»£ç é˜…è¯»(5)</title><link>https://wizmann.top/posts/phxrpc-5/</link><pubDate>Mon, 17 Oct 2016 01:28:40 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-5/</guid><description>&lt;h2 id="ç”¨pipeå«é†’ä½ --epollnotifier">ç”¨pipeå«é†’ä½  â€” EpollNotifier &lt;a href="#%e7%94%a8pipe%e5%8f%ab%e9%86%92%e4%bd%a0--epollnotifier" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>class EpollNotifier&lt;/code>ç±»å‹å°è£…äº†ä¸€ä¸ªä½¿ç”¨pipeä¼ é€’ä¿¡å·çš„Notifierç±»ã€‚&lt;/p>
&lt;p>&lt;code>Run()&lt;/code>å‡½æ•°ï¼ˆå…¶å®æˆ‘è§‰å¾—å«Registeræˆ–Activateä¼šæ›´å¥½ï¼‰é¦–å…ˆå£°æ˜äº†ä¸¤ä¸ªå•å‘çš„pipeï¼š&lt;code>pipe_fds_&lt;/code>ï¼Œä»&lt;a href="http://man7.org/linux/man-pages/man2fpipe.2.html">æ–‡æ¡£&lt;/a>ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“&lt;code>pipe_fds_[0]&lt;/code>æ˜¯è¯»ç®¡é“ï¼Œè€Œ&lt;code>pipe_fds_[1]&lt;/code>æ˜¯å†™ç®¡é“ã€‚è¿™é‡Œæœ‰ä¸€ä¸ç‚¹åç›´è§‰ï¼Œå°±æ˜¯pipeæ‹¿äº†ä¸¤ä¸ªfdï¼Œä½†æ˜¯ä»æ—§æ˜¯å•å·¥çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-16/2335602.jpg" alt="">&lt;/p>
&lt;p>ç„¶åå°†è¯»fdè®¾ä¸º&lt;code>O_NONBLOCK&lt;/code>ä»¥ä¾›epollè°ƒåº¦ï¼Œæœ€åå°†&lt;code>Func()&lt;/code>å‡½æ•°ä¼ å…¥&lt;code>scheduler_&lt;/code>ä¸­ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™é‡Œè·‘ä¸ªé¢˜ï¼Œæƒ³èµ·äº†å½“å¹´æˆ‘å¤§ä¸€çš„æ—¶å€™ä¸Šè¿‡çš„é€šä¿¡å¯¼è®ºçš„é€‰ä¿®è¯¾ã€‚é‚£ä¼šæˆ‘è¿˜æ²¡æœ‰æ²‰è¿·ä»£ç ï¼Œè¿˜æ˜¯ä¸€ä¸ªç§¯æä¹è§‚å¥½å¥½å­¦ä¹ çš„æ–°æ—¶ä»£å¤§å­¦ç”Ÿã€‚è‡ªä»å¼€å§‹å†™äº†ä»£ç ï¼Œäººå°±è¶Šæ¥è¶ŠåºŸç‰©äº†ï¼Œè¿å¥³æœ‹å‹éƒ½æ‰¾ä¸åˆ°äº†ã€‚ &lt;br>
å¹´è½»äººä»¬å•Šï¼Œæœ‰é¥­è¾™å¹²ç‚¹å•¥éƒ½è¡Œï¼Œåƒä¸‡åˆ«å†™ç å•Šã€‚&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>Func()&lt;/code>å‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯ä»ç®¡é“é‡Œå°è¯•pollä¸€æ®µæ•°æ®ï¼Œæ‹¿åˆ°æ•°æ®åç›´æ¥æ‰”æ‰ã€‚å› ä¸ºç®¡é“é‡Œä¼ æ¥çš„æ•°æ®å¹¶æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œè¿™æ ·è®¾è®¡çš„ä¸»è¦æ„ä¹‰åœ¨äºå”¤é†’epollã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥ä»&lt;code>Notify()&lt;/code>å‡½æ•°ä¸­çœ‹å‡ºï¼Œä¼ å…¥ç®¡é“çš„æ˜¯ä¸€ä¸ªå­—ç¬¦&amp;quot;a&amp;quot;ã€‚&lt;/p>
&lt;h2 id="è°ƒåº¦å™¨ç±»--uthreadepollscheduler">è°ƒåº¦å™¨ç±» â€” UThreadEpollScheduler &lt;a href="#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%b1%bb--uthreadepollscheduler" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è°ƒè¯•å™¨ç±»åœ¨åˆå§‹åŒ–æ—¶ï¼Œå£°æ˜äº†åç¨‹æ ˆçš„å¤§å°ä»¥åŠè°ƒè¯•å™¨æ‰€è°ƒåº¦çš„æœ€å¤§ä»»åŠ¡æ•°ã€‚ä¸è¿‡è¿™ä¸ªæœ€å¤§ä»»åŠ¡æ•°æ˜¯ä¸€ä¸ªâ€œè½¯çº¿â€ï¼Œå› ä¸ºåœ¨æœ€æ–°çš„Linuxå†…æ ¸ä¸­ï¼Œepollä½¿ç”¨åŠ¨æ€å†…å­˜ç®¡ç†fdï¼Œ&lt;code>epoll_create&lt;/code>ä¸­çš„&lt;code>size&lt;/code>å‚æ•°å·²ç»å¤±å»äº†ä½œç”¨ã€‚è€Œåé¢&lt;code>epoll_wait&lt;/code>ä¸­çš„&lt;code>max_event&lt;/code>å‚æ•°åªæ˜¯æ¯æ¬¡è¿”å›çš„æœ€å¤ševentæ•°ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬å‘è°ƒåº¦å™¨ä¸­åŠ å…¥äº†è¶…è¿‡é™åˆ¶çš„fdï¼Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆæ¶åŠ£çš„åæœã€‚ï¼ˆå‚è€ƒ&lt;a href="http://man7.org/linux/man-pages/man2/epoll_create.2.html">epollæ–‡æ¡£&lt;/a>å’Œ&lt;a href="http://man7.org/linux/man-pages/man2/epoll_wait.2.html">epoll_waitæ–‡æ¡£&lt;/a>ï¼‰&lt;/p>
&lt;h3 id="è®©äººæä¸æ‡‚çš„instanceå‡½æ•°">è®©äººæä¸æ‡‚çš„Instanceå‡½æ•° &lt;a href="#%e8%ae%a9%e4%ba%ba%e6%90%9e%e4%b8%8d%e6%87%82%e7%9a%84instance%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥åƒä¸€ä¸ªSingletonçš„å®ç°ï¼Œä½†æ˜¯æ˜æ˜&lt;code>UThreadEpollScheduler&lt;/code>ç±»çš„æ„é€ å‡½æ•°æ˜¯publicçš„ã€‚ä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°åƒæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä½†å®ƒåˆä¸æ˜¯ä¸€ä¸ªå•ä¾‹ã€‚&lt;/p>
&lt;p>åœ¨å…¶å®ƒçš„ä»£ç ä¸­ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨ä¸ªå‡½æ•°çš„åœ°æ–¹ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå‡½æ•°æ˜¯å¼€å‘è€…å¿˜è®°åˆ äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-16/85921046.jpg" alt="">&lt;/p>
&lt;h3 id="è¿œå¤æ™ºæ…§--createsocket">è¿œå¤æ™ºæ…§ â€” CreateSocket &lt;a href="#%e8%bf%9c%e5%8f%a4%e6%99%ba%e6%85%a7--createsocket" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªå‡½æ•°å…¶å®æ²¡å•¥å¯è¯´çš„ï¼Œç®—æ˜¯å¯¹&lt;code>UThreadSocket_t&lt;/code>æ„é€ çš„å°è£…ï¼Œä½†æ˜¯è¿™é‡Œé¢æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå°±æ˜¯&lt;code>calloc&lt;/code>çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&lt;code>calloc&lt;/code>çš„ä½œç”¨æ˜¯å‘å†…æ ¸ç”³è¯·ä¸€æ®µæ ˆç©ºé—´ï¼ˆå’Œ&lt;code>malloc&lt;/code>è¡Œä¸ºä¸€è‡´ï¼‰ï¼Œç„¶åå°†è¿™ä¸€æ®µå†…å­˜æ¸…0ã€‚&lt;/p>
&lt;p>ä¸ªäººæ„Ÿè§‰è¿™æ ·åšçš„ç›®çš„æ˜¯é˜²æ­¢æŒ‡é’ˆæ²¡æœ‰åˆå§‹åŒ–å¸¦æ¥çš„ä¸€ç³»åˆ—è¯¡å¼‚çš„é—®é¢˜ã€‚æŠŠæŒ‡é’ˆæ¸…é›¶ï¼Œå¯ä»¥è®©é—®é¢˜åœ¨ç¬¬ä¸€æ—¶é—´å‡ºç°ï¼Œæ–¹ä¾¿å‡ºé”™æ—¶çš„è°ƒè¯•ã€‚ä½†æ˜¯æˆ‘è§‰å¾—è¿˜æ˜¯ç”¨æµ‹è¯•è¦†ç›–è¿™ç§é—®é¢˜å·²ç»å¥½ï¼Œå› ä¸ºç©ºæŒ‡é’ˆåœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½æ˜¯å¯¼è‡´è¯¡å¼‚è¡Œä¸ºçš„æºå¤´ã€‚&lt;/p>
&lt;h3 id="è·‘--run">è·‘ â€” Run &lt;a href="#%e8%b7%91--run" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>Run()&lt;/code>å‡½æ•°æ˜¯è°ƒåº¦å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼ˆå½“ç„¶å•¦ï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå¾ªç¯è·å–eventï¼Œç”¨é€‚å½“çš„åç¨‹å¤„ç†eventã€‚&lt;/p>
&lt;p>å‡½æ•°çš„ä¸€å¼€å§‹ï¼Œå…ˆè°ƒç”¨&lt;code>ConsumeTodoList()&lt;/code>å‡½æ•°ï¼Œå°†åˆ—è¡¨ä¸­çš„åç¨‹å…¨éƒ¨æ¿€æ´»ï¼Œå¹¶hangåœ¨epollä¸Šã€‚&lt;/p>
&lt;p>ä¹‹åè¿›å…¥ä¸€ä¸ªâ€œæ­»å¾ªç¯â€ï¼Œé€šè¿‡&lt;code>epoll_wait&lt;/code>å°†æœ‰æ•°æ®å¯è¯»çš„fdå–å‡ºï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„åç¨‹è¿›è¡Œå¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œ&lt;code>epoll_wait&lt;/code>çš„è¶…æ—¶æ—¶é—´æ˜¯å†™æ­»çš„4msï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨&lt;code>next_timeout&lt;/code>ç»™å‡ºçš„ä¸‹æ¬¡è¶…æ—¶æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºè¿™é‡Œæ”¯æŒäº†â€œactive socketâ€ï¼Œå³æœåŠ¡å™¨å¯¹æ´»åŠ¨è¿æ¥æ“ä½œï¼Œä¾‹å¦‚å‘é€å“åº”ç”šè‡³æ–°å»ºä¸€ä¸ªsocketã€‚&lt;/p>
&lt;p>åé¢çš„&lt;code>handler_accepted_fd_func_&lt;/code>å’Œ&lt;code>active socket&lt;/code>æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¤„ç†å·²ç»å»ºç«‹å¥½çš„è¿æ¥ï¼Œä¸ºå…¶åˆ†é…ç›¸åº”çš„åç¨‹ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œç”±æ­¤å¯è§ï¼Œè¿™ä¸ªå¾ªç¯å³æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œåˆæ˜¯è½®è¯¢çš„ã€‚ç„¶è€Œè¿™ä¸¤ç§æ¨¡å‹ï¼Œå±…ç„¶èƒ½å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼ŒçœŸæ˜¯ä»¤äººå°è±¡æ·±åˆ»ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-16/4157866.jpg" alt="">&lt;/p>
&lt;p>ä¸‹é¢çš„&lt;code>DealwithTimeout&lt;/code>å‡½æ•°å¤„ç†äº†ä¸€ä¸‹è¶…æ—¶çš„åç¨‹ï¼Œå¹¶ä¸”æ›´æ–°äº†&lt;code>next_timeout&lt;/code>å˜é‡ã€‚ç„¶è€Œè¿™ä¸ªå˜é‡å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-16/4157866.jpg" alt="">&lt;/p>
&lt;h2 id="pollæ¥pollå»--ä¸€å †epollå‡½æ•°çš„å°è£…">Pollæ¥Pollå» â€” ä¸€å †epollå‡½æ•°çš„å°è£… &lt;a href="#poll%e6%9d%a5poll%e5%8e%bb--%e4%b8%80%e5%a0%86epoll%e5%87%bd%e6%95%b0%e7%9a%84%e5%b0%81%e8%a3%85" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="uthreadpoll1">UThreadPoll(1) &lt;a href="#uthreadpoll1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>UThreadPoll&lt;/code>å‡½æ•°æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯pollå•ä¸ªsocketï¼Œå¦å¤–ä¸€ä¸ªæ˜¯pollä¸€å †socketã€‚æˆ‘ä»¬å…ˆä»å•ä¸ªsocketçš„çœ‹èµ·ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€æ­¥æ˜¯æ³¨å†Œä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œç¬¬äºŒæ­¥å°†è¿™ä¸ªsocketæ”¾åˆ°epollçš„ç›‘å¬åˆ—è¡¨ä¸Šã€‚ä¹‹åè°ƒç”¨yieldï¼ŒæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ä¸»æ§åˆ¶æµã€‚&lt;/p>
&lt;p>å½“epollæ”¶åˆ°ç›¸åº”çš„äº‹ä»¶æ—¶ï¼Œä¸»æ§åˆ¶æµä¼šå°†æ§åˆ¶æƒäº¤è¿˜ç»™åç¨‹ï¼Œåç¨‹å°†socketä»epollç›‘å¬åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä¹‹åè¿›è¡Œåé¢çš„æ“ä½œã€‚&lt;/p>
&lt;p>æ•´ä½“çš„å·¥ä½œæµå¯ä»¥å‚è€ƒä¸‹å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="http://7lrx26.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-10-16%2021.33.48.png" alt="image">&lt;/p>
&lt;h3 id="uthreadpoll2---è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘">UThreadPoll(2) - è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘ &lt;a href="#uthreadpoll2---%e8%be%b9%e7%bc%98%e8%a7%a6%e5%8f%91%e5%92%8c%e6%b0%b4%e5%b9%b3%e8%a7%a6%e5%8f%91" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>epollæœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼Œè¾¹ç¼˜è§¦å‘(edge-trigger, ET)å’Œæ°´å¹³è§¦å‘(level-trigger, LT)ã€‚&lt;/p>
&lt;p>ç®€å•è§£é‡Šä¸€ä¸‹epollçš„è¿™ä¸¤ç§è§¦å‘æ¨¡å¼ã€‚ETæ„å‘³ç€åªè¦æœ‰fdå¯è¯»æˆ–å¯å†™ï¼Œ&lt;code>epoll_wait&lt;/code>å°±è¿”å›è¿™ä¸ªfdï¼Œè€ŒLTæ„å‘³ç€å½“ä¸”ä»…å½“fdç”±â€œä¸å¯è¯»å˜ä¸ºå¯è¯»â€æˆ–ç”±â€œä¸å¯å†™å˜ä¸ºå¯å†™â€æ—¶ï¼Œ&lt;code>epoll_wait&lt;/code>æ‰ä¼šè¿”å›ã€‚ï¼ˆè¿™æœ‰å¯èƒ½å‡ºç°æ‰€è°“çš„â€œç²˜åŒ…â€ç°è±¡ï¼Œè¯¦è§&lt;a href="http://man7.org/linux/man-pages/man7/epoll.7.html">è¿™é‡Œ&lt;/a>ï¼‰&lt;/p>
&lt;blockquote>
&lt;p>ç¬¬ä¸€æ¬¡å¬åˆ°â€œç²˜åŒ…â€è¿™ä¸ªè¯ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºè¿™æ˜¯å•¥å¥½åƒçš„ã€‚ã€‚ã€‚&lt;/p>&lt;/blockquote>
&lt;p>è¿™æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨LTæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…ç†å¹²å‡€fdä¸­çš„æ•°æ®ï¼Œå³åªè¦å¯è¯»ï¼Œå°±ä¸€ç›´è¯»ï¼›åªè¦å¯å†™ï¼Œå°±ä¸€ç›´å†™ã€‚å¦åˆ™å°±ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ETæ¨¡å¼ã€‚å¹¶ä¸”æˆ‘ä»¬åˆ©ç”¨äº†ETçš„ç‰¹æ€§å®ç°äº†â€œç›‘å¬å¤šä¸ªfdï¼Œè¿”å›æœ€æ—©å“åº”çš„é‚£ä¸€ä¸ªâ€ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªepoll fdï¼ˆç®€ç§°å†…éƒ¨epollï¼‰ï¼Œå°†åˆ—è¡¨ä¸­çš„æ‰€æœ‰socketæ”¾åˆ°é‡Œé¢ç›‘å¬ã€‚ä¹‹åå°†è¿™ä¸ªsocket fdæ”¾åˆ°&lt;code>list[0]-&amp;gt;epollfd&lt;/code>æ‰€å¯¹åº”çš„epollï¼ˆç®€ç§°å¤–éƒ¨epollï¼Œé€šå¸¸æ˜¯ä¸»å·¥ä½œå¾ªç¯çš„é‚£ä¸ªepollï¼‰ç›‘å¬åˆ—è¡¨ä¸­ã€‚&lt;/p>
&lt;p>å½“åˆ—è¡¨ä¸­çš„socketæœ‰è¿”å›æ—¶ï¼Œå†…éƒ¨çš„epollä¼šè¿”å›ä¸€ä¸ª&lt;code>EPOLLIN&lt;/code>äº‹ä»¶ï¼Œå¤–éƒ¨çš„epollæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶åï¼Œè¿›è¡Œåç¨‹åˆ‡æ¢ï¼Œå›åˆ°å½“å‰å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>ä¸‹ä¸€æ­¥æˆ‘ä»¬&lt;code>epoll_wait&lt;/code>å†…éƒ¨çš„epoll fdï¼Œå› ä¸ºæˆ‘ä»¬ç¡®å®šæ­¤æ—¶ä¸€å®šæœ‰å¯æ“ä½œçš„fdï¼Œæ‰€ä»¥æˆ‘ä»¬å°†&lt;code>epoll_wait&lt;/code>çš„timeoutå‚æ•°è®¾ä¸º0ã€‚ä¹‹åæˆ‘ä»¬å°†è¿”å›çš„fdçš„&lt;code>waited_events&lt;/code>å‚æ•°å¡«å¥½ï¼Œæœ€åè¿”å›æ“ä½œæˆåŠŸçš„fdçš„æ•°ç›®ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°æ¯”è¾ƒç»•ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯ â€”â€” è¿™ä¸ªå‡½æ•°ä¹Ÿæ²¡æœ‰è¢«å…¶å®ƒåœ°æ–¹è°ƒç”¨è¿‡ã€‚ä¸è¿‡è¿™ç§&lt;code>cascaded epoll&lt;/code>çš„æŠ€å·§ç¡®å®æ˜¯è®©äººè€³ç›®ä¸€æ–°ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-16/4157866.jpg" alt="">&lt;/p>
&lt;h3 id="å»¶æ—¶æ‰§è¡Œ---uthreadwait">å»¶æ—¶æ‰§è¡Œ - UThreadWait &lt;a href="#%e5%bb%b6%e6%97%b6%e6%89%a7%e8%a1%8c---uthreadwait" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‰©ä¸‹çš„å‡ ä¸ªå‡½æ•°åŸºæœ¬éƒ½æ˜¯æ— è„‘å°è£…ï¼Œé¡ºç€çœ‹ä¸€éä»£ç åŸºæœ¬å°±çŸ¥é“æ˜¯å•¥æ„æ€äº†ã€‚ä¸è¿‡&lt;code>UThreadWait&lt;/code>è¿™ä¸ªå‡½æ•°æ¯”è¾ƒæœ‰æ„æ€ï¼Œå¯ä»¥ç”¨æ¥å¤ä¹ ä¸€ä¸‹&lt;code>uthread + epoll&lt;/code>çš„å·¥ä½œæµç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">UThreadWait&lt;/span>(UThreadSocket_t &lt;span style="color:#f92672">&amp;amp;&lt;/span> socket, &lt;span style="color:#66d9ef">int&lt;/span> timeout_ms) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socket.uthread_id &lt;span style="color:#f92672">=&lt;/span> socket.scheduler&lt;span style="color:#f92672">-&amp;gt;&lt;/span>GetCurrUThread();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socket.scheduler&lt;span style="color:#f92672">-&amp;gt;&lt;/span>AddTimer(&lt;span style="color:#f92672">&amp;amp;&lt;/span>socket, timeout_ms);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socket.scheduler&lt;span style="color:#f92672">-&amp;gt;&lt;/span>YieldTask();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socket.scheduler&lt;span style="color:#f92672">-&amp;gt;&lt;/span>RemoveTimer(socket.timer_id);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é¦–å…ˆï¼Œè·å–å½“å‰uthreadçš„IDï¼Œå½“æˆ‘ä»¬è°ƒç”¨&lt;code>Resume()&lt;/code>å‡½æ•°æ—¶ï¼Œè®©ä»£ç çŸ¥é“æˆ‘ä»¬è¦è¿”å›åˆ°å“ªä¸ªåç¨‹ä¸Šé¢ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å‘è°ƒåº¦å™¨ä¸­æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨ã€‚ä¹‹å&lt;code>Yield()&lt;/code>ï¼Œç¦»å¼€å½“å‰åç¨‹ã€‚&lt;/p>
&lt;p>ä¸»å·¥ä½œå¾ªç¯è¿è¡Œåˆ°è¶…æ—¶æ—¶é—´åï¼Œä¼šåœ¨è¿™ä¸ªåç¨‹æ‰“ä¸Šä¸€ä¸ªâ€œè¶…æ—¶â€æ ‡ç­¾ï¼Œç„¶å&lt;code>Resume()&lt;/code>åˆ‡æ¢å›è¿™ä¸ªåç¨‹ä¸Šæ¥ã€‚&lt;/p>
&lt;p>å‰©ä¸‹çš„å·¥ä½œï¼Œå°±äº¤ç”±åç¨‹å†…éƒ¨ç»‘å®šçš„å‡½æ•°æ¥è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ç½‘ç»œç¼–ç¨‹æ–¹é¢ï¼ŒçœŸå¿ƒæ˜¯ä¸€ä¸ªåˆå­¦è€…ã€‚å¾ˆå¤šç”¨è¯å¯èƒ½ä¸æ°å½“ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯è‡ªå·±ç”Ÿé€ çš„ã€‚å¤§å®¶é˜…è¯»çš„æ—¶å€™ï¼Œå°½é‡ä»¥ä»£ç å’Œæ›´ä¸“ä¸šçš„æœ¯è¯­ä¸ºå‡†ã€‚&lt;/p>
&lt;p>ç„¶åå› ä¸ºåœ¨è¡Œæ–‡ä¸­ï¼Œå¯èƒ½è¿½æ±‚äº†è¿‡å¤šçš„é€—æ¯”æ„Ÿï¼Œå¯¹åŸä»£ç è°ƒä¾ƒäº†å‡ å¥ã€‚å¹¶æ²¡æœ‰ä»€ä¹ˆæ¶æ„ï¼Œå¦‚æœå“ªé‡Œè¯´çš„ä¸å¯¹ï¼Œæ¬¢è¿æ‹ç –ã€‚&lt;/p>
&lt;p>&lt;img src="http://7lrx26.com1.z0.glb.clouddn.com/IMG_20161017_012107.jpg" alt="image">&lt;/p>
&lt;p>ä½›ç¥–ä¿ä½‘ï¼Œæ°¸æ— Bugã€‚&lt;/p></description></item><item><title>ucontext - phxrpcä»£ç é˜…è¯»(4)</title><link>https://wizmann.top/posts/phxrpc-4/</link><pubDate>Thu, 13 Oct 2016 23:45:24 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-4/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å›½åº†å‡æœŸè¿‡åŠï¼Œphxrpcçš„ä»£ç é˜…è¯»å¤§æ¦‚è¦å°å°å‘Šä¸€æ®µè½å•¦ã€‚å› ä¸ºè¿™ä¸¤å¤©è¿˜è¦è¯»å·¥ä½œç›¸å…³çš„ä»£ç ï¼Œä»¥åŠæœ€åå‡ å¤©è¿˜æœ‰ä¸€æ¬¡çŸ­é€”æ—…è¡Œã€‚&lt;/p>
&lt;p>æ‰€ä»¥éé˜»å¡TCPæµå¯èƒ½è¦ç•™åˆ°ä¸‹ä¸€ç¯‡äº†ï¼Œè¿™ä¸€ç¯‡åªæ¶‰åŠéé˜»å¡TCPæµä½¿ç”¨åˆ°çš„ucontextåç¨‹åº“ï¼ŒåŠå…¶ä½¿ç”¨çš„ä¸€äº›æ¡†æ¶ä»£ç ã€‚&lt;/p>
&lt;blockquote>
&lt;p>161013æ›´æ–°ï¼šè¿™ç‚¹ç ´ä¸œè¥¿å†™åˆ°ä»Šå¤©æ‰å†™å®Œï¼ŒGGã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="ä»€ä¹ˆæ˜¯ucontext">ä»€ä¹ˆæ˜¯ucontext &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afucontext" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>&amp;ldquo;Subroutines are special cases of &amp;hellip; coroutines.&amp;rdquo; â€“Donald Knuth.&lt;/p>&lt;/blockquote>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯çº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹å†…ä¸€æ¡æ‰§è¡Œæµçš„çŠ¶æ€ï¼ŒåŒ…å«äº†ç¡¬ä»¶çŠ¶æ€ï¼ˆç¡¬ä»¶è®¡æ•°å™¨ï¼Œå¯„å­˜å™¨ï¼Œæ¡ä»¶ç ç­‰ï¼‰å’Œå †æ ˆä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;p>çº¿ç¨‹é€šå¸¸åªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ã€‚å½“çº¿ç¨‹è¿”å›æ—¶ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿç»“æŸäº†ã€‚æ‰€ä»¥ï¼Œé€šå¸¸çº¿ç¨‹çš„æ‰§è¡Œç”±å†…æ ¸è°ƒåº¦ã€‚&lt;/p>
&lt;p>åç¨‹çš„å®šä¹‰ä¸çº¿ç¨‹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç¡¬ä»¶çŠ¶æ€+å †æ ˆçš„çŠ¶æ€ç»„åˆã€‚ä½†æ˜¯ä¸çº¿ç¨‹ä¸åŒçš„æ˜¯ï¼Œåç¨‹å¯ä»¥æœ‰å¤šä¸ªå‡ºå£ã€‚å¯ä»¥é€šè¿‡yieldæ¥æš‚åœè‡ªå·±ï¼Œè°ƒç”¨å…¶å®ƒåç¨‹ã€‚å†æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šä»ä¸Šæ¬¡æŒ‚èµ·çš„åœ°æ–¹ç»§ç»­è¿è¡Œã€‚&lt;/p>
&lt;h2 id="phxrpcä¸­çš„ucontext">phxrpcä¸­çš„ucontext &lt;a href="#phxrpc%e4%b8%ad%e7%9a%84ucontext" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>phxrpcæä¾›äº†systemå’Œboostä¸¤ç§ucontextçš„å®ç°ï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ª&lt;code>uthread_context_base&lt;/code>çš„åŸºç±»ã€‚å…¶å®åœ¨è¿™é‡Œæˆ‘æ˜¯æœ‰ä¸€ç‚¹æ€€ç–‘è™šå‡½æ•°çš„æ€§èƒ½çš„ï¼Œä¸è¿‡å¥½åœ¨åç¨‹çš„åˆ‡æ¢ä»¥åŠç½‘ç»œIOæ“ä½œè¿˜æ˜¯æ¯”è¾ƒè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥è™šå‡½æ•°å¤šå‡ºæ¥çš„å‡ æ¬¡å†…å­˜å¯»å€ä¹Ÿå¹¶éä¸èƒ½æ¥å—ã€‚&lt;/p>
&lt;p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åªçœ‹&lt;code>uthread_context_system&lt;/code>è¿™ä¸ªä½¿ç”¨ç³»ç»Ÿucontextåº“çš„å®ç°ã€‚&lt;/p>
&lt;h3 id="åç¨‹ä¸Šä¸‹æ–‡uthreadcontext">åç¨‹ä¸Šä¸‹æ–‡ï¼š&lt;code>UThreadContext&lt;/code> &lt;a href="#%e5%8d%8f%e7%a8%8b%e4%b8%8a%e4%b8%8b%e6%96%87uthreadcontext" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªç±»æ˜¯åç¨‹ä¸Šä¸‹æ–‡çš„è™šåŸºç±»ï¼Œæ‰€ä»¥ä»£ç å¾ˆå°‘ã€‚å¹¶ä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½è§£é‡Šçš„ã€‚&lt;/p>
&lt;p>&lt;code>void Make(UThreadFunc_t func, void * args)&lt;/code>å‡½æ•°æ˜¯&lt;code>makecontext()&lt;/code>çš„å°è£…ã€‚&lt;/p>
&lt;p>&lt;code>bool Resume()&lt;/code>å’Œ&lt;code>bool Yield()&lt;/code>æ˜¯&lt;code>swapcontext&lt;/code>çš„å°è£…ã€‚&lt;/p>
&lt;p>ä¸ªäººæ„Ÿè§‰è¿™ä¸ªç±»æ‹†åˆ†æˆä¸€ä¸ªå·¥å‚ç±»ï¼ˆä¼ å…¥ä¸€ä¸ªCreateä»¿å‡½æ•°ï¼‰å’Œä¸€ä¸ªä¸Šä¸‹æ–‡åŸºç±»ä¼šæ›´æ¸…æ¥šä¸€ç‚¹ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ç³»ç»Ÿucontextåº“çš„åç¨‹ä¸Šä¸‹æ–‡uthreadcontextsystem">ä½¿ç”¨ç³»ç»Ÿucontextåº“çš„åç¨‹ä¸Šä¸‹æ–‡ï¼š&lt;code>UThreadContextSystem&lt;/code> &lt;a href="#%e4%bd%bf%e7%94%a8%e7%b3%bb%e7%bb%9fucontext%e5%ba%93%e7%9a%84%e5%8d%8f%e7%a8%8b%e4%b8%8a%e4%b8%8b%e6%96%87uthreadcontextsystem" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨phxrpcçš„æ–‡æ¡£ä¸­ï¼Œè¯´æ˜ä½¿ç”¨ç³»ç»ŸåŸç”Ÿçš„ucontextåº“çš„æ€§èƒ½è¦å·®äºboostç‰ˆæœ¬çš„ã€‚ä½†æ˜¯ä»æ•°æ®ä¸Šæ¥çœ‹å¾®ä¹å…¶å¾®ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»è¿™ä¸ªç‰ˆæœ¬çœ‹èµ·ï¼ŒåŠ›æ±‚ä¸¾ä¸€åä¸‰ã€‚&lt;/p>
&lt;p>&lt;code>UThreadContextSystem&lt;/code>åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†åç¨‹æ ˆå¤§å°ï¼Œåç¨‹è¦æ‰§è¡Œçš„å‡½æ•°ï¼ˆåŠå‚æ•°ï¼‰ï¼Œåç¨‹æ‰§è¡Œåçš„å›è°ƒï¼Œä»¥åŠè°ƒè¯•ç”¨çš„&lt;code>need_stack_protect&lt;/code> flagã€‚&lt;/p>
&lt;p>æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡éƒ½ç»´æŠ¤äº†ä¸¤ä¸ªcontextï¼Œ&lt;code>main_context&lt;/code>ç”¨æ¥è¡¨ç¤ºä¸»ç¨‹åºæ‰§è¡Œæµçš„ä¸Šä¸‹æ–‡ï¼Œè€Œ&lt;code>context_&lt;/code>åˆ™ç”¨æ¥è¡¨ç¤ºåç¨‹çš„ä¸Šä¸‹æ–‡ã€‚&lt;/p>
&lt;p>&lt;code>main_context&lt;/code>æ˜¯&lt;code>static thread_local&lt;/code>ä¿®é¥°çš„ï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé™æ€å˜é‡åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªã€‚æ‰§è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šçš„ä¸åŒåç¨‹ï¼Œéƒ½ä¼šåˆ‡æ¢/è¢«åˆ‡æ¢åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡ä¸Šã€‚&lt;/p>
&lt;p>åœ¨&lt;code>Resume()&lt;/code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ¿€æ´»åç¨‹ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†ä¸»ç¨‹åºæ‰§è¡Œæµçš„ä¸Šä¸‹æ–‡ä¿å­˜åœ¨&lt;code>main_context&lt;/code>ä¸Šã€‚&lt;/p>
&lt;p>åœ¨&lt;code>Yield()&lt;/code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†ä¸»ç¨‹åºæ‰§è¡Œæµçš„ä¸Šä¸‹æ–‡æ¿€æ´»ï¼Œå°†åç¨‹ä¸Šä¸‹æ–‡ä¿å­˜å›&lt;code>context_&lt;/code>ä¸­ã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„&lt;code>UThreadFuncWrapper()&lt;/code>å€¼å¾—æˆ‘ä»¬ç‰¹åˆ«å…³æ³¨ã€‚è¿™ä¸ªå‡½æ•°åŒ…è£…äº†æˆ‘ä»¬çš„å·¥ä½œå‡½æ•°&lt;code>uc-&amp;gt;func_&lt;/code>ï¼Œå¹¶ä¸”å°†&lt;code>this&lt;/code>æŒ‡é’ˆä¼ è¿›å»ã€‚&lt;/p>
&lt;p>ä¼ å…¥æŒ‡é’ˆæ—¶ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæŠ€å·§ã€‚é¦–å…ˆæˆ‘ä»¬å°†æŒ‡é’ˆå¼ºè½¬ä¸º&lt;code>uintptr_t&lt;/code>ï¼Œè¿™ä¸ªæ˜¯ç¼–è¯‘å™¨å†…ç½®çš„ä¸€ä¸ª&lt;code>typeof&lt;/code>ï¼Œæ„åœ¨å°†æŒ‡é’ˆç±»å‹æ— æŸå¤±çš„è½¬ä¸ºæ•´å‹ã€‚ä¹‹åï¼Œå°†ä¸€ä¸ª&lt;code>uintptr_t&lt;/code>æ‹†ä¸ºä¸¤ä¸ª&lt;code>uint32_t&lt;/code>ã€‚æœ€åï¼Œåœ¨wrapperå‡½æ•°ä¸­ï¼Œå°†è¿™ä¸¤ä¸ª&lt;code>uint32_t&lt;/code>æ‹¼å›æˆä¸€ä¸ªæŒ‡é’ˆç±»å‹ã€‚&lt;/p>
&lt;p>åˆçœ‹è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å°±æœ‰è¿™æ ·çš„ç–‘é—®ï¼šâ€œè¿™ç‰¹ä¹ˆä¸æ˜¯æœ‰ç—…ä¹ˆï¼Ÿâ€ ä½†æ˜¯ï¼ŒæŠ˜è…¾è‡ªç„¶æœ‰æŠ˜è…¾çš„é“ç†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>When this context is later activated (using setcontext(3) or swapcontext()) the function func is called, and passed the series of integer (int) arguments that follow argc; the caller must specify the number of these arguments in argc.&lt;/p>&lt;/blockquote>
&lt;p>ä»å®˜æ–¹çš„æ–‡æ¡£ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç”¨åœ¨&lt;code>setcontext&lt;/code>ä¸­çš„å‡½æ•°ï¼Œåªæ”¯æŒintç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”éœ€è¦æˆ‘ä»¬æ˜¾å¼å£°æ˜å‚æ•°çš„æ•°ç›®ã€‚è¿™é‡Œä¸€å®šè¦å°å¿ƒï¼Œå› ä¸ºå˜é•¿å‚æ•°åˆ—è¡¨å¹¶ä¸èƒ½æœ‰å¾ˆå¼ºçš„ç¼–è¯‘æœŸæ£€æŸ¥æ”¯æŒï¼Œæå‡ºUBæˆ–core dumpæ¥å°±éå¸¸éš¾æŸ¥ã€‚&lt;/p>
&lt;h3 id="ucontextä¸­ä½¿ç”¨çš„æ ˆå†…å­˜uthreadstackmemory">ucontextä¸­ä½¿ç”¨çš„æ ˆå†…å­˜ï¼š&lt;code>UThreadStackMemory&lt;/code> &lt;a href="#ucontext%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%9a%84%e6%a0%88%e5%86%85%e5%ad%98uthreadstackmemory" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ucontextåç¨‹æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå¤šä¸ªä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å°±è¦é…å¤‡å¤šä¸ªæ ˆç©ºé—´ã€‚è¿™é‡Œçš„æ ˆå¤§å°æˆ‘ä»¬æ˜¯å¯ä»¥æ‰‹åŠ¨ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®ç¨‹åºçš„å®é™…æƒ…å†µæ¥è°ƒæ•´æ ˆå¤§å°ï¼Œä»¥èŠ‚çœå†…å­˜ä½¿ç”¨ã€‚&lt;/p>
&lt;p>å†…å­˜çš„ç”³è¯·å¹¶ä¸æ˜¯ä½¿ç”¨&lt;code>malloc&lt;/code>æˆ–è€…&lt;code>new&lt;/code>è¿™ç§æ¯”è¾ƒé«˜å±‚æ¬¡çš„å†…å­˜æ“ä½œå‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨çš„&lt;code>mmap&lt;/code>ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°æ§åˆ¶ç”³è¯·å‡ºçš„å†…å­˜çš„æƒé™ã€‚&lt;/p>
&lt;p>æ ˆå†…å­˜æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¿æŠ¤å’Œéä¿æŠ¤ã€‚ä¿æŠ¤æ¨¡å¼ç”¨äºè°ƒè¯•ï¼Œä¼šåœ¨æ­£å¸¸æ ˆå†…å­˜çš„ä¸¤ç«¯ï¼Œå„ç”³è¯·ä¸€ä¸ªé¡µå¤§å°çš„ä¿æŠ¤å†…å­˜ã€‚æ­£å¸¸æ ˆå†…å­˜çš„æƒé™æ˜¯è¯»å†™ï¼š&lt;code>PROT_READ | PROT_WRITE&lt;/code>ï¼Œè€Œä¿æŠ¤å†…å­˜çš„æƒé™æ˜¯ç¦æ­¢è®¿é—®ï¼š&lt;code>PROT_NONE&lt;/code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•è¯•å›¾è®¿é—®è¿™å—å†…å­˜çš„è¯·æ±‚ï¼Œéƒ½ä¼šè§¦å‘æ®µé”™è¯¯ã€‚&lt;/p>
&lt;p>åœ¨éä¿æŠ¤çš„è¿è¡Œæ¨¡å¼ä¸‹ï¼Œæ ˆå†…å­˜è¿˜ä¼šä½¿ç”¨&lt;code>MAP_ANONYMOUS | MAP_PRIVATE&lt;/code>è¿˜è¿›è¡Œä¿æŠ¤ã€‚&lt;code>MAP_ANONYMOUS&lt;/code>è¡¨æ˜è¿™æ®µå†…å­˜æ˜¯åŒ¿åçš„ï¼Œå³ä¸å ç”¨fdï¼Œä¹Ÿæ— éœ€è¿›è¡Œå†™å›æ“ä½œï¼Œä½¿mmapçš„è¡Œä¸ºç±»ä¼¼äºmallocã€‚&lt;code>MAP_PRIVATE&lt;/code>æ„ä¸ºè¿™æ®µå†…å­˜ä¸ä¼šè¢«å…¶å®ƒè¿›ç¨‹è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ç§æœ‰çš„å†™æ—¶å¤åˆ¶æ˜ å°„ã€‚ï¼ˆè™½ç„¶æ²¡æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™ä¸¤ä¸ªé…ç½®ç‰ºç‰²äº†å¯è°ƒè¯•æ€§æ¥è·å–æ›´å¥½çš„æ€§èƒ½ï¼‰&lt;/p>
&lt;h3 id="ucontextçš„è¿è¡Œæ—¶uthreadruntime">ucontextçš„è¿è¡Œæ—¶ï¼š&lt;code>UThreadRuntime&lt;/code> &lt;a href="#ucontext%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6uthreadruntime" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªç±»å…¶å®å¾ˆç®€å•ï¼Œä½†æ˜¯ç”±äºä»£ç çš„å‘½åè¿‡äºæ„è¯†æµï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æŠŠäººç»•æ™•ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª&lt;code>UThreadRuntime&lt;/code>ä»£è¡¨ç€ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œç€çš„Nä¸ªucontextä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿å­˜åœ¨&lt;code>std::vector&amp;lt;ContextSlot&amp;gt; context_list_&lt;/code>ä¸­ã€‚&lt;/p>
&lt;p>slotæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œ&lt;code>first_done_item_&lt;/code>è®°å½•ç€å·²æ‰§è¡Œå®Œçš„contextçš„ä¸‹æ ‡ï¼Œç„¶åslotä¸­çš„&lt;code>next_done_item&lt;/code>è®°å½•ç€ä¸‹ä¸€ä¸ªæ‰§è¡Œå®Œçš„contextçš„ä¸‹æ ‡ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç±»ä¼¼ä¸€ä¸ªâ€œè„æ± â€çš„è®¾è®¡ã€‚ä¸è¿‡è¿™ä¸ªå‘½åå•Šï¼Œä¸€ç‚¹éƒ½ä¸èµ›è‰‡ã€‚&lt;/p>
&lt;p>å‰©ä¸‹çš„ä»£ç åŸºæœ¬å°±æ˜¯&lt;code>UThreadContext&lt;/code>çš„æ— è„‘å°è£…äº†ã€‚éœ€è¦å“ªä¸ªåç¨‹å¼€å§‹å·¥ä½œå°±&lt;code>Resume&lt;/code>å“ªä¸ªåç¨‹ï¼Œéœ€è¦æš‚åœå°±è°ƒç”¨&lt;code>Yield&lt;/code>ã€‚ç»“æŸåï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼ŒæŠŠè¿è¡Œå®Œçš„åç¨‹å¾€è„æ± ä¸€æ‰”ï¼Œå®Œæ´»ã€‚&lt;/p>
&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸Šé¢æˆ‘ä»¬åˆ†æäº†phxrpcå¯¹ucontextåç¨‹åº“çš„å°è£…ï¼Œä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°±æ¥æ­£å¼çœ‹ä¸€çœ‹ucontextæ˜¯å¦‚ä½•ä¸IOå¤šè·¯å¤ç”¨çš„æŠ€æœ¯è¿æ¥åœ¨ä¸€èµ·çš„ã€‚&lt;/p>
&lt;p>æœ€åä¸Šå‡ å¼ çš‚ç‰‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-13/31415098.jpg" alt="">&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-13/1208386.jpg" alt="">&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-13/97556242.jpg" alt="">&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-13/44196833.jpg" alt="">&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-13/20763058.jpg" alt="">&lt;/p></description></item><item><title>æ‰“é€ ä½ çš„ä¸“å±é”®ç›˜ â€” ErgoDone</title><link>https://wizmann.top/posts/ergodone/</link><pubDate>Wed, 05 Oct 2016 21:38:58 +0000</pubDate><guid>https://wizmann.top/posts/ergodone/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ä½èƒ½é¢„è­¦ï¼šè¿™æ˜¯æœ€æ²¡æœ‰æŠ€æœ¯å«é‡çš„ä¸€ç¯‡åšå®¢ï¼Œæ— å…³äººå‘˜å¯ä»¥æ’¤ç¦»ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>éƒ¨åˆ†å›¾ç‰‡æ¥è‡ªç½‘ç»œï¼Œä¾µåˆ &lt;/p>&lt;/blockquote>
&lt;p>è¿™ä¸ªåä¸€å‡æœŸï¼Œäº²æ‰‹DIYäº†ä¸€æŠŠé”®ç›˜ã€‚å½“ç„¶ï¼Œæˆ‘åªæå®šäº†ç„Šæ¥éƒ¨åˆ†ï¼ŒæŠŠä¸åŒçš„ç»„ä»¶æ‹¼åœ¨äº†ä¸€èµ·ã€‚&lt;/p>
&lt;p>åœ¨ç„Šæ¥çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå­¦ä¹ åˆ°äº†ä¸€äº›æ–°çŸ¥è¯†ã€‚å†™åœ¨è¿™é‡Œï¼Œè®°å½•ä¸‹æ¥ã€‚&lt;/p>
&lt;h2 id="ergodoneä»‹ç»">ErgoDoneä»‹ç» &lt;a href="#ergodone%e4%bb%8b%e7%bb%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ErgoDoneæ˜¯è‘—åå¼€æºç¡¬ä»¶ErgoDoxçš„ä¸­å›½ç‰¹è‰²ç‰ˆæœ¬ï¼Œç²¾ç®€äº†ä¸€äº›ç¡¬ä»¶ä»¥æ§åˆ¶æˆæœ¬ã€‚æ€»ä½“ä»·æ ¼åœ¨500RMBå·¦å³ï¼Œæ˜¯å·¥è–ªé˜¶çº§è£…é€¼ç•Œçš„ä¸€é¢—æ–°æ˜Ÿã€‚&lt;/p>
&lt;p>Ergodoxçš„ä¸€ä¸ªç‰ˆæœ¬ï¼š
&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-2/41980975.jpg" alt="">&lt;/p>
&lt;p>ErgoDoneæ˜æ˜¾å°±å±Œä¸äº†è®¸å¤šï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-5/28663395.jpg" alt="">&lt;/p>
&lt;h2 id="é”®ç›˜ä¸»æ§">é”®ç›˜ä¸»æ§ &lt;a href="#%e9%94%ae%e7%9b%98%e4%b8%bb%e6%8e%a7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-2/32662639.jpg" alt="">&lt;/p>
&lt;p>ErgoDoneä½¿ç”¨äº†Arduino pro microåšä¸ºä¸»æ§ï¼ŒåŸºä¸­ä½¿ç”¨äº†mega32u4åšä¸ºèŠ¯ç‰‡ï¼Œæä¾›äº†æ¨¡æ‹ŸUSBè¾“å…¥è®¾å¤‡çš„ç›¸å…³å‡½æ•°ï¼ˆåŒ…æ‹¬é”®ç›˜ã€é¼ æ ‡ï¼‰ã€‚ç½‘ä¸Šæœ‰è®¸å¤šç°æˆçš„èŒƒä¾‹ï¼Œç”¨è¿™æ¬¾èŠ¯ç‰‡ï¼ˆä»¥åŠå¦ä¸€ç‰ˆä½¿ç”¨mega32u4çš„Arduinoå¼€å‘ç‰ˆï¼ŒArduino Leonardoï¼‰åˆ¶ä½œä½“æ„Ÿé¼ æ ‡ï¼ˆæ­é…é™€èºä»ªï¼‰ã€æ¸¸æˆæ‘‡æ†ï¼ˆæ­é…ç›¸å…³ç¡¬ä»¶ï¼‰ä»¥åŠå„ç§ä¸“ç”¨è¾“å…¥è®¾å¤‡ã€‚&lt;/p>
&lt;p>Arduino pro microæ·˜å®ä»·ä¸åˆ°20å—é’±ï¼Œç›¸å¯¹æ¥è¯´ç®—æ˜¯éå¸¸è¶…å€¼äº†ã€‚&lt;/p>
&lt;h2 id="ç„Šæ¥">ç„Šæ¥ &lt;a href="#%e7%84%8a%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºæœ¬äººç®—æ˜¯èœçš„æŠ è„šçš„ä¸šä½™é€‰æ‰‹ï¼Œåœ¨è¿™ä¸ªé”®ç›˜ä¸Šçš„ä¸»è¦å·¥ä½œå°±æ˜¯ç„Šæ¥ã€‚ç„¶è€Œï¼Œå°±åœ¨ç„Šæ¥è¿™æ ·ä¸€ä»¶ç›¸å¯¹ç®€å•çš„å·¥ä½œä¸Šï¼Œæˆ‘ä¹Ÿæ˜¯è¸©äº†ä¸å°‘å‘ã€‚&lt;/p>
&lt;h3 id="miniusbè½¬microusb">MiniUSBè½¬MicroUSB &lt;a href="#miniusb%e8%bd%acmicrousb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ErgoDoneçš„è®¾è®¡ä¸­ï¼Œæ•´å—é”®ç›˜çš„ä¾›ç”µï¼Œéƒ½æ˜¯é€šè¿‡MiniUSBçº¿æ¥å®Œæˆçš„ã€‚ç„¶è€Œï¼Œpro microçš„æ¥å£æ˜¯MicroUSBçš„ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè½¬æ¢å·¥ä½œã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-2/388124.jpg" alt="">&lt;/p>
&lt;p>MiniUSBï¼Œä¿—ç§°Tå£USBã€‚å…¶ä¸­æœ‰äº”é¢—çº¿ï¼Œä»£è¡¨ä¾›ç”µï¼ŒD+ï¼ŒD-ï¼ŒIDä¸æ¥åœ°ã€‚&lt;/p>
&lt;p>MicroUSBå°±æ˜¯ç°åœ¨å¸‚é¢ä¸Šç»å¤§å¤šæ•°å®‰å“æ‰‹æœºçš„å……ç”µ/æ•°æ®æ¥å£ã€‚å…¶ä¸­çš„çº¿åºä¸MiniUSBä¸­çš„ç±»ä¼¼ï¼Œåªæ˜¯å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨IDçº¿ã€‚&lt;/p>
&lt;p>åœ¨ç„Šæ¥é”®ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆä¸€ä¸ªè‡ªåˆ¶MicroUSBæ¥å£ï¼ŒæŠŠå¯¼çº¿è¿æ¥åˆ°MicroUSBå¤´ä¸Šå»ã€‚è¿™ä¸ªä»»åŠ¡ç›¸å¯¹éš¾åº¦é«˜ä¸€äº›ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿæœ‰å·æ‡’çš„æ–¹å¼ã€‚&lt;/p>
&lt;p>å› ä¸ºMicroUSBçº¿å®åœ¨è¿‡äºæµè¡Œï¼Œç°åœ¨æ— è®ºè°æ‰‹é‡Œéƒ½ä¼šæœ‰é‚£ä¹ˆä¸¤ä¸‰æ¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‹†æ‰æ‰‹æœºå……ç”µçº¿çš„MicroUSBå…¬å¤´ï¼ŒæŠŠå…¶ä¸­çš„çº¿å¼•å‡ºæ¥ï¼Œè¿åˆ°åº”è¯¥è¿çš„ä½ç½®ä¸Šï¼Œå°±å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>å¦‚æœä½ çš„MicroUSBçº¿æ˜¯è‰¯å¿ƒå‚å®¶å‡ºäº§çš„è¯ï¼Œå…¶ä¸­ä¼šæœ‰å››é¢—çº¿ï¼šçº¢ç»¿ç™½é»‘ã€‚&lt;/p>
&lt;ul>
&lt;li>çº¢ï¼šä¾›ç”µï¼Œ5V&lt;/li>
&lt;li>ç»¿ï¼šData+&lt;/li>
&lt;li>ç™½ï¼šData-&lt;/li>
&lt;li>é»‘ï¼šæ¥åœ°&lt;/li>
&lt;/ul>
&lt;p>åœ¨ErgoDoneè¿™é‡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¥åœ°çº¿ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚ç„¶ååœ¨ç„Šæ¥çš„æ—¶å€™è¦æ³¨æ„çº¿ä¸è¦ç•™çš„è¿‡é•¿ï¼Œå¦åˆ™ä¼šå¾ˆéš¾çœ‹ï¼ˆä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆçŸ¥é“ï¼‰ã€‚&lt;/p>
&lt;h3 id="ä¸€äº›æ‰“ç£¨å·¥ä½œ">ä¸€äº›æ‰“ç£¨å·¥ä½œ &lt;a href="#%e4%b8%80%e4%ba%9b%e6%89%93%e7%a3%a8%e5%b7%a5%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ErgoDoneçš„ä¸¤ç‰‡é”®ç›˜æ˜¯é€šè¿‡3.5mmçš„éŸ³é¢‘çº¿è¿æ¥çš„ï¼Œç„¶åéŸ³é¢‘æ¥å£ä¸å‡ºæ„æ–™çš„æ¯”å¤–å£³é¢„ç•™çš„æ¥å£è¦åšä¸€äº›ã€‚æ‰€ä»¥ä¸€äº›æ‰“ç£¨å·¥ä½œæ˜¯å¿…é¡»çš„ã€‚&lt;/p>
&lt;p>è¿™é‡Œæ¨èæ‰“ç£¨ç¥å™¨ â€”â€” ç£¨åˆ€çŸ³ã€‚å¥½çš„ç£¨åˆ€çŸ³æœ‰ç²—ç»†ä¸¤é¢ï¼Œæ–¹ä¾¿æ§åˆ¶ç²’åº¦ï¼ŒåŒæ—¶æ‰“ç£¨çš„æ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚å¦‚æœçœŸçš„å•¥éƒ½æ²¡æœ‰ï¼Œå¯ä»¥å¼ºè¡Œè¯•ä¸€æ³¢æŒ‡ç”²é’³ä¸Šé¢çš„å°æŒ«ã€‚&lt;/p>
&lt;h3 id="å«æ˜Ÿè½´çš„å®‰è£…">å«æ˜Ÿè½´çš„å®‰è£… &lt;a href="#%e5%8d%ab%e6%98%9f%e8%bd%b4%e7%9a%84%e5%ae%89%e8%a3%85" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¯ä»¥å‚è€ƒ&lt;a href="http://tieba.baidu.com/p/3703634467">è¿™ç¯‡å¸–å­&lt;/a>ï¼Œä¸Šé¢å·²ç»è¯´çš„å¾ˆå¥½äº†ï¼Œæˆ‘å°±ä¸é‡å¤äº†ã€‚è®°å¾—é‡è¦çš„ä¸€ç‚¹æ˜¯è¦æŠŠé’¢ä¸å…¥æ‰£ï¼Œå¦åˆ™å¯èƒ½ä¼šå¡é”®ä»€ä¹ˆçš„ã€‚æƒ…å†µå…è®¸ï¼Œè¿˜å¯ä»¥åŠ ä¸€ç‚¹æ¶¦æ»‘è„‚ï¼Œè®©æ‘©æ“¦åŠ›å°ä¸€ç‚¹ã€‚&lt;/p>
&lt;h3 id="ç„Šè½´">ç„Šè½´ &lt;a href="#%e7%84%8a%e8%bd%b4" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç„Šè½´ç›¸å¯¹æ˜¯æœ€ç®€å•çš„ä¸€æ­¥äº†ï¼Œå› ä¸ºç„Šç‚¹çš„è·ç¦»è¶³å¤Ÿè¿œï¼Œè€Œä¸”ä¹Ÿè¶³å¤Ÿå¤§ã€‚åªæ˜¯æ³¨æ„åˆ«åœ¨ç„Šç›˜ä¸Šåœç•™å¤ªå¤šæ—¶é—´ï¼ŒæŠŠç„Šç›˜å¼„æ‰äº†å°±å¥½ã€‚&lt;/p>
&lt;h3 id="é£çº¿ä¸tdd">é£çº¿ä¸TDD &lt;a href="#%e9%a3%9e%e7%ba%bf%e4%b8%8etdd" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸¤ä¸ªæ”¾åœ¨ä¸€èµ·å†™çš„åŸå› æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæŠ€æœ¯éƒ½éœ€è¦ä¸€æ ·å·¥å…· â€”â€” ä¸‡ç”¨è¡¨ã€‚å½“ç„¶è¿™é‡Œåªæ˜¯ç”¨æ¥æµ‹è¿é€šæ€§çš„ï¼Œæ‰€ä»¥å¦‚æœä½ æ„¿æ„æŠ˜è…¾ï¼Œè‡ªå·±ç”¨å‘å…‰äºŒçº§ç®¡è‡ªå·±æä¸€æŠŠä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬æ“ä½œä¸å½“ï¼Œä¸å°å¿ƒæŠŠç„Šç›˜æä¸‹æ¥äº†ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è¡¥æ•‘å‘¢ã€‚ç­”æ¡ˆæ˜¯é£çº¿ï¼Œå°±æ˜¯ä¸å€ŸåŠ©ç”µè·¯æ¿ä¸Šçš„ç”µè·¯ï¼Œè€Œæ˜¯æ˜¾å¼çš„ç”¨å¯¼çº¿æ¥å¯¼é€šæŸä¸¤ä¸ªæˆ–å¤šä¸ªç®¡è„šã€‚&lt;/p>
&lt;p>ErgoDoneç”±äºæ˜¯å¯¹ç§°çš„ä¸¤å—ï¼Œæ‰€ä»¥åœ¨ç„Šå´©äº†ä¹‹åï¼Œå¯ä»¥ä¾æ ·æ‰¾ä¸€ä¸ªå¯ç”¨çš„ç„Šç›˜æ¥æ‰¾å¯ä»¥é£çº¿çš„ç„Šç‚¹ã€‚å¦‚æœæ‰‹é‡Œåªæœ‰ä¸€å—æ¿å­è€Œä¸”æƒ…å†µä¸å…è®¸çš„è¯ï¼Œå°±åªå¥½åœ¨ç„Šä¹‹å‰ï¼Œå°¤å…¶æ˜¯æ¯”è¾ƒé«˜éš¾åº¦çš„æ“ä½œä¹‹å‰ï¼Œå…ˆç•™å¥½plan Bï¼Œæƒ³æƒ³ä¸‡ä¸€æç ¸äº†æœ‰æ²¡æœ‰å›æ»šæ–¹æ¡ˆï¼ˆè›¤ï¼‰ã€‚&lt;/p>
&lt;p>TDDï¼Œåˆç§°æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚å°±æ˜¯åœ¨ç„Šå®Œä¸€éƒ¨åˆ†ä¹‹åï¼Œç«‹åˆ»è¿›è¡Œæµ‹è¯•ã€‚æ¯”å¦‚é›†æˆç”µè·¯æˆ–è€…ä¸»æ§ï¼Œåœ¨ç„Šå®Œä¹‹åï¼Œä¸€å®šè¦ç”¨ä¸‡ç”¨è¡¨ç¡®è®¤ä¸€ä¸‹æ˜¯ä¸æ˜¯æœ‰ç›¸ä¸´ç®¡è„šçŸ­è·¯çš„æƒ…å†µã€‚åœ¨äºŒæç®¡ç„Šå®Œä¹‹åï¼Œç”¨é•Šå­æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥è§¦å‘ç›¸åº”çš„æŒ‰é”®ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªåŠæˆå“ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-2/35993621.jpg" alt="">&lt;/p>
&lt;h2 id="å¯¹é”®ç›˜ç¼–ç¨‹">å¯¹é”®ç›˜ç¼–ç¨‹ &lt;a href="#%e5%af%b9%e9%94%ae%e7%9b%98%e7%bc%96%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ç§DIYé”®ç›˜çš„ä¸€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥è‡ªå®šä¹‰é…åˆ—ï¼Œé€šè¿‡Fné”®åšä¸€äº›å¾ˆfancyçš„äº‹æƒ…ã€‚æ¯”å¦‚è§¦å‘ç»„åˆé”®ï¼Œæˆ–è€…æ˜¯å½•åˆ¶ä¸€äº›å®ã€‚å¯¹äºç¨‹åºå‘˜å’Œä¸€äº›æ¸¸æˆç©å®¶æ¥è¯´ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯éå¸¸å¸å¼•äººçš„ã€‚&lt;/p>
&lt;h3 id="æˆ‘çš„é…åˆ—">æˆ‘çš„é…åˆ— &lt;a href="#%e6%88%91%e7%9a%84%e9%85%8d%e5%88%97" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é»˜è®¤å±‚ï¼šhttp://www.keyboard-layout-editor.com/#/gists/a9278a768f78adf9d7b019b883678390&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-5/11486899.jpg" alt="">&lt;/p>
&lt;p>Fnå±‚ï¼šhttp://www.keyboard-layout-editor.com/#/gists/79ad8e6c4ac70cfad1ed400355e960a7&lt;/p>
&lt;p>å³æ‰‹çš„é‚£å †Fnå¯¹åº”ç€0~9ä¸Šé¢çš„ç¬¦å·&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-5/90976851.jpg" alt="">&lt;/p>
&lt;p>Vimå±‚ï¼šhttp://www.keyboard-layout-editor.com/#/gists/950dc52b3b27c24601661f2fd43a6d69&lt;/p>
&lt;p>æ¨¡ä»¿vim/bashæ˜ å°„äº†ä¸€äº›å¿«æ·é”®&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-5/92544582.jpg" alt="">&lt;/p>
&lt;p>é­”æ”¹å±‚ï¼šhttp://www.keyboard-layout-editor.com/#/gists/8bb13d2439c542a06d99e17fca3a234b&lt;/p>
&lt;p>ç”¨æ¥é­”æ”¹/åˆ›é€ ä¸€äº›ä¸å­˜åœ¨çš„é”®ä½å’Œç»„åˆ&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-5/28220231.jpg" alt="">&lt;/p>
&lt;p>é£ŸæŒ‡å¤šå‡ºæ¥çš„å››ä¸ªé”®åˆ†åˆ«å¯¹åº”ç€å››ç§æ‹¬å·&lt;code>&amp;lt;&amp;gt;(){}[]&lt;/code>ã€‚åœ¨ç¼–ç¨‹ä¸­ä¼šæ¯”è¾ƒå¸¸ç”¨åˆ°ã€‚&lt;/p>
&lt;h3 id="é­”æ”¹ä¸¾ä¾‹">é­”æ”¹ä¸¾ä¾‹ &lt;a href="#%e9%ad%94%e6%94%b9%e4%b8%be%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨é£ŸæŒ‡çš„æ‰©å……é”®ä½ä¸­ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªä¸å­˜åœ¨çš„é”®ä½ç»„åˆï¼š&lt;code>&amp;lt;(&lt;/code>å’Œ&lt;code>&amp;gt;)&lt;/code>ã€‚å³åœ¨é»˜è®¤çŠ¶æ€ä¸‹ï¼Œè¾“å…¥&lt;code>()&lt;/code>ï¼›åœ¨ShiftçŠ¶æ€ä¸‹ï¼Œè¾“å…¥&lt;code>&amp;lt;&amp;gt;&lt;/code>ã€‚è¿™ç§è®¾è®¡å¹¶æ²¡æœ‰ç›´æ¥çš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äºåœ†æ‹¬å·çš„è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»„åˆé”®å®ã€‚è€ŒShiftè¾“å…¥å°–æ‹¬å·ï¼Œåˆ™éœ€è¦ä¸€äº›æŠ€å·§ã€‚&lt;/p>
&lt;p>å¹¸å¥½ä¹‹å‰å·²ç»æœ‰äººæå‡ºå¹¶è§£å†³äº†&lt;a href="https://github.com/tmk/tmk_keyboard/wiki/FAQ-Keymap#esc-and--on-a-key">ç±»ä¼¼çš„é—®é¢˜&lt;/a>ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å°†Shiftæ”¹æˆâ€œFn+Shiftâ€ï¼Œåœ¨æŒ‰ä¸‹Shiftçš„åŒæ—¶ï¼Œåˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„å±‚ä¸Šã€‚æ–°çš„å±‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç»„åˆé”®å®è¾“å…¥å°–æ‹¬å·ã€‚è€Œå‰©ä¸‹çš„é”®ä½ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºé€æ˜ã€‚å½“ä½ æŒ‰ä¸‹å…¶å®ƒçš„é”®æ—¶ï¼Œä¸å¹³æ—¶æŒ‰ä¸‹Shiftæ²¡æœ‰åŒºåˆ«ã€‚&lt;/p>
&lt;h2 id="æœ€ç»ˆçš„ä»£ç ">æœ€ç»ˆçš„ä»£ç  &lt;a href="#%e6%9c%80%e7%bb%88%e7%9a%84%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Generated by TKG at 2016-10-05 22:35:43
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;#34;keymap_common.h&amp;#34;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define KEYMAP_TKG( \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K0A, K0B, K0C, K0D, K0E, K0F, K0G, K0H, K0I, K0J, K0K, K0L, K0M, K0N, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K1A, K1B, K1C, K1D, K1E, K1F, K1G, K1H, K1I, K1J, K1K, K1L, K1M, K1N, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K2A, K2B, K2C, K2D, K2E, K2F, K2I, K2J, K2K, K2L, K2M, K2N, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K3A, K3B, K3C, K3D, K3E, K3F, K3G, K3H, K3I, K3J, K3K, K3L, K3M, K3N, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K4A, K4B, K4C, K4D, K4E, K4J, K4K, K4L, K4M, K4N, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> K5B, K5C, K5D, K5E, K5F, K5G, K5H, K5I, K5J, K5K, K5L, K5M \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_##K0A, KC_##K0B, KC_##K0C, KC_##K0D, KC_##K0E, KC_##K0F, KC_##K0G, KC_##K0H, KC_##K0I, KC_##K0J, KC_##K0K, KC_##K0L, KC_##K0M, KC_##K0N }, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_##K1A, KC_##K1B, KC_##K1C, KC_##K1D, KC_##K1E, KC_##K1F, KC_##K1G, KC_##K1H, KC_##K1I, KC_##K1J, KC_##K1K, KC_##K1L, KC_##K1M, KC_##K1N }, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_##K2A, KC_##K2B, KC_##K2C, KC_##K2D, KC_##K2E, KC_##K2F, KC_NO, KC_NO, KC_##K2I, KC_##K2J, KC_##K2K, KC_##K2L, KC_##K2M, KC_##K2N }, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_##K3A, KC_##K3B, KC_##K3C, KC_##K3D, KC_##K3E, KC_##K3F, KC_##K3G, KC_##K3H, KC_##K3I, KC_##K3J, KC_##K3K, KC_##K3L, KC_##K3M, KC_##K3N }, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_##K4A, KC_##K4B, KC_##K4C, KC_##K4D, KC_##K4E, KC_NO, KC_NO, KC_NO, KC_NO, KC_##K4J, KC_##K4K, KC_##K4L, KC_##K4M, KC_##K4N }, \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> { KC_NO, KC_##K5B, KC_##K5C, KC_##K5D, KC_##K5E, KC_##K5F, KC_##K5G, KC_##K5H, KC_##K5I, KC_##K5J, KC_##K5K, KC_##K5L, KC_##K5M, KC_NO } \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#ifdef KEYMAP_SECTION_ENABLE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint8_t&lt;/span> keymaps[][MATRIX_ROWS][MATRIX_COLS] __attribute__ ((section (&lt;span style="color:#e6db74">&amp;#34;.keymap.keymaps&amp;#34;&lt;/span>))) &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint8_t&lt;/span> keymaps[][MATRIX_ROWS][MATRIX_COLS] PROGMEM &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> KEYMAP_TKG(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GRV, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, HOME,END, &lt;span style="color:#ae81ff">6&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, BSPC, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TAB, Q, W, E, R, T, LBRC,RBRC,Y, U, I, O, P, BSLS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ESC, A, S, D, F, G, H, J, K, L, SCLN,QUOT, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FN3, Z, X, C, V, B, FN7, FN8, N, M, COMM,DOT, SLSH,FN3, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LCTL,LGUI,LALT,FN11,DEL, MINS,EQL, F10, F11, F12, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LCTL,FN2, SPC, FN4, PSCR,CAPS,FN6, PAUS,FN5, ENT, FN1, LGUI),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> KEYMAP_TKG(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,F1, F2, F3, F4, F5, TRNS,TRNS,F6, F7, F8, F9, F10, DEL, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, TRNS,TRNS,FN21,FN22,FN23,FN24,FN25,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,&lt;span style="color:#ae81ff">6&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, FN26,FN27,FN28,FN29,FN30,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS, VOLU,VOLD,MPRV,MPLY,MNXT, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> KEYMAP_TKG(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,END, TRNS,TRNS,TRNS,TRNS,TRNS,PGUP,INS, TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,HOME,TRNS,PGDN,TRNS,TRNS, LEFT,DOWN,UP, RGHT,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,DEL, TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,FIND,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS, TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">3&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> KEYMAP_TKG(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,FN9, FN10,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,TRNS,TRNS,TRNS, TRNS,TRNS,TRNS,TRNS,TRNS, \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TRNS,TRNS,BSPC,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS,TRNS),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#ifdef KEYMAP_SECTION_ENABLE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint16_t&lt;/span> fn_actions[] __attribute__ ((section (&lt;span style="color:#e6db74">&amp;#34;.keymap.fn_actions&amp;#34;&lt;/span>))) &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">uint16_t&lt;/span> fn_actions[] PROGMEM &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> [&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_LAYER_MOMENTARY(&lt;span style="color:#ae81ff">1&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">2&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_LAYER_MOMENTARY(&lt;span style="color:#ae81ff">2&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">3&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_LAYER_MODS(&lt;span style="color:#ae81ff">3&lt;/span>, MOD_LSFT),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">4&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LGUI, KC_SPACE),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">5&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LGUI, KC_TAB),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">6&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_LAYER_TOGGLE(&lt;span style="color:#ae81ff">1&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">7&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_9),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">8&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_0),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">9&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_COMMA),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">10&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_DOT),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">11&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS(MOD_LCTL &lt;span style="color:#f92672">|&lt;/span> MOD_LSFT &lt;span style="color:#f92672">|&lt;/span> MOD_LALT &lt;span style="color:#f92672">|&lt;/span> MOD_LGUI),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">21&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_1),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">22&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_2),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">23&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_3),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">24&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_4),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">25&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_5),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">26&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_6),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">27&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_7),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">28&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_8),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">29&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_9),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">30&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> ACTION_MODS_KEY(MOD_LSFT, KC_0),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æˆæœ¬ç»Ÿè®¡">æˆæœ¬ç»Ÿè®¡ &lt;a href="#%e6%88%90%e6%9c%ac%e7%bb%9f%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>PCBæ¿ + å¤–å£³ = 220 RMB ï¼ˆå·²åŠ é‚®è´¹ï¼‰&lt;/li>
&lt;li>è½´ + å¹³è¡¡æ  + ç¯ = 100 RMB ï¼ˆåŒ…é‚®ï¼‰&lt;/li>
&lt;li>é”®å¸½ = 119RMB ï¼ˆåŒ…é‚®ï¼‰&lt;/li>
&lt;li>åˆè®¡ï¼š440RMB&lt;/li>
&lt;/ul>
&lt;p>æ€»çš„çœ‹æ¥ï¼Œè¿™ä¸ªå¤åˆ»ç‰ˆæœ¬ï¼Œæ¯”å›½å¤–åŠ¨è¾„ä¸Šç™¾åˆ€çš„ç‰ˆæœ¬æ›´æœ‰å¸å¼•åŠ›ã€‚ä¸è¿‡é«˜å¤§ä¸Šç¨‹åº¦è¿˜æ˜¯ç•¥é€Šä¸€ç­¹ã€‚&lt;/p>
&lt;p>ErgoDoneï¼Œè®©ä½ é‡æ–°å®šï¼ˆå­¦ï¼‰ä¹‰ï¼ˆä¹ ï¼‰æ‰“å­—ã€‚&lt;/p></description></item><item><title>é˜»å¡TCPæµ - phxrpcä»£ç é˜…è¯»(3)</title><link>https://wizmann.top/posts/phxrpc-3/</link><pubDate>Mon, 03 Oct 2016 22:22:14 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-3/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>phxrpcçš„æµï¼ˆ&lt;code>stream&lt;/code>å’Œ&lt;code>streambuf&lt;/code>ï¼‰ä¸ç½‘ç»œè®¿é—®å…¶å®æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥æœ¬æ–‡å¯ä»¥ç»“åˆç€ç¬¬ä¸€ç¯‡ç¬”è®°ä¸€èµ·æ¥çœ‹ã€‚è™½ç„¶æˆ‘éå¸¸æƒ³åæ§½è¿™ç§å¼ºè€¦åˆæ€§çš„è®¾è®¡ï¼Œä½†æ˜¯æˆ‘å†³å®šè¿˜æ˜¯å¥½å¥½ç†è§£phxrpcçš„è®¾è®¡ä¹‹åã€‚ã€‚ã€‚æ”’ä¸€æ³¢å¤§çš„ï¼šï¼‰&lt;/p>
&lt;h2 id="blocktcpstreambuf">BlockTcpStreamBuf &lt;a href="#blocktcpstreambuf" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>class BlockTcpStreamBuf&lt;/code>ç»§æ‰¿è‡ª&lt;code>BaseTcpStreamBuf&lt;/code>ã€‚å…¶ä¸­é‡å†™äº†&lt;code>precv&lt;/code>å’Œ&lt;code>psend&lt;/code>ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æŒæœ‰äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦(file descriptor)ï¼š&lt;code>socket_&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>precv&lt;/code>å’Œ&lt;code>psend&lt;/code>ç›´æ¥è°ƒç”¨äº†&lt;code>&amp;lt;sys/socket.h&amp;gt;&lt;/code>ä¸­çš„&lt;code>recv(2)&lt;/code>å’Œ&lt;code>send(2)&lt;/code>ï¼Œå¹¶æ²¡æœ‰å…¶å®ƒæ“ä½œã€‚&lt;/p>
&lt;p>ç½‘ç»œç›¸å…³çš„æ“ä½œï¼Œåˆ™ç”±&lt;code>class BlockTcpStream&lt;/code>æ¥è´Ÿè´£ã€‚&lt;code>BlockTcpStreamBuf&lt;/code>åªè´Ÿè´£IOéƒ¨åˆ†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (BaseTcpUtils&lt;span style="color:#f92672">::&lt;/span>SetNonBlock(sockfd, false)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> BaseTcpUtils&lt;span style="color:#f92672">::&lt;/span>SetNoDelay(sockfd, true)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stream&lt;span style="color:#f92672">-&amp;gt;&lt;/span>Attach(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> phxrpc&lt;span style="color:#f92672">::&lt;/span>log(LOG_ERR, &lt;span style="color:#e6db74">&amp;#34;set nonblock fail&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> error &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;code>BlockTcpStream&lt;/code>æŠŠfdä¼ é€’ç»™&lt;code>BlockTcpStreambuf&lt;/code>ä¹‹å‰ï¼Œéœ€è¦æŠŠfdè®¾ç½®ä¸º&lt;code>block&lt;/code>çš„ã€‚è€Œè¿™æ®µä»£ç æœ€å¤§çš„æ§½ç‚¹å°±æ˜¯è¿™ä¸ª&lt;code>SetNonBlock&lt;/code>å‡½æ•°ï¼Œå’Œä¸‹é¢çš„&lt;code>set nonblock fail&lt;/code>æ—¥å¿—ï¼ˆæƒ³ä¸€æƒ³ï¼‰ã€‚å®Œå…¨è®©äººæ‘¸ä¸åˆ°å¤´è„‘ï¼Œè¾¾åˆ°ä¸€è„¸æ‡µé€¼çš„æœ€é«˜å¢ƒç•Œã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/87163832.jpg" alt="">&lt;/p>
&lt;p>ç”±äº&lt;code>recv&lt;/code>å’Œ&lt;code>send&lt;/code>å‡½æ•°æ˜¯&lt;code>block&lt;/code>çš„ï¼Œæ‰€ä»¥åœ¨è¯»å–ã€å†™å…¥ç¼“å†²åŒºæ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®å¯è¯»æˆ–æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å¯å†™ï¼Œåˆ™è¯»å–å†™å…¥æ“ä½œä¼šé˜»å¡ä½ã€‚&lt;/p>
&lt;h2 id="blocktcpstream">BlockTcpStream &lt;a href="#blocktcpstream" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨è¿™é‡Œæˆ‘åˆæƒ³åä¸ªæ§½äº†ï¼Œä¸ºå•¥åœ¨è¿™é‡ŒæŠŠTCP Serverå’ŒClientçš„å·¥ä½œæµæ··ä¸ºä¸€è°ˆã€‚æˆ‘è§‰å¾—è‡³å°‘åº”è¯¥ä»å‘½åä¸ŠåŒºåˆ†ä¸€ä¸‹ï¼Œå¦åˆ™æå®¹æ˜“è¯¯ç”¨ã€‚&lt;/p>
&lt;h3 id="tcpçš„å·¥ä½œæµç¨‹">TCPçš„å·¥ä½œæµç¨‹ &lt;a href="#tcp%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/92621506.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šUNIXç½‘ç»œç¼–ç¨‹å·ä¸€ï¼šå¥—æ¥å­—ç¼–ç¨‹ 4.2èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒTCPçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„å·¥ä½œæµç¨‹æ˜¯ä¸åŒçš„ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå®¢æˆ·ç«¯çš„ç¨‹åºè¦ç®€å•ä¸€äº›ã€‚&lt;/p>
&lt;p>&lt;code>BlockTcpStream&lt;/code>ä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨çš„å‡½æ•°åªæœ‰&lt;code>BlockTcpUtils::Open&lt;/code>ï¼Œè€ŒæœåŠ¡ç«¯çš„&lt;code>BlockTCPUtils::Listen&lt;/code>å‡½æ•°åŒ…æ‹¬äº†&lt;code>bind()&lt;/code>å’Œ&lt;code>listen()&lt;/code>ä¸¤ä¸ªæ“ä½œï¼Œè€Œ&lt;code>accept()&lt;/code>åˆ™éœ€è¦å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨ã€‚&lt;/p>
&lt;h3 id="so_reuseaddr">SO_REUSEADDR &lt;a href="#so_reuseaddr" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨æœåŠ¡ç«¯çš„&lt;code>Listen()&lt;/code>å‡½æ•°ä¸­ï¼Œphxrpcä½¿ç”¨äº†&lt;code>SO_REUSEADDR&lt;/code>é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹çš„æ„åœ¨é€šçŸ¥å†…æ ¸ï¼šå¦‚æœç«¯å£å¿™ï¼Œä½†æ˜¯TCPçŠ¶æ€ä½äº&lt;code>TIME_WAIT&lt;/code>æ—¶ï¼Œå¯ä»¥é‡ç”¨ç«¯å£ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªå¥—æ¥å­—å…¶å®æ˜¯ä¸€ä¸ª&lt;code>ï¼ˆåè®®ï¼Œæºåœ°å€ï¼Œæºç«¯å£ï¼Œç›®æ ‡åœ°å€ï¼Œç›®æ ‡ç«¯å£ï¼‰&lt;/code>äº”å…ƒç»„ã€‚&lt;code>SO_REUSEADDR&lt;/code>æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é‡ç”¨æºåœ°å€å’Œæºç«¯å£ã€‚å½“ç„¶æ­¤æ—¶çš„é£é™©åœ¨äºå¦‚æœè¯¥åŸå¥—æ¥å­—å‘é€äº†ä¸€äº›é”™è¯¯çš„æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„TCPå·¥ä½œæµå°±ä¼šäº§ç”Ÿé”™ä¹±ã€‚ä½†æ˜¯ç”±äºTCPçš„å®ç°ä¸­ï¼Œé€šè¿‡éšæœºçš„æ¶ˆæ¯åºå·è§„é¿äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œçš„é£é™©å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>SO_REUSEADDR&lt;/code>çš„å¥½å¤„æ˜¯ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºå´©æºƒå’Œé€€å‡ºæ—¶ï¼ˆå¯¹äºä¸€èˆ¬çš„æœåŠ¡ç«¯ç¨‹åºæ¥è¯´ï¼Œå´©æºƒå’Œé€€å‡ºæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼‰ï¼Œå¯ä»¥ç«‹å³é‡å¯ï¼Œè€Œä¸éœ€è¦ç­‰å¾…2MSLæ—¶é—´ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦ç­‰å¾…2MSLæ—¶é—´å‘¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/33186679.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šEffective TCP/IP 3.8èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>TCPæ‹†é™¤è¿æ¥ä½¿ç”¨äº†å››æ¬¡æ¡æ‰‹çš„æœºåˆ¶ï¼Œè€Œä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹åœ¨å‘é€å®Œæœ€åä¸€ä¸ªACKä¹‹åï¼Œéœ€è¦ç­‰å¾…2MSLçš„æ—¶é—´ã€‚è¿™å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œå½“æœåŠ¡å™¨é‡å¯åï¼Œå‡ºç°&lt;code>Address already in use&lt;/code>çš„æŠ¥é”™ä¿¡æ¯ï¼Œéœ€è¦é¢å¤–ç­‰å¾…å¤§çº¦1~4åˆ†é’Ÿçš„åŸå› ã€‚&lt;/p>
&lt;p>ç©¶å…¶åŸå› ï¼ŒTIME-WAITçŠ¶æ€çš„æ„å›¾åœ¨äºé¿å…ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€ç«¯æœ€åä¸€ä¸ªACKå‘é€å¤±è´¥ã€‚æ­¤æ—¶ï¼Œä¸»æœº1å·²ç»å®Œå…¨å…³é—­ï¼Œè€Œä¸»æœº2å› ä¸ºæ²¡æœ‰æ”¶åˆ°FINåŒ…çš„ACKï¼Œå¤„äºåŠå…³é—­çŠ¶æ€ã€‚æ­¤æ—¶ä¸»æœº2å‘ä¸»æœº1å‘é€çš„ä»»ä½•ä¿¡æ¯ï¼ˆå¦‚å»¶è¿Ÿçš„ACKåŒ…ç­‰ï¼‰éƒ½åªä¼šæ”¶åˆ°RSTï¼Œå¯¼è‡´è¿æ¥çš„å¼‚å¸¸å…³é—­ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œä¸»åŠ¨å…³é—­ç«¯éœ€è¦ç­‰å¾…2MSLæ—¶é—´ã€‚ä¸€ä¸ªMSLæ˜¯ç»™æœ€åçš„ACKåŒ…ï¼Œè€Œå¦å¤–ä¸€ä¸ªMSLï¼Œæ˜¯ä¸ºäº†ç­‰å¾…è¢«åŠ¨å…³é—­ç«¯é‡æ–°å‘é€FINåŒ…ã€‚å¦‚æœåœ¨TIME_WAITæœŸé—´æ”¶åˆ°äº†å¯¹ç«¯çš„æ•°æ®åŒ…ï¼Œä¼šåˆ·æ–°TIME_WAITçŠ¶æ€çš„æ—¶é—´ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å‚è€ƒï¼šEffective TCP/IP 3.8 3.9èŠ‚&lt;/p>&lt;/blockquote>
&lt;h3 id="ioå¤ç”¨poll">IOå¤ç”¨ï¼šPoll &lt;a href="#io%e5%a4%8d%e7%94%a8poll" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/84501111.jpg" alt="">&lt;/p>
&lt;blockquote>
&lt;p>å›¾ç‰‡æ¥æºï¼šUNIXç½‘ç»œç¼–ç¨‹å·ä¸€ï¼šå¥—æ¥å­—ç¼–ç¨‹ 6.2èŠ‚&lt;/p>&lt;/blockquote>
&lt;p>IOå¤ç”¨æ˜¯æŒ‡å†…æ ¸åœ¨å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªIOæ¡ä»¶å°±ç»ªï¼Œå†…æ ¸å°±é€šçŸ¥è¿›ç¨‹ã€‚é€šå¸¸æ¥è®²ï¼Œå¸¸ç”¨çš„IOå¤ç”¨å‡½æ•°æœ‰&lt;code>select()&lt;/code>å’Œ&lt;code>poll()&lt;/code>ã€‚&lt;/p>
&lt;p>å½“&lt;code>poll()&lt;/code>è¿”å›åï¼Œæˆ‘ä»¬éœ€è¦éå†å…¶ä¸­çš„fdæ•°ç»„æ‰¾åˆ°å¯æ“ä½œçš„fdã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">pollfd&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> fd; &lt;span style="color:#75715e">/* file descriptor */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">short&lt;/span> events; &lt;span style="color:#75715e">/* requested events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">short&lt;/span> revents; &lt;span style="color:#75715e">/* returned events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥ä»&lt;code>events&lt;/code>å’Œ&lt;code>revents&lt;/code>è·å¾—è¯¥fdçš„çŠ¶æ€ï¼Œä»è€Œåˆ¤åˆ«å¯è¯»ã€å¯å†™ã€è¶…æ—¶æˆ–å‡ºé”™ã€‚&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨pollå‡½æ•°çš„IOå¤ç”¨èƒ½åŠ›ï¼Œè€Œæ˜¯æŠŠå®ƒåšä¸ºå¦ä¸€ä¸ªé˜»å¡IOè°ƒç”¨æ¥ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&lt;code>BlockTcpUtils::Open&lt;/code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†pollï¼Œç”¨æ¥ç›‘è§†ç›¸åº”çš„ï¼ˆä¸€ä¸ªï¼‰fdæ˜¯å¦å¯è¯»ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±éšå¼ï¼ˆä¸ºä»€ä¹ˆè¯´éšå¼å‘¢ï¼Œå› ä¸ºä»–ä»¬ä¸€ä¸å†™æ–‡æ¡£ï¼ŒäºŒä¸å†™æ³¨é‡Šï¼Œä¸€åˆ‡éƒ½æ˜¯æ½œè§„åˆ™ï¼‰è§„å®šäº†C/Säº¤äº’çš„åŸºæœ¬å·¥ä½œæµç¨‹ï¼šå½“C/Sè¿æ¥å»ºç«‹åï¼ŒServerç«¯è¦å…ˆè¯´è¯ï¼ŒClientç«¯æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œä¸‹é¢çš„æµç¨‹ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Clientï¼šâ€œä¸ç®¡ä½ ä»¬ä¿¡ä¸ä¿¡ï¼Œæ˜¯Serverå…ˆåŠ¨çš„æ‰‹ã€‚â€&lt;/p>&lt;/blockquote>
&lt;p>å…·ä½“ä¸ºä»€ä¹ˆå…ˆç”¨pollï¼Œå†æŠŠfdè®¾ä¸º&lt;code>blocking&lt;/code>çš„ï¼Œæˆ‘è¡¨ç¤ºäºŒè„¸æ‡µé€¼ã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œå³ä½¿æŠŠpollåˆ æ‰ï¼Œæµ‹è¯•ä»£ç ä¹Ÿæ˜¯å¯ä»¥workçš„ã€‚å¯èƒ½åœ¨åé¢çš„ä»£ç é˜…è¯»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥è·å¾—è§£é‡Šå§ã€‚&lt;/p>
&lt;p>å’Œselectä¸€æ ·ï¼Œpollä¹Ÿå­˜åœ¨è¢«ä¸­æ–­çš„æƒ…å†µï¼Œåœ¨phxrpcçš„ä»£ç é‡Œï¼Œæˆ‘ä»¬ç»™äº†ä¸­æ–­â€œa second chanceâ€ã€‚å½“pollè¢«ä¸­æ–­åï¼Œä¼šé‡æ–°å†pollä¸€æ¬¡ï¼›å¦‚æœè¿™æ¬¡å†è¢«ä¸­æ–­ï¼Œåˆ™ç›´æ¥è¿”å›TIMEOUTã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// retry again for EINTR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ret &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">::&lt;/span>poll(&lt;span style="color:#f92672">&amp;amp;&lt;/span>pfd, &lt;span style="color:#ae81ff">1&lt;/span>, timeout_ms);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> ret &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> EINTR &lt;span style="color:#f92672">==&lt;/span> errno)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">==&lt;/span> ret)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> errno &lt;span style="color:#f92672">=&lt;/span> ETIMEDOUT;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å &lt;a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºè¿™ç¯‡æ–‡ç« ä¸­çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒæ‚ï¼Œå†™ä½œçš„é¡ºåºä¹Ÿæ˜¯éšæœºçš„ã€‚æ‰€ä»¥è¿è´¯æ€§ä¸æ˜¯é‚£ä¹ˆå¼ºã€‚å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¿ç€ç‚¹å§æ‚¨å°±ã€‚&lt;/p>
&lt;p>å¿ä¸äº†çš„è¯ã€‚ã€‚ã€‚é‚£å°±ç•™è¨€äº¤æµå§~&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-10-3/42112021.jpg" alt="">&lt;/p></description></item><item><title>å®šæ—¶å™¨ä»¥åŠå…¶å®ƒ - phxrpcé˜…è¯»ç¬”è®°(2)</title><link>https://wizmann.top/posts/phxrpc-2/</link><pubDate>Thu, 29 Sep 2016 01:28:09 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-2/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>phxrpcä½¿ç”¨äº†åç¨‹(ucontext)å’ŒIOå¤ç”¨æŠ€æœ¯(epoll)æ¥å®ç°ç½‘ç»œé€šä¿¡ã€‚å®šæ—¶å™¨åœ¨å…¶ä¸­èµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹phxrpcçš„&lt;code>timer.[h|cpp]&lt;/code>ä¸­çš„ä»£ç ã€‚&lt;/p>
&lt;h2 id="system_clock-vs-steady_clock">system_clock vs steady_clock &lt;a href="#system_clock-vs-steady_clock" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>system_clock&lt;/code>å’Œ&lt;code>steadly_clock&lt;/code>éƒ½æ˜¯æ¥è‡ª&lt;code>&amp;lt;chrono&amp;gt;&lt;/code>åº“ï¼Œéƒ½æ˜¯ç”¨æ¥è·å–å½“å‰æ—¶é—´çš„ã€‚&lt;/p>
&lt;p>&lt;code>system_clock&lt;/code>ç”¨æ¥ä»ç³»ç»Ÿæ—¶é’Ÿè·å–æ—¶é’Ÿæ—¶é—´(wall clock time)ï¼Œè€Œ&lt;code>steadly_clock&lt;/code>è·å–çš„æ˜¯æ—¶é’Ÿtickï¼Œè€Œä¸”ä¿è¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ—¶é’Ÿtickæ•°ä¸ä¼šå˜å°ã€‚&lt;/p>
&lt;p>ç„¶è€Œå®é™…ä¸Šï¼Œåœ¨æŸäº›ç³»ç»Ÿä¸‹ï¼Œè¿™ä¸¤ä¸ªæ—¶é’Ÿçš„å®ç°æ˜¯ä¸€è‡´çš„ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ&lt;a href="http://stackoverflow.com/questions/13263277/difference-between-stdsystem-clock-and-stdsteady-clock">è¿™é‡Œ&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨ï¼šåœ¨clang++ 4.2.1, g++ 5.4 ä¸‹å®éªŒï¼Œè¿™ä¸¤ä¸ªæ—¶é’Ÿæ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥ä¸ªäººè®¤ä¸ºåœ¨è¿™é‡Œæœ€å¥½ä¸è¦åšä»»ä½•æ— æ„ä¹‰çš„å‡è®¾ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="å‡ æ¯«ç§’çš„å®‰ç¡">å‡ æ¯«ç§’çš„å®‰ç¡ &lt;a href="#%e5%87%a0%e6%af%ab%e7%a7%92%e7%9a%84%e5%ae%89%e7%9d%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> Timer &lt;span style="color:#f92672">::&lt;/span> MsSleep(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> time_ms) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timespec t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.tv_sec &lt;span style="color:#f92672">=&lt;/span> time_ms &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">1000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t.tv_nsec &lt;span style="color:#f92672">=&lt;/span> (time_ms &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">1000&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">1000000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ret &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ret &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">::&lt;/span>nanosleep(&lt;span style="color:#f92672">&amp;amp;&lt;/span>t, &lt;span style="color:#f92672">&amp;amp;&lt;/span>t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">while&lt;/span> (ret &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> errno &lt;span style="color:#f92672">==&lt;/span> EINTR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œphxrpcä½¿ç”¨äº†&lt;code>nanosleep&lt;/code>å®ç°äº†é«˜ç²¾åº¦çš„sleepã€‚&lt;/p>
&lt;p>æ³¨æ„è¿™é‡Œçš„ç”¨æ³•ï¼Œç”±äº&lt;code>nanosleep&lt;/code>å¯èƒ½è¢«ä¿¡å·ä¸­æ–­ï¼Œæ­¤æ—¶errnoè¢«è®¾ä¸º&lt;code>EINTR&lt;/code>ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œé¢å¤–çš„åˆ¤æ–­ã€‚å½“nanosleepè¢«ä¿¡å·ä¸­æ–­æ—¶ï¼Œä¼šæŠŠå‰©ä½™æ—¶é—´å†™å…¥ç¬¬äºŒä¸ªå‚æ•°æŒ‡å‘çš„&lt;code>timespec&lt;/code>å˜é‡ä¸­ï¼Œä¹‹åæˆ‘ä»¬å†æ¬¡è°ƒç”¨&lt;code>nanosleep&lt;/code>ï¼Œå°±å¯ä»¥æŠŠå‰©ä½™çš„æ—¶é—´å†ç¡ä¸€ä¸ªå›ç¬¼è§‰äº†ã€‚&lt;/p>
&lt;h2 id="å¯åˆ é™¤ä¼˜å…ˆé˜Ÿåˆ—">å¯åˆ é™¤ä¼˜å…ˆé˜Ÿåˆ— &lt;a href="#%e5%8f%af%e5%88%a0%e9%99%a4%e4%bc%98%e5%85%88%e9%98%9f%e5%88%97" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªè®¾è®¡ä¸€é¢—èµ›è‰‡å•Šã€‚&lt;/p>
&lt;p>å¯¹äº&lt;code>std::priority_queue&lt;/code>ä»¥åŠå¤§å¤šæ•°æ‰‹å†™çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆåˆç§°å †ï¼Œheapï¼‰ã€‚ä¸€èˆ¬åªæœ‰&lt;code>top()&lt;/code>, &lt;code>push()&lt;/code>, &lt;code>pop()&lt;/code>è¿™ä¸‰ä¸ªæ“ä½œæ¥å£ï¼Œå¦‚æœæƒ³å®ç°åˆ é™¤æ“ä½œï¼Œå¤§å¤šæ•°æƒ…å†µï¼ˆä¸ºäº†å·æ‡’ï¼‰ä¼šæŠŠ&lt;code>std::priority_queue&lt;/code>æ›¿æ¢ä¸º&lt;code>std::set&lt;/code>ã€‚&lt;code>std::set&lt;/code>çš„å†…éƒ¨å®ç°æ˜¯å¹³è¡¡æ ‘ï¼ˆç¡®åˆ‡çš„è¯´ï¼Œçº¢é»‘æ ‘ï¼‰ï¼Œå¯ä»¥å®ç°è·å¾—æœ€å¤§æœ€å°å€¼ï¼ŒæŸ¥æ‰¾æŸä¸ªå€¼ï¼Œä»¥åŠåˆ é™¤æŸä¸ªå€¼çš„æ“ä½œã€‚&lt;/p>
&lt;p>ä½†æ˜¯&lt;code>std::priority_queue&lt;/code>ï¼ˆæˆ–è€…ç”¨æ•°ç»„æˆ–vectorå®ç°çš„å †ï¼‰æ˜¯é¡ºåºå®¹å™¨(sequence containers)ï¼Œè€Œ&lt;code>std::set&lt;/code>æ˜¯å…³è”å®¹å™¨(associative containers)ã€‚ç›¸å¯¹æ¥è¯´ï¼Œç”±äºcacheçš„åŸå› ï¼Œé¡ºåºå®¹å™¨çš„æ€§èƒ½æ¯”å…³è”å®¹å™¨è¦å¥½ã€‚å½“ç„¶æˆ‘æ‰¯å¾—æœ‰ç‚¹è¿œäº†ã€‚å¯¹æ­¤æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»å‚è€ƒã€ŠEffective STLã€‹ä¸€ä¹¦ã€‚&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>å †æ˜¯å°æ ¹å †ï¼ŒæŒ‰è¶…æ—¶æ—¶é—´å¢åº&lt;/li>
&lt;li>å †ä¸­çš„å…ƒç´ æ˜¯socketæè¿°ç¬¦&lt;code>UThreadSocket_t&lt;/code>&lt;/li>
&lt;li>æ ¹æ®æè¿°ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤å †ä¸­çš„ä»»æ„å…ƒç´ &lt;/li>
&lt;/ul>
&lt;p>å¦‚æœæˆ‘ä»¬æœ‰æ¸…é†’çš„å¤´è„‘ï¼Œå°±ä¼šè®¤ä¸ºè¿™ä¸ªéœ€æ±‚æ˜¯ä¸å¥½å®ç°çš„ã€‚åˆ é™¤å †ä¸­å…ƒç´ å¹¶ä¸å¤æ‚ï¼Œåªéœ€è¦å°†å †ä¸­æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ä¸Šï¼Œç„¶åå†æ‰§è¡Œä¸€æ¬¡&lt;code>heap_down()&lt;/code>æ“ä½œå°±å¯ä»¥äº†ã€‚é—®é¢˜åœ¨äºæˆ‘ä»¬å¾ˆéš¾ç¡®å®šæŸä¸€ä¸ªå…ƒç´ çš„å…·ä½“ä½ç½®ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æƒ³ä¸€æƒ³ï¼Œå †ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚å¦‚æœæƒ³æ‰¾åˆ°æŸä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œé™¤äº†éå†ä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶å®ƒçš„æ–¹æ³•ã€‚&lt;/p>&lt;/blockquote>
&lt;p>è¿™é‡Œphxrpcä½¿ç”¨äº†ä¸€ç§ä¾µå…¥å¼çš„æ‰‹æ®µï¼Œå°†ä¸‹æ ‡å†™å…¥å †ä¸­å…ƒç´ ã€‚ç„¶åå †å¤–æŒæœ‰æŒ‡é’ˆã€‚ç„¶ååœ¨ç»´æŠ¤å †æ€§è´¨çš„æ—¶å€™ï¼ŒåŒæ­¥æ›´æ–°å †ä¸­å…ƒç´ ï¼Œä½¿å…¶ä¸­ä¿å­˜çš„ä¸‹æ ‡ä¸å…¶åœ¨å †ä¸­çš„ä¸‹æ ‡ä¸€è‡´ã€‚&lt;/p>
&lt;p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æŒ‡é’ˆæ‹¿åˆ°ç›¸åº”å…ƒç´ çš„ä¸‹æ ‡ï¼Œåˆ é™¤æ“ä½œä¹Ÿå˜å¾—ç®€å•äº†èµ·æ¥ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆä¾µå…¥å¼å †ä¸‹æ ‡æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿä¸€æ¥æˆ‘ä»¬å¯¹äºå…ƒç´ çš„æŸ¥æ‰¾åªèƒ½æ ¹æ®å®¹å™¨å¤–æŒæœ‰çš„æŒ‡é’ˆæ¥è¿›è¡Œï¼Œå¹¶ä¸èƒ½åƒ&lt;code>std::set&lt;/code>é‚£æ ·é€šè¿‡æ¯”è¾ƒå…³ç³»æ¥æŸ¥æ‰¾ã€‚äºŒæ¥ä¾µå…¥å¼ä¸‹æ ‡éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œå¯¹äºå°å‹å¯¹è±¡ä¼šé€ æˆå¯è§‚æ¯”ä¾‹çš„overheadã€‚åŒæ—¶å®¹å™¨å†…åªèƒ½æŒæœ‰å…ƒç´ æŒ‡é’ˆï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šä¼šå¸¦æ¥é¢å¤–çš„å¯»å€å¼€é”€ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œè¿™å¤§æ¦‚ä¹Ÿæ˜¯è®©å †æ”¯æŒåˆ é™¤çš„å”¯ä¸€æ–¹æ³•äº†ã€‚&lt;/p>
&lt;h2 id="å°å°åæ§½">å°å°åæ§½ &lt;a href="#%e5%b0%8f%e5%b0%8f%e5%90%90%e6%a7%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™æ®µä»£ç å†™çš„ï¼Œè²Œä¼¼è€¦åˆçš„å¤ªç´§äº†ä¸€ç‚¹ã€‚&lt;code>class Timer&lt;/code>å†…éƒ¨æä¾›çš„åŠŸèƒ½æœ‰&lt;/p>
&lt;ol>
&lt;li>å¾—åˆ°å½“å‰æ—¶é—´&lt;/li>
&lt;li>nanosleep&lt;/li>
&lt;li>å°è£…&lt;code>TimerObj&lt;/code>ç±»&lt;/li>
&lt;li>ç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨å †ï¼Œæä¾›&lt;code>top()&lt;/code>, &lt;code>push()&lt;/code>, &lt;code>pop()&lt;/code>, &lt;code>erase()&lt;/code>åŠŸèƒ½ï¼Œå¹¶ä¸”å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯ç¡¬ç¼–ç çš„&lt;/li>
&lt;/ol>
&lt;p>è‡³å°‘åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å¹¶ä¸ç¬¦åˆâ€œé«˜å†…èšï¼Œä½è€¦åˆâ€ä»£ç é£æ ¼ã€‚&lt;/p>
&lt;p>ä½ é—®æˆ‘ä¸ºå•¥ä¸ç»™æ”¹æ”¹ï¼Ÿ&lt;/p>
&lt;p>å› ä¸ºä»–ä»¬æ²¡å†™æµ‹è¯•å•Šï¼&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-9-29/12309965.jpg" alt="">&lt;/p>
&lt;h2 id="è¡¥å……">è¡¥å…… &lt;a href="#%e8%a1%a5%e5%85%85" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å…¶å®å¯¹äº&lt;code>class Timer&lt;/code>ï¼Œphxrpcæ˜¯æœ‰å†™æµ‹è¯•çš„(test_timer.cpp)ã€‚ä½†æ˜¯è¿™ä¸ªä»£ç å†™çš„å°±æ›´è¿·äº†ã€‚è¿™é‡Œå†åˆ†æä¸€ä¸‹ã€‚&lt;/p>
&lt;p>ä¸€å¼€å§‹ï¼Œå…ˆåˆ›å»º100ä¸ªtimerï¼Œsleepæ—¶é—´éšæœºã€‚ç„¶åå°†50ä¸ªtimeræ”¾å…¥&lt;code>need_remove&lt;/code>æ•°ç»„ä¸­ã€‚&lt;/p>
&lt;p>ä¹‹åæ¯åˆ ä¸€ä¸ªtimerï¼Œå°±é…å¥—ç¡åˆ°è¶…æ—¶æ—¶é—´popä¸€ä¸ªtimerã€‚å¼¹å‡ºè¶…æ—¶timeråï¼Œå†åˆ¤æ–­ä¸€ä¸‹æ—¶é—´è¯¯å·®æ˜¯å¦è¶…è¿‡10msï¼Œå¦‚æœæ˜¯ï¼Œå°±æŠ¥é”™ã€‚&lt;/p>
&lt;p>è¿™ã€‚ã€‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-9-29/43591449.jpg" alt="">&lt;/p></description></item><item><title>è‡ªå®šä¹‰ä½ çš„stream buffer - phxrpcé˜…è¯»ç¬”è®°(1)</title><link>https://wizmann.top/posts/phxrpc-1/</link><pubDate>Wed, 28 Sep 2016 22:35:55 +0000</pubDate><guid>https://wizmann.top/posts/phxrpc-1/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://github.com/tencent-wechat/phxrpc">phxrpc&lt;/a>æ˜¯å¾®ä¿¡å›¢é˜Ÿå¼€æºçš„ä¸€ä¸ªè½»é‡çº§RPCæ¡†æ¶ã€‚&lt;/p>
&lt;p>æˆ‘å¯¹RPCè¿™äº›ä¸œè¥¿äº†è§£ä¸å¤šï¼Œçœ‹åˆ°phxrpcçš„ä»£ç ç›¸å¯¹ç®€å•ï¼Œè€Œä¸”è¿˜åœ¨åˆæ­¥å¼€å‘é˜¶æ®µï¼ˆåœ¨æœ¬æ–‡å†™ä½œæ—¶ï¼Œç‰ˆæœ¬å·æ˜¯0.8ï¼‰ã€‚æ‰€ä»¥æƒ³è¯»ä¸€è¯»ï¼Œæé«˜ä¸€ä¸‹å§¿åŠ¿æ°´å¹³ã€‚&lt;/p>
&lt;p>å°±æ˜¯è¿™æ ·ã€‚&lt;/p>
&lt;h2 id="è‡ªå®šä¹‰stream-buffer">è‡ªå®šä¹‰stream buffer &lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89stream-buffer" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>network/socket_stream_base.[h|cpp]&lt;/code>ä¸­çš„&lt;code>class BaseTcpStreamBuf&lt;/code>ç»§æ‰¿äº†&lt;code>std::streambuf&lt;/code>ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªæµç¼“å†²åŒºï¼Œç”¨äºæ¥æ”¶/å‘é€TCPæ•°æ®åŒ…ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç”¨æ³•æ¯”è¾ƒæ–°é¢–ï¼ˆæˆ–è€…æ˜¯æˆ‘è§è¯†å°‘ï¼‰ï¼Œç½‘ä¸Šçš„èµ„æ–™ä¹Ÿä¸å¤šã€‚è¿™é‡Œç¿»è¯‘ä¸€ç¯‡&lt;a href="http://www.mr-edd.co.uk/blog/beginners_guide_streambuf">ä»‹ç»æ–‡ç« &lt;/a>ï¼Œå­¦ä¹ ä¸€ä¸‹æ–°å§¿åŠ¿ã€‚&lt;/p>
&lt;h2 id="a-beginners-guide-to-writing-a-custom-stream-buffer">A beginner&amp;rsquo;s guide to writing a custom stream buffer &lt;a href="#a-beginners-guide-to-writing-a-custom-stream-buffer" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æµ(streams)æ˜¯STLä¸­æä¾›çš„ä¸€ä¸ªé‡è¦çš„æŠ½è±¡æ¦‚å¿µã€‚è‘—åçš„â€œHello worldâ€ç¨‹åºï¼Œä¾¿æ˜¯ä½¿ç”¨äº†std::coutå°†å­—ç¬¦ä¸²å†™å…¥æ ‡å‡†è¾“å‡ºæµ(stdout)ã€‚&lt;/p>
&lt;p>æµå½“ç„¶å¯ä»¥åšæ¯”cin/coutæ›´æœ‰æ„æ€çš„äº‹ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šç ”ç©¶å¦‚ä½•æ‰©å±•C++æµï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„æµç¼“å†²åŒº(stream buffer)ã€‚p.s. å»ºè®®æœ¬æ–‡çš„è¯»è€…è‡³å°‘è¦æœ‰åŸºç¡€çš„C++çŸ¥è¯†ã€‚&lt;/p>
&lt;p>C++æ ‡å‡†åº“ä¸ºç£ç›˜æ–‡ä»¶æ“ä½œæä¾›äº†åŸºç¡€çš„æ¥å£ï¼Œå¦‚&lt;code>std::fstream&lt;/code>ï¼Œ&lt;code>std::ifstream&lt;/code>å’Œ&lt;code>std::ofstream&lt;/code>ã€‚æˆ‘ä»¬è¿˜æœ‰&lt;code>stringstream&lt;/code>ï¼Œå¯ä»¥åƒæµä¸€æ ·æ“ä½œå­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>ostringstream oss;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>oss &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Hello, world!&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">n&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>oss &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">123&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;#39;\\&lt;/span>n&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>string s &lt;span style="color:#f92672">=&lt;/span> oss.str();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›¸ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä»&lt;code>std::istringstream&lt;/code>ä¸­ä½¿ç”¨&lt;code>&amp;gt;&amp;gt;&lt;/code>æ“ä½œç¬¦è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>Booståº“ä¸­çš„&lt;code>lexical_cast&lt;/code>æ­£æ˜¯ä½¿ç”¨äº†è¿™ç§æœºåˆ¶ï¼Œè®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æ–¹å¼å°†ä¸€ä¸ªå¯¹è±¡(object)è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¡¨ç¤ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> boost&lt;span style="color:#f92672">::&lt;/span>lexical_cast;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>string;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string s &lt;span style="color:#f92672">=&lt;/span> lexical_cast&lt;span style="color:#f92672">&amp;lt;&lt;/span>string&lt;span style="color:#f92672">&amp;gt;&lt;/span>(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>assert(s &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;5&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµç¼“å†²åŒºæœ‰ç€å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒçš„â€œç¼“å†²å¹¶ä¼ è¾“å­—ç¬¦ï¼ˆä¸²ï¼‰â€éœ€æ±‚ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œã€å­—ç¬¦ä¸²æ“ä½œã€å‘½ä»¤è¡Œ(Console)æ“ä½œç­‰ã€‚æˆ‘ä»¬å¯ä»¥ä»ç½‘ç»œã€é—ªå­˜(Flash memory)ç­‰ä¸åŒè®¾å¤‡ï¼Œä½¿ç”¨åŒæ ·çš„æ¥å£è·å–æµå¼å­—ç¬¦ä¸²ã€‚â€œæµç¼“å†²åŒºâ€ä¸â€œæµâ€æ˜¯æ­£äº¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„äº¤æ¢ã€æ›´æ”¹(swap and change)æµæ‰€ä½¿ç”¨çš„ç¼“å†²åŒºï¼Œæˆ–è€…å°†å…¶é‡å®šå‘åˆ°å…¶å®ƒåœ°æ–¹ã€‚æˆ‘è®¤ä¸ºC++ä¸­çš„æµï¼Œæ­£æ˜¯â€œç­–ç•¥æ¨¡å¼â€(strategy design pattern)çš„ä¸€ä¸ªè‰¯å¥½èŒƒä¾‹ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é‡å®šå‘æ ‡å‡†æ—¥å¿—æµ&lt;code>std::clog&lt;/code>åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æµï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iomanip&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;sstream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>ostringstream oss;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Make clog use the buffer from oss
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>streambuf &lt;span style="color:#f92672">*&lt;/span>former_buff &lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>clog.rdbuf(oss.rdbuf());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>clog &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;This will appear in oss!&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>flush;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> oss.str() &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">&amp;#39;\\&lt;/span>n&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Give clog back its previous buffer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>clog.rdbuf(former_buff);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸è¿‡ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæµç¼“å†²åŒºå´æ˜¯æœ‰ä¸€ç‚¹trickyï¼Œæˆ–è€…è¯´æœ‰ä¸€ç‚¹å“äººï¼Œå°¤å…¶æ˜¯å½“ä½ ç¬¬ä¸€æ¬¡å°è¯•çš„æ—¶å€™ã€‚æ‰€ä»¥æœ¬æ–‡æ„åœ¨æä¾›ä¸€äº›æµç¼“å†²çš„å®ç°èŒƒä¾‹ã€‚&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æµç¼“å†²åŒºçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚æ‰€æœ‰çš„æµç¼“å†²åŒºç»§æ‰¿è‡ª&lt;code>std::streambuf&lt;/code>ï¼Œå¹¶ä¸”éœ€è¦è¦†ç›–ä¸€äº›è™šå‡½æ•°æ¥å®ç°è‡ªå®šä¹‰åŠŸèƒ½ã€‚&lt;code>std::streambuf&lt;/code>æ˜¯â€œé¡ºåºè¯»å–è®¾å¤‡â€çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå³æˆ‘ä»¬å¯ä»¥ä»ä¸­é¡ºåºçš„è¯»å–å­—ç¬¦åºåˆ—ã€‚åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¡«(re-fill)ã€å†²æ´—(flush)ä»¥åŠæ¸…ç©º(empty)ä¸€ä¸ªç¼“å†²åŒºã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬å‘ä¸€ä¸ª&lt;code>ostream&lt;/code>ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œæ•°æ®å°†ä¼šè¢«å†™å…¥ç¼“å†²åŒºä¸­çš„ä¸€ä¸ªæ•°ç»„ã€‚å½“æ•°ç»„ä¸Šæº¢(overflow)æ—¶ï¼Œæ•°ç»„ä¸­çš„æ•°æ®å°†ä¼šè¢«å†²æ´—(flush)åˆ°ç›®æ ‡æ¥å—è€…ï¼Œä¹‹åè¿™ä¸ªæ•°ç»„çš„çŠ¶æ€å°†ä¼šé‡ç½®ï¼Œä»¥ä¾¿å­˜å‚¨åç»­çš„å­—ç¬¦ã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬ä»ä¸€ä¸ª&lt;code>istream&lt;/code>ä¸­è·å–æ•°æ®æ—¶ï¼Œæ•°æ®ä»ç¼“å†²åŒºçš„æ•°ç»„ä¸­è¯»å‡ºã€‚å½“æ•°ç»„ä¸‹æº¢æ—¶(underflow)ï¼Œæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œæˆ‘ä»¬ä¼šä»æ•°æ®æºé‡æ–°æ‹‰å–ä¿¡æ¯æ¥å¡«å……ç¼“å†²åŒºï¼Œä¹‹åè¿™ä¸ªæ•°ç»„çš„çŠ¶æ€ä¹Ÿå°†è¢«é‡ç½®ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨6ä¸ªæŒ‡é’ˆï¼Œæ¥ç»´æŠ¤ç¼“å†²åŒºçš„å†…éƒ¨çŠ¶æ€ã€‚è¾“å…¥å’Œè¾“å‡ºç¼“å†²å„ä½¿ç”¨3ä¸ªæŒ‡é’ˆã€‚&lt;/p>
&lt;h3 id="ç»´æŠ¤è¾“å‡ºç¼“å†²åŒºçš„çŠ¶æ€">ç»´æŠ¤è¾“å‡ºç¼“å†²åŒºçš„çŠ¶æ€ &lt;a href="#%e7%bb%b4%e6%8a%a4%e8%be%93%e5%87%ba%e7%bc%93%e5%86%b2%e5%8c%ba%e7%9a%84%e7%8a%b6%e6%80%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>
&lt;p>put base pointer &lt;br>
è¾“å‡ºåŸºæŒ‡é’ˆï¼Œç”¨æ¥æŒ‡å®šç¼“å†²åŒºå†…éƒ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf::pbase()&lt;/code>æ¥è·å–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>put pointer &lt;br>
è¾“å‡ºæŒ‡é’ˆï¼Œç”¨æ¥æŒ‡å‘å†…éƒ¨æ•°ç»„ä¸‹ä¸€ä¸ªå†™å…¥çš„åœ°å€ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf::pptr()&lt;/code>æ¥è·å–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>end put pointer &lt;br>
è¾“å‡ºå“¨å…µæŒ‡é’ˆï¼ŒæŒ‡å‘å†…éƒ¨æ•°ç»„æœ€åä¸€ä¸ªå†åé¢ä¸€ä¸ª(one-past-the-last-element)çš„åœ°å€ï¼ˆè¯‘æ³¨ï¼šç±»ä¼¼&lt;code>std::vector::end()&lt;/code>ï¼‰ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf:epptr()&lt;/code>æ¥è·å–&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://i1.piimg.com/567571/630a89fe635e1635.png" alt="">&lt;/p>
&lt;p>ä¸€èˆ¬æ¥è¯´ï¼ŒåŸºæŒ‡é’ˆå’Œå“¨å…µæŒ‡é’ˆä¸ä¼šæ”¹å˜ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œä»¥è¾“å‡ºæŒ‡é’ˆç»´æŠ¤å†…éƒ¨çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="ç»´æŠ¤è¾“å…¥ç¼“å†²åŒºçš„çŠ¶æ€">ç»´æŠ¤è¾“å…¥ç¼“å†²åŒºçš„çŠ¶æ€ &lt;a href="#%e7%bb%b4%e6%8a%a4%e8%be%93%e5%85%a5%e7%bc%93%e5%86%b2%e5%8c%ba%e7%9a%84%e7%8a%b6%e6%80%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¾“å…¥ç¼“å†²åŒºå’ŒçŠ¶æ€ç»´æŠ¤å’Œè¾“å‡ºç¼“å†²åŒºç±»ä¼¼ï¼Œæˆ‘ä»¬æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>end back pointer &lt;br>
è¾“å…¥åŸºæŒ‡é’ˆï¼ŒæŒ‡å‘ç¼“å†²åŒºæ•°ç»„å†…çš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf::eback()&lt;/code>æ¥è·å–&lt;/li>
&lt;li>get pointer &lt;br>
è¾“å…¥æŒ‡é’ˆï¼ŒæŒ‡å‘ç¼“å†²åŒºä¸‹ä¸€ä¸ªè¯»å–çš„å­—ç¬¦åœ°å€ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf::gptr()&lt;/code>æ¥è·å–&lt;/li>
&lt;li>end get pointer &lt;br>
è¾“å…¥å“¨å…µæŒ‡é’ˆï¼Œæ‰¹å·å‘å†…éƒ¨æ•°ç»„æœ€åä¸€ä¸ªå†åé¢ä¸€ä¸ª(one-past-the-last-element)çš„åœ°å€ã€‚å¯ä»¥ä½¿ç”¨&lt;code>std::streambuf::egptr()&lt;/code>æ¥è·å–&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/16-9-27/33500590.jpg" alt="">&lt;/p>
&lt;p>åŒæ ·ï¼ŒåŸºæŒ‡é’ˆå’Œå“¨å…µæŒ‡é’ˆåœ¨æµç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¹Ÿä¸ä¼šæ”¹å˜ã€‚&lt;/p>
&lt;p>ç”±äºè¾“å…¥ç¼“å†²åŒºè¦æ”¯æŒ&lt;code>putback()&lt;/code>æ“ä½œï¼Œå³å°†è¯»å‡ºçš„å­—ç¬¦é‡æ–°æ”¾å›ç¼“å†²åŒºï¼Œæ‰€ä»¥è¾“å…¥ç¼“å†²åŒºæ¯”è¾“å‡ºç¼“å†²åŒºæ›´å¤æ‚ä¸€ç‚¹ã€‚é€šå¸¸æ¥è¯´ï¼Œ&lt;code>putback()&lt;/code>æ“ä½œæ”¯æŒæ”¾å›ä¸€ä¸ªå­—ç¬¦å³å¯ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª&lt;code>std::streambuf&lt;/code>å¯ä»¥åŒæ—¶æ”¯æŒè¾“å…¥è¾“å‡ºä¸¤ç§æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æˆ‘åˆ†åˆ«å®ç°&lt;code>std::istreambuf&lt;/code>å’Œ&lt;code>std::ostreambuf&lt;/code>ã€‚&lt;code>std::fstream&lt;/code>æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¾‹å­ã€‚ä½†æ˜¯ï¼Œå®ç°ä¸€ä¸ªå…¨åŠŸèƒ½çš„ç¼“å†²åŒºç›¸å¯¹æ›´å¤æ‚ä¸€äº›ï¼Œæ‰€ä»¥æˆ‘å°±ä¸è¶Ÿæµ‘æ°´å•¦~ ï¼šï¼‰&lt;/p>
&lt;p>åŒæ—¶ï¼Œæµç¼“å†²åŒºä¹Ÿå¯ä»¥æ”¯æŒå®½å­—ç¬¦(wide character)ã€‚&lt;code>std::streambuf&lt;/code>æ˜¯&lt;code>std::basic_streambuf&amp;lt;char&amp;gt;&lt;/code>çš„åˆ«åï¼Œå¦‚æœä½ éœ€è¦å®½å­—ç¬¦æµç¼“å†²åŒºï¼Œå¯ä»¥ä½¿ç”¨&lt;code>std::basic_streambuf&amp;lt;wchar_t&amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;h3 id="ä¾‹1æ–‡ä»¶ç¼“å†²åŒº--ä¸cä»£ç é›†æˆ">ä¾‹1ï¼šæ–‡ä»¶ç¼“å†²åŒº â€”â€” ä¸Cä»£ç é›†æˆ &lt;a href="#%e4%be%8b1%e6%96%87%e4%bb%b6%e7%bc%93%e5%86%b2%e5%8c%ba--%e4%b8%8ec%e4%bb%a3%e7%a0%81%e9%9b%86%e6%88%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‡è®¾æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸ªå†å²æ‚ ä¹…çš„åº“ï¼Œä¸€ä¸ªæ–‡ä»¶æ“ä½œå‡½æ•°ä¼šè¿”å›ç»™ä¸€ä¸ª&lt;code>FILE*&lt;/code>æŒ‡é’ˆï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³ç”¨C++çš„æµæ¥å£æ¥è¯»å†™æ•°æ®ã€‚æˆ‘ä»¬å…ˆä»è¯»æ–‡ä»¶å¼€å§‹ï¼Œç”¨&lt;code>std::istream&lt;/code>åŒ…è£…&lt;code>FILE*&lt;/code>çš„è¯»æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;streambuf&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FILE_buffer&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>streambuf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> FILE_buffer(FILE &lt;span style="color:#f92672">*&lt;/span>fptr, std&lt;span style="color:#f92672">::&lt;/span>size_t buff_sz &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>, std&lt;span style="color:#f92672">::&lt;/span>size_t put_back &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// overrides base class underflow()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> int_type underflow();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// copy ctor and assignment not implemented;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// copying not allowed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> FILE_buffer(&lt;span style="color:#66d9ef">const&lt;/span> FILE_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FILE_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> FILE_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FILE &lt;span style="color:#f92672">*&lt;/span>fptr_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>size_t put_back_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> buffer_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äºåŠŸèƒ½ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°æ„é€ å‡½æ•°ä»¥åŠ&lt;code>underflow&lt;/code>æ¥å£å°±å¯ä»¥å®ç°æˆ‘ä»¬çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>æ„é€ å‡½æ•°æŒ‡å®šäº†è¯»å–æ–‡ä»¶çš„&lt;code>FILE*&lt;/code>æŒ‡é’ˆï¼Œä»¥åŠå†…éƒ¨ç¼“å†²æ•°ç»„çš„å¤§å°ã€‚æ•°ç»„å¤§å°ç”±ä¸¤ä¸ªå‚æ•°å†³å®šï¼š&lt;/p>
&lt;ul>
&lt;li>put-back area size&lt;/li>
&lt;li>buffer size&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä½¿ç”¨&lt;code>std::vector&amp;lt;char&amp;gt;&lt;/code>åšä¸ºç¼“å†²åŒºåŸŸã€‚&lt;code>put_back_&lt;/code>å˜é‡ç”¨äºå­˜å‚¨&amp;quot;put-back&amp;quot;åŒºåŸŸçš„å¤§å°ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æ„é€ å‡½æ•°çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>size_t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>FILE_buffer&lt;span style="color:#f92672">::&lt;/span>FILE_buffer(FILE &lt;span style="color:#f92672">*&lt;/span>fptr, size_t buff_sz, size_t put_back) &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fptr_(fptr),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> put_back_(std&lt;span style="color:#f92672">::&lt;/span>max(put_back, size_t(&lt;span style="color:#ae81ff">1&lt;/span>))),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buffer_(std&lt;span style="color:#f92672">::&lt;/span>max(buff_sz, put_back_) &lt;span style="color:#f92672">+&lt;/span> put_back_)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>end &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>buffer_.front() &lt;span style="color:#f92672">+&lt;/span> buffer_.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setg(end, end, end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬å°†ç¼“å†²åŒºçš„å¸¸é‡è¿›è¡Œèµ‹å€¼ã€‚ä¹‹åä½¿ç”¨&lt;code>std::streambuf::setg()&lt;/code>æ¥åˆå§‹åŒ–è¾“å‡ºç¼“å†²åŒºã€‚&lt;/p>
&lt;p>&lt;code>setg()&lt;/code>çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨&lt;code>eback()&lt;/code>ï¼Œ&lt;code>gptr()&lt;/code>ï¼Œ&lt;code>egptr()&lt;/code>ä¸‰ä¸ªå†…éƒ¨æŒ‡é’ˆçš„å€¼ã€‚ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å°†å®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚è¡¨æ˜bufferæ˜¯ç©ºçš„ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¯»å–æ—¶ï¼Œä¼šé‡æ–°å¡«å……ç¼“å†²åŒºã€‚&lt;/p>
&lt;p>&lt;code>underflow()&lt;/code>ä¼šè¿”å›æ•°æ®æºä¸­å½“å‰çš„å­—ç¬¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¼šè¿”å›bufferä¸­çš„ä¸‹ä¸€ä¸ªå¯ç”¨å­—ç¬¦ã€‚ç„¶åå½“bufferä¸ºç©ºæ—¶ï¼Œ&lt;code>underflow()&lt;/code>åº”è¯¥é‡æ–°å¡«å……ç¼“å†²åŒºæ•°ç»„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå³ä»&lt;code>FILE*&lt;/code>ä¸­è¯»å–å­—ç¬¦ã€‚å½“ç¼“å†²åŒºé‡å¡«åï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡è°ƒç”¨&lt;code>setg()&lt;/code>æ›´æ–°æµç¼“å†²åŒºçš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>å½“æ•°æ®æºä¸­çš„æ•°æ®è¯»å®Œ(depleted)åï¼Œ&lt;code>underflow()&lt;/code>ä¼šè¿”å›ä¸€ä¸ª&lt;code>traits_type::eof()&lt;/code>ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œ&lt;code>underflow()&lt;/code>çš„è¿”å›å€¼æ˜¯&lt;code>int_type&lt;/code>ï¼Œè¿™ä¸ªå€¼è¶³å¤Ÿè£…ä¸‹&lt;code>eof()&lt;/code>ï¼ŒåŒæ—¶ä¹Ÿè¶³å¤Ÿè£…ä¸‹ä»»ä½•çš„å­—ç¬¦ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>streambuf&lt;span style="color:#f92672">::&lt;/span>int_type FILE_buffer&lt;span style="color:#f92672">::&lt;/span>underflow()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (gptr() &lt;span style="color:#f92672">&amp;lt;&lt;/span> egptr()) &lt;span style="color:#75715e">// buffer not exhausted
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>to_int_type(&lt;span style="color:#f92672">*&lt;/span>gptr());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>base &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>buffer_.front();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>start &lt;span style="color:#f92672">=&lt;/span> base;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (eback() &lt;span style="color:#f92672">==&lt;/span> base) &lt;span style="color:#75715e">// true when this isn&amp;#39;t the first fill
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Make arrangements for putback characters
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>memmove(base, egptr() &lt;span style="color:#f92672">-&lt;/span> put_back_, put_back_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> start &lt;span style="color:#f92672">+=&lt;/span> put_back_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// start is now the start of the buffer, proper.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// Read from fptr_ in to the provided buffer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> size_t n &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>fread(start, &lt;span style="color:#ae81ff">1&lt;/span>, buffer_.size() &lt;span style="color:#f92672">-&lt;/span> (start &lt;span style="color:#f92672">-&lt;/span> base), fptr_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (n &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Set buffer pointers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> setg(base, start, start &lt;span style="color:#f92672">+&lt;/span> n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>to_int_type(&lt;span style="color:#f92672">*&lt;/span>gptr());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‡½æ•°çš„ç¬¬ä¸€è¡Œï¼Œé¦–å…ˆåˆ¤æ–­bufferæ˜¯å¦è€—å°½ã€‚å¦‚æœå¦ï¼Œåˆ™è¿”å›å½“å‰å­—ç¬¦ï¼Œå³&lt;code>*gptr()&lt;/code>ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œé‡å¡«(re-fill)æ“ä½œã€‚&lt;/p>
&lt;p>å›æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­çš„å®ç°ï¼Œä¸‰ä¸ªçŠ¶æ€æŒ‡é’ˆå…¨éƒ½æŒ‡å‘ç¼“å†²åŒºçš„æœ«å°¾ã€‚å¦‚æœæˆ‘ä»¬è°ƒç”¨&lt;code>underflow()&lt;/code>æ—¶ï¼Œå‘ç°çŠ¶æ€æŒ‡é’ˆå¹¶éå¦‚æ­¤ï¼Œåˆ™è¯´æ˜ç¼“å†²åŒºå·²ç»è¢«å¡«å……äº†è‡³å°‘ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘é‡å¡«æ“ä½œï¼Œæˆ‘ä»¬&lt;code>memmove&lt;/code>æœ€å&lt;code>put_back_&lt;/code>ä¸ªå­—ç¬¦åˆ°bufferçš„æœ«å°¾ï¼Œç”¨åš&amp;quot;put-back area&amp;quot;ã€‚ï¼ˆæˆ‘ä»¬ä¸ç”¨&lt;code>memcopy&lt;/code>å› ä¸ºæˆ‘ä»¬çš„bufferæ¯”è¾ƒå°ï¼Œ`memmove()çš„æ•ˆç‡ä¼šæ›´é«˜ä¸€äº›ï¼‰&lt;/p>
&lt;blockquote>
&lt;p>è¯‘æ³¨ï¼šå®é™…ä¸Šï¼Œ&lt;code>memcopy&lt;/code>ä¸&lt;code>memmove&lt;/code>å„æœ‰æ‰€é•¿ã€‚&lt;code>memcopy&lt;/code>ä¸éœ€è¦åˆ¤æ–­å†…å­˜overlapçš„æƒ…å†µï¼Œå³å¦‚æœæºåŒºé—´ä¸ç›®æ ‡åŒºé—´æœ‰é‡å ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¼šæ˜¯é”™çš„ã€‚è€Œ&lt;code>memmove&lt;/code>ç”±äºæ˜¯ç§»åŠ¨è¯­ä¹‰ï¼Œæ‰€ä»¥åœ¨ç§»åŠ¨æ­¥é•¿è¾ƒå°æ—¶ï¼Œå¯ä»¥åªæ“ä½œcacheã€‚æ‰€ä»¥äºŒè€…å„æœ‰æ‰€é•¿ï¼Œè¦æ ¹æ®å…·ä½“æƒ…å†µåˆ¤æ–­ä¼˜åŠ£ã€‚Stackoverflowä¸Šæœ‰æ›´è¯¦ç»†çš„&lt;a href="http://stackoverflow.com/questions/28623895/why-is-memmove-faster-than-memcpy">è®¨è®º&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬å¤„ç†å®Œ&amp;quot;put-back area&amp;quot;ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨&lt;code>fread()&lt;/code>å‡½æ•°æ¥é‡å¡«ç¼“å†²åŒºäº†ã€‚å¦‚æœè¯»ä¸åˆ°æ•°æ®ï¼Œåˆ™æ„å‘³ç€æ–‡ä»¶å·²ç»è¯»åˆ°äº†ç»“å°¾ï¼ˆå½“ç„¶è¿™æ˜¯ä¸€ç§ç®€åŒ–æƒ…å†µï¼Œä½†åœ¨ç°å®ä¸­99.9%çš„è¯»å–å¤±è´¥éƒ½æ˜¯å› ä¸ºæ–‡ä»¶ç»“æŸï¼‰ã€‚&lt;/p>
&lt;p>åœ¨&lt;code>fread()&lt;/code>æˆåŠŸè¯»å–æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬é€šçŸ¥streambufæ›´æ–°å†…éƒ¨çš„ä¸‰ä¸ªçŠ¶æ€æŒ‡é’ˆã€‚ä¹‹åè¿”å›bufferå½“å‰çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;p>è¿™å°±æ˜¯æˆ‘ä»¬çš„æµç¼“å†²åŒºçš„åŸºæœ¬å®ç°ï¼Œå¸Œæœ›è¿™å¹¶ä¸æ˜¯å¤ªéš¾ã€‚å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚ç‰¹åˆ«çš„æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ç¼“å†²åŒºé‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœä½ æƒ³å®ç°å®ƒçš„è¯ï¼Œå¯ä»¥è¯•è¯•é‡å†™&lt;code>std::streambuf::seekoff()&lt;/code>å’Œ&lt;code>std::streambuf::seekpos&lt;/code>è™šæˆå‘˜å‡½æ•°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°å†™ç¼“å†²åŒºã€‚ä¸è¿‡ï¼Œåœ¨ä½ ä»¬è¯»å®Œç¬¬ä¸‰ä¸ªä¾‹å­ä¹‹åï¼Œä½ ä»¬å°±å¯ä»¥è½»æ¾æ„‰å¿«çš„å®ç°è‡ªå·±çš„ç‰ˆæœ¬äº†ï¼Œä¸éª—ä½ ã€‚&lt;/p>
&lt;h3 id="ä¾‹2è¯»å–å†…å­˜ä¸­çš„æ•°ç»„">ä¾‹2ï¼šè¯»å–å†…å­˜ä¸­çš„æ•°ç»„ &lt;a href="#%e4%be%8b2%e8%af%bb%e5%8f%96%e5%86%85%e5%ad%98%e4%b8%ad%e7%9a%84%e6%95%b0%e7%bb%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨&lt;code>std::istream&lt;/code>åŒ…è£…å†…å­˜ä¸­çš„ä¸€ä¸ªåªè¯»æ•°ç»„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–çš„è¿›è¡Œè¯»å…¥ã€‚è¿™ä¸ªä¾‹å­å’Œä¸Šä¸€ä¸ªä¾‹å­æœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸€ä¸ªçœŸæ­£çš„ç¼“å†²æ•°ç»„ï¼Œä»æºæ•°ç»„ä¸€æ¬¡æ€§è¯»å–å°±å¥½äº†ã€‚&lt;/p>
&lt;p>æƒ³è±¡ä¸­çš„å®ç°æ˜¯è¿™ä¸ªæ ·å¼å„¿çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">char_array_buffer&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>streambuf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> char_array_buffer(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>begin, &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>end)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setg(begin, begin, end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int_type &lt;span style="color:#a6e22e">underflow&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> gptr() &lt;span style="color:#f92672">==&lt;/span> egptr() &lt;span style="color:#f92672">?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof() &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> traits_type&lt;span style="color:#f92672">::&lt;/span>to_int_type(&lt;span style="color:#f92672">*&lt;/span>gptr());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚å› ä¸º&lt;code>setg()&lt;/code>å‡½æ•°åªæ¥å—éå¸¸é‡(non-const)æŒ‡é’ˆå‚æ•°ã€‚è¿™æ˜¾è€Œæ˜“è§ï¼Œå¦‚æœä¸€ä¸ªç¼“å†²åŒºä¸å¯å†™ï¼Œæˆ‘ä»¬å°±ä¸èƒ½æä¾›&amp;quot;put-back&amp;quot;åŠŸèƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åŠ¨ä¸€åŠ¨æ‰‹è„šï¼Œé‡æ–°å®ç°ä¸€ä¸‹è¿™ä¸ªç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;streambuf&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">char_array_buffer&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>streambuf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> char_array_buffer(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>begin, &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> &lt;span style="color:#a6e22e">char_array_buffer&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int_type underflow();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int_type &lt;span style="color:#a6e22e">uflow&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int_type &lt;span style="color:#a6e22e">pbackfail&lt;/span>(int_type ch);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>streamsize showmanyc();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// copy ctor and assignment not implemented;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// copying not allowed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> char_array_buffer(&lt;span style="color:#66d9ef">const&lt;/span> char_array_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> char_array_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> char_array_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> begin_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> end_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span> current_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é‡å†™äº†å‡ ä¸ªç§æœ‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°éƒ½æ˜¯ä»&lt;code>std::streambuf&lt;/code>ç»§æ‰¿è€Œæ¥ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°éœ€è¦ç”¨æˆ·æŒ‡å®šèµ·æ­¢æŒ‡é’ˆï¼Œè€Œç¬¬äºŒä¸ªæ„é€ å‡½æ•°åªéœ€è¦æŒ‡å®šèµ·å§‹æŒ‡é’ˆï¼Œä¹‹åæˆ‘ä»¬ä¼šè°ƒç”¨&lt;code>std::strlen()&lt;/code>æ¥åˆ¤æ–­å­—ç¬¦ä¸²çš„å¤§å°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨&lt;code>uflow()&lt;/code>, &lt;code>pbackfail()&lt;/code>å’Œ&lt;code>showmanyc()&lt;/code>æ¥ç»´æŠ¤ç¼“å†²åŒºå†…éƒ¨çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯è°ƒç”¨&lt;code>setg()&lt;/code>ï¼Œå› ä¸ºbufferå¹¶ä¸å¯å†™ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¦æ‰‹åŠ¨ç»´æŠ¤&lt;code>eback&lt;/code>, &lt;code>gptr&lt;/code>, &lt;code>egptr&lt;/code>ä¸‰ä¸ªæŒ‡é’ˆã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œèµ‹å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;#34;char_array_buffer.hpp&amp;#34;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;functional&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cassert&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>char_array_buffer&lt;span style="color:#f92672">::&lt;/span>char_array_buffer(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>begin, &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>end) &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> begin_(begin),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> end_(end),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> current_(begin_)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(std&lt;span style="color:#f92672">::&lt;/span>less_equal&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&amp;gt;&lt;/span>()(begin_, end_));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>char_array_buffer&lt;span style="color:#f92672">::&lt;/span>char_array_buffer(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>str) &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> begin_(str),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> end_(begin_ &lt;span style="color:#f92672">+&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>strlen(str)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> current_(begin_)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨&lt;code>underflow()&lt;/code>æ¥è·å–å½“å‰å­—ç¬¦ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬éœ€è¦ä½¿ç”¨&lt;code>uflow()&lt;/code>ã€‚å› ä¸º&lt;code>uflow()&lt;/code>éœ€è¦åŒæ—¶æ‰§è¡Œä¸¤æ­¥æ“ä½œï¼Œä¸€æ˜¯è·å–å½“å‰å­—ç¬¦ï¼ŒäºŒæ˜¯è®©&lt;code>gptr()&lt;/code>å‰è¿›ä¸€æ­¥ã€‚ä½†æ˜¯åˆå› ä¸ºç¼“å†²åŒºç”±æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†ï¼Œ&lt;code>std::streambuf&lt;/code>å¹¶ä¸èƒ½æ­£ç¡®çš„æ‰§è¡Œç®¡ç†æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡å†™&lt;code>uflow()&lt;/code>è€Œä¸æ˜¯&lt;code>underflow()&lt;/code>ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>char_array_buffer::int_type char_array_buffer::uflow()
{
if (current_ == end_)
return traits_type::eof();
return traits_type::to_int_type(*current_++);
}
&lt;/code>&lt;/pre>&lt;p>ä¸‹ä¸€æ­¥æˆ‘ä»¬è¿˜è¦å®ç°&lt;code>pbackfail()&lt;/code>ã€‚å½“æˆ‘ä»¬è°ƒç”¨&lt;code>std::istream::unget()&lt;/code>æˆ–&lt;code>std::istream::putback(ch)&lt;/code>æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå·²ç»è¯»å‡ºçš„æ•°æ®å†™å›æ•°ç»„ä¸­ã€‚ä½†æ˜¯ç”±äºæ•°ç»„æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ¨¡æ‹Ÿè¿™ç§æ“ä½œã€‚&lt;/p>
&lt;p>åœ¨é»˜è®¤çš„å®ç°ä¸­&lt;code>pbackfail()&lt;/code>åªä¼šè¿”å›&lt;code>traits_type::eof()&lt;/code>ï¼Œè€Œåœ¨æˆ‘ä»¬çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœå†™å›æˆåŠŸï¼Œå°†ä¼šè¿”å›å†™å›çš„å­—ç¬¦ï¼Œä¸æˆåŠŸè¿”å›eofã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>char_array_buffer&lt;span style="color:#f92672">::&lt;/span>int_type char_array_buffer&lt;span style="color:#f92672">::&lt;/span>pbackfail(int_type ch)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (current_ &lt;span style="color:#f92672">==&lt;/span> begin_ &lt;span style="color:#f92672">||&lt;/span> (ch &lt;span style="color:#f92672">!=&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ch &lt;span style="color:#f92672">!=&lt;/span> current_[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>to_int_type(&lt;span style="color:#f92672">*--&lt;/span>current_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;code>FILE_buffer&lt;/code>ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘é‡å†™&lt;code>pbackfail()&lt;/code>ï¼Œæ¥æä¾›åå‘æŸ¥æ‰¾ä»¥åŠï¼ˆç”¨å‰é¢çš„æ•°æ®ï¼‰é‡å¡«bufferçš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>æœ€åä¸€ä¸ªé‡å†™çš„å‡½æ•°æ˜¯&lt;code>showmanyc()&lt;/code>ï¼Œè¿™ä¸ªå‡½æ•°è¢«&lt;code>std::streambuf::in_avail()&lt;/code>è°ƒç”¨ï¼Œä»¥åˆ¤æ–­å½“å‰æœ‰å¤šå°‘ä¸ªå­—ç¬¦å¯ä»¥è¿”å›ã€‚ç”±äºæˆ‘ä»¬æ¥ç®¡äº†çŠ¶æ€æŒ‡é’ˆï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¹Ÿè¦æˆ‘ä»¬è‡ªå·±æ¥å®ç°å•Šã€‚ï¼ˆè¯‘è€…ï¼šä¸ºä»€ä¹ˆè¦ç»™è‡ªå·±æ‰¾éº»çƒ¦ã€‚ã€‚ã€‚ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>streamsize char_array_buffer&lt;span style="color:#f92672">::&lt;/span>showmanyc()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(std&lt;span style="color:#f92672">::&lt;/span>less_equal&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&amp;gt;&lt;/span>()(current_, end_));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> end_ &lt;span style="color:#f92672">-&lt;/span> current_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±æ­¤å¯è§ï¼Œæœ¬ä¾‹ä¸­çš„bufferæ¯”å‰é¢çš„è¦å¤æ‚ä¸€ç‚¹ç‚¹ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ¥ç®¡äº†çŠ¶æ€ç»´æŠ¤çš„å·¥ä½œã€‚è¿™ä½¿å¾—æˆ‘ä»¬æ›´å¥½çš„ç†è§£äº†&lt;code>std::streambuf&lt;/code>å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p>
&lt;h3 id="ä¾‹3å¥é¦–å˜å¤§å†™çš„ç¼“å†²åŒº">ä¾‹3ï¼šå¥é¦–å˜å¤§å†™çš„ç¼“å†²åŒº &lt;a href="#%e4%be%8b3%e5%8f%a5%e9%a6%96%e5%8f%98%e5%a4%a7%e5%86%99%e7%9a%84%e7%bc%93%e5%86%b2%e5%8c%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†è¦å®ç°ä¸€ä¸ªå°†å¥é¦–å­—ç¬¦å˜å¤§å†™çš„bufferã€‚å½“ç„¶æˆ‘ä»¬åªè€ƒè™‘æœ€åŸºæœ¬çš„æƒ…å†µï¼Œç§»æ¤åˆ°ä¸åŒçš„åŒºåŸŸå’Œè¯­è¨€ï¼Œå…¶å®æ˜¯å¾ˆçç¢çš„äº‹æƒ…ã€‚ï¼ˆè¯‘è€…ï¼šæ–‡å­—ç¼–ç å‘çš„äº²å¦ˆéƒ½ä¸è®¤äº†ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;streambuf&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iosfwd&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">caps_buffer&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>streambuf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> caps_buffer(std&lt;span style="color:#f92672">::&lt;/span>ostream &lt;span style="color:#f92672">&amp;amp;&lt;/span>sink, std&lt;span style="color:#f92672">::&lt;/span>size_t buff_sz &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">protected&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> do_caps_and_flush();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int_type overflow(int_type ch);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">sync&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// copy ctor and assignment not implemented;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// copying not allowed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> caps_buffer(&lt;span style="color:#66d9ef">const&lt;/span> caps_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> caps_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> caps_buffer &lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> cap_next_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>ostream &lt;span style="color:#f92672">&amp;amp;&lt;/span>sink_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> buffer_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡å†™&lt;code>overflow()&lt;/code>å’Œ&lt;code>sync()&lt;/code>å‡½æ•°ã€‚&lt;code>overflow()&lt;/code>åœ¨è¾“å…¥ç¼“å†²åŒºæ»¡çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨æˆåŠŸæ—¶è¿”å›ä»»æ„éeofçš„å€¼ã€‚&lt;/p>
&lt;p>&lt;code>sync()&lt;/code>çš„ä½œç”¨æ˜¯æŠŠå½“å‰çš„bufferå†™å…¥ç›®æ ‡ï¼Œå³ä½¿å½“å‰bufferå¹¶æœªå¡«æ»¡ã€‚&lt;code>std::flush()&lt;/code>ä¼šè°ƒç”¨&lt;code>sync()&lt;/code>å‡½æ•°ï¼Œå½“å¤±è´¥æ—¶è¿”å›-1ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè¾…åŠ©å‡½æ•°&lt;code>do_caps_and_flush()&lt;/code>ï¼Œç”¨æ¥å°†å°å†™å˜å¤§å†™ï¼Œå¹¶å†™å…¥&lt;code>sink_&lt;/code>è¾“å‡ºæµã€‚æˆ‘ä»¬å†å£°æ˜ä¸€ä¸ªå“¨å…µå˜é‡&lt;code>cap_next_&lt;/code>æ¥æ ‡è¯†ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦éœ€è¦å°å†™å˜å¤§å†™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;#34;caps_buffer.hpp&amp;#34;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cctype&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;ostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;functional&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cassert&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>caps_buffer&lt;span style="color:#f92672">::&lt;/span>caps_buffer(std&lt;span style="color:#f92672">::&lt;/span>ostream &lt;span style="color:#f92672">&amp;amp;&lt;/span>sink, std&lt;span style="color:#f92672">::&lt;/span>size_t buff_sz) &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cap_next_(true),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sink_(sink),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buffer_(buff_sz &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sink_.clear();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>base &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>buffer_.front();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setp(base, base &lt;span style="color:#f92672">+&lt;/span> buffer_.size() &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>); &lt;span style="color:#75715e">// -1 to make overflow() easier
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>buffer_&lt;/code>çš„æœ€å°å¯èƒ½å¤§å°æ˜¯1ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿåªéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºè¿™é‡Œä¸éœ€è¦åƒè¾“å…¥ç¼“å†²åŒºä¸€æ ·çš„ç»´æŠ¤&amp;quot;put-back area&amp;quot;ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æŠŠ&lt;code>buffer_&lt;/code>çš„å¤§å°è®¾æˆ&lt;code>buff_sz + 1&lt;/code>ï¼Œè¿™æ ·æ˜¯ä¸ºäº†&lt;code>overflow()&lt;/code>è¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé¢å¤–çš„ç©ºé—´å­˜å‚¨å½“å‰çš„å­—ç¬¦ã€‚æœ€åå°†ç¼“å†²åŒºæ•°ç»„å’Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸€èµ·åˆ·æ–°åˆ°&lt;code>ostream&lt;/code>ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>caps_buffer&lt;span style="color:#f92672">::&lt;/span>int_type caps_buffer&lt;span style="color:#f92672">::&lt;/span>overflow(int_type ch)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (sink_ &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ch &lt;span style="color:#f92672">!=&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(std&lt;span style="color:#f92672">::&lt;/span>less_equal&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&amp;gt;&lt;/span>()(pptr(), epptr()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>pptr() &lt;span style="color:#f92672">=&lt;/span> ch;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pbump(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (do_caps_and_flush())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ch;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> traits_type&lt;span style="color:#f92672">::&lt;/span>eof();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸€æ­¥æ˜¯æŠŠchå†™å…¥&lt;code>buffer_&lt;/code>ï¼Œå¹¶ä¸”ä½¿ç”¨&lt;code>pbump(1)&lt;/code>å°†&lt;code>pptr()&lt;/code>å‘å‰ç§»ä¸€ä½ã€‚ä¹‹åè°ƒç”¨&lt;code>do_caps_and_flush()&lt;/code>åšä¸€äº›è„æ´»ï¼Œä¹‹åè¿”å›ä¸€ä¸ªå­—ç¬¦å£°æ˜è°ƒç”¨æˆåŠŸã€‚&lt;/p>
&lt;p>&lt;code>sync()&lt;/code>çš„å®ç°ä¹Ÿéå¸¸ç®€å•:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> caps_buffer&lt;span style="color:#f92672">::&lt;/span>sync()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">do_caps_and_flush&lt;/span>() &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å†çœ‹ä¸€çœ‹&lt;code>do_caps_and_flush()&lt;/code>å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> caps_buffer&lt;span style="color:#f92672">::&lt;/span>do_caps_and_flush()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">=&lt;/span> pbase(), &lt;span style="color:#f92672">*&lt;/span>e &lt;span style="color:#f92672">=&lt;/span> pptr(); p &lt;span style="color:#f92672">!=&lt;/span> e; &lt;span style="color:#f92672">++&lt;/span>p)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cap_next_ &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#a6e22e">if&lt;/span> (std&lt;span style="color:#f92672">::&lt;/span>isalpha(&lt;span style="color:#f92672">*&lt;/span>p))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cap_next_)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>toupper(&lt;span style="color:#f92672">*&lt;/span>p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cap_next_ &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>ptrdiff_t n &lt;span style="color:#f92672">=&lt;/span> pptr() &lt;span style="color:#f92672">-&lt;/span> pbase();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pbump(&lt;span style="color:#f92672">-&lt;/span>n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sink_.write(pbase(), n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºæœ¬ä¾‹æ¥è¯´ï¼Œå†…éƒ¨çš„ç¼“å†²åŒºå¹¶éå¿…è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦æŠŠæ•°æ®å‘åˆ°&lt;code>sink&lt;/code>ä¸­ã€‚ä½†æ˜¯æˆ‘çš„è§‚ç‚¹æ˜¯ä¸€ä¸ªå†…éƒ¨bufferä»æœ‰å…¶ç”¨å¤„ã€‚&lt;/p>
&lt;h3 id="ä»‹ç»-boost-iostreams-åº“">ä»‹ç» Boost IOStreams åº“ &lt;a href="#%e4%bb%8b%e7%bb%8d-boost-iostreams-%e5%ba%93" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœä½ æ˜¯æµç¼“å†²åŒºçš„æ–°æ‰‹ï¼Œå¸Œæœ›ä½ å·²ç»å¯¹å®ƒæœ‰ä¸€ç‚¹ç‚¹äº†è§£äº†ã€‚æœ¬æ–‡ä¸­çš„ä¾‹å­éƒ½éå¸¸åŸºç¡€ï¼Œä½†æ˜¯ä½ å¯ä»¥ç”¨å®ƒä»¬åšæ›´å¤šæœ‰æ„æ€çš„äº‹æƒ…ã€‚ä½†æ˜¯å½“æˆ‘å®ç°æ›´å¤æ‚çš„æµç¼“å†²åŒºæ—¶ï¼Œé—®é¢˜çš„å¤æ‚åº¦å´ä¸Šå‡çš„å¾ˆå¿«ã€‚è¿™æ—¶æˆ‘å‘ç°äº†&lt;code>Boost IOStreams&lt;/code>åº“ï¼Œå®ƒä¸ºæ›´å¤æ‚çš„ç¼“å†²åŒºå’Œæµæä¾›äº†å¿…è¦çš„æ¡†æ¶æ”¯æŒã€‚&lt;/p>
&lt;p>å®ƒå…è®¸ä½ è§£è€¦æ•°æ®æºï¼Œæ•°æ®è¾“å‡ºï¼Œè¿‡æ»¤å™¨ä»¥åŠå…¶å®ƒä¸€äº›æ¦‚å¿µã€‚åœ¨æˆ‘ä»¬çš„æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç¡¬ç¼–ç æ•°æ®è¾“å‡ºåˆ°&lt;code>std::ostream&lt;/code>ä¸­ã€‚å¦‚æœæˆ‘ä»¬è¦è¾“å‡ºåˆ°ä¸€ä¸ªæ²¡æœ‰æµæ¥å£çš„ç±»å‘¢ï¼Ÿ&lt;code>Boost IOStreams&lt;/code>åº“æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå°†ä¸€å¨ç´§è€¦åˆçš„ä»£ç åˆ†è§£æˆç‹¬ç«‹çš„æŠ½è±¡æ¦‚å¿µã€‚&lt;/p>
&lt;h3 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯» &lt;a href="#%e6%89%a9%e5%b1%95%e9%98%85%e8%af%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>The C++ Standard Library by Nicolai M. Josuttis&lt;/li>
&lt;li>The C++ Standard, BS ISO/IEC 14882:2003 (Second Edition)&lt;/li>
&lt;li>&lt;a href="http://www.dinkumware.com/manuals/">Dinkum Compleat Reference online&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Code Golf - Heapify</title><link>https://wizmann.top/posts/code-golf-heapify/</link><pubDate>Sat, 01 Aug 2015 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/code-golf-heapify/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">heapify&lt;/span>(vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> vec) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> vec.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; b &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; a &lt;span style="color:#f92672">=&lt;/span> b, b &lt;span style="color:#f92672">&amp;lt;&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nth_element(vec.begin() &lt;span style="color:#f92672">+&lt;/span> a, vec.begin() &lt;span style="color:#f92672">+&lt;/span> b, vec.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can implement a &amp;ldquo;heapify&amp;rdquo; by only four lines of code. And the time complexity is &lt;code>O(n)&lt;/code>.&lt;/p></description></item><item><title>Using Set Cover to Optimize a Large-Scale Low Latency Distributed Graph</title><link>https://wizmann.top/posts/using-set-cover-algorithm-to-optimize-a-large-scale-low-latency-distributed-graph/</link><pubDate>Sun, 26 Jul 2015 22:48:33 +0000</pubDate><guid>https://wizmann.top/posts/using-set-cover-algorithm-to-optimize-a-large-scale-low-latency-distributed-graph/</guid><description>&lt;h2 id="background">Background &lt;a href="#background" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Linkedin (or other social networks, such as Facebook and G+) use the &amp;ldquo;social graph information&amp;rdquo; to show the social relationship between you and other members.&lt;/p>
&lt;p>Such as, &amp;ldquo;You and Mr.Obama share 10 mutual friends&amp;rdquo; or &amp;ldquo;You have 1,000 second-degree connections&amp;rdquo;.&lt;/p>
&lt;p>This feature is very common for a social network. But where does it come from?&lt;/p>
&lt;h2 id="basic-api-for-social-graph-information">Basic API for Social Graph Information &lt;a href="#basic-api-for-social-graph-information" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The information about a social relationship can be get from three basic APIs.&lt;/p>
&lt;ul>
&lt;li>Get Connections
&amp;ldquo;Who does member X know?&amp;rdquo;&lt;/li>
&lt;li>Get Shared Connections
&amp;ldquo;Who do I know in common with member Y?&amp;rdquo;&lt;/li>
&lt;li>Get Graph Distance
&amp;ldquo;What the graph distance between member Z and me?&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;h2 id="main-components-for-the-system">Main Components for the System &lt;a href="#main-components-for-the-system" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/15-7-25/59618247.jpg" alt="">&lt;/p>
&lt;ul>
&lt;li>Graph Database (Graph DB)&lt;/li>
&lt;li>Distributed Network Cache (NCS)&lt;/li>
&lt;li>Graph APIs&lt;/li>
&lt;/ul>
&lt;h2 id="basic-algorithm-for-social-graph">Basic Algorithm for Social Graph &lt;a href="#basic-algorithm-for-social-graph" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Because the problems of social graph share the same essence. Here we just talk about the &amp;ldquo;Graph Distance&amp;rdquo; problem.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/15-7-25/24130302.jpg" alt="">&lt;/p>
&lt;p>The &lt;em>Graph DB&lt;/em> stores all the relationship of the members. When we ask for the information of &lt;em>second degree creation&lt;/em>,&lt;/p>
&lt;ul>
&lt;li>Firstly, the web server communicate with GraphDB to get all the 1st degree connections&lt;/li>
&lt;li>Secondly, web server communicate to GraphDB again to get all the 2nd degree connections&lt;/li>
&lt;li>At last, the web server will merge all the results from the GraphDB to make it sorted and unique.&lt;/li>
&lt;/ul>
&lt;p>To make the retrieval more effectively, we add a cache level called &lt;em>NCS&lt;/em> to cache the result we get from the GraphDB.&lt;/p>
&lt;h2 id="the-disadvantages-of-the-basic-algorithm">The Disadvantages of the Basic Algorithm &lt;a href="#the-disadvantages-of-the-basic-algorithm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>As we know, for a distributed system, there are shards, replica and load balancer to handle large amount of data and queries.&lt;/p>
&lt;p>Consider this scenario.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/15-7-25/4544395.jpg" alt="">&lt;/p>
&lt;p>Two queries are both ask for the data from shard 1 and shard 2.&lt;/p>
&lt;p>The first query (the green one) has to communicate with the database twice, and then do the merging to get the final results.&lt;/p>
&lt;p>And the second query (the red one) only has to talk to database once. And no de-duplicate is needed, because there&amp;rsquo;s definitely no duplicate data in one single node of the database.&lt;/p>
&lt;p>We can make a conclusion that if we have a &lt;strong>wise&lt;/strong> load balancer, we can optimize our retrieval logic remarkably.&lt;/p>
&lt;h2 id="set-cover-problem">Set Cover Problem &lt;a href="#set-cover-problem" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Given a set of elements {1,2,&amp;hellip;,m} (called the universe) and a set S of n sets whose union equals the universe, the set cover problem is to identify the smallest subset of S whose union equals the universe. (Wikipedia)&lt;/p>&lt;/blockquote>
&lt;p>This problem is similar to ours. The optimal algorithm for a load balancer is to find the minimal subsets of all sets which union equals to the ones that asked by the query input.&lt;/p>
&lt;p>It seems that we find the key to our problem. But this is NP-complete. There is no effective way to find the optimal solution.&lt;/p>
&lt;p>However, in practice, a greedy algorithm will actually do the trick. The rule of the greedy algorithm is to find the set which contains largest number uncovered elements.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/15-7-26/80102455.jpg" alt="">&lt;/p>
&lt;h2 id="conclusion">Conclusion &lt;a href="#conclusion" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>We finally find out that the social information and the relationship graph is &lt;strong>not that difficult&lt;/strong>. The basic concepts are quite easy. And the main work for the whole system is to use the cache to reduce the amount of calculation on the fly.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/15-7-26/65691084.jpg" alt="">&lt;/p>
&lt;h2 id="reference">Reference &lt;a href="#reference" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>This post is mainly based on this &lt;a href="https://www.usenix.org/conference/hotcloud13/workshop-program/presentations/wang">video&lt;/a>.&lt;/p>
&lt;p>&lt;a href="https://www.usenix.org/sites/default/files/conference/protected-files/wang_hotcloud13_slides.pdf">Slides&lt;/a>&lt;/p>
&lt;p>Special thanks to Linkedin for the sharing. :)&lt;/p></description></item><item><title>Workflowy full notes</title><link>https://wizmann.top/posts/workflowy-full-notes/</link><pubDate>Fri, 22 May 2015 09:51:47 +0000</pubDate><guid>https://wizmann.top/posts/workflowy-full-notes/</guid><description>&lt;p>Recently, I&amp;rsquo;m becoming a crazy fan of &lt;a href="workflwoy.com">workflowy&lt;/a> because its ability to build a personal wiki concisely.&lt;/p>
&lt;p>However, there&amp;rsquo;s only one thing bothers me that workflowy hide all the notes as the screenshot below, and it annoys me a lot.&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXsAAAA+CAYAAADK3LtgAAAgAElEQVR4Ae2dD1BUV5b/PzEmTTKZZjIundGhDcY2xGk1DkoMxDiwI0pFDRk1+FMWS/nhjiRUicuvhMVSSjdSurWUpIIhKxbZSGGU0TGM7obEHXGdCGMCvY7Q44y0OtKME7onE7snCf0S4/3V7dd/HtAY4r8wyXtV3e++++4959zvve/cc8+97z7E1/Do/VCIRzuEuDxY2T4TYsF7Qhz4RIh/ahMi7Q9C9AbSHrYL8U+ecMbej4T450tCvHdeiMV/DsQrQpz2CnH6AyFmtQlxwCPE6Y/CNN5XwvllqOaUEP/wYd+4XiUg3+dCbLcJ8YhNiLRTQsyyCTH6tBB7OoRIOy/Ee5+o+Xo/75v/9HkhRr+n5pH5gr8Z7wkx42LftOIzIf5vmxD//ZkQ4nMhauxCPHpKiH/+oxDbO4RY/H6/9J8L8U82IWouCbH9z0LUnBZilobmxYtCxNkD5f1ciH+2CbHHp9L+vcRF85N10OsR4tHTEepDUfP259/7gRCPnBaiv1j9pBzy5VfaHj4TYvEpIU7L+tOGtdL7hEizqWnecwgx+qQQaWeE2OMRQtb79lNCbP9IiN9/KMT7gXYg2+Mmef8jIf7BJsR3TwrxDw4hfuUTQrYNWV+9GrpadgPCnwgx65QQv+/XxvzptPUr5T8pxKM2IWbYhIg7qbapAfX7uRDPvSfEd9uEeC8Szf4CaNrnxUtCPGIX4vLnQlRJHm1CzGjr+0wKTbkkb9nmD8tnTuY5LcSMsxHamobn7y/2bc+aW/6gbO//7BVCtvO0P2ruSr4BnIJ1Iu/+9xkh0i6p6S57hEh7T4hNHwhx2as+d/I5DukibRvQhjVstOXzR8vnUeoZWUafEM/ZhHjufSEWyLj3hZhxWoj/ls+f5tCW8XCHEAtcQozkm3ZchVfPQivQ/jtYOgrKTKBcAUbAjx+BHwO+qxA1AqK+BWXfgvYLGqDuhsl3AwoY7oAJ98HkEeH7D8h7X3BE3Q1RwTQjYM3DsPoe8Hkh5aJ6Y8IomH4PcAXy22HFZJipqbFJY+DtMUEi6vlsF6zqG4VPino1EDkCVv4Apv8JsrvACUy7G94xwkzJK3h8Duvfh9X3wYufQa3kI2mMgPaPINoQTKg5j4CHv625DgQlln2OK/COG/71j+AbBT97QL3ruQLRI6HjQzDcC9F9Mt2ii9vQHhQfzG0FCZl3JGwMFiWAp+djcI0E0wiINsP58Zq2ocHu4e8EMl6FVi94RkHUXfB/HoTK70B0oA2eDdK/2eeR8LPHBhIdUL/A9Hthr08t88AcA2Nk+/QpsP5PMOEuePYsRAtY+hCsuVfFQ7bj0DMj27QC+Q6Y8CDMCzxzq+Oh9TTk/gl+NrofnwDeCOCOfvciXBoMoFyCx3vCNw339JVBPpv/8REsfFBNE30vlI2BZzvhRWDS30H19/u25S/THsKcwfNXmHMBxpqhchRk/hFMo6AeyGyHLiuslDpEljNQRt+n8B+98JP7QKM6tGS/vmHfR/Afn8EvpoLxQ/iXS/Ds++CNUOSf/gDK+iuvK5DbDq2f+3U9rs/haZtamRO+H6GBRaAbMeoKVLTDvytgjoFJd8GLDpgaUNTRRpgsa6sXnraH+Y/r7ktNEapc41ywMh423g2Zv4ETd8E6qQwUyLZDTxSstsCK+6H1fXjRCRMeBr/eHQEbJ8KKz6HwHJRPVDuZ1nMw98/AnbDlwX6Nvq8YoaseNzx+HsZ+L/zgv/57ePEOtYNbagwkvQov2uEV+UTfBZXWodEPMbrOwC1vDw/AUyaoHAdjgdbLMDaglLt64EddattbMSGAfX9DYQRMvgeyO1TMZDFlHZvug9r71M533ncDhf8Unj0NJwJtc6Js1yLc0UyOhV98Dza3w6tKX8BkupRAh+S/Iw2QiVCgNQD6ZvFf9fTA43/oW7/SIJAd14qH+hpBEbL72+PTgfb5E9m2vgf1Y6DrA/h3N7RegLmyPCNg3URVmQXpdL4PLqnsYoIxwN1Q/hA864Ku0SrmwbtnnZDRAy4BP7EEYwc/P/AA/E/AEAmmks+AfN49d8IuA/h6oeceeKIX5pxRjafp34ayeJj0ObzuhuWnofNzeGIs/OLLtocgY8DfkUyE6d9SDUD/rREw9gE49h1QpDXxKWSfgqOyjBOAzyD6flh4D9whLX8NvW9EsL+F8FUX2idHFSNvj3L7qss6HPkPt/YwHDH6sjKd/SuM/fY3q017roZHV18Wr9uR/hup7G8HsDoPHQEdAR2B4YSAxtM8nMTSZdER0BHQEdARuJkI6Mr+ZqKp09IR0BHQERimCOjKfphWjC6WjoCOgI7AzURAV/Y3E02dlo6AjoCOwDBFQFf2w7RidLF0BHQEdARuJgK6sr+ZaOq0dAR0BHQEhikCurIfphWji6UjoCOgI3AzEdCV/c1EU6elI6AjoCMwTBEY9sre4+ygrcNzw/D5nB10uG6YzLAm4HM0Ur2vw78Xzu0X1IfL6fqKeN/+0t4wR08Hb1S/gUO+vvsVHD6XE9dXxPsrKG4Eltr26sPzDQBj+Cl7n4N9RStZNv9JHh03hokzFpBX1oDD1ciiMWMYM+D3CHnNfVutx+XCpf05O6gvWMCCgn04tPH+sKevgnLtY/64NKrlDmGAp3ER456sxBFsLj4XHU37qK7cxxf1QZ62LSxatJGm29XJeJqpLi6mPij7G/Mj4KVi+Ehec99y+zqoXLaS3aGCBgrsa2Pj/EVs6eiLcRCO0NnVSMGsNIoDdeHaN59xj23kWtl8jn0UbWzE5Wuj6LEn2eLw4NhdwMZGCZiLfYseY9m+wcHztRXw6KN5+Fn6mlg2LlL7CMQ9EkgXEvgWBJzVpI2bzzVE1jB181Z5MVuOBQwZZzVPDmjbAdkf29IPRx/NRYvIe6M/Nh6a8tJYNqASNWz9QSe1WbOYXx6obEclT45LY3eg3fRP7b/2dVBdUEmzx0PTskeYv8+Jp62Sgi3NyBI4KtN4LK/JH46cv4lF4x4LtCMX++Zfo67GBNNFpHQdkR4aF43jyeBDLSl4WiiaNYu8Jg+ufVlMTStW21Ek6r5m8h59cuAz4MdtPm84mtmyLI9918IvEt3bHDf8lH1UDGazGWt6KhbDeJ4/foF39yzHIjf5MYyn5O0znD9/Xv2dOUR2bL/tF33NFMyYytSpmt+MORS3KCjH1jJLGy/Ds/IIPm+DYu9uorxgJfOffJQxD01l8cZ6bC4v3e7BFaBU9FmLd9DSUkt5tfpADEr/JtzweVx4zRlkxNqo3t2Gy+XBkF7HqZM1ZBiNzH35OKdOneLUqeO8nNQPM8nfbaOhxY0huDFZQCbPsUrqnSaSzdr9BgcK7GzYQUtMJrkJg6Xz0bG7iC2ani8q1gy2BmzuIDM7+5oMJCeYwOfgmB0s1n4CDWQdjpHt5dAZzpzp+zu1P5v+zSSc6SsI+Ty4FAuZ6QaOVTbQ4fLgicnm8KnjbE8yEJNdx0l/XZ3k7U3WgQL6HDQ12fHJ3fG0h6uR8kYPloRYbeyAsK+jmmqHlfzlg+8GJhV5UXVbWHlHmTErjTTYAzuoKR5a6tuISbUSjYeOJifRCZYvsVOpAevW4wPq6sypOuYaI7TPAaW4sQhXUzUtxnRWJUVjyigknUYqv1ARDMLTaCHZ1EZpUSP9u99Bcnwl0Tdt18uuri56e3u55557GDtW7u93vUc0yfmbSZbW3u6mAUQM0dFEhfSJwb9t7MBEMWTvP8m2aaGEA5L0j/B1bGTB4nqcihevArZZj1Aem0lVoZoyJiGDzOz1WK0WTFHgaVrJ/AInMfs305eND8cbxax8rh4l42XezvVSlrWYNMdWaiqWM+mW7NvrpD5rFsW2wIO4YwFTdyTx8pkDPBMTg9yqFVMsJik4RnV7Yn+ktHAcNNuceO31OAxGvLYmmgwGzEnJWKIc1G45hnnVEZIMHWxZVAqb6lg/qR+unibKKh0klNTR/1YQZ+e+PLKKHWQcKlGj5IhhcYF/1NO0qJnubjeGnAJiDNCQVYRxEzR7u3EvmEp98NmPSafuSAXTvI2snF9Ai1utq6xZHrbuCWzsbDCo5Q0yludgWbVxNxr2dbAlbQ47zg0ktHbqGNZqo2MzOXS8ItBOfHSUz2dOKGMxc6aWMnf/GV5NjsVkkOLGEGMyqdv5GtU2rrZ5Dx3NNtyuJhq7DUxyHqOpyYDRksQ0M7SVl2NPKKRmkkJz0WIqrVXsWW7WSuIfMTWW1eNNryKj/61AStkZ5CwuRyk5Eni+PDQXLGZjmwfa5tPQ7cVry2KjVMrNOURvW0WbzYvdlsYj5QEiBgvZdftZP8nN7kXzKbPLulJoWTyL7qo9pPirRdZVsHI1YkaI0ty9CUEHDTuO4XXD4ofkBsGBI2ci/h3DDQlsOn6YVWb5eLThcDlwKV6w22jDgnVSoG4MBn8dKZhI3VRDjd2L0+nD9AWGUZDd7T7fFGX/8ssv85vf/CYk+6OPPspzzz0Xuv5yAek/86JIpSsbhPQtGo2BRqfgdDhwBLdn9XX7FfNg9D1Ny5iadUzu6hv50DyEUZZVbK/LQHE3UpDTQHJVFZmxJszdBWC0kp6eilU2QsWFy+2kofIY51zZfTsbTwf7SvNYW99NwvN1VK0y4yGWPcdNFGXlMWdWA89XVFCYau6zL3dk4WSsB0ebA4N1GtduP2aWH77Acj8hH20b08iyZ5IsO5ZBBh/B58nn3EdZUT2ObjcKRiqL8nC7Yyg5foSM5iLKlUzqsi1ERfnIsLpYsHYXS47kE7YJfbSVF9HgTaEu3RShKD4c+/JYtNZGwsuH2Twt0NtFWcmv2MNyn5N9a7PY0R1LxrYqMo1gNJlQ9i3Dm7CJ/ZsSMCh2ynNKUfJzsfr7GQsZ+YVMs9dTVguZqzKRA4AG5Rw75jzEjghSYMyIFNsvbqh4y43VLeTvOc4SbeNy7mZlTgtL6qroA4XBSGyof4xi0vpfcWm9ytrTlMesAljuL9gXVZadXaVFNDm7cWPAW15Eo9uNdfsp9lurKag3kHsoA6mKDOkW7HkF7Es/wBJNtXiaSik+ZiDjUFJEK9zTUUnO4jKcmXUcXmUJtNNoEgqr2JPvw1GdQ04tjM+uoCLVgMFkItpZSbVxLtur8rEYFGylWVSac1luUY0La3Y+hd12qssaMGeuIsNiwIOCbe0MHurTKwarI1bTvoJx/c9DrCvnbhbNL8PmVlBaZvFIdQqbCqHcDjGZNdTlW4jydVCeVYyvpI71/vZpIMbfEXqwbckj71hAzxTn0JxQyIGKBJxtduwtjTgVG8UzxrDW3w5iSNl6OEIH21/2r+ha83GT6wpevHhR/OM//uOAn4y/rqPnoFgYN1qMHq39xYulBw+KFYnxIj6+/2+mWNca/M6U/CzSCbEifooa19slOjs7RWd7u2htbQ+Ej4qdKxLF6NFxYt4LreEvyASF7dkr5sXNFju71Ije9g1iZh9ZVLniExeKDW/2BHJdFu0HN4h58aPF6Ph5YsObMnOvaN2QKOLmvSb8pHq7xJvr5om40aPFlIUbxN7WYN4g4wjn3laxJnGmeKFdU74IybRRl09sEDPj54mdnYFYSWNKvFh9IkijVxxdGCemrGsNfZ1LiE7x0sw4MW9vjxBdr4nZcfPEzjc3iNmj48TCF/aKg3tfEztf2CDWLJ3px21pqNxCXG7dIBIlPvGrRYiFEKJn7zwRN2W1eGmDLPMUsWJvl4ZfUOIecXTDTCGxnB0/U2zYu07MTFwjjva0ixcSA/LIpJffFAvjZooXgmUKFW2NmDIlwLf3qFgar2LV29srei+/6b9+qbNX+K+DLK91vg68+5Dr2unHTsI4pKPnTbF6imzbwQy94ujSOJG4oT2EVc9rs0XczJdEuOi9on1doohfcVRc7pU4xYulew+KNYmjxZQVL4mDB/eK1156QaxbvdBfL1PWnAi3cT8/2X4T+7apzpfEzNEzxbqX1vjb+sw1b4qgRNpydB1cLRLjZ4ulsq28tFesTpwpNrT3iBOr40Xc0qMBPl1i52xN3QUJ9B4VC+OCfHvE3nkyTZdaN71d4rVAHn9dBZtqMG+k81DrqrdHdLaeEC/NjhOJ6w6K1hMHxbpE9RlOfKFTxbm3XaxLnCLWaPWIhqfUAYmjp4g1gQbe27pBLF24Qqxes0JMGR0vVuxtFZ09QxFaQ/QrCN6wZf/JJ59E7KYGi4+YWBtpeoYDF54BxxYem7ULy/bj7FkSGG8+84w25ReHo8xYLOBpLmBZjp3k7ARcDbUcc1vJrjnApvRrWdgenNKqnraZX10qwedR/CMEOeyMCvuR/DI4q7OYU+rAmrmdtzctCblqpq1ahSWtnmbXcpaYzKRvO8ypzN2UFpeyNsuN6WQVqTfRreNz7CYvZxdR+cdJ78hj2e5MqkoMKIrWtaGWI/wpEcDZTEO3hcxkEz6XDZfRjNnnxmM04mncRa05FrPFgjVjPTXWcvK21ONIz8fiaqQ4ZxeKNRZDhMkpxd1AWa2V3LojbE7VmJd+1Fy8kZfGc23JvLwnm5ZlRRishWxOLaK5cQf13XKOxY5niQmDowkHZlZpP1LRv/b9lpWC4nXj9RrA6/F/ycjjcuOV7gavF0Vaof3zXde1j7aiBf7JPW12RXHjVhSK0x6jPDh0CiQwr9rDgVXh8RCeNipz8mi0bOX4pEZWLvOSX5Ptl9lgigqN/NSBg8Zd6XNQ3+TGWmIlWrFj9xqxmLzYFSPY97HLa8ZstmBNymbzXDMb15bTWJLMEpOT3Xl5NBisGMOeeI3456gtc5NUcoia/GkDcHLsXsT8UheZdXtIrUyjPCaZksJjlB1roLLRixLThNOXSrTioNlpwGzuN5+g4RQMKl4Pbq8BgyLtfPnlKZesJvk9L7yY/O7SYNrrPkeZsEwzYDGCwTKNackxRG9+GUvlc5TuSGPiLklZ8ePOgok0GMCYsJUjB5YQbLHulhbkWKq+oJiMIxWkTtvMngNy1NxMXpMNg9mM0WujsclOm82JZdVmlmiq+rplv8kZb1jZ33vvvRFFGiw+YuIIkY7GRrpR6F67iCLzEQpdOcx4riWiS8aQUsepPamBBhqoOBTVHSRpWwqp2lROwdpazsVksP1QCakmA16XCy/GgC9bFcLndeNR7FTOn0gpc3m5wkRZVi39PggFjOf5t4/4/dfm7BqOpxsw4sbrduAITjj6kthal0S014Ej+Cms6FQ2HcqkxAumm6N5/IK7mraQk7MD6bY3NGwkx+nAWrWVaKUJl2IkNTrkR/B//k3rKnU11+OIzSDVDO5GO15zLgnPLOHdSH2rz8qh5cbQMNuQvJW6zBayCoKV6KK5upSiUhsYU9h+pIYlEX1QJlKfr+BtcxImWxlvpW+mcJIJ07YqjEWzqI2NRWmspMmVxKSWZtyxS7BEwEtxt1G24DEMmfng7WbX4hn4n9+AOC2LZ6huHUMs2fuPf6l5nGCJBp6jsKzaRIXGM6Q4qskrfsufVHFD8vZtZJrDGt9gDk+a+pxvULrsOWqlv99YS8FKB67UOqxRXmq9EB2jUZTyG3ZRYTp0H6PJnUC+7JidcpWYheUJy9n8G9WJ11fWVCwWL7EBrWUwZfDytnRq04IfRvThbNpFUVEZ54ghs+YIFX38T2FqlvQSqpItJBmaKDXlU5JuxhxdxVbphjKMJ6a7nh0thWw3NmJTLGzyu3DC+YPANBYvoCEmm+WKgr10DjNKNWmK5zC1WF4bsJYc4Uj+rdCYUVjSU3FUG4jNruNAocXvJiybX4BScZhN0ldrMIYUvfz2VGO93T/XZY1upKDgDeoKTThsNmwtTTS73bgXT6XeGEtCwjSs1iSG0M9pCn37gjes7OVk7JQpUzh9+nRIanl9Q5O0vjaqq+WTEEtGZjRN1S0UVtVw8pRq5yi2ItIKoOLINhLkc2DQWGyKtFwNGLyN5MxYS4uaJSQb7gbWzmkIX8fm8vbxzVi6d1NcUEm9Tap1I0mrqjicm0qMvYCy2Gz2HyhUVwTJnIqNovkbwx2PtB5iOtiYtoBd5/ozDLNSQ+MpOf4rBm3HniaWzcjiWLBzkJlCfuhYMg8dp6LvjDC+tiLSshqwPL+V7IZSmrBjN6RSkhCNz3EMh8FMfsgqDoxQQtajD6fNhaI4cMr5kQYHsenTMPnaKJi1gPoBvZzayU2Sgy1TOhVV4Guz+a0jKaqnuYyCSifT5sZwzm7BGhPuZPogIVdNZeX4y6nIj4lSS2OthD6BrYePc7LEQeX8OZSVN5DRfI7Y9BRC6lJaxQXFVL9lx8t4rLkVFCY7yCmzsvX4EfxzknIp5tSNpB75lX+irQ9v7cV14C2zR1uSSQ7qIk8bG4uOYZw7F+NbdqwpCg21dnL35w+csPY0kpf2HLakEjZZqilzKNjPxZBdYSXK00KT04hFmqGBww+NnHQOXHucdtyKF4fTRXdLE25LPgnRcjnkVLKO9W97BhK2HufwJJnZzJKqCvA1IWH2H65Gigp2oyQnYez2kmAN2rLBBMGzi30FORS3eP0ffpVc6hvkTKyRlJrjnDwJttJZLC6rJMXaiNtSyLQQKRdNGwvYWH+McxhISHierfkWGhYZSKo5xYF02YPLpZgzqM09xeFnIvToQTGus66C2QecjSZ1ItznUufwjTF9DD+Z3tdWSbXLSqzBR1JJPkqTl2NlO2g0WEmYlk6Gw0aDdT8nK6x0715LudfKoDAOEOA2R9ws15H00Z85c0Zct69eI0jnztkifuZqsXCK9MH2iJ7Ap9lVf16v6Dm6WsTHrxZHe1R/rCarENL/GDdbvNbf6djbKtZNiRcrQo5l6aceLaRP0+9t63pNLF24Wrywc50/f8hn37pGJCauE0e7ekRPT+DX+aZYMSVRbPgSvvTeztf8cxFTVkf2h4bL0Ct6urpEl/wF+Kw72qled/WIyxFdg5dFZ9dlIXo7xQsz48WKo51i79J4EbfwNfHmmikibuFejQ9W9anOfi0wKeFn3CPeXJMo4uITRdzogG+894RYPSVRrDna9YXl7m3V+M4DBfH77BM3iGtBdLmnUxxcPUXEL90rOnt6RPvOeSIucYMIuk4vy3r2z5fMFi+FndbSiS9a3zwqThxcHfLZ+/2qcq5h52oxe+ZMMXPmFP+8T3yiDM8Us5fu1Pi9w2jLuZUvj7cmf2+72LkwXsTN2ynaOwM++85W8cLsOBG/cGfE8l/ulPMXvaJ1zRSRuOGEaJXljl8tDu5dIeLjV4ijgfYuZWuX8z4L3wz73UWv6Ny7QkyJmyIS4+LEPH89XhZvLowTM19oFV3BNtrT6feLzw425KDIfXzngcjgM6NtEsH0gXPv5R7R/tpCET9ljXizq0d0ybkhObcVrJeuvYG5tjixsN+kRc+JN8XRVnk/4LOXbSs+Xqx47QWxdLasn0S1nqeodTVz9moRmsboI8f11pWKT+KanWLnSwdFl5DX0m8fJ+Li5E/14Qevp4Sely7x2rx4MfuF18QKvy4a+PB1+edUXhBH5XzG6ESx7kSo8vpIPhwubtiyD/ZNN2TJB4nIsxwOl7lIryqBjR0QZVLdHa59LJi6FjmgCh5ZU6WFbiRj/ymqklUL0uNopttg8fvogukinX1t1ezuTqBwT7LqHzUvZ8+B5eDaR0uZtFTDh9JdS9aMkD0UuBFLbjhJOORz0tToxJKeHF5B43yDtYuKsUlf4PZ0zRAxnC0cisJkDsxR+FxEGwwYY2IxR3SFBHNFY/FnCfiPDLEsqdqPyWajOkchqUrD0+fB6ZErXsLWI5hI31pFdvMCdhkySQ2NAsAYo7F2jMaQLznI+Uud5XLaxeWYt9aQL9doOqopa/Bi3WQlRmkir9xJelVdaClrdEIGSYYG3opNISVk1kuO0UxLT8XXJutftWYVhx230UKM0oYjKp2qTakES+i1l1NQ7cQnF7sMGGhcD95qqX3ORkqX5VAb9Tz7969ikrdavWGcxvr9NXjnZzEnzc72V7eyROPWiPZXVnDljRHrqhrqzHZs5Tn+dyOSNMat1+3FYAquRpPko7AsqaDi2AyyGmLISJCVpWIQZTJhNgVNaoO6xFaV6Dr+fTTlLWB3Sg2vLjETpdgoL2vBkJqJxehFLt8ku47s4OjGnEyGFVpsVjKSgzKobE3J6Zh8TVQGpXDbcSgxpBi9NDhNrKoo9K+m8t/22ijNa8Ddf5Div3kddeVpY1/lLnbZFLpbqmnK3YzqfZPvM9RwID/gxllUhG/TATZPk26cGPUZ9XlQLNlsXWVhl2aFZrAY8mxOz8ZaXEzWc0b/SpwSv6tBm2L4hIffS1WWdEq2VrEpRdvApctgCUcuXeLSpUucP5RJTEwG+8/L69+FFL1cqtiyrwWscwNL9AYHOmraNt69cFgd8g+ezH/HMD6Xt/28VP6Xzu8nQ6MQtdl93Y1UFi9mxkOPsWzjPpqbqlmW9hyNlk0cqluO5pnXZrv54WgzSn05x2Lz2Zyi0R6KG4fbiFkuaA8dPjp2FbOrO5YEYwM5eftwRnzYQhmuL6B4cdrtIdrRCflUbM1AKZ/DxBlrsSVtY1NwxtrnYHdeAW8ZrIzv3kFOadM1Xljx4fC/gZWC301unEZScjLJgV9KgjnkBrk+wfvnkvMSeaTNyKHRvIm3D61Xl7lqk0Wnsu3wIUrMjaydNZX5Rdd649qE2VNNuSOBwsKA8eGnJddtK8RYA+u6A/Slq6yoQWF8AuzKKcb/wrGW900Je3E55fxToCGYUlhfVUJyRzGzJs6i1JnOtpJpgb7TR1tlHqW2GKyxNkpzttB8jR1OPPYmHIZJ+PsEgwlrSriuklPkBPJNPNx2Gm2QsnU/J8+/y57NYcPHYDQTazZjjo1FzuFHy4UI8tr/PorsVyexqmI90yIKJOc7qsnLKsVvGlrz2bw8FlveDNIq+7+GfhPLcwOkbpplfwMy9MtqJlWuvubt6NAAABA2SURBVPG19Y33+UJLxr1edRJW8Ybj/CtkXI1UH4OE7cnh1QQ+J80tTgwGdZK0r82hYeFz4XC48LntuOQkp+aW4nXSIieMg1ahz+FXWJH0vVyvf+B3mXS8UU5Z2VoWy9lC6fOvWTXQf6vhETEYNY2Kd38V8da1I704qvPIazRRcijX38H4nE00tikotkpasLA91Ot4aKvOIavMRUbNEaqS7BTML2O3vQQUdcJTrlBQDwW32xh5RBNMEjwbQHE7sNk6iDJF4fO56D6m8s4M8lYUZF16FCPWFCuut3KYv3ITVestNBblsMOWwKZDdWQq5cxfkEWaayt1VcuZFOWirdmBYnfixYxBcVDf7MUiV5EooLQUkfbkllAdKt5zuA0Rx2FBadXzUPF2NVNb7WDS1kNsXT5w5UqIaPQ08vecJGl3McXVNrwsCd0KBxS8bVvIWWsjaXtgvsEj35B14PE2UWkzMKkkPKzxNG8hK6sWQ+5+Dm8207hyEdUNDrJRsJel8WhlqLLwuhUs6WFO1wwpLlqa20iQ68x9HryOBnbZtbwVfB4PHgViElIwO+rJSoOtVflE1+aRU+tk7vYjVKU6KJ6fxeL5bl7es5VnzHKxlw2n0oxLMUCUF9s+GyRUYDU0I+fQ8mZ1+JWtXz7FyznFxBeKPdS6siznVTliH3AodO+YxUO75GqgwAq1BQ/R4F+5ICfzj7C539xYkISsg5y8HbS4YfzcEuq2W2jIymHZSidWm0LMkkiaIZj7qzsPQ2UfCQwn1QtmUKr14QCqG0dO0KZQd2YPSV4FU0Im2X2W+blo2LhYXfkQM5eXg4qmPxv54k5WFg3SE2LNxT86DqZxt7B7hzs8LFY82L2QELw/4BzNpGc2s+eZ/MDKlFqysswcijRhNyDvTYhw2djdoJBZU6e6SyRJVxNlz+2i2xBLSkkN/nkxGe+xUVuvkBlaHmmi4lep6rIyQwwZm2p43r9XhfQW2CnLCr4ieW05TZMySDKWUrz4WCihIWY8Sbnb1OWmnibyZuTQZs2kcP9JlkyTk8lvULZbwdtYTq0zne1HtgfcH+s5vF8hq6iFbu9yJuGisTSLHXaFmLmrkB4sy7RMktJjMDSAwbqKbfJlrABnxV5OXsDDEhLmRgKmZ6iKuFQpEtFopi2v4kgkfSOTK26adh3DKF/CCy4xxkl9aQ4NbgPjM7ZSEnBR+leGVDdiLDxEXWB55JJX32UJHhob5eqSKmoyg4rGS8vaLAbxPvQVNDaJ9IRKdqxdQGjpgiEGa0ohz/u3v3DxxqIZrHUlkVtyhJpnLETJFwjL6zF072ZLg4/smiNsS5c1YabicA0sKqfFqfCM2YCzvoDFcqZ/fLbqIrSkkiknhaWyNyaRv61QfWHRj4ccGYSk6CvnTb3SuHEi0DUOtrBAOhGtqaRmmslfkklqQJ8kHdjO2pXFNJpy2a8dSUeg/VVF3SEnDr4q5t8UvnI3ytoOC9nyIfmmFHoI5ZQ+9H6vLIRyRXSvh+7qgduOwDUq6xq3bruYOsPBEdCV/eDY6Hd0BHQEdAS+NggMvwnarw20ekF0BHQEdASGDwK6sh8+daFLoiOgI6AjcMsQ0JX9LYNWJ6wjoCOgIzB8EBi2yv5sF/yoSwVKG+YqnP0LvPKnQXfv9b9j8p/a7QaGD966JN8wBFq74NWPb7zQPR/DOzeBzo1LolP4W0Vg2Cr7/oC6PJBrh4mtsPyPIPuBiO9tKGq65Q5459P+VK59fdYNr18eJM1VqPhfeDq4ydkgyb5U9Mcw57fX6LS+FLEhJv4Cnr6/wBgbtF8dIr0hJvP1wquXoOsm0x0i+2snU+BHJ+HpHmi/AKNa4Z0rahbPBzD1XRin+Y06CaM01/Je9geRWZhGwmYHnL1WuXvh6d9CD9B6DnL/otLyeeHp/4XHbZD9Bzj4AfRcgcJWGPMujDkZNogic9djdQTCCAy7dfa+v8LTv4eOz9WXwMd9AGXfAcOd8JNYKL8PokeoD+XBj2H1t8KF8Xgh9yx4YuCtuyC3A9ZYYGXEN+DC+WTol52wWW7wNKFvfOhqBCy1wFP3hGJuOOBTwHmbF75+Ec8oI7w1ASbcZDMg6h74sRey7VA+EaYPo5bn+Qg674T6UdD6PkyIgZkB+aJHwalRfav6Ffmdnodhdf+2cBVescO23r7pvQKSWuXGHuFDflHw14+ouze80w0e2a4/hfwPYWlgtwyuQJcBfv0DzS4PV8FzJ9ROBfMfIT9MUg/pCFwTgZv8SF+T15BuRn0b3p4Ox0bDpNFw4YfwhHwb83PovAyvdsPmc+pDMeGuAMmr8MuL8PgZMJmhPAp6RsFbcfD6WXj6HJwNWGqRhOj6ExR+CrXj4YEICdrPqZbdD34L/+/Dvgn+sx2e7oLn7fAjG0z9bV8r7pfnYGqr+nvcHh5t9LhhYie4PoKHpJX2LlRohumvt6vW4iu/VS24UUFr+yrktmrSXoXnbZrrK/DK71R+kuaczrA1fU2en8Kz0mJsg5RO6OxniXb1wJxWGNcKE3+jcU0E5NncBc+2w+Ot8PTFyKOusQ9ApRFyHZHv90X29l21fwATTDD9KvzXZ7Due9fJewSsngwXEuCpkbBGhh+DD2bAB4/BqXEgO71fy3BA0cttbf71Q5j+Heh6H07cCdPvDvN3/RV+GGg/2T0gR0id8tWlwJOriNs8MgyLpof+xhAYdsq+P36+KyD3dqo0QfRIiL4LJhmh0go/vhukNf+sDXK98G9TYMcDEH0V1l+E6O/C25Ph7xVIskFhYHjch8cV2PYneMoMYwdBY/J49aHdHWnr/hFw4kNYPRH+Zyo85YN/CbiC5ChlvRdqE+DUdKi+H/7rryr3B2Lg12PBeB+cfwwuPQYFmlGK3OPlnYvQej+cl8oiASYPIp+2PO+ch1dGwFvT4VICTP8r5Ev/AHBNnnfDz6bD+R/AgMFNL+RehIUT4cJ0eMsEm89qOrWAktw1GX5tBU8P/HIQF9rk78P0j+BFTcemlf+2h6/CUSWg4D8BTzQ8FXz1NiCMrMcftatuliHJNxJWfhv+o7uvIv6lC8x/19egOCsVPCrPF10g96fTbulh+jb873S1/dQ+AF0emBQLD4+AsX8H03sh/2JfPkOSUU/0jUNgGA2m+2Iv96fp9MAPP4AtY+Bfnf0atAFqrTA5ClY8BJX3qfl7PvV/e4At94DnU/DcobpfFvrAE0FZ+z6BE1dhVyB/XymGdjUpJqyIf2yAbZ+p+aKkcv4MXv8Aou+HyWNg8tBIEn0nKHfCltGaIfwX5b0KBz+CpyYEFMpIKJsCviF0Etci3XMZOu+BnwQ6o7GjYLITTnwGD8vR1Qj4e9kZSyIGmDQCuiQGGgs1RH8kLL0X1n8AGzWdW+j+7Q6MgI3BSrkb3v7OEASQxkQ7bAsmvQt+9ihM1+A8fSyMbYdXPlY7cd9l2NwL5f1cQg8/CB88qBL68fQgwfBZWvbSZy/fvJ70fVitwIlLMPGiun+TbCPVli/RRsKk9dA3DIFhp+x9H8PTdugQqoI8JhuyG14cBcfkMFhW0BXVZeDfj+9umPctyD0DHf1cDzKp7zNwSktXWrmahzFYz8pn4LoTTBHuBdN80VnOJ0Q8vgX142HzJXj8PIz9NmwZD7JDGMphujegQIeSWKa5Cl1X4AltWUbeuCLwSMV9p0aWkSpeTukaC7jS+uCn5R9BdpMBPD618/6y20fICdS5LpWo4T51JBHJ9RaB7c2LGgFbJkfw2Ws5GODfxsDc38MECxx0wASzOhrVJvuisLTs/+cRVbH7jYcrMPkyrLDCEwqkONQ5rC+io9/XERh2yl76NHc9Cr4eWCVdDyNU/26nG+Z6w7tRygnc0GFQ84SuAwHZcWSegSfGRVb0MpnhDpWmT3YUX6Ck+tMfyrW0gndJa+4K/PwC5J6DUz/QKM5rERlEnj59xVXwBjs5ObQfCU4NNr5P5XeAYGwkK/tavDX3oiVDj1oPwc7WdRV+fJ2tR7mq4q5hMeTgZDP87/cDyUf0dYkMmchtSvjwGCi/DMvlXNL98Ovr6JXkXNU7H4DzI2i9AhvHw0+/Bev/BBulq+w7N38y/TbBo7O5zQgMok5usxRadlJh9dFm6s2x90PtxMDvYZgewZr++e/g6U74ZS9IP2v2GYj+/sChs5ad7FzGfgad15jA1ab/MmG5bO/Zc4HJyJEw/VsgrbNQ8UaA8ml4AtUzRBkeuBPaAt++kHMWrUHlPgJ+ch/88v2Af/kKbLark9khua+D5wNGmNALBwPzDWf/DJ0GeCI4QR4iPrRA+ycw9jvXOeIYCQ/cHfhdZ2czNClvMNWn8HonFP4V/l7uGvyh6lsf8tJTuRxTTuB/Av/uBpcBVoxR55VmPgimHsj8ENZ9P4yjnGhu/VSdxP25nDeSCxd6wu3rBkukZ/8bR2BYPi5+pSeXJN4RRrdHTnaeD1xfhfYISxYXPgT8SfWndgp4Yiz8bHSYRsTQPeryzRf/DPPGREgh16VLt5LcjVbyPA9jLoDsfI4NmMnsmz86Gp7oUVeoyDvSQv63h8MP5wP3w9JLkPSeWtanxkFtcIfavqTCVyPgp7GQeQF+1A1j74O/vxuC75DNfAhWOyDlXdVNMjkGqjUW5WA83/kdZEoiQl3ymvKeuty1fDIslaOtByG3E16UVvldsOXhwIR2cFQRlvCaIdkJ//tnsOX+ayb7m73p+Rh+fgle/AtERatLJGdKt9VlKLwAP+yBnzwAq78H00O9foTi3gO1D8FcN9Rrl15+Cj/vhlb/ZsLw4h/UFWiSxy+7wDke1n0M6z3w1H3w4kX46ajBFx9E4KxHfU0RGH67XsolgKfgqICfTIBd31VXd8z9ECrHBKziq1B4HsqmDuKeuQKvX4BCmedRWHith0pWrLSizqgTm6u//TWt6eFQrCtQYgfXGNj1RZ3acJD3KpT8Bl7/VO1Mgy4/uW5eGiLadfNRBmiwwtHfw3/dDT8do84l9S9Gu5x/ugSuGPhFJONCk0G+4Pb4+33X2cslua/IznYczLwDXvkDvPIZ/MIKYzV59aCOQH8Ehp+y7y/hDVzLV8yjpetkCDSkxVnYBRO+DwVDWZExBJp6kjACcn345gugxMCWmKHVSTi3HtIR0BG4UQS+1sr+RsHR8+sI6AjoCHxdEBh+E7RfF2T1cugI6AjoCAwjBHRlP4wqQxdFR0BHQEfgViGgK/tbhaxOV0dAR0BHYBghoCv7YVQZuig6AjoCOgK3CgFd2d8qZHW6OgI6AjoCwwgBXdkPo8rQRdER0BHQEbhVCOjK/lYhq9PVEdAR0BEYRgjoyn4YVYYuio6AjoCOwK1CQFf2twpZna6OgI6AjsAwQkBX9sOoMnRRdAR0BHQEbhUCurK/VcjqdHUEdAR0BIYRArqyH0aVoYuiI6AjoCNwqxDQlf2tQlanqyOgI6AjMIwQ0JX9MKoMXRQdAR0BHYFbhYCu7G8VsjpdHQEdAR2BYYSAruyHUWXoougI6AjoCNwqBHRlf6uQ1enqCOgI6AgMIwT+P72V2fgx+MkgAAAAAElFTkSuQmCC" alt="Alt text">&lt;/p>
&lt;p>Luckily we can always find a way to get around those limitations. Here I recommand the &amp;ldquo;Stylish&amp;rdquo;, which is a powerful tool to manipulate the CSS style of the page.&lt;/p>
&lt;p>Just simpliy add these line to Stylish, and everything will be there as your wish.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">DIV&lt;/span>.&lt;span style="color:#a6e22e">notes&lt;/span> &lt;span style="color:#f92672">DIV&lt;/span>.&lt;span style="color:#a6e22e">content&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">height&lt;/span>: &lt;span style="color:#66d9ef">auto&lt;/span> &lt;span style="color:#75715e">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">overflow&lt;/span>: &lt;span style="color:#66d9ef">visible&lt;/span> &lt;span style="color:#75715e">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">display&lt;/span>: &lt;span style="color:#66d9ef">block&lt;/span> &lt;span style="color:#75715e">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXkAAABnCAYAAADlqDJiAAAgAElEQVR4AeydD3AURdr/PwRwwx83elwWwWwEWUAuATGACnIKKn8KERS9cEiFAgp+B5oqoHIFFJRQ5JUUWKbEMghnKFRSCORUjHoapCCcJ6C+ScRLIkoWOLI5NBsRdkWyC5j51bM9k50kmxAgauSdqUq2Z6b76e5v9zz99NPdz9NO0zQN67IQsBCwELAQuCYRiLoma2VVykLAQsBCwEIghIDF5K2OYCFgIWAhcA0jYDH5a7hxrapZCFgIWAhYTN7qAxYCFgIWAtcwAhaTv4Yb16qahYCFgIWAxeStPmAhYCFgIXANI2Ax+Wu4ca2qWQhYCFgItEkm7/OUUlTqu+rWCXhKKfVeNZk2TSDgzid7RymBX6WUAbwe76+U969S4avL1FfK29lv4/51GouA14P3V8r76oBrrdTm/hrA938EjLbB5ANudiyZxRMT/8jtvXsy4K6HmZ+Rh9ubz2M9e9Kz0d9tzD9Qv7f6vF685j9PKbkLH+bhhTtwm5+Hwr76jMm7g4m9x5DtUZ3Jl/8Yvf+YhdvoWwEvpQU7yM7awaXGHl/Rah57bAUFv9Tg4jtA9tKl5Bplf3tiBLwUhrfNP1C/3oFSsp6YxZa6iuoVDhSxYuJjrC6tj7EBR92vN5+F945hqd4W3h0T6X3nCppLFnDvYMmKfLyBIpbc+UdWu324tyxkRb4A5mXHY3fyxI6mwQsULeT22+cTyjJQwBO9I/UP/dltery6Av8MAU82Y3pPpJkimzKtZlfmUlbv0wUYTzZ/bNS39bLfuboBjgEOLHmM+W83xMZHwfwxPNGoEU3ZhoIecqbfy8RMvbHdWfyx9xi26P2mYezQfaCU7IVZHPD5KHjiNibu8OArymLh6gNIDdxZY7hzfkEoHDl9AY/1vlPvR152TGymrXoa8SJSuoKHPvIf680fjY9aKPgOsuTee5lf4MO7YzqDxyxV/SgS9cAB5t/+x8bfQAi3ibztPsDqJ+azozn8ItH9FZ61DSYfHYvT6SRh/Ghctj489dFxPnt9Bi4bYOvDsg8Pc+zYMfV3+F1S4uSF6QocYOFdgxk82PR311iWHgwS3LeIe83PJXzvfIzvzESlfrC6gMyFs5j4x9vpeetgHl+RS7HXT2V104xPGPz0x9dz8GAOmdnqQ6hPtHXvAj4vfudkJscVk72lCK/Xh238Vg59upnJdjvjXvqIQ4cOcejQR7w0vAFmUpTqYvIOVmOz1y+Xb18WuR4HI5zR9V80uPPkredgbDJzkpqKF6B0yxJWm0a86DgnFOdRXK0T85Wxo8DGiCQHBNzsKwNXQoMCNci33q30l3cPc/hw/b9Db6TQsJvUS/dL3wR8eIMuksfb2JeVR6nXhy82hfcOfcTzw23Epmzl01BbfcqHqxIaly7gpqCgjEBMA2y8+WTm+3AlxTVOY3oSKM0m251A6gyX6Wn9oDDwJdlFYaYd7cQZzCevLKgiBn0czC0idnQCMfgoLfAQk+Qipj6ZZu5sJKz5qFFbHT60lXH2CP2zGUpX8spbkM1B+3jmDo/BMTmN8eSTdUlG0EROdhcjHEWsXJJPw2G3iRS/2uMOV5NzRUUFNTU1dOrUifj4+KsgFcOI1HRGiHS3paARHVtMDNF1fMRGxO5giyXljU9ZO6QuYiM6DR8ESlfw8OO5eIJ+/EEovvc2MuOS2ZCmYsYmTSY5ZTkJCS4c0eArmMXEhR5i30infjYB3G8vZdaTuQQnv8SHc/xkTH+cMe41bF43g8SWfwUNi9jMvYfc6feytFj/ANc/zOD1w3np8Js8EhuLTUByxOGQgmMnRu5DD0WicXOg2IO/LBe3zY6/uIACmw3n8BG4ot3krN6Hc+5uhttKWf3YSli1leWJDXD1FZCR5SZp2VYavjIK7dkxn+lL3Ux+d5l6JDOExxeGZjkFjx2gsrIa2+yFxNogb/oS7KvggL+S6ocHk2s0cux4tu5exxB/PrMmLuRgtWqr6ff6WPP6XEXXZqurmpF34wd1b648EChl9ZixrD/amMSiwT1ZZH4cl8y7H63T+0mA0syJjK1LuJSxg1cy7o3DvDIiDodNmiaWWIeDEMp21cdVn/dReqCYam8B+ZU2Ej37KCiwYXcNZ4gTijIzKUtKY3NikANLHicrYQOvz3CaSxKaIeVn5OIfv4HJDV/pMWUQmP14JsFlu/Xvy8eBhY+zosgHRRPJq/TjL57OCmHGB2YTs3YuRcV+yorHcFumTsTmImXrGyxPrGbLYxPJKJO2CnLw8Xup3PA6o0JdUNrKaFxTMSM8Mr1thaCbvPX78FfD47fmhunNHkBPubMlseqj95jrlM+jCLfXjTfoh7JiinCRkKi3jc0WaqMgDkav2szmMj8eTwDHJQSicIa/fOiKmfxLL73EF198UVfi22+/nSeffLLu/vICoh/zExRmK3iL7tBu1ztbEI/bjVvnZQQqQwy5Kfq+gicYPH0fRvRG8UwfX7RrLs9vnUywOp+Fs/MYsWEDyXEOnJULwZ7A+PGjSZDOF/TirfaQl7WPo96U+oOMr5QdK+ezKLeSpKe2smGuEx9xvP6RgyXT5zP23jyeWreOtNFO9QE3KlDDBz7cRW5sCUNovt84mfHecWaEkgcoWjGG6WXJjJABpYnJhvEdBTw7yFiSi7uymiB2spbMp7o6lmUf7WbygSVkBpPZmuIiOjrA5AQvDy/axNTdqYRlwABFmUvI849i63hHwwqECuDeMZ/HFhWT9NJ7pA/RR7noBFLXvc6MgIcdi6azvjKOyWs3kGwHu8NBcMcT+JNW8caqJGzBMjJnrySYOoeEEOdzMTk1jSFluWTkQPLcZETgzwseZf3YW1kfoRTYJ0d62uBZS/EGol2kvv4RU82dy7OFWbMPMnXrBupBYbMTVzcuRpO4/F+cXK6y9hXM596FMCNUsUs1VhmbVi6hwFNJNTb8mUvIr64m4flDvJGQzcJcG3PenYywINt4F2XzF7Jj/JtMNTWLr2AlS/fZmPzu8IhSt680i9mPZ+BJ3sp7c116P40hKW0Dr6cGcGfPZnYO9ElZx7rRNmwOBzGeLLLt43h+QyouW5DildPJcs5hhksqbSchJZW0yjKyM/JwJs9lssuGjyDFi+7i1nqjodEccab+ZTxr+NvCtvJs4bGJGRRXBwkevJfbskexKg0yyyA2eTNbU11EB0rJnL6UwLKtLA/1TxuxoQHQR/Hq+czfp/OZpbM5kJTGm+uS8BSVUXYwH0+wmKV39WRRqB/EMmrNexEG1oZl/xXvxUDZ5V4nTpzQ/t//+3+N/uT5FV1VO7UpvXpoPXqY//pr03bu1GYO66/179/wb6S2uLAmnFXNfm1m/0HqWU2FVl5erpWXlGiFhSV6eK/28sxhWo8evbSHninUzoRTqlDVdu2hXg9qL1eo25qSp7WR9cqiytV/2BTt6Q+q9NRntJKdT2sP9e+h9ej/kPb0B5K4Rit8epjW66HXtBCpmgrtg8UPab169NAGTXla215opG1YANN9TaG2YNhI7ZkSU/1MryMFz+x/WhvZ/yHt5XL9rdAY1F+bt9+gUaPtndJLG7S4UDOeaFq59uLIXtpD26s0reI17cFeD2kvf/C09mCPXtqUZ7ZrO7e/pr38zNPagmkjQ7hNq6u3pp0pfFobJvj0n6fVZaFpWtX2h7Reg+ZpLz4tdR6kzdxeYcrPKHmVtvfpkZpg+WD/kdrT2xdrI4ct0PZWlWjPDNPLI1HPfKBN6TVSe8aoU13VFmiDBun51uzVpvVXWNXU1Gg1Zz4I3b9YXqOF7o0sm/u9Arzrkat4OYSdwNiiq+oDbd4g6dtGghpt77Re2rCnS+qwqnrtQa3XyBe1cNVrtJLFw7T+M/dqZ2oEp/7atO07tQXDemiDZr6o7dy5XXvtxWe0xfOmhNpl0IL94T4eyk/677D6far8RW1kj5Ha4hcXhPr6yAUfaEaJzPWo2DlPG9b/QW2a9JUXt2vzho3Uni6p0vbP66/1mrZXz6dCe/lBU9sZBGr2alN6GflWadsfkjgVqm1qKrTX9DShtgp3TCN149+WtlVNlVZeuF978cFe2rDFO7XC/Tu1xcPUNzzsmXKFc02JtnjYIG2BmY+YchQeMKzHIG2B3sFrCp/Wpk2Zqc1bMFMb1KO/NnN7oVZe1ZJCm4j+SsErkuTPnTsXcVhq6nnEyOaHjkd48/gj4F7NnfduwvX8R7w+VZ9XPvKIOealw9FOXC7wHVjIE7PLGJGShDcvh33VCaRsfpNV45uTqH14RIoeks6/Ti4j4AuGZgQyvYwO64tCZfBkT2fsSjcJyc/z4aqpdSqZIXPn4hqTywHvDKY6nIxf+x6HkrewculKFk2vxvHpBka3ovom4N7C/NmbiE79iPGl83liSzIbltkIBs0qDFUPzHMQzwHyKl0kj3AQ8BbjtTtxBqrx2e348jeR44zD6XKRMHk5mxMymb86F/f4VFzefJbO3kQwIQ5bhEWnYHUeGTkJzNm6m/TRJnEyhJqXt+eP4cmiEbz0egoHn1iCLSGN9NFLOJC/ntxKWUMpwzfVgc1dgBsnc2ObafKQJBUk6K/G77eB30cwCD5vNX5RK/j9BEXqbIZEy18FKFrycGjRzpwmGKymOhhk6Zg7yTSmSnoE59zXeXNueP6Dr4is2fPJd63ho8R8Zj3hJ3VzSqjMNkd03UxPTRRMasmAm9yCahKWJRATLKPMb8fl8FMWtEPZDjb5nTidLhKGp5A+zsmKRZnkLxvBVIeHLfPnk2dLwB7WtJuKf5ScjGqGL3uXzalDGuHk3vIYE1d6Sd76OqOzxpAZO4JlafvI2JdHVr6fYGwBnsBoYoJuDnhsOJ0N1gtMORnBoN9Htd+GLShyPQSDXmkmQGbxjpBa1Ih7xb/RDlxDbLjsYHMNYciIWGLSX8KV9SQr149hwCahHAzhzsMDyLOBPWkNu9+citFjqw8eROZOuQuXMnn3OkYPSef1N2WSeoD5BcXYnE7s/mLyC8ooKvbgmpvOVFNTX3HZf4aEV8TkO3fuHLEoTT2PGDnCQ3d+PpUEqVz0GEucu0nzzuauJw9GVL3YRm3l0Ouj9Y6pNxhBpfYR2q40NqzKZOGiHI7GTub5d5cx2mHD7/Xix67rqlUhAv5qfMEysiYOYCXjeGmdg4zpOVQ2KmMfnvpwd0g/7UzZzEfjbdipxl/txm0sJAaGs2brcGL8btyhzgvEjGbVu8ks84OjdThOqGTegtXMnr0eUcvb8lYw2+MmYcMaYoIFeIN2RsfU6QsISBwTE/IeyMUdN5nRTqjOL8PvnEPSI1P5LNKYGkjg3Rn2uum0bcQatiYfZPpCAyAvB7JXsmRlMdhH8fzuzUyNqGtyMPqpdXzoHI6jOINd49NJS3TgWLsB+5J7yYmLI5ifRYF3OIkHD1AdNxVXBLyC1UVkPHwntuRU8Fey6fG7CH23enEOPn6XUt/Y4kh546PLWqcxatT4NxrX3FWsM2mAgu5s5i/dFYoarIYRz68l2RkG2eYML4YGPG+z8oknyRF9vj2HhbPceEdvJSHaT44fYmJNDDIYgOgwHSr3UVCdRKoMyB7Z9eViRtIM0r9Qyrr6ZR2Ny+UnTudWNsdkXlo7npwxK/RoATwFm1iyJIOjxJK8eTfr6umZwtRc45exYYSL4bYCVjpSWTbeiTNmA2tE3WTrQ2xlLusPpvG8PZ/ioItVIVVNOH0oFKwmf+nD5MWmMCMYpGzlWO5aaYqzdCyDl8q9jYRlu9md+nNwymhc40fjzrYRl7KVN9NcIXVgxsSFBNe9xyrRydrsdQwePOTnlim1U0w+Cxe+zdY0B+7iYooPFnCguprqxweTa48jKWkICQnDacH4Zqr0Lxu8IiYvi6yDBg3i3//+d11p5f6qFl8DRWRnyxcQx+TkGAqyD5K2YTOfHlJyTbB4CWMWwrrda0mS/m8zSWhBkVRt2Pz5zL5rEQdVkrqyUZ3HorF54fu4OXz4UTquyi0sXZhFbrGwczvD527gvTmjiS1bSEZcCm+8maZ2+EjKYDFLJq4IDzgiLcSWsmLMw2w62jDDcFYq1IdlH/2LJvuvr4An7prOPmNQkER1euY4kt/9iHX1V3oJFC1hzPQ8XE+tISVvJQWUUWYbzbKkGALufbhtTlLrpGB9RlInLQbwFHsJBt14ZP0jz03c+CE4AkUsvPdhchuNbmpwS5TJlWM86zZAoKg4JA1JUX0HMliY5WHIuFiOlrlIiA0PLvWQkF1Q02eH6hkUkZsc8nME+iTWvPcRny5zkzVxLBmZeUw+cJS48aOoY5MiBS9cSvauMvz0IWHOOtJGuJmdkcCaj3YTWmuULZWDVzB6979CC2j18jbfXAHekjzGNYIRBg/yFbFiyT7s48Zh31VGwqggeTllzHkjtfFCtC+f+WOepHj4Mla5sslwByk7GkvKugSifQcp8NhxidipXyFoZDFZv/d5yqgO+nF7vFQeLKDalUpSjGxrHMz0fQ37no2kNR/xXqIkdjJ1wzoIFCAwhy5vPksWbiE4Yjj2Sj9JCYbsakQwfr3sWDibpQf9Im6H+n1unqyw2hm1+SM+/RSKV97L4xlZjErIp9qVxpA6Ul4KVixkRe4+jmIjKekp1qS6yHvMxvDNh3hzvIzcsqXyLnLmHOK9RyKM5EYxrrCtjOSNfu0OtcAd8Cqhxx5bT+CT+IGiLLK9CcTZAgxflkqwwM++jPXk2xJIGjKeye5i8hLe4NN1CVRuWUSmP4EmYWxUgF/hwdWoiUQHf/jwYe2KdfGmzMtfflDrP3KeNmWQ6FirtCpdca70dTVa1d55Wv/+87S9VUrfakqqaaJf7PWg9lpDpWJNobZ4UH9tZp3iWPTQPTTRWYa0aRWvadOmzNOeeXlxKH2dTr5wgTZs2GJtb0WVVlWl/5V/oM0cNEx7+jJ05TXlr4XWGgbNi6zvDNehRquqqNAq5E/PZ/HecnVfUaWdiaj6O6OVV5zRtJpy7ZmR/bWZe8u17dP6a72mvKZ9sGCQ1mvKdpOOVelMH3xNX3QIZVylfbBgmNar/zCtVw9d912zX5s3aJi2YG/FJetdU2jSjesVCenkhz2tNQfRmapybee8QVr/adu18qoqreTlh7Rew57WDNXoGWnn0HrIg9qLYaW0KOm1wg/2avt3zqvTyYf0prKW8PI87cGRI7WRIweF1nX6D5PwSO3BaS+b9NphtGXt5PLxNqWvKdFentJf6/XQy1pJua6TLy/Unnmwl9Z/yssR63+mXNYnarTCBYO0YU/v1wql3v3naTu3z9T695+p7a1bKKrRSmRdZ8oHYb26VqOVb5+pDeo1SBvWq5f2UKgdz2gfTOmljXymUKsw+mhVeUjv/aDRkY0i19ON6w+Nb8bcJYz4+m/NmSqt5LUpWv9BC7QPKqq0Cln7kbUro10qtutrab20KQ0WJar2f6DtLZT3uk5e+lb//trM157Rpj0o7TNMtfMg1VYjH5yn1S1T1CvHlbaVwmfYgpe1l1/cqVVoci96+V5ar17yp3T0xv2guu+lQnvtof7ag8+8ps0M8aLGH19FaM3kGW2vrFf0GKYt3l/XePVK3lZurkiSN8aiq5LcDSLyK9PeDC/jNyyDFaUQ7VBqDe8OHh68CJk4Gdf0wSKR25n8xiE2jFASo899gEqbK6SDM+JF+g0UZbOlMom010co/adzBq+/OQO8OziYIZJp+ApW5jD9rjr5R38Rx5xwlHAo4KEg34Nr/IjwjhjP2yx6bCnFout7frxpKhhOFg5F43DqaxABLzE2G/bYOJwRVR5GqhhcoSS6nsgWx9QNb+AoLiZ7dpDhG0x5Bnx4fLKDJSwtgoPxazaQcuBhNtmSGV0n9YM91iTd2O11umIj58v6lW2xj2fiXLOZVNlr6c4mI89PwqoEYoMFzM/0MH7D1rotqTFJkxluy2NX3ChG1YnxkmMMQ8aPJlAk7a+k16C7jGq7i9hgEe7o8WxYNRqjhv6yTBZmewjI5pVGE4srwVvVOuDJZ+UTs8mJfoo33phLoj9bvbAPYfkbm/FPnM7YMWU8/8oapprUFzGhxjJ20thJmLuZrc4yijNnh842DDcJs/5qPzaHsbtMyEfjmrqOdfvuYnpeLJOTpLEUBtEOB06HIULb1FZZVaIr+B+gYP7DbBm1mVemOokOFpOZcRDb6GRcdj+yDZOUraQYsxnnCCYnwMHiBCaPMMqgsnWMGI8jUECWUYrqMtzBWEbZ/eR5HMxdlxbaHRV67S9m5fw8qhtOSkIvr6CtfEXsyNrEpuIglQezKZiTjtKyyXmEzbyZqqtrHltCYNWbpA8RdU2s+kYDPoKuFNbMdbHJtNPSqIb8OsenkLB0KdOftId21iwLqRbMMdpWuG0chnKNZ9maDawaZe7YohqYyu6TJzl58iTH3k0mNnYybxyT+6/qGDz4OLjjICSM07faNQ1w9JC1fHb8PTW1bzpa6I2tzxw+DOWl8j957A0mmxihOXmgMp+spY9z16138sSKHRwoyOaJMU+S71rFu1tnYPrWzclaPxzjJJibyb64VNJHmbhGsBp3tR2nbEivuwKUblrKpso4kux5zJ6/A0/Ej6wuwZUFgn48ZWV1tGOSUlm3ZjLBzLEMuGsRxcPXsspYiQ642TJ/IbtsCfSpXM/slQXNHDQJ4A6dnBpFSA1uH8LwESMYof+NSnLWqTuurOANU8m6w3zG3DWbfOcqPnx3udquao4WM5q1773LMmc+i+4dzMQlzZ2QduD0ZZPpTiItTRc6QrRk33WQ2AR9X7ZOX1RiS/KC9EmCTbOXEjogbM67VcJ+vB5ZX9I7gmMUyzcsY0TpUu4dcC8rPeNZu2yIPmYGKMqaz8riWBLiilk5ezUHmrFE4isrwG1LJDQW2BwkjAq31YhRsjDcild1GfnFMGrNG3x67DNeTw8LPDa7kzinE2dcHLI2HyMbDOQ+dJ5ExtNE5q5bzpCIBZL1jGzmT19JSCRMSCV9RhzF8+9iTFbDY+OtWJ+rJHVVkvxV5m1K7mS07KYJFJmeiXIsULfl2+9Xi6tBf/hZaMeLN5/sfZD0/Ijw7oCAhwMHPdhsavGzvoxhyiLgxe32EqguwysLk6ZXQb+Hg7IQbEiBAXeIUUXi87Lf/s2vkil9O5OMjEU8LquAotPfPLexftaUR8Rg9BDWffaviK+af+jHnT2f+fkOlr07JzSwBDwF5BcFCRZncRAXz9eNNj6KsmczPcPL5M272TC8jIUTM9hStgyCaiFTdhyoK0h1tT3yDMaIYvzaIFjtpri4lGhHNIGAl8p9Ku9kI+9gEGlLX9BOwqgEvLtmM3HWKjYsd5G/ZDbri5NY9e5WkoOZTHx4OmO8a9i6YQaJ0V6KDrgJlnnw48QWdJN7wI9LdoUEIXhwCWP+uLquDYP+o1TbIs67jNKq35bi7T1ATrabxDXvsmZG450odURjhpD6+qcM37KUpdnF+Jla9yocCOIvWs3sRcUMf15fT/DJiVY3Pn8BWcU2EpeFpzG+A6uZPj0H25w3eC/dSf6sx8jOc5NCkLKMMdyeVddY+KuDuMaHc2o2FPRy8EARSbJPPODD785jU5k57yABnw9fEGKTRuF05zJ9DKzZkEpMznxm53gY9/xuNox2s3TidB6fWM1Lr6/hESd4DhTjCR7AG7RBtJ/iHcWQtI4E2wFkjWz+vaUhJhsqX9DP0aCDSxa7pW3lmsErMkNvdAWpXH8vt26S3T1qnYGHbyUvtCNBFul3k95g7csgIW0we/56DlZDn3HL2Pq8i7zps3liloeE4iCxUyNxBiP1r/vbRph8JBA8ZD98FyvNuhpAqWtk4XUUWw+/znB/EEdSMin1tut5yVvxuNrJEDuOlwwG0zAbOXAzfTp5ovFImENoFmzEqT7IlvXV4elv0EeZH5KM941+Y0h8JJ3XH0nVd5rkMH26k3cjLcQ1StsKD7zFbMkLkrx5q1KLCElvARlPbqLSFseoZZsJrXfJc18xOblBkuu2OTpY96/RanuYLZbJqzbzVMimhGgFysiYbhxpbL6cjsTJDLevZOnj++oi2mL7MHzOWrVt1FfA/LtmU5SQTNobnzJ1iCwSv03GliD+/ExyPON5fvfzuppjOe+9EWT6koNU+meQiJf8ldNZXxYkdtxcRFPlGpLM8PGx2PLAljCXtXKISs85WJbJfF2TUleYqwk4HmFDxK1HkYjGMGTGBnZH4jMSPVhNwaZ92OXwnLFVGA+5K2eTV22jz+Q1LNNVkaGdHtn52NPeZau+zXHqK58xFR/5+bJbZAObkw0G4+fgouk0oWWoX9C44YxPymL9ooep25JgiyVhVBpPhcxUeHn7sbtY5B3OnGW72fyIi2g5+JeZi61yC6vzAqRs3s3a8dISTta9txkey+SgJ8gjThue3IU8Liv4fVKUKtA1mmRZ7BUmbx9O6to0ddAwhIfMBOpKUb+crXpnUtdEoGtvasOAKAsTRjM62Unq1GRG6/xk+JvPs2jWUvIdc3jDPHOOQPvXfNROFgd+zQJcq3mLdcicUhcp8nFcq5W8gnqJjrzBkYM6KhHV53VvrcAvjkAzjdXMq1+8mFaGzSNgMfnm8bHeWghYCFgI/KYRaBsLr79pCK3CWwhYCFgItF0ELCbfdtvGKpmFgIWAhcBVI2Ax+auG0CJgIWAhYCHQdhFoU0z+SAXcV6HAMoephSPfw8ZvmrSiGzob8g+zWYC2i7lVsmscgcIKeOXHq69k1Y/wcSvQufqSWBR+ywi0KSbfEEivD+aUwYBCmPFfEP4f8bxFUMWb4YaPzzek0vz9kWrYdqaJOLWw7nOYZBgfayLaZT3+EcZ+2cxgdVnEWhj5EnkGvoeexVBS20J6LYwWqIFXTkJFK9NtYfbNRwvCfZ/CpCooOQ7dCuHjiyqJ7xQM/gx6m/66fQrdTPfyLuVU5CwcHSDdDUeaq3cNTNV2ZBwAACAASURBVPoSqoDCozDne0Ur4IdJn8PdxZDyH9h5CqouQloh9PwMen4aFoQi5249tRCoj0Cb2Ccf+AEmfQ2lP6nD2r1PQcYNYGsPj8ZBZleIiVIf484fYV6XcCV8fphzBHyxsKsjzCmFBS6YFfHEWjidhPaUQzqQ27f+87q7KJjmggmd6p5cdUCsQXp+4U2rl8oz2g67+kLfVh7yozvBA35IKYPMATC0TfQ21YS+s1DeHnK7QeG30DcWRurli+kGh7rVb+qN4h+nH8xr2BdqYWMZrK2pH9+vwfBCMcARvsRz3ye3KSsLH1eCT/r1eUg9DdN0qxZchAobfPIHkzWGWvC1h5zB4PwvpIZJWiELgUsi0Mqf9SXzixgh+nr4cCjs6wGJPeD4HXCPnJ78CcrPwCuVkH5UfQx9O+okamHPCbj7MDickBkNVd1gVy/YdgQmHYUjumQWKdOKbyDtPOT0ge4RIpQcVZLcH76Ev56uH+EfJTCpAp4qg/uKYfCX9aW2PUdhcKH6u7ssPLuoqoYB5eA9C7eKVPYZrDNNx7eVKOlw45dKYutmSNe1MKfQFLcWnio23V+EjV+p/ITm2PKw9NxsnufhTyIhFsGocihvIHlWVMHYQuhdCAO+MKkg9PKkV8CfSuDuQph0IvIsK747ZNlhjjvy+/rI/nJ3JaegrwOG1sL7F2DxTVeYdxTMGwjHk2BCB1gg4Tvh1F1w6k441BtksPtEwjqDF7Mzz56GoTdAxbewvz0MvS6cv/cHuEPvPylVIDOicjlypH+tQe0XngmGi2aFfoMItAkm3xC3wEUQm0tZDojpADEdIdEOWQnwwHUg0vufimGOH54bBOu7Q0wtLD8BMb+DDwfC/UEYXgxp+jS4Xh4XYe03MMEJ8U0gMLCP+li3RDKdHwX7T8O8AfDPwTAhAP+jq3xkVrLcDzlJcGgoZN8I7/+gcu8eC5/Eg70rHLsTTt4JC02zErHB8vEJKLwRjgmTSIKBTZTPXJ+Pj8HGKNg1FE4mwdAfIFX0AECzeV4Hfx8Kx/4AjSYzNTDnBEwZAMeHwi4HpB8xDWY6c9w0ED5JAF8V7GlCVTbwZhh6Fl4wDWjm8v/i4VrYG9QZ+znwxcAE46isXhhpx/tKlDqlReXrALOuh1cr6zPgPV5w/r6+IHFEGDsqzxe8IHbjzKY3HNfD50NV/8npDhU+SIyDflEQ/3sYWgOpJ+rn06IyWpH+TyLQhibQhOzHlPvgjlOwuic862nQkW2QkwADo2HmrZDVVbVZ1fmQzX9WdwLfefC1U2qWKQHwRWDSgXOwvxY26emvpOUTY8MM+AEbrL2gqEQLU74A205BzI0wsCcMbGEGMe0h2B5W9zBN1S+VthZ2noUJfXVG0gEyBkGgBYNDc6SrzkB5J3hUH4Tiu8FAD+y/AP1kNhUF98sgLERskBgFFYKBSSKto98BpnWG5adghWlQq3v/SweiYIXRKNfBhze0oAAiRJTAWiNqR/j77TDUhPPQeIgvgY0/qsE7cAbSayCzgeqn3y1w6hZF6IGhBsHwr0jyopOXk9KJN8O8IOw/CQNOKPtK0keyXZfRR8KkrdD/QQTaBJMP/AiTyqBUU4xxn3TganihG+yT6a40zEWlGgjZx7sOHuoCcw5DaQMVg0QNXACPSLYi1Zo+QqN9gxfA2x4cEd4ZcS71K+sFEa8ukNsH0k/C3ccg/npY3QdkIGjJ5eisM86WRJY4tVBxEe4x16XD1TMAnzDs9qaydFB4eUQFpqvM6uFnzj9C2R028AXUoH25Zh5kYXScVxG1dVUzh0gqtgjZtt6jKFg9MIJO3pyDDZ7rCeO+hr4u2OmGvk41+zRHu1RYJPl/3qYYekhouAgDz8DMBLgnCKPcao3qUnSs9xYCgkCbYPKis9x0OwSqYK6oGKKU/ra8Gsb5w9YhZWG27rKpNHX3ekAGjOTDcE/vyAxeotnaKZoBGSAuwZwa0m/JvUi9m0R6uwhvHYc5R+HQH0wMszkiTZSn3hhRC35jcJMpfAfwmLAJnBe/OxAfSapuLm/TuxjJ0KfawRhkvbXwwBX2mGCtwt2URYuDA53w+c169Kj6qo8WE/mFIvbrCZlnYIasFd0In1zBaCRrUR+fAs9ZKLwIK/rAX7rA8m9ghajEbmj9RfJfCB4rm18BgSZYyi9cEmFU9biYyj/+RsgZoP/1g6ERpOe3voJJ5bCnBkSPmnIYYm5uPEU210gGlfgLUN7Mwqw5/uWEZfvdn47qi4wdYGgXEGmsrnpREDwfXhj1tbAM3dtDke5zQtYkCg2mHgWPdoU93+r644uQXqYWqevKfQV5drdD3xrYqa8nHPkOym1wj7HwXUe8ZYGScxB/wxXOMDpA9+v0vyscZFpWyquMdR62lUPaD3C/WO89rXTnLd5CKtsqZWH+HPytGrw2mNlTrRuNvAUcVZB8GhbffIU4XmX1rOS/TQTazCcTYnaytbBdGMgqWcQ8pt/XQkmErYdTbgW+UfrScg3uiYe/9wjTiBjqpLZhvvAdPNQzQgzZVy7qI7EKK3keg57HQQadfY1WKOunj4mBe6rUjhN5IxLxc/3CH2X3G2HaSRj+v6quE3pDjmEptj6p8F0U/CUOko/DfZUQ3xXuv07826tr5K0wzw2jPlPqkIGxkG2SIJvK8+OvIFmIaGrr6qj/VdtWMwfCNJld3QJzyuEFkcI7wup++kK1MYsIl7DZkAy+f7sAq29sNtpv9qXvR3jrJLzwPUTHqK2OI0U9dQbSjsMdVfBod5h3EwytG+0jVLcT5NwK46oh17yF8jy8VQmFIaO+8MJ/1I6ykQ23c0YgaT2yEGgbVihlK98h2KvBo31h0+/Ubo1xpyGrpy4F10LaMcgY3IQa5iJsOw5pkuZ2mNLcxyTtLlLTYbVgOe96qyP8bAhchGVl4O0Jmy41mP1shbgMwrWw7AvYdl4NooZqT/a9iwBi3vcebYO8BNj7Nbx/Hfylp1oraphbiawvnQRvLLwTSagwJZCDaXd/W3+fvGyt3SiDbG8Y2Q42/gc2XoB3EiDelNYKWghEQqBtMPlIJbvCZ3IUPEZUJC1ILxJmWgX0vRkWtmSHRQtoWlHCCMj+7vTjEIyF1bEta5NwaitkIWAh0BoIXHNMvjVAsWhYCFgIWAhcKwi0jYXXawVNqx4WAhYCFgJtDAGLybexBrGKYyFgIWAh0JoIWEy+NdG0aFkIWAhYCLQxBCwm38YaxCqOhYCFgIVAayLQppi8WAZs8cERoOoUbDQ2i+uoiOXE9EhGyfT3vmADezhNoGnQ/vgIPHVGWbwUA1xyxD4lkn152eJZDG81YaSriWx+0cdi/GxPUG0R/EcQNh5XeG+ULXoNTOWGCvYj3PeFyShZa5T2IpScgarL3GvfGllbNCwE/i8i0KaYvO97mFOpmuEfX0LIUcOnYecN4tjB7NiitAoKzcyiFl74r25bxfzcaNmLkFoGO8UAzkWYVAh7mjhxKpYvxdJkyFbOBRUvsQOUngWxw9LsdR7GSrl1c7GG2eE608HNJr66lzIoST6FQZgkDiZOhuk52sH7uiXI4I9QHg2OWmV0rM6Eczh6vZDs3+79qXLgYtRngDjRaOAAZc8RWCYDb1DZGtIdfSEnk8Xo1t0lkO6F/TVQVaXaWBxwiEMOw2lHvYytGwsBC4GrQqBtnHi9CHNK1FF9YardTsHB2yG7DPbcAuvlBEoN3PeVqqvsbxc7HoVngZPwVDUs6APR38KeaNjVRTlyqLgFMkynVypOQklnyBIm3YC5i335lB/gnX4QI554jiv76qli1dIP8e3BI2Zka2DvV/CWFCUKliTAzFp4VszHisMHjzILG30dvHN72FKlYWDtqlrrUonFhO5ZGNJDmSQoaQdZv9cx88NfT4H3O2UtcqeYZQaeFc9EMogV64fOOqpyx8gs6TRUBOFvVbDYBnJydp/p9K5YWRz1ralQNbDWD0tuhRIPeDrrJnTFiFoQZg6ob+BLTOhKWT/sCX/6t4mOFbQQsBBoNQTahiTfATbdodtfj4Eh3ZTt7KZqKScNJ3QFXweY2Q1Kf1DGnFK/hSW9oXstDO2mTsDWuWALQpoXZjobGwo78g1M+gYW36K/6wDrb4fVXZVqR+zOz4xTpo3Lu8CX4gCiD8R0hZmdILoDJHZWpyEdnRQNMRI2SRyKFOrS6iEo72CyYdNU5a7m+QX4GFgSCxWnoXu3sAVE8f70zkCYILZn2sHiOFjQDx49B44eyrZ9zg0g5nLFhr3NBgNtyu6OUzd0VnVaObMQCV5mWXe4lRkEo8glJ6FUzA7LjKoaEm80HYCqVTZ1QrOAL9QMrNwP3Q3Tw+L9KNLsyyBu/VoIWAhcEQJtg8nrRRc9+F/PQcaNUNKcbvs6SBRm1Rmm2BWjKa9UagcxziXemF44CyOF2Ygzj1p4xQ17f4J4s4GtWnjrGIz7FlYnwEOGGkZcupXAciDrd8r+TMxZ2PYtiCVGuSr8ENNZZ2I2mNIdBnaAB8RBRDsISfLiOGSwsjPzdwkPbH7w0mG44h9xaUc3uKeDmuWIvZu6k79BSPk3lHdT0nR8Zyj/TknrIZUUUF4TxkcMlE37PTg6woQb1cAlkrw4s/i8H/TVHVv8s6+ex3l49hTEx4DvO9ipqYG4rjJiwz1BDeSHxA77RXgfWCz2bDrAvFjY7oZtkdYG6ohYAQsBC4HLRaBtqGuEaVZD8jGouh42uiG+D4jbyxjDYJnOXA0+XFoNfcUIVw14O8K022BegyFLVCtiZExc4ImRLbMFRWGIXk0tPIqEKwy67hLLjrfCtI6w9gQssEO8HdK+gHhNeRXirDKHUJdG7NjL4PA17HGASPLJugpEzAAXFitGGe+Ad34mgyPim/RD3UHFLMMphlFAGzzdH7r/BMvE/nwXeAC475SylnjkJth7AR6tGxVUwmAQUktg1k1qdiBu6WTQFOwkbIuCCS6lFsu508gMTjW00VILaw/DqxKlI2S5lLVFAyMZaMQdnxhGsy4LAQuB1kPAzNpaj+plUhImPM4Dj8bAtnOwpyP8szO8cCHs+1IYaDBKqQ+EfLk4/Q5CyY/KOqRNDI593WB3ju5JStQWu26EZ4Xjy4ByUknvPiDH1YDBS4TzsNytHIuXX1B6blsnyBb9+zcw9wTYgzBP9ywV8MOkr6BIgz/fBBmdYVI05InkXqsWIJc08CKkStL0f5lJpJ9T78Xv7YdXOTBIGVOPglccqgBFp8DZDd5JhLe+hv/5LxSKESxdNXPkJEz2gLcdPHcr3C+mgn+nW+EUXfxJ2Ge2lNh0VdSbKOVg3XCELeaXn/49zNXgn7fAW2WwzWLwl0LRem8hcNkINJB9Lzt9qyQQJvzJYJjZGfoKk2wPaf+F/e10tYzkIs6LTXbZxb/q0FMwWTzd/06XLjsqP6fiW1XUJH0v6rtjxB65aTiLvwk+T4xgn97QCV8Hm24DZzvIvQO2CH2bcsIx8CZwnIbyriZ9d2fIHAB/7ggPxIAtCN4oeLUMBoh1TbGyKfr5spZvR5zZHz6/Q/39Pe7qYRad/N/j1TrCl0NhwXXg6Aox18GUm+Fjr5KkjbFEHJ/k9odEsSHfRTkfF6k9pRjuOALlurPpscdbtiVVpP/ys/D+t5DuhnQ/9IsF2yn4h19t4ZwW8iV49XW1KFgIWAiEETCxvvDDXzwUpVQZuu/pkOrF9pVy/2c4sg4Kw25v0jF3gL7iRESDPWdgwuVIgaYZgbmusv3wVYcydVzxvZotbDsB5eeUzl40GaKGkRmAeO+RhcIYGSY7wECT5cvy02CLhuA5yBqse1OSLY367iBznk2FRaffQHPSVNQWPxdvQ7LL5Vk37O8IeTJ4iQOooBoMxW2i+CWRfGVxe6BpB9J+2WF0k3Lhty9JeWeSbZWjvrt09nvc8D/nwf4tBGVwlHUDmQVFqfWXcYfV4D7hKjxZXboUVgwLgf+bCLQNJt8Ae1mATQ9AVj+11VGYauEpcHRRg4FIhW8dhWUXYNcg2HgE9sSp7Y3JJWH78/XcBTbII3Rbq/ToofBF2FujFhrlPr47rD4Hc0+BrQPs9YHsJU89AvHxMPM0jPsK8m4DKaaok0KOm36CV30w8BawnYX0r2GjEBSnJ8ZMIZThL//voVug/Ag8K4vGNtj/IyT6IdkDK/pC4X8gWVRYIvFfNGHzI7x6ARZ0gVc8MLdMYSwDr68Fg+sDt8KCEnD0a7CF8nt44TTYO0LFKXi2MyzoZvkv/eV7hpXjtYxA22PyF9UujXn9YWQH8FXDAPEOdR1k/UFviqBy6rBJVDaiWhH/sD/AszY1MDgk2kWY+3UzTRcF99tgxufhOM6ukCNb+s7DnDII3gAhqfUcrD0DL/ggxglZ3SE6FoJHYPtZWNwOxn0JpR1hVhR4u8Kj18PeKLVl8x6ZcVyA1OPhvH7pkOxpH3ccht4Eh3uAnAze6Vc7hkT1JY5TAjZIPQaF56Hvd3CfR3k6ktnKkBvh/o7wig0W91L734N+mKu7B2y2PlFgb6AYlPIk/wfuvxkOdVeL48s9sNZW/2xDs3StlxYCFgKXRMCyJ39JiKwIFgIWAhYCv10EGshXv92KWCW3ELAQsBCwEGiMgMXkG2NiPbEQsBCwELhmELCY/DXTlFZFLAQsBCwEGiNgMfnGmFhPLAQsBCwErhkELCZ/zTSlVRELAQsBC4HGCLRdJl8LVfphHJ/pUI65Cv8ogzSz0xDd8uOe7yHlqDq0ZI7/S4TlsFRov7zsM4+QoWz1vK8EjINfEqXkKIw9Ca98Ba80YaCr6kf4WLcFH4Gs9chCwELAQiAiAm2HyV+EP30edgIiB6KSj4Mwtz+VtNChhF4bW1e4Xw4fNTE4RETiCh8eOQ6TDI4tduUPK0uK/3BDsslhR7Pk9XJPcECpWM3Ur5BNnM+Vs42U/8DOU2rgSyuEnp9BT3EKYnjlMBJZvxYCFgIWAiYE2sxhqIAYHBP7NMKYO8D7Yps8AHefBr8Gk4vA3g5G9oGc6+Gpr2H/OfC5wXsTZN+krBpK+lfFAtcFZU/+HcMUrqnSrRasBb+cYtVPzsrhoG0B8MmpWw38PuhZqU6X5opVyEpIPQWl52FyCTwnh7nEoYYYDTsHz3aE8iC8cgPMkpOk4oTEBp+YDYGJ3fX2kDMYnP+F1FarjEXIQsBC4FpEoE0weVFh3P2lso44+XOY2QPeErMGg5W5XzHxO2GgbgNGb4UVLuWEwu+E58R65WH420Wo0pRN9Ee7wcCurW//xdwJ/nEYZogNd+Dm7+AvwuxvhGP9wFcFyedgV29TGW6CrA4wrkqZ2nWehXHHlImAQEflZGNaZ0g0mQrw6obAxMTyQCdkd4VywKlL/6GBUbc3Yy6bFbYQsBCwEBAE2oS6Jvp6ODREOdfYNQSGylH5dlAVhIoa8GnglbDJCXf3KGVATCR+bweYlQCfDIRp1ykDWPG1sOe/P68TiocSYJ8D7omHY7coe+wi1UuZPWL0SyRx8WVqOEC5DsS3avA8bDwH3W+AfybB353QPRoe6AxVfni2Irye4NCdc4hlzZzuIC7zEuOU85H438PQGkg9EVn/b3VxCwELAQuBNiHJ12sGcdjhgsIy2O6B/UDpBSj/D7zVHubdqkz8Vp2BIiARSDsB88Tglh/ePw9/Owz3iETcFaaI3Zif8Qo5MRErmnbYcjOM+i8sP65s3ZdrKuy4ATJ7QnQtbBNra+2h9ARsk8Vlvyp3uSwan4OhXeGeG3Qja4BI8uIAWyxDJt4M84Kw/yQMOKEbCWsP2S7TbOFnrKtF2kLAQuC3h0DbY/KieugItnbKyYR4Zwqpa/qb1DXCLL3K05MzTnk4qjgLQ2OVjntbLOR0hD+dhHktNF/bGk46xGa9ww45JnVNjkld4zutTPyKquW5myB4Aao6wbwbwFsBWQlQKLbadZPKsjtHJPl/3qYYujjaED39wDMwMwHuCcIot2W18bf32VklthD45RBoW0z+J9h4FGaK5woN0kpgLSDu8946BDHtYcUfYMKPsL09/CVKWX4UP6/i21SuKnEYfRL+dAEGusBwgnEpSMVJx6N6JHHM3dJL3NaJmdxltbCgA3h0Z9eitgm5yDM8MPWGbSfhfgfs/w76xiqb7OKCT+LuqVBmicV51S6pj36J3XqxA+85C4UXYUUf+EsXWP4NrBA10A3Qt00o3YwSW78WAhYCbQmBy2BnP1+xAz9C8hFAHEqINN4R3m8HmaJjNyR588JrR8jtCiWyAtng8sr+9ABEx8PiKNjmh2kmptkget3tlTjp2HMEltfAAzfCtG4Q7QPnjfCJSZI3L7zO7Kf08ZMaOtq4oIqxNwh5iVD4rTi3hTnl4AX+Vg1Db4CZDoiPgvhbwPGFsv2ePdhS1dQ1ohWwELAQaIRAm2Dy0V3gnTtMZZNtiRqkf6kcboi+ek+JchjStyds6q5c8ZWYkpRUwbMnYY8GM2+E908r36zb7C1j8iZSLQ4+0E+piowEom73noZRYqP+JyivhVFnlNORzAQYKgp8YxFWHI0E4dUTynGG83dw/w+wU1wLVikvTDm3wrhqyDVvoTwPb1WC+NMWR+cv/AccThhp2pFjlMf6tRCwELAQaBNMPmIziE6+H0wLrWyGY4if0UiXOPUe0hOyYtVgMNQNqT7IuiVS7J/vmSMG8iIshIbcBDbIVhZTK9pD1iB4oBP4/JByBHyxkCj1jLBovE08TXWEnNthZDvY+B/l6OOdhJarphoUw7q1ELAQuIYRsJyGXMONa1XNQsBCwEKgCbnYAsZCwELAQsBC4FpAwGLy10IrWnWwELAQsBBoAgGLyTcBjPXYQsBCwELgWkDAYvLXQitadbAQsBCwEGgCAYvJNwGM9dhCwELAQuBaQKDNMvmS48qRRnMgl5yCCtlT38JLbNRvNDsZkS2MVZD+fdMEfCajaE3HAoP2x0fgqTOw5wTsOQ9Sj5TqCClrIa0Y3jLtm48Q65p+ZDlCuaab16pcG0GgzTL5luDj+x7mVKqY//gSun2q/np/BvLXrRBKTINAaVXYKUkoVS288F+gozIt0CjPi5BaBjvFdsFFmFQIe5pwRBLTEfafBokqtuwlXmIHKD0LjgZ7/Rvlcx7Gfgq9C2Gw6a9bcf3yN0r3Mz4ImX8uboBXK+TXao5QgspMxJEG7VFxEnp/2YRVTn1gFWcr3T6HI6a+cTVV81VD75Kw5dCroVUvbS0sK2n9NuBHGNsURvUK0PSN0T/M31dTscWD21jDsU5TkdrI82b7zyXKuOdL5chH+NC2ECNonEAMK75S3UT/bBy9VZ60mcNQgTNwtxwE0qsldtIFp946E5fHcsJ00w2K4c6Rzi+ORsRszSk4eDtkl8GeW2C9mDGogfu+UsSkQ4qtl0Kx/X4SnqqGBX0g+lvYEw27usDGMqi4BTJMJhCkwUs6Q5Yw6YbM5BtI+QHe6QcxFyHtuDrhmnpeHWqKbw+eSgjUwN6v4C0pShQsSYCZ4kHqW9gvpog9ynSwmFV453YYaAy74inLfKRXx+U3/9MKjlCkPVPcMMEF/S6nB0dBZhKs9sPdR38DSF5UFlintHJR5aS1R2tlohY5HvgDnJTvtrhpMMS8ePxRGHcGcvsq+1VNx26dNwZLaR1qV0El+gY4dCcc1/92OWCIM3wvz0MMXvLoAJvuALGxnh0DQ7op++pNZR9tgwldwdcBZnaD0h+Uwa/Ub2FJb+heC0O7KU9SddJdENK8MNOpTtCaaR/5BiZ9A4tv0d91gPW3w+quaoSe4ISZcZAlDj66wJd3wqE+ENMVZnYCMYCW2BlkPHF0UjTEN+ykYiXJiyTQ+xCUdwibHDbn/4uFa+Hj46pMPQsh3eyaUBjt5zCgEAYUw5xvTNLJRVhXpt7JzGRseX21muEIRd6lVKmBMJIjlIj1vAjL3RDfG2ZdHzFGyKTEs1/CAJnRfQH/aEKqaphaVHdjC9WMasAX8IrJp67YV3qqRNEULOrV10zoPDxVDE+dMj9sOrznaHj2dncZfGyo72pg7CHYfwHG/a9y9yh9zrhkFiv9RWZ/vYvrqyFltjT4C/i4Gu6TGe2nYReVVdUwQGwinYVbxYXkZ7DOVM+PT8Dd0qaFSkiq+x6AwhMw+DMY/DmkfWdqb6NQzfwGz8GcL9QM++6v9P5wEZ4qhGXiP8K4zkNKIWxswtexEU1+Q+0l30wxDPg8jEFIGi+r70f5yAkY8BX4foT7PoenpH9+Dq+cgLHFMMnsRvMnaKr/NNdHzGVrLvxAb5h5Huaa2rO5+Ff7rs0weXHb5xMp2Pi7qJxuiMMN8zNzhUUP/tdzkHEjlBgfhzmCEb4OEkUl0xnEYqWtPZRXqg8ovQzk43rhLIwU9Y0wslp4xQ17f1Jepgwy8vytYzDuW1idAA8ZaphaEFPFy4Gs3yl3fzFnYdu34NVVAhV+iOmsGxOzwZTuMLADPPB76N4OQpJ8EhwarJyn/F3CA5sfvOrK9TMFxCXj/s7wyVD4xAmvHAurj96vgEAcHB4KhxPB8YOayUhR5CN79TqV7lASzAP2mxjt1ThCqaiG96+DxTKja+LynwO7Ew6LYNAJ/toSpyo1MOcETBkAx4eCCBnpR3SVjsy8joDfAZ/fCcf6qxnYRhNzDBVF+sHX4Pk9ZOpWUZsoYuhxaIbphxxpaxFYxOaSwfA6wYcJ0Lcj7BoGJ++Ed3ro1Gph7X/AdrNe1t/DWvGHrL8WoSYmCH/1wurb4dRd8E539bJ7LHwSD/aucOxORXdhF/XOdwpSTsHqQXBY2u0nmCGuNOX6EVKrYMntcOgOmCIuK/VXLfkR38ViHvt4Etx/DtJkEOwA86TO34YHDN8PUChC2aVsMV2EdA9MSwDpY5/0BlmjE01AvHiFkxm00edqYfv3cH9PJVCJ056ht8KKKHjhIvzdBRWnweDzTfaf5vpIS0Aw4kTBNCdUoV0QaQAAC4tJREFUiHahgYbAiNKav5cz2W3NfOvT0h1gv69bYwzUKvPCEunu78JTGltnyL1N3cvHnnwMqq6HjSLZ9VEGu2La6aR15mrw4dJq6CsdvQa8HWHabTCvwRAnqhUx9SvSzgu1yl69UVDfWWU6WBZ63xmoGLTxTtQwj96qLGauPQEL7BBvV3bw4zW9s52FvjfXpQgFpJ7CFPY4QCT55GIluYtp5cJi1SHjHfBOS+0l1yd/9XftYF6sGpjib4SBJ5T6YKBN2fsvPwV7OsMDXSCjXzg7W0cQhvH+GZhwA0zpG34noatxhFL4HThlYKxPst6dLRqm6VL+PQ7guJIc+zVob3Mi0ZWWd4JHdYYXYhTitOYC9LsI7/8Ez4mlUUl0PbyTpGZkZhoilb8q6r/4llkGDfkHEF/EpyBG8O0J4gr4klcUZAyGgF6f+Bsg5jslUIjHNPGqJj6GE8VwnfEBXJIoFFZB927KKY9Ef/RmSD+h1Jgx56DKBvfr9ARXh+76sgWk6fs7GKlzm2kxkHwaArEw8CaI/loxO3n/cRX0FWurlyIapb4VGSCG3gQDb4D1xsBvg790hhe+h2k91EzxfU25zpTvX/qn9GFfR/WditAXI76Ta9U311T/iWmuj1wGzlK1aHEOJH4xxFGQSUV8qWpfyfu2weSjYMVAWCE1kIp/BenipDsKul8Pu/oq8I0KChMe54FHxbfrOdjTEf4pjXoBhupOQoSBBqMg9CGhXAWKEbOSH0EYlq0GJn1dX42ADXISVEffdSM8Kxxfl0xFehcpIcfVgMFLhPNKhVAqlicvKOuXtk6QLfr3b2DuCbAHYV5XRS+0+PgVFGnw55sgozNMioY8kdxrlS5eJKahzTAlRall/2WHzzixWQzYusInUscWJBW1Up1hNfF+pdvrl6QPucB7ApaXQXIU/PlmyOyhmFv37pBzAZ49BqkX4J7fQ1ZvZSZZ0l6xI5RaNch0v8QHZZNyG/UTZiBO1Y37Jn59ImDIx268FwcwUeAR09U/KYZq9CWJ0tDngEh/qeeg702XoWLrArl9lP+Du49B/PWwug88cIn6Sf5HqpSkHpopao2l6uh28EBoRDIqdOlfn/Tfb6G3MSUAgjJgi8Ak+HQwDV7tL6OegN3kvEeYrKwLhK4uMLM9vOqHkV3h1QD85cZLl1UEq8z+SppPPgSBaFhyi3LAI6kf6AnLZYDqAT7p+yLdG9+TDIJGFsIjjLD+22T/aaaPhAk2INbUbRQMbA+GYNtUtNZ4blS7NWhdPQ1Rh7jhhQ6QdSMk3gR/EV310fBUVDIRaeOTwTCzs/qoMtpD2n9hfztdLSORNPVhGo05bwAMPQWTT8O036nBRCT6XUPVVFnUJH1FRSRpO4B4eTKu+Jvg80QY2tAqpLE74zrYdBs420HuHbBF6NuUOWSRVBxiPlhs5esdPbozZA6AP3eEB2LAFgRvFLwqesJDsPe8WrwZXNY6O0DEAfjnd6i/T/q3jMFL3UWFJoNl6BJJR7A3esx1MKsvfHInfOkCjwfq1BdRMDJeSbv/HQSJfkg1bSM1HKGImWWxmV8RpRyhpH8D+8WWfjOOUOztwlN7vWSNfoJ6WY1yB9up9Y9GEU0PYqSj/BRe+JeFdmGgfYWxiacuXdIzkvjEd6+BjTT3dbAvEWKqYaOhcjEiN/MrM4ZNA+HkEFjcEeYcNZWhqXQ/wlyPWnj+5A7Y51Kz2Kait/S5Q5zJ96i/DnbyDsUcRdoVTMRbWei60IJyGnEBvz5Ll0fiEU12oxnXozdBoReOyHfSGUaaBgQjTqRf8Q2d8Qc4PAzeccALx8I7kaLt8IA4G/oBtomqSGZ0Lbya6j/N9ZEWkg5Hq1VY1mkewm9aPWR8sq1O+HIJysgu+vFngVyXkqKExqwBMC0Ao0rgH8ZijEiVppKL6mXaj2AzjdbiRDuou9ELlaUD9JWOqsGeMyC7d1p8mWYE5jSyJ36Ovse+4ns1W9h2AuaegdVOJSGIGkaYozC2kEQkBDrAwC5hCaL8NMgUUTpX1mClQz0+EOJbS18ng9Z1+p9p8DLXJWJYg1el8CLBywfYEYbo203XfRlemOzeFZzCDPU2KTyudjBJuuhOuh19uZHZkyz6nVOOULw2mNlTSfgjxRFKlZrGL745jE0oc+NfFAztBOU+E7Mx3pl+ZZFvr95X9osU1yU8izBFqxfsboe+NbBTZ9BHvoNym66y6wQT2sNGfTFVdOmy82mb0R+FyQvGXSDrZvibO7x2US+TBjei0vqTwdQ7wFDpE7oaIhRVwhfV7FDufXp/kJmFzHITdQlmTxV4ZObagH6Tt1HKeY1xxsSgOzAWvKfgYz0f2WDw1EmFtbRx96COay2877307Micv/Tx0HbLWtjpJ6S+MSTo7qKqOgf/8y3cc5NpNmUm0DAs+vEvdZ12FPTtqtIZQp1I+jIjED/R73dogY7fRL+p/tNsHzGlb1HwIuyVWe6l1h5aRKz5SJfzyTdP6Sreivpi3FcQHwe79MWRut2DUTAvARKFef4biv4AKxrsqpAF2PQAZIleWBZwZSfAKXB00TuMzBCOwrILsGsQbDwCe+KUri65RJ+6iSrgp0tUQkZfQ3qTRqoBkX7kiu8Oq8/B3FPqg9/rU4tmqUcgPh5mnlZ1zLsNpJhCJyQV/aQY6cBbwHZWuQDcKARrW8YoVO4/z3/xtRv/Pdx9Qkmts2TLos7Ip8TCnK/hWcEjSn2csnNIrkQHBN3K2bjcO+3Kzr/Eu1pHKEN7Am4oFH1zE73XIV7DjsHaGqVueO42NWjIWYq5okfWt+eO+l+loskeBA91gk23qJmFrMeISmF1v/DgsLgfpLmh9wlV3wmiGtD196rW6n98D1j8vVLR7TP59zXHMcIxMXBPldrNIs9EUnyun2mAs8E8Wds5BKkoxhhSXXaFBZ0h5d+qj025Gf78A8w5Arv0NSsjj0i/wlSnnYThUv92MKE35Igfhm6Q7Ye/HlICiagcBYMQM+4Cz8WqbzC9I0z4/+2dMWhTURSGvy61xWI7SLuY0hQaGknRPULFpUOnBCw4KAoROri1uOkiDoqDQwaho4PQzbEdCkKHjsFaxRZSLBWkmyDVkFDleFPfE9Ka0Fu5af+3BB6P806++95/7zk5N+c8jOw2st7g3B5kzsFTK3uuQG8fzMdTMp0uKp/69nfrywaWolPdcKMbCiU3uVmkkR+OpWSAlKXO3kL/UBM5/sgyBz0/HPKMWLHB+LZbPNpku1SCmQ7IpWK/FcTusWWLiLOQ+w8iH8z/yVsVja029w/LI8+cgUV7qeuHrYrpjF6C9S338I+ZoA67l842pqTL7rriRcjb1P4drpdheiRKmdhq7GoZ5kbhdyRXg7sf4eHlei7cNs6UIJuBvPm1B89X4dGfeBUSPfAyDWM1KKxBpQ8eJGBgF55Ylc5X2OmH4gB01dzksnMB7nfAxHvXn3bBmnd/gswQLH2ARBKyFnFU4d4mFC9FwrrPoZ0/f9ik8QVWYt2uXq26RiiPk1EjlBdVOKgRyvIGzP6E16nmU0/tzOw0+L6+CbeAf02MLbGwtOc7uJ2ByZi2tGTjGC427ZnagFwa7pwmkT8GljJ5UglY43Nrm1iDZ8kWN0SdVCbt/L0qcHMNsmmY9ih6ljYsVOGNbVgMhI9Vcc1+hmuDh+zz8OxrMCt5z99L5kRABNqAgEXjVrl2JQFz9eqsI7ttkXXJVd1ZpN3sD7lHvm+gBiTygQ6M3BIBERABHwRiNSo+zMmGCIiACIhASAQk8iGNhnwRAREQAc8EJPKegcqcCIiACIREQCIf0mjIFxEQARHwTEAi7xmozImACIhASAQk8iGNhnwRAREQAc8EJPKegcqcCIiACIREQCIf0mjIFxEQARHwTEAi7xmozImACIhASAQk8iGNhnwRAREQAc8EJPKegcqcCIiACIRE4BeYNhcbvnSkmQAAAABJRU5ErkJggg==" alt="Alt text">&lt;/p></description></item><item><title>ç”¨C++å®ç°ä¸€ä¸ªé€šç”¨çš„sortå‡½æ•°</title><link>https://wizmann.top/posts/a-common-sorting-function-with-cpp/</link><pubDate>Sat, 25 Apr 2015 11:17:01 +0000</pubDate><guid>https://wizmann.top/posts/a-common-sorting-function-with-cpp/</guid><description>&lt;h2 id="é—®é¢˜">é—®é¢˜ &lt;a href="#%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”¨C++å®ç°ä¸€ä¸ªå°½å¯èƒ½é€šç”¨çš„sortå‡½æ•°&lt;/p>
&lt;h2 id="åˆ†æ">åˆ†æ &lt;a href="#%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸€ä¸ªé€šç”¨çš„sortå‡½æ•°åº”è¯¥åŒ…å«ä»¥ä¸‹è¦ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¡®å®å¯ä»¥æ’åº(LOL)&lt;/li>
&lt;li>å¯ä»¥åº”å¯¹C-style arrayå’ŒC++-style containerçš„æ’åºéœ€æ±‚&lt;/li>
&lt;li>å¯ä»¥åº”ç”¨äºä»»æ„random access container&lt;/li>
&lt;li>å¯ä»¥ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ’åºå‡½æ•° / ä»¿å‡½æ•° / lambdaå‡½æ•°&lt;/li>
&lt;/ul>
&lt;h2 id="å®ç°">å®ç° &lt;a href="#%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸ºäº†ä¸stdä¸­çš„é€šç”¨å‡½æ•°åšåŒºåˆ«ï¼Œè¿™é‡Œçš„å‘½åè§„åˆ™ï¼ŒåŒ…æ‹¬ç±»å‹ä¸å‡½æ•°ï¼Œéƒ½åœ¨å‰é¢åŠ äº†&amp;quot;my&amp;quot;ä»¥ç¤ºåŒºåˆ«ã€‚å¯èƒ½ä¸æ ‡å‡†çš„å‘½åæ³•æœ‰å‡ºå…¥ï¼Œæ‰€ä»¥ä»…åšç¤ºä¾‹ç”¨ã€‚&lt;/p>
&lt;h3 id="æ€è·¯">æ€è·¯ &lt;a href="#%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>** æ‹·è´ä»£ç æ˜¯æ„šè ¢çš„è¡Œä¸ºã€‚**&lt;/p>
&lt;p>æˆ–è€…è¯´ï¼Œ&lt;/p>
&lt;p>** å¯¹äºåŒä¸€é’Ÿå®ç°ï¼Œå°½é‡ä½¿ç”¨åŒä¸€ä»½ä»£ç ã€‚ **&lt;/p>
&lt;p>æ„Ÿè°¢C++ Templatesï¼Œå¯¹äºä¸åŒç±»å‹ä¸éœ€æ±‚çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆå¤šä»½ä»£ç çš„åŠ³åŠ¨æ”¾å¿ƒçš„äº¤ç»™ç¼–è¯‘å™¨ã€‚å¹¶ä¸”ï¼ŒTemplatesçš„ä»£ç ç”Ÿæˆæ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆçš„ï¼Œå³ä¸ä¼šé€ æˆé¢å¤–çš„ä»£ç è†¨èƒ€ï¼ˆå¦‚æœä½ å§¿åŠ¿æ­£ç¡®çš„è¯ï¼‰ï¼Œä¹Ÿä¸€èˆ¬ä¸ä¼šé€ æˆé¢å¤–çš„è¿è¡Œæ—¶å¼€é”€ã€‚&lt;/p>
&lt;h3 id="å‡½æ•°åŸå‹">å‡½æ•°åŸå‹ &lt;a href="#%e5%87%bd%e6%95%b0%e5%8e%9f%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬æ¨¡ä»¿std::sortæ¥è¿›è¡Œå¼€å‘ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>template&amp;lt; class It, class Compare &amp;gt;
void sort(It first, It last, Compare comp );
&lt;/code>&lt;/pre>&lt;h3 id="ä»è¿­ä»£å™¨æŒ‡é’ˆè·å¾—å…ƒç´ ç±»å‹">ä»è¿­ä»£å™¨/æŒ‡é’ˆè·å¾—å…ƒç´ ç±»å‹ &lt;a href="#%e4%bb%8e%e8%bf%ad%e4%bb%a3%e5%99%a8%e6%8c%87%e9%92%88%e8%8e%b7%e5%be%97%e5%85%83%e7%b4%a0%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬è¦å¤„ç†Cé£æ ¼çš„æ•°ç»„ä¸C++ç½‘ç»œçš„å®¹å™¨ã€‚é¦–å…ˆè¦ä»è¿­ä»£å™¨/æŒ‡é’ˆ&lt;code>It&lt;/code>ä¸­è·å¾—å…ƒç´ ç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> It&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">myiter_traits&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">typename&lt;/span> It&lt;span style="color:#f92672">::&lt;/span>value_type value_type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">myiter_traits&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">*&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">typedef&lt;/span> T value_type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå®ç°éå¸¸ç®€å•ï¼Œä¸åšèµ˜è¿°ã€‚&lt;/p>
&lt;h3 id="å®ç°mysortå‡½æ•°">å®ç°mysortå‡½æ•° &lt;a href="#%e5%ae%9e%e7%8e%b0mysort%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> RandomAccessor, &lt;span style="color:#66d9ef">typename&lt;/span> FUNC&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> mysort(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> RandomAccessor&lt;span style="color:#f92672">&amp;amp;&lt;/span> head,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> RandomAccessor&lt;span style="color:#f92672">&amp;amp;&lt;/span> tail,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FUNC cmp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (tail &lt;span style="color:#f92672">-&lt;/span> head &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> RandomAccessor pivot &lt;span style="color:#f92672">=&lt;/span> mypartition(head, tail, cmp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysort(head, pivot, cmp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysort(pivot &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, tail, cmp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>mysortå‡½æ•°æœ¬ä½“å¹¶ä¸éš¾ç†è§£ï¼Œè¿™é‡Œé‡ç‚¹è®¨è®ºä¸€ä¸‹æ¨¡æ¿çš„æ€è·¯ã€‚&lt;/p>
&lt;p>ç”±äºè¿­ä»£å™¨ä¸éœ€è¦ç§»åŠ¨ï¼Œæ‰€ä»¥å£°æ˜ä¸ºconst referenceã€‚åˆç”±äºæˆ‘ä»¬éœ€è¦å…¼å®¹å„ç§ä¸åŒç±»å‹çš„æ’åºæ–¹æ³•ï¼ˆå‡½æ•°ã€ä»¿å‡½æ•°ã€lambdaã€std::functionç­‰ï¼‰ï¼Œæ‰€ä»¥ä¸å¯¹&lt;code>FUNC&lt;/code>ç±»å‹è¿›è¡Œé™åˆ¶ï¼Œå³æ‰€æœ‰å¯ä»¥è¢«callçš„ç±»å‹éƒ½å¯ä»¥åšä¸ºæ¨¡æ¿å‚æ•°ã€‚&lt;/p>
&lt;h3 id="å®ç°mypartitionå‡½æ•°">å®ç°mypartitionå‡½æ•° &lt;a href="#%e5%ae%9e%e7%8e%b0mypartition%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¿«é€Ÿæ’åºçš„çµé­‚å°±æ˜¯å¿«é€Ÿåˆ’åˆ†ã€‚å¦‚æœå¤„ç†å¾—å½“ï¼Œquick sortå¯ä»¥è§†ä½œä¸€ä¸ªç¨³å®šçš„æ’åºå‡½æ•°ï¼›å¦åˆ™ï¼Œä¸€ç»„æ„é€ ï¼ˆä¸å¿…è¦ç²¾å¿ƒæ„é€ ï¼‰çš„æ•°æ®å°±å¯ä»¥æŠŠquick sortå˜æˆ&amp;quot;slow sort&amp;quot;ã€‚&lt;/p>
&lt;h4 id="å¯èƒ½ä¼šä¸Šquick-sorté€€åŒ–çš„æ•°æ®">å¯èƒ½ä¼šä¸Šquick sorté€€åŒ–çš„æ•°æ® &lt;a href="#%e5%8f%af%e8%83%bd%e4%bc%9a%e4%b8%8aquick-sort%e9%80%80%e5%8c%96%e7%9a%84%e6%95%b0%e6%8d%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>åŸºæœ¬ä¸€è‡´çš„æ•°æ® &lt;br>
e.g. &lt;code>1, 1, 1, 1 ... 1, 1&lt;/code> or &lt;code>1, 1, ... 2, 2, ... 3, 3&lt;/code>&lt;/li>
&lt;li>æœ‰åºæˆ–åŸºæœ¬æœ‰åºçš„æ•°æ® &lt;br>
e.g. &lt;code>1, 2, ... 5, 6&lt;/code> or &lt;code>6, 5, ... 2, 1&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="è§£å†³æ€è·¯">è§£å†³æ€è·¯ &lt;a href="#%e8%a7%a3%e5%86%b3%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¯¹äºæœ‰å¤§é‡é‡å¤çš„æ•°æ®ï¼Œæˆ‘ä»¬åœ¨å¤„ç†æ—¶è¦æ³¨æ„å¹³å‡åˆ†é…è¿™äº›é‡å¤æ•°æ®ã€‚å³ï¼Œå¯¹äºä¸pivotç›¸ç­‰çš„æ•°æ®ï¼Œå°½é‡ä¿è¯ä¸€åŠæ”¾åœ¨å·¦é¢ï¼Œä¸€åŠæ”¾åœ¨å³é¢ã€‚&lt;/p>
&lt;p>å¯¹äºæœ‰åºæˆ–åŸºæœ¬æœ‰åºçš„æ•°æ®ï¼Œæˆ‘ä»¬åœ¨pivotçš„é€‰æ‹©ä¸Šå¯ä»¥ä½¿ç”¨éšæœºã€ä¸‰å€¼æ³•ç­‰æ‰‹æ®µï¼Œä¿è¯æ•°æ®çš„å¹³å‡åˆ†é…ã€‚&lt;/p>
&lt;p>æ€»çš„è¯´æ¥ï¼Œquick sortçš„é«˜æ•ˆæ€§ï¼Œå–å†³äºpartitionå‡½æ•°çš„å¹³å‡åˆ†é…æ€§èƒ½ä¸Šã€‚&lt;/p>
&lt;h4 id="ä¸€ä¸ªå®ç°">ä¸€ä¸ªå®ç° &lt;a href="#%e4%b8%80%e4%b8%aa%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> RandomAccessor, &lt;span style="color:#66d9ef">typename&lt;/span> FUNC&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RandomAccessor mypartition(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> RandomAccessor&lt;span style="color:#f92672">&amp;amp;&lt;/span> head,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> RandomAccessor&lt;span style="color:#f92672">&amp;amp;&lt;/span> tail,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FUNC cmp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> dis &lt;span style="color:#f92672">=&lt;/span> distance(head, tail);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RandomAccessor pivot &lt;span style="color:#f92672">=&lt;/span> head &lt;span style="color:#f92672">+&lt;/span> rand() &lt;span style="color:#f92672">%&lt;/span> dis;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iter_swap(pivot, head);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pivot &lt;span style="color:#f92672">=&lt;/span> head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RandomAccessor l &lt;span style="color:#f92672">=&lt;/span> head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> RandomAccessor r &lt;span style="color:#f92672">=&lt;/span> tail &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> lt &lt;span style="color:#f92672">=&lt;/span> cmp(&lt;span style="color:#f92672">*&lt;/span>l, &lt;span style="color:#f92672">*&lt;/span>pivot);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> gt &lt;span style="color:#f92672">=&lt;/span> cmp(&lt;span style="color:#f92672">*&lt;/span>pivot, &lt;span style="color:#f92672">*&lt;/span>l);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> eq &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">!&lt;/span>lt &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (lt &lt;span style="color:#f92672">||&lt;/span> (eq &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ptr &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">^=&lt;/span> (eq&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> lt &lt;span style="color:#f92672">=&lt;/span> cmp(&lt;span style="color:#f92672">*&lt;/span>r, &lt;span style="color:#f92672">*&lt;/span>pivot);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> gt &lt;span style="color:#f92672">=&lt;/span> cmp(&lt;span style="color:#f92672">*&lt;/span>pivot, &lt;span style="color:#f92672">*&lt;/span>r);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> eq &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">!&lt;/span>lt &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (gt &lt;span style="color:#f92672">||&lt;/span> (eq &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ptr &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">^=&lt;/span> (eq&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(&lt;span style="color:#f92672">*&lt;/span>l, &lt;span style="color:#f92672">*&lt;/span>r);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iter_swap(pivot, r);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¸»å‡½æ•°">ä¸»å‡½æ•° &lt;a href="#%e4%b8%bb%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> srand(time(NULL));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec({&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">1999&lt;/span>});
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysort(vec.begin(), vec.end(), less&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> i: vec) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>, i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> array[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">99&lt;/span>, &lt;span style="color:#ae81ff">19&lt;/span>, &lt;span style="color:#ae81ff">9999&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysort(array &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, array &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [](&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b)&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#66d9ef">bool&lt;/span> { &lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">&amp;gt;&lt;/span> b; });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>, array[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Beauty-of-Programming 2015 Qualification Round Tutorial</title><link>https://wizmann.top/posts/beauty-of-programming-2015-qualification-round/</link><pubDate>Sat, 25 Apr 2015 00:54:08 +0000</pubDate><guid>https://wizmann.top/posts/beauty-of-programming-2015-qualification-round/</guid><description>&lt;h2 id="a-2æœˆ29æ—¥-feb-29th">A. 2æœˆ29æ—¥ (Feb. 29th) &lt;a href="#a-2%e6%9c%8829%e6%97%a5-feb-29th" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="description">Description &lt;a href="#description" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Given a starting date and an ending date. Count how many Feb. 29th are between the given dates.&lt;/p>
&lt;h3 id="solution">Solution &lt;a href="#solution" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>The easiest way, of course, the brute force, which is quite simple with Python using the &lt;code>datetime&lt;/code> lib.&lt;/p>
&lt;p>However, it&amp;rsquo;s not an effective way for the problem.&lt;/p>
&lt;p>Let simplify the problem. &amp;ldquo;How many Feb. 29th from year A to year B?&amp;rdquo; Actually, it&amp;rsquo;t not a hard one. But there is a pitfall. Loot at this.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>yearA &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2001&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yearB &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2017&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cnt &lt;span style="color:#f92672">+=&lt;/span> (yearB &lt;span style="color:#f92672">-&lt;/span> yearA) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cnt &lt;span style="color:#f92672">-=&lt;/span> (yearB &lt;span style="color:#f92672">-&lt;/span> yearA) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cnt &lt;span style="color:#f92672">+=&lt;/span> (yearB &lt;span style="color:#f92672">-&lt;/span> yearA) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print cnt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems OK, but a little bit weird, right? But, opps, it absolutely wrong.&lt;/p>
&lt;p>For example,&lt;/p>
&lt;pre tabindex="0">&lt;code>2001 -&amp;gt; 2002 -&amp;gt; 2003 -&amp;gt; @2004@ -&amp;gt; 2005 (year = 5, lear_year = 1)
@2000@ -&amp;gt; 2001 -&amp;gt; 2002 -&amp;gt; 2003 -&amp;gt; @2004@ (year = 5, leap_year = 2)
&lt;/code>&lt;/pre>&lt;p>The right way is using a &lt;code>ceil&lt;/code> way to adjust yearA to the nearest greater leap year.&lt;/p>
&lt;p>And then we deal with other details to make everything right.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cmath&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string months[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;January&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;February&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;March&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;April&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;May&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;June&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;July&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;August&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;September&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;October&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;November&amp;#34;&lt;/span> ,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;December&amp;#34;&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Date&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint yy, mm, dd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date(llint iyy, string imm, llint idd)&lt;span style="color:#f92672">:&lt;/span> yy(iyy), dd(idd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">12&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (imm &lt;span style="color:#f92672">==&lt;/span> months[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mm &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint &lt;span style="color:#a6e22e">year_diff&lt;/span>(llint a, llint b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">&amp;gt;=&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint aa &lt;span style="color:#f92672">=&lt;/span> (a &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint bb &lt;span style="color:#f92672">=&lt;/span> (b &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (aa &lt;span style="color:#f92672">&amp;lt;=&lt;/span> bb) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> (bb &lt;span style="color:#f92672">-&lt;/span> aa) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> aa &lt;span style="color:#f92672">=&lt;/span> (a &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">99&lt;/span>) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bb &lt;span style="color:#f92672">=&lt;/span> (b &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (aa &lt;span style="color:#f92672">&amp;lt;=&lt;/span> bb) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">-=&lt;/span> (bb &lt;span style="color:#f92672">-&lt;/span> aa) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> aa &lt;span style="color:#f92672">=&lt;/span> (a &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">399&lt;/span>) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bb &lt;span style="color:#f92672">=&lt;/span> (b &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (aa &lt;span style="color:#f92672">&amp;lt;=&lt;/span> bb) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> (bb &lt;span style="color:#f92672">-&lt;/span> aa) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">is_leap&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> Date&lt;span style="color:#f92672">&amp;amp;&lt;/span> d) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (d.yy &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> d.yy &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) &lt;span style="color:#f92672">||&lt;/span> (d.yy &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">400&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint &lt;span style="color:#a6e22e">solve&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> Date&lt;span style="color:#f92672">&amp;amp;&lt;/span> da, &lt;span style="color:#66d9ef">const&lt;/span> Date&lt;span style="color:#f92672">&amp;amp;&lt;/span> db) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> year_diff(da.yy &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, db.yy &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (da.yy &lt;span style="color:#f92672">&amp;lt;&lt;/span> db.yy &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> is_leap(da) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> da.mm &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (da.yy &lt;span style="color:#f92672">&amp;lt;&lt;/span> db.yy &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> is_leap(db) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (db.mm &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">||&lt;/span> (db.mm &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> db.dd &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">29&lt;/span>))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (da.yy &lt;span style="color:#f92672">==&lt;/span> db.yy &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> is_leap(da) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> da.mm &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (db.mm &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">||&lt;/span> (db.mm &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> db.dd &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">29&lt;/span>))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string mm, temp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> yy, dd, cas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(T);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (T&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date a, b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(mm &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> dd &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> temp &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> yy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">=&lt;/span> Date(yy, mm, dd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(mm &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> dd &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> temp &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> yy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b &lt;span style="color:#f92672">=&lt;/span> Date(yy, mm, dd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;Case #%d: %lld&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, cas&lt;span style="color:#f92672">++&lt;/span>, solve(a, b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-å›æ–‡å­—ç¬¦åºåˆ—palindrome-subsequences">B. å›æ–‡å­—ç¬¦åºåˆ—(Palindrome Subsequences) &lt;a href="#b-%e5%9b%9e%e6%96%87%e5%ad%97%e7%ac%a6%e5%ba%8f%e5%88%97palindrome-subsequences" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="description-1">Description &lt;a href="#description-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Given a string, try to count how many subsequences there are palindromes.&lt;/p>
&lt;p>For example, for the string &amp;ldquo;aba&amp;rdquo;, the palindrome subsequences are: &amp;ldquo;a&amp;rdquo;, &amp;ldquo;a&amp;rdquo;, &amp;ldquo;aa&amp;rdquo;, &amp;ldquo;b&amp;rdquo;, &amp;ldquo;aba&amp;rdquo;.&lt;/p>
&lt;h3 id="solution-1">Solution &lt;a href="#solution-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Let&amp;rsquo;s simplify the problem. (Of course, the simple one always comes the first.)&lt;/p>
&lt;blockquote>
&lt;p>How many substring there are palindromes?&lt;/p>&lt;/blockquote>
&lt;p>This one is a more populare problem which can be solved with an &lt;code>O(n^2)&lt;/code> DP algorithm.&lt;/p>
&lt;pre tabindex="0">&lt;code>dp[i][j] = (str[i] == str[j] &amp;amp;&amp;amp; dp[i - 1][j - 1])
&lt;/code>&lt;/pre>&lt;p>If &lt;code>dp[i][j]&lt;/code> equals to one, it means that the substring &lt;code>str[i:j + 1]&lt;/code> is a palindrome, vice versa.&lt;/p>
&lt;p>For this problem, things are quite similar. If there are some palindrome subsequences at &lt;code>str[i - 1: j]&lt;/code>, and at the same time &lt;code>str[i] == str[j]&lt;/code>, that is, there must be one or more palindrome subsequences at &lt;code>str[i:j + 1]&lt;/code> and these subsequences contain &lt;code>str[i]&lt;/code> and &lt;code>str[j]&lt;/code>.&lt;/p>
&lt;p>That is the basic idea of the problem, and the DP formula is like this. You can consider why.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (str[i] &lt;span style="color:#f92672">!=&lt;/span> str[j]):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[i][j] &lt;span style="color:#f92672">=&lt;/span> dp[i][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> dp[i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][j] &lt;span style="color:#f92672">-&lt;/span> dp[i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[i][j] &lt;span style="color:#f92672">=&lt;/span> dp[i][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> dp[i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][j] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Be ware, the result need to be module by 100007. As we have minus in the DP formula, don&amp;rsquo;t forget there are possibility that &lt;code>dp[i][j] &amp;lt; 0&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// This is actually the solution for HDU 4632, which is similar to this problem.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1234&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MOD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">10007&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> dp[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string word;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">do_mod&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ((value &lt;span style="color:#f92672">%&lt;/span> MOD) &lt;span style="color:#f92672">+&lt;/span> MOD) &lt;span style="color:#f92672">%&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(dp, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(dp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[i][i] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">+&lt;/span> j &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l &lt;span style="color:#f92672">=&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> r &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (word[l] &lt;span style="color:#f92672">==&lt;/span> word[r]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">=&lt;/span> do_mod(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][r] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">=&lt;/span> do_mod(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][r] &lt;span style="color:#f92672">-&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][r &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> dp[&lt;span style="color:#ae81ff">0&lt;/span>][n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> T, cas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(T);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (T&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(word);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> n &lt;span style="color:#f92672">=&lt;/span> word.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;Case %d: %d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, cas&lt;span style="color:#f92672">++&lt;/span>, solve() &lt;span style="color:#f92672">%&lt;/span> MOD);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cåŸºç«™é€‰å€base-station-locationing">C.åŸºç«™é€‰å€(Base Station Locationing) &lt;a href="#c%e5%9f%ba%e7%ab%99%e9%80%89%e5%9d%80base-station-locationing" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="description-2">Description &lt;a href="#description-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Given a N Ã— M grid which contain A user and B communications companies, and &lt;strong>one single&lt;/strong> base station.&lt;/p>
&lt;p>The cost of communication between users and base station is defined as the square of the Euclidean distance.&lt;/p>
&lt;p>The cost for the companies to maintain the base station is defined as the minimal Manhattan distance between the station and all the communications companies.&lt;/p>
&lt;h3 id="solution-2">Solution &lt;a href="#solution-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>All we have to do is to find the minimal distance with that formula.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/611be1334aab00954c56e31af0bc0cc4" alt="Alt text">&lt;/p>
&lt;p>It&amp;rsquo;s easy to see that we can deal with the x-axis and y-axis separately&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/2bffa65945d689235e602935d782256b" alt="Alt text">.&lt;/p>
&lt;p>We can learn something from the quadratic equation like formula. And of course, we minimum value is near &lt;code>sum(xa[i]) / A&lt;/code>. This is same with the y-axis. As a result, we can check the grid near &lt;code>&amp;lt;sum(xa[i]) / A, sum(ya[i]) / A&amp;gt;&lt;/code>, to see if there is a minimum cost for the communication.&lt;/p>
&lt;p>I don&amp;rsquo;t want to write the code here because it&amp;rsquo;s easy if you know the basis of the algorithm and it&amp;rsquo;s too late now. I&amp;rsquo;m gonna to have a diet pepsi, and say good night for all you guys.&lt;/p>
&lt;p>Lazy guy, indeed. :)&lt;/p></description></item><item><title>GCJ Qualification Round 2015 é¢˜è§£</title><link>https://wizmann.top/posts/gcj-qualification-round-2015-tutorial/</link><pubDate>Sun, 12 Apr 2015 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/gcj-qualification-round-2015-tutorial/</guid><description>&lt;h2 id="å‰è¨€">å‰è¨€ &lt;a href="#%e5%89%8d%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ç¯‡æ—¥å¿—ç”¨ä¸­æ–‡å†™æ˜¯å› ä¸ºæƒ³çœç‚¹æ—¶é—´æ‰“æ¸¸æˆã€‚ã€‚ã€‚ï¼ˆè¯·é„™è§†æˆ‘å§ã€‚ã€‚ã€‚&lt;/p>
&lt;h2 id="a-standing-ovation">A. Standing Ovation &lt;a href="#a-standing-ovation" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="é¢˜æ„">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™æ˜¯ä¸€ä¸ªéª—æŒå£°çš„æ•…äº‹ã€‚&lt;/p>
&lt;p>å½“æ¼”å‡ºç»“æŸåï¼Œè§‚ä¼—ä»¬è¦ç«™èµ·æ¥é¼“æŒã€‚ä½†æ˜¯æœ‰äº›è§‚ä¼—æ¯”è¾ƒç¾æ¶©ï¼Œåªæœ‰åœ¨kä¸ªäººç«™èµ·æ¥é¼“æŒåæ‰ä¼šæ•…éšœã€‚&lt;/p>
&lt;p>ä½ çš„ç›®æ ‡æ˜¯åœ¨è§‚ä¼—ä¸­å®‰æ’ä¸€äº›å§åº•é¢†æŒï¼Œè®©æ‰€æœ‰è§‚ä¼—éƒ½ç«™èµ·æ¥é¼“æŒã€‚ï¼ˆè‡­ä¸è¦è„¸ï¼‰&lt;/p>
&lt;p>æ±‚æœ€å°‘çš„å§åº•æ•°ã€‚&lt;/p>
&lt;h3 id="æ•°æ®è§„æ¨¡">æ•°æ®è§„æ¨¡ &lt;a href="#%e6%95%b0%e6%8d%ae%e8%a7%84%e6%a8%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>æŠ›å¼€æ•°æ®è§„æ¨¡è°ˆè§£é¢˜ï¼Œéƒ½æ˜¯TMè€æµæ°“ã€‚ â€”â€” Wizmann&lt;/p>&lt;/blockquote>
&lt;p>100ç»„æ•°æ®ã€‚&lt;/p>
&lt;p>å°æ•°æ®é›†ï¼Œè§‚ä¼—ç¾æ¶©å€¼çš„èŒƒå›´ï¼š0 â‰¤ Smax â‰¤ 6.&lt;/p>
&lt;p>å¤§æ•°æ®é›†ï¼Œè§‚ä¼—ç¾æ¶©å€¼çš„èŒƒå›´ï¼š0 â‰¤ Smax â‰¤ 1000.&lt;/p>
&lt;h3 id="è§£é¢˜">è§£é¢˜ &lt;a href="#%e8%a7%a3%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ¬é¢˜æ¯”è¾ƒç®€å•ã€‚æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯æš´åŠ›æšä¸¾ï¼Œå› ä¸ºå¤§æ•°æ®é›†ä¸­ï¼Œè§‚ä¼—ç¾æ¶©å€¼æœ€å¤§åªä¸º1000,å³æœ€å¤§å®‰æ’å§åº•æ•°ä¸è¶…è¿‡1000ã€‚(å½“ç„¶ï¼ŒäºŒåˆ†ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡å¯¹äº1000çš„æ•°æ®é›†ï¼ŒçœŸå¿ƒæ²¡å•¥å¿…è¦ã€‚)&lt;/p>
&lt;p>äºŒæ˜¯O(N)çš„ä¸€ä¸ªéå†ï¼Œåœ¨è§‚ä¼—ç¾æ¶©çš„ä¸æƒ³é¼“æŒæ—¶ï¼Œå®‰æ’ç›¸åº”æ•°é‡çš„å§åº•ã€‚&lt;/p>
&lt;p>æœ¬é¢˜æ¨èæ–¹æ³•ä¸€ã€‚å› ä¸ºä¸ªäººæ„Ÿè§‰ï¼Œåœ¨ç¼–ç¨‹ç«èµ›ä¸­ï¼Œåœ¨æ—¶é™å’Œç©ºé—´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©æ–¹æ³•ç®€å•åŒ–ã€‚è¿™æ ·ä¸å®¹æ˜“å‡ºé”™ã€‚ä½†æ˜¯åœ¨è¦ä½“ç°é€¼æ ¼çš„æ—¶å€™ï¼Œå°½é‡â€œä¼˜åŒ–â€ä½ çš„ä»£ç ï¼Œæå‡æ€è€ƒå¤æ‚åº¦æ¥æ¢å–å°½å¯èƒ½å¤šçš„ä¼˜åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (n, aud) &lt;span style="color:#f92672">=&lt;/span> raw_input()&lt;span style="color:#f92672">.&lt;/span>split()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> n &lt;span style="color:#f92672">=&lt;/span> int(n)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> aud &lt;span style="color:#f92672">=&lt;/span> map(int, aud)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stand &lt;span style="color:#f92672">=&lt;/span> aud[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> u &lt;span style="color:#f92672">=&lt;/span> aud[i]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> u:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> i &lt;span style="color:#f92672">&amp;gt;&lt;/span> stand:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> i &lt;span style="color:#f92672">-&lt;/span> stand
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stand &lt;span style="color:#f92672">=&lt;/span> i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stand &lt;span style="color:#f92672">+=&lt;/span> u
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>T &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(T):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;Case #&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">: &lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> (i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, solve())
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-infinite-house-of-pancakes">B. Infinite House of Pancakes &lt;a href="#b-infinite-house-of-pancakes" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="é¢˜æ„-1">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸€ä¸ªå®´ä¼šå…ä¸­ï¼ˆæƒ³åˆ°äº†â€œç±³é˜¿çš„å®´ä¼šå…â€)ï¼Œæœ‰æ— é™çš„å®¢äººï¼Œä½†æ˜¯åªæœ‰æœ‰é™çš„ç…é¥¼ã€‚ä½ çš„ç›®æ ‡æ˜¯è®©æ‰€æœ‰å®¢äººå°½å¯èƒ½å¿«çš„åƒå®Œæ‰€æœ‰çš„ç…é¥¼ã€‚&lt;/p>
&lt;p>æ¯ä¸ªå®¢äººåœ¨ä¸€ä¸ªå•ä½æ—¶é—´åªèƒ½åƒä¸€å—ç…é¥¼ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå•ä½æ—¶é—´å†…ï¼Œè°ƒæ•´ä¸€ä¸ªå®¢äººçš„ç…é¥¼ï¼Œå³æŠŠä»–çš„ç…é¥¼ç»™åˆ«äººã€‚&lt;/p>
&lt;p>æ±‚æ‰€æœ‰å®¢äººåƒå®Œæ‰€æœ‰ç…é¥¼çš„æ—¶é—´ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&amp;lsquo;Here comes Mia, daughter of none!&amp;rsquo; &lt;br>
&amp;ndash; &lt;em>The Dark Tower V: Wolves of the Calla&lt;/em>&lt;/p>&lt;/blockquote>
&lt;h3 id="æ•°æ®è§„æ¨¡-1">æ•°æ®è§„æ¨¡ &lt;a href="#%e6%95%b0%e6%8d%ae%e8%a7%84%e6%a8%a1-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>100ç»„æµ‹è¯•æ•°æ®ã€‚&lt;/p>
&lt;p>Dä¸ºæœ‰ç…é¥¼çš„å®¢äººçš„æ•°ç›®ã€‚Piä¸ºå®¢äººæ‹¥æœ‰ç…é¥¼çš„æœ€å¤§å€¼ã€‚&lt;/p>
&lt;p>å°æ•°æ®ï¼š &lt;br>
1 â‰¤ D â‰¤ 6.&lt;br>
1 â‰¤ Pi â‰¤ 9.&lt;/p>
&lt;p>å¤§æ•°æ®ï¼š &lt;br>
1 â‰¤ D â‰¤ 1000.&lt;br>
1 â‰¤ Pi â‰¤ 1000.&lt;/p>
&lt;h3 id="è§£é¢˜-1">è§£é¢˜ &lt;a href="#%e8%a7%a3%e9%a2%98-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸€å¼€å§‹æƒ³ç”¨äºŒåˆ†åšã€‚ä½†æ˜¯è¿™é“é¢˜å¹¶ä¸èƒ½æ»¡è¶³äºŒåˆ†çš„æ¡ä»¶ã€‚å› ä¸ºæ— è®ºæ˜¯äºŒåˆ†æ—¶é—´è¿˜æ˜¯äºŒåˆ†æœ€å¤§ç…é¥¼æ•°ï¼Œå®¢äººéƒ½å¯ä»¥åƒå®Œç…é¥¼ï¼Œè¿™æ ·çš„äºŒåˆ†æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚&lt;/p>
&lt;p>æ¢ä¸ªæ€è·¯ï¼Œåœ¨åƒç…é¥¼å‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å®¢äººçš„ç…é¥¼æ•°è¿›è¡Œè°ƒæ•´ã€‚åˆç”±äºå®¢äººçš„æ•°ç›®æ˜¯æ— é™å¤šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è°ƒæ•´å°±æ˜¯&lt;strong>æŠŠç…é¥¼é€ç»™æ²¡æœ‰ç…é¥¼çš„å®¢äºº&lt;/strong>ã€‚è°ƒæ•´çš„ç›®æ ‡æ˜¯&lt;strong>è®©ç…é¥¼æ•°å°½é‡å¹³å‡&lt;/strong>ï¼ˆâ€œå°½é‡â€å’Œâ€œå°½å¯èƒ½â€æ˜¯ä¸åŒçš„ï¼Œâ€œå°½é‡â€çš„èŒƒå›´æ›´å®½èŒƒä¸€äº›ï¼‰ã€‚&lt;/p>
&lt;p>äºæ˜¯ï¼Œæˆ‘ä»¬å°è¯•æšä¸¾â€œè°ƒæ•´åçš„æœ€å¤§ç…é¥¼æ•°é‡â€ã€‚é€šè¿‡æšä¸¾è¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°â€œè°ƒæ•´ç…é¥¼æ—¶é—´ + åƒç…é¥¼æ—¶é—´â€ã€‚åˆç”±äºæ•°æ®è§„æ¨¡æ¯”è¾ƒå°ï¼Œæèµ·æ¥ä¸æ˜¯å¾ˆå›°éš¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;set&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">233&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> T, a, cas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(T);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (T&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.clear();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> SIZE &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">233&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> step &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> maxi &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> num: vec) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (num &lt;span style="color:#f92672">&amp;gt;&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">+=&lt;/span> num &lt;span style="color:#f92672">%&lt;/span> i&lt;span style="color:#f92672">?&lt;/span> num &lt;span style="color:#f92672">/&lt;/span> i: num &lt;span style="color:#f92672">/&lt;/span> i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> maxi &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> maxi &lt;span style="color:#f92672">=&lt;/span> max(maxi, num);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> min(ans, step &lt;span style="color:#f92672">+&lt;/span> maxi);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;Case #%d: %d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, cas&lt;span style="color:#f92672">++&lt;/span>, ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-dijkstra">C. Dijkstra &lt;a href="#c-dijkstra" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="é¢˜æ„-2">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç»™ä½ ä¸€ä¸ªä»£æ•°ç³»ç»Ÿï¼ˆå¯ä»¥è¿™ä¹ˆè¯´å§ï¼‰ï¼ŒåŒ…æ‹¬â€œ1, i, j, kâ€ã€‚&lt;/p>
&lt;p>å·²çŸ¥å®ƒä»¬çš„è¿ç®—è§„å¾‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/ba89abba98064a7e42e52e9e5b2de57f" alt="Alt text">&lt;/p>
&lt;p>ç°åœ¨ï¼Œæœ‰ä¸€ä¸ªåŒ…å«&amp;quot;i, j, k&amp;quot;çš„è¿ä¹˜å¼ã€‚å®ƒæ˜¯ç”±ä¸€æ®µè¿ä¹˜å¼é‡å¤Xéå¾—å‡ºçš„ã€‚&lt;/p>
&lt;p>é—®ï¼Œèƒ½å¦æŠŠå®ƒè½¬åŒ–ä¸º&lt;code>i * j * k&lt;/code>çš„å½¢å¼ã€‚&lt;/p>
&lt;h3 id="æ•°æ®è§„æ¨¡-2">æ•°æ®è§„æ¨¡ &lt;a href="#%e6%95%b0%e6%8d%ae%e8%a7%84%e6%a8%a1-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æµ‹è¯•ç»„æ•°ï¼š 1 â‰¤ T â‰¤ 100. &lt;br>
ç»™å‡ºçš„è¿ä¹˜å¼é•¿åº¦ï¼š 1 â‰¤ L â‰¤ 10000.&lt;/p>
&lt;p>è¿ä¹˜å¼çš„é‡å¤æ¬¡æ•°ä¸ºXã€‚&lt;/p>
&lt;p>å°æ•°æ®é›†ï¼š &lt;br>
1 â‰¤ X â‰¤ 10000. &lt;br>
1 â‰¤ L * X â‰¤ 10000.&lt;/p>
&lt;p>å¤§æ•°æ®é›†ï¼š&lt;br>
1 â‰¤ X â‰¤ 10^12. &lt;br>
1 â‰¤ L * X â‰¤ 10^16.&lt;/p>
&lt;h3 id="è§£é¢˜-2">è§£é¢˜ &lt;a href="#%e8%a7%a3%e9%a2%98-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é¢˜ä¸­ç»™å‡ºäº†ä¹˜æ³•çš„è§„å¾‹ã€‚æˆ‘ä»¬ä¸éš¾ä»ä¸­æ¨æµ‹å‡ºé™¤æ³•çš„è§„å¾‹ã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬å·²ç»æŠŠè¿ä¹˜å¼è½¬åŒ–ä¸º&lt;code>i * j&lt;/code>çš„å½¢å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŠŠå‰©ä¸‹çš„éƒ¨åˆ†è½¬åŒ–ä¸ºæ•°å­—&lt;code>k&lt;/code>ï¼Œå³å¯æ»¡è¶³é¢˜æ„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å»æ€è€ƒè½¬åŒ–çš„è¿‡ç¨‹ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€†å‘æ€è€ƒï¼Œå»æ€è€ƒè½¬åŒ–åçš„ç»“æœã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œ&lt;code>i * j * k == -1&lt;/code>ï¼Œå½“æˆ‘ä»¬æŠŠå‰è¾è½¬åŒ–ä¸º&lt;code>i * j&lt;/code>çš„å½¢å¼åï¼Œå¦‚æœåˆ¤æ–­æ•´ä¸ªè¿ä¹˜å¼çš„ç»“æœä¸º&lt;code>-1&lt;/code>ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ–­å®šï¼Œè¯¥è¿ä¹˜å¼å¯ä»¥è½¬åŒ–ä¸º&lt;code>i * j * k&lt;/code>çš„å½¢å¼ã€‚&lt;/p>
&lt;p>iä¸jçš„è½¬åŒ–æ˜¯ç±»ä¼¼çš„ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼ŒO(N)çš„ç®—æ³•æ˜¯æ— æ³•é€šè¿‡å¤§æ•°æ®é›†çš„ã€‚å› ä¸ºï¼Œè¿ä¹˜å¼æ˜¯å¾ªç¯çš„ï¼Œæ€»é•¿åº¦å¯èƒ½ä¼šéå¸¸é•¿ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç»§ç»­ä½¿ç”¨åŒæ ·çš„æ€è·¯ã€‚å¦‚æœæˆ‘ä»¬æœ‰äº†iå’Œjï¼Œå½“æ•´ä½“è¿ä¹˜å¼ä¹‹ç§¯ä¸º&lt;code>-1&lt;/code>æ—¶ï¼Œå³æ–­å®šæ»¡è¶³æ¡ä»¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¿«é€Ÿå¹‚ç®—æ³•ï¼Œç›´æ¥è®¡ç®—å¾ªç¯èŠ‚çš„ä¹˜ç§¯ã€‚å¤æ‚åº¦ä¸º&lt;code>O(L) + O(logX)&lt;/code>ã€‚&lt;/p>
&lt;p>å¯¹äºiå’Œjï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è€ƒè™‘ã€‚å¾ªç¯èŠ‚ä¹‹ç§¯åªæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š&lt;code>Â±1, Â±i, Â±j, Â±k&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/252e0e81143f2dd5cb6e01e1e69d0709" alt="the table">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¯¹äº&lt;code>1, i, j, k&lt;/code>ï¼Œä¹˜æ³•éƒ½æ˜¯æœ‰ä¸€ä¸ªå¾ªç¯èŠ‚çš„ã€‚è¿™é‡Œä¸éœ€è¦å®šé‡åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ–­å®šï¼Œå¦‚æœåœ¨ä¸€å®šçš„å¾ªç¯èŠ‚ä¸­ï¼Œä¸èƒ½æŠŠç®—å¼è½¬åŒ–ä¸º&lt;code>i * j&lt;/code>çš„å½¢å¼ï¼Œé‚£ä¹ˆå°±ä¸å¯èƒ½è½¬åŒ–ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define error(x) cerr &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">12345&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ONE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> II &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JJ &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> KK &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> trans[&lt;span style="color:#ae81ff">5&lt;/span>][&lt;span style="color:#ae81ff">5&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#ae81ff">0&lt;/span>, ONE, II, JJ, KK},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#ae81ff">0&lt;/span>, II, &lt;span style="color:#f92672">-&lt;/span>ONE, KK, &lt;span style="color:#f92672">-&lt;/span>JJ},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#ae81ff">0&lt;/span>, JJ, &lt;span style="color:#f92672">-&lt;/span>KK, &lt;span style="color:#f92672">-&lt;/span>ONE, II},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#ae81ff">0&lt;/span>, KK, JJ, &lt;span style="color:#f92672">-&lt;/span>II, &lt;span style="color:#f92672">-&lt;/span>ONE}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">conv&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> ONE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;i&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> II;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;j&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> JJ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;k&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> KK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Number&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sign;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number(&lt;span style="color:#66d9ef">char&lt;/span> c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sign &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> conv(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number(&lt;span style="color:#66d9ef">int&lt;/span> isign, &lt;span style="color:#66d9ef">int&lt;/span> ivalue)&lt;span style="color:#f92672">:&lt;/span> sign(isign), value(ivalue){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> Number&lt;span style="color:#f92672">&amp;amp;&lt;/span> num) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> num.sign &lt;span style="color:#f92672">*&lt;/span> sign;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> trans[value][num.value];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (b &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">*=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b &lt;span style="color:#f92672">=&lt;/span> abs(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> Number{a, b};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string _word;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string word;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> L, X;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">get_whole&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number num(&lt;span style="color:#e6db74">&amp;#39;1&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> c: _word) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> num &lt;span style="color:#f92672">*&lt;/span> Number(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number ans(&lt;span style="color:#e6db74">&amp;#39;1&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> X;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (x &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> ans &lt;span style="color:#f92672">*&lt;/span> num;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> num &lt;span style="color:#f92672">*&lt;/span> num;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">&amp;gt;&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans.sign &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> and ans.value &lt;span style="color:#f92672">==&lt;/span> ONE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> T, cas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(T);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (T&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(L &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> X);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(_word);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> word &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> min(X, &lt;span style="color:#ae81ff">19LL&lt;/span>); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> word &lt;span style="color:#f92672">+=&lt;/span> _word;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Number num(&lt;span style="color:#e6db74">&amp;#39;1&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> ii &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> jj &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> kk &lt;span style="color:#f92672">=&lt;/span> get_whole();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> word.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> num &lt;span style="color:#f92672">*&lt;/span> word[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (num.sign &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> num.value &lt;span style="color:#f92672">==&lt;/span> II) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ii &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (ii &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> num.sign &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> num.value &lt;span style="color:#f92672">==&lt;/span> KK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> jj &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> kk &lt;span style="color:#f92672">=&lt;/span> (kk &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ii &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> jj);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;Case #%d: &amp;#34;&lt;/span>, cas&lt;span style="color:#f92672">++&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(kk&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#e6db74">&amp;#34;YES&amp;#34;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;NO&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>19&lt;/code>æ˜¯ä¸€ä¸ªmagic numberã€‚è¿˜æœ‰ï¼Œå°å¿ƒ&lt;del>Dandelo&lt;/del>æ•°æ®è¶…intã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/625c5bb804b76545978bcb11310099a6" alt="Alt text">&lt;/p>
&lt;h2 id="d-ominous-omino">D. Ominous Omino &lt;a href="#d-ominous-omino" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å……æ»¡ç„å­¦çš„ä¸€é¢˜ã€‚ç½‘ä¸Šçœ‹åˆ°çš„æœ€ç²¾å½©çš„é¢˜è§£æ˜¯äººå·¥æ¨¡æ‹Ÿå‡ºäº†æ‰€æœ‰å¯èƒ½ã€‚&lt;/p>
&lt;p>æˆ‘è§‰å¾—åƒæˆ‘è¿™ç§å†…å­˜å°çš„äººï¼Œä¼°è®¡æ˜¯æƒ³ä¸å‡ºæ¥çš„ã€‚&lt;/p>
&lt;p>è²Œä¼¼ä¹Ÿæœ‰äººç”¨æ¨¡æ‹Ÿã€‚ã€‚ã€‚æˆ‘è§‰å¾—ã€‚ã€‚ã€‚å¯èƒ½ä¼šæœ‰æ›´ä¼˜é›…çš„æ–¹æ³•ã€‚ã€‚ã€‚&lt;/p>
&lt;p>é¢˜è§£åœ¨&lt;a href="http://www.huangwenchao.com.cn/2015/04/gcj-2015-qual-d.html">è¿™é‡Œ&lt;/a>ï¼ŒçœŸå¿ƒæ˜¯ç»™è·ªäº†ã€‚&lt;/p></description></item><item><title>ZeroMQå¯ç¤ºå½•</title><link>https://wizmann.top/posts/inspiration-from-zeromq/</link><pubDate>Tue, 07 Apr 2015 10:01:34 +0000</pubDate><guid>https://wizmann.top/posts/inspiration-from-zeromq/</guid><description>&lt;h2 id="Ã¸mqæ˜¯ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿ">Ã˜MQæ˜¯ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿ &lt;a href="#%c3%b8mq%e6%98%af%e4%b8%80%e4%b8%aa%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ZeroMQæ˜¯ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œæ¶ˆæ¯ä¸­é—´ä»¶â€ã€‚å®ƒè¢«å¹¿æ³›çš„ç”¨äºç»æµã€æ¸¸æˆã€åµŒå…¥å¼ç­‰é¢†åŸŸã€‚&lt;/p>
&lt;h3 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯ç³»ç»Ÿ">ä»€ä¹ˆæ˜¯æ¶ˆæ¯ç³»ç»Ÿ &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ‰“ä¸ªæ¯”æ–¹ï¼Œæ¶ˆæ¯ç³»ç»Ÿå°±åƒæˆ‘ä»¬ä½¿ç”¨çš„IMè½¯ä»¶ä¸€æ ·ã€‚é¦–å…ˆï¼Œä¸€æ–¹å†³å®šå°†æ¶ˆæ¯å‘å¾€ä½•å¤„ï¼ˆä¸€å¯¹ä¸€æˆ–ä¸€å¯¹å¤šï¼‰ã€‚ç„¶åå°†ä¿¡æ¯æ‰“åŒ…ï¼Œç‚¹å‡»å‘é€æŒ‰é’®ã€‚ä¹‹åï¼ŒIMç³»ç»Ÿä¼šå¸®ä½ æ–™ç†å‰©ä½™çš„äº‹åŠ¡ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œå®ƒä»¬ä¹Ÿæœ‰å¾ˆå¤§çš„ä¸åŒç‚¹ã€‚IMç³»ç»Ÿå¯¹äºæ¶ˆæ¯ç³»ç»Ÿä¼¼ä¹å¤ªä½æ•ˆäº†ä¸€ç‚¹ã€‚å¦å¤–ï¼Œæ¶ˆæ¯ç³»ç»Ÿæ˜¯æ²¡æœ‰ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰çš„ã€‚åœ¨é”™è¯¯å‘ç”Ÿæ—¶ï¼Œæ¶ˆæ¯çš„å¦ä¸€ç«¯ä¹Ÿä¸ä¼šæœ‰äººæ¥æ™ºèƒ½çš„ä»‹å…¥å¤„ç†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä¸‹å®šä¹‰ã€‚æ¶ˆæ¯ç³»ç»Ÿæ˜¯å…·æœ‰é«˜æ•ˆæ€§å’Œå®¹é”™æ€§çš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="zeromqçš„èµ·æºå’Œå‘å±•">ZeroMQçš„èµ·æºå’Œå‘å±• &lt;a href="#zeromq%e7%9a%84%e8%b5%b7%e6%ba%90%e5%92%8c%e5%8f%91%e5%b1%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ZeroMQæœ€å…ˆçš„è®¾æƒ³æ˜¯å®ç°ä¸€ä¸ªç‚’é¸¡å¿«çš„ç”¨äºè¯åˆ¸äº¤æ˜“çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨è®¾è®¡åˆæœŸçš„å…³æ³¨ç‚¹å°±æ˜¯åœ¨æè‡´çš„ä¼˜åŒ–ä¸Šã€‚&lt;/p>
&lt;p>ç¬¬ä¸€å¹´çš„å·¥ä½œé‡ç‚¹ï¼Œåœ¨äºå‘æ˜æ€§èƒ½æµ‹è¯•çš„æ–¹æ³•ï¼Œå’Œè®¾è®¡é«˜æ•ˆæ¶æ„ã€‚&lt;/p>
&lt;p>ä¹‹åï¼Œå¤§çº¦åœ¨ç¬¬äºŒå¹´ï¼Œå·¥ä½œé‡ç‚¹è½¬ç§»åˆ°å®ç°ä¸€ä¸ªé€šç”¨çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œä»¥åº”ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä½¿å…¶å¯ä»¥åˆ©ç”¨&lt;strong>ä¸åŒçš„ç¼–ç¨‹è¯­è¨€&lt;/strong>ï¼Œä½¿ç”¨&lt;strong>ä¸åŒæ–¹å¼&lt;/strong>ï¼Œæ¥ä¼ é€’&lt;strong>å„ç§æ¨¡å¼&lt;/strong>çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º1ç‹¬ç«‹åº”ç”¨-vs-ç¨‹åºåº“">å¯ç¤º1ï¼šç‹¬ç«‹åº”ç”¨ vs. ç¨‹åºåº“ &lt;a href="#%e5%90%af%e7%a4%ba1%e7%8b%ac%e7%ab%8b%e5%ba%94%e7%94%a8-vs-%e7%a8%8b%e5%ba%8f%e5%ba%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ZeroMQæ˜¯ä¸€ä¸ªç¨‹åºåº“ï¼Œä¸æ˜¯ä¸€ä¸ªæ¶ˆæ¯æœåŠ¡å™¨ã€‚è¿™æ ·è®¾è®¡çš„ä¸»è¦åŸå› æ˜¯ï¼šæ€§èƒ½ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ä¸€ä¸ªä¸­é—´æ¶ˆæ¯æœåŠ¡å™¨ï¼ˆBrokerï¼‰ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åœ¨ç½‘ç»œä¸Šä¼ é€’ä¸¤æ¬¡ï¼ˆSender-&amp;gt;Broker-&amp;gt;Receiver)ã€‚è¿™æ ·çš„è®¾è®¡ä¼šå½±å“æ—¶å»¶å’Œååé‡ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œå¦‚æœæ‰€æœ‰æ¶ˆæ¯éƒ½é€šè¿‡ä¸­é—´æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å°±ä¼šæˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆã€‚&lt;/p>
&lt;p>ä½¿ç”¨ä¸­é—´æ¶ˆæ¯æœåŠ¡å™¨çš„å¦ä¸€ä¸ªå¼Šç«¯ï¼Œæ˜¯ä¸åˆ©äºå¤§è§„æ¨¡éƒ¨ç½²ã€‚å¯¹äºè¯åˆ¸äº¤æ˜“æ¥è¯´ï¼ˆZeroMQæœ€åˆçš„åº”ç”¨åœºæ™¯ï¼‰ï¼Œè·¨ç»„ç»‡çš„æ¶ˆæ¯ä¼ è¾“æ˜¯ä¸å¯é¿å…çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸­å¤®é›†æƒå¼çš„æ¶ˆæ¯ä¼ è¾“å°±ä¸åœ¨æœ‰æ•ˆäº†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç¼©å°æ¶ˆæ¯ç³»ç»Ÿçš„ç²’åº¦ï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªç¨‹åºåº“ã€‚ä½¿å…¶æ›´è½»é‡ï¼Œæ›´æ˜“äºéƒ¨ç½²ã€‚åŒæ ·ï¼Œæ›´è½»é‡çš„æ¶ˆæ¯ç³»ç»Ÿå¯ä»¥å®ç°æ›´å¤æ‚çš„æ‹“æ‰‘ç»“æ„ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šå¯¹äºä¸€ä¸ªæ–°é¡¹ç›®æ¥è¯´ï¼Œå¦‚æœå¯èƒ½ï¼Œå°½é‡æŠŠå®ƒå®ç°ä¸ºä¸€ä¸ªç¨‹åºåº“ã€‚å°†ä¸€ä¸ªæ–°åº“è”ç¼–åˆ°åŸæœ‰ç¨‹åºä¸­ï¼Œåªéœ€è¦å°‘é‡çš„äººåŠ›ï¼Œä¹Ÿæä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º2å…¨å±€çŠ¶æ€">å¯ç¤º2ï¼šå…¨å±€çŠ¶æ€ &lt;a href="#%e5%90%af%e7%a4%ba2%e5%85%a8%e5%b1%80%e7%8a%b6%e6%80%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºç¨‹åºåº“æ¥è¯´ï¼Œå…¨å±€çŠ¶æ€å¾€å¾€ä¸èƒ½æ­£ç¡®çš„å·¥ä½œã€‚&lt;/p>
&lt;p>ç”±äºä¸€ä¸ªç¨‹åºåº“å¯èƒ½è¢«ä¸€ä¸ªåº”ç”¨ç¨‹åºåŠ è½½å¤šæ¬¡ï¼Œè¿™å°±ä¸èƒ½ä¿è¯åªæœ‰ç‹¬ä¸€æ— äºŒçš„å…¨å±€çŠ¶æ€ã€‚&lt;/p>
&lt;p>ZeroMQçš„è§£å†³æ–¹æ³•æ˜¯ç”±åº“çš„è°ƒç”¨è€…æ˜¾å¼çš„ç»´æŠ¤ä¸€ä¸ªâ€œç¯å¢ƒâ€ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;code>libA&lt;/code>å’Œ&lt;code>libB&lt;/code>éƒ½æœ‰å…¶ç‹¬æœ‰çš„â€œç¯å¢ƒâ€ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/71080471bf8bbf4d4e186c353d6b512c" alt="Alt text">&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šä¸è¦åœ¨ç¨‹åºåº“ä¸­ä½¿ç”¨å…¨å±€çŠ¶æ€ã€‚å¦‚æœä½ è¿™ä¹ˆåšäº†ï¼Œå½“åº“æ°å¥½éœ€è¦åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­å®ä¾‹åŒ–ä¸¤æ¬¡æ—¶ï¼Œå®ƒå¾ˆå¯èƒ½ä¼šå´©æºƒã€‚&lt;/p>
&lt;h2 id="å¯ç¤º3æ€§èƒ½">å¯ç¤º3ï¼šæ€§èƒ½ &lt;a href="#%e5%90%af%e7%a4%ba3%e6%80%a7%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/4ae6721a94012d877709075558562f2b" alt="Alt text">&lt;/p>
&lt;p>ZeroMQåœ¨æœ€åˆè®¾è®¡æ—¶ï¼Œæ€§èƒ½è°ƒä¼˜å°±æ˜¯é¦–è¦çš„ç›®æ ‡ã€‚åšä¸ºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œå…¶æ€§èƒ½æŒ‡æ ‡ä¸»è¦æœ‰ä¸¤ä¸ªï¼šååé‡å’Œå»¶æ—¶ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆåº¦é‡å®ƒä»¬å‘¢ï¼Ÿ&lt;/p>
&lt;p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒAå‘Bå‘é€ä¿¡æ¯ã€‚Båœ¨6ç§’å†…æ¥æ”¶åˆ°äº†5æ¡ä¿¡æ¯ï¼Œå› æ­¤ååé‡ä¸º0.83æ¶ˆæ¯/ç§’ï¼Œå¹³å‡æ—¶å»¶ä¸º1.2ç§’ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬æ¢ä¸€ç§è®¡é‡æ–¹å¼ï¼ŒAå‘Bå‘é€æ¶ˆæ¯ï¼Œå¯¹äºå•æ¡ä¿¡æ¯æ¥è¯´ï¼Œå…¶å¹³å‡æ—¶å»¶ä¸º3ç§’ã€‚AèŠ±è´¹2ç§’ï¼Œå‘é€äº†æ‰€æœ‰çš„æ¶ˆæ¯ï¼›BèŠ±è´¹äº†4ç§’ï¼Œæ¥æ”¶åˆ°äº†æ‰€æœ‰çš„æ¶ˆæ¯ã€‚æ‰€ä»¥Açš„ååé‡ä¸º2.5æ¶ˆæ¯/ç§’ï¼ŒBçš„ååé‡ä¸º1.25æ¶ˆæ¯/ç§’ã€‚è¿™ä¸ªæ•°æ®ä¸æˆ‘ä»¬ä¸Šé¢å¾—å‡ºçš„æ•°æ®ç›¸å·®ç”šè¿œã€‚&lt;/p>
&lt;p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ä¸åŒçš„è®¡é‡æ ‡å‡†ï¼Œå¯¹äºæˆ‘ä»¬ä¼°è®¡ç³»ç»Ÿçš„æ€§èƒ½ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„ä¸åŒã€‚&lt;/p>
&lt;p>æ—¶å»¶åªæœ‰åœ¨ä¸¤ä¸ªèŠ‚ç‚¹é€šä¿¡æ—¶ï¼Œæ‰å¯èƒ½å‘ç”Ÿã€‚æ‰€ä»¥ï¼Œå¹¶ä¸èƒ½æœ‰â€œæŸèŠ‚ç‚¹çš„æ—¶å»¶â€è¿™ç§åº¦é‡æ ‡å‡†çš„å‡ºç°ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¤šæ¡æ¶ˆæ¯çš„æ—¶å»¶è¿›è¡Œå¹³å‡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½æœ‰â€œä¸€ä¸ªæ¶ˆæ¯æµçš„å¹³å‡æ—¶å»¶â€ã€‚&lt;/p>
&lt;p>ååé‡ï¼Œä¸æ—¶å»¶ä¸åŒï¼Œåªèƒ½åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œåº¦é‡ã€‚æ‰€ä»¥ï¼Œå¹¶ä¸èƒ½æœ‰â€œèŠ‚ç‚¹é—´çš„ååé‡â€è¿™ç§åº¦é‡æ–¹æ³•ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šæ·±å…¥äº†è§£ä½ æ‰€è¦è§£å†³çš„é—®é¢˜ã€‚å¦åˆ™ï¼Œä½ ä¼šåœ¨è§£å†³é—®é¢˜æ—¶ä¼šå¼•å…¥ï¼ˆé”™è¯¯çš„ï¼‰å‡å®šå’Œç„å­¦ï¼Œå†™å‡ºæœ‰ç¼ºé™·çš„å¤æ‚ä»£ç ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º4å…³é”®è·¯å¾„">å¯ç¤º4ï¼šå…³é”®è·¯å¾„ &lt;a href="#%e5%90%af%e7%a4%ba4%e5%85%b3%e9%94%ae%e8%b7%af%e5%be%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»£ç ä¸­ç»å¸¸è¢«è°ƒç”¨çš„ä»£ç ï¼Œè¢«ç§°ä¸º&lt;strong>å…³é”®è·¯å¾„&lt;/strong>ã€‚&lt;/p>
&lt;p>å¯¹äºZeroMQæ¥è¯´ï¼Œå»ºç«‹é“¾æ¥ä¸å†…å­˜ç”³è¯·éƒ½ä¸æ˜¯å½±å“æ€§èƒ½çš„æœ€ä¸»è¦å› ç´ ã€‚å› ä¸ºZeroMQä½¿ç”¨é•¿é“¾æ¥è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥å»ºç«‹é“¾æ¥çš„å¼€é”€å‡æ‘Šåˆ°æ¯ä¸€æ¡ä¿¡æ¯å¾®ä¹å…¶å¾®ã€‚åŒæ ·ï¼ŒZeroMQä½¿ç”¨é«˜æ•ˆçš„å†…å­˜ç»´æŠ¤æœºåˆ¶ï¼Œå°½å¯èƒ½å°‘çš„å‘ç³»ç»Ÿç›´æ¥ç”³è¯·å†…å­˜ç©ºé—´ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šåªåœ¨ç³»ç»Ÿçš„å…³é”®è·¯å¾„ä¸Šåšä¼˜åŒ–ã€‚å¦åˆ™åªæ˜¯æµªè´¹æ—¶é—´ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º5å†…å­˜ç”³è¯·">å¯ç¤º5ï¼šå†…å­˜ç”³è¯· &lt;a href="#%e5%90%af%e7%a4%ba5%e5%86%85%e5%ad%98%e7%94%b3%e8%af%b7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºä¸€ä¸ªé«˜æ•ˆçš„ç³»ç»Ÿæ¥è¯´ï¼Œé«˜æ•ˆçš„å¤„ç†å†…å­˜çš„æ–¹æ³•å¾€å¾€æ˜¯åœ¨å†…å­˜ç”³è¯·ä¸å†…å­˜æ‹·è´ä¹‹é—´å¯»æ±‚ä¸€ä¸ªå¹³è¡¡ã€‚&lt;/p>
&lt;p>å¯¹äºå°å‹æ•°æ®æ¥è¯´ï¼Œç›´æ¥æ‹·è´æ•°æ®ï¼Œå³â€œæ·±æ‹·è´â€ï¼Œçš„å¼€é”€æ›´å°ã€‚è€Œå¯¹äºå¤§å‹æ•°æ®æ¥è¯´ï¼Œæ‰€è°“â€œæµ…æ‹·è´â€çš„å¼€é”€æ›´å°ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/48deb1742653d61ba04f6e9591f71902" alt="Alt text">&lt;/p>
&lt;p>ZeroMQä½¿ç”¨é€æ˜çš„æ–¹å¼æ¥å¤„ç†ä¸¤ç§ä¸åŒçš„åœºæ™¯ã€‚å¹¶ä¸”ï¼Œå¯¹äºè§„æ¨¡è¾ƒå¤§çš„æ•°æ®ï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°çš„ç­–ç•¥ï¼Œæœ€å¤§é™åº¦çš„å¤ç”¨ä¸èŠ‚çœå†…å­˜ä½¿ç”¨ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šå½“æˆ‘ä»¬ä¼˜åŒ–æ€§èƒ½æ—¶ï¼Œä¸è¦å‡å®šåªæœ‰ä¸€ä¸ªå…¨å±€æœ€ä¼˜è§£ã€‚åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œæœ€ä¼˜è§£çš„å®šä¹‰å¯èƒ½å¤§ä¸ç›¸åŒã€‚&lt;/p>
&lt;h2 id="å¯ç¤º6æ‰¹å¤„ç†">å¯ç¤º6ï¼šæ‰¹å¤„ç† &lt;a href="#%e5%90%af%e7%a4%ba6%e6%89%b9%e5%a4%84%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºä¸€ä¸ªé«˜æ€§èƒ½æ¶ˆæ¯ç³»ç»Ÿæ¥è¯´ï¼Œç³»ç»Ÿè°ƒç”¨çš„ç»å¯¹æ•°é‡å°±æ˜¯ç³»ç»Ÿçš„ç“¶é¢ˆã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆæ™®éçš„é—®é¢˜ï¼Œæ¶ˆæ¯åœ¨è°ƒç”¨æ ˆä¹‹é—´ä¼ é€’ï¼Œä¼šå¸¦æ¥ä¸å¯å¿½ç•¥çš„æ€§èƒ½æŸå¤±ã€‚æ‰€ä»¥ï¼Œåœ¨æ„å»ºä¸€ä¸ªé«˜æ€§èƒ½ç³»ç»Ÿæ—¶ï¼Œåº”è¯¥å°½é‡é¿å…æ¶ˆæ¯åœ¨æ ˆé—´çš„ä¼ é€’ã€‚&lt;/p>
&lt;p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºå››æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªç½‘ç»œæ ˆå››æ¬¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/b99f65135b0f0e840131c58d2cc57896" alt="Alt text">&lt;/p>
&lt;p>ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™äº›æ¶ˆæ¯æ‰“åŒ…æˆä¸€æ¡æ¶ˆæ¯ã€‚æˆ‘ä»¬åªéœ€è¦éå†ç½‘ç»œæ ˆä¸€æ¬¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/cd2ea1ae7a71443b3ff85ebbc7cb1c3b" alt="Alt text">&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç­–ç•¥ä¸TCP/IPåè®®ä¸­çš„Nagleç®—æ³•ç±»ä¼¼ã€‚Nagleç®—æ³•æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œè€ŒZeroMQçš„Batchingç­–ç•¥æ˜¯ä¸ºäº†å‡æ‘Šç½‘ç»œæ ˆçš„æ—¶é—´å¼€é”€ã€‚&lt;/p>
&lt;p>å…·ä½“çš„å®ç°å¦‚ä¸‹:&lt;/p>
&lt;ul>
&lt;li>å½“æ¶ˆæ¯çš„é¢‘ç‡æ²¡æœ‰è¶…è¿‡ç½‘ç»œæ ˆçš„å¸¦å®½æ—¶ï¼ŒZeroMQä¼šæŠŠæ‰€æœ‰batchingå…³æ‰ï¼Œä»¥CPUåˆ©ç”¨ç‡æ¥æ¢å–ä½æ—¶å»¶ã€‚&lt;/li>
&lt;li>å½“æ¶ˆæ¯çš„é¢‘ç‡è¶…è¿‡ç½‘çº¿æ ˆçš„å¸¦å®½æ—¶ï¼ŒZeroMQä¼šå¯ç”¨batchingï¼Œä»¥æ—¶å»¶ä¸ºä»£ä»·æ¥ä¼˜åŒ–ååé‡ã€‚&lt;/li>
&lt;li>å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿‡å¤šæ—¶ï¼ŒZeroMQä¼šé‡‡ç”¨æ›´æ¿€è¿›çš„batchingç­–ç•¥ã€‚å› ä¸ºæ¶ˆæ¯çš„å †ç§¯é€ æˆçš„æ—¶å»¶å¢é•¿å·²ç»ä¸å¯é¿å…ï¼Œç´¢æ€§å°†æ›´å¤šçš„ä¿¡æ¯æ‰“åŒ…ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„æ¸…ç©ºæ¶ˆæ¯çš„ç§¯å‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–ï¼Œbatchingç­–ç•¥åªåº”è¯¥è¢«åº”ç”¨äºé¡¶å±‚ã€‚åœ¨é¡¶å±‚é‡‡ç”¨batchingä¹‹åï¼Œä½å±‚çš„batchingå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼š&lt;/p>
&lt;ul>
&lt;li>åœ¨ä¸€ä¸ªå¼‚æ­¥ç³»ç»Ÿä¸­ï¼Œæƒ³è¦è·å¾—æœ€ä½³çš„å“åº”æ—¶é—´ï¼Œåº”è¯¥æŠŠåº•å±‚çš„batchingç­–ç•¥è½¬ç§»åˆ°é¡¶å±‚ã€‚&lt;/li>
&lt;li>batchingåªåº”è¯¥åœ¨æ–°æ•°æ®åˆ°æ¥çš„é€Ÿåº¦è¶…è¿‡ç³»ç»Ÿå¸¦å®½æ—¶æ‰é‡‡ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¯ç¤º7æ•´ä½“æ¶æ„">å¯ç¤º7ï¼šæ•´ä½“æ¶æ„ &lt;a href="#%e5%90%af%e7%a4%ba7%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/22f7b30fb17c9a128bbb6dd66ad27a13" alt="Alt text">&lt;/p>
&lt;p>ç”¨æˆ·åˆ©ç”¨â€œsocketâ€ä¸ZeroMQè¿›è¡Œäº¤äº’ï¼Œä¸€ä¸ªsocketå¯ä»¥åŒå¤šä¸ªpeerè¿›è¡Œäº¤äº’ã€‚&lt;/p>
&lt;p>socketå­˜åœ¨äºç”¨æˆ·çº¿ç¨‹ä¸­ã€‚è€Œä¸€äº›å·¥ä½œçº¿ç¨‹ä¼šå¤„ç†å¼‚æ­¥çš„äº¤äº’è¿‡ç¨‹ï¼Œå¦‚ï¼šä»ç½‘ç»œè¯»å–æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œæ¥å—æ–°çš„è¿æ¥è¯·æ±‚ç­‰ã€‚&lt;/p>
&lt;p>sessionè´Ÿè´£ä¸ZeroMQä¸­çš„socketè¿›è¡Œäº¤äº’ï¼Œengineè´Ÿè´£ç½‘ç»œäº¤äº’ã€‚sessionåªæœ‰ä¸€ç§ï¼Œè€Œengineæ ¹æ®ä½¿ç”¨çš„åè®®ä¸åŒï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§ã€‚&lt;/p>
&lt;p>sessionä¸socketä¹‹é—´ä½¿ç”¨pipeè¿›è¡Œé€šä¿¡ï¼Œpipeè¢«å®ç°ä¸ºçº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ—ï¼Œç”¨æ¥åœ¨çº¿ç¨‹é—´ä¼ é€’ä¿¡æ¯ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šå­¦ä¹ äº†æ•´ä½“çš„è®¾è®¡æ€è·¯ï¼ˆç¬‘&lt;/p>
&lt;h2 id="å¯ç¤º8å¹¶å‘æ¨¡å‹">å¯ç¤º8ï¼šå¹¶å‘æ¨¡å‹ &lt;a href="#%e5%90%af%e7%a4%ba8%e5%b9%b6%e5%8f%91%e6%a8%a1%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é«˜æ•ˆçš„ZeroMQå¿…ç„¶è¦åˆ©ç”¨å¤šæ ¸çš„è®¡ç®—èµ„æºï¼Œè€Œä¼ ç»Ÿçš„å¤šçº¿ç¨‹æ¨¡å‹ä¼šå¼•å…¥é”ã€ä¿¡å·é‡ç­‰çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚è€Œä½¿ç”¨ç‹¬ç«‹çš„çº¿ç¨‹åˆä¼šå¼•å…¥ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚&lt;/p>
&lt;p>ZeroMQä½¿ç”¨çš„å¹¶å‘æ¨¡å‹æ˜¯Actorï¼Œå…¶ç›®æ ‡æ˜¯å®Œå…¨é¿å…é”çš„ä½¿ç”¨ï¼Œè®©æ‰€æœ‰çš„ç»„ä»¶å…¨é€Ÿè¿è¡Œã€‚&lt;/p>
&lt;p>æ¯ä¸€ä¸ªCPUæ ¸å¿ƒåªæœ‰ä¸€ä¸ªworkerçº¿ç¨‹ï¼Œæ‰€æœ‰å†…éƒ¨å¯¹è±¡éƒ½æ˜¯çº¿ç¨‹ä¸“æœ‰çš„ï¼Œè¿™æ ·å°±å®Œå…¨é¿å…äº†é”çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œè®¸å¤šå¯¹è±¡éƒ½è¦åˆ†äº«æœ‰é™ä¸ªæ•°çš„workerã€‚æ‰€ä»¥ï¼Œç³»ç»Ÿåº”å½“æ˜¯å…¨å¼‚æ­¥çš„ã€‚å› ä¸ºæ¯ä¸€ä¸ªworkerçš„é˜»å¡ï¼Œéƒ½ä¼šé˜»å¡å…¶å®ƒä½¿ç”¨workerçš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šActoræ¨¡å‹æ˜¯æè‡´è§£å†³æ€§èƒ½ä¸æ‰©å±•æ€§é—®é¢˜çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æ˜¯åœ¨ä½¿ç”¨ZeroMQæˆ–Erlangï¼Œä½ éœ€è¦æ‰‹å†™è®¸å¤šç›¸å…³çš„Test Caseæ¥æµ‹è¯•ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚å¦å¤–ï¼Œå¦‚æœä½ æ— æ³•åº”å¯¹æ¨¡å‹ä¸­çš„å¤æ‚æ¨¡å—ï¼ˆå¦‚ZeroMQçš„shutdownï¼‰ï¼Œè¯·ä¸è¦è½»æ˜“å°è¯•ä½¿ç”¨Actoræ¨¡å‹ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º9æ— é”ç®—æ³•">å¯ç¤º9ï¼šæ— é”ç®—æ³• &lt;a href="#%e5%90%af%e7%a4%ba9%e6%97%a0%e9%94%81%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ— é”ç®—æ³•ä½¿ç”¨ç®€å•çš„æ–¹æ³•è¿›è¡Œçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œè€Œä¸ä¾èµ–å†…æ ¸çº§çš„åŒæ­¥åŸè¯­ã€‚æ— é”ç®—æ³•çš„å…³é”®æ˜¯CPUä¸­çš„åŸå­æ“ä½œï¼Œä¾‹å¦‚compare-and-swapï¼ˆCASï¼‰æ“ä½œã€‚ä½†æ˜¯ï¼Œè¦è®°ä½ï¼Œæ— é”æ“ä½œå¹¶ä¸æ˜¯çœŸæ­£çš„â€œæ— é”â€ï¼Œè€Œæ˜¯æŠŠé”æ“ä½œæ”¾åˆ°äº†è¾ƒä¸ºé«˜æ•ˆçš„ç¡¬ä»¶å±‚ã€‚&lt;/p>
&lt;p>ZeroMQä½¿ç”¨ä¸€ä¸ªæ— é”é˜Ÿåˆ—åœ¨ç”¨æˆ·çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚ZeroMQä¸­çš„æ— é”é˜Ÿåˆ—æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p>
&lt;p>ç¬¬ä¸€ï¼Œæ¯ä¸€ä¸ªé˜Ÿåˆ—ä¸ºâ€œä¸€å†™ä¸€è¯»â€ã€‚å½“æœ‰ä¸€å¯¹å¤šçš„è¯»å†™éœ€æ±‚å­˜åœ¨æ—¶ï¼ŒZeroMQä¼šåˆ›å»ºå¤šæ¡é˜Ÿåˆ—ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—æˆ‘ä»¬ä¸ç”¨å…³å¿ƒå¤šçº¿ç¨‹è¯»å†™å¸¦æ¥çš„åŒæ­¥é—®é¢˜ï¼Œæœ‰åˆ©äºæˆ‘ä»¬å¯¹å…¶æ€§èƒ½çš„ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>ç¬¬äºŒï¼Œå³ä½¿æ— é”ç®—æ³•æ¯”ä¼ ç»Ÿçš„é”ç®—æ³•è¦å¿«å¾ˆå¤šï¼Œä½†æ˜¯å…¶ä»£ä»·ä»ç„¶æ˜¯è¿‡é«˜çš„ï¼ˆå°¤å…¶æ˜¯åœ¨CPUæ ¸å¿ƒä¹‹é—´çš„é€šä¿¡ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»ç„¶ä¾èµ–äºâ€œbatchingâ€ç®—æ³•ï¼Œå°†æ˜‚è´µçš„åŒæ­¥æ“ä½œå‡æ‘Šåˆ°å¤šæ¡æ¶ˆæ¯ä¸Šã€‚åœ¨ä»é˜Ÿåˆ—çœŸæ­£çš„è¯»å†™æ“ä½œä¹‹å‰ï¼ŒåŠ å…¥ä¸€æ¬¡é¢„å¤„ç†ï¼ˆpre-write / pre-readï¼‰ï¼Œå°†æ¶ˆæ¯æ‰“ä¸ªåŒ…ï¼Œå‘ç”³é€šã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/9d97e2979db40e413e43cf7d642d1570" alt="Alt text">&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šæ— é”ç®—æ³•æ˜¯éå¸¸ç²¾å·§çš„ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå°½é‡ä½¿ç”¨æˆç†Ÿçš„è®¾è®¡ã€‚å¦‚æœä½ éœ€è¦æè‡´çš„æ€§èƒ½ï¼Œä¸è¦ä»…ä»…ä¾èµ–äºæ— é”ç®—æ³•ã€‚å°½ç®¡æ— é”ç®—æ³•éå¸¸å¿«ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡batchingç­–ç•¥ä¼˜åŒ–å®ƒã€‚ï¼ˆå¦å¤–ï¼ŒåŠ é’±ä¸Šèˆ¹ä¹Ÿå¯ä»¥ã€‚ï¼‰&lt;/p>
&lt;h2 id="å¯ç¤º10apiè®¾è®¡">å¯ç¤º10ï¼šAPIè®¾è®¡ &lt;a href="#%e5%90%af%e7%a4%ba10api%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;strong>è®¾è®¡APIï¼Œå°±åƒè®¾è®¡ä¸€æ¬¾äº§å“ã€‚&lt;/strong>&lt;/p>
&lt;p>ç”¨æˆ·å¯¹äºä¸€ä¸ªç¨‹åºåº“çš„ç¬¬ä¸€æ„Ÿè§‰æ¥è‡ªäºç”¨æˆ·æ¥å£ã€‚ZeroMQç®€åŒ–äº†è‡ªå·±çš„ç”¨æˆ·æ¥å£ï¼Œå°†å…¶ç”±åŸæ¥çš„â€œç‚’é¸¡å¤æ‚ä¸€ä¸å°å¿ƒå‘æ­»ä½ çš„ä¼ä¸šçº§æ¶ˆæ¯æ¡†æ¶â€å˜ä¸ºäº†â€œæƒ³å‘æ¶ˆæ¯è°ƒç”¨ä¸‹å°±OKâ€çš„ææ˜“ä¸Šæ‰‹çš„å…¥é—¨çº§äº§å“ã€‚&lt;/p>
&lt;p>å¦å¤–ä¸€ä¸ªé‡è¦çš„æ–¹é¢ï¼ŒZeroMQä½¿ç”¨äº†å¹¿ä¸ºä½¿ç”¨çš„BSD Sockets APIã€‚è¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>è¿™æ˜¯ä¸€ä¸ªå¤§å®¶éƒ½ç†ŸçŸ¥çš„APIï¼Œå­¦ä¹ æ›²çº¿ç›¸å½“å¹³ç¼“&lt;/li>
&lt;li>ä½¿ZeroMQä¸ç°æœ‰çš„æŠ€æœ¯è¿æ¥èµ·æ¥ï¼Œæœ‰åˆ©äºå¤ç”¨å·²ç”¨çš„æ¡†æ¶ä¸è®¾è®¡&lt;/li>
&lt;li>æœ€é‡è¦çš„æ˜¯ï¼Œä½¿ç”¨ä¸€ä¸ªæˆç†Ÿä¸ä¹…ç»è€ƒéªŒçš„æ¡†æ¶ï¼Œå¯ä»¥é¿å…è¸©å‰äººè¸©è¿‡çš„å‘ã€&lt;/li>
&lt;/ul>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šé™¤äº†ä»£ç å¤ç”¨ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»¥ä¸€ç§æ›´ä¸€èˆ¬çš„æ–¹æ³•ï¼Œå¤ç”¨æˆç†Ÿçš„æŠ€æœ¯ã€‚å½“ä½ è®¾è®¡ä¸€ä¸ªæ–°äº§å“æ—¶ï¼Œå€Ÿé‰´ä¸€ä¸‹ç±»ä¼¼çš„äº§å“ï¼ˆè…¾è®¯ï¼ï¼‰ã€‚ä¸è¦çŠ¯â€œåœ¨è¿™é‡Œè¿˜æ²¡æœ‰è¢«å‘æ˜â€ï¼ˆNot Invented Hereï¼‰ç»¼åˆç—‡ã€‚å¤ç”¨ä¸€åˆ‡åˆé€‚çš„æƒ³æ³•ã€APIã€æ¡†æ¶æŠ½è±¡ã€‚å…è®¸ç”¨æˆ·ä½¿ç”¨å·²æœ‰çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®©æˆ‘ä»¬è§„é¿æœªçŸ¥çš„é£é™©ã€‚&lt;/p>
&lt;h2 id="å¯ç¤º11æ¶ˆæ¯æ¨¡å¼">å¯ç¤º11ï¼šæ¶ˆæ¯æ¨¡å¼ &lt;a href="#%e5%90%af%e7%a4%ba11%e6%b6%88%e6%81%af%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ZeroMQçš„è®¾è®¡æ€è·¯æ˜¯&lt;strong>ä¸“æ³¨äºä¸€ä¸ªé¢†åŸŸï¼ŒæŠŠå®ƒåšåˆ°æœ€å¥½&lt;/strong>ã€‚å› ä¸ºï¼Œå¤§è€Œå…¨çš„äº§å“åªèƒ½ç»™é¢†åŸŸä¸“å®¶æ¥ä½¿ç”¨ï¼Œè€Œå°è€Œç²¾çš„äº§å“çš„å—ä¼—åˆ™æ˜¯ä»»ä½•å—è¿‡è®­ç»ƒçš„ç¨‹åºå‘˜ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>s &lt;span style="color:#f92672">=&lt;/span> socket (REQ)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>s.connect (&lt;span style="color:#e6db74">&amp;#34;tcp://192.168.0.111:5555&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>s.send (&lt;span style="color:#e6db74">&amp;#34;Hello World!&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reply &lt;span style="color:#f92672">=&lt;/span> s.recv ()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“æˆ‘ä»¬è¦ç»™ç”¨æˆ·æä¾›æ›´ä¸€èˆ¬æ€§çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä¸€ä¸ªæŠ€æœ¯æ ˆï¼Œæ ˆçš„æ¯ä¸€å±‚å¯ä»¥æœ‰ä¸åŒçš„å®ç°ï¼Œä»è€Œé€‚åº”ä¸åŒäººç¾¤çš„éœ€è¦ã€‚&lt;/p>
&lt;p>è¿™å’ŒInternetæ ˆçš„è®¾è®¡æ€è·¯éå¸¸ç›¸ä¼¼ï¼šTCPå¯ä»¥è§£å†³åŸºäºé“¾æ¥çš„ã€å¯é çš„æ•°æ®æµä¼ è¾“ï¼ŒUDPå¯ä»¥è§£å†³ä¸å¯é çš„æ•°æ®åŒ…ä¼ è¾“ï¼ŒSCTPå¯ä»¥è§£å†³å¤šç”¨æˆ·æ•°æ®æµä¼ è¾“é—®é¢˜ç­‰ç­‰ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯æ­£äº¤çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶ä¸­å¥½çš„è®¾è®¡ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰é¢å¤–ä»£ä»·çš„æŠ›å¼ƒä¸å¥½çš„è®¾è®¡ã€‚&lt;/p>
&lt;p>è·å¾—çš„å¯ç¤ºï¼šå½“è§£å†³ä¸€ä¸ªå¤æ‚ä¸”å¤šé¢åŒ–çš„é—®é¢˜æ—¶ï¼Œå•ä¸ªé€šç”¨å‹çš„è§£å†³æ–¹æ¡ˆå¯èƒ½å¹¶ä¸æ˜¯æœ€å¥½çš„æ–¹å¼ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé—®é¢˜çš„é¢†åŸŸæƒ³è±¡æˆä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå¹¶åŸºäºè¿™ä¸ªå±‚æ¬¡æä¾›å¤šä¸ªå®ç°ï¼Œæ¯ç§å®ç°åªè‡´åŠ›äºè§£å†³ä¸€ç§å®šä¹‰è‰¯å¥½çš„æƒ…å†µã€‚&lt;/p>
&lt;p>å½“æˆ‘ä»¬è¿™ä¹ˆåšæ—¶ï¼Œç¡®å®šé—®é¢˜çš„ç²’åº¦éå¸¸é‡è¦ã€‚å¦‚æœç²’åº¦è¿‡ç»†ï¼Œè½¯ä»¶çš„ä¸€èˆ¬æ€§å°±ä¼šå—åˆ°é™åˆ¶ã€‚å¦‚æœç²’åº¦è¿‡ç²—ï¼Œé‚£ä¹ˆäº§å“å°±ä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ¨¡ç³Šå’Œæ··ä¹±çš„æ„Ÿè§‰ã€‚&lt;/p>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>åŸæ–‡é“¾æ¥ï¼šhttp://www.aosabook.org/en/zeromq.html&lt;/li>
&lt;li>ä¸­æ–‡ç¿»è¯‘ï¼šhttp://www.ituring.com.cn/article/4669&lt;/li>
&lt;/ul>
&lt;p>æœ¬æ–‡ä¸­å€Ÿé‰´äº†ä¸­æ–‡ç¿»è¯‘çš„éƒ¨åˆ†è¯å¥ï¼Œå¯¹æ­¤è¡¨ç¤ºæ„Ÿè°¢ã€‚&lt;/p></description></item><item><title>Codeforces Round #290 (Div. 2) Tutorial</title><link>https://wizmann.top/posts/cf-290-div-2/</link><pubDate>Wed, 18 Feb 2015 00:30:24 +0000</pubDate><guid>https://wizmann.top/posts/cf-290-div-2/</guid><description>&lt;h2 id="a-fox-and-snake">A. Fox And Snake &lt;a href="#a-fox-and-snake" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Implementation&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>(n, m) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>res &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> i &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">.&lt;/span>append(&lt;span style="color:#e6db74">&amp;#39;#&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> m)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">elif&lt;/span> (i &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">.&lt;/span>append(&lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#39;#&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">.&lt;/span>append(&lt;span style="color:#e6db74">&amp;#39;#&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> line &lt;span style="color:#f92672">in&lt;/span> res:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print line
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-fox-and-two-dots">B. Fox And Two Dots &lt;a href="#b-fox-and-two-dots" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>DFS&lt;/p>
&lt;pre tabindex="0">&lt;code>AAAA
ABCA
AAAA
&lt;/code>&lt;/pre>&lt;p>We start at arbitrary point, and traverse the neighbour point with the same color to see if there is a circle.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">54&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> mx[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> my[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> g[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> visit[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">do_dfs&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> y, &lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">char&lt;/span> c, &lt;span style="color:#66d9ef">int&lt;/span> dir) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (visit[y][x]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit[y][x] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ny &lt;span style="color:#f92672">=&lt;/span> y &lt;span style="color:#f92672">+&lt;/span> my[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nx &lt;span style="color:#f92672">=&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> mx[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nx &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> nx &lt;span style="color:#f92672">&amp;gt;=&lt;/span> m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> ny &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> ny &lt;span style="color:#f92672">&amp;gt;=&lt;/span> n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> g[ny][nx] &lt;span style="color:#f92672">!=&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">||&lt;/span> (dir &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> (dir &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (do_dfs(ny, nx, c, i)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">dfs&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> y, &lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> g[y][x];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> do_dfs(y, x, c, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(g, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(g));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(visit, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(visit));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(g[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>visit[i][j]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> dfs(i, j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;Yes&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throw&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Got it&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;No&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">catch&lt;/span> (...) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-fox-and-names">C. Fox And Names &lt;a href="#c-fox-and-names" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Topsort&lt;/p>
&lt;p>This is a classic interview problem. We can find the relationship between two letters from the given name list.&lt;/p>
&lt;p>But in this instance, there is no possible lexical order because the name list is invalid.&lt;/p>
&lt;pre tabindex="0">&lt;code>aaa
aa
a
&lt;/code>&lt;/pre>&lt;p>So the algorithm can be describe in this way:&lt;/p>
&lt;ol>
&lt;li>If the name list is invalid, there is no solution.&lt;/li>
&lt;li>Try to find the order of the letters.&lt;/li>
&lt;li>Topsort&lt;/li>
&lt;li>If topsort is success, print out the new lexical order of the name list. If failed, there is no solution.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">26&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>string&lt;span style="color:#f92672">&amp;gt;&lt;/span> names;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> g[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> in[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">makeG&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> string&lt;span style="color:#f92672">&amp;amp;&lt;/span> pre &lt;span style="color:#f92672">=&lt;/span> names[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> string&lt;span style="color:#f92672">&amp;amp;&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> names[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> min(pre.size(), now.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pre.size() &lt;span style="color:#f92672">&amp;gt;&lt;/span> now.size() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> pre.substr(&lt;span style="color:#ae81ff">0&lt;/span>, len) &lt;span style="color:#f92672">==&lt;/span> now) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> len; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pre[j] &lt;span style="color:#f92672">==&lt;/span> now[j]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> pre[j] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> now[j] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[a].push_back(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> in[b]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">top_sort&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (in[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.push(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>q.empty()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> q.front();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res.push_back(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> next: g[now]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> in[next]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (in[next] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.push(next);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> cnt &lt;span style="color:#f92672">==&lt;/span> SIZE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">print_res&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> i: res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%c&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(in, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(in));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> names.push_back(name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (makeG() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> top_sort()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print_res();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;Impossible&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-fox-and-jumping">D. Fox And Jumping &lt;a href="#d-fox-and-jumping" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Extended Euclidean algorithm&lt;/p>
&lt;p>As we might know, for every positive integer &lt;code>x&lt;/code> and &lt;code>y&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>ax + by = gcd(x, y)
&lt;/code>&lt;/pre>&lt;p>Let&amp;rsquo;s extend this theorem, for an array of positive integer &lt;code>Xs&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>As * Xs = gcd(Xs)
&lt;/code>&lt;/pre>&lt;p>(&lt;code>As&lt;/code> is an array of constants, both positive and negative)&lt;/p>
&lt;p>If &lt;code>gcd(Xs)&lt;/code> equal to one, that is, every two number of the array is co-prime.&lt;/p>
&lt;p>So, we can find a subarray that every two number is co-prime, and have the minimal cost.&lt;/p>
&lt;p>As there are not too many factors in a single number, even the number here is as large as 10^9. The &lt;code>gcd()&lt;/code> of the subarray won&amp;rsquo;t have too many results, and could be stored in a single &lt;code>unordered_map&lt;/code> here.&lt;/p>
&lt;p>And,&lt;/p>
&lt;blockquote>
&lt;p>C++ Iterator Invalidation Rules (C++03)&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Associative containers&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>[multi]{set,map}: all iterators and references unaffected&lt;/p>&lt;/blockquote>
&lt;p>Here is the rule of C++ about the behavoir of the iterators when we try to add something into the map during the iteration. So we can just use one sigle map, and avoid the complexity of moving things between to containers.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unordered_map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">500&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x3f3f3f3f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">gcd&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">%&lt;/span> b &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> gcd(b, a &lt;span style="color:#f92672">%&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Card&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> step;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cost;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Card&lt;span style="color:#f92672">&amp;gt;&lt;/span> cards;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cards.resize(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(cards[i].step);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(cards[i].cost);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> unordered_map&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> mp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> card: cards) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mp.find(card.step) &lt;span style="color:#f92672">==&lt;/span> mp.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[card.step] &lt;span style="color:#f92672">=&lt;/span> INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[card.step] &lt;span style="color:#f92672">=&lt;/span> min(mp[card.step], card.cost);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> thres &lt;span style="color:#f92672">=&lt;/span> mp.find(&lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">!=&lt;/span> mp.end()&lt;span style="color:#f92672">?&lt;/span> mp[&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">:&lt;/span> INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> p: mp) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> step &lt;span style="color:#f92672">=&lt;/span> p.first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> cost &lt;span style="color:#f92672">=&lt;/span> p.second;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (step &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> cost &lt;span style="color:#f92672">&amp;gt;=&lt;/span> thres) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> g &lt;span style="color:#f92672">=&lt;/span> gcd(step, cards[i].step);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mp.find(g) &lt;span style="color:#f92672">==&lt;/span> mp.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[g] &lt;span style="color:#f92672">=&lt;/span> INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (g &lt;span style="color:#f92672">==&lt;/span> step) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[g] &lt;span style="color:#f92672">=&lt;/span> min(mp[g], cost);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[g] &lt;span style="color:#f92672">=&lt;/span> min(mp[g], cost &lt;span style="color:#f92672">+&lt;/span> cards[i].cost);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mp.find(&lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> mp.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;-1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(mp[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="e-fox-and-dinner">E. Fox And Dinner &lt;a href="#e-fox-and-dinner" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Max Flow Algorithm&lt;/p>
&lt;p>As we know, every odd number must be connected to two even numbers. And, of course, one even number should be connected to two odd numbers.&lt;/p>
&lt;p>We use the max flow algortihm. Every odd number have a path with 2 unit of flow to the &lt;strong>source&lt;/strong> node, every even number have a path with 2 unit of flow to the &lt;strong>sink&lt;/strong> node. And if the sum of one odd number and an even number is a prime, we connect them with a path with 1 unit of flow.&lt;/p>
&lt;p>As the result, we have a undirected graph that every node have a degree of 2. It&amp;rsquo;s easy to find out that is an &lt;strong>Euler circuit&lt;/strong>. We find the circuit and print it out.&lt;/p>
&lt;p>The problem is not easy as it seems. Harsh one, indeed. I used &lt;strong>Dinic&lt;/strong> algorithm for the max flow. Actually, I don&amp;rsquo;t like my code here.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout&amp;lt;&amp;lt;x&amp;lt;&amp;lt;endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin&amp;gt;&amp;gt;x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> NODE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">19&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> EDGE &lt;span style="color:#f92672">=&lt;/span> NODE &lt;span style="color:#f92672">*&lt;/span> NODE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x3f3f3f3f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> st, end, flow, next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(&lt;span style="color:#66d9ef">int&lt;/span> ist, &lt;span style="color:#66d9ef">int&lt;/span> iend, &lt;span style="color:#66d9ef">int&lt;/span> iflow, &lt;span style="color:#66d9ef">int&lt;/span> inext)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st(ist), end(iend), flow(iflow), next(inext) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node edge[EDGE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> head[NODE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> ind;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> source,sink;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> nums;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> cnc[NODE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> visit[NODE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">addEdge&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> s,&lt;span style="color:#66d9ef">int&lt;/span> e,&lt;span style="color:#66d9ef">int&lt;/span> f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> edge[ind]&lt;span style="color:#f92672">=&lt;/span>node(s,e,f,head[s]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head[s] &lt;span style="color:#f92672">=&lt;/span> ind&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> edge[ind]&lt;span style="color:#f92672">=&lt;/span>node(e,s,&lt;span style="color:#ae81ff">0&lt;/span>,head[e]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head[e] &lt;span style="color:#f92672">=&lt;/span> ind&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">namespace&lt;/span> dinic
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> level[NODE],curhead[NODE],Que[NODE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> estack[&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">*&lt;/span>NODE&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">*&lt;/span>EDGE],estop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">BFS&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(level,&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>,&lt;span style="color:#66d9ef">sizeof&lt;/span>(level));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Que[&lt;span style="color:#ae81ff">0&lt;/span>]&lt;span style="color:#f92672">=&lt;/span>source;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> level[source]&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> fr&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>,tail&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;fr&lt;span style="color:#f92672">!=&lt;/span>tail;fr&lt;span style="color:#f92672">=&lt;/span>(fr&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">%&lt;/span>NODE)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cur&lt;span style="color:#f92672">=&lt;/span>Que[fr];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> e&lt;span style="color:#f92672">=&lt;/span>head[cur];e&lt;span style="color:#f92672">!=-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;e&lt;span style="color:#f92672">=&lt;/span>edge[e].next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next&lt;span style="color:#f92672">=&lt;/span>edge[e].end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(edge[e].flow &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> level[next] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Que[tail]&lt;span style="color:#f92672">=&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> level[next]&lt;span style="color:#f92672">=&lt;/span>level[cur]&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tail&lt;span style="color:#f92672">=&lt;/span>(tail&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">%&lt;/span>NODE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> level[sink]&lt;span style="color:#f92672">!=-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">DFS&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> indptr,minf,e;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cur&lt;span style="color:#f92672">=&lt;/span>source;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> estop&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memcpy(curhead,head,&lt;span style="color:#66d9ef">sizeof&lt;/span>(head));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span>(estop&lt;span style="color:#f92672">&amp;gt;=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(cur&lt;span style="color:#f92672">==&lt;/span>sink)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> minf&lt;span style="color:#f92672">=&lt;/span>INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>estop&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;i&lt;span style="color:#f92672">&amp;gt;=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;i&lt;span style="color:#f92672">--&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e&lt;span style="color:#f92672">=&lt;/span>estack[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(edge[e].flow&lt;span style="color:#f92672">&amp;lt;=&lt;/span>minf)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> minf&lt;span style="color:#f92672">=&lt;/span>edge[e].flow;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> indptr&lt;span style="color:#f92672">=&lt;/span>i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">+=&lt;/span>minf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>estop&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;i&lt;span style="color:#f92672">&amp;gt;=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;i&lt;span style="color:#f92672">--&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> e&lt;span style="color:#f92672">=&lt;/span>estack[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> edge[e].flow&lt;span style="color:#f92672">-=&lt;/span>minf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> edge[e&lt;span style="color:#f92672">^&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].flow&lt;span style="color:#f92672">+=&lt;/span>minf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> estop&lt;span style="color:#f92672">=&lt;/span>indptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur&lt;span style="color:#f92672">=&lt;/span>edge[estack[estop]].st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(e&lt;span style="color:#f92672">=&lt;/span>curhead[cur];e&lt;span style="color:#f92672">!=-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;e&lt;span style="color:#f92672">=&lt;/span>edge[e].next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> curhead[cur]&lt;span style="color:#f92672">=&lt;/span>e;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next&lt;span style="color:#f92672">=&lt;/span>edge[e].end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(edge[e].flow &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> level[next]&lt;span style="color:#f92672">==&lt;/span>level[cur]&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> estack[estop&lt;span style="color:#f92672">++&lt;/span>]&lt;span style="color:#f92672">=&lt;/span>e;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur&lt;span style="color:#f92672">=&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(e&lt;span style="color:#f92672">==-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> estop&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> level[cur]&lt;span style="color:#f92672">=-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cur&lt;span style="color:#f92672">=&lt;/span>edge[estack[estop]].st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ind&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(head,&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>,&lt;span style="color:#66d9ef">sizeof&lt;/span>(head));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(visit, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(visit));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">dfs&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> p, vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res.push_back(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit[p] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> u: cnc[p]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (visit[u]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dfs(u, res);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_res&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> EDGE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (edge[i].flow &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> edge[i].st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> edge[i].end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">==&lt;/span> source &lt;span style="color:#f92672">||&lt;/span> b &lt;span style="color:#f92672">==&lt;/span> source &lt;span style="color:#f92672">||&lt;/span> a &lt;span style="color:#f92672">==&lt;/span> sink &lt;span style="color:#f92672">||&lt;/span> b &lt;span style="color:#f92672">==&lt;/span> sink) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nums[a &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nums[b &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnc[a].push_back(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnc[b].push_back(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for (int i = 1; i &amp;lt;= n; i++) {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> printf(&amp;#34;%d -&amp;gt; &amp;#34;, i);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for (auto&amp;amp; item: cnc[i]) {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> printf(&amp;#34;%d &amp;#34;, item);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> puts(&amp;#34;&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> puts(&amp;#34;---&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (visit[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> tmp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dfs(i, tmp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res.push_back(tmp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(res.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> vec: res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, (&lt;span style="color:#66d9ef">int&lt;/span>)vec.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">auto&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> i: vec) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34; %d&amp;#34;&lt;/span>, i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">isPrime&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> v &lt;span style="color:#f92672">=&lt;/span> sqrt(u) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> v; i &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">%&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;E.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> source &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sink &lt;span style="color:#f92672">=&lt;/span> n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nums.push_back(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nums[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nums[j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (isPrime(nums[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> nums[j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addEdge(i, j, &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> u &lt;span style="color:#f92672">=&lt;/span> nums[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addEdge(source, i, &lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addEdge(i, sink, &lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span>(dinic&lt;span style="color:#f92672">::&lt;/span>BFS()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">+=&lt;/span>dinic&lt;span style="color:#f92672">::&lt;/span>DFS();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (res &lt;span style="color:#f92672">!=&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;Impossible&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> show_res();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Codeforces Round #289 (Div. 2) Tutorial</title><link>https://wizmann.top/posts/cf-289-div-2/</link><pubDate>Mon, 16 Feb 2015 21:16:31 +0000</pubDate><guid>https://wizmann.top/posts/cf-289-div-2/</guid><description>&lt;h2 id="a-maximum-in-table">A. Maximum in Table &lt;a href="#a-maximum-in-table" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Simulation.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>g &lt;span style="color:#f92672">=&lt;/span> [[&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n)] &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(n)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[i][j] &lt;span style="color:#f92672">=&lt;/span> g[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][j] &lt;span style="color:#f92672">+&lt;/span> g[i][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print g[n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-painting-pebbles">B. Painting Pebbles &lt;a href="#b-painting-pebbles" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Reading comperhension &amp;amp; Constructive.&lt;/p>
&lt;p>The key point of this problem is &lt;code>abs(b(i, c) - b(j, c)) &amp;lt;= 1&lt;/code>.&lt;/p>
&lt;p>First of all, it&amp;rsquo;s safe to paint k pebbles of every pile with the same color, when &lt;code>k = min(piles)&lt;/code>. At this moment, every &lt;code>b(i, c) - b(j, c) == 0&lt;/code>.&lt;/p>
&lt;p>And then, we paint 1 pebbles of every pile with color &lt;code>C[i]&lt;/code> at a time (if possible). That is, for every pile, the number of pebbles with color &lt;code>C[i]&lt;/code> is zero or one.&lt;/p>
&lt;p>If you can&amp;rsquo;t paint all the pebbles with proper color, just print a &amp;ldquo;NO&amp;rdquo; here.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>(n, k) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(mini, maxi) &lt;span style="color:#f92672">=&lt;/span> min(ps), max(ps)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> maxi &lt;span style="color:#f92672">-&lt;/span> mini &lt;span style="color:#f92672">&amp;gt;&lt;/span> k:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;NO&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39;YES&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> p &lt;span style="color:#f92672">in&lt;/span> ps:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(mini)] &lt;span style="color:#f92672">+&lt;/span> [i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(p &lt;span style="color:#f92672">-&lt;/span> mini)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, r))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-sums-of-digits">C. Sums of Digits &lt;a href="#c-sums-of-digits" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Brute force &amp;amp; Constructive&lt;/p>
&lt;p>After reading this problem, there is one thing that we could NEVER miss is the scope of number n: &lt;code>1 &amp;lt;= n &amp;lt;= 300&lt;/code>, which means that the max number here is no more than 40 digits and we can solve the problem with brute force.&lt;/p>
&lt;p>As we know, the number in the array must be incremental, and every number should be the minimum.&lt;/p>
&lt;p>Assuming we have got an array which is incremental, the last number is K. Such as:&lt;/p>
&lt;pre tabindex="0">&lt;code>K = d3 ++ d2 ++ d1 ++ d0
&lt;/code>&lt;/pre>&lt;p>Our mission is to find a way to generate the smallest number which follow the rules:&lt;/p>
&lt;ol>
&lt;li>the number here is greater than the previous one&lt;/li>
&lt;li>the digit sum&lt;/li>
&lt;/ol>
&lt;p>Rule No.1 is not hard as it seems, if we increase any digit of the number K, the new number is of course greater. But how to satisfy the digit sum?&lt;/p>
&lt;p>For example, we got a new number &lt;code>K1&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>K1 = d3 ++ (d2 + 1) ++ d1 ++ d0
&lt;/code>&lt;/pre>&lt;p>Here, of course, &lt;code>K1 &amp;gt; K&lt;/code>. But the number &lt;code>K2&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>K2= d3 ++ (d2 + 1) ++ 0 ++ 0
&lt;/code>&lt;/pre>&lt;p>is smaller then &lt;code>K1&lt;/code>, and also greater than the number &lt;code>K&lt;/code>.&lt;/p>
&lt;p>And then, we fill the lower digits with number to make the sum of the digits equal to the given one. If failed, keep on trying, such as:&lt;/p>
&lt;pre tabindex="0">&lt;code>K3 = d3 ++ (d2 + 2) ++ 0 ++ 0
&lt;/code>&lt;/pre>&lt;p>or&lt;/p>
&lt;pre tabindex="0">&lt;code>K4 = (d3 + 1) ++ 0 ++ 0 ++ 0
&lt;/code>&lt;/pre>&lt;p>or even&lt;/p>
&lt;pre tabindex="0">&lt;code>K5 = 1 ++ 0 ++ 0 ++ 0 ++ 0
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> sys
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">do_fill&lt;/span>(num, ptr, delta):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(ptr):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num[i] &lt;span style="color:#f92672">=&lt;/span> min(&lt;span style="color:#ae81ff">9&lt;/span>, delta)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delta &lt;span style="color:#f92672">-=&lt;/span> num[i]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> delta &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>(num, pre):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l &lt;span style="color:#f92672">=&lt;/span> len(pre)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> pre &lt;span style="color:#f92672">+&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(i &lt;span style="color:#f92672">-&lt;/span> l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> t[i] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t[i] &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(i):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t[j] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delta &lt;span style="color:#f92672">=&lt;/span> num &lt;span style="color:#f92672">-&lt;/span> sum(t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> delta &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> do_fill(t, i, delta):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> i &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;__main__&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ns &lt;span style="color:#f92672">=&lt;/span> map(int, sys&lt;span style="color:#f92672">.&lt;/span>stdin)[&lt;span style="color:#ae81ff">1&lt;/span>:]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> [[&lt;span style="color:#ae81ff">0&lt;/span>]]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> num &lt;span style="color:#f92672">in&lt;/span> ns:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans&lt;span style="color:#f92672">.&lt;/span>append(solve(num, ans[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> item &lt;span style="color:#f92672">in&lt;/span> ans[&lt;span style="color:#ae81ff">1&lt;/span>:]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, item[::&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-restoring-numbers">D. Restoring Numbers &lt;a href="#d-restoring-numbers" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Math&lt;/p>
&lt;p>Each number of the input matrix is &lt;code>(A[i] + B[i]) % MOD&lt;/code>. And we can get &lt;code>(A[i] - A[j]) % MOD&lt;/code> by subtract the number on the same line.&lt;/p>
&lt;p>Sometimes, the &lt;code>(A[i] - A[j]) % MOD&lt;/code> can be both positive and negetive. And we can get the value of &lt;code>MOD&lt;/code> here.&lt;/p>
&lt;p>As a result, we can get the value of every &lt;code>A[i] - A[0]&lt;/code>. We set A[0] to the number &amp;lsquo;0&amp;rsquo;, and get the values of array A.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>(n, m) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mat &lt;span style="color:#f92672">=&lt;/span> [map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split()) &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mod &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diffs &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(m)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, m):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> diff &lt;span style="color:#f92672">=&lt;/span> set([
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mat[j][i] &lt;span style="color:#f92672">-&lt;/span> mat[j][&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(n)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(diff) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> diffs[i] &lt;span style="color:#f92672">=&lt;/span> list(diff)[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(diff) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;NO&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a, b &lt;span style="color:#f92672">=&lt;/span> diff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> mod &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">=&lt;/span> abs(a &lt;span style="color:#f92672">-&lt;/span> b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">elif&lt;/span> mod &lt;span style="color:#f92672">!=&lt;/span> abs(a &lt;span style="color:#f92672">-&lt;/span>b):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;NO&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> diffs[i] &lt;span style="color:#f92672">=&lt;/span> max(a, b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>As &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Bs &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> diffs[&lt;span style="color:#ae81ff">1&lt;/span>:]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Bs &lt;span style="color:#f92672">=&lt;/span> map(&lt;span style="color:#66d9ef">lambda&lt;/span> x: x &lt;span style="color:#f92672">-&lt;/span> min(Bs), Bs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> As[i] &lt;span style="color:#f92672">=&lt;/span> mat[i][&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">-&lt;/span> Bs[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> mod &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#ae81ff">18&lt;/span>) &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(m):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> mat[i][j] &lt;span style="color:#f92672">!=&lt;/span> (As[i] &lt;span style="color:#f92672">+&lt;/span> Bs[j]) &lt;span style="color:#f92672">%&lt;/span> mod:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;NO&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39;YES&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print mod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, As))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, Bs))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="e-pretty-song">E. Pretty Song &lt;a href="#e-pretty-song" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Math &amp;amp; Thinkin&amp;rsquo; in reverse&lt;/p>
&lt;p>It&amp;rsquo;s hard to get the answer by brute force because the scope of this problem is too large.&lt;/p>
&lt;p>Try to think in reverse. It&amp;rsquo;s hard to calculate all the value of the substrings, but why don&amp;rsquo;t we find a way to get the value that every vowel contributes to the final result?&lt;/p>
&lt;p>For example, string &amp;ldquo;AAA&amp;rdquo;. The first &amp;ldquo;A&amp;rdquo; will add &lt;code>1 + 1/2 + 1/3&lt;/code> to the final result. And the second &amp;ldquo;A&amp;rdquo;, &lt;code>1 + 1/2 + 1/2 + 1/3&lt;/code>. And the last &amp;ldquo;A&amp;rdquo;, &lt;code>1 + 1/2 + 1/3&lt;/code>.&lt;/p>
&lt;p>We can make a table here for a 4-length string.&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAf8AAACGCAYAAADTq4MDAAAgAElEQVR4Ae2deVxUVf/H3zPsCAiIKCiKiihuLe7WY9pq5ZbmmllZqS2Wlenza7HNHss208qsR8vKJTO13LfSyu1BixQVM1FkEVE2RWCYmXt/r2Fz2AbUmBlmvvMHnLnn3PP93Pf33Pnee+6552gKCgpUgOjoaLp27WpKysfKBNTsX3nj9RQeensEYa6XjOfGzOTex9bTYvoq5t4ZhPZSlqSsSMDW54bu8Hvc+/APtPlgA+/2qFd65MrZNTwy8D8cafM8qxcOoZGNGoiJT0DbUlnWTRiP8/3qB1ipH8z0oVNo41bevMLFjAPk+F1LI7Nzq3yp2vyeGYdNf1uraj+oOcS8fx+PrdAy4vMlTO7gVZsYqqzb1ueXSZj++HxGjfmShv/ZzLy+vmW0KpkH2H0+khuae5bZbq0vtcXHRj8X1sJWF+wYSFq/nOxbb6FJuR8n76jB3B5s4PcvV3NCXxeORTTWBgHVoMNQvmIlh9gVSzmCF71G3EiQs57JLi25u/eDNM9bzcd7d5CumINSyD23ni0ZAQSUO7fMSzl6uvL2c57YJS/x/IoLXPfE20xob5vAby/sVcWAEVAVhcK74RJh+lS2zF+H3s+9ZIvD/HfiU8IOfKic58i6ebz58T4u3rqFXe0Gc0NzLzQmaWoeCXv3cDIXSFvA/73pzeQJw+gVUuHWxg4ORCTUDoECzsTsYNPSX8lCT/QHU5gSEUKAl4GME0eI1zVh+MtvMKFfMC61I6AO1KrBs+E4Xrjbn692zuS55cvoGn49Tbw0XMzNxrXBAAa2bo7j/XTXxDV60mK2s3FZUfvZP/dFXt4Wgg8XOZuURI7/tTwxfzr9OwXivIHAQHrMT6xbuZVU00/t/Nd4fU+DIh7GXFIP7eJQyEt8X9/xrq410u1fk5NIyjgzgdrqdnMUpjbt9i8D0UhuzklScrLQuzSkSWAYfi6Fl9JlSln7i627/a19vJdrT84vy8Rqi4/zXvBZ5i25QkAI1DkCLnj7tCLCp84JF8FCwOoENDt37izziMPqCsSgEBACQkAICAEhYFUCZbr9PXp5WNW4GBMCdYFAF00XVHV+XZBqE40azQThY4G88LEABxA+NeHzz9+jO94oBsscJVcICAEhIASEgNMTkODv9E1AAAgBISAEhICzEXDi4K9SkJGNrsx7wbZ2v0JBxjnSzxvKvmt6NbIMuWRlV3hL/GpqlH2FgBAQAkKgjhNwwuCvkntkG/MHD6VP81fYn2MfHlTS/2DJsx+x8K33mdj4Zu5/ZhcZplknrvSjT2PPB6/zYOObeWROIjJH0JWClP2EgBAQAo5HwAmDvwbvqL4MvqsexTMb296r6gX2PjWdn669j/GzZjBvaX/8EhI4fzU37G7B9Bg/gJYaA1fUuaFcID46TS4abN86RIEQEAJC4B8n4ITB38RQi3cjb/uZKz/3GJs2ZeId5IkWLUGDpvLJylGEX+3LFy71CPS5MhfrDi5n9hdJFaeV/ceboFQoBISAEBAC1ibgtJP8aDTlg6KKLimW3duOke0VTpe7r6NJPdPsYCq6hD/Zm9CEXj1dOb5hJ8eIpPddkfhdBj1jZjz7Nh3ktKEBbW/tRpvG7oXT+BqzkzkZe4yTmXpcTxzn2EF/giLDCPAoOzOZejGRfT/sJ8UlhNatffBpEQbxpzhv0OIR2pKIMHcu/nWUk5lGtD6hRLQLxF2jQVs0VzCG9L/Ys+Fv1NZd6N4tmJLqK9Qb0ZbgM1t4a9A8Yjq9yokjQQQ3b4pveiz/OxFCt6iz7NySRcTAnjTzKavR2o1X7AkBISAEhMCVESgfAa+sljq/l4HUb9/l9Q9P4B0ZQt53LzAk6jW2p2RzeMFM7m/xCC/NXMuiJ9/hq6Xr+XTwaB6Z8TcFNTpuhaytc3nqvo3ktm5Hc/12Xm47ijdXni1cSMJw5i9ifjtGlmIk80AM+3+NIzW33DudF4/w+cgvOB3Vg67hp1k6cibbzrjg436Sr+4cy1PvxFOABvf6cGjao4wdvpbU0kcGKroj3/Py7S8x94UZPNujPw8+H0226VlAZfUmZ3Ni3xmMRtAlHWbf1j3s+GwWD7YYx4szVvDJo6/x6n1P89qqjCt7nFAjZlJICAgBISAEapOABH9ASd3GOx94MfaNgXTr2ZPhsx+jTeJa3v84jYgHH2Hk9ZCf4Ubf2W/y5tL3mPGQP/HLd5Jag1F0asYe3h+7hVavP0zfzq257qGpvDVZZfWYN9icouAR2ZehE2+iiZs7ze4ZysjHbycqoKxbdHEb2BDnQ4vWjQjtPojn5vShgYs7gVHXcm3TkrIa3Bu14pougeUeZ6jkGa5j6t7lLD+xnk8mN+HYe2/w9cECKq3X1ZeokQPoFaalXsdbGTZpOEOfeoT7ukBuspa7lixlY/JaZo9qUM5ObTZTqVsICAEhIAT+SQIlkeOfrLPO1XVx33r2JZxk07sLWfjmQr784gzdp9xP/7YeoHXF012LV8u2NPYydXO74t/KH21uNnnVjsZXufDrMramBtMhvGRdMXeaDetHWN5uVm3PqtErfW4h7QhLXsLDnafx+aqTuN02jv4RptX9atLtrsW/Y6uiJU1d/Oky9RE6kcLevVm4VFlvORdq3PBw01KvU2fCvLV4hzbC9zIeeZSrTb4KASEgBISAjQnITzgK+WmZ6H3/Rf+p42hZEqNLHKNmlAuxGrSmlcLUcl3zJeXL/Fc4f/wMBao3eoOpfFGwdm0UTgNULqTlFXadV7ccqzb0dmbu0vHhhA+YP+QnFnUdw6w1T9GrQRljNfqi9W1MaH2ILzCgqare4BpVJYWEgBAQAkKgjhKQO3+0eIUEoTm2gU2HdZfcaEgj+seEGj7Xv7Rb2ZQWv4jGuJPMn/FmIwQUI4qLL62vCajROuzG9ATSwwfwwp4NrFw+kmYx3zD9xYPkocHF5MHyFyLlv5uLKjhPZkEAba8JgCrrNd9B0kJACAgBIeBoBJw2+KtGpTBomsa91es2hJv8T7HgtudZsOYoKQl/s2PGXHb7BOKmKhgUFdUsoBYmTQG8sDUUkLhiEV9+l1jJhYIG395juLNRBls+3Etm8Qv3eUeiORs5hFE9vIvak6LHYDCgKyguUK6VGRK2sGBJEgaNF82GTeKliY3R5OpRXbxpEKghOy6JiwoY0w7wy94slIvmjyRUFL1S/HhB4dzmNSRc/wAPdPeiyno1Lri5Qn56DnpdOieTdYXXF0pBtc85yimXr0JACAgBIWCPBJyy278geT9rFx1D0buwZtH/aPlwT6atHMeZwQuZN3AX8/Cg/f/NYe5NbqRs+o51sSq5SWtY/3MIvX0O88P3iShJCj9+14+QYT78/OpcPlKM9Bk0jtJH+8Xe1vh34bl1kzk3+HWenvgAgzvmELPVlUdXjifKC4xnY9k6exmHVAXtnKVs9r6ZHn0j8DN/FqDmceilp5maMpZ+UTnsPd6Np+Z0wlvjSudn+1F/wIsMavEF7e8awZBOAfBnNCsW/M5jj0Zw42N92TZzMs9lDKJL/RRiUzoz44dRNHcHXVX1oiHy3k7w9DTu7z+ccWN92HxQIe/gIr5Z1ZD7BrWkntNeNtrjaSyahIAQEAKXR8A5l/RVFYzGkmf2GrSu2sKn8aouk8TDqRgatSQ81KPGo9kNGSmkEUxooIVrKcNFTsclcsEjmPAI0zv4xY5SFRSjemngn+ndfJciPaWuNBagR0N+UiKpuT40aR2Md6kpFd3pUyTnB9CshS+G06fJCwwpO0+AIZe0+DMYGjYlJMDt0hiGauo1rX1g8PM3s1WqyKkSsqSvZXfLkqzCxzIBy7nSfmrCpyReWS57ObmlIeRydqrzZTVaXCo5co1HAM2uC7jsw3MNDCW0ur1c6xHSoS0h5ctptKYXCix/XNwxje13a94S3wolNXiENKdl8XbXkFA8y5dx9SY4skX5rVBNve6B/pQf/1ixEtkiBISAEBACdY2AdN7WNY+JXiEgBISAEBACV0lAgv9VApTdhYAQEAJCQAjUNQIS/Ouax0SvEBACQkAICIGrJCDB/yoByu5CQAgIASEgBOoaAQn+dcBjasF5MrJLV+qpA4pFohAQAkJACNgzAQn+9uydQm0KGave57/R+XavVATWNgEV3blUfv1+B689+Rk337SYzZn//CtAtX0UtVa/kk/s4hUM7vEKLVrPZOgrB0kym1iz1uzWmYoVUrdsYHSv6bRoNYP+/47hlPCpwnsKyd8t4voeK4nOraJIHd8swd/eHahksG+9N326+di7UtFXywSU7NNs23SIr19cwqsf7+fn/GZE+ZVMGFHLxu2+eiPHP/2MQW/Gk6XP5eTfJ1n5+kfcMTMFs0m77f4oak+gSubOn/n07zCenTuEYb5JrHt7Pvd9k1m4tHjt2a2LNatk/fYD/Ybv4mijCCK86uIxVK9Zgn/1jGxaQjmzn131+9Lez6YyxLgdENDWD+Wu+25kVOeiaaE7Dm9DY/OZIO1Ao80k5J9ll7Yfew9OZfu+Gex6NrBQyuENCaXTattMm10Y1lC/Wx+mP9aBLp07Mn6MacYRhfSzBcXTlNuFSLsQofvrV+4bsJFYXOg5ugX+Dnp9LcHfLppbVSIU0n/ehc/gdtSrqohsdy4CeadZvcPUDxnMPXcEFk7+5FwAqjhaz8bcPzGSINPFkMaDNj2DCgsGtW+Ir/zKFbLQurkUzlqqZB7n089SoGl3XhvTUNqQWZMypsXy8isJ1C+c6605o2+sd2lGVLNyjpCU08Kevaiks2+jL327Sui3ZzdZU5vu7z9Zmww07ciAVtVNDWlNZfZkS0fc1lQTJJ55NlwunE2uUfWcjjnEV28u4oa28/ht4ETijjzEsCYSAkparppzitnPxdL1uZYkngSu6UqfRo7Lx3GPrMSjdfi/cjqa3QF9aVdxTt86fFQi/coJGDm1MYZ4IOj26wsXhrryuhx3z4K/fuP5rwzcOX8Cz7WXC6RCT6sGMlLSOfhLLHvSctk7eyMrT8obRKVngT6DZVO34fr8PfRN+p1oFdrcG0VTB24+EvxLvW9vCYVzP++h/j1RFC/8a28CRY+1CRjP89N3KYAnfUc0kTvaSvgrWcd46d5NeL72LN8+GoxHJWWccpPWi/Z39eadtVOZ20sLxpN8+HEiDjqQ/fJcrOSy443viRl0L092Uon59jg6GjDw7iCHXttEgv/lNRPrlTaeY99mf/oWD+6ynmGxZK8ElHPHWPY74BHBqM4Vlm+yV9nW05V3mo/v/5aESc+wZkoYvg46UOuqgLoFMeyx8MIq8rP1MtgPlbM/fs2oRTkkL1/F+Ie+5LlVeYCe3+dtZ+95x32VVoL/VZ1Jtbezqct/T1Af2kqXf+1BrlM1q2Tt+R97jODSvRs9AySylXGfLo1Fk1ZxasKTfPNoCN66Myx++09SjGVKyRdMi3maRkW60uXuxtKriJ5TBwy0CC3g+OHTHNgZywHTu6ENfdDlehHk5bjnmQR/u/w5UDi3bS/+97SVk9Mu/WMDUWoeu7/6C9NUTx3ujSBIztxLTshPY+HoWTy07BQ/THmfjm1eJKTh23wb0VJehUTP0a9XMumN34m7qIKSwy9Lk/G5aQhzh9YvHP1/CaQzptzpPP0Jdu6exu7dz7FojGmYvxv9/zuFX765kVamtdQd9OPAwxnqsMeMZ9m7NYC+8+Rpfx324j8kXSEj5jDrNu3l9R+KpqtJ3bKXb9t1456bg/B23BuTmvHTn2PBsJk8srbo6fWxo8W7Bd/IlDt8JbgpeRz4bjsfrdHx0Qdh9OsdiG/bMfw+/Xpay5Ojsm3MkMnm79PAtQ2ju3s77Ct+JQetKSgoKHyoER0djUcvGR5TAsam/5Uckv42EhJZH5nDxaaeKDTeRdMFVZ1veyF2qkCjmSB8LPjG5nyMOhLj0kjX1CO8dSD+dnY3a3M+Jb5T8on/M5V01/q07xBgNxfWRXz++bEHcudf4nh7+q/1oWmkPQkSLUJACNRZAi4ehLUPI6zOHoCVhGs9aXldOC2tZM7WZuTJoa09IPaFgBAQAkJACFiZgAR/KwMXc0JACAgBISAEbE1Agr+tPSD2hYAQEAJCQAhYmYAEfysDF3NCQAgIASEgBGxNQIJ/rXtAoSDjHOnnDVQ7XlMt4Hx6QfXlal3zP21ApSAjG53yT9cr9QkBISAEhMCVEJDgfyXUariPkv4HS579iIVvvc/Exjdz/zO7yKhsxjHlAn8t/oinW93EoIkxmCaXdIyPSu6RbcwfPJQ+zV9hf45jHJUchRAQAkKgrhOQ4F9bHlQvsPep6fx07X2MnzWDeUv745eQwHnzhbSUC8RHp6HX+hI5YjDdffQYqu0eqC3BtVGvBu+ovgy+qx7F00nUhhGpUwgIASEgBC6TgAT/ywRW4+K5x9i0KRPvIE+0aAkaNJVPVo4i3GweJd3B5cz+IonC6wEXH4L8HNEdWrwbectMazVuOFJQCAgBIVD7BOr4JD8KuX/HEHMhgm4Rmez7MYbM4GvofUs49cziqDEznn2bDnLa0IC2t3ajTWP30qkb1YuJ7PthPykuIbRu7YNPRBTNahiEq6rXmJ3MydhjnMzU43riOMcO+hMUGUaAR8lcrCr5xzbx1qB5xHR6lRNHgghu5oemOFstyODw+p3Ea9vQ++5I/Eqn+VPRJcWye9sxsr3C6XL3dTSpV1JncWNRC8iITyZLZ+pC0ODesAlNGrqhP5dCcpoOPPxp0jIQdw1Uql/N5+zRJLJMEz9qPQmOCEJ3MpnswokgNXg0akZYMGQeO0V6vgavsOY0DTA1o6q1aTRmzqj9Ni0WhIAQEAJCoBoCdfdX2ZDOvg9e4N7W43lr/mpm9ZvCrGlv8/Lt9zJy4i6yCgeXKWRtnctT920kt3U7muu383LbUby58iyFj94vHuHzkV9wOqoHXcNPs3TkTLadruyhfHmKlus1nPmLmN+OkaUYyTwQw/5f40jNNevPVy5wYt8ZjEbQJR1m37YYThQJRsk8yLJJ7/DNt+v5ZNAYJs46gb7QvIHUb9/l9Q9P4B0ZQt53LzAk6jW2p5YfRaeiT/iZt7oMZ/jQLaQXZ2uUdLY+9Co/HjMNKLSsX3dkJVOvGcWkD09hMF2RnNvNez1H8cBT+yh5bK8/upyXn9hGmt508VFTbeU5ynchIASEgBCwBYG6G/xdG9Dl8XHcFW66C9UyZONyVias5f0HAjn9+dssiS1AzdjD+2O30Or1h+nbuTXXPTSVtyarrB7zBptTFHRxG9gQ50OL1o0I7T6I5+b0oUENiFRXr0dkX4ZOvIkmbu40u2coIx+/nagAs4q1fkSNHECvMC31Ot7KsCcH0jXUdHuvostyo8/s//Cfpe8z85H6HFu6mzQDKKnbeOcDL8a+MZBuPXsyfPZjtElcy/tzj1Ng3nI0HjS6eQzTnm8GGWcwept6OTS4upwns8dEHrqjMe6ZFricdqfp4PE81d+L8ydz0Lh5EnzjMJ58uCGGtFy8A9zRaFzRXDDQa+YYrg92qbk2c52SFgJCQAgIAZsRMItINtNwFYZdcXfV0uCGnrT01YBLIL3+bxThJLPnf5lk/7qMranBdAh3L7bhTrNh/QjL282q7Vm4hrQjLHkJD3eexuerTuJ22zj6R1S36oXKhWrqNbvHv8xj0+DVoi0hhWtIu1I/3A9NTiYXjXBx33r2JZxk07sLWfjmQr784gzdp9xP/7ZmgwhKrbkT/vAYOmVu5ustmSgopK3fju+o6/DT1EC/xp+uk3rj+ctyfk1RQC3gYq47ypHvWXVQB4bT/LYllDu6FK06eHnaSkVKQggIASEgBGxEoI4/869IzTWkDWEekJpbQPbxMxSo3ugLh9AXPRt3bRROA1QupOVB6O3M3KXjwwkfMH/ITyzqOoZZa56iVyNL10QK56up19TTXvqYvqLEGm7RoHXVgtGAqirkp2Wi9/0X/aeOo2XJtYyFmlzCbuGBu2czddY2Uvt15ZefW3DHCC/AWCP9PjcM59aA8Xy3KpV+A/axremTPH7tiyz5KJaHph4l9tpbGVC4JGj12sr0TFjQLFlCQAgIASFgHQKWopx1FPwTVlSze23FgEHjTVjbAAIiGuNOMn/Gm4UfxYji4kvrawIgPYH08AG8sGcDK5ePpFnMN0x/8WA179lr8aum3qsP/OWhaPEKCUJzbAObDhet6V5YwpBG9I8JZbv9S3bV1Kfb83cRsHcxy79dx/GbbqGoA6SG+utFMXRsMH99+iM/LThIhwdvov/ka8n9/kuWf/Y31w4Ko6iP5Aq0lWiU/0JACAgBIWATAg4Q/BVyTucUDeAD8g7v5mSjfozs6YNv7zHc2SiDLR/uJbN44FvekWjORg5hVA9vDAlbWLAkCYPGi2bDJvHSxMZocvWoFJC4YhFffpdYSWDVVFtvoScVPQaDAV1B+QF5xX7WuODmCvnpOeh16ZxM1qGooJr+FH8Kr2lMFytAvW5DuMn/FAtue54Fa46SkvA3O2bMZbdPYHEQLtnr0n+vLiMYHpXIN/9O4Ma7GxW/bldD/bjT8qF7aHb4v3yc2Jc+zd1pePdoeii7WRTbjV7NLl3iVKdNNZoeHZiGGcpHCAgBISAE7IGAQ3T7Z235L/P/O5JeQadY/14K9yx7k2t9TS+6deG5dZM5N/h1np74AIM75hCz1ZVHV44nygt0ah6HXnqaqSlj6ReVw97j3XhqTie89amseHUuHylG+gwaV3zHfMldGn/L9RrPxrJ19jIOqQraOUvZ7H0zPfpGmL2yZ6rLm8h7O8HT07h/wAgeecCb9X8q5Pv+yI9bQujrH8cP3yeiJKms+f5umozsxbSV4zgzeCHzBu5iHh60/785zO3jW/ra4iWFxSn35vSf0o31e0bQNejSK4HV6S+px631HQy7YSvpz3TBz7R7UFdGDW+N+z09ywyM1DSoWps+eT9rFx1D0buwZtH/aPlwV0K9L2kpsSX/hYAQEAJCwHoENAXFU69FR0fj0auywWPWE3PZlnTxfNZhJOtHfsknwwtIya5H884RNCwcMGdWm+Eip+MSueARTHhE0TvuhbnGAvRoyE9KJDXXhyatg/EuvhwyZKSQRjChgRauj6qqV1VQjOqlOfo1GrQu2kqCdNGc9wY//1K7ZqorTaq6TBIPp2Jo1JLwUI9qJ89R8zNI0/nTqH4lnTxV6S+1rJB/JhO1YQO8inc3ZqWR4x1M/UrGHVSqTVUwGkt6M4rGMdS10N9F0wVVnV9KRRJlCWg0E4RPWSRlvgmfMjgqfBE+FZCU2VDEp+Q3tEzWVX2xENmuql7r7qzxIKhjO0Krsupaj5AObQkpn+/iXthl7ta8Jb7l8lwDQ6uur6RsVfVqtGhrRFaDe6A/lcTREgsV/ms8Amh2XUCF7VVt0HgG0qhwYF4lJarSX1pUi2ejBqXfTAkX/2Dql9ly6Uul2jRaXGrE4lI9khICQkAICIHaJaDZuXNn6SXFDTfcULvWpHYhIASEgBAQAkLgsggcOXLkssrXpHCZbv9esXWo21+fyk/7f2L3uRyMLr60anULwyKDL+suuiaApIwQ0EwwdfuXXiMLkHIENBqN8CnHxPyr8DGnUTEtfCoyMd9SW3zqboesW2Nu7jGam80pSVoICAEhIASEgBColkAlo8Cq3UcKCAEhIASEgBAQAnWYgAT/Ouw8kS4EhIAQEAJC4EoISPC/Emq1to+KLuckv/6+gteW/pub3/0Pm81XA6w1u1JxXSGg6pLZ8cnjDBy3mjSZNamC24RPBSRlNgifMjgqfHEmPhL8K7jfdhuUvBNsO7Sbr1e/xavbt/Kzvi1RnnXtrXjb8XN4y/kJbFv8Ge+9Mo81hzJLZ7V0+OOu6QEKH8ukhI/wMSMgwd8Mhq2TWq+W3NV9EKOaF8060LFLVxqLh2ztFvux79mcW8dN4em+PpVMGGU/Mm2mRPhYRi98hI8ZAQktZjDsIqk/yeq/LgBh3NO+UZXz9tuFVhFhAwJaXD3dJPhXSV74VImmMEP4CJ8iAhL8LbcEq+fq0nawNgsI+BcDGl7O3H9WlyoGbURAI0+CLJIXPhbxIHyEj4mABH/L7cDKuQZOHfqZeNMaOu1uJqpozVwraxBzQkAICAEh4OgEJPjbk4eVdH7abwr93vTtEkE9e9ImWoSAEBACQsBhCEjwtyNXKjl/sOwU4Hoto5pL6Lcj14gUISAEhIBDEZDgbzfuVMk6sZE9Cri06EdPWfPebjwjQoSAEBACjkZAgr+9eFS9wO7dv5MPdOh8LUEyqMtePGNnOlSMBgVVMSJz/FTmGuFTGZVL24TPJRaVpZyHjwT/yvxv1W0KGYk7+XrzLCb/mVtoOfXwBr6NS0Ym97OqI+zfmPEc+1cvYMGObNS4Jcxf+gtJOvuXbTWFwscyauEjfMwI1N0lfc0OQpJCoDYJyJK+lunW1pKjlq3WnVzhY9lXwsc2fOTO3zJ3yRUCQkAICAEh4HAEXKOjo0sPynSHIx8hIAQqEjDdncinagLCp2o2phzhI3wsE7CcGxcXZ7nAFeRKt/8VQJNdnIuAdPtb9rd02wofywQs50r7sQ0f6fa3zF1yhYAQEAJCQAg4HAEJ/g7nUjkgISAEhIAQEAKWCUjwt8xHcoWAEBACQkAIOBwBCf725FI1l9i9sxn81r20eHksQ9f8RpLBngSKFlsTUHXJ7PjkcQaOW02azPJTxh3Gszt4d2xv2oU3p22vEby29hQyDcIlRMLnEouqUs50fknwr6oVWH27geM7pjFowwGyjBc4mXaYlWsnc8fG4/IDZnVf2KnB/AS2Lf6M916Zx5pDmRjtVKZNZOkO896IZ9kVMoTJUx7k+uyVvDqgF5O2ZaHaRJCdGRU+1TvEyc4v1+qJSAmrENAnsUv7EHunX0+QJpfdK4bTa2sqh2OPkHl3KxrLm2ZWcYNdG/FsziQQ7CwAAAoASURBVK3jpqDZ+D5rE+xaqdXF5R3eRMG0jay4o2HhOuWPju6Ja+SdfP3hHt69pR9+VldkXwaFTw384WTnl9z516BNWKWIWzj3976eIJNHNN60aRVaaDYotCm+Evit4oK6YUSLq6cb0iTKessj6mGm3FYU+E05msAeDOnkikYrpEw8hE/Z9lL1N+c5vyT4V90KbJiTR9yRk0Akz9zaDlnc14ausEPTMt9QRadoPf3wNP81M6QTnxHALfdfh0/F4k63RfjU3OXOcn5Jt3/N24TVShacWc3zu/XcOeZtngt1t5pdMSQEHIWA7ugyvvN9lgX9gwsfAzjKcf1TxyF8/imSdbceCf525jsl9w9emr8Iz4Gf8u2NYXjYmT6RIwTsnoA+nq9nxDJ2wZe0kxOooruET0UmTrjFvKPMCQ/fzg5ZH8/HX7xLQt95rLmtjTzrtzP3iJw6QEA9T/SHb5My4WMmRErkr+Ax4VMBibNukOBvL543JLJo6cec+tdsvvlXC7wNCSze9Asp8i63vXhIdNg9gTyOfPEKq1pP54U+gcXd/QoGOYeKPSd87L4JW1GgdPtbEXaVpvSnWLjgER457ErE3xNZs8JAdlYOXR9cwSi5PKsSm3NmqBgNCqpiRGKaWQtQczk0fzzTjg/khZGp/Lk/FbUgnQM/rCTvwTk80dbJx84IH7PGYinpPOeXBH9L7cAaecYUFnz2II8cOF9o7diZYqO+g5nSPkAGK1nDB3XFhvEc+9csZsGObNTsJcxfGsn4e3vT1Ol7tws4Oqc/3Sf/zEUWs+5dM4d2mMXRN5w88CN8zFpE1UknO79kSd+qm4LkCIFCArKkr+WGIEuyCh/LBCznSvuxDR/pVLbMXXKFgBAQAkJACDgcAdfo6OjSgzLd4chHCAiBigRMdyfyqZqA8KmajSlH+AgfywQs58bFxVkucAW50u1/BdBkF+ciIN3+lv0t3bbCxzIBy7nSfmzDR7r9LXOXXCEgBISAEBACDkdAgr/DuVQOSAgIASEgBISAZQIS/C3zkVwhIASEgBAQAg5HQIK/XbnUSOqRhYx+eygtXhxN/5XbOWWwK4EixsYEVF0yOz55nIHjVpMms/yU8Ybx7A7eHdubduHNadtrBK+tPYWuTAnn/iJ8qve/M51fEvyrbw9WKqGQeXw5n6a15dmRkxjm+TfrNk3lvr1pGK2kQMzYOYH8BLYt/oz3XpnHmkOZ0i7M3aU7zHsjnmVXyBAmT3mQ67NX8uqAXkzaloVqXs5Z08Knes872fklM/xV3ySsVEJL/fBhTG/lihYD/t3DeScpnvSc/MJpXF2spELM2DEBz+bcOm4Kmo3vszbBjnXaQFre4U0UTNvIijsaFs6K+ejonrhG3snXH+7h3Vv64WcDTfZkUvjUwBtOdn7JnX8N2oS1imhdTIEflNwDfPprPATcxWvdm+BmLQFipw4Q0OLq6YbMOlDWVR5RDzPltqLAb8rRBPZgSCdXNFohZeIhfMq2l6q/Oc/5JXf+VbcC6+aoBZxO2s+Wg1uY99N21B6ziBvQlzYe8uNlXUfYvzWZb6iij7SefniabzakE58RwC1PXIeP+XYnTQufmjveWc4vufOveZuo5ZIFZGSncPDYb+y5cJ69275kZbq+lm1K9ULAMQnoji7jO99nebt/sCyOVYmLhU8lUJxskwR/e3G4xof2HYbyzpMLmdvKBZTDfPjzUXLtRZ/oEAJ1hYA+nq9nxDJ2wTO0c/oVDytxmvCpBIrzbZLgb28+d2nCsJvaF6rKz9PJmu325h/RY98E1PNEf/g2KRM+ZkKkRP4KzhI+FZA46wYJ/nboeRcX09h+N7p0DMfbDvWJJCFgnwTyOPLFK6xqPZ0X+gQWd/crGGQ+hGJ3CR/7bLe2USXB3zbczawWcHTPHCat20acTgU1k1+ij+MTOYm51wfJ80ozUpI0EVAxGhRUxSi9QuYNQs3l0KeP8vyRnvRvmsqf+/ezb/dmFv77ceb/VWBe0jnTwqeGfnee80tG+9ewSdRaMTWHA/tX8NGBr/hoaxv6tW6Eb+MX+L3/LbSWd/xqDXudrNh4jv1rFrNgRzZq9hLmL41k/L29aer0vdsFHJ3Tn+6Tf+Yii1n3rpl3O8zi6BvuZhucMSl8auR1Jzu/ZEnfGrWKWi6k5JKYmki6pj7hwY3xlxl9ahn45VUvS/pa5iVLsgofywQs50r7sQ0fufO3zN06uVpvwkLbEGYda2JFCAgBISAEnJyAa3R0dCkC0x2OfISAEKhIwHR3Ip+qCQifqtmYcoSP8LFMwHJuXFyc5QJXkCvd/lcATXZxLgLS7W/Z39JtK3wsE7CcK+3HNnxktL9l7pIrBISAEBACQsDhCEjwdziXygEJASEgBISAELBMQIK/ZT6SKwSEgBAQAkLA4QhI8LdblxpJ3v861781h2iZo8RuvWRtYaoumR2fPM7AcatJk5nrKuAXPhWQlNkgfMrgqPDFmfhI8K/gfnvYoJD19zz6ffYjR/2uI0Im+7EHp9heQ34C2xZ/xnuvzGPNoUyMtldkXwqEj2V/CB/hY0ZAgr8ZDHtJ6s6s5r6PvyQWV3p2a4+/vGVmL66xrQ7P5tw6bgpP9/VBmkQlrhA+lUAx2yR8zGBUknQyPhL8K2kDttxkvLCLl9ccpn7hij7tGB3hLz/0tnSI3dnW4urpJm2iSr8InyrRFGYIH+FTRECCv+WWYNVcVRfH7O920vW2TiSmA01vp4+fuMiqTqgDxmS+IctOEj7CxzIBy7nO0n4kslhuB9bLNaay7PsluN7+BH0ztxKtQpvO3WkqHrKeD8SSEBACQsBJCEhosQdHq+fZsW4OMdc8w5NNVWL2HUBHCAM7NsHZ1yOzB/eIBiEgBISAoxGQ4G9zjyqc/XMGo3Znkbx/LuMXvcpzf+QAOn7fsZy9+arNFYoAISAEhIAQcCwCsqqfzf1ZwKkkPS388zh++gSGnL84YAB8A9AV+BDkJuO6be4iESAEhIAQcDACEvxt7lBPOvf/gJ39TUL0HF47gvZrztD//s/58Ro/GdVtc//YmwAVo0FBVYzIHD+V+Ub4VEbl0jbhc4lFZSnn4SPd/pX531bblDNs/uMUaDsyuoW8y20rN9itXeM59q9ewIId2ahxS5i/9BeSdHar1vrChI9l5sJH+JgRkCV9zWDYPKnmEp90gnRtQ9qHBuMtPf42d4lJgCzpa9kNsiSr8LFMwHKutB/b8JFuf8vcrZur8aZlWHtaWteqWBMCQkAICAEnI+AaHR1desimOxz5CAEhUJGA6e5EPlUTED5VszHlCB/hY5mA5dy4uDjLBa4g17Vr166Fu5kuAlRVXiu7Aoayi4MTMJ14bdu2dfCjvPLDEz6W2Qkf4WOZgOXc2mo/MuDPMnfJFQJCQAgIASHgcAT+H8to9QEfaHEEAAAAAElFTkSuQmCC" alt="Alt text">&lt;/p>
&lt;p>We can easily find the pattern here. (Of course we can prove it.) And the code is right here.&lt;/p>
&lt;p>(But you can always find a &lt;a href="http://codeforces.com/contest/509/submission/9862199">harder way&lt;/a> to sovle it. LOL. But I have to say that &lt;strong>pypy&lt;/strong> is awesome!)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># pypy: 171ms&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># python2: 467ms&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>VOWELS &lt;span style="color:#f92672">=&lt;/span> list(&lt;span style="color:#e6db74">&amp;#39;AEIOUY&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>N &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">500010&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ds &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(N)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">1&lt;/span>, N):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ds[i] &lt;span style="color:#f92672">=&lt;/span> ds[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1.0&lt;/span> &lt;span style="color:#f92672">/&lt;/span> i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>S &lt;span style="color:#f92672">=&lt;/span> raw_input()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> len(S)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>d &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i, c &lt;span style="color:#f92672">in&lt;/span> enumerate(S):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> d &lt;span style="color:#f92672">+=&lt;/span> ds[n &lt;span style="color:#f92672">-&lt;/span> i] &lt;span style="color:#f92672">-&lt;/span> ds[i]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> c &lt;span style="color:#f92672">in&lt;/span> VOWELS:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print ans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>pypy is about 3~5 times faster than the original python interpreter, and this is the very useful tool to help us with the algorithm problems.&lt;/p>
&lt;h2 id="f-progress-monitoring">F. Progress Monitoring &lt;a href="#f-progress-monitoring" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>DP&lt;/p>
&lt;p>This problem is about the pre-order traversal with a tree. There are multiple situations of the output string given in the problem.&lt;/p>
&lt;pre tabindex="0">&lt;code>
a | b c d | | e f g h i j |
^ ^ ^
father children siblings &amp;amp; siblings children
&lt;/code>&lt;/pre>&lt;p>or&lt;/p>
&lt;pre tabindex="0">&lt;code>
a | b c d e f | | g h i j |
^ ^ ^
father children siblings &amp;amp; siblings children
&lt;/code>&lt;/pre>&lt;p>But be aware, if &lt;code>x &amp;lt; a&lt;/code>, &lt;code>a&lt;/code> and &lt;code>x&lt;/code> can&amp;rsquo;t be siblings.&lt;/p>
&lt;p>&lt;code>dp[i][j]&lt;/code> stands for the number of permutations of the subtree. whose pre-order traversal is right match the &lt;code>s[i...j]&lt;/code>, the substring of the given traversal path.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;cstdio&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;cstdlib&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;cstring&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;iostream&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;algorithm&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include &amp;lt;vector&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>using namespace std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>typedef long long llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>const llint MOD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000000000&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>const int SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">555&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint dp[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>int n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>int&lt;span style="color:#f92672">&amp;gt;&lt;/span> outvec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>void solve() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (int i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (int j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">+&lt;/span> i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int l &lt;span style="color:#f92672">=&lt;/span> j, r &lt;span style="color:#f92672">=&lt;/span> j &lt;span style="color:#f92672">+&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (l &lt;span style="color:#f92672">==&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (outvec[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">&amp;gt;&lt;/span> outvec[l]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">+=&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][r]; &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">...&lt;/span> r&lt;span style="color:#f92672">&amp;gt;&lt;/span> are siblings
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">%=&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">+=&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][r]; &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">..&lt;/span> r&lt;span style="color:#f92672">&amp;gt;&lt;/span> are child nodes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">%=&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (int k &lt;span style="color:#f92672">=&lt;/span> l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; k &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r; k&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (outvec[k] &lt;span style="color:#f92672">&amp;gt;&lt;/span> outvec[l]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint child &lt;span style="color:#f92672">=&lt;/span> dp[l &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][k &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint sibling &lt;span style="color:#f92672">=&lt;/span> dp[k][r];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[l][r] &lt;span style="color:#f92672">=&lt;/span> (dp[l][r] &lt;span style="color:#f92672">+&lt;/span> child &lt;span style="color:#f92672">*&lt;/span> sibling) &lt;span style="color:#f92672">%&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>int main() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> int x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (n &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(dp, &lt;span style="color:#ae81ff">0&lt;/span>, sizeof(dp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (int i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outvec&lt;span style="color:#f92672">.&lt;/span>push_back(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> solve();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(dp[&lt;span style="color:#ae81ff">1&lt;/span>][n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">%&lt;/span> MOD);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Codeforces Round #288 (Div. 2)</title><link>https://wizmann.top/posts/cf-288-div-2/</link><pubDate>Mon, 16 Feb 2015 21:16:30 +0000</pubDate><guid>https://wizmann.top/posts/cf-288-div-2/</guid><description>&lt;h2 id="a-pasha-and-pixels">A. Pasha and Pixels &lt;a href="#a-pasha-and-pixels" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Brute force.&lt;/p>
&lt;p>There are multiple ways to form a 2*2 square at one single step.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/6fb53c51539b47559cf0d122a832cf63" alt="Alt text">&lt;/p>
&lt;p>So at every step, we have to check the neighbours of pixel that is colored black.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">123&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> mx[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> my[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MOVE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> mp[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m, k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">isBlackBlock&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> y, &lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> MOVE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ny &lt;span style="color:#f92672">=&lt;/span> y &lt;span style="color:#f92672">+&lt;/span> my[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nx &lt;span style="color:#f92672">=&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> mx[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ny &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ny &lt;span style="color:#f92672">&amp;lt;&lt;/span> n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nx &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> nx &lt;span style="color:#f92672">&amp;lt;&lt;/span> m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> mp[ny][nx]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> cnt &lt;span style="color:#f92672">==&lt;/span> MOVE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> y, x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> k);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(mp, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(mp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(y &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x&lt;span style="color:#f92672">--&lt;/span>; y&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[y][x] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> flag &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> MOVE; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag &lt;span style="color:#f92672">|=&lt;/span> isBlackBlock(y &lt;span style="color:#f92672">-&lt;/span> my[j], x &lt;span style="color:#f92672">-&lt;/span> mx[j]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (flag) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-anton-and-currency-you-all-know">B. Anton and currency you all know &lt;a href="#b-anton-and-currency-you-all-know" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>At first, you have to understand the questions accurately.&lt;/p>
&lt;p>The exchange rate is &lt;strong>an odd number&lt;/strong>. And your mission is swap one digit with another, to make it the maximum even number.&lt;/p>
&lt;p>Because if the exchange rate is an even number, it will lead to a more sophisticated problem.&lt;/p>
&lt;p>The intuitive thought is that we can swap the hightest even digit with the last digit. However, for this case &amp;ldquo;92291&amp;rdquo;, you may swap the second digit &amp;ldquo;2&amp;rdquo; and the last digit &amp;ldquo;1&amp;rdquo;. But &amp;ldquo;91292&amp;rdquo; is not the largest number, &amp;ldquo;92192&amp;rdquo; is.&lt;/p>
&lt;p>So, ther are two scenario. First is the final answer is greater than the ordinary one. Just find out the &lt;strong>first even digit that is less than the last digit&lt;/strong>. Second is the final answer is less than the given one. If we want to make it the largest one, we have to find the &lt;strong>lowest even digit and then swap&lt;/strong>.&lt;/p>
&lt;p>We can make it by loop twice. But there is a way to find the final answer in one single iteration.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">123456&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> number[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, number);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> strlen(number);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, q &lt;span style="color:#f92672">=&lt;/span> number[len &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> len &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; i &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> u &lt;span style="color:#f92672">=&lt;/span> number[i] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (p &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">||&lt;/span> q &lt;span style="color:#f92672">&amp;gt;&lt;/span> u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (p &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(number[p], number[len &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(number);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-anya-and-ghosts">C. Anya and Ghosts &lt;a href="#c-anya-and-ghosts" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The background of this problem is quite twisted.&lt;/p>
&lt;p>First of all, we have to find out in which scenario there is no way to defence against the ghost.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/833368d068c6dc956b62d9babf01c3b6" alt="Alt text">&lt;/p>
&lt;p>It&amp;rsquo;s easy to find out in that diagram above that if the duration of the candle is less than the number of candles which is needed.&lt;/p>
&lt;p>So, before the ghost comes, we have to light up the candles. If we want to have K candles in one second, we have to light it up at second (T - 1) (T - 2) &amp;hellip; (T - K).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> sys
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(m, t, r) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ghosts &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># impossible&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> t &lt;span style="color:#f92672">&amp;lt;&lt;/span> r:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sys&lt;span style="color:#f92672">.&lt;/span>exit(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>candles &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(r)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> ghost &lt;span style="color:#f92672">in&lt;/span> ghosts:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(r):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> candles[i] &lt;span style="color:#f92672">&amp;lt;&lt;/span> ghost:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> candles[i] &lt;span style="color:#f92672">=&lt;/span> ghost &lt;span style="color:#f92672">+&lt;/span> t &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> delay
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delay &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print ans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-tanya-and-password">D. Tanya and Password &lt;a href="#d-tanya-and-password" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Tanya cut the password into three-letter continuous substrings. Our mission is to re-assemble these substrings.&lt;/p>
&lt;p>For example,&lt;/p>
&lt;pre tabindex="0">&lt;code>Password: fuckme
Substrings: fuc, uck, ckm, kme
&lt;/code>&lt;/pre>&lt;p>It&amp;rsquo;s not hard to find out that the problem is not about the &amp;ldquo;string&amp;rdquo; but the &amp;ldquo;graph&amp;rdquo;. But how to convert the string and substrings into a graph.&lt;/p>
&lt;p>At the every beginning, we regard the substrings as vertexes, every two substrings which could be connected has an edge between them.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/bbc690924ece17dde46fd5d23188bf5d" alt="Alt text">&lt;/p>
&lt;p>In this scenario, all we have to do is find a path that visit all the vertexes. This path is called &lt;strong>Hamilton path&lt;/strong>. The algorithm to find a hamilton path in a graph is quite slow with O(2 ** N) time complexity. We have to find another way.&lt;/p>
&lt;p>Similar to hamilton path, the eular path is a path that visit all the edges of the graph. And this inspires us to make the strings to another graph, and the eular path will be the final answer with the complete password.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/bd69ddd562d6b4b4cde4e3a461a8706e" alt="Alt text">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;set&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define err(x) cerr &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> BASE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> g[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> iter[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> father[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> indeg[SIZE], outdeg[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_value&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> c &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> c &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;z&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> c &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#e6db74">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> c &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> c &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Z&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> c &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">26&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> c &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> c &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;9&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> c &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">52&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> err(&lt;span style="color:#e6db74">&amp;#34;get_value_err:&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_char&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> v &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> v &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">25&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">26&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> v &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> v &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">51&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;A&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> v &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">26&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">52&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> v &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> v &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">61&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> v &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">52&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> err(&lt;span style="color:#e6db74">&amp;#34;get_char_err&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_id&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> a, &lt;span style="color:#66d9ef">char&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ia &lt;span style="color:#f92672">=&lt;/span> get_value(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ib &lt;span style="color:#f92672">=&lt;/span> get_value(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ia &lt;span style="color:#f92672">*&lt;/span> BASE &lt;span style="color:#f92672">+&lt;/span> ib;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add_edge&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> string&lt;span style="color:#f92672">&amp;amp;&lt;/span> node_str) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> get_id(node_str[&lt;span style="color:#ae81ff">0&lt;/span>], node_str[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> get_id(node_str[&lt;span style="color:#ae81ff">1&lt;/span>], node_str[&lt;span style="color:#ae81ff">2&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[a][b]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outdeg[a]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> indeg[b]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_father&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (father[x] &lt;span style="color:#f92672">==&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> father[x] &lt;span style="color:#f92672">=&lt;/span> get_father(father[x]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">is_connected&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> father[i] &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (g[i][j]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> father[get_father(i)] &lt;span style="color:#f92672">=&lt;/span> get_father(j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> set&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>indeg[i] &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>outdeg[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.insert(get_father(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> st.size() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1U&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_start_point&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>is_connected()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (outdeg[i] &lt;span style="color:#f92672">==&lt;/span> indeg[i] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (outdeg[i] &lt;span style="color:#f92672">==&lt;/span> indeg[i] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (outdeg[i] &lt;span style="color:#f92672">==&lt;/span> indeg[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> b&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> b &lt;span style="color:#f92672">==&lt;/span> SIZE &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> c &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> b &lt;span style="color:#f92672">==&lt;/span> SIZE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">dfs&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> p) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> iter[p]; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (g[p][i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[p][i]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dfs(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iter[p]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans.push_back(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_path&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> st) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> u: ans) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> u &lt;span style="color:#f92672">%=&lt;/span> BASE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> get_char(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> get_char(st &lt;span style="color:#f92672">/&lt;/span> BASE);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> reverse(res.begin(), res.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(res);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string node_str;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(node_str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> add_edge(node_str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> u &lt;span style="color:#f92672">=&lt;/span> get_start_point();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;NO&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;YES&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (u &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> u &lt;span style="color:#f92672">=&lt;/span> get_id(node_str[&lt;span style="color:#ae81ff">0&lt;/span>], node_str[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dfs(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> show_path(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="e-arthur-and-brackets">E. Arthur and Brackets &lt;a href="#e-arthur-and-brackets" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>DP + Greedy&lt;/p>
&lt;p>For this problem, be ware that the position of the right bracket is not the absolute position but the relative position. And according to the common sense, there will only be complete brackets between one left bracket and one right bracket.&lt;/p>
&lt;p>For example,&lt;/p>
&lt;pre tabindex="0">&lt;code>RIGHT: *(* ()(()) *)*
WRONG: *(* ((((() *)*
&lt;/code>&lt;/pre>&lt;p>So, it&amp;rsquo;s OK to close the bracket if possible. And this is the key to solve to problem.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>brackets &lt;span style="color:#f92672">=&lt;/span> [tuple(map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())) &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0xcafebabe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>st &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (l, r) &lt;span style="color:#f92672">in&lt;/span> brackets:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st&lt;span style="color:#f92672">.&lt;/span>append((ptr &lt;span style="color:#f92672">+&lt;/span> l, ptr &lt;span style="color:#f92672">+&lt;/span> r))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> st:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (pre_l, pre_r) &lt;span style="color:#f92672">=&lt;/span> st[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> pre_l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> ptr &lt;span style="color:#f92672">&amp;lt;=&lt;/span> pre_r:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> st:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;IMPOSSIBLE&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print res
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Sequence Median</title><link>https://wizmann.top/posts/sequence-median/</link><pubDate>Sun, 14 Dec 2014 16:51:50 +0000</pubDate><guid>https://wizmann.top/posts/sequence-median/</guid><description>&lt;h2 id="description">Description &lt;a href="#description" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Given a sequence of integer numbers, try to find the median of the sequence.&lt;/p>
&lt;h3 id="extending">Extending &lt;a href="#extending" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>Make sure your code can get the right answer in any conditions&lt;/li>
&lt;li>Make sure your code work effectively on some special kinds of sequence. For example, ordered sequence or a nearly ordered one, a sequence with few unique items.&lt;/li>
&lt;li>If the memory is not large enough for all the elements in the sequence, how can we implement this algorithm?&lt;/li>
&lt;li>If it&amp;rsquo;s not a sequence, but a data stream. How can we find the median?&lt;/li>
&lt;/ul>
&lt;h2 id="solution">Solution &lt;a href="#solution" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Finding the median is quite similar to finding the kth element.&lt;/p>
&lt;p>The basic solution to find the kth element is to sort the sequence first, and then find the kth. It&amp;rsquo;ll get the right answer, of course, but the time complexity is O(n * logn), which is not the optimized one.&lt;/p>
&lt;p>There is a vintage algorithm to get the kth_element.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">partition&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> st, &lt;span style="color:#66d9ef">int&lt;/span> end) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot &lt;span style="color:#f92672">=&lt;/span> array[st];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l &lt;span style="color:#f92672">=&lt;/span> st, r &lt;span style="color:#f92672">=&lt;/span> end &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[l] &lt;span style="color:#f92672">&amp;lt;=&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[r] &lt;span style="color:#f92672">&amp;gt;&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[l&lt;span style="color:#f92672">++&lt;/span>], array[r&lt;span style="color:#f92672">--&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[st], array[r]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">kth_element&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> n, &lt;span style="color:#66d9ef">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> kth_element(array, &lt;span style="color:#ae81ff">0&lt;/span>, n, k);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">kth_element&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> st, &lt;span style="color:#66d9ef">int&lt;/span> end, &lt;span style="color:#66d9ef">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot_idx &lt;span style="color:#f92672">=&lt;/span> partition(array, st, end);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pivot_idx &lt;span style="color:#f92672">-&lt;/span> st &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> array[pivot_idx];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pivot_idx &lt;span style="color:#f92672">-&lt;/span> st &lt;span style="color:#f92672">&amp;gt;=&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> kth_element(array, st, pivot_idx, k);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> kth_element(array, pivot_idx &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, end, k &lt;span style="color:#f92672">-&lt;/span> (pivot_idx &lt;span style="color:#f92672">-&lt;/span> st) &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">double&lt;/span> &lt;span style="color:#a6e22e">find_median&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (n &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1.0&lt;/span> &lt;span style="color:#f92672">*&lt;/span> kth_element(array, n, n &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> kth_element(array, n, n &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> kth_element(array, n, n &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (a &lt;span style="color:#f92672">+&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The time complexity of the algorithm is O(N). It works well in most conditions. But there is a potential error in the code, can you find it?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> (a &lt;span style="color:#f92672">+&lt;/span> b);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If &lt;code>a + b&lt;/code> is greater than INT_MAX, it will overflow, and make a mess to your code. The right way isï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> a &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> b;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>There is another problem in the code. If the sequence is already ordered, the algorithm will take O(N^2) time, and can&amp;rsquo;t work effectively as what we design. It is because the pivot is the very first element of the sequence (or the sub-sequence), if the sequence is ordered, we will partition the sequence into this:&lt;/p>
&lt;pre tabindex="0">&lt;code>nil ++ pivot ++ [elements]
&lt;/code>&lt;/pre>&lt;p>The solution is to use the random pivot. And we will modify the code here.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">partition&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> st, &lt;span style="color:#66d9ef">int&lt;/span> end) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (st &lt;span style="color:#f92672">==&lt;/span> end) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot_idx &lt;span style="color:#f92672">=&lt;/span> st &lt;span style="color:#f92672">+&lt;/span> random() &lt;span style="color:#f92672">%&lt;/span> (end &lt;span style="color:#f92672">-&lt;/span> st);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot &lt;span style="color:#f92672">=&lt;/span> array[pivot_idx];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[st], array[pivot_idx]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l &lt;span style="color:#f92672">=&lt;/span> st, r &lt;span style="color:#f92672">=&lt;/span> end &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[l] &lt;span style="color:#f92672">&amp;lt;=&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[r] &lt;span style="color:#f92672">&amp;gt;&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[l&lt;span style="color:#f92672">++&lt;/span>], array[r&lt;span style="color:#f92672">--&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[st], array[r]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This code will perform well for the ordered / nearly ordered data. But there is another &amp;ldquo;however&amp;rdquo;, what if there are few unique elements in the sequence?&lt;/p>
&lt;p>For example, the sequence &lt;code>[1, 1, 1, 1, 1, 1, 1]&lt;/code>. If we deal this sequence by the previous algorithms, it also takes O(N) time, because we can just separate the sequence into this:&lt;/p>
&lt;pre tabindex="0">&lt;code>[elements] + pivot + nil
&lt;/code>&lt;/pre>&lt;p>This scenario is similar as the previous one. So we have to come up a new way to cope with it.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">partition&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> array[], &lt;span style="color:#66d9ef">int&lt;/span> st, &lt;span style="color:#66d9ef">int&lt;/span> end) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (end &lt;span style="color:#f92672">-&lt;/span> st &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot_idx &lt;span style="color:#f92672">=&lt;/span> st &lt;span style="color:#f92672">+&lt;/span> rand() &lt;span style="color:#f92672">%&lt;/span> (end &lt;span style="color:#f92672">-&lt;/span> st);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[st], array[pivot_idx]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pivot &lt;span style="color:#f92672">=&lt;/span> array[st];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l &lt;span style="color:#f92672">=&lt;/span> st, r &lt;span style="color:#f92672">=&lt;/span> end &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> flag &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &amp;lt;- rewrite zone
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[l] &lt;span style="color:#f92672">&amp;lt;=&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (array[l] &lt;span style="color:#f92672">==&lt;/span> pivot &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> flag &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag &lt;span style="color:#f92672">^=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (array[l] &lt;span style="color:#f92672">==&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> array[r] &lt;span style="color:#f92672">&amp;gt;=&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (array[r] &lt;span style="color:#f92672">==&lt;/span> pivot &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> flag &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag &lt;span style="color:#f92672">^=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (array[r] &lt;span style="color:#f92672">==&lt;/span> pivot) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &amp;lt;- end of rewrite zone
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (l &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[l&lt;span style="color:#f92672">++&lt;/span>], array[r&lt;span style="color:#f92672">--&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> swap(array[st], array[r]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This code could put the same number into left part and right part by half.&lt;/p>
&lt;p>With all these optimization, you can get an &lt;strong>Accepted&lt;/strong> in the problem &lt;a href="http://poj.org/problem?id=2623">POJ-2623&lt;/a>. But be ware, the function to initizalize of random number, &lt;code>srand(time(NULL))&lt;/code>, is disallowed when using the G++ compiler, please choose C++ instead.&lt;/p>
&lt;p>There&amp;rsquo;s always something next, if we don&amp;rsquo;t have enough memory to storage all the data in the sequence. We will use a heap to find the kth_element, and that will save half of the memory space. But the time complexity is O(n * logn) here.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// This is a bad code :)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> n &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> priority_queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> pq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%lld&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.push(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ((&lt;span style="color:#66d9ef">int&lt;/span>)pq.size() &lt;span style="color:#f92672">&amp;gt;&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (n &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%.1f&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">1.&lt;/span> &lt;span style="color:#f92672">*&lt;/span> pq.top());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> pq.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> pq.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%.1f&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">double&lt;/span>(a &lt;span style="color:#f92672">+&lt;/span> b) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2.&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Okay, there is the last problem: what if the sequence is a stream that you have to find the median whenver a new number comes in? The solution is using two heaps. The max heap storages the numbers which less than the median, and the min heap storages the numbers which greater than the median.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MaxHeap&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> priority_queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> {};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> T&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MinHeap&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> priority_queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>T, vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span>, greater&lt;span style="color:#f92672">&amp;lt;&lt;/span>T&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> {};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MedianStream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> add(&lt;span style="color:#66d9ef">int&lt;/span> u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (_max_heap.empty() &lt;span style="color:#f92672">||&lt;/span> u &lt;span style="color:#f92672">&amp;lt;=&lt;/span> _max_heap.top()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _max_heap.push(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _min_heap.push(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_adjust();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _size&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">double&lt;/span> &lt;span style="color:#a6e22e">get_median&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (_size &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1.0&lt;/span> &lt;span style="color:#f92672">*&lt;/span> _max_heap.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> _max_heap.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> _min_heap.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> a &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">0.5&lt;/span> &lt;span style="color:#f92672">*&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> do_adjust() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (_max_heap.size() &lt;span style="color:#f92672">&amp;gt;&lt;/span> _min_heap.size() &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _min_heap.push(_max_heap.top());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _max_heap.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (_min_heap.size() &lt;span style="color:#f92672">&amp;gt;&lt;/span> _max_heap.size()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _max_heap.push(_min_heap.top());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _min_heap.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size_t _size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MaxHeap&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> _max_heap;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MinHeap&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> _min_heap;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç±»å‹-é•¿åº¦-å€¼ï¼ˆTLVï¼‰åè®®</title><link>https://wizmann.top/posts/tlv-protocol/</link><pubDate>Mon, 17 Nov 2014 00:25:42 +0000</pubDate><guid>https://wizmann.top/posts/tlv-protocol/</guid><description>&lt;p>åœ¨æ•°æ®é€šä¿¡åè®®ä¸­ï¼Œå¯é€‰çš„ä¿¡æ¯æˆ–å­—æ®µé€šå¸¸ä½¿ç”¨type-length-valueï¼ˆa.k.a TLVï¼‰å…ƒç´ æ¥è¿›è¡Œç¼–ç ã€‚&lt;/p>
&lt;ul>
&lt;li>Type - ç±»å‹&lt;/li>
&lt;/ul>
&lt;p>ç”¨æ¥æ ‡ç¤ºå­—æ®µç±»å‹çš„å€¼ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å€¼æˆ–ç®€å•çš„å­—æ¯&lt;/p>
&lt;ul>
&lt;li>Length - é•¿åº¦&lt;/li>
&lt;/ul>
&lt;p>å­—æ®µé•¿åº¦ï¼Œå•ä½é€šå¸¸ä¸ºByte&lt;/p>
&lt;ul>
&lt;li>Value - å€¼&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ªå˜é•¿çš„æ¯”ç‰¹æ•°ç»„ç”¨æ¥å­˜å‚¨è¿™ä¸ªå­—æ®µçš„å€¼&lt;/p>
&lt;h2 id="ä¼˜åŠ¿">ä¼˜åŠ¿ &lt;a href="#%e4%bc%98%e5%8a%bf" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>TLVåºåˆ—æ–¹ä¾¿éå†æŸ¥æ‰¾&lt;/li>
&lt;li>æ–°çš„å­—æ®µå¯ä»¥æ— ç—›çš„åŠ å…¥ç°æœ‰çš„åè®®ä¸­ã€‚è§£æçš„æ—¶å€™ï¼Œå¯¹äºæœªçŸ¥çš„å­—æ®µï¼Œå¯ä»¥è½»æ¾çš„è·³è¿‡ã€‚è¿™ç‚¹ä¸XMLç±»ä¼¼&lt;/li>
&lt;li>TLVå…ƒç´ çš„é¡ºåºå¯ä»¥æ˜¯éšæ„çš„&lt;/li>
&lt;li>TLVå…ƒç´ é€šå¸¸ä½¿ç”¨äºŒè¿›åˆ¶å­˜å‚¨ï¼Œå¯ä»¥ä½¿è§£æé€Ÿåº¦åŠ å¿«å¹¶ä¸”ä½¿æ•°æ®æ›´å°&lt;/li>
&lt;li>TLVå¯ä»¥ä¸XMLæ•°æ®ç›¸äº’è½¬æ¢ï¼Œæ˜“äºäººç±»é˜…è¯»&lt;/li>
&lt;/ul>
&lt;h2 id="ä¾‹å­">ä¾‹å­ &lt;a href="#%e4%be%8b%e5%ad%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥protobufçš„å¯é€‰å’Œå˜é•¿å­—æ®µä¸ºä¾‹ã€‚&lt;/p>
&lt;h3 id="field_number--wire_type">field_number ++ wire_type &lt;a href="#field_number--wire_type" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ¯ä¸€ä¸ªprotobufçš„å­—æ®µåœ¨ä¼ è¾“æ—¶ï¼Œéƒ½ä¼šåŠ ä¸Š&lt;code>field_number&lt;/code>å’Œ&lt;code>wire_type&lt;/code>è¿™ä¸¤ä¸ªå€¼ï¼Œè¿™ä¸¤ä¸ªå€¼ç»„æˆè¿™ä¸ªå­—æ®µçš„keyã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>key = (field_number &amp;lt;&amp;lt; 3) | wire_type
&lt;/code>&lt;/pre>&lt;p>&lt;code>field_number&lt;/code>æ ‡æ˜äº†å­—æ®µçš„ç¼–å·ï¼Œæ–¹ä¾¿åè®®å‘å‰å‘åçš„å…¼å®¹ã€‚è€Œ&lt;code>wire_type&lt;/code>æ ‡æ˜å­—æ®µçš„ç±»å‹ï¼Œæ–¹ä¾¿è§£æç¨‹åºä½¿ç”¨ç›¸åº”çš„æ–¹æ³•æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚&lt;/p>
&lt;h3 id="varint-å˜é•¿æ•´å‹">Varint å˜é•¿æ•´å‹ &lt;a href="#varint-%e5%8f%98%e9%95%bf%e6%95%b4%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¯¹äºä¸€ä¸ªå˜é•¿æ•´å‹å­—æ®µï¼Œprotobufä¸­ä½¿ç”¨Type(0)æ¥æ ‡ç¤ºï¼Œè€Œé•¿åº¦å¹¶æ²¡æœ‰æ˜¾å¼çš„æ ‡å‡ºã€‚&lt;/p>
&lt;p>Varintçš„å€¼ä½¿ç”¨å¦‚ä¸‹ç¼–ç æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>Varintä½¿ç”¨åˆ†æ®µå­˜å‚¨æ–¹æ³•ï¼Œæ¯ä¸ªByteä¸ºä¸€æ®µ&lt;/li>
&lt;li>Varintæ¯æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ ‡ç¤ºä½ï¼Œå¦‚æœè¿™ä¸€ä½æ˜¯1ï¼Œåˆ™ä¸‹ä¸€ä¸ªByteä¹Ÿæ˜¯è¿™ä¸ªæ•°çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœè¿™ä¸€ä½æ˜¯0ï¼Œåˆ™åœ¨è¿™ä¸ªByteæ˜¯è¿™ä¸ªVarintçš„æœ€åä¸€ä¸ªByte&lt;/li>
&lt;/ul>
&lt;h3 id="string-å˜é•¿å­—ç¬¦ä¸²">String å˜é•¿å­—ç¬¦ä¸² &lt;a href="#string-%e5%8f%98%e9%95%bf%e5%ad%97%e7%ac%a6%e4%b8%b2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å­—ç¬¦ä¸²è¢«æ ‡ç¤ºä¸ºType(2)ï¼Œé•¿åº¦ä½¿ç”¨Varintç±»å‹æ˜¾å¼æ ‡å‡ºã€‚&lt;/p>
&lt;p>ä¸€ä¸ªstringåœ¨protobufä¸­è¢«ç¼–ç ä¸ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>encoded_string = key ++ length ++ string
&lt;/code>&lt;/pre>&lt;h2 id="å…¶å®ƒæ–¹æ³•">å…¶å®ƒæ–¹æ³• &lt;a href="#%e5%85%b6%e5%ae%83%e6%96%b9%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>TLVåŒæ ·ä¹Ÿå¯ä»¥è¡¨ç¤ºtag-length valueï¼Œä¾‹å¦‚HTTPã€FTPã€POP3ç­‰åè®®éƒ½æ˜¯ä½¿ç”¨è¿™ç§åŸºäºå¯è¯»æ–‡æœ¬çš„&amp;quot;Field: Value&amp;quot;åè®®ã€‚è¿™æ ·è®¾è®¡çš„åŸå› å¤§æ¦‚æ˜¯ç”±äºåœ¨â€œä¸Šå¤æ—¶ä»£â€ï¼Œäº’è”ç½‘é€Ÿåº¦è¿œå°äºCPUå¤„ç†çš„é€Ÿç‡ï¼ˆç°åœ¨æ›´åº”è¯¥æ˜¯&lt;strong>è¿œè¿œå°äº&lt;/strong>ï¼ŒCPUå·²ç»çˆ†äº†IOä¸€æ¡è¡—äº†ï¼‰ï¼Œè®¾è®¡ä¸€äº›æ›´å¯è¯»çš„åè®®å¯¹äººç±»æ¥è¯´ç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚&lt;/p>
&lt;p>è€ŒTCP/IPæ ¸å¿ƒåè®®éƒ½ä½¿ç”¨çš„å®šé•¿ä¸å¯å˜çš„åè®®ï¼Œè¿™æ ·å¯ä»¥ä½¿ç¼–ç ã€è§£æé€Ÿç‡è¾¾åˆ°æœ€å¿«ã€‚&lt;/p>
&lt;p>å¯¹äºXMLå’Œjsonè¿™ç§å¥‡è¡Œç§ï¼Œæˆ‘ä»¬å°±ä¸è¯´äº†å§ :)&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://en.wikipedia.org/wiki/Type-length-value">Type-length-value&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.cnblogs.com/shitouer/archive/2013/04/12/google-protocol-buffers-encoding.html">Google Protocol Buffers ç¼–ç (Encoding)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Reasons They Recruit</title><link>https://wizmann.top/posts/reasons-they-recruit/</link><pubDate>Sun, 16 Nov 2014 01:03:14 +0000</pubDate><guid>https://wizmann.top/posts/reasons-they-recruit/</guid><description>&lt;blockquote>
&lt;p>From &lt;em>Ace of Programming Interview&lt;/em>, Cpt1 - Hiring Programmers: The Inside Story&lt;/p>&lt;/blockquote>
&lt;h2 id="establish-a-rapport">Establish a Rapport &lt;a href="#establish-a-rapport" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>For an interviewee, one the the most efficient way to build a rapport is to &lt;strong>try to see things in from the interviewer&amp;rsquo;s perspective&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>understand the motivation of the interviewer&lt;/li>
&lt;li>establishing a common ground&lt;/li>
&lt;li>adapting your responses appropritely&lt;/li>
&lt;/ul>
&lt;h2 id="reasons-they-recruit">Reasons They Recruit &lt;a href="#reasons-they-recruit" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>If you know what the reason is and understand the motivation for it, then you can optimize your approach accordingly.&lt;/p>
&lt;h3 id="planned-expansion">Planned Expansion &lt;a href="#planned-expansion" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>This is a common scenario that the company&amp;rsquo;s expansion require them to take on more programmers accordance with the comming business growth.&lt;/p>
&lt;h4 id="the-interviewer-vs-you">The Interviewer vs. You &lt;a href="#the-interviewer-vs-you" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>As the hiring is due to a long plan, so the interviewer is unlikely to feel a great sence of urgency. The interviewer will have a well prepared job description (a.k.a JD), or even a person profile. The interviewer are unlikely to compromise their pre-determined requirements. If you are deviate from their expectation, they will probable be less open to giving you the offer.&lt;/p>
&lt;p>Your approach is to &lt;strong>highlight&lt;/strong> these areas which matches to the job profile. That&amp;rsquo;s the easy part.&lt;/p>
&lt;p>If your skills are not a good fit, you can use these three tricks below to change the situation.&lt;/p>
&lt;ul>
&lt;li>Play it down&lt;/li>
&lt;/ul>
&lt;p>Your first choice is to downplay the perceived gap in skills &amp;ndash; including the option of substituting other experience as being of equivalent value.&lt;/p>
&lt;p>For example,&lt;/p>
&lt;blockquote>
&lt;p>â€œItâ€™s been my experience that it never takes long to learn the basics of a new component library, since, as programmers, we face an endless supply of new components and frameworks both open source and from the major vendors.â€&lt;/p>&lt;/blockquote>
&lt;p>or,&lt;/p>
&lt;blockquote>
&lt;p>â€œOne thing I really like about programming is the experience of learning new
technologies and platforms. Itâ€™s part of the ongoing attraction of the job.â€&lt;/p>&lt;/blockquote>
&lt;p>However, the biggest risk in taking this approach is that you might appear evasive, so be wary of overdoing it.&lt;/p>
&lt;ul>
&lt;li>Take it on the chin&lt;/li>
&lt;/ul>
&lt;p>If you decide to take it on the chin, simply agree with the interviewer&amp;rsquo;s observation and at the same time show your enthusiasm for learning something new.&lt;/p>
&lt;blockquote>
&lt;p>â€œI donâ€™t have experience of that particular technology but I would really enjoy learning it.â€&lt;/p>&lt;/blockquote>
&lt;p>If the interviewer persists, you might feel it appropriate to ask how other developers in the team might learn new things.&lt;/p>
&lt;blockquote>
&lt;p>â€œCould you describe how the developers in your team generally learn new skills?â€&lt;/p>&lt;/blockquote>
&lt;p>Each example the interviewer gives you is an opportunity to show how, as a part of the team, you would &lt;strong>benefit the same approach&lt;/strong> and so acquire the necessary skill.&lt;/p>
&lt;ul>
&lt;li>Understand the requirement&lt;/li>
&lt;/ul>
&lt;p>Your third option is to gently probe the motives underpinning the requirement. The basic idea is that you explore the requirement looking to show that you understand and can meaningfully address the underlying requirement despite lacking a specific skill or experience.&lt;/p>
&lt;p>Whatever approach you take, keep in mind that you should not &lt;strong>dwell on any particular mismatch&lt;/strong>. In particular, keep you comment brief and to the point. The more you talk about it, the more prominence it will have in the interviewer&amp;rsquo;s memory of the interview when they reflect afterward.&lt;/p>
&lt;h3 id="specific-projet">Specific Projet &lt;a href="#specific-projet" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>When a company spots an opportunity in the market, it might scramble to put
together a development team focused on delivering a solution to capitalize on
the opportunity.&lt;/p>
&lt;h4 id="the-interviewer-vs-you-1">The Interviewer vs. You &lt;a href="#the-interviewer-vs-you-1" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>The interviewer wants to know that you can work under pressure, and that you are someone who finishes what you start. Sometimes that the pressure to hire can relax the strictness with which the interviewer will match your experience against the details of job specification, although of course you can&amp;rsquo;t assume that case.&lt;/p>
&lt;p>Be ware that although you have to demonstrate how your skills and experience are good match for the position, the interviewer also probable has the need of specific project in mind. You enthusiasm and ability to adapt might count for more than usual. Showing an ability of &lt;strong>grasp key aspect of project&lt;/strong> give you an advantage over others.&lt;/p>
&lt;p>If you are not sure of the motivation of hiring, there&amp;rsquo;s absolutely no harm to ask directly:&lt;/p>
&lt;blockquote>
&lt;p>Could I ask why you are recruiting? Is it for a specific project?&lt;/p>&lt;/blockquote>
&lt;h3 id="replacing-someone">Replacing Someone &lt;a href="#replacing-someone" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>This is another common reason for hiring simply to replace someone who is leaving or has left the company.&lt;/p>
&lt;h4 id="the-interviewer-vs-you-2">The Interviewer vs. You &lt;a href="#the-interviewer-vs-you-2" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>An interesting aspect of this situation is that they will probably have experience of a previous person i lling this role, for better or for worse, and will therefore have a list of things they want to ensure the next person will and wonâ€™t bring to the role.&lt;/p>
&lt;p>Unless you are very lucky, you can&amp;rsquo;t gather insight into what interviewer like or dislike prior to the interview. What you can do at the interview is ask about &lt;strong>unique challenge for the role&lt;/strong>, things for which you might to need to be on guard, and so on:&lt;/p>
&lt;blockquote>
&lt;p>â€œCould you tell me a bit about the challenges of this role that might make it different from the usual programming job?â€&lt;/p>&lt;/blockquote>
&lt;p>If you ask right questions, you may get vatal clues about the things you need to highlight with regard to your experience and ability:&lt;/p>
&lt;blockquote>
&lt;p>â€œCan I ask whether there have been issues about how the team has been working together that make this ability particularly important?â€&lt;/p>&lt;/blockquote></description></item><item><title>Quora - What are effective ways to assess if someone is good at "getting things done"?</title><link>https://wizmann.top/posts/good-at-get-things-done/</link><pubDate>Sat, 15 Nov 2014 16:08:10 +0000</pubDate><guid>https://wizmann.top/posts/good-at-get-things-done/</guid><description>&lt;blockquote>
&lt;p>Ian McAllister, GM at Amazon. I lead the AmazonSmile program.&lt;/p>&lt;/blockquote>
&lt;p>First, letâ€™s break â€œgetting things doneâ€ into two components: â€œexcellent functional skillsâ€ and â€œdriveâ€. Someone with great functional skills but poor drive will not get (enough) things done. Someone with great drive but poor functional skills will not get things done, or theyâ€™ll do the wrong things, or theyâ€™ll do the right things shittily.&lt;/p>
&lt;ul>
&lt;li>Excellent functional skills&lt;/li>
&lt;/ul>
&lt;p>You can probe for domain knowledge and functional skills effectively in an interview or on a phone call. You come up with a list of role-specific responsibilities, probe deeply (several levels below the surface) into past examples where theyâ€™ve done similar work, and give them example challenges and see how they perform. You can make allowances for language or tool by letting them pick the language or tool of their choice, but donâ€™t give them a pass on accomplishing the task set forth.&lt;/p>
&lt;ul>
&lt;li>Drive&lt;/li>
&lt;/ul>
&lt;p>Drive is tougher to gauge effectively. Youâ€™ll have to form a picture of drive based on a number of different signals, and use your judgment on how heavily to weight each one.&lt;/p>
&lt;p>Projects theyâ€™ve initiated - Are they spawning new projects, based on their own ideas or prototypes? If so, thatâ€™s evidence theyâ€™re pushing the boundaries of their role in good ways. If they havenâ€™t, then they might make a good soldier, but youâ€™ll know going in that theyâ€™ll always need someone to tell them what to do next.&lt;/p>
&lt;p>Variation in projects or roles - Have they worked on the same types of projects for 5+ years? If so, they might have deep knowledge and be able to get things done in that domain, but it is evidence that they have a comfort zone. They clearly donâ€™t have a drive to leave or expand their comfort zone, and may not be effective if your role places them outside of it. Look for evidence that a candidate has initiated some type of change in the type of work they do.&lt;/p>
&lt;p>Progression in complexity of projects or roles - Someone good at getting things done gets more done over time. Often the results of this are not more projects, but projects of larger scope and complexity. A good rÃ©sumÃ© will show this, but you can also probe for it explicitly.&lt;/p>
&lt;p>Side projects - I have a hard time hiring engineers, web developers, or designers (maker roles) who donâ€™t have a history of side projects. These days, if youâ€™re hiring a young engineer youâ€™re looking for one who has been coding since she was twelve (or younger).&lt;/p>
&lt;p>I intend to add more signals as I think of them, but hopefully these are a start.&lt;/p></description></item><item><title>The Checklist of Steve Yegge</title><link>https://wizmann.top/posts/steve-yegge-interview-checklist/</link><pubDate>Sun, 26 Oct 2014 00:24:44 +0000</pubDate><guid>https://wizmann.top/posts/steve-yegge-interview-checklist/</guid><description>&lt;blockquote>
&lt;p>Hey man, I don&amp;rsquo;t know that stuff&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Stevey&amp;rsquo;s talking aboooooout&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>If my boss thinks it&amp;rsquo;s important&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>I&amp;rsquo;m gonna get fiiiiiiiiiired&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Oooh yeah baaaby baaaay-beeeeee&amp;hellip;.&lt;/p>&lt;/blockquote>
&lt;h2 id="éæŠ€æœ¯éƒ¨åˆ†">éæŠ€æœ¯éƒ¨åˆ† &lt;a href="#%e9%9d%9e%e6%8a%80%e6%9c%af%e9%83%a8%e5%88%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="çƒ­èº«">çƒ­èº« &lt;a href="#%e7%83%ad%e8%ba%ab" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="å¥½å¥½è¯»ä¸€æœ¬è®²æ•°æ®ç»“æ„å’Œç®—æ³•çš„ä¹¦">å¥½å¥½è¯»ä¸€æœ¬è®²æ•°æ®ç»“æ„å’Œç®—æ³•çš„ä¹¦ &lt;a href="#%e5%a5%bd%e5%a5%bd%e8%af%bb%e4%b8%80%e6%9c%ac%e8%ae%b2%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%92%8c%e7%ae%97%e6%b3%95%e7%9a%84%e4%b9%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç†Ÿæ‚‰ä¸€äº›â€œæœ¯è¯­â€ï¼Œå¯ä»¥å¼ºåŒ–åˆ†è¾¨é—®é¢˜çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>Yeggeæ¨èäº† Steven S. Skiena çš„&lt;a href="http://book.douban.com/subject/4048566/">ã€Šç®—æ³•è®¾è®¡æ‰‹å†Œã€‹&lt;/a>ï¼Œè€Œæˆ‘æ¨èçš„æ˜¯
Udi Manber çš„&lt;a href="http://book.douban.com/subject/1436134/">ã€Šç®—æ³•å¼•è®ºã€‹&lt;/a>ã€‚&lt;/p>
&lt;p>æ¯ä¸€æœ¬ä¹¦éƒ½æœ‰å®ƒçš„é•¿å¤„çŸ­å¤„ã€‚æ‰¾ä¸€æœ¬è¯„ä»·ä¸é”™çš„ä¹¦ï¼Œè®¤çœŸè¯»å®Œï¼Œè‚¯å®šä¼šæœ‰æ”¶è·ã€‚&lt;/p>
&lt;h4 id="æ‰¾ä¸ªæœ‹å‹æ¥é¢è¯•ä½ å°è¯•ç™½æ¿ç¼–ç¨‹">æ‰¾ä¸ªæœ‹å‹æ¥é¢è¯•ä½ ï¼Œå°è¯•ç™½æ¿ç¼–ç¨‹ &lt;a href="#%e6%89%be%e4%b8%aa%e6%9c%8b%e5%8f%8b%e6%9d%a5%e9%9d%a2%e8%af%95%e4%bd%a0%e5%b0%9d%e8%af%95%e7%99%bd%e6%9d%bf%e7%bc%96%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨ç™½çº¸/ç™½æ¿ä¸Šç¼–ç¨‹çš„ä½“éªŒå’Œåœ¨è®¡ç®—æœºä¸Šå¤§æœ‰ä¸åŒã€‚æ²¡æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¯•è¯•Leetcodeçš„â€œPick oneâ€ï¼Œç„¶ååœ¨ç™½çº¸ä¸Šç»ƒä¹ å§ï¼&lt;/p>
&lt;h4 id="åœ¨é¢è¯•å‰ä¿æŒè­¦é†’å……åˆ†çƒ­èº«">åœ¨é¢è¯•å‰ä¿æŒè­¦é†’ï¼Œå……åˆ†çƒ­èº« &lt;a href="#%e5%9c%a8%e9%9d%a2%e8%af%95%e5%89%8d%e4%bf%9d%e6%8c%81%e8%ad%a6%e9%86%92%e5%85%85%e5%88%86%e7%83%ad%e8%ba%ab" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>è¯»è¯»ä¹¦è®°&lt;/li>
&lt;li>å–ç‚¹å’–å•¡ï¼Œè¿™å¯ä»¥è®©ä½ çš„æ€è·¯å¿«ä¸€äº›&lt;/li>
&lt;/ul>
&lt;h3 id="å¿ƒç†å‡†å¤‡">å¿ƒç†å‡†å¤‡ &lt;a href="#%e5%bf%83%e7%90%86%e5%87%86%e5%a4%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="ä¿æŒè°¦é€Šå¼€æ˜ä¸“æ³¨çš„æ€åº¦">ä¿æŒè°¦é€Šã€å¼€æ˜ã€ä¸“æ³¨çš„æ€åº¦ &lt;a href="#%e4%bf%9d%e6%8c%81%e8%b0%a6%e9%80%8a%e5%bc%80%e6%98%8e%e4%b8%93%e6%b3%a8%e7%9a%84%e6%80%81%e5%ba%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ä¸è¦è´¨ç–‘é¢è¯•å®˜çš„æ°´å¹³ï¼Œä½†æ˜¯ä¹Ÿä¸è¦å®³æ€•é—®é—®é¢˜ã€‚é—®ä¸€ä¸ªè ¢é—®é¢˜æ€»æ¯”æ²‰é»˜åƒµæŒåŠå°æ—¶è¦å¥½çš„å¤šã€‚å†µä¸”ï¼Œä¸€ä¸ªå¥½é—®é¢˜ä¹Ÿè®¸è¿˜æ˜¯ä¸€ä¸ªåŠ åˆ†é¡¹ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ï¼Œä¸è¦å°è¯•å»è½¬ç§»è¯é¢˜ï¼ŒæŠŠæ³¨æ„åŠ›æ”¾åœ¨é—®é¢˜æœ¬èº«ã€‚&lt;/p>
&lt;h4 id="äº†è§£é¢è¯•å®˜å¯¹ä»£ç çš„è¦æ±‚">äº†è§£é¢è¯•å®˜å¯¹ä»£ç çš„è¦æ±‚ &lt;a href="#%e4%ba%86%e8%a7%a3%e9%9d%a2%e8%af%95%e5%ae%98%e5%af%b9%e4%bb%a3%e7%a0%81%e7%9a%84%e8%a6%81%e6%b1%82" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æœ‰çš„é¢è¯•å®˜ä¸ä¼šè¦æ±‚ä½ å†™ä»£ç ï¼Œä½†æ˜¯ä»–ä»¬å¸Œæœ›ä½ åœ¨å›ç­”é—®é¢˜æ—¶å†™ä¸€ç‚¹ä»£ç ã€‚å¦‚æœä½ ä¸èƒ½ç¡®å®šï¼Œä¸å¦¨ç›´æ¥é—®ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>ä¸åŒçš„é¢è¯•å®˜å¯¹äºé¢è¯•ä»£ç é£æ ¼çš„è¦æ±‚æ˜¯ä¸ä¸€è‡´çš„ï¼Œå¯¹äºè‹›åˆ»çš„é¢è¯•å®˜ï¼Œæœ€å¥½æé«˜å¯¹ä»£ç çš„è¦æ±‚ã€‚å¹¶ä¸”ä»”ç»†æ£€æŸ¥ã€‚&lt;/p>
&lt;h4 id="é—®é—®é¢˜çš„è‰ºæœ¯">é—®é—®é¢˜çš„è‰ºæœ¯ &lt;a href="#%e9%97%ae%e9%97%ae%e9%a2%98%e7%9a%84%e8%89%ba%e6%9c%af" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨é¢è¯•ä¸­çš„æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹æ˜¯å¯ä»¥é—®çš„ï¼ˆå¹¶ä¸”é—®é—®é¢˜æ˜¯è¢«é¼“åŠ±çš„ï¼‰ï¼Œæœ‰æ—¶å€™è¿˜å¯ä»¥å»å’Œé¢è¯•å®˜ç¡®è®¤è‡ªå·±æ˜¯ä¸æ˜¯åœ¨æ­£ç¡®çš„æ–¹å‘ä¸Šã€‚&lt;/p>
&lt;p>ä»€ä¹ˆéƒ½ä¸é—®ï¼Œç›´æ¥å†²åˆ°ç™½æ¿å‰å¼€å§‹å†™ä»£ç æœ‰å¯èƒ½ä¼šç•™ä¸‹â€œè®¾è®¡æ— ç”¨â€çš„åå°è±¡ã€‚æ‰€ä»¥ï¼Œå³ä½¿ä½ ç¡®å®šè‡ªå·±æ€ä¹ˆåšï¼Œä¹Ÿè¦å…ˆè¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆæ ·çš„ã€‚ä½†æ˜¯ï¼Œä¹Ÿä¸è¦è¯´çš„å¤ªå¤šã€‚&lt;/p>
&lt;h4 id="è‡ªå¸¦é«˜çº§è£…å¤‡">è‡ªå¸¦é«˜çº§è£…å¤‡ &lt;a href="#%e8%87%aa%e5%b8%a6%e9%ab%98%e7%ba%a7%e8%a3%85%e5%a4%87" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>ç»†å¤´å¯æ“¦é©¬å…‹ç¬”&lt;/li>
&lt;li>é“…ç¬”å’Œæ©¡çš®&lt;/li>
&lt;/ul>
&lt;p>åœ¨é¢è¯•ä¸­è¦ä½¿ç”¨ä¸€åˆ‡å¯ä»¥ä½¿ç”¨çš„èµ„æºï¼Œä¾‹å¦‚ç™½æ¿ä¸Šçš„ç©ºé—´ç®¡ç†ã€‚&lt;/p>
&lt;h2 id="æŠ€æœ¯éƒ¨åˆ†">æŠ€æœ¯éƒ¨åˆ† &lt;a href="#%e6%8a%80%e6%9c%af%e9%83%a8%e5%88%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ç®—æ³•">ç®—æ³• &lt;a href="#%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å¤§O&lt;/li>
&lt;li>æ’åºç®—æ³• â€”â€” å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åº&lt;/li>
&lt;li>å“ˆå¸Œè¡¨&lt;/li>
&lt;li>æ ‘ â€”â€” æ„é€ å’Œéå†&lt;/li>
&lt;li>è‡³å°‘ç†Ÿæ‚‰ä¸€ç§å¹³è¡¡äºŒå‰æ ‘ â€”â€” å¿…é¡»æŒæ¡å®ç°ç»†èŠ‚&lt;/li>
&lt;li>å›¾ â€”â€” å­˜å‚¨ä¸éå†ï¼ŒDijkstraå’ŒA*&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ¯æ¬¡é‡åˆ°é—®é¢˜ï¼Œé¦–å…ˆåº”å½“è€ƒè™‘çš„å°±æ˜¯å›¾ç®—æ³•ã€‚å®ƒä»¬æ˜¯ä»»ä½•å…³ç³»æœ€åŸºæœ¬ã€æœ€çµæ´»çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä»»ä½•æœ‰ç‚¹æ„æ€çš„è®¾è®¡é—®é¢˜å¯ä»¥è¯´æœ‰ä¸€åŠçš„æœºä¼šæ¶‰åŠå›¾ç®—æ³•ã€‚åªæœ‰åœ¨ä½ ç™¾åˆ†ä¹‹ç™¾ç¡®å®šæ²¡åŠæ³•ç”¨å›¾ç®—æ³•æ¥è§£çš„æ—¶å€™ï¼Œæ‰èƒ½å»è€ƒè™‘å…¶å®ƒæ–¹æ¡ˆã€‚è¿™æ¡å»ºè®®ä¸€å®šè¦ç‰¢è®°åœ¨å¿ƒï¼&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>NPé—®é¢˜ â€”â€” åº”è¯¥çŸ¥é“NPå®Œå…¨é—®é¢˜æ˜¯ä»€ä¹ˆæ„æ€&lt;/li>
&lt;li>å¥½å¥½è¯»æ•°æ®ç»“æ„ä¹¦ï¼Œ&lt;strong>èƒ½è®°å¤šå°‘è®°å¤šå°‘&lt;/strong>&lt;/li>
&lt;li>ç¦»æ•£æ•°å­¦ â€”â€” è®¡æ•°é—®é¢˜ã€æ¦‚ç‡é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h3 id="è®¡ç®—æœºåŸºç¡€çŸ¥è¯†">è®¡ç®—æœºåŸºç¡€çŸ¥è¯† &lt;a href="#%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ &lt;a href="#%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;ul>
&lt;li>è¿›ç¨‹ã€çº¿ç¨‹ã€å¹¶å‘&lt;/li>
&lt;li>é”ã€äº’æ–¥é”ã€ä¿¡å·é‡ï¼Œç®¡ç¨‹æœºåˆ¶&lt;/li>
&lt;li>æ­»é”å’Œæ´»é”&lt;/li>
&lt;li>è¿›ç¨‹å’Œçº¿ç¨‹å„éœ€è¦ä»€ä¹ˆèµ„æºã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€è°ƒåº¦&lt;/li>
&lt;/ul>
&lt;p>ä½œè€…æ¨èäº† Doug Lea çš„&lt;a href="http://book.douban.com/subject/1244021/">ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹&lt;/a>ï¼Œåšä¸ºä¸€ä¸ªJava haterï¼Œæˆ‘å†³å®šè¿˜æ˜¯å‹‰ä¸ºå…¶éš¾çš„çœ‹ä¸€ä¸‹å§ã€‚:)&lt;/p>
&lt;h4 id="è¯­è¨€">è¯­è¨€ &lt;a href="#%e8%af%ad%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è‡³å°‘è¦ç†Ÿç»ƒæŒæ¡ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæœ€å¥½æ˜¯C++æˆ–è€…Javaã€‚å¹¶ä¸”&lt;strong>ä¸€å®šè¦å¯¹é‚£é—¨è¯­è¨€çš„ç»†èŠ‚æœ‰ç›¸å½“ç¨‹åº¦çš„äº†è§£&lt;/strong>ã€‚&lt;/p>
&lt;h4 id="å…¶å®ƒçš„åŸºç¡€çŸ¥è¯†">å…¶å®ƒçš„åŸºç¡€çŸ¥è¯† &lt;a href="#%e5%85%b6%e5%ae%83%e7%9a%84%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨ä½œè€…çš„æ–‡ç« ä¸­æ²¡æœ‰æåˆ°çš„ï¼Œä½†æ˜¯ä¹Ÿè®¸æ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;ul>
&lt;li>CSä¸“ä¸šç¬¬äºŒé‡è¦çš„çŸ¥è¯† â€”â€” ç¼–è¯‘åŸç†&lt;/li>
&lt;li>è®¡ç®—æœºç½‘ç»œ â€”â€” TCP/IPåè®®ä¹Ÿè®¸æ˜¯ä¸ªé‡ç‚¹&lt;/li>
&lt;li>æ•°æ®åº“çš„ä¸€äº›çŸ¥è¯†&lt;/li>
&lt;li>MapReduceï¼Ÿ&lt;/li>
&lt;/ul>
&lt;h2 id="å…¶å®ƒ">å…¶å®ƒ &lt;a href="#%e5%85%b6%e5%ae%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å‰©ä¸‹çš„åŸºæœ¬å°±æ˜¯çœ‹è„¸äº†ã€‚ã€‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-pic/fa4b0cfd335bae28abf23d34fc6e84ee" alt="puzzles">&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å¥½å¥½çƒ­èº«ã€‚å®é™…å·¥ä½œåªä¼šè®©ä½ ååº”è¿Ÿé’ï¼&lt;/p>&lt;/blockquote></description></item><item><title>Snake Problem</title><link>https://wizmann.top/posts/snake-problem/</link><pubDate>Mon, 20 Oct 2014 09:11:27 +0000</pubDate><guid>https://wizmann.top/posts/snake-problem/</guid><description>&lt;h2 id="é¢˜ç›®">é¢˜ç›® &lt;a href="#%e9%a2%98%e7%9b%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸€ä¸ªå¹³é¢ä¸Šï¼Œæœ‰n+mæ¡è›‡ï¼Œå…¶ä¸­næ¡è›‡æ²¿æ°´å¹³æ–¹å‘ï¼ˆyè½´æ–¹å‘ï¼‰ç§»åŠ¨ï¼Œmæ¡è›‡æ²¿ç«–ç›´æ–¹å‘ï¼ˆxè½´æ–¹å‘ï¼‰ç§»åŠ¨ã€‚&lt;/p>
&lt;p>ç°ç»™å‡ºè¿™äº›è›‡å¤´å’Œå°¾æ‰€åœ¨çš„åæ ‡ç‚¹ï¼Œæ±‚å‡ºè¿™n+mæ¡è›‡åœ¨æ­¤æ—¶å…±æœ‰å¤šå°‘ä¸ªäº¤ç‚¹ã€‚åœ¨åŒä¸€ä¸ªæ–¹å‘ç§»åŠ¨çš„è›‡ä¸ä¼šæœ‰äº¤ç‚¹ã€‚&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œn = 5, m = 4ï¼Œè¿™äº›è›‡ä¸€å…±æœ‰5ä¸ªäº¤ç‚¹ã€‚&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvcAAAGjCAYAAACoiDrHAAAABHNCSVQICAgIfAhkiAAAEipJREFUeJzt3TFuHFe2x+FDogISVcwm8Qa4gXZIQpxtOLdmDYoMR1rDkxfzJJDO3F6AFyAHciZyupOpnoCGgPGbN3U8ul2XOvy+xIJw8WcBmgF+apT6nnz4cDj85S+xaLef4/zsdPHcb79F2LNnz549e/bs2bNnb/295Z8GAAB8EU4+fDgcMgfHaY6H+3Z/F7Bnz549e/bs2bNnz17bvROv5dizZ8+ePXv27NmzV2PPazkAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAijj5++4fqRtqAQCAp214uD99sjds2bNnz549e/bs2bNnL7/ntRwAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoIih9wP8J19//XXvRwAA4Bn56aefej/CZxkiHr84f8k45c4dYw8AANbQq3db7Q0R2RuxcufyN2zlzkVE/PS//5M7CAAA/4Wv//q3iOjTuy33vHMPAABFiHsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoIhhnObY7XOHd/t58cw4RdM9AABYS4/ebbk3PNyfJm/EmuP8bPmD/vwNW7k9AABYS4/ebbmnrgEAoAhxDwAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIsQ9AAAUMUQ8fnH+knHKnTvGHgAArKFX77baGyKyN2LlzuVv2MqdAwCAtfTo3ZZ7w/IMABzfx9tt3N9tY7raxMX1pvfjAHyRvHMPwJPw8W4b71+/iY93296PAvDFEvcAAFCEuAcAgCK8c//MeKcVAKAun9w/M95pBQCoS9wDAEAR4h4AAIoYxmmO3T53eLefF8+MUzTdAwCAtfTo3ZZ7w8P9afJGrDnOz5Y/6M/fsJXbA/49/zgaANrr0bst99Q1fKH842gA4I/EPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihD3AABQxBDx+MX5S8Ypd+4YewAAsIZevdtqb4jI3oiVO5e/YSt3DgAA1tKjd1vueS0HAACKEPcAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHDOM2x2+cO7/bz4plxiqZ7AACwlh6923JveLg/Td6INcf52fIH/fkbtnJ7AACwlh6923JPXQMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoAhxDwAARYh7AAAoYoh4/OL8JeOUO3eMPQAAWEOv3m21N0Rkb8TKncvfsJU7BwAAa+nRuy33vJYDAABFiHsAAChC3AMAQBHiHgAAihh6PwAA8Hy8vd3Gu7tt78fgM7242sTN9ab3Y/BviHsAYDVv77bx/es3vR+Dz/Tdq5fi/okS9wDAam6uNhGvXvZ+DD7TzZWwf6rEPQCwmptrr3PAMQ3jNMdunzu828+LZ8Ypmu4BAMBaevRuy73h4f40eSPWHOdny1+uk79hK7cHAABr6dG7LffUNQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAihojHL85fMk65c8fYAwCANfTq3VZ7Q0T2RqzcufwNW7lzAACwlh6923LPazkAAFDE0PsB+M/e3m7j3d222d7l7TYuI+Ld7TZ+iTfNdllf5s/yxdUmbq436z4YANCNuH/i3t5t4/vXnxfhJycnn3797eEQl7/v/vDjz59+/3A4fNbPYB1/9s/yu1cvxT0APCPi/om7udpEvHrZbO/ydhtxt40XV5v4SvR90TJ/ljdX/owB4DkR90/czXXb1yrex5v49W4bN9eb+KbhXxpYnz9LAOCP/INaAAAoQtwDAEAR4h4AAIoYxmmO3T53eLefF8+MUzTdAwCAtfTo3ZZ7w8P9afJGrDnOz5Y/6M/fsJXbAwCAtfTo3ZZ76hoAAIoQ9wAAUIS4BwCAIsQ9AAAUIe4BAKAIcQ8AAEWIewAAKELcAwBAEUPE4xfnLxmn3Llj7AEAwBp69W6rvSEieyNW7lz+hq3cOQAAWEuP3m2557UcAAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIsQ9AAAUIe4BAKAIcQ8AAEUM4zTHbp87vNvPi2fGKZruAQDAWnr0bsu94eH+NHkj1hznZ8sf9Odv2MrtAQDAWnr0bss9dQ0AAEWIewAAKELcAwBAEeIeAACKEPcAAFCEuAcAgCLEPQAAFCHuAQCgiCHi8Yvzl4xT7twx9gAAYA29erfV3hCRvRErdy5/w1buHAAArKVH77bc81oOAAAUIe4BAKAIcQ8AAEWIewAAKELcAwBAEeIeAACKEPcAAFCEuAcAgCKGcZpjt88d3u3nxTPjFE33AABgLT16t+Xe8HB/mrwRa47zs+UP+vM3bOX2AABgLT16t+WeugYAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChi6P0AAMDT8vF2G/d325iuNnFxven9OMCf4JN7AOBffLzbxvvXb+Lj3bb3owB/krgHAIAihojHL85fMk65c8fYAwCANfTq3VZ7Q0T2RqzcufwNW7lzAACwlh6923LPazkAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihjGaY7dPnd4t58Xz4xTNN0DAIC19OjdlnvDw/1p8kasOc7Plj/oz9+wldsDAIC19OjdlnvqGgAAihD3AABQhLgHAIAixD0AABQh7gEAoAhxDwAARYh7AAAoQtwDAEARQ8TjF+cvGafcuWPsAQDAGnr1bqu9ISJ7I1buXP6Grdw5AABYS4/ebbnntRwAAChi6P0A8Fy8vd3Gu7tts73L221cRsS72238Em+a7ULGi6tN3Fxvej8GAH8g7mElb++28f3rz4vwk5OTT7/+9nCIy993f/jx50+/fzgcPutnQMZ3r16Ke4AnSNzDSm6uNhGvXjbbu7zdRtxt48XVJr4SWazs5qr9/+Yufv//yMURtgGeC3EPK7m5bvsaw/t4E7/ebePmehPfNPxLA/Rycb2JC39RBfgs/kEtAAAUIe4BAKAIr+U8M95pBQCoaxinOXb73OHdfl48M07RdI+2vNMKAPD/69G7LfeGh/vT5I1Yc5yfLb/Fk79hK7cHAABr6dG7LffUNQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAihojHL85fMk65c8fYAwCANfTq3VZ7Q0T2RqzcufwNW7lzAACwlh6923LPazkAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihjGaY7dPnd4t58Xz4xTNN0DAIC19OjdlnvDw/1p8kasOc7Plj/oz9+wldsDAIC19OjdlnvqGgAAihD3AABQhLgHAIAixD0AABQh7gEAoAhxDwAARYh7AAAoQtwDAEARQ8TjF+cvGafcuWPsAQDAGnr1bqu9ISJ7I1buXP6Grdw5AABYS4/ebbnntRwAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoAhxDwAARQzjNMdunzu828+LZ8Ypmu4BAMBaevRuy73h4f40eSPWHOdnyx/052/Yyu0BAMBaevRuyz11DQAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIsQ9AAAUIe4BAKCIIeLxi/OXjFPu3DH2AABgDb16t9XeEJG9ESt3Ln/DVu4cAACspUfvttzzWg4AABQh7gEAoAhxDwAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIoZxmmO3zx3e7efFM+MUTfcAAGAtPXq35d7wcH+avBFrjvOz5Q/68zds5fYAAGAtPXq35Z66BgCAIsQ9AAAUIe4BAKAIcQ8AAEWIewAAKELcAwBAEeIeAACKEPcAAFDEEPH4xflLxil37hh7AACwhl6922pviMjeiJU7l79hK3cOgKfn7e023t1tez8GR3J5u43LiHh3u41f4s0qP/PF1SZurjer/Cz4T3r0bsu9YXkGAP7V27ttfP96nehjHScnJ59+/e3hEJfx+Of8w48/f/r9w+FwtJ//3auX4h4aEPcA/Gk3V5uIVy97PwZHcnm7jbjbxourTXy1UnDfXAl7aEHcA/Cn3Vx7haKy9/Emfr3bxs31Jr7xlzj4ovi2HAAAKELcAwBAEeIeAACKEPcAAFCEuAcAgCKGcZpjt88d3u3nxTPjFE33AABgLT16t+Xe8HB/mrwRa47zs+UP+vM3bOX2AABgLT16t+WeugYAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihD3AABQxBDx+MX5S8Ypd+4YewAAsIZevdtqb4jI3oiVO5e/YSt3DgAA1tKjd1vueS0HAACKEPcAAFCEuAcAgCKG3g9AH29vt/Hubtv7MfgMl7fbuIyId7fb+CXeHPVnfffq5VH3AYA2xP0z9fZuG9+/Pm4Q0t7JycmnX397OMRlPP5Z/vDjz59+/3A4NP+54h4Avgzi/pm6udpECLYv2uXtNuJuGy+uNvHV9ab34wAAT4C4f6ZurjdxIwi/aO/jTfx6t42b60184y9qAED4B7UAAFDGME5z7Pa5w7v9vHhmnKLpHgAArKVH77bcGx7uT5M3Ys1xfrb8QX/+hq3cHgAArKVH77bcU9cAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBHiHgAAihgiHr84f8k45c4dYw8AWM/F1Sbi1cvH/8Iz06t3W+0NEdkbsXLn8jds5c4BAOu6uN7ExbWw53nq0bst97yWAwAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIsQ9AAAUIe4BAKCIYZzm2O1zh3f7efHMOEXTPQAAWEuP3m25NzzcnyZvxJrj/Gz5g/78DVu5PQAAWEuP3m25p64BAKAIcQ8AAEWIewAAKELcAwBAEeIeAACKEPcAAFCEuAcAgCLEPQAAFDFEPH5x/pJxyp07xh4AAKyhV++22hsisjdi5c7lb9jKnQMAgLX06N2We17LAQCAIsQ9AAAUIe4BAKAIcQ8AAEWIewAAKELcAwBAEeIeAACKEPcAAFDEME5z7Pa5w7v9vHhmnKLpHgAArKVH77bcGx7uT5M3Ys1xfrb8QX/+hq3cHgAArKVH77bcU9cAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChC3AMAQBFD7wcA/jsXV5uIVy8f/wsAEL/H/W+/LR8cp9y5Y+wB/9fF9SYuroU9ALTUq3db7Q0R2RuxcufyN2zlzgEAwFp69G7LPe/cAwBAEeIeAACKEPcAAFCEuAcAgCLEPQAAFCHuAQCgCHEPAABFiHsAAChiGKc5dvvc4d1+XjwzTtF0DwAA1tKjd1vuDQ/3p8kbseY4P1v+oD9/w1ZuDwAA1tKjd1vuqWsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoAhxDwAARQwRj1+cv2SccueOsQcAAGvo1but9oaI7I1YuXP5G7Zy5wAAYC09erflntdyAACgCHEPAABFiHsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQxjNMcu33u8G4/L54Zp2i6BwAAa+nRuy33hof70+SNWHOcny1/0J+/YSu3BwAAa+nRuy331DUAABQh7gEAoAhxDwAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIoaIxy/OXzJOuXPH2AMAgDX06t1We0NE9kas3Ln8DVu5cwAAsJYevdtyz2s5AABQhLgHAIAixD0AABQh7gEAoAhxDwAARYh7AAAoQtwDAEARQ+8HyPj6r3/r/QgAAPDkDeM0x26fO7zbz4tnxima7gEAwFp69G7LvZMPHw6H3I1Yc5yfLb/Fk79hy549e/bs2bNnz549ey33vHMPAABFiHsAAChC3AMAQBHiHgAAihD3AABQhLgHAIAixD0AABQh7gEAoIiTDx8Oh8zBcZrj4b7d3wXs2bNnz549e/bs2bPXds8Ntfbs2bNnz549e/bsFdnzWg4AABQh7gEAoAhxDwAARYh7AAAoQtwDAEAR4h4AAIoQ9wAAUIS4BwCAIk7+vvtH6oZaAADgaRse7k+f7A1b9uzZs2fPnj179uzZy+95LQcAAIoQ9wAAUIS4BwCAIsQ9AAAUIe4BAKCIfwKP1g+twRLEdAAAAABJRU5ErkJggg==" alt="Alt text">&lt;/p>
&lt;h2 id="åˆ†æ">åˆ†æ &lt;a href="#%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºæ­¤é¢˜ï¼Œæœ€ç®€å•ç›´æ¥çš„æ–¹æ³•å°±æ˜¯æšä¸¾è›‡ä¸¤ä¸¤ä¹‹é—´çš„å…³ç³»ï¼Œè¿™ç§ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½æ»¡è¶³äºè¿™ç§æš´åŠ›çš„è§£æ³•ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´ä¼˜ç¾çš„æ–¹æ³•å‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAAFECAYAAAAOd+HJAAAABHNCSVQICAgIfAhkiAAABy9JREFUeJzt3D9s1AUYxvHnbFNCwmETEkybmE4ciRFDcozXwC5xpzs1uDqYuiBTdTBxsqHM2t3EGc3Vif4coDGhG5iUwFR6Rf4kxzm0d/1R7q2iba+8z/cztbTWI19ffk9JbKWzvtQRLL0z6BeAwSG+MeIbI74x4hsjvjHiGyO+MeIbI74x4hsjvjHiGyO+MYv4rWahVrMY9Ms4dIYH/QIOwursvCoVqTp5fdAv5VBJf/mtZqGNxYLr7yN9/NXZ+d7bD76e3+Uz/aSO37368vtc/7bU8ctX38X1b0sbf+fVl3+d69+UNn6/q+/i+jeljB9dffnjXH/S+OWrPzF1UfX1JdXXl3Ri6mLv17n+hPF3Xv34zHTft7n+hPF3Xv3IxHjv/ZGJca6/JFX8fle/Ojuv4vg5FcfPaXV2nusvSRV/t6vv4vq3pYn/4t6qnt6523u/fOE7lT/21+27enFvdV9f22FVyfR/6bbXWno4t6D2Wkvvf/P5rp/75xffami0qveuXNLQaPWAXuHhkio+3kyaP/bx5tLH37n2sS19fMSIb4zBZ4zLN0Z8Y+njs/Zj6eMjRnxjrH1jXL4x4htLH5+1H0sfHzHiG2PtG+PyjRHfWPr4rP1Y+viIEd8Ya98Yl2+M+MbSx2ftx9LHR4z4xlj7xrh8Y8Q3lj4+az+WPj5ixDfG2jc2fI3noCTpfKOuC5P1Qb+MA1WRlO7yK5XKv/q8Tmf7t351Zlpf7fLj2zIavpr8N1xrFjq99VM57zbqWgmu+0LD6+olg2f+6uy8Hmw92sZmpnf94YxuWPvG0l8+Yly+MeIbSx+fv9uPpY+PGPGNsfaNcfnGiG8sfXzWfix9fMSIb4y1b4zLN0Z8Y+njs/Zj6eMjRnxjrH1jXL4x4htLH5+1H0sfHzHiG2PtG+PyjRHfWPr4rP1Y+viIEd8Ya98Yl2+M+MbSx2ftx9LHR4z4xlj7xrh8Y8Q3lj4+az+WPj5ixDfG2jfG5RsjvrH08Vn7sfTxESO+Mda+MS7fGPGNpY/P2o+lj48Y8Y2x9o1x+caIbyx9fNZ+LH18xIhvjLVvjMs3Rnxj6eOz9mPp4yNGfGOsfWNcvjHiG0sfn7UfSx8fMeIbY+0b4/KNEd/Y8KBfQD+/NAv9uljsydeqNQvVtr7WSqOulcn6nnzdDA5n/MVC1/7Ht2WVSqX39uVOR7XS173x2++9j3U63nPnUMa/0KhLM9N78rVqzULauvzzjbrGuPwe1r4xBp8x4htLH5+/24+lj48Y8Y2x9o1x+caIbyx9fNZ+LH18xIhvjLVvjMs3Rnxj6eOz9mPp4yNGfGOsfWNcvjHiG0sfn7UfSx8fMeIbY+0b4/KNEd9Y+vis/Vj6+IgR3xhr3xiXb4z4xtLHZ+3H0sdHjPjGWPvGuHxjxDeWPj5rP5Y+PmLEN8baN8blGyO+sfTxWfux9PERI74x1r4xLt8Y8Y2lj8/aj6WPjxjxjbH2jXH5xohvLH181n4sfXzEiG+MtW+MyzdGfGPp47P2Y+njI0Z8Y6x9Y1y+MeIbSx+ftR9LHx8x4htj7Rvj8o0R31j6+Kz9WPr4iBHfGGvfGJdvjPjG0sdn7cfSx0eM+MZY+8a4fGPEN5Y+Pms/lj4+YsQ3xto3xuUbI76x9PFZ+7H08REjvjHWvjEu3xjxjQ1fS76Aa81CtcVCkrTSqGtlsr6v/76rM9P7+vX3UkVSumd+pVLpvX2501E3x7ykG6WPdTp7/1vvrC/t+dfcL8Nv03+p/0WtWUhbl3++UdfYPl/+24S1b4zBZ4z4xtLH5+/2Y+njI0Z8Y6x9Y1y+MeIbSx+ftR9LHx8x4htj7Rvj8o0R31j6+Kz9WPr4iBHfGGvfGJdvjPjG0sdn7cfSx0eM+MZY+8a4fGPEN5Y+Pms/lj4+YsQ3xto3xuUbI76x9PFZ+7H08REbHvQL2EvttZYezS1o6N1jOvnZ1K6f++j7H9V+vKGTVy5paLR6QK/wcEmz9l/cW9UfjSm1H29oaLSqM7d/CqO211q689Enaq+1NDRa1QfNHzQyMX7Ar3jw0vyxPzIxrqNnTkvajPtwbiH83IdzC2qvtSRJRz+sWYaXEsWXpPHSj5V7VApc1n009Ptn3KR65lcn6zrWqGtjsXjl+h9srfyxrdDd/yiONeqqGv9cvlSXL71+/S+fPe+9//LZc66+JF387vVLmxf+5NZy72NPbi1z9SXp4kuvXvTT5RWdvX9TZ+/f1NPllb6f4yrVM78revZz9a9K833+Tq1moZWPP5Wk3vf73fi1n68TX0n/2Jdef/Zz9a9LG1/q/1znWb8tdfzqZF1HTk303j9yaoKrL0kdX5Imvvuy79tIuvbLys9+rv5V6eNLPOcjab/Vwz9L/8xHjPjGiG+M+MaIb4z4xohvjPjGiG+M+MaIb4z4xohvjPjGiG+M+MaIb4z4xohvjPjG/gYdfhbrYRov+AAAAABJRU5ErkJggg==" alt="Alt text">&lt;/p>
&lt;p>å¯¹äºè¿™ä¸€æ¡åœ¨yè½´æ–¹å‘ä¸Šçš„ï¼ˆçº¢ï¼‰è›‡æ¥è¯´ï¼Œå®ƒä¸xè½´æ–¹å‘ä¸Šçš„ï¼ˆé»‘ï¼‰è›‡å…±æœ‰ä¸‰ä¸ªäº¤ç‚¹ã€‚é‚£ä¹ˆï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œé—®é¢˜çš„å…³é”®åœ¨äºï¼Œæˆ‘ä»¬å¦‚ä½•å¿«é€Ÿç¡®å®šæŸä¸€æ¡çº¢è›‡ï¼ˆæˆ–é»‘è›‡ï¼‰ä¸å…¶å®ƒè›‡ä¸€å…±æœ‰å¤šå°‘ä¸ªäº¤ç‚¹ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥åšå‡ºå¦‚ä¸‹å‡è®¾ï¼Œæˆ‘ä»¬çŸ¥é“å½“x = kæ—¶ï¼Œæ‰€æœ‰åœ¨å¹³é¢ä¸Šçš„è›‡çš„ä½ç½®ã€‚æ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒºé—´æ±‚å’Œçš„ç®—æ³•æ¥ç¡®å®šç«–ç›´ä½ç½®ä¸Šçš„è›‡ä¼šæœ‰å¤šå°‘ä¸ªç„¦ç‚¹ã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬ä»x = 0åˆ°x = MAX_Xæ–¹å‘è¿›è¡Œæ‰«æï¼Œæ¯æ¡è›‡åœ¨æ‰«ææ—¶ï¼Œéƒ½æœ‰ä¸”åªæœ‰ä¸¤ç§çŠ¶æ€ï¼š&lt;/p>
&lt;ol>
&lt;li>æ‰«æçº¿ç¬¬ä¸€æ¬¡ç»è¿‡è›‡çš„æŸç«¯ç‚¹&lt;/li>
&lt;li>æ‰«æçº¿ç¬¬äºŒæ¬¡ç»è¿‡è›‡çš„å¦ä¸€ä¸ªç«¯ç‚¹ï¼ˆåºŸè¯ï¼ï¼‰&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸¤ä¸ªçŠ¶æ€åˆ†åˆ«æ„å‘³ç€æŸä¸€æ¡é»‘è›‡åœ¨x = kæ—¶æ˜¯å¦å­˜åœ¨ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ç¬¬uä¸ªå…ƒç´ ä»£è¡¨y = uçš„é»‘è›‡æ˜¯å¦åœ¨x = kæ—¶å­˜åœ¨ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ—¶å€™ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢ä¸€æ¡x = [v, w]ä½ç½®çš„çº¢è›‡å…±æœ‰å¤šå°‘ä¸ªäº¤ç‚¹æ—¶ï¼Œåªéœ€è¦è®¡ç®—æ•°ç»„ä¸­[v &amp;hellip; w]å…ƒç´ çš„å’Œã€‚è€Œä½¿ç”¨æ ‘çŠ¶æ•°ç»„(Binary Indexed Tree, BIT)ï¼Œæ¯æ¬¡è¿™æ ·çš„æŸ¥è¯¢åªéœ€è¦O(logN)æ—¶é—´ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N * logN)ï¼Œæ¯”O(N^2)çš„ç®—æ³•ä¼˜åŒ–äº†å¾ˆå¤šã€‚&lt;/p>
&lt;h2 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">lowbit&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) { &lt;span style="color:#66d9ef">return&lt;/span> x &lt;span style="color:#f92672">&amp;amp;&lt;/span> (&lt;span style="color:#f92672">-&lt;/span>x); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">BITree&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> _tree[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(_tree, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(_tree));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> p) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (p &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _tree[p] &lt;span style="color:#f92672">+=&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">+=&lt;/span> lowbit(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">sum&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> p) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (p &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> _tree[p];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">-=&lt;/span> lowbit(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">sum&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sum(b) &lt;span style="color:#f92672">-&lt;/span> sum(a &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Point&lt;/span> { &lt;span style="color:#66d9ef">int&lt;/span> x, y; };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Snake&lt;/span> { Point start, end; };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span> { &lt;span style="color:#75715e">// manual tested
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> count_intersection(&lt;span style="color:#66d9ef">const&lt;/span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Snake&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> xsnakes,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Snake&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> ysnakes) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _tree.init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Mark&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> s: xsnakes) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(Mark({s.start.x, &lt;span style="color:#ae81ff">1&lt;/span>, s.start.y}));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(Mark({s.end.x, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, s.end.y}));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> s: ysnakes) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(Mark({s.start.x, &lt;span style="color:#ae81ff">0&lt;/span>, p&lt;span style="color:#f92672">++&lt;/span>}));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(vec.begin(), vec.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> mark: vec) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (mark.type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _tree.add(&lt;span style="color:#ae81ff">1&lt;/span>, mark.val);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#a6e22e">if&lt;/span> (mark.type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _tree.add(&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, mark.val);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> mark.val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> ysnakes[p].start.y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> ysnakes[p].end.y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> _tree.sum(a, b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Mark&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pos, type, val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">friend&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> Mark&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> Mark&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a.pos &lt;span style="color:#f92672">&amp;lt;&lt;/span> b.pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BITree _tree;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Snake&lt;span style="color:#f92672">&amp;gt;&lt;/span> xsnakes({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Snake({ Point({&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>}), Point({&lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>}) })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>Snake&lt;span style="color:#f92672">&amp;gt;&lt;/span> ysnakes({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Snake({ Point({&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>}), Point({&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>}) }),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Snake({ Point({&lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>}), Point({&lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>}) })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Solution S;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(S.count_intersection(xsnakes, ysnakes));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é¢˜ç›®æ¥æº">é¢˜ç›®æ¥æº &lt;a href="#%e9%a2%98%e7%9b%ae%e6%9d%a5%e6%ba%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ã€Šç®—æ³•å¼•è®ºã€‹&lt;/p>
&lt;h2 id="æ‰©å±•é¢˜ç›®">æ‰©å±•é¢˜ç›® &lt;a href="#%e6%89%a9%e5%b1%95%e9%a2%98%e7%9b%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>POJ-2482 &lt;a href="http://poj.org/problem?id=2482">Stars in Your Window&lt;/a>&lt;/p></description></item><item><title>æ€ç»´è®­ç»ƒ - Thinkin' in induction 2</title><link>https://wizmann.top/posts/thinking-in-induction-2/</link><pubDate>Wed, 01 Oct 2014 00:05:29 +0000</pubDate><guid>https://wizmann.top/posts/thinking-in-induction-2/</guid><description>&lt;h2 id="æœ€å¤§å¯¼å‡ºå­å›¾maximal-induced-graph">æœ€å¤§å¯¼å‡ºå­å›¾ï¼ˆmaximal induced graphï¼‰ &lt;a href="#%e6%9c%80%e5%a4%a7%e5%af%bc%e5%87%ba%e5%ad%90%e5%9b%bemaximal-induced-graph" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ä½ ç°åœ¨åœ¨ç»„ç»‡ä¸€ä¸ªå­¦æœ¯ä¼šè®®ã€‚ç°åœ¨ä½ æœ‰ä¸€ä»½äººå‘˜åå•ã€‚å‡å®šåå•ä¸­çš„æ¯ä¸€ä¸ªäººéƒ½åŒæ„åˆ°è¾¾ï¼Œå¹¶ä¸”æœ‰å……è¶³çš„æ—¶é—´äº¤æµæ„è§ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªç§‘å­¦å®¶éƒ½å†™ä¸‹äº†ä»–æ„¿æ„ä¸å…¶è¿›è¡Œäº¤æµçš„ç§‘å­¦å®¶çš„åå­—ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>ç°åœ¨ï¼Œé—®é¢˜æ¥äº†ï¼š&lt;del>æŒ–æ˜æœºæŠ€æœ¯å“ªå®¶å¼ºï¼Ÿ&lt;/del>&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>å¦‚æœè¦ä¿è¯æ¯ä¸€ä½ç§‘å­¦å®¶è‡³å°‘èƒ½ä¸kä½åˆ°åœºçš„ç§‘å­¦å®¶è¿›è¡Œæ·±å…¥çš„äº¤â™‚æµâ™‚ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ€å¤šå¯ä»¥é‚€è¯·å¤šå°‘äººåˆ°ä¼šï¼Ÿ&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>æ³¨ï¼šå¦‚æœAæ„¿æ„å’ŒBäº¤æµï¼ŒABä¸€å®šä¼šè¿›è¡Œäº¤æµã€‚åä¹‹äº¦ç„¶ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬å¯ä»¥æŠŠé—®é¢˜è½¬åŒ–æˆæ•°å­¦è¯­è¨€ï¼šå¯¹äºä¸€ä¸ªæ— å‘å›¾&lt;code>G=(V, E)&lt;/code>ï¼Œè¯•æ±‚å¾—Gçš„æœ€å¤§å¯¼å‡ºå­å›¾Hï¼Œä½¿å¾—Hä¸­æ‰€æœ‰é¡¶ç‚¹çš„åº¦å¤§äºæˆ–ç­‰äºkï¼Œæˆ–è€…è¯æ˜è¿™æ ·çš„å­å›¾æ˜¯ä¸å­˜åœ¨çš„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç»§ç»­ä½¿ç”¨å½’çº³çš„æ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>æ˜“å¾—ï¼Œå¯¹äºé¡¶ç‚¹æ•°ä¸ºkçš„å›¾ï¼Œå¦‚æœå­˜åœ¨k-å¯¼å‡ºå­å›¾ï¼Œåˆ™è¯¥å›¾å¿…ä¸ºä¸€ä¸ªå®Œå…¨å›¾ã€‚&lt;/p>
&lt;p>å‡è®¾ï¼Œå¯¹äºä»»æ„é¡¶ç‚¹æ•°å°äºnçš„å›¾ï¼Œæˆ‘ä»¬æ€»å¯ä»¥æ‰¾åˆ°å›¾çš„k-æœ€å¤§å¯¼å‡ºå­å›¾ã€‚&lt;/p>
&lt;p>å¯¹äºæœ‰nä¸ªé¡¶ç‚¹çš„å›¾Gæ¥è¯´ï¼Œå¦‚æœæœ‰ä»»æ„é¡¶ç‚¹çš„åº¦å°äºkï¼Œé‚£ä¹ˆå¯¹äºå›¾Gçš„ä»»æ„å­å›¾ï¼Œæ­¤é¡¶ç‚¹çš„åº¦æ€»å°äºkã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œå¯¹äºå›¾ä¸­ä»»æ„åº¦å°äºkçš„ç‚¹ï¼Œå¿…ç„¶ä¸å±äºæ‰€æ±‚çš„å­å›¾ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬æ¯æ¬¡åˆ é™¤ä¸€ä¸ªä¸å±äºk-å¯¼å‡ºå­å›¾çš„ç‚¹ï¼Œå°±å¯ä»¥æŠŠæœ‰nä¸ªé¡¶ç‚¹çš„å›¾é—®é¢˜åŒ–å½’ä¸ºn-1é¡¶ç‚¹çš„å›¾é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="ä¸€å¯¹ä¸€æ˜ å°„">ä¸€å¯¹ä¸€æ˜ å°„ &lt;a href="#%e4%b8%80%e5%af%b9%e4%b8%80%e6%98%a0%e5%b0%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ç»™å®šä¸€ä¸ªé›†åˆAå’Œä¸€ä¸ªæ˜ å°„å…³ç³»fã€‚æ±‚Açš„ä¸€ä¸ªå­é›†Sï¼Œä½¿å¾—få¯¹äºSæ˜¯ä¸€ä¸ªä¸€å¯¹ä¸€æ˜ å°„ã€‚å³ï¼šfæŠŠSä¸­çš„ä¸€ä¸ªå…ƒç´ æ˜ å°„åˆ°ä¸€ä¸ªå…ƒç´ ï¼›Sä¸­æ²¡æœ‰ä¸¤ä¸ªå…ƒç´ æ˜ å°„åˆ°åŒä¸€ä¸ªå…ƒç´ ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬ä»ç„¶å¯ä»¥åšå‡è®¾ï¼šå¯¹äºå«æœ‰kä¸ªå…ƒç´ çš„é›†åˆï¼Œæˆ‘ä»¬æœ‰æ–¹æ³•æ‰¾åˆ°æ‰€æ±‚ã€‚&lt;/p>
&lt;p>åŸºç¡€æƒ…å†µçš„è¯æ˜éå¸¸ç®€å•ï¼Œå¯¹äºä¸€ä¸ªç‚¹çš„æƒ…å†µï¼Œ&lt;code>f(A) = A&lt;/code>æ»¡è¶³æ¡ä»¶ã€‚å¯¹äºä¸¤ä¸ªç‚¹ï¼Œæ‰¾åˆ°ä¸¤ä¸ªç‚¹&lt;code>(A, B)&lt;/code>ï¼Œåœ¨å›¾ä¸­æœ‰&lt;code>(A -&amp;gt; B)&lt;/code>å’Œ&lt;code>(B -&amp;gt; A)&lt;/code>å³å¯ã€‚&lt;/p>
&lt;p>å¯¹äºä»»æ„é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œå½“æ²¡æœ‰&lt;code>f(x) = i&lt;/code>æ—¶ï¼Œå…ƒç´ iå¿…ç„¶ä¸å±äºè¿™ä¸ªé›†åˆã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡æ“ä½œæˆ‘ä»¬éƒ½åˆ é™¤æ‰å¿…ç„¶ä¸å±äºæ‰€æ±‚å­é›†çš„é‚£ä¸ªç‚¹ï¼ŒæŠŠé—®é¢˜&lt;code>Q(n)&lt;/code>åŒ–å½’ä¸ºå­é—®é¢˜&lt;code>Q(n-1)&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ç¤¾ä¼šåæµé—®é¢˜">ç¤¾ä¼šåæµé—®é¢˜ &lt;a href="#%e7%a4%be%e4%bc%9a%e5%90%8d%e6%b5%81%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>ç¤¾ä¼šåæµéƒ½æ˜¯é€¼æ ¼æ¯”è¾ƒé«˜çš„äººï¼Œè¿™ä½“ç°åœ¨æ‰€æœ‰çš„äººéƒ½è®¤è¯†ä»–ï¼Œä½†æ˜¯ä»–ä¸è®¤è¯†ä»»ä½•äººã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>è¯•åœ¨nä¸ªäººçš„èšä¼šä¸­ï¼Œæ‰¾å‡ºå”¯ä¸€çš„åæµã€‚è€Œæ‰¾å‡ºçš„åæµçš„æ–¹æ³•ï¼Œå°±æ˜¯è¯¢é—®ä»»æ„ä¸€ä¸ªäººï¼šDo you know that person? æ¯ä¸€ä¸ªäººéƒ½ä¼šå¦‚å®å›ç­”ã€‚è€Œä½ çš„ç›®æ ‡æ˜¯ä½¿è¯¢é—®æ¬¡æ•°æœ€å°‘ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬ä»ç„¶ä½¿ç”¨å½’çº³çš„æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªèšä¼šåªæœ‰ä¸¤ä¸ªäººï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±çŸ¥é“è°&lt;strong>ä¸æ˜¯&lt;/strong>åæµã€‚(Why?)&lt;/p>
&lt;p>å¯¹äºä¸€èˆ¬çš„æƒ…å†µï¼Œå¦‚æœè¯¢é—®Aï¼šDo you know person B?&lt;/p>
&lt;p>å¦‚æœAå›ç­”YESï¼Œé‚£ä¹ˆAå¿…ç„¶ä¸æ˜¯åæµã€‚å¦‚æœAå›ç­”NOï¼Œé‚£ä¹ˆBä¸æ˜¯åæµã€‚&lt;/p>
&lt;p>å¦‚æ˜¯ï¼Œæˆ‘ä»¬åˆå¯ä»¥ä¸€æ­¥ä¸€æ­¥ç¼©å°é¢˜ç›®çš„æ•°æ®èŒƒå›´ã€‚æœ€ååœ¨æ’é™¤äº†æ‰€æœ‰&lt;strong>ä¸æ˜¯&lt;/strong>åæµçš„äººä¹‹åï¼Œå¯¹æœ€åä¸€ä¸ªå€™é€‰äººå†è¿›è¡Œä¸€è½®éªŒè¯ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸Šä¸‰é¢˜éƒ½æ˜¯&lt;strong>Thinkin&amp;rsquo; in induction&lt;/strong>çš„è‰¯å¥½èŒƒä¾‹ã€‚å¯¹äºæœ‰äº›é¢˜ç›®ï¼Œåšå‡ºå¤§èƒ†çš„å‡è®¾å¹¶ä¸æ˜¯çº¯ç²¹çš„ç¢°è¿æ°”ï¼Œè€Œæ˜¯ä¸€ç§ç§‘å­¦çš„å°è¯•ã€‚åŒæ—¶ï¼Œåœ¨æ€è€ƒæ—¶ï¼Œå¦‚æœä¸èƒ½ç›´è§‚çš„æ‰¾å‡ºâ€œè°æ˜¯å¯¹çš„â€œï¼Œæˆ‘ä»¬ä¸å¦¨åå‘æ€è€ƒä¸€ä¸‹ï¼Œæ‰¾å‡ºâ€œè°æ˜¯ä¸å¯¹çš„â€ã€‚&lt;/p>
&lt;p>æœ¬æ–‡å‚è€ƒUdi Manberçš„ã€ŠIntroduction to algorithms - A creative approachã€‹.&lt;/p></description></item><item><title>æ€ç»´è®­ç»ƒ - Thinkin' in induction</title><link>https://wizmann.top/posts/thinking-in-induction/</link><pubDate>Fri, 26 Sep 2014 00:10:45 +0000</pubDate><guid>https://wizmann.top/posts/thinking-in-induction/</guid><description>&lt;h2 id="çƒ­èº«é¢˜---24game">çƒ­èº«é¢˜ - 24Game &lt;a href="#%e7%83%ad%e8%ba%ab%e9%a2%98---24game" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="http://codeforces.com/contest/469/problem/C">åŸé¢˜è¯·æˆ³æˆ‘&lt;/a>&lt;/p>
&lt;h3 id="é¢˜æ„">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç»™ä½ ä¸€ä¸ªåŒ…å«æ•´æ•°1&amp;hellip;nçš„é›†åˆSã€‚æ¥ä¸‹æ¥è¿›è¡Œn-1æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œä»é›†åˆSä¸­é€‰å–ä¸¤ä¸ªæ•°ï¼Œåœ¨åŠ ã€å‡ã€ä¹˜ä¸‰ç§è¿ç®—ä¸­é€‰å–ä¸€ç§ï¼Œå°†ç»“æœæ”¾å›å†é›†åˆSã€‚åœ¨n-1æ¬¡æ“ä½œå®Œæˆåï¼Œé›†åˆSä¸­åªå‰©ä¸‹ä¸€ä¸ªæ•°ã€‚æ±‚é—®ä¸€ç§å–æ•°å’Œè¿ç®—ç­–ç•¥ï¼Œä½¿æœ€åçš„ç»“æœä¸º24ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼š&lt;/p>
&lt;p>S = [1, 2, 3, 4, 5]&lt;/p>
&lt;p>æˆ‘ä»¬é€‰å–(2, 5)ï¼Œå¹¶è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œè·å¾—ç»“æœ7ã€‚å†å°†7æ”¾å›é›†åˆSä¸­ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ï¼ŒS = [1, 3, 4, 7]ã€‚&lt;/p>
&lt;h3 id="æ•°æ®èŒƒå›´">æ•°æ®èŒƒå›´ &lt;a href="#%e6%95%b0%e6%8d%ae%e8%8c%83%e5%9b%b4" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>1 &amp;lt;= n &amp;lt;= 100000&lt;/p>
&lt;h3 id="è§£ç­”">è§£ç­” &lt;a href="#%e8%a7%a3%e7%ad%94" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>å»ºè®®ï¼šè¯·æ€è€ƒ10åˆ†é’Ÿåå†æ¥çœ‹ç­”æ¡ˆ&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬æ—¥å¸¸å†™ä»£ç ï¼Œå¾€å¾€æ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªåŠŸèƒ½æˆ–è€…å®ç°ä¸€å¥—é€»è¾‘ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åšçš„äº‹ä¸€èˆ¬æ˜¯ä»é›¶å¼€å§‹ï¼Œç„¶åé€æ­¥è¿­ä»£ï¼Œæœ€ç»ˆå®ç°ç›®æ ‡ã€‚&lt;/p>
&lt;p>è¿™æ˜¯æ­£å¸¸çš„ä¸€ç§æ€ç»´æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸é”™çš„æ€ç»´ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬åšé¢˜æ—¶ï¼ŒæŒ‰éƒ¨å°±ç­çš„æ€è·¯å¾€å¾€ä¼šæŸç¼šæˆ‘ä»¬çš„æƒ³æ³•ã€‚æˆ‘ç»å¸¸è‡ªé»‘è¯´ï¼š&lt;strong>â€œåšä»€ä¹ˆé¢˜éƒ½åƒåšæ¨¡æ‹Ÿé¢˜â€&lt;/strong>ï¼Œå®é™…ä¸Šå°±æ˜¯è¿™æ ·ä¸€ä¸ªé“ç†ã€‚&lt;/p>
&lt;p>å¯¹äºæ­¤é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ä»é›¶å¼€å§‹æ€è€ƒï¼Œå¿…ç„¶ä¼šé‡åˆ°â€œç¬¬ä¸€æ¬¡é€‰å“ªä¸¤ä¸ªæ•°â€ã€â€œç¬¬äºŒæ¬¡é€‰å“ªä¸¤ä¸ªæ•°â€è¿™æ ·çš„é—®é¢˜ï¼Œè€Œè§£å†³è¿™ç§é—®é¢˜çš„æ–¹å¼å¤§å¤šåªèƒ½æœ‰æš´åŠ›æœç´¢ä¸€ç§æ–¹å¼ã€‚è€Œæ ¹æ®è¿™é¢˜çš„æ•°æ®è§„æ¨¡ï¼Œæš´åŠ›æœç´¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œä¹Ÿæœ‰çš„åŒå­¦å–„äºé€†å‘æ€ç»´ï¼Œä½†æ˜¯ï¼ŒåŒæ ·ä¹Ÿä¼šè¿›å…¥æš´åŠ›æœç´¢çš„æ­»è·¯ä¸­ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆè¿™é¢˜å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿ æˆ‘ä»¬ä¸å¦¨è¯•è¯•å½’çº³æ³•ã€‚&lt;/p>
&lt;p>å‡è®¾&lt;code>n = k&lt;/code>ï¼Œå¹¶ä¸”æœ‰&lt;code>f(k)&lt;/code>ï¼Œä½¿å¾—&lt;code>f(k)=&amp;gt;24&lt;/code>ã€‚é‚£ä¹ˆï¼Œæ˜“å¾—ï¼Œå¯¹äº&lt;code>f(k + 2)=&amp;gt;f(k) * ((k + 2) - (k + 1))=&amp;gt;24&lt;/code>ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°&lt;code>f(k)=&amp;gt;24&lt;/code>ï¼Œå°±å¯ä»¥è¯æ˜æ‰€æœ‰&lt;code>f(k + 2x) =&amp;gt; 24&lt;/code>ã€‚èªæ˜çš„åŒå­¦ä»¬å¿…ç„¶å¯ä»¥æ‰‹åŠ¨ç®—å‡º&lt;code>f(4) = 24&lt;/code>çš„è¿‡ç¨‹ï¼Œè¿™å¯ä»¥è¯æ˜å¯¹äºæ‰€æœ‰&lt;code>k &amp;gt;= 4&lt;/code>çš„å¶æ•°ï¼Œæ€»æœ‰&lt;code>f(k) =&amp;gt; 24&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>f(5) =&amp;gt; 24&lt;/code>ç•¥å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿä¸åœ¨è¯ä¸‹ã€‚è¿™æ ·æˆ‘ä»¬çš„ç»“è®ºå·²ç»æ‰©å±•åˆ°äº†&lt;code>k &amp;gt;= 4&lt;/code>çš„æ‰€æœ‰æ•´æ•°ã€‚&lt;/p>
&lt;p>åˆç”±äºåœ¨&lt;code>k = [1, 2, 3]&lt;/code>æ—¶ï¼Œ&lt;code>f(k)&lt;/code>å¿…é¡»ä¸èƒ½æ¨å‡º24ã€‚æˆ‘ä»¬çš„ç»“è®ºå·²ç»æ¨å¹¿åˆ°äº†æ‰€æœ‰æ­£æ•´æ•°ã€‚æ­¤é¢˜å¾—è¯ã€‚&lt;/p>
&lt;h2 id="å½’çº³æ³•">å½’çº³æ³• &lt;a href="#%e5%bd%92%e7%ba%b3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Udi Manberçš„_Introdcution to Algorithms - A creative approach_ä¸€ä¹¦ä¸­ï¼Œåœ¨ç¬¬äºŒç« å°±å¯¹æ•°å­¦å½’çº³æ³•è¿›è¡Œäº†å¤§ç¯‡å¹…çš„çš„è®²è§£ã€‚è€Œåœ¨ä¸€èˆ¬çš„ç®—æ³•ä¹¦ä¸­ï¼Œè¿™ä¸ªä½ç½®å¾€å¾€æ˜¯ç»™äº†ç®—æ³•åˆ†æã€‚&lt;/p>
&lt;p>å½’çº³æ³•æ˜¯ä¸€ç§â€œéå¸¸æœ‰åŠ›çš„è¯æ˜æ–¹æ³•â€ï¼Œå¯ä»¥æä¾›ä¸€ç§æƒ³é—®é¢˜çš„æ–¹æ³•ï¼ŒåŒæ—¶å¯ä»¥è¯æ˜ç®—æ³•çš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;p>å½’çº³æ³•çš„åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Let T be a theorem we want to prove.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Suppose that T includes a parameter n whose value can be any natural number.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Instead of proving directly that T holds for all values of n, we prove the following two conditions:&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;ol>
&lt;li>T holds for n = 1&lt;/li>
&lt;li>For every n &amp;gt; 1, if T holds for n - 1, then T holds for n&lt;/li>
&lt;/ol>&lt;/blockquote>
&lt;h2 id="å½’çº³æ³•åº”ç”¨--ç¬›å¡å°”æ ‘">å½’çº³æ³•åº”ç”¨ â€”â€” ç¬›å¡å°”æ ‘ &lt;a href="#%e5%bd%92%e7%ba%b3%e6%b3%95%e5%ba%94%e7%94%a8--%e7%ac%9b%e5%8d%a1%e5%b0%94%e6%a0%91" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å·²çŸ¥ä¸€ä¸ªæœ€å¤§å †çš„ä¸­åºéå†åºé‡Œï¼Œè¦æ±‚æ¢å¤è¯¥æœ€å¤§å †ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ–è€…ç”¨å¦å¤–ä¸€ç§æ–¹æ³•æ¥è¡¨ç¤ºï¼Œ&lt;/p>
&lt;blockquote>
&lt;p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ±‚ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿™ä¸ªäºŒå‰æ ‘çš„çˆ¶èŠ‚ç‚¹æ€»æ¯”å­èŠ‚ç‚¹è¦å¤§ï¼Œå¹¶ä¸”è¿™æ£µæ ‘çš„ä¸­åºéå†ä¸åŸæ•°ç»„ç›¸åŒ&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æœæˆ‘ä»¬ä»build from scratchçš„è§’åº¦æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå¾—å‡ºæ¥çš„ç»“è®ºä¸€å®šæ˜¯O(n^2)çš„ â€”â€” æ¯æ¬¡æ‰¾åˆ°ï¼ˆå­ï¼‰æ•°ç»„çš„æœ€å¤§å€¼ï¼Œç„¶åpartitionè¿™ä¸ªæ•°ç»„ï¼Œç›´åˆ°æ„é€ å‡ºæ•´æ£µæ ‘ã€‚&lt;/p>
&lt;h3 id="æ¢ä¸€ç§æ€è€ƒæ–¹å¼">æ¢ä¸€ç§æ€è€ƒæ–¹å¼ &lt;a href="#%e6%8d%a2%e4%b8%80%e7%a7%8d%e6%80%9d%e8%80%83%e6%96%b9%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å°è¯•ç”¨å½’çº³æ³•çš„æ€ç»´å»è€ƒè™‘è¿™é“é¢˜ã€‚å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘æ»¡è¶³ä¸Šé¢æ‰€è¯´çš„æ¡ä»¶ï¼Œä¸”è¿™æ£µæ ‘å±•å¼€åä¸ºæ•°ç»„çš„å‰ké¡¹ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æ’å…¥ç¬¬k+1é¡¹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µã€‚&lt;/p>
&lt;ol>
&lt;li>&lt;code>A[k+1] &amp;lt;= A[k]&lt;/code>ï¼Œæ­¤æ—¶ç¬¬k+1é¡¹ä¼šæˆä¸ºåˆ°ç¬¬ké¡¹çš„å³å„¿å­ï¼Œè¿™æ ·æ ‘å±•å¼€æ—¶ï¼Œç¬¬ké¡¹å’Œç¬¬k+1é¡¹å¿…ç„¶ç›¸è”ï¼Œå¹¶ä¸”ä¹Ÿæ»¡è¶³çˆ¶èŠ‚ç‚¹å¿…é¡»æ¯”å­èŠ‚ç‚¹å¤§çš„æ¡ä»¶ã€‚&lt;/li>
&lt;li>&lt;code>A[k+1] &amp;gt; A[k]&lt;/code>ï¼Œç¬¬k+1é¡¹å¿…ç„¶ä¼šæˆä¸ºç¬¬ké¡¹çš„å·¦å„¿å­ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ï¼Œç¬¬ké¡¹çš„çˆ¶èŠ‚ç‚¹æ¯”ç¬¬k+1é¡¹å°çš„æƒ…å†µã€‚ç»è¿‡æ€è€ƒï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œç¬¬k+1é¡¹çš„å·¦å„¿å­tï¼Œä¸€å®šæ˜¯ç¬¬ké¡¹ç¥–å…ˆèŠ‚ç‚¹ä¸­å°äºç¬¬k+1é¡¹çš„æœ€å¤§å€¼ã€‚è€Œç¬¬k+1é¡¹åˆ™æ›¿æ¢æ‰èŠ‚ç‚¹tçš„ä½ç½®ã€‚&lt;/li>
&lt;/ol>
&lt;p>æƒ…å†µä¸€ç¤ºæ„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYwAAAFLCAYAAADF1LtGAAAABHNCSVQICAgIfAhkiAAAEJJJREFUeJzt3XusZdVdwPHfuQ+GERyGwUBLYYZ2aKGlaYrYBoKVEoViLBYaiS1TKpFGHmof1EZCiNEUqsak1T5ACq0ttvgIIkIhlqGARROU6AA2SpEyQB9AQy0ggWFm7hz/gAN37nPdc/bZe+21P59k/oBhLvuec2d99/rtve/t9fv9fgDAMiaaPgAA2kEwAEgiGAAkEQwAkggGAEkEA4AkggFAEsEAIIlgAJBEMABIIhgAJBEMAJIIBgBJBAOAJIIBQBLBACCJYACQRDAASCIYACQRDACSCAYASaaaPgBy049dMzOxqx/Rm5yKyV7TxwPkwg6D3Tx/70Vx6NR0TE9Px0+846/j8V1NHxGQC8Fglufini98Oba++E/bv/HZuPEHM40eEZAPweBlz9wVl1/9/YiJn47f/NUDI3b9S1x63SOxs+njArIgGLyoH0/+8+fimiciJt/24Tj/Y++LDRHx75f9TXxnR9PHBuRAMHhB/0dx22dviKdjOt5+9olxyBtPj9NfHRH/dUX85X3PN310QAZ6/X6/3/RB0Lxdj34lfmH9GXHbAvOngz70b3H/n74lVtd/WEBGBKNwvd78+2Lnv+Uz8cjlx8aGc/41Jg77lTjnpFfFdET0n/lWfOUL34j/3f8Dccd3roif3buWQwYyJRiFWigUc7301u94ID75M6+Nj967V7zr+kfi709eF72IiO3/HZe86Q1x0bfXxntvfiiuPmGfsR4zkDfBKExKKObyJQCkcNEbgCSCUZBhdhej/DmgWwQDgCSCUYhRdwl2GcByBAOAJIIBQBLBACCJYACQRDAKMerDdx7eA5YjGAAkEYyCDLtLsLsAUggGAEkEo+PsLoBUglGQ2U9r9/v9RWMw+/c84Q2kmmr6AKje7FCk7CB6vZ6dBrAsO4xCDHYKK1n4Z/+3dhrAcgSjAKMs9nYWQCrBKMioi79dBrAUwWi5KhZ5oykghWAUwrcGAcZNMFpsmAvdS3GrLbAUwWBBogHMJRgtVfXuYsBoCliMYLTQuM/+jaaAhQhGi9WxGxANYEAwWqauBdyttsBcgtFSdewuXM8AZhOMFhnXhe6luJ4BDAgGyUQDuk0wWqKJ3cWA0RQQIRitkMOZvdEUIBgtksuZvmhANwlG5nJanHMJFtAMwWiJXBZroynoLsHIWJMXulOIBnSLYLBingKHbhKMTOW+u8j1uIDxEYwMteWs3fUM6BbByFibzuJFA8onGJlp28LbpqgBoxGMTLVpITaagm4QjIzkfqE7hWhAuQSDSrQ5ckAawchECbsLoykom2BkoMQFtsTPCbpOMDLS5t3FgKfAoVyC0bASF9USwgfMJxiZKG2RdT0DyiMYDSrhQncK0YAyCAZjU3oIoWsEoyFd2V0YTUE5BKMBXV08u/p5QykEo0Gl7y4G3GoLZRCMmnV1wexKHKFkgtGQLi+gXY0mtJ1g1KgrF7oXYzQF7SYYNbFAvqCrsYQSCEbNLJhutYW2EowaWBgX57WB9hCMGtldvMxrAe0jGGPW9QvdSzGagnYRDLIgGpA/wRgju4vludUW2kMwxsTil05QoR0EY8wshmlcz4D8CcYYWPRG4/WDPAnGGNldrIzXC/ImGBVzoXs0RlOQL8EgW6IBeRGMCtldVMPrB3kSjIo4G66W0RTkRzAq5uy4eqIBeRCMCljQxsNT4JAXwaiQ3UX1vKaQD8EYkQvd4+d6BuRBMGgV0YDmCMYI7C7q4zWG5gnGkJzp1s9oCpolGCNy5tsM0YD6CcYQLFbNEWhojmCMwOLVDKMpaIZgrJAL3XkRDaiPYNBKngKH+gnGCthd5MX7APUSjETOYvPkegbURzBWyFltvkQDxkswEliI8ibiUA/BWAELU77GOZrqb/9xfPeBb8eDjz4V230J0GGCsQwXutunqmjsenpLXP7rb4n9Vq2L9a89PDYeuDZW7Xd0fOyOp8NXA1001fQBQFX6/f5Lsej1eqNFfseDccWpx8Y5tz4XcfAvxe+cf0ocNvlY3PP1a+O+7z0X/VgTBpV0Ta/v1HlRg8Vnx44dEdGLialJW7IWqGJX+Oyd58XGYy6Lx6aPiysfuCXOWj84t+rHrn4vJtSCDrL+LWL2WGN6ejqmp6disteLiXWvj3f+3ub44UyDB0eS4UdTM/HEljvjsYiIN50e73jV7I24WNBdgrGMEyYjIl4Rp3380/Fnv/+eeM2P74sbP35W/PHd25o+NBbhKXAYD8FYwPxF5pVx/PvPi98+/7w44ZURETviuR27GjgyUo02aZ2Mnzry6HhFRMS9V8c/fn/nnI89ypFBe7mGsYCXZuBP3hAn7ndybJ6JiMmpmJjZGbsiYu0v/0VsuebMOGS60cMkwdzrGQvtOBb8K7Djwfjzk46Ic2/dFnHQL8b5H35XHDb1w/jW5uti66ab4h/ee4CzLTpHMObYbYF56msvBmPf+PlzPhBHTj0ct1z5t3H3tgPjrK//Z3z+xHUWjcwN7pZKGU3N/auw6+ktceVHzo4Lv3hX/GjwL9e+NT56/eb4k7e5S4ruEYxZZi8quwfjyLj04bvi3PU7454LXx9v/sOtse8Zt8d3rzou9mrweFneMNcw5v6V6O94Mh793hOxffX+ceABa2IPpaCjOvkcxnJjifkN/UHc8sVPx7Y9HoqbPr81IiIOOGz/MJHqht702jjw1WubPgxoXKeCsdTZ5tJnoo/HtX9wflwbEbH6oDj6zAvjsg8eHntUfYBUatg7pEZ+6A8K1YmRVBVjCdpnlFtqvf8wn2u2FGnU5y88vwHzFR+MUcYSALys+GAAUI2ig2EsAVCdooMBQHUEgyKNepeTu6RgPsEAIIlgUKxhdwl2F7CwooNhLAFQnaKDASuNvpMEWFzxwTCWYGCx97Tf7y/58zKAF3Tqmw9CyomAbz4ICyt+hxGx+xlklf8t+Zv7E/eW4n2HpXUiGANLxUAoiFj6R7lC13VyJCUM3bCS3cVif97XCrysUzsMSCESsDDBoEij7i6MpmA+wYBliAa8QDAoTlULvNEU7E4wKFYVC77RFLxMMCjKOBd20aDrBIMiVTlOMpqCFwgGJDCaAsGgIKPeSrvS/w90jWBAIqMpuk4wKEJduwujKbpMMGBIokHXCAatV/fCbTRFVwkGxahzITeaoosEg1bLYcHO4RigDoJBEZoYExlN0TWCASMwmqJLBIPWqutW2lSiQekEA0aUS7Bg3ASDVsptd2E0RRcIBlRMNCiVYNA6uS7Iuex2YFwEg9bKcYE2mqJkgkGrtGkhbtOxQgrBoJVy3F0M5HxsMArBgDEwmqJEgkFr5HYrbSrRoBSCAWPStrDBcgSDVmjr7sJoipIIBtRENGg7wSB7bd1dDLT1uGEuwYAaGE1RAsEgayUusCV+TnSDYNAKJYx1Svgc6DbBgBoZTdFmgkG22n6xezmiQdsIBtSs1ABSPsEgS6XvLoymaCPBgIaJBm0hGGSn9N3FQOmfH+URDGiQ0RRtIhhkpcsLZ5c/d9pBMMhSl8Y1XfpcaTfBIBtdPsM2mqINBIPsdP2MWzTIlWBAJroeSvInGGShK7fSLsdoipwJBmRKNMiNYNA4u4vdeR3IlWBAhoymyJFg0CgL4vK8RuRCMMiCMcx8XhNyIxg0xpnz8oymyIlg0Dhn0mlEg6YJBmROUMmFYNAIt9KujNEUORAMaBnRoCmCQe3sLobj9aJpggEtYjRFkwSDWlnoquO1pG6CQSOMV4bntaMpgkFtnBFXx2iKJggGtXOGXC3RoC5TTR8AXdSPXTMzsWtON3oTkzE5YfFL1e/3xYJa2WFQi91upX3qxjhp1XRMT+/+a92m2+OZho+zbYymqJMdBg1aE8eesSnevGYiIiZi7TEHxx5NH1KL9Xo94z7GSjAYu8Uf1NsYmy7+TJy7frL+gypI9aOpwciwF73JyZi0eeFFRlI0aEuct2Eqer1e9Hqr4rivPh7Oj4dT6WjqpZHhVExN9KLXm4x9Nrw1Trvomrj/We9Ql9lhMFZLfxuQveKod58aR+w9ERF7xhGHrq712EpV3WhqTRz7vvfEYdv/J/7putvimktOixu++cm4e/NH4vBVFXx4WkcwaNDr4qxPfclIqiLVj6Y2xqZLLo1z10/Gjoe/HKe88cy46Y6L4ndv/rW47uR1YVLVPYJBZVa+WD0QV11wbtz9ky/8udVv+I24+ENHxd7VH1pnDKJR9QXw6Q2nxG8dv2fcdMOz8R+3bY1tJ68L+8HuEQxGNvxZ7f/FnX91Rdw5+Mdjfi4u/OBRsbdT10pUHY3Bh+r1wu6iowSDoa0kFLtdy9jnnXHzThdPx2UcD/Rt3/p38elbt0XEXnHU8a8JlzC6STCgQAuNphaKyNI7kAfiqgvOjjufvz++ef0d8dDOiNVv/0T80Qn72mF0VK/vSR+GMMoZrC+5egxikfJe7faePPW1OHG/k2PzzOBfTMfaQ46ME99/QXziglNi42q56CrBYCiCkb9h3iPvDUvx4B4rNup83Pc9gnYSDCjQsFEWc5YiGAAkEQwojJEh4yIYACQRDFZs1Dtp3IkD7SQYACQRDIYy7C7B7gLaSzCgMEaGjIvvJcXQVvJT3ixC0H6+NQiVWfk3t2OcfGsQqmaHQWUsNlA21zCgUP1+f0URF3yWIxhQuKXCMfv3POHNcoykoCNSdhBV/1hXymKHAYgESQQDiIiV3SZNNwkGMI9osBDBAF5iNMVSBANYkF0GcwkGsBu7DBYjGMA8LoCzEMEAliQaDAgGsCCjKeYSDGBRRlPMJhhAEtFAMIAlGU0xIBjAsoymiBAMYIVEo7sEA0hiNIVgAMmMprpNMIChiEb3CAawIkZT3SUYwIoZTXWTYAAjEY3uEAxgKEZT3SMYwMjsMrpBMICh2WV0i2AAI3EBvDsEA6iMaJRNMICRGU11g2AAlTCaKp9gAJUTjTIJBlAZo6myCQZQKaOpcgkGMDaiURbBACpnNFUmwQDGwmiqPIIBjJ1olEEwgLExmiqLYAC1sMtoP8EAxsouoxyCAYydC+BlEAygVqLRXoIB1MJoqv0EA6iN0VS7CQbQCNFoH8EAamU01V6CAdTOaKqdBANolGi0h2AAjTCaah/BABpjNNUuggFkQTTyJxhAo4ym2kMwgMYZTbXDVNMHADBbr9erYNfRj5iZiZj7YSYmIyZEaVh2GEAWKh1NPXVjxKrpiOk5vzbdXt3/o4PsMIDsVLPLiIhYE3HGpog1ExExEXHMwRV8zO4SDCAb/X6/4usYGyMu/kzE+skKP2Z3GUkBWan2AviWiA1TEb1eRG9VxFcfr+BjdpcdBpCt0UdTe0W8+9SIvSciYs+IQ1dXdWidJBhAdqobTb0u4lNfMpKqiJEUkKUFR1O93vxf1MYOA8hav99fOgyD3/PE+Nj1+p7LB3I1zA7CkjY2RlIAJBEMIE/DXp9wXWNsBAOAJIIB5GfUXYJdxlgIBgBJBAOAJIIBQBLBACCJYAD5GfXhOw/vjYVgAJBEMIA8DbtLsLsYG8EAIInvVgvka7BbSHkQz85i7AQDyN9S4RCK2ggG0B7i0CjXMABIIhgAJBEMAJIIBgBJBAOAJIIBQBLBACCJYACQRDAASCIYACQRDACSCAYASQQDgCSCAUASwQAgiWAAkEQwAEgiGAAk+X9XZl99SNeETwAAAABJRU5ErkJggg==" alt="cond1">&lt;/p>
&lt;p>æƒ…å†µäºŒç¤ºæ„å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQEAAAEPCAYAAABC5nGNAAAABHNCSVQICAgIfAhkiAAADW9JREFUeJzt3XuMnFUdh/Hvu7vTdimU0pqWa4tcLAIh1CqBIALRFowWCkoUCoQEBFovQBFTkRgNN40JCiJ3iGAlarDWXohaoAiSqI22INEKhdIK1BKQLmmgtLv7+gedZXZ2ZnfmvZ5zfs8n2YR26e7Zd+d93nPOvLMbxXEcC4BZHWUPAEC5iABgHBEAjCMCgHFEADCOCADGEQHAOCIAGEcEAOOIAGAcEQCMIwKAcUQAMI4IAMYRAcA4IgAYRwQA44gAYFxX2QNA1mL19/WpP5aizi51RmWPB65jJhCYd5+5Rod0VVSpVLTbKb/Qlv6yRwTXEYGgvKOn771fG3b9acejt2rFq32ljgjuIwIh2bZadz74itTxEX35C/tK/U/ptiWb1Fv2uOA0IhCMWFv/9BM99LrUecLlWnDVuZoq6W+3/1Iv7Cx7bHAZEQhF/IZW3bpMb6miky6ZpQOPPEfnfFDSP+/Wz9a9W/bo4LCIXz4Shv7Ni/SpKedpVYO5//6X/VXP/ehj6i5+WPAAEXBcFA19jm/ot6xPm+48XlMv/Ys6pn1el566nyqS4m3PatG9j+p/ky7Sky/crY/vXsiQ4Rki4KhGJ3+9gW/dzvW66aOH6spnxur0pZv0m9kTFEnSjn/p+qMO1zX/Hq+z//CSHpy5Z65jhp+IgGNaOfnr8S1EGmwMAsYRAYckmQWk+XeARAQA84iAI9JezZkNICkiABhHBADjiABgHBEAjCMCjkh7ww83DCEpIgAYRwQckvRqziwAaRABwDgi4DlmAUiLCDiketdfHMcDb43Uvo87BZEWv3fAEc1O5lau9FEUMSNAYswEHNPOycyJjywQAQfULgPaxbIAaRGBkmV58hICJEEEHJFmal/7bwkB2kUESpTlCcv+AJIiAg7I+gRmNoB2EIGSpNkMbIZlAZIgAiXI8wRlWYB2EYES5XXC8rQh2kEECpbHMqCVzwc0QwQKVOQJybIArSICJSjqBGVZgFYQgYIUvQxo9vmBekSgAGWegCwLMBIiUKCyTkiWBRgOEciZayeea+NB+YhAjmpPuLKn5WV/friLCBTAlROQZQEaIQI5cf1Ec318KA4RyJkrs4AqXmSEekQgB2XfEzASV8eFchCBjPl2dfVtvMgeEciJ61dblgWoIgIZcn0ZUM+XcSJfRCAjvl5NedoQRCBjPl9dCYFNRCADvi0D6vk6bmSDCKQUytWTZYFdRCAjIV1NCYEtRCCF0E6WkEKG1hGBDIR08rAssIcIJOT7ZmArCIENRCCB0E+OkMOGoYhACiGfLCwL7CACbbKwDKhHCMJGBNpg7WSwFDrLiEAClk4OlgXhIwItsrgMqEcIwkQEWmD9wc/PHggbEWiD5VmA5a89dERgBFz5huKYhIUIDMOlXx7iApYFYSICLSAA7+NYhIcINMGVrjmeNgwLERgBV77hEQL/EYEGuCdgZBybcBCBOlzZWseyIAxEoAmudO0hBP4iAjVYBrSPY+U/IrALV7LkWBb4jQjU4cqWDiHwDxEQy4AscOz8ZT4CtVeu3t4+9Zc4Ft+xLPCT+QjUqlS61BlF6pjwYX322yv1Wl/ZI/IXIfCH6QgMfqDurbOuvUU3f+eLOujNdVpx7YX6/trtpY3NV7zIyD+mI1A1s1OS9tHJ58/XVxfM18x9JGmn3tnJ4iCJ7PcHYqmvV+qte+tnHyILZiMwsBm4ddmuv1mj+QeNUde4T+iOzdL4027UN2bsVt4AA5HJbKBnhTS6IlXq3uY+nv5jQ11lD6AMjR+Ye+mTX7pI07s26pF7fqW1S7+l61adprtmTbBbyhTiOB44zlEUZTQ7GCedN1ca1yGpQzrugAw+JkxGoCqOY6ln+a4/HajPffNGzZvSq6f3WK2jb9ygxYv+oZtnnaixpY7SX7UhyMbB0nU/lqZ0ZvgxEWwEGj34ah+UQ69Mr+qR+27R9lEv6eG7NkiSJk+bpEreAw1c9ZhnMxtYI02tPmRHSYs2SXMnpx2iecFFYLgrz/BXpS1a/N0FWixJ3fvr2Auu1u1fO0yjsh6gYelDMFY68wxp9w5JY6RDurMammlRHMitXkmmnYF86V5IdVdmz3Jp4mypb7q0cTXLgYyx54VCNLybMIqGvqFwQUQg6eYTN7MUL47j4U94YlC4IJYDaU7mAL58fyT5PvH9yZ33M4G0V3NmA7DO+wjAE0ljS6RzRwQA44gA8pf2as5sIFdEADDO+wik3d3n2QFY530EAKQTRASSXs2ZBQCBRACOSxtbYp2rYF5F2M5PumUGALwviNuGG2n28wRQIm4bdlIwM4F6nPBAa4KNANxSOzNrKc9EvDBEAIUaNENrtDzg5C8cEUDumv5UIU54J/AUIXLFS7XdRwSQm0H7AFz1nUUEkDsC4DYigFyk+unCKBQRQObYB/ALEUCm2AfwDxFALgiAP4gAMsM+gJ+IADLBPoC/iABSYx/Ab0QAqRAA/xEBZIIA+IsIIDE2AsNABJAIG4HhIAJoG/sAYSECSIwAhIEIoC3sA4SHCKBl7AOEiQigJewDhIsIoC0EIDxEACNiHyBsRADDYh8gfEQATbEPYAMRwIgIQNiIABpiH8AOIoAh2AewhQhgEPYB7CECGEAAbCICGIIA2EIEIImNQMuIANgINI4IGFcbgE3Pr9OLm3u0g8mAKUQAkqS9JE059DAdvO94jZ54rK568i3RAhu6yh4AylM7C3jzgM/o6wvmaFrnf/X07xdr3cvvKNY4sVAIXxSzE2TSoH2Ayom6Z/0junBK9ZoQqz+O1EEBTGA5YNCQjcCjztEp+9VOCgmAJUTAsI23TS97CHAAETCm9n6AD0w/VntL0jMP6nev9A76/1gk2sGeQIAaPe8fx/HQ24J3vqg7Tj1C8x7bLu3/aS24/HRN63pNz65cog1zH9Zvz57MVcIAIhCQVm/6qf2W97+1RvdccYmuvm+13qj+5fhjdOXSlfrBCTw7YAERCECSO/7qv+3xzq3a/PLr2tE9SftOHqdRnP1mEIEAZBEB2MWSz3NJ7/vn9QKoIgKAcUTAY2mv5swGIBEBwDwiABhHBADjiABgHBHwWNrn+rlXABIRAMwjAp5LejVnFoAqIgAYRwQ8xw0/SIsfNBqI2ul9s58n0Ox9sI1XEXos6W8N4rcNoRbLAU9lcUVnVgCJCHgp7W8PHmnpAFuIgGey+vXhhABVRMBTWazn2ROARAS8kseGHs8agAh4Is8dfUJgGxHwQJEnJyGwhwg4LquNwJGwUWgXEXBYUQFo9DkIgR1EwANF7uLzjIE9RMBRZd7ay0ahLUTAQS6dfC6NBfkgAo4peh+gGfYH7CACDnElAI3GQAjCRQQc5EIAqlwaC/JBBBzh8mv82SgMGxFwgE8nl09jRWuIQMlc2wdohv2BcBGBEvkSgCpCECYi4AAfAlDl01jRGiJQEpc3AkfCRmFYiEAJfA5AFSEIBxEoWIgnTYhfkyVEoEC+bQSOhI3CMBCBgoQWgCpC4D8iULCQAlAV4tdkCREoQAgbgSNho9BfRCBnFk8Ki1+zz4hAjkLdB2iG/QE/EYGcWAtAFSHwDxHImaUAVFn8mn1GBHJgYSNwJGwU+oMIZIwH/VAcE7cRgQxZ3Qdohv0BPxCBjBCAxgiB+4hAxgjAUBwTt0Ux36EUYvX39amzq/LenziUw8p+w/S9499f9+Gijk51djDraBUzgTR6VgwEQJKiqFN7Tj1GZ13zkJ57myDUy/wZg54VOnV0RZXK4LcJcx/Xtmw+gwldZQ/AZ9H42QP/ffy5F2vajuf1xyWr9ND1Z2nZEzdp7cordNjoEgfosCiKMpwRjNPx583V0eM6JHVo/HEHaFRGH9kClgMJDb6aTddtG1dr3pRO7dx4v+YceYEe3rabTlv6Hy2ZPUFMTAfLbBO1Z7lmTZytlX3vH3+0j+VAArUP4pl1j7vK1Dn6ysljJL2tv6/aoO3FDs0L2T9jsEbzp3YpiiJF0Wid+PMt4srWOpYDKcRbl2nWxNlD/37XIzCKxCygiTiOM3zKcKxmnHmGjti9Q9IYHXFId0Yf1wYi0KZBO9w9y4e8f8eGX+uWx7ZLGqsZJx8ktgSaq4Yg/f7Ah3ThD3/KciAhItBAoyvU8Feu9Xpg4SX687vP6YmlT+qlXqn7pBv0vZl7MRNoUW0Imh3/5tbrgYXztHaP9/5d9+EX67rLZmj3PAYaIDYGa7Q6PR04ZAMbU9X3VDT+wOmadf5C3bBwjg7uJgGtqAagleM/6OE65PjvctwibXlqriZx+FtCBJRsc4rDlh2Of7l4dgAwznwEku5Q82KYbHD8y2c+AoB1piOQ9mrC1Sgdjr8bTEcAABEAzCMCgHFEADDOdATS3nDCDSvpcPzdYDoCAIhA4qsJV6FscPzLZz4CgHW8gKhG269iQ6Y4/uUgAg20/3p2ZInjXywiABjHngBgHBEAjCMCgHFEADCOCADGEQHAOCIAGEcEAOOIAGAcEQCMIwKAcUQAMI4IAMYRAcA4IgAYRwQA44gAYBwRAIwjAoBxRAAwjggAxhEBwDgiABhHBADjiABgHBEAjCMCgHFEADCOCADGEQHAuP8Dl+qMi0F2KEgAAAAASUVORK5CYII=" alt="cond2">&lt;/p>
&lt;p>ç”±æ­¤ä¸€æ¥ï¼ŒåŸæœ¬çœ‹èµ·æ¥å¤æ‚çš„æ€è·¯ä¸€ä¸‹å­å˜çš„ç®€å•ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªå¤æ‚çš„é—®é¢˜åŒ–å½’åˆ°é‡å¤çš„å­é—®é¢˜ä¸Šæ¥ã€‚è¿™æ ·æˆ‘ä»¬åªéœ€è¦æ¯æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜äº†ã€‚&lt;/p>
&lt;p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> TreeNode&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">do_insert&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> v) { &lt;span style="color:#75715e">// one node at a time
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> TreeNode&lt;span style="color:#f92672">*&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TreeNode&lt;span style="color:#f92672">*&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> TreeNode(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>st.empty()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr &lt;span style="color:#f92672">=&lt;/span> st.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (ptr&lt;span style="color:#f92672">-&amp;gt;&lt;/span>value &lt;span style="color:#f92672">&amp;gt;&lt;/span> v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now&lt;span style="color:#f92672">-&amp;gt;&lt;/span>left &lt;span style="color:#f92672">=&lt;/span> ptr&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr&lt;span style="color:#f92672">-&amp;gt;&lt;/span>right&lt;span style="color:#f92672">=&lt;/span>now;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.push(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> root;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now&lt;span style="color:#f92672">-&amp;gt;&lt;/span>left &lt;span style="color:#f92672">=&lt;/span> ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.push(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root &lt;span style="color:#f92672">=&lt;/span> now;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> root;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¯¾åä¹ é¢˜---æœ€å¤§å­æ®µä¹˜ç§¯">è¯¾åä¹ é¢˜ - æœ€å¤§å­æ®µä¹˜ç§¯ &lt;a href="#%e8%af%be%e5%90%8e%e4%b9%a0%e9%a2%98---%e6%9c%80%e5%a4%a7%e5%ad%90%e6%ae%b5%e4%b9%98%e7%a7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™æ˜¯Leetcodeæ–°åŠ çš„ä¸€é¢˜ï¼Œåœ¨æ˜¨å¤©åƒæ’‘äº†å–é†‰äº†çš„æƒ…å†µä¸‹ï¼Œå‹‰å¼ºACï¼Œä»Šå¤©çœ‹æ¥ï¼Œè‡ªå·±è¿˜æ˜¯too young too simpleå•Šã€‚&lt;/p>
&lt;blockquote>
&lt;p>ç»™ä½ ä¸€ä¸ªintæ•°ç»„ï¼Œæ±‚è¿™ä¸ªintæ•°ç»„çš„æœ€å¤§å­æ®µä¹˜ç§¯ã€‚ï¼ˆä¸éœ€è¦è€ƒè™‘æº¢å‡ºï¼‰&lt;/p>&lt;/blockquote>
&lt;h3 id="ä»é›¶å¼€å§‹çš„æƒ³æ³•">ä»é›¶å¼€å§‹çš„æƒ³æ³• &lt;a href="#%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e7%9a%84%e6%83%b3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ€å¤§å­æ®µä¹˜ç§¯å¿…ç„¶æ˜¯ä¸€æ®µä¸å«æœ‰0çš„å­æ®µã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå­æ®µåˆ†å‰²ä¸ºkæ®µï¼Œæ¯ä¸€æ®µéƒ½ä¸åŒ…å«0ã€‚&lt;/p>
&lt;p>å¯¹äºæ¯ä¸€ä¸ªå­æ®µï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸€æ˜¯å°½é‡ä¸ºæ­£ï¼ŒäºŒæ˜¯å°½é‡åŒ…å«æ›´å¤šçš„æ•°ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å¯¹äºå­æ®µA[l&amp;hellip;r]ï¼Œæœ€å¤§ä¹˜ç§¯åªèƒ½ä¸ºA[m&amp;hellip;r]æˆ–A[l&amp;hellip;m]ä¸¤ç§æƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œå°±å¯ä»¥æ±‚å¾—æœ€åçš„ç»“æœäº†ã€‚&lt;/p>
&lt;p>ä¸è¿‡ã€‚ã€‚ã€‚ç­‰ä¸‹ã€‚ã€‚ã€‚è¿™çœŸç‰¹ä¹ˆtwistedå•Šã€‚ã€‚ã€‚_(:Ğ·ã€âˆ )_&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span> { &lt;span style="color:#75715e">// a drunk moron who wrote this
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> maxProduct(&lt;span style="color:#66d9ef">int&lt;/span> A[], &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, q &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pro &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i &lt;span style="color:#f92672">!=&lt;/span> n &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> A[i] &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pro &lt;span style="color:#f92672">*=&lt;/span> A[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(pro, ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> A[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (p &lt;span style="color:#f92672">&amp;lt;&lt;/span> q) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pro &lt;span style="color:#f92672">/=&lt;/span> A[p];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (p &lt;span style="color:#f92672">==&lt;/span> q) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(pro, ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> q &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x3f3f3f3f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç”¨å½’çº³æ³•è§£å†³è¿™ä¸ªé—®é¢˜">ç”¨å½’çº³æ³•è§£å†³è¿™ä¸ªé—®é¢˜ &lt;a href="#%e7%94%a8%e5%bd%92%e7%ba%b3%e6%b3%95%e8%a7%a3%e5%86%b3%e8%bf%99%e4%b8%aa%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è®©æˆ‘ä»¬åšä¸€ä¸ªå‡è®¾ï¼Œå¯¹äºA[k]æ¥è¯´ï¼Œæˆ‘ä»¬å·²çŸ¥&lt;code>mini = min(A[i...k])&lt;/code>å’Œ&lt;code>maxi = max(A[i...k])&lt;/code>ã€‚miniå’Œmaxiæ˜¯ä»¥kç»“å°¾çš„å­æ®µä¸­ï¼Œä¹˜ç§¯ç»å¯¹å€¼æœ€å¤§çš„è´Ÿæ•°/æ­£æ•°ã€‚æ‰€ä»¥æ— è®ºä¹˜ä¸€ä¸ªè´Ÿæ•°è¿˜æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œmaxiå’Œminiçš„å€¼åªä¼šæ˜¯&lt;code>maxi * a&lt;/code>å’Œ&lt;code>mini * a&lt;/code>ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¯¹äºç¬¬k+1é¡¹æ¥è¯´ï¼Œä»¥ç¬¬k+1é¡¹ç»“å°¾çš„æœ€å¤§å­åºåˆ—å¿…ä¸º&lt;code>max(mini * A[k+1], maxi * A[k+1], A[k+1])&lt;/code>(miniå’Œmaxiå¯èƒ½ä¸º0)ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œæˆ‘ä»¬ç»§ç»­ç»´æŠ¤miniå’Œmaxiä¸¤ä¸ªå€¼ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¾ªç¯çš„å­é—®é¢˜ã€‚ä»£ç ä¹Ÿå°±åœ¨æˆ‘ä»¬çš„ç¬”ä¸‹äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">maxProduct&lt;/span>(self, A):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mini, maxi &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0xdeadbeef&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> a &lt;span style="color:#f92672">in&lt;/span> A:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mini &lt;span style="color:#f92672">*=&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> maxi &lt;span style="color:#f92672">*=&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, mini, maxi, a)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mini, maxi &lt;span style="color:#f92672">=&lt;/span> min(mini, maxi, a), max(mini, maxi, a)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>FlatBufferä»£ç é˜…è¯» - 1</title><link>https://wizmann.top/posts/read-flatbuffer-1/</link><pubDate>Sun, 21 Sep 2014 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/read-flatbuffer-1/</guid><description>&lt;h2 id="flatbufferç™½çš®ä¹¦">FlatBufferç™½çš®ä¹¦ &lt;a href="#flatbuffer%e7%99%bd%e7%9a%ae%e4%b9%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Flatbufferæ˜¯ä¸€ä¸ªå…¨æ–°çš„åºåˆ—åŒ–åº“ã€‚&lt;/p>
&lt;h3 id="åŠ¨æœº">åŠ¨æœº &lt;a href="#%e5%8a%a8%e6%9c%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨è¿œå¤æ—¶ä»£ï¼Œç¨‹åºæ€§èƒ½åŸºæœ¬å–å†³äºä½ çš„æŒ‡ä»¤å’Œå¾ªç¯è¿è¡Œçš„æœ‰å¤šå¿«ã€‚ä½†æ˜¯ï¼Œåœ¨å¦‚ä»Šçš„è®¡ç®—æœºä¸Šï¼Œè®¡ç®—ç»„ä»¶çš„é€Ÿåº¦å·²ç»è¿œè¿œè¶…è¿‡å­˜å‚¨ç»„ä»¶çš„é€Ÿåº¦ã€‚å¦‚æœä½ æƒ³è®©ä½ çš„ç¨‹åºé£èµ·æ¥ï¼Œæœ€é‡è¦çš„å°±æ˜¯ä¼˜åŒ–ä½ çš„å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œç”¨å¤šå°‘å†…å­˜ï¼Œæ€æ ·å¸ƒå±€å†…å­˜ï¼Œå¦‚ä½•åˆ†é…å†…å­˜ï¼Œä½•æ—¶æ‹·è´å†…å­˜ç­‰ã€‚&lt;/p>
&lt;p>åºåˆ—åŒ–æ˜¯åœ¨ç¨‹åºä¸­éå¸¸å¸¸è§çš„ä¸€ç§æ“ä½œï¼Œå¹¶ä¸”é€šå¸¸æ˜¯ç¨‹åºæ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ã€‚ä¸€æ˜¯ç”±äºåºåˆ—åŒ–éœ€è¦é¢å¤–çš„ä¸´æ—¶ç©ºé—´å»è§£æå’Œè¡¨ç¤ºæ•°æ®ï¼ŒäºŒæ˜¯ç”±äºä¸ä¼˜é›…çš„å†…å­˜åˆ†é…æ¨¡å¼å’Œå±€éƒ¨æ€§ã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªåºåˆ—åŒ–æ¡†æ¶å¯ä»¥ä¸ä½¿ç”¨é¢å¤–çš„å¯¹è±¡ï¼Œæ²¡æœ‰é¢å¤–çš„å†…å­˜åˆ†é…ï¼Œæ²¡æœ‰å†…å­˜æ‹·è´ï¼Œè‰¯å¥½çš„æ•°æ®å±€éƒ¨æ€§ï¼Œè¿™æ­£æ˜¯å¤ªå¥½ä¸è¿‡ã€‚ä¸è¿‡å½“ä¸‹çš„å¾ˆå¤šæ¡†æ¶é€šå¸¸ä¸èƒ½æ»¡è¶³ä»¥ä¸Šçš„æ¡ä»¶ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å‘å‰/å‘åå…¼å®¹ï¼Œéœ€è¦å…¼å®¹ä¸åŒçš„å¹³å°ï¼Œä¾‹å¦‚å¤§ç«¯/å°ç«¯å’Œå†…å­˜å¯¹é½éƒ½æ˜¯éœ€è¦è¿›è¡Œå…¼å®¹æ€§å¤„ç†çš„ã€‚&lt;/p>
&lt;p>FlatBufferå¯ä»¥åšåˆ°ä»¥ä¸Šçš„ä¸€åˆ‡ã€‚&lt;/p>
&lt;p>Flatbufferå°¤å…¶é€‚åˆç§»åŠ¨è®¾å¤‡ï¼ˆå†…å­˜å®¹é‡å’Œå¸¦å®½æ¯”æ¡Œé¢è®¾å¤‡çš„è¦ä½ä¸å°‘ï¼‰ï¼Œä»¥åŠéœ€è¦é«˜æ€§èƒ½çš„åº”ç”¨ï¼šæ¸¸æˆã€‚&lt;/p>
&lt;h3 id="flatbuffers">FlatBuffers &lt;a href="#flatbuffers" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="æ€»è¿°">æ€»è¿° &lt;a href="#%e6%80%bb%e8%bf%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Flatbufferæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„bufferã€‚Flatbufferå¯ä»¥åŒ…å«åµŒå¥—å¯¹è±¡å¦‚structã€tableã€vectorç­‰å¹¶ä½¿ç”¨åç§»é‡æ¥è¿›è¡Œå¯»å€ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒéå†åŸºäºæŒ‡é’ˆçš„ç»“æ„ä¸€æ ·ï¼Œå¯¹flatbufferå…ƒç´ è¿›è¡Œin-placeçš„éå†ã€‚
Flatbufferä½¿ç”¨ä¸¥æ ¼çš„å­—èŠ‚å¯¹é½å’Œå­—èŠ‚é¡ºåºï¼ˆé€šå¸¸æ˜¯å°ç«¯ï¼‰ä»¥ä¿è¯å¯ä»¥è·¨å¹³å°ä½¿ç”¨ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œåƒtableè¿™æ ·çš„å¯¹è±¡ï¼ŒFlatbufferæä¾›äº†å‘å‰/å‘åçš„å…¼å®¹æ€§ï¼Œå’Œé€šç”¨çš„å¯é€‰å±æ€§ï¼Œä»¥æ”¯æŒå¤šå˜çš„æ•°æ®æ ¼å¼ã€‚&lt;/p>
&lt;h4 id="tables">Tables &lt;a href="#tables" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Tablesæ˜¯FlatBufferçš„åŸºçŸ³ï¼Œå› ä¸ºæ•°æ®æ ¼å¼çš„å˜åŒ–å¯¹äºå¾ˆå¤šåº”ç”¨æ¥è¯´ï¼Œæ˜¯éå¸¸æ­£å¸¸çš„äº‹ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€èˆ¬çš„åºåˆ—åŒ–æ¡†æ¶éƒ½æ˜¯åœ¨parsingçš„è¿‡ç¨‹ä¸­ï¼Œé€æ˜çš„å¤„ç†æ•°æ®æ ¼å¼çš„å˜åŒ–çš„ã€‚ä½†æ˜¯FlatBufferæ²¡æœ‰parsingçš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>Tablesä½¿ç”¨vtableæ¥å¯¹æ•°æ®è¿›è¡Œéç›´æ¥çš„è¯»å–ã€‚æ¯ä¸€ä¸ªtableéƒ½æœ‰ä¸€ä¸ªvtableï¼ˆå¯ä»¥åœ¨åŒç±»å‹çš„tablesä¸­è¿›è¡Œå…±äº«ï¼Œç±»ä¼¼C++ç±»çš„è™šè¡¨ï¼‰ï¼Œvtableä¸­åŒ…å«å­—æ®µçš„ä¿¡æ¯ã€‚åŒæ—¶ï¼Œvtableä¹Ÿè®¸ä¹ŸæŒ‡æ˜å“ªä¸€äº›å­—æ®µåœ¨å½“å‰çš„æ•°æ®ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼Œè¿™äº›å­—æ®µä¼šè¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚&lt;/p>
&lt;p>Tablesåªéœ€è¦å¾ˆå°‘çš„ç©ºé—´ï¼ˆå› ä¸ºvtableså ç”¨ç©ºé—´å¾ˆå°‘ï¼Œå¹¶ä¸”æ˜¯å…±äº«çš„ï¼‰ï¼Œå°½ç®¡åœ¨è®¿é—®æ•°æ®æ—¶æœ‰ä¸€äº›å¼€é”€ï¼Œä½†æ˜¯æä¾›äº†æå¤§çš„å¯ä¼¸ç¼©æ€§ï¼ŒTablesç”šè‡³æ¯”ç­‰ä»·çš„ç»“æ„å ç”¨å†…å­˜æ›´å°ï¼Œå› ä¸ºå½“å­—æ®µç­‰äºé»˜è®¤å€¼æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸ºå…¶åˆ†é…ç©ºé—´ã€‚&lt;/p>
&lt;p>FlatBuffersé¢å¤–æä¾›äº†â€œè£¸â€ç»“æ„ï¼Œè¿™äº›å­—æ®µä¸èƒ½å‘å‰/å‘åå…¼å®¹ï¼Œä½†æ˜¯è¿™æ ·å¯ä»¥å‡å°‘å®ƒä»¬çš„å†…å­˜å ç”¨ã€‚è¿™ç§å­—æ®µå¯¹äºä¸ç»å¸¸å˜åŒ–çš„å…ƒç´ éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚åæ ‡å¯¹å’ŒRGBAé¢œè‰²ä¿¡æ¯ã€‚&lt;/p>
&lt;h4 id="schema">Schema &lt;a href="#schema" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>Schemaå‡å°‘äº†ä¸€äº›é€šç”¨æ€§ï¼ˆåœ¨æ²¡æœ‰schemaçš„æƒ…å†µä¸‹ï¼Œä½ ä¸èƒ½è¯»å–å…¶ä¸­çš„æ•°æ®ï¼‰ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¤§éƒ¨åˆ†æ•°æ®æ ¼å¼ä¿¡æ¯å¯ä»¥è¢«ç”Ÿæˆä¸ºä»£ç ï¼Œå‡å°‘åœ¨bufferä¸­å­˜å‚¨æ•°æ®æ ¼å¼çš„æ—¶é—´/ç©ºé—´å¼€é”€ã€‚&lt;/li>
&lt;li>å¼ºç±»å‹çš„æ•°æ®å®šä¹‰æ„å‘³ç€æ›´å°‘çš„è¿è¡Œæ—¶é”™è¯¯æ£€æŸ¥å’Œå¤„ç†ã€‚&lt;/li>
&lt;li>Schemaä½¿å¾—åœ¨è¯»å–bufferå‰ä¸è¿›è¡Œè§£æã€‚&lt;/li>
&lt;/ul>
&lt;p>FlatBufferçš„schemaæ ¼å¼å’Œä»–å¤§å“¥ProtoBufç±»ä¼¼ï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹å¯ä»¥è¢«Cé£æ ¼çš„ç¼–ç¨‹è¯­è¨€æ‰€è¯»å–ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯¹å…¶protoæ ¼å¼è¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p>
&lt;ul>
&lt;li>å¼ƒç”¨æ‰‹åŠ¨ä¸ºå­—æ®µæ·»åŠ IDã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹äºæ•°æ®æ ¼å¼çš„å˜åŠ¨ï¼Œä¸€æ¥ä¼šå‡ºç°æ‰‹åŠ¨æ‰¾å¯»ä¸€ä¸ªç©ºä½(slot)çš„æƒ…å†µï¼›äºŒæ˜¯ä¼šå‡ºç°å¯¹äºå¼ƒç”¨å­—æ®µï¼Œç”±äºå‘å‰/å‘åå…¼å®¹çš„åŸå› ä¸æ•¢çœŸæ­£çš„åˆ é™¤ï¼Œå¦‚æœä½ å¹»æƒ³å¯ä»¥å¤ç”¨å­—æ®µï¼Œä½ å°±ç»™è‡ªå·±æŒ–äº†ä¸€ä¸ªæ›´å¤§çš„å‘ã€‚&lt;/li>
&lt;li>tableså’Œstructsæ˜¯ä¸åŒçš„ã€‚tablesçš„å­—æ®µæ˜¯å¯é€‰çš„ï¼Œè€Œstructsçš„å­—æ®µæ˜¯å¿…é¡»çš„ã€‚&lt;/li>
&lt;li>åŸç”Ÿçš„vectoræ”¯æŒï¼Œå–ä»£&lt;code>repeated&lt;/code>å…³é”®å­—ã€‚è¿™æ ·æ— éœ€éå†å°±å¯ä»¥çŸ¥é“vectorçš„é•¿åº¦ã€‚è¿™æ ·å¯ä»¥è®©æ•°æ®çš„è¡¨ç¤ºæ›´åŠ ç´§å‡‘ã€‚&lt;/li>
&lt;li>åŸç”Ÿçš„unionç±»å‹æ”¯æŒã€‚é¿å…ä½¿ç”¨ä¸€ç³»åˆ—çš„optionalå­—æ®µè€Œé€ æˆçš„å†—é•¿çš„æ‰‹åŠ¨æ£€æŸ¥ã€‚&lt;/li>
&lt;li>å…è®¸ä¸ºæ ‡é‡è®¾åˆå€¼ï¼Œæ— éœ€å¤„ç†å¯é€‰å­—æ®µã€‚&lt;/li>
&lt;li>Parserå¯ä»¥ç»Ÿä¸€çš„å¤„ç†schemaå’ŒJSONè¡¨ç¤ºçš„æ•°æ®å®šä¹‰ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="benchmark">Benchmark &lt;a href="#benchmark" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;table class="table-bordered table-hover">
&lt;tbody>
&lt;tr>
&lt;th>&lt;/th>&lt;th>FlatBuffers (binary) &lt;/th>&lt;th>Protocol Buffers LITE &lt;/th>&lt;th>Rapid JSON &lt;/th>&lt;th>FlatBuffers (JSON) &lt;/th>&lt;th>pugixml &lt;/th>&lt;/tr>
&lt;tr>
&lt;td>Decode + Traverse + Dealloc (1 million times, seconds) &lt;/td>&lt;td>0.08 &lt;/td>&lt;td>302 &lt;/td>&lt;td>583 &lt;/td>&lt;td>105 &lt;/td>&lt;td>196 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Decode / Traverse / Dealloc (breakdown) &lt;/td>&lt;td>0 / 0.08 / 0 &lt;/td>&lt;td>220 / 0.15 / 81 &lt;/td>&lt;td>294 / 0.9 / 287 &lt;/td>&lt;td>70 / 0.08 / 35 &lt;/td>&lt;td>41 / 3.9 / 150 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Encode (1 million times, seconds) &lt;/td>&lt;td>3.2 &lt;/td>&lt;td>185 &lt;/td>&lt;td>650 &lt;/td>&lt;td>169 &lt;/td>&lt;td>273 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Wire format size (normal / zlib, bytes) &lt;/td>&lt;td>344 / 220 &lt;/td>&lt;td>228 / 174 &lt;/td>&lt;td>1475 / 322 &lt;/td>&lt;td>1029 / 298 &lt;/td>&lt;td>1137 / 341 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Memory needed to store decoded wire (bytes / blocks) &lt;/td>&lt;td>0 / 0 &lt;/td>&lt;td>760 / 20 &lt;/td>&lt;td>65689 / 4 &lt;/td>&lt;td>328 / 1 &lt;/td>&lt;td>34194 / 3 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Transient memory allocated during decode (KB) &lt;/td>&lt;td>0 &lt;/td>&lt;td>1 &lt;/td>&lt;td>131 &lt;/td>&lt;td>4 &lt;/td>&lt;td>34 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Generated source code size (KB) &lt;/td>&lt;td>4 &lt;/td>&lt;td>61 &lt;/td>&lt;td>0 &lt;/td>&lt;td>4 &lt;/td>&lt;td>0 &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Field access in handwritten traversal code &lt;/td>&lt;td>typed accessors &lt;/td>&lt;td>typed accessors &lt;/td>&lt;td>manual error checking &lt;/td>&lt;td>typed accessors &lt;/td>&lt;td>manual error checking &lt;/td>&lt;/tr>
&lt;tr>
&lt;td>Library source code (KB) &lt;/td>&lt;td>15 &lt;/td>&lt;td>some subset of 3800 &lt;/td>&lt;td>87 &lt;/td>&lt;td>43 &lt;/td>&lt;td>327 &lt;/td>&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>æœ€å°è¡¨ç¤ºæ³•åŠå…¶è¯æ˜</title><link>https://wizmann.top/posts/minimal-round-string/</link><pubDate>Wed, 17 Sep 2014 00:46:16 +0000</pubDate><guid>https://wizmann.top/posts/minimal-round-string/</guid><description>&lt;h2 id="é—®é¢˜">é—®é¢˜ &lt;a href="#%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>å¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²Sï¼Œæ±‚Sçš„å¾ªç¯çš„åŒæ„å­—ç¬¦ä¸²Sâ€™ä¸­å­—å…¸åºæœ€å°çš„ä¸€ä¸ªã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼Œå­—ç¬¦ä¸²&amp;quot;abcd&amp;quot;çš„å¾ªç¯åŒæ„å­—ç¬¦ä¸²æœ‰ï¼š&lt;code>[&amp;quot;abcd&amp;quot;, &amp;quot;bcda&amp;quot;, &amp;quot;cdab&amp;quot;, &amp;quot;dabc&amp;quot;]&lt;/code>ã€‚&lt;/p>
&lt;p>é¢˜ç›®çš„ç›®æ ‡æ˜¯æ±‚è¿™äº›å­—ç¬¦ä¸²ä¸­å­—å…¸åºæœ€å°çš„é‚£ä¸ªã€‚&lt;/p>
&lt;h2 id="æš´åŠ›è§£æ³•">æš´åŠ›è§£æ³• &lt;a href="#%e6%9a%b4%e5%8a%9b%e8%a7%a3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æš´åŠ›è§£æ³•éå¸¸ç›´è§‚ï¼Œç›´æ¥æšä¸¾å­—ç¬¦ä¸²çš„èµ·ç‚¹ï¼Œç„¶åæ‰¾åˆ°æ„æˆæœ€å°å­—ç¬¦ä¸²çš„é‚£ä¸€ä¸ªã€‚&lt;/p>
&lt;p>ä»£ç å°±ä¸åœ¨è¿™é‡Œå†™äº†ã€‚&lt;/p>
&lt;h2 id="æœ€å°è¡¨ç¤ºæ³•">æœ€å°è¡¨ç¤ºæ³• &lt;a href="#%e6%9c%80%e5%b0%8f%e8%a1%a8%e7%a4%ba%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ€å°è¡¨ç¤ºæ³•æ˜¯è§£å†³åŒæ„å­—ç¬¦ä¸²æœ€å°è¡¨ç¤ºçš„å·§å¦™ç®—æ³•ã€‚&lt;/p>
&lt;p>å…¶ç®—æ³•æè¿°å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>ä»¤i=0,j=1
å¦‚æœS[i] &amp;gt; S[j] i=j, j=i+1
å¦‚æœS[i] &amp;lt; S[j] j++
å¦‚æœS[i] == S[j] è®¾æŒ‡é’ˆkï¼Œåˆ†åˆ«ä»iå’Œjä½ç½®å‘ä¸‹æ¯”è¾ƒï¼Œç›´åˆ°S[i] != S[j]
å¦‚æœS[i+k] &amp;gt; S[j+k] i=j,j=i+1
å¦åˆ™j = j + k + 1
è¿”å›i
&lt;/code>&lt;/pre>&lt;p>åˆçœ‹è¿™ä¸ªç®—æ³•ï¼Œä¸€èˆ¬éƒ½ä¼šä¸€å¤´é›¾æ°´ï¼šè¿™TMDæ˜¯å˜›ç©æ„å„¿ï¼Ÿ&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»è¿‡è¯æ˜ï¼Œæ¥è¯å®å®ƒçš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;h3 id="æœ€å°è¡¨ç¤ºæ³•çš„æ­£ç¡®æ€§è¯æ˜">æœ€å°è¡¨ç¤ºæ³•çš„æ­£ç¡®æ€§è¯æ˜ &lt;a href="#%e6%9c%80%e5%b0%8f%e8%a1%a8%e7%a4%ba%e6%b3%95%e7%9a%84%e6%ad%a3%e7%a1%ae%e6%80%a7%e8%af%81%e6%98%8e" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>é¦–å…ˆï¼Œ&lt;code>S = S ++ S&lt;/code>&lt;/p>
&lt;p>è®¾&lt;code>i &amp;lt; j&lt;/code>ï¼Œä¸”&lt;code>S[i] &amp;lt; S[i + 1 ... j - 1]&lt;/code>ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ä»¥iä¸ºèµ·ç‚¹çš„å­—ç¬¦ä¸²ä¸º&lt;code>RS[i]&lt;/code>ï¼Œä»¥jä¸ºèµ·ç‚¹çš„å­—ç¬¦ä¸²ä¸º&lt;code>RS[j]&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸”&lt;code>RS[i]&lt;/code>ä¸º&lt;code>RS[0...i-1]&lt;/code>å­—å…¸åºæœ€å°çš„ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>RS[i] = S[i...i+k] ++ S[i+k+1 ... i+n-1]
RS[j] = S[j...j+k] ++ S[j+k+1 ... j+n-1]
&lt;/code>&lt;/pre>&lt;p>ä»¥ä¸Šä¸ºæˆ‘ä»¬çš„å­é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;code>i = 0, j = 1&lt;/code>æ—¶ï¼Œå­é—®é¢˜å³æˆç«‹ã€‚&lt;/p>
&lt;h4 id="æƒ…å†µ0">æƒ…å†µ0 &lt;a href="#%e6%83%85%e5%86%b50" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>æ˜“å¾—ã€‚&lt;/p>
&lt;p>å½“&lt;code>S[i] &amp;lt; S[j]&lt;/code>æ—¶ï¼Œ&lt;code>j++&lt;/code>ã€‚&lt;/p>
&lt;p>å½“&lt;code>S[i] &amp;gt; S[j]&lt;/code>æ—¶ï¼Œ&lt;code>i = j; j++&lt;/code>ã€‚&lt;/p>
&lt;h4 id="æƒ…å†µ1">æƒ…å†µ1 &lt;a href="#%e6%83%85%e5%86%b51" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;code>S[i+k+1 ... i+n-1] == S[j+k+1 ... j+n-1]&lt;/code>ã€‚&lt;/p>
&lt;p>æ­¤æ—¶æ˜“å¾—ï¼Œå­—ç¬¦ä¸²Sæ˜¯ç”±ä¸€ä¸ªé•¿åº¦ä¸ºkçš„å­ä¸²å¾ªç¯å¤åˆ¶ç”Ÿæˆã€‚æ‰€æœ‰çš„åŒæ„å­ä¸²åªæœ‰&lt;code>RS[i ... j-1]&lt;/code>è¿™kä¸ªï¼Œåˆç”±äº&lt;code>RS[i + 1 ... j - 1]&lt;/code>çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½å­—å…¸åºå¤§äº&lt;code>RS[i]&lt;/code>ã€‚æ‰€ä»¥iå³ä¸ºæœ€åçš„ç­”æ¡ˆã€‚&lt;/p>
&lt;h4 id="æƒ…å†µ2">æƒ…å†µ2 &lt;a href="#%e6%83%85%e5%86%b52" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;code>S[i+k+1 ... i+n-1] &amp;gt; S[j+k+1 ... j+n-1]&lt;/code>ï¼Œé‚£ä¹ˆæ­¤æ—¶&lt;code>RS[i] &amp;gt; RS[j]&lt;/code>ã€‚&lt;/p>
&lt;p>ç”±äº&lt;code>S[i...i+k] == S[j...j+k]&lt;/code>ï¼Œä¸”è¿™ä¸¤ä¸ªå‰è¾ä¸­ï¼Œåªæœ‰&lt;code>S[i] == S[j]&lt;/code>å­—å…¸åºæœ€å°ã€‚&lt;/p>
&lt;p>æ‰€ä»¥iæŒ‡å‘jç‚¹ï¼Œä¿æŒæœ€å°æ€§è´¨ã€‚è€Œjåˆ™æŒ‡å‘&lt;code>j + k + 1&lt;/code>ã€‚&lt;/p>
&lt;p>ä¿æŒi &amp;lt; jï¼Œä¸”S[i] &amp;lt;= S[j]çš„æ€§è´¨ã€‚ä½¿é—®é¢˜å›åˆ°æˆ‘ä»¬å½’çº³çš„å­é—®é¢˜ä¸Šæ¥ã€‚&lt;/p>
&lt;h4 id="æƒ…å†µ3">æƒ…å†µ3 &lt;a href="#%e6%83%85%e5%86%b53" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>&lt;code>S[i+k+1 ... i+n-1] &amp;lt; S[j+k+1 ... j+n-1]&lt;/code>ï¼Œé‚£ä¹ˆæ­¤æ—¶&lt;code>RS[i] &amp;lt; RS[j]&lt;/code>ã€‚&lt;/p>
&lt;p>ç”±äº&lt;code>S[i...i+k] == S[j...j+k]&lt;/code>ï¼Œä¸”è¿™ä¸¤ä¸ªå‰è¾ä¸­ï¼Œåªæœ‰&lt;code>S[i] == S[j]&lt;/code>å­—å…¸åºæœ€å°ã€‚&lt;/p>
&lt;p>æ‰€ä»¥iä¸å˜ï¼Œä¿æŒæœ€å°æ€§è´¨ã€‚è€ŒjæŒ‡å‘&lt;code>j + k + 1&lt;/code>ã€‚&lt;/p>
&lt;p>ä¿æŒi &amp;lt; jï¼Œä¸”S[i] &amp;lt;= S[j]çš„æ€§è´¨ã€‚ä½¿é—®é¢˜å›åˆ°æˆ‘ä»¬å½’çº³çš„å­é—®é¢˜ä¸Šæ¥ã€‚&lt;/p>
&lt;h2 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Result: wizmann 1509 Accepted 272K 16MS C++ 1247B 2014-09-17 00:44:22
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">12345&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> instr[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> str, &lt;span style="color:#66d9ef">int&lt;/span> n)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (n &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, q &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (p &lt;span style="color:#f92672">&amp;lt;&lt;/span> n &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> q &lt;span style="color:#f92672">&amp;lt;&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (str[p] &lt;span style="color:#f92672">&amp;lt;&lt;/span> str[q]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (str[p] &lt;span style="color:#f92672">&amp;gt;&lt;/span> str[q]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> i, l &lt;span style="color:#f92672">=&lt;/span> p, r &lt;span style="color:#f92672">=&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ll &lt;span style="color:#f92672">=&lt;/span> l &lt;span style="color:#f92672">%&lt;/span> n, rr &lt;span style="color:#f92672">=&lt;/span> r &lt;span style="color:#f92672">%&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (str[ll] &lt;span style="color:#f92672">&amp;lt;&lt;/span> str[rr]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q &lt;span style="color:#f92672">=&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (str[ll] &lt;span style="color:#f92672">&amp;gt;&lt;/span> str[rr]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q &lt;span style="color:#f92672">=&lt;/span> rr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> l&lt;span style="color:#f92672">++&lt;/span>; r&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i &lt;span style="color:#f92672">==&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> T;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(T);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (T&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, instr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> u &lt;span style="color:#f92672">=&lt;/span> solve(instr, strlen(instr));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#f92672">++&lt;/span>u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>è¯æ˜çš„é€»è¾‘æ€§ä¸å¥½ï¼Œä½†æ˜¯åº”è¯¥æ˜¯å¯¹çš„ã€‚åªæ˜¯è¯­è¨€è¡¨è¾¾ä¸Šé—®é¢˜å¾ˆå¤§ã€‚&lt;/li>
&lt;li>æœ‰ä¸€ä¸ªå¥½çš„å­é—®é¢˜å‡è®¾ä¼šå¤§å¤§æå‡åšé¢˜æ•ˆç‡å•Šï¼&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://blog.csdn.net/cclsoft/article/details/5467743">ç†è§£å­—ç¬¦ä¸²å¾ªç¯åŒæ„çš„æœ€å°è¡¨ç¤ºæ³•&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>System Design - æœ€çƒ­é—¨çš„IPåœ°å€</title><link>https://wizmann.top/posts/hottest-ip-address/</link><pubDate>Fri, 08 Aug 2014 01:25:54 +0000</pubDate><guid>https://wizmann.top/posts/hottest-ip-address/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢ &lt;a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é—®é¢˜æ˜¯éå¸¸æµè¡Œçš„ï¼Œä¹Ÿç¡®å®æµè¡Œäº†ä¸€é˜µçš„system-designé—®é¢˜ã€‚åœ¨&lt;a href="http://www.zhihu.com/question/19805967">çŸ¥ä¹&lt;/a>ä¸Šå†æ¬¡è¢«äººæèµ·ã€‚ç„¶åæˆ‘éå¸¸æ¬£èµ&lt;a href="http://zhi.hu/3gJb">é™ˆç¡•çš„å›ç­”&lt;/a>ã€‚æ‰€ä»¥è¦å†™ä¸€ç¯‡æ–‡ç« ï¼Œè®°ä¸‹è‡ªå·±çš„æ„Ÿæƒ³ã€‚&lt;/p>
&lt;h2 id="é—®é¢˜">é—®é¢˜ &lt;a href="#%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æµ·é‡æ•°æ®ç®—æ³•:å¦‚ä½•ä»è¶…è¿‡10Gçš„è®°å½•IPåœ°å€çš„æ—¥å¿—ä¸­ï¼Œè¾ƒå¿«çš„æ‰¾å‡ºç™»å½•æ¬¡æ•°æœ€å¤šçš„ä¸€ä¸ªIPï¼Ÿ&lt;/p>
&lt;h2 id="é“¶å¼¹">é“¶å¼¹ï¼Ÿ &lt;a href="#%e9%93%b6%e5%bc%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¢å¯¹è¿™ç§system-designé—®é¢˜ï¼Œå°¤å…¶æ˜¯è¿™ç§ï¼Œ&lt;strong>éé«˜å¹¶å‘ã€éå®æ—¶&lt;/strong>çš„é—®é¢˜ï¼Œå¾ˆå¤šäººä¼šé‡‡ç”¨_map-reduce_ â€”â€” è§£å†³system-designé—®é¢˜çš„é“¶å¼¹ã€‚&lt;/p>
&lt;p>æˆ‘å¯¹map-reduceçš„ç†è§£éå¸¸è‚¤æµ…ï¼Œä½†æ˜¯å¯ä»¥è§£é‡Šä¸€ä¸‹å¤§æ¦‚çš„æµç¨‹ã€‚&lt;/p>
&lt;ol>
&lt;li>å°†æ—¥å¿—è¿›è¡Œåˆ†ç‰‡ã€‚æŠŠhash(ip)ç›¸åŒçš„ipåœ°å€åˆ†åˆ°åŒä¸€ä¸ªç‰‡ä¸­ã€‚ï¼ˆæ³¨ï¼šè¿™é‡Œçš„hashå¹¶ä¸æ˜¯ç­¾åå‡½æ•°ï¼Œåªæ˜¯ä¸€ä¸ªåˆ†ç‰‡æ ‡ç¤ºï¼‰&lt;/li>
&lt;li>åˆ†ç‰‡åçš„æ—¥å¿—çš„å¤§å°ä¼šå°å¾ˆå¤šï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œæ’åºï¼Œè®°æ•°ã€‚&lt;/li>
&lt;li>ç„¶åå†ä»å„ä¸ªç‰‡ä¸­ï¼Œç»Ÿè®¡å‡ºæœ€çƒ­é—¨çš„IPåœ°å€ã€‚ï¼ˆæˆ–TopKçš„IPåœ°å€ï¼‰&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœä¸æ»¡æ„æˆ‘çš„ç­”æ¡ˆçš„è¯ï¼Œæ¨è&lt;a href="http://book.douban.com/subject/19934150/">Mining of Massive Datasets&lt;/a>ä¸€ä¹¦ï¼Œå…¶ä¸­å¯¹map-reduceç®—æ³•åšä¸€ç•ªä¸é”™çš„ä»‹ç»ã€‚&lt;/p>
&lt;h2 id="æ­£ç¡®çš„åˆ†æå§¿åŠ¿">æ­£ç¡®çš„åˆ†æå§¿åŠ¿ &lt;a href="#%e6%ad%a3%e7%a1%ae%e7%9a%84%e5%88%86%e6%9e%90%e5%a7%bf%e5%8a%bf" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ä¸šåŠ¡å®ä½“">ä¸šåŠ¡å®ä½“ &lt;a href="#%e4%b8%9a%e5%8a%a1%e5%ae%9e%e4%bd%93" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ä¸šåŠ¡å®ä½“æ‹¥æœ‰å››ç§ä¸»è¦çš„ç»„ä»¶ï¼š ä¿¡æ¯æ¨¡å‹ã€ç”Ÿå‘½å‘¨æœŸæ¨¡å‹ã€è®¿é—®ç­–ç•¥ä»¥åŠé€šçŸ¥ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ¢å¥è¯è¯´ï¼Œä¸šåŠ¡å®ä½“å°±æ˜¯é¢˜ç›®ä¸­æåˆ°çš„â€œåè¯â€ã€‚&lt;/p>
&lt;p>åœ¨æœ¬é¢˜ä¸­ï¼Œä¸šåŠ¡å®ä½“æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>IPåœ°å€ï¼ˆé»˜è®¤ä¸ºipv4ï¼‰&lt;/li>
&lt;li>æœ€çƒ­é—¨IPåœ°å€&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸šåŠ¡åº”ç”¨">ä¸šåŠ¡åº”ç”¨ &lt;a href="#%e4%b8%9a%e5%8a%a1%e5%ba%94%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸šåŠ¡åº”ç”¨æŒ‡çš„æ˜¯å½“å‰åœºæ™¯çš„&lt;strong>ç‰¹æ®Š&lt;/strong>åº”ç”¨ï¼Œä»¥åŠä¸šåŠ¡å®ä½“çš„å…³è”å…³ç³»ã€‚&lt;/p>
&lt;p>åœ¨æœ¬é—®é¢˜ä¸­ï¼Œä¸šåŠ¡åº”ç”¨æŒ‡çš„æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰¾åˆ°&lt;strong>æœ€çƒ­é—¨&lt;/strong>çš„IPåœ°å€&lt;/li>
&lt;li>å¤§æ•°æ®é‡ï¼Œ10Gçš„æ—¥å¿—æ–‡ä»¶ â€”â€” ä¸æ–¹ä¾¿åœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œ
ï¼ˆåœ¨åŠ¨è¾™ä¸Šç™¾Gçš„æœåŠ¡å™¨é¢å‰ï¼Œ10Gçš„æ•°æ®é‡çœŸæ˜¯å¼±çˆ†äº†^_^)&lt;/li>
&lt;/ul>
&lt;h3 id="ç‰©ç†">ç‰©ç† &lt;a href="#%e7%89%a9%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç‰©ç†æŒ‡çš„æ˜¯æ•°æ®çš„ç‰©ç†æ¨¡å‹ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€æ•°æ®åº“è¡¨ç­‰ã€‚&lt;/p>
&lt;p>åœ¨æœ¬é¢˜ä¸­ï¼ŒæŒ‡çš„æ˜¯å¯¹IPåœ°å€å­˜å‚¨å’Œè®°æ•°çš„æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;h3 id="è®©æˆ‘ä»¬åšä¸€ä¸‹åˆ†æ">è®©æˆ‘ä»¬åšä¸€ä¸‹åˆ†æ &lt;a href="#%e8%ae%a9%e6%88%91%e4%bb%ac%e5%81%9a%e4%b8%80%e4%b8%8b%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ¬é¢˜ä¸­ï¼Œä¸šåŠ¡å®ä½“çš„ç‰¹ç‚¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>IPv4å¯ä»¥ç”±ä¸€ä¸ªuint32_tæ¥è¡¨ç¤º&lt;/li>
&lt;li>ipåœ°å€æ˜¯ç¨€ç–çš„
&lt;ul>
&lt;li>å¤§éƒ¨åˆ†ipåœ°å€çš„è®¿é—®æ¬¡æ•°éå¸¸å°‘ï¼ˆé•¿å°¾ï¼‰&lt;/li>
&lt;li>å¾ˆå¤šipåœ°å€æ˜¯ä¿ç•™åœ°å€ï¼Œæ‰€ä»¥ä¸å¯èƒ½å‡ºç°åœ¨æ—¥å¿—ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä¸šåŠ¡åº”ç”¨çš„ç‰¹ç‚¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>â€œæœ€çƒ­é—¨â€è¡¨ç¤ºè¦æ±‚å¾—ç²¾ç¡®è§£ï¼Œè€Œä¸æ˜¯æ»¡æ„è§£&lt;/li>
&lt;li>å†…å­˜é™åˆ¶&lt;/li>
&lt;/ul>
&lt;p>åº”ç”¨çš„ç‰©ç†ç»“æ„çš„ç‰¹ç‚¹æ˜¯ï¼š æ”¯æŒå­˜å‚¨ä¸è®°æ•°&lt;/p>
&lt;h2 id="æ— ä»£ç æ— çœŸç›¸">æ— ä»£ç æ— çœŸç›¸ &lt;a href="#%e6%97%a0%e4%bb%a3%e7%a0%81%e6%97%a0%e7%9c%9f%e7%9b%b8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;assert.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdint.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static_assert&lt;/span>(&lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;64-bit only.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">uint8_t&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> counts_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">IPcount&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">uint32_t&lt;/span> ip;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">uint32_t&lt;/span> count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>(IPcount rhs) &lt;span style="color:#66d9ef">const&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> { &lt;span style="color:#66d9ef">return&lt;/span> ip &lt;span style="color:#f92672">&amp;lt;&lt;/span> rhs.ip; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>std&lt;span style="color:#f92672">::&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>IPcount&lt;span style="color:#f92672">&amp;gt;&lt;/span> overflows_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IPcount top;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">addOverflow&lt;/span>(&lt;span style="color:#66d9ef">uint32_t&lt;/span> ip)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IPcount newItem &lt;span style="color:#f92672">=&lt;/span> { ip, &lt;span style="color:#ae81ff">256&lt;/span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">auto&lt;/span> it &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>lower_bound(overflows_.begin(), overflows_.end(), newItem);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (it &lt;span style="color:#f92672">!=&lt;/span> overflows_.end() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> it&lt;span style="color:#f92672">-&amp;gt;&lt;/span>ip &lt;span style="color:#f92672">==&lt;/span> ip)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> it&lt;span style="color:#f92672">-&amp;gt;&lt;/span>count&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(it&lt;span style="color:#f92672">-&amp;gt;&lt;/span>count &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;you need larger count variable&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> newItem.count &lt;span style="color:#f92672">=&lt;/span> it&lt;span style="color:#f92672">-&amp;gt;&lt;/span>count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> overflows_.insert(it, newItem);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (newItem.count &lt;span style="color:#f92672">&amp;gt;&lt;/span> top.count)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top &lt;span style="color:#f92672">=&lt;/span> newItem;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">uint32_t&lt;/span> ip)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (counts_[ip] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">255&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> addOverflow(ip);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> counts_[ip]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (counts_[ip] &lt;span style="color:#f92672">&amp;gt;&lt;/span> top.count)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top.ip &lt;span style="color:#f92672">=&lt;/span> ip;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top.count &lt;span style="color:#f92672">=&lt;/span> counts_[ip];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">uint32_t&lt;/span> &lt;span style="color:#a6e22e">getMostFrequenntIP&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> top.ip;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> assert(counts_.max_size() &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0xFFFFFFFFUL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> counts_.resize(&lt;span style="color:#ae81ff">1L&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%zd&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, counts_.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> add(&lt;span style="color:#ae81ff">0x1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> add(&lt;span style="color:#ae81ff">0x2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> add(&lt;span style="color:#ae81ff">0x2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (size_t i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#ae81ff">1L&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>)&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>; &lt;span style="color:#f92672">++&lt;/span>i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> add(&lt;span style="color:#ae81ff">0x3&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%08x %u&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, top.ip, top.count);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä»ä»£ç è¯´å¼€æ¥">ä»ä»£ç è¯´å¼€æ¥ &lt;a href="#%e4%bb%8e%e4%bb%a3%e7%a0%81%e8%af%b4%e5%bc%80%e6%9d%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™æ®µä»£ç ä¸ç®—æœ€æ¼‚äº®ï¼Œæœ‰å‡ ä¸ªå°æ§½ç‚¹ï¼Œä½†ä¹Ÿç®—æ˜¯éå¸¸ä¼˜é›…çš„ã€‚&lt;/p>
&lt;p>ä»æ€è·¯ä¸Šè¯´ï¼Œè¿™æ®µä»£ç æ³¨æ„åˆ°äº†æˆ‘ä»¬åˆšæ‰åˆ†æåˆ°çš„ï¼Œè¿™ä¸ªé—®é¢˜çš„ä¸šåŠ¡ç‰¹ç‚¹ã€‚&lt;/p>
&lt;ol>
&lt;li>ipv4åœ°å€å¯ä»¥å­˜åœ¨uint32_tä¸­ï¼Œæ— éœ€å­˜å‚¨å­—ç¬¦ä¸²&lt;/li>
&lt;li>ipåœ°å€æ˜¯ç¨€ç–çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€å±‚uint_8è¿›è¡Œå“ˆå¸Œè®°æ•°ï¼Œå¯¹äºå°‘æ•°çš„çƒ­é—¨ipå†è¿›è¡Œuint32_tè®¡æ•°
ï¼ˆåŒæ—¶è€ƒè™‘äº†ipåœ°å€çš„ç¨€ç–æ€§ä»¥åŠå†…å­˜çš„é™åˆ¶ï¼Œå¹¶ä¸”å¯¹å†…å­˜çš„ä¼˜é›…ä½¿ç”¨ï¼Œå¯ä»¥æé«˜ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œæé«˜æ•ˆç‡ï¼‰&lt;/li>
&lt;li>ä½¿ç”¨ç²¾ç¡®è®¡æ•°ï¼Œè·å¾—æ­£ç¡®è§£&lt;/li>
&lt;/ol>
&lt;h3 id="ä»£ç ç•™ç»™æˆ‘ä»¬çš„æ€è€ƒé¢˜">ä»£ç ç•™ç»™æˆ‘ä»¬çš„æ€è€ƒé¢˜ &lt;a href="#%e4%bb%a3%e7%a0%81%e7%95%99%e7%bb%99%e6%88%91%e4%bb%ac%e7%9a%84%e6%80%9d%e8%80%83%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>ç»ƒä¹ ï¼šæ‰¾å‡º worse caseï¼Œè®©è¿è¡Œæ—¶é—´é•¿è¾¾å‡ åˆ†é’Ÿç”šè‡³åå‡ åˆ†é’Ÿï¼Œç„¶åæå‡ºå¹¶å®æ–½æ”¹è¿›æªæ–½&lt;/p>&lt;/blockquote>
&lt;p>ç”±äºæˆ‘ä»¬æ‹¿ä¸å‡ºreal worldä¸­çš„dataï¼Œæ‰€ä»¥å¾ˆå¤šåˆ†æéƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼Œä¸è¿‡ä¸€åˆ‡çš„å®è·µä¹Ÿéƒ½æ˜¯ä»çº¸ä¸Šè°ˆå…µå¼€å§‹ã€‚&lt;/p>
&lt;ul>
&lt;li>é¢˜ç›®ä¸­çš„&lt;code>std::vector&amp;lt;IPcount&amp;gt; overflows_;&lt;/code>ä½¿ç”¨&lt;code>unordered_map&lt;/code>æ›´å¥½ï¼Œå‡å°‘æŸ¥æ‰¾çš„æ—¶é—´ï¼ˆO(logN) =&amp;gt; O(1)ï¼‰ï¼Œå¹¶ä¸”å‡å°‘æ’å…¥çš„æ—¶é—´ï¼ˆO(N) =&amp;gt; O(1)ï¼‰&lt;/li>
&lt;li>&lt;code>std::vector&amp;lt;uint8_t&amp;gt; counts_;&lt;/code>å¯ä»¥åœ¨é€‚å½“çš„æƒ…å†µè°ƒæ•´ä¸º&lt;code>uint16_t&lt;/code>ï¼Œå¯ä»¥å‡å°‘å“ˆå¸ŒèŠ‚ç‚¹ç”Ÿæˆå¯¹äºå†…å­˜çš„é¢‘ç¹ç”³è¯·ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¢˜ç›®ä¸­çš„åˆ†ææœ‰å¾ˆå¤šæ˜¯â€œæ‰§æœç´¢å› â€çš„æˆæœï¼Œæ¯•ç«Ÿåæ¨æ¯”æ­£æ¨è¦æ›´å®¹æ˜“ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>æƒ³è¦ä»åæ¨æå‡ä¸ºæ­£æ¨ï¼ŒçœŸçš„éœ€è¦è‰¯å¥½çš„å‘æ•£æ€ç»´ä»¥åŠæ•é”çš„æ´å¯ŸåŠ›ã€‚å› ä¸ºé¢è¯•æ—¶ï¼Œæ²¡äººä¼šæŠŠé¢˜ç›®å¸®ä½ å†™åœ¨çº¸ä¸Šã€‚&lt;/p>
&lt;p>è¯è¯´ï¼Œæˆ‘æ‰çŸ¥é“ipv6æ˜¯128ä½çš„ã€‚é‚£ä¹ˆå½“é¢˜ç›®ä¸­çš„ipåœ°å€ä¸ºipv6æ—¶ï¼Œåˆä¼šæœ‰ä»€ä¹ˆå¥½æ–¹æ³•å‘¢ï¼Ÿ&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://www.infoq.com/cn/news/2010/05/BEDL">ä»‹ç»ï¼šä¸šåŠ¡å®ä½“å’Œä¸šåŠ¡å®ä½“å®šä¹‰è¯­è¨€&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Single Number Problem</title><link>https://wizmann.top/posts/single-number-in-the-array/</link><pubDate>Tue, 05 Aug 2014 23:07:02 +0000</pubDate><guid>https://wizmann.top/posts/single-number-in-the-array/</guid><description>&lt;h2 id="introduction">Introduction &lt;a href="#introduction" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>There are a lot of interview problem based on the 1D-array, which is the one of the easiest &amp;ldquo;data structure&amp;rdquo;.&lt;/p>
&lt;p>But the problem about that simple data structure might not be that simple. Here is the summary of the problem about 1D-array.&lt;/p>
&lt;p>Of course, most of them come from Leetcode.&lt;/p>
&lt;h2 id="all-twice-excpet-one">All Twice Excpet One &lt;a href="#all-twice-excpet-one" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Given an array of integers, every element appears twice except for one. Find that single one.&lt;/p>&lt;/blockquote>
&lt;p>This &lt;a href="https://oj.leetcode.com/problems/single-number/">problem&lt;/a> is the very basic one. So I just paste my code here. If you are confused with the &lt;code>xor&lt;/code> operatorï¼Œ you might have to review the knowledge of &lt;strong>bit manipulation&lt;/strong> carefully.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># @param A, a list of integer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># @return an integer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">singleNumber&lt;/span>(self, A):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> reduce(&lt;span style="color:#66d9ef">lambda&lt;/span> x, y: x &lt;span style="color:#f92672">^&lt;/span> y, A)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Time complexity: O(n)&lt;/p>
&lt;h2 id="all-once-except-one">All Once Except One &lt;a href="#all-once-except-one" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Given an array of N integers, which are in the scope of [1&amp;hellip;N - 1]. Every element in the array appears once except one. Find that number.&lt;/p>&lt;/blockquote>
&lt;p>This one is simple enough. But it looks a &amp;ldquo;hard&amp;rdquo; problem because we can solve this by using the previously &amp;ldquo;xor&amp;rdquo;.&lt;/p>
&lt;p>It&amp;rsquo;s easy for us to calcuate the summary of the array [1&amp;hellip;N - 1], and easy enough to calculate the summay of the given array as well. And the answer is the diffrence of the two summary.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># @param A, a list of integer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># @return an integer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">singleInteger&lt;/span>(self, A):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> n &lt;span style="color:#f92672">=&lt;/span> len(A)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sum(A) &lt;span style="color:#f92672">-&lt;/span> sum(range(n))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Time complexity: O(n)&lt;/p>
&lt;p>p.s. &lt;code>xor(A) ^ xor(range(n))&lt;/code> is better if we have a large N that might overflow when we add all the elements.&lt;/p>
&lt;blockquote>
&lt;p>Given an array of integers, every element appears once except for one which appears twice. Find that special number.&lt;/p>&lt;/blockquote>
&lt;p>This problem is harder because all numbers in the array is arbitrary. And it seems hard to find any rules and patterns in the array.&lt;/p>
&lt;p>I don&amp;rsquo;t know there is an algorithm which is O(1) space and O(n) time complexity. Tackle it with a hash set may be the best solution, which takes O(n) space and O(n) time complexity.&lt;/p>
&lt;h2 id="all-three-times-except-one">All three times except one &lt;a href="#all-three-times-except-one" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Given an array of integers, every element appears three times except for one. Find that single one.&lt;/p>&lt;/blockquote>
&lt;p>To slove &lt;a href="https://oj.leetcode.com/problems/single-number-ii/">this problem&lt;/a>, just using an array of size 32 to keep track on the total count of the ith bit.&lt;/p>
&lt;p>And a tricky solution to reduce the memory usage is use three integers to indicate the remainder of 3 of the total count of the bits.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">singleNumber&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> A[], &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ones &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, twos &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, threes &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> twos &lt;span style="color:#f92672">|=&lt;/span> ones &lt;span style="color:#f92672">&amp;amp;&lt;/span> A[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ones &lt;span style="color:#f92672">^=&lt;/span> A[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> threes &lt;span style="color:#f92672">=&lt;/span> ones &lt;span style="color:#f92672">&amp;amp;&lt;/span> twos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ones &lt;span style="color:#f92672">&amp;amp;=&lt;/span> &lt;span style="color:#f92672">~&lt;/span>threes;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> twos &lt;span style="color:#f92672">&amp;amp;=&lt;/span> &lt;span style="color:#f92672">~&lt;/span>threes;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ones;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="all-twice-except-two">All twice except two &lt;a href="#all-twice-except-two" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Given an array of integers, every element appears twice except for two. Find that two numbers.&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>xor(array) = 0 ^ a ^ b
&lt;/code>&lt;/pre>&lt;p>&lt;a href="http://www.v2ex.com/t/94742">This problem&lt;/a> is an update of &amp;ldquo;All twice except one&amp;rdquo;. It&amp;rsquo;s easy to prove that if there is an &amp;ldquo;1&amp;rdquo; in the bits of xor(array), it indicates that a and b are diffrent on that bit. We can separate the whole array by that bit, and then we can get two arrays which each contains a single &amp;ldquo;single number&amp;rdquo;.&lt;/p>
&lt;h3 id="once-twice-three-times-a-lady">Once, twice, three times a lady &lt;a href="#once-twice-three-times-a-lady" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Given an array of integers, some of the numbers appear once, and some appear twice, and the others appear three times. Please find the number which appear three times.&lt;/p>&lt;/blockquote>
&lt;p>Of course, hash map is a panacea, with O(n) space and O(n) time.&lt;/p>
&lt;p>And there is another way to solve &lt;a href="http://www.ituring.com.cn/article/56179">this problem&lt;/a> with O(1) space and O(n) time. But it has its limitation &amp;ndash; integer overflow. If the max number of this array is too large, it can&amp;rsquo;t be done.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> random &lt;span style="color:#f92672">import&lt;/span> randint
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> collections &lt;span style="color:#f92672">import&lt;/span> Counter
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>N &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ns &lt;span style="color:#f92672">=&lt;/span> [randint(&lt;span style="color:#ae81ff">0&lt;/span>, N &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(N)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>counter &lt;span style="color:#f92672">=&lt;/span> Counter(ns)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(len(ns)):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> ns[i] &lt;span style="color:#f92672">%&lt;/span> N
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ns[num] &lt;span style="color:#f92672">+=&lt;/span> N
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>d &lt;span style="color:#f92672">=&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(len(ns)):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt &lt;span style="color:#f92672">=&lt;/span> ns[i] &lt;span style="color:#f92672">/&lt;/span> N
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> cnt:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> d[i] &lt;span style="color:#f92672">=&lt;/span> cnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print d &lt;span style="color:#f92672">==&lt;/span> dict(counter)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Considering the number &lt;code>ns[i]&lt;/code> with the index &lt;code>i&lt;/code> and with the value &lt;code>val&lt;/code>. We make &lt;code>ns[i] = count(i) * MAX + val&lt;/code>. By that, we can get the count of number &lt;code>i&lt;/code> by &lt;code>ns[i] / MAX&lt;/code>, and get the value of &lt;code>ns[i]&lt;/code> by &lt;code>ns[i] % MAX&lt;/code>.&lt;/p>
&lt;p>And it&amp;rsquo;s the same to find the &amp;ldquo;missing number of an array of [1 &amp;hellip; n]`` or something like that.&lt;/p>
&lt;h2 id="summarize">Summarize &lt;a href="#summarize" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="hash-map-is-panacea">Hash Map is PANACEA &lt;a href="#hash-map-is-panacea" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Almost every problem on the array which want you to detect a single / two / or more &amp;ldquo;special&amp;rdquo; number can be tackled by the Hash Map. Easy and fast.&lt;/p>
&lt;p>But for almost every problem, a hash map may no the very &lt;strong>BEST&lt;/strong> solution.&lt;/p>
&lt;h3 id="bit-map-takes-less-memory">Bit Map takes less memory &lt;a href="#bit-map-takes-less-memory" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>An update for the hash map is the bit map. It takes less memory, but can storage less infomation, 0 or 1. Further, you can treat several bits as one to put more information in it.&lt;/p>
&lt;p>By its very nature, bit map is the same with hash map.&lt;/p>
&lt;h3 id="more-powerful-tool-bloomfilter">More powerful tool: Bloomfilter &lt;a href="#more-powerful-tool-bloomfilter" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Bloomfilter is a powerful algorithm / data structure which is used to slove the &amp;ldquo;in / not in&amp;rdquo; problem, and takes less memory than hash map, and can do better than bit map if the data is sparse and random.&lt;/p>
&lt;p>But it can&amp;rsquo;t keep way the &lt;strong>randomizing error&lt;/strong> called &lt;strong>false positive&lt;/strong>, and if you can put up with that error and want to reduce your memory usage, try that.&lt;/p>
&lt;p>I didn&amp;rsquo;t mention this in my passage, but you can find some information on this &lt;a href="http://en.wikipedia.org/wiki/Bloom_filter">wikipedia page&lt;/a>. It&amp;rsquo;s easy.&lt;/p>
&lt;h3 id="xor-and-bits-manipulation">xor and bits manipulation &lt;a href="#xor-and-bits-manipulation" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>xor is a good way to solve the &amp;ldquo;only one appear once&amp;rdquo; problem. And xor manipulate will never cause overflow which will ruin your whole program.&lt;/p>
&lt;h3 id="just-calculate-the-sum-of-the-array">just calculate the sum of the array &lt;a href="#just-calculate-the-sum-of-the-array" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Somethimes we just forget the simplest way to deal with a &amp;ldquo;hard problem&amp;rdquo;.&lt;/p>
&lt;p>For example, once I was asked &amp;ldquo;give you three integers (a, b, c), and calculate how many (x, y, z) is possible to make ax + by + cz == R&amp;rdquo;.&lt;/p>
&lt;p>I&amp;rsquo;m glad because it is so much like a &amp;ldquo;3-Sum&amp;rdquo; problem, and I solve it fast. But the interver told me it&amp;rsquo;s not the best solution. (You know how to deal with 3-sum, right?)&lt;/p>
&lt;p>I thought for a while, and give up at last. And the interver told me that the solution is to enumerate (x, y) and get z by this formula.&lt;/p>
&lt;pre tabindex="0">&lt;code>z = (R - ax - by) / c
p.s. must be exact division
&lt;/code>&lt;/pre>&lt;p>It&amp;rsquo;s a better and much easier solution, right? It was a shame for me not came up with that idea.&lt;/p>
&lt;p>So, don&amp;rsquo;t forget the simple way, it may be the very best solution.&lt;/p>
&lt;h3 id="attach-some-information-to-some-numbers">attach some information to some numbers &lt;a href="#attach-some-information-to-some-numbers" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>It useful if the length of the array (L) and the max value of the array (M). If M * L &amp;lt;= MAX_INT, you can storge the counter of number i in the array[i] by &lt;code>array[i] = array[i] + counter * M&lt;/code>.&lt;/p>
&lt;p>It&amp;rsquo;s a useful way to implement a counter in the array. And it will be a big plus for you in the interview.&lt;/p></description></item><item><title>ç®€æ˜Pythoné­”æ³• - 2</title><link>https://wizmann.top/posts/python-magic-2/</link><pubDate>Sun, 27 Jul 2014 14:23:10 +0000</pubDate><guid>https://wizmann.top/posts/python-magic-2/</guid><description>&lt;h2 id="å†è¯´æè¿°ç¬¦---descriptor">å†è¯´æè¿°ç¬¦ - Descriptor &lt;a href="#%e5%86%8d%e8%af%b4%e6%8f%8f%e8%bf%b0%e7%ac%a6---descriptor" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æœ€ç®€å•çš„æè¿°ç¬¦">æœ€ç®€å•çš„æè¿°ç¬¦ &lt;a href="#%e6%9c%80%e7%ae%80%e5%8d%95%e7%9a%84%e6%8f%8f%e8%bf%b0%e7%ac%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¦†å†™ç±»çš„&lt;code>__get__&lt;/code>å’Œ&lt;code>__setter__&lt;/code>å‡½æ•°å°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„æè¿°ç¬¦ã€‚å¯¹æŸä¸ªç±»å‹å®ä¾‹çš„è¯»å†™è¿›è¡Œé¢å¤–çš„æ§åˆ¶ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; import datetime
&amp;gt;&amp;gt;&amp;gt; class CurrentDate(object):
... def __get__(self, instance, owner):
... return datetime.date.today()
... def __set__(self, instance, value):
... raise NotImplementedError(&amp;#34;Can&amp;#39;t change the current date.&amp;#34;)
...
&amp;gt;&amp;gt;&amp;gt; class Example(object):
... date = CurrentDate()
...
&amp;gt;&amp;gt;&amp;gt; e = Example()
&amp;gt;&amp;gt;&amp;gt; e.date
datetime.date(2008, 11, 24)
&amp;gt;&amp;gt;&amp;gt; e.date = datetime.date.today()
Traceback (most recent call last):
...
NotImplementedError: Can&amp;#39;t change the current date.
&lt;/code>&lt;/pre>&lt;h3 id="ç±»å±æ€§æè¿°ç¬¦">ç±»å±æ€§æè¿°ç¬¦ &lt;a href="#%e7%b1%bb%e5%b1%9e%e6%80%a7%e6%8f%8f%e8%bf%b0%e7%ac%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyClass&lt;/span> (object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> __var &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_set_var&lt;/span> (self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> type (self)&lt;span style="color:#f92672">.&lt;/span>__var &lt;span style="color:#f92672">=&lt;/span> value
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_get_var&lt;/span> (self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>__var
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> var &lt;span style="color:#f92672">=&lt;/span> property (_get_var, _set_var)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a &lt;span style="color:#f92672">=&lt;/span> MyClass ()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>b &lt;span style="color:#f92672">=&lt;/span> MyClass ()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a&lt;span style="color:#f92672">.&lt;/span>var &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;foo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print b&lt;span style="color:#f92672">.&lt;/span>var
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼ŒåŒ…è£…ä¸€ä¸ªç±»å±æ€§æè¿°ç¬¦ã€‚å¯¹ç±»å±æ€§è¿›è¡Œæ“ä½œã€‚&lt;/p>
&lt;h3 id="å¯¹èµ„æºè¿›è¡Œå°è£…">å¯¹èµ„æºè¿›è¡Œå°è£… &lt;a href="#%e5%af%b9%e8%b5%84%e6%ba%90%e8%bf%9b%e8%a1%8c%e5%b0%81%e8%a3%85" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨Djangoä¸­ï¼Œå¯ä»¥ä½¿ç”¨pickleåœ¨æ•°æ®åº“ä¸­å­˜å‚¨ä¸€äº›åºåˆ—åŒ–ä¿¡æ¯ï¼Œå¦‚åˆ—è¡¨ã€å­—å…¸ç­‰ï¼ˆè¿™äº›å­—æ®µéƒ½ä¸æ˜¯åŸå­çš„ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç»§æ‰¿&lt;code>models.TextField&lt;/code>æ¥å®ç°æˆ‘ä»¬çš„&lt;code>PickleField&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">PickleField&lt;/span>(models&lt;span style="color:#f92672">.&lt;/span>TextField):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pickle&lt;/span>(self, obj):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> pickle&lt;span style="color:#f92672">.&lt;/span>dumps(obj)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">unpickle&lt;/span>(self, data):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> pickle&lt;span style="color:#f92672">.&lt;/span>loads(str(data))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_attname&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">%s&lt;/span>&lt;span style="color:#e6db74">_pickled&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_db_prep_lookup&lt;/span>(self, lookup_type, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ç¦æ­¢ä½¿ç”¨pickledå­—æ®µè¿›è¡ŒæŸ¥è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">raise&lt;/span> &lt;span style="color:#a6e22e">ValueError&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Con&amp;#39;t make comparisons against pickled data.&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šå®ç°çš„æ˜¯æœ€ç®€å•çš„PickleFieldï¼Œç”¨æˆ·åœ¨ä½¿ç”¨è¿™ä¸ªç±»å‹çš„å­—æ®µæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å¯¹æ•°æ®è¿›è¡Œpickle/unpickleã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨propertyï¼Œå®ç°ä¸€ä¸ªPickleDescriptoræè¿°ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">PickleDescriptor&lt;/span>(property):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self, field):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>field &lt;span style="color:#f92672">=&lt;/span> field
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __get__(self, instance, owner):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> instance &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>name &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> instance&lt;span style="color:#f92672">.&lt;/span>__dict__:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># The object hasn&amp;#39;t been created yet, so unpickle the data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> raw_data &lt;span style="color:#f92672">=&lt;/span> getattr(instance, self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>attname)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> instance&lt;span style="color:#f92672">.&lt;/span>__dict__[self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>name] &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>unpickle(raw_data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> instance&lt;span style="color:#f92672">.&lt;/span>__dict__[self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>name]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>â€‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __set__(self, instance, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> instance&lt;span style="color:#f92672">.&lt;/span>__dict__[self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>name] &lt;span style="color:#f92672">=&lt;/span> value
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setattr(instance, self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>attname, self&lt;span style="color:#f92672">.&lt;/span>field&lt;span style="color:#f92672">.&lt;/span>pickle(value))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæè¿°ç¬¦çš„ä½œç”¨æ˜¯å°è£…PickleFieldçš„get/setæ“ä½œã€‚å¯¹äºgetï¼Œå½“å­—æ®µæœªè¢«ååºåˆ—åŒ–æ—¶ï¼Œè°ƒç”¨unpickledï¼Œå…¶å®ƒæ—¶å€™ç›´æ¥è¯»å–å­—æ®µã€‚å¯¹äºsetï¼Œåˆ™æ˜¯åŒæ—¶æ›´æ–°å­—æ®µä»¥åŠpickledå­—æ®µã€‚å®ç°äº†ä¸€ä¸ªç±»ä¼¼cacheçš„æœºåˆ¶ã€‚&lt;/p>
&lt;p>æœ€åï¼Œæˆ‘ä»¬å†ä¸º&lt;code>PickleField&lt;/code>åŠ ä¸Šä¸€ä¸ª&lt;code>contribute_to_class&lt;/code>å›è°ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">contribute_to_class&lt;/span>(self, cls, name):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> super(PickleField, self)&lt;span style="color:#f92672">.&lt;/span>contribute_to_class(cls, name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> setattr(cls, name, PickleDescriptor(self))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“è¿™ä¸ªå­—æ®µè¢«åŠ å…¥æ•°æ®æ¨¡å‹çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŠŠå¯¹å­—æ®µçš„å­—ä¹‰æ›¿æ¢ä¸ºè¯¥æè¿°ç¬¦ã€‚ï¼ˆå¤ªæ¼‚äº®ï¼ï¼‰&lt;/p>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨åšæ¯•è®¾çš„æ—¶å€™ï¼Œæå‰è¯»äº†_Pro Django_ä¸€ä¹¦ï¼ŒçœŸå¿ƒè®©æˆ‘å°‘èµ°äº†ä¸å°‘å¼¯è·¯ã€‚åœ¨å¯¼å¸ˆæœ€åä¸€å¤©æ”¹éœ€æ±‚çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä»å®¹ä¸è¿«çš„è§æ‹›æ‹†æ‹›ã€‚è¿™çœŸçš„å¾—æ„Ÿè°¢Pythonè¶…å¼ºçš„å¼¹æ€§ï¼Œä»¥åŠDjangoå®Œç¾çš„è®¾è®¡å“²å­¦ã€‚&lt;/p>
&lt;p>_Pro Django_çš„éƒ¨åˆ†åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†ï¼Œæ­¤ä¹¦åé¢çš„ç« èŠ‚å¤§éƒ½æ˜¯Djangoç›¸å…³çš„ï¼Œå¯¹äºPythonçš„è®²è§£è¢«æ·¡åŒ–äº†ã€‚&lt;/p>
&lt;p>æœ¬ç³»åˆ—åé¢çš„æ–‡ç« è¿˜æ˜¯ä¼šä»å£°æ˜å¼ç¼–ç¨‹ä»¥åŠç±»DSLç¼–ç¨‹çš„è§’åº¦å‡ºå‘ï¼Œå¯¹äºPythonçš„é­”æ³•è¿›è¡Œå­¦ä¹ ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ &lt;a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://book.douban.com/subject/3086812/">Pro Django&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ç®€æ˜Pythoné­”æ³• - 1</title><link>https://wizmann.top/posts/python-magic-1/</link><pubDate>Sat, 26 Jul 2014 22:23:34 +0000</pubDate><guid>https://wizmann.top/posts/python-magic-1/</guid><description>&lt;h2 id="pythonä¸­ç±»çš„å®ç°">Pythonä¸­ç±»çš„å®ç° &lt;a href="#python%e4%b8%ad%e7%b1%bb%e7%9a%84%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨Pythonçš„Webæ¡†æ¶Djangoä¸­ï¼ŒPythonç±»çš„æ„é€ ç‰¹æ€§å®ç°äº†å®ƒå¤§éƒ¨åˆ†çš„æ ¸å¿ƒåŠŸèƒ½ã€‚&lt;/p>
&lt;p>å½“Pythonè§£é‡Šå™¨é‡åˆ°ç±»å£°æ˜æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„namespace ï¼Œå¹¶æ‰§è¡Œå…¶å†…çš„æ‰€æœ‰ä»£ç ï¼Œå¹¶å°†å˜é‡æ³¨å†Œåˆ°è¿™ä¸ªnamespaceä¸­ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; class Foo(object):
... print &amp;#39;Loading...&amp;#39;
... spam = &amp;#39;eggs&amp;#39;
... print &amp;#39;Done!&amp;#39;
...
Loading...
Done!
&amp;gt;&amp;gt;&amp;gt; f = Foo()
&amp;gt;&amp;gt;&amp;gt; f.spam
&amp;#39;eggs&amp;#39;
&lt;/code>&lt;/pre>&lt;h3 id="åŠ¨æ€çš„å®ç°ä¸€ä¸ªç±»">åŠ¨æ€çš„å®ç°ä¸€ä¸ªç±» &lt;a href="#%e5%8a%a8%e6%80%81%e7%9a%84%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%b1%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä½¿ç”¨typeæ–¹æ³•å¯ä»¥åŠ¨æ€çš„ä»£ç ä¸­å®ç°ä¸€ä¸ªç±»ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°â€œç±»åâ€ã€â€œåŸºç±»â€ã€â€œå±æ€§â€ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; Bar = type(&amp;#39;Bar&amp;#39;, (object,), {&amp;#39;spam&amp;#39;: &amp;#39;eggs&amp;#39;})
&amp;gt;&amp;gt;&amp;gt; Bar.spam
&amp;#39;eggs&amp;#39;
&lt;/code>&lt;/pre>&lt;h3 id="è¶…ç±»æ”¹å˜ä¸€åˆ‡">è¶…ç±»æ”¹å˜ä¸€åˆ‡ &lt;a href="#%e8%b6%85%e7%b1%bb%e6%94%b9%e5%8f%98%e4%b8%80%e5%88%87" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>â€œmetaprogrammingâ€æ˜¯æŒ‡ä¸€ç§åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºæˆ–æ”¹å˜ä»£ç çš„ç¼–ç¨‹æ‰‹æ®µã€‚&lt;code>type&lt;/code>æ˜¯ä¸€ä¸ªmetaclassï¼Œä¸€ä¸ªåˆ›å»ºå…¶å®ƒç±»çš„metaclassã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ›¿æ¢æ‰åŸç”Ÿçš„&lt;code>type&lt;/code>ï¼Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„ç‰ˆæœ¬ï¼Œä»è€Œæ§åˆ¶åˆ›å»ºç±»çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; class MetaClass(type):
... def __init__(cls, name, bases, attrs):
... print(&amp;#39;Defining %s&amp;#39; % cls)
... print(&amp;#39;Name: %s&amp;#39; % name)
... print(&amp;#39;Bases: %s&amp;#39; % (bases,))
... print(&amp;#39;Attributes:&amp;#39;)
... for (name, value) in attrs.items():
... print(&amp;#39; %s: %r&amp;#39; % (name, value))
...
&amp;gt;&amp;gt;&amp;gt; class RealClass(object, metaclass=MetaClass):
... spam = &amp;#39;eggs&amp;#39;
...
Defining &amp;lt;class &amp;#39;__main__.RealClass&amp;#39;&amp;gt;
Name: RealClass
Bases: (&amp;lt;class &amp;#39;object&amp;#39;&amp;gt;,)
Attributes:
spam: &amp;#39;eggs&amp;#39;
__module__: &amp;#39;__main__&amp;#39;
__qualname__: &amp;#39;RealClass&amp;#39;
&amp;gt;&amp;gt;&amp;gt; RealClass
&amp;lt;class &amp;#39;__main__.RealClass&amp;#39;&amp;gt;
&lt;/code>&lt;/pre>&lt;p>æ¯å½“ä¸€ä¸ªæ–°çš„ç±»è¢«åˆ›å»ºæ—¶ï¼Œéƒ½ä¼šè§¦å‘metaclassçš„è¡Œä¸ºã€‚&lt;/p>
&lt;h3 id="åŸºç±»ä¸è¶…ç±»">åŸºç±»ä¸è¶…ç±» &lt;a href="#%e5%9f%ba%e7%b1%bb%e4%b8%8e%e8%b6%85%e7%b1%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åŸºç±»ä¸è¶…ç±»ä¸€èµ·ä½¿ç”¨å¯ä»¥å®ç°ç±»æ–¹æ³•çš„å¤ç”¨ï¼Œä»¥åŠå¯¹äºç±»åˆ›å»ºçš„è·Ÿè¸ªã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon"> &amp;gt;&amp;gt;&amp;gt; class SubClass(RealClass): # Notice there&amp;#39;s no metaclass here.
... pass
...
Defining &amp;lt;class &amp;#39;__main__.SubClass&amp;#39;&amp;gt;
Name: SubClass
Bases: (&amp;lt;class &amp;#39;__main__.RealClass&amp;#39;&amp;gt;,)
Attributes:
__module__: &amp;#39;__main__&amp;#39;
&lt;/code>&lt;/pre>&lt;p>åœ¨è¿™é‡Œï¼Œè¶…ç±»å¯¹äº&lt;code>SubClass&lt;/code>æ˜¯å®Œå…¨é€æ˜çš„ï¼Œ&lt;code>SubClass&lt;/code>åªéœ€è¦å®Œæˆè‡ªå·±çš„å·¥ä½œï¼ŒPythonä¼šåœ¨åå°æ–™ç†å¥½ä¸€åˆ‡ã€‚&lt;/p>
&lt;h3 id="å£°æ˜å¼è¯­æ³•">å£°æ˜å¼è¯­æ³• &lt;a href="#%e5%a3%b0%e6%98%8e%e5%bc%8f%e8%af%ad%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>This syntax (Declarative Syntax) is designed to make minimize &amp;ldquo;boilerplate&amp;rdquo; repetitive syntax and provide elegant, readable code.&lt;/p>&lt;/blockquote>
&lt;p>å£°æ˜å¼è¯­æ³•æ˜¯ä¸€ç§æŠŠæ•°æ®å’Œé€»è¾‘åˆ†ç¦»çš„ç¼–ç¨‹æ–¹å¼ï¼Œé¢å¯¹ç»å¸¸å˜åŠ¨çš„ä½†æ˜¯è§„å¾‹æ˜æ˜¾çš„éœ€æ±‚ï¼Œå£°æ˜å¼ç¼–ç¨‹å¯ä»¥è§£æ•‘ä½ äºæ°´ç«ä¹‹ä¸­ã€‚:-P&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Contact&lt;/span>(models&lt;span style="color:#f92672">.&lt;/span>Model):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> Contact information provided when sending messages to the owner of the site.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name &lt;span style="color:#f92672">=&lt;/span> models&lt;span style="color:#f92672">.&lt;/span>CharField(max_length&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">255&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> email &lt;span style="color:#f92672">=&lt;/span> models&lt;span style="color:#f92672">.&lt;/span>EmailField()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢æ˜¯Djangoçš„æ¨¡å‹å£°æ˜è¯­æ³•ï¼Œç®€æ´ã€æ˜äº†ã€å¤§æ°”ï¼&lt;/p>
&lt;h2 id="è®©æˆ‘ä»¬ä¸€èµ·åšé¸­">è®©æˆ‘ä»¬ä¸€èµ·åšé¸­ &lt;a href="#%e8%ae%a9%e6%88%91%e4%bb%ac%e4%b8%80%e8%b5%b7%e5%81%9a%e9%b8%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Shakespeare: &amp;ldquo;If it walks like a duck and talks like a duck, it&amp;rsquo;s a Duck.&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;h3 id="callables">Callables &lt;a href="#callables" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="__call__">__call__ &lt;a href="#__call__" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; class Multiplier(object):
... def __init__(self, factor):
... self.factor = factor
... def __call__(self, value):
... return value * self.factor
...
&amp;gt;&amp;gt;&amp;gt; times2 = Multiplier(2)
&amp;gt;&amp;gt;&amp;gt; times2(5)
10
&amp;gt;&amp;gt;&amp;gt; times2(10)
20
&amp;gt;&amp;gt;&amp;gt; times3 = Multiplier(3)
&amp;gt;&amp;gt;&amp;gt; times3(10)
30
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨callableå‡½æ•°æ¥æ„é€ â€æœ‰çŠ¶æ€çš„å‡½æ•°â€œï¼Œä»¥åŠå…¶å®ƒå¯ä»¥æƒ³çš„åˆ°çš„ä¸€äº›é»‘é­”æ³•ã€‚&lt;/p>
&lt;h3 id="dictionaries">Dictionaries &lt;a href="#dictionaries" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä½¿ç”¨&lt;code>__contains&lt;/code>ã€&lt;code>__getitem__&lt;/code>å’Œ&lt;code>__setitem__&lt;/code>å†…å»ºå‡½æ•°ï¼Œå¯ä»¥è®©ä¸€ä¸ªç±»å®ä¾‹æ¨¡æ‹Ÿå­—å…¸çš„è¡Œä¸ºã€‚&lt;/p>
&lt;h3 id="file">File &lt;a href="#file" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å®ç°&lt;code>read&lt;/code>ã€&lt;code>write&lt;/code>å’Œ&lt;code>close&lt;/code>ï¼Œä½ ä»¬å°±å¯ä»¥æŠŠæˆ‘å½“æ–‡ä»¶æ¥ç”¨å•¦ã€‚&lt;/p>
&lt;h3 id="iterable">Iterable &lt;a href="#iterable" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; class Fibonacci(object):
... def __init__(self, count):
... self.count = count
... def __iter__(self):
... a, b = 0, 1
... for x in range(self.count):
... if x &amp;lt; 2:
... yield x
... else:
... c = a + b
... yield c
... a, b = b, c
...
&amp;gt;&amp;gt;&amp;gt; for x in Fibonacci(5):
... print(x)
...
0
1
1
2
3
&lt;/code>&lt;/pre>&lt;h2 id="åå‡½æ•°">åå‡½æ•° &lt;a href="#%e5%81%8f%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åå‡½æ•°å’Œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„â€æŸ¯é‡ŒåŒ–â€œä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡å¡«å……å‡½æ•°ä¸­çš„ä¸€éƒ¨åˆ†å‚æ•°ï¼Œä»è€Œå®ç°ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; import functools
&amp;gt;&amp;gt;&amp;gt; def add(a, b):
... return a + b
...
&amp;gt;&amp;gt;&amp;gt; add(4, 2)
6
&amp;gt;&amp;gt;&amp;gt; plus3 = functools.partial(add, 3)
&amp;gt;&amp;gt;&amp;gt; plus5 = functools.partial(add, 5)
&amp;gt;&amp;gt;&amp;gt; plus3(4)
7
&amp;gt;&amp;gt;&amp;gt; plus3(7)
10
&amp;gt;&amp;gt;&amp;gt; plus5(10)
15
&lt;/code>&lt;/pre>&lt;h2 id="æè¿°ç¬¦">æè¿°ç¬¦ &lt;a href="#%e6%8f%8f%e8%bf%b0%e7%ac%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æè¿°ç¬¦ç”¨æ¥å­˜å–ç±»å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æä¾›å¦‚ä¸‹çš„ä¾¿åˆ©ï¼š&lt;/p>
&lt;ul>
&lt;li>ä»å¤æ‚çš„å¯¹è±¡ä¸­å–å‡ºæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–æ˜¯é…ç½®æ–‡ä»¶&lt;/li>
&lt;li>æŠŠä¸€ä¸ªç®€å•çš„å€¼ä¼ å…¥ä¸€ä¸ªå¤æ‚å¯¹è±¡ä¸­&lt;/li>
&lt;li>å¯¹å­˜å–çš„å€¼è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ&lt;/li>
&lt;li>æŠŠå€¼è½¬åŒ–ä¸ºæ˜“äºå†™å…¥æ•°æ®åº“ä¸­çš„ç±»å‹&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code class="language-pycon" data-lang="pycon">&amp;gt;&amp;gt;&amp;gt; import datetime
&amp;gt;&amp;gt;&amp;gt; class CurrentDate(object):
... def __get__(self, instance, owner):
... return datetime.date.today()
... def __set__(self, instance, value):
... raise NotImplementedError(&amp;#34;Can&amp;#39;t change the current date.&amp;#34;)
...
&amp;gt;&amp;gt;&amp;gt; class Example(object):
... date = CurrentDate()
...
&amp;gt;&amp;gt;&amp;gt; e = Example()
&amp;gt;&amp;gt;&amp;gt; e.date
datetime.date(2008, 11, 24)
&amp;gt;&amp;gt;&amp;gt; e.date = datetime.date.today()
Traceback (most recent call last):
...
NotImplementedError: Can&amp;#39;t change the current date.
&lt;/code>&lt;/pre>&lt;h3 id="å®ç°">å®ç° &lt;a href="#%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¦†å†™ç±»çš„&lt;code>__get__&lt;/code>å’Œ&lt;code>__set__&lt;/code>å‡½æ•°å°±å¯ä»¥å®ç°ç±»çš„æè¿°ç¬¦ã€‚&lt;/p>
&lt;h2 id="å®è·µä¸€ä¸ªç®€å•çš„unittestæ¡†æ¶">å®è·µï¼šä¸€ä¸ªç®€å•çš„UnitTestæ¡†æ¶ &lt;a href="#%e5%ae%9e%e8%b7%b5%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84unittest%e6%a1%86%e6%9e%b6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="è®¾è®¡æ€è·¯">è®¾è®¡æ€è·¯ &lt;a href="#%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¯¹äºæ¯ä¸€ä¸ªCaseï¼Œåªéœ€è¦å£°æ˜ä¸€ä¸ªç±»ã€‚åœ¨ç±»ä¸­å£°æ˜è¦æµ‹è¯•çš„å‡½æ•°ä»¥åŠæµ‹è¯•çš„Inputå’Œé¢„æœŸOutputã€‚ä¹‹åæ¡†æ¶å¯ä»¥è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶è¾“å‡ºç»“æœã€‚&lt;/p>
&lt;h3 id="æ¥å£è®¾è®¡">æ¥å£è®¾è®¡ &lt;a href="#%e6%8e%a5%e5%8f%a3%e8%ae%be%e8%ae%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> PyUnitTest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> PyUnitTest &lt;span style="color:#f92672">import&lt;/span> BaseCase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">func1&lt;/span>(a, b):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">+&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">func2&lt;/span>(a, b):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">*&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestFunc1&lt;/span>(BaseCase):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FUNC &lt;span style="color:#f92672">=&lt;/span> func1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> INPUT &lt;span style="color:#f92672">=&lt;/span> [{&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">4&lt;/span>}]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OUTPUT &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestFunc2&lt;/span>(BaseCase):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FUNC &lt;span style="color:#f92672">=&lt;/span> func2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> INPUT &lt;span style="color:#f92672">=&lt;/span> [{&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;b&amp;#39;&lt;/span>: &lt;span style="color:#ae81ff">4&lt;/span>}]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OUTPUT &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">12&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;__main__&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> PyUnitTest&lt;span style="color:#f92672">.&lt;/span>run_all_test()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨Caseä¸­ï¼Œä½¿ç”¨&lt;code>FUNC&lt;/code>æ ‡æ˜å‡½æ•°ï¼Œä½¿ç”¨&lt;code>INPUT&lt;/code>å’Œ&lt;code>OUTPUT&lt;/code>æ ‡æ˜é¢„æœŸè¾“å…¥è¾“å‡ºã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>PyUnitTest.run_all_test()&lt;/code>è‡ªåŠ¨è¿è¡Œæ‰€æœ‰ç”¨ä¾‹ã€‚&lt;/p>
&lt;h3 id="casecontainer">CaseContainer &lt;a href="#casecontainer" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>Case&lt;/code>ç±»è·å¾—&lt;code>Case&lt;/code>åï¼Œå¾…æµ‹è¯•å‡½æ•°åï¼Œè¾“å…¥å’Œè¾“å‡ºæ•°æ®ã€‚&lt;/p>
&lt;p>å¹¶ä¸”å®ç°&lt;code>run()&lt;/code>æ–¹æ³•ï¼Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>assert&lt;/code>æ–¹æ³•ä¿è¯ç”¨ä¾‹çš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Case&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self, name, attrs):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>name &lt;span style="color:#f92672">=&lt;/span> name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>in_data &lt;span style="color:#f92672">=&lt;/span> attrs&lt;span style="color:#f92672">.&lt;/span>get(&lt;span style="color:#e6db74">&amp;#39;INPUT&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">None&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>out_data &lt;span style="color:#f92672">=&lt;/span> attrs&lt;span style="color:#f92672">.&lt;/span>get(&lt;span style="color:#e6db74">&amp;#39;OUTPUT&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">None&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>func &lt;span style="color:#f92672">=&lt;/span> attrs&lt;span style="color:#f92672">.&lt;/span>get(&lt;span style="color:#e6db74">&amp;#39;FUNC&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">None&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">assert&lt;/span>(self&lt;span style="color:#f92672">.&lt;/span>in_data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">assert&lt;/span>(self&lt;span style="color:#f92672">.&lt;/span>out_data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">assert&lt;/span>(self&lt;span style="color:#f92672">.&lt;/span>func)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">assert&lt;/span>(len(self&lt;span style="color:#f92672">.&lt;/span>in_data) &lt;span style="color:#f92672">==&lt;/span> len(self&lt;span style="color:#f92672">.&lt;/span>out_data))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">run&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;running case: &lt;/span>&lt;span style="color:#e6db74">%s&lt;/span>&lt;span style="color:#e6db74"> ...&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data_pair &lt;span style="color:#f92672">=&lt;/span> zip(self&lt;span style="color:#f92672">.&lt;/span>in_data, self&lt;span style="color:#f92672">.&lt;/span>out_data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> data_in, data_out &lt;span style="color:#f92672">in&lt;/span> data_pair:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>func(&lt;span style="color:#f92672">**&lt;/span>data_in)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> data_out &lt;span style="color:#f92672">==&lt;/span> res:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ok &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;[PASS &lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">]...&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> cnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;[FAILED &lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">]...&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> cnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;INPUT:&amp;#39;&lt;/span>, repr(data_in)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;OUTPUT:&amp;#39;&lt;/span>, repr(res)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;EXPECT:&amp;#39;&lt;/span>, repr(data_out)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;finish case: &lt;/span>&lt;span style="color:#e6db74">%s&lt;/span>&lt;span style="color:#e6db74"> (&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74"> / &lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">) ...&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> (self&lt;span style="color:#f92672">.&lt;/span>name, ok, cnt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;-&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>CaseContainerç±»å®ç°äº†Caseçš„æ”¶é›†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">CaseContainer&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cases &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@classmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">append&lt;/span>(self, &lt;span style="color:#66d9ef">case&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>cases&lt;span style="color:#f92672">.&lt;/span>append(&lt;span style="color:#66d9ef">case&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¶…ç±»ä¸åŸºç±»">è¶…ç±»ä¸åŸºç±» &lt;a href="#%e8%b6%85%e7%b1%bb%e4%b8%8e%e5%9f%ba%e7%b1%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> CaseContainer &lt;span style="color:#f92672">import&lt;/span> Case, CaseContainer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MetaCase&lt;/span>(type):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(cls, name, bases, attrs):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> name &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;BaseCase&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">=&lt;/span> Case(name, attrs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CaseContainer&lt;span style="color:#f92672">.&lt;/span>append(&lt;span style="color:#66d9ef">case&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">BaseCase&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> __metaclass__ &lt;span style="color:#f92672">=&lt;/span> MetaCase
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">run_all_test&lt;/span>():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">in&lt;/span> CaseContainer&lt;span style="color:#f92672">.&lt;/span>cases:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>&lt;span style="color:#f92672">.&lt;/span>run()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¶…ç±»ä¸­ï¼Œå£°æ˜Caseçš„æ”¶é›†é€»è¾‘ã€‚è€ŒåŸºç±»ä¸­çš„&lt;code>__metaclass__&lt;/code>ä½¿æ‰€æœ‰Caseå­ç±»çš„è¶…ç±»çš†ä¸º&lt;code>MetaCase&lt;/code>ã€‚&lt;/p>
&lt;p>æœ€åçš„&lt;code>run_all_test&lt;/code>å¯ä»¥æ‰¹å¤„ç†æ‰€æœ‰çš„test caseã€‚&lt;/p>
&lt;h3 id="åç»­">åç»­ &lt;a href="#%e5%90%8e%e7%bb%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªå°çš„å•å…ƒæµ‹è¯•æ¡†æ¶å¹¶ä¸å®Œå–„ï¼Œåªæ˜¯å®ç°äº†æœ€åŸºæœ¬çš„æµ‹è¯•åŠŸèƒ½ã€‚å¹¶ä¸”ä¹Ÿæ²¡æœ‰å®Œå…¨åº”ç”¨ä¸Šé¢æ‰€æåˆ°çš„æ‰€æœ‰Pythonçš„é­”æ³•ç‰¹æ€§ã€‚æ‰€ä»¥åç»­å¦‚æœæœ‰æ—¶é—´å’Œç²¾åŠ›ï¼Œåº”è¯¥ç»§ç»­å®Œå–„å§ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ &lt;a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://book.douban.com/subject/24806569/">Pro Django&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Codeforces 447D DZY Loves Modification</title><link>https://wizmann.top/posts/cf-447d/</link><pubDate>Thu, 24 Jul 2014 23:44:44 +0000</pubDate><guid>https://wizmann.top/posts/cf-447d/</guid><description>&lt;h2 id="é¢˜æ„">é¢˜æ„ &lt;a href="#%e9%a2%98%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç»™ä½ ä¸€ä¸ªn * mçš„çŸ©é˜µï¼Œè®©ä½ åšKæ¬¡æ“ä½œï¼Œä½¿å¾—æœ€åå¾—åˆ°çš„å€¼æœ€å¤§ã€‚&lt;/p>
&lt;p>æ“ä½œæœ‰ä¸¤ç§ï¼š&lt;/p>
&lt;p>ä¸€æ˜¯&lt;strong>åœ¨ä»»æ„ä¸€è¡Œä¸Š&lt;/strong>æ“ä½œï¼Œæœ€ç»ˆçš„ç»“æœå€¼åŠ ä¸Šè¿™ä¸€è¡Œæ•°çš„å’Œï¼Œç„¶åè¿™ä¸€è¡Œæ¯ä¸€ä¸ªæ•°éƒ½è¦å‡å»pã€‚&lt;/p>
&lt;p>äºŒæ˜¯&lt;strong>åœ¨ä»»æ„ä¸€åˆ—ä¸Š&lt;/strong>æ“ä½œï¼Œæœ€ç»ˆçš„ç»“æœå€¼åŠ ä¸Šè¿™ä¸€åˆ—æ•°çš„å’Œï¼Œç„¶åè¿™ä¸€åˆ—æ¯ä¸€ä¸ªæ•°éƒ½è¦å‡å»pã€‚&lt;/p>
&lt;p>æ•°æ®èŒƒå›´ï¼š1â€‰â‰¤â€‰n,â€‰mâ€‰â‰¤â€‰10^3; 1â€‰â‰¤â€‰kâ€‰â‰¤â€‰10^6; 1â€‰â‰¤â€‰pâ€‰â‰¤â€‰100&lt;/p>
&lt;h2 id="é€€åŒ–ç‰ˆçš„é¢˜ç›®æ€è·¯">é€€åŒ–ç‰ˆçš„é¢˜ç›®æ€è·¯ &lt;a href="#%e9%80%80%e5%8c%96%e7%89%88%e7%9a%84%e9%a2%98%e7%9b%ae%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¦‚æœæˆ‘ä»¬åªé™å®šä¸€ç§æ“ä½œï¼Œæ­¤é¢˜å°±æ˜¯ç®€å•é¢˜äº†ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå¤§æ ¹å †ï¼Œå †ä¸­ä¿å­˜æ¯ä¸€è¡Œï¼ˆæˆ–åˆ—ï¼‰ä¹‹å’Œã€‚&lt;/p>
&lt;p>æ¯æ¬¡æ“ä½œåªéœ€è¦å–å‡ºæœ€å¤§å€¼ï¼ŒåŠ åˆ°æœ€ç»ˆç»“æœä¸Šã€‚ä¹‹åå°†è¿™ä¸ªå€¼å‡å»å¯¹åº”çš„p * nï¼ˆæˆ–p * mï¼‰ï¼Œå†åŠ å…¥å †ä¸­ã€‚&lt;/p>
&lt;p>ç»è¿‡Kæ¬¡å¾ªç¯ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€åçš„ç­”æ¡ˆäº†ã€‚&lt;/p>
&lt;h2 id="çœŸæ­£çš„é¢˜ç›®æ€è·¯">çœŸæ­£çš„é¢˜ç›®æ€è·¯ &lt;a href="#%e7%9c%9f%e6%ad%a3%e7%9a%84%e9%a2%98%e7%9b%ae%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºè¡Œå’Œåˆ—åŒæ—¶æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¥—ç”¨è¿™ç§æ–¹æ³•ã€‚ä½†æ˜¯è¦è§£å†³å¯¹è¡Œæ“ä½œåï¼Œå¯¹åˆ—ä¸Šæ•°å­—çš„å€¼çš„å½±å“ã€‚&lt;/p>
&lt;p>æ˜“å¾—ï¼Œå¦‚æœè¡Œåˆ—æ··åˆæ“ä½œï¼Œä¸”åªä½¿ç”¨ä¸Šè¿°æ–¹æ³•çš„è¯ã€‚æ¯æ¬¡è¡Œæ“ä½œæ‰€å¾—åˆ°çš„å€¼ï¼Œå®é™…ä¸Šä¸º&lt;code>ç®€å•è¡Œæ“ä½œå¾—åˆ°çš„å€¼ - æ­¤æ¬¡è¡Œæ“ä½œä¹‹å‰çš„æ‰€æœ‰åˆ—æ“ä½œæ¬¡æ•° * p&lt;/code>(ä¸ºä»€ä¹ˆï¼Ÿ)ã€‚å¯¹äºåˆ—æ“ä½œäº¦ç„¶ã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œ&lt;code>&amp;lt;a0, b0&amp;gt;&lt;/code>ä»£è¡¨åºåˆ—çš„ä¸€æ®µæ‰§è¡Œäº†a0ä¸ªè¡Œæ“ä½œå’Œb0ä¸ªåˆ—æ“ä½œã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;a0, b0&amp;gt; | &amp;lt;1, 0&amp;gt; | &amp;lt;0, 1&amp;gt; | &amp;lt;a1, b1&amp;gt;|
|&amp;lt;---A---&amp;gt;|&amp;lt;---B---&amp;gt;|&amp;lt;---C---&amp;gt;|&amp;lt;---D---&amp;gt;|
&lt;/code>&lt;/pre>&lt;p>æ“ä½œè¢«åˆ†ä¸ºäº†å››ä¸ªé˜¶æ®µã€‚&lt;/p>
&lt;p>å¯¹äºBé˜¶æ®µæ¥è¯´ï¼Œå…¶ç»“æœä¸º&lt;code>1æ¬¡ç®€å•è¡Œæ“ä½œçš„å€¼ - b0 * p&lt;/code>(ä¸ºä»€ä¹ˆï¼Ÿ)ï¼Œå¯¹äºCé˜¶æ®µæ¥è¯´ï¼Œå…¶ç»“æœä¸º&lt;code>1æ¬¡ç®€å•åˆ—æ“ä½œçš„å€¼ - (a0 + 1) * p&lt;/code>ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œå¦‚æœå½“æˆ‘ä»¬æŠŠBé˜¶æ®µå’ŒCé˜¶æ®µäº’æ¢çš„è¯ï¼Œ ç»“æœæ˜¯ä¸å˜çš„ã€‚(ä¸ºä»€ä¹ˆï¼Ÿæˆ‘çœŸTMDæ˜¯åä¸‡ä¸ªä¸ºä»€ä¹ˆã€‚ã€‚ã€‚)&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œåœ¨ä»»ä¸€ä¸ªæ“ä½œåºåˆ—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº¤æ¢ä»»æ„ä¸€ä¸ªçš„è¡Œæ“ä½œå’Œåˆ—æ“ä½œï¼Œè€Œæ€»ç»“æœä¸å˜ã€‚&lt;/p>
&lt;p>æœ€ç»ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†æ“ä½œåºåˆ—ç­‰ä»·å˜åŒ–æˆä¸‹é¢çš„åºåˆ—ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;a, 0&amp;gt; | &amp;lt;0, b&amp;gt;
&lt;/code>&lt;/pre>&lt;p>æ­¤æ—¶ï¼Œæœ€ç»ˆçš„ç»“æœä¸º&lt;code>aæ¬¡ç®€å•è¡Œæ“ä½œçš„å€¼ + bæ¬¡ç®€å•åˆ—æ“ä½œçš„å€¼ - a * b * p&lt;/code>ã€‚(ä¸ºä»€ä¹ˆï¼Ÿ)&lt;/p>
&lt;p>è€Œaä¸bçš„å€¼å¯ä»¥ç®€å•çš„é€šè¿‡æšä¸¾å¾—åˆ°ã€‚æ€è·¯æœ‰äº†ï¼Œä»£ç å¦‚æœä¸å‡ºå¤§é—®é¢˜ï¼Œè¿™é¢˜å°±å¯ä»¥ACäº†ã€‚&lt;/p>
&lt;h2 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> K &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m, k, p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint sumX[K &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>], sumY[K &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>llint&lt;span style="color:#f92672">&amp;gt;&lt;/span> xs, ys;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">do_calc&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>llint&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> vs, llint sum[], &lt;span style="color:#66d9ef">int&lt;/span> u)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> priority_queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>llint&lt;span style="color:#f92672">&amp;gt;&lt;/span> pq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> i: vs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.push(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sum[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint now &lt;span style="color:#f92672">=&lt;/span> pq.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sum[i] &lt;span style="color:#f92672">=&lt;/span> sum[i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> now;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now &lt;span style="color:#f92672">-=&lt;/span> (llint)p &lt;span style="color:#f92672">*&lt;/span> u;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.push(now);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">calcX&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_calc(xs, sumX, m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">calcY&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_calc(ys, sumY, n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> k &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ys.resize(m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xs.resize(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ys[j] &lt;span style="color:#f92672">+=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xs[i] &lt;span style="color:#f92672">+=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> calcX();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> calcY();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint ans &lt;span style="color:#f92672">=&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>numeric_limits&lt;span style="color:#f92672">&amp;lt;&lt;/span>llint&lt;span style="color:#f92672">&amp;gt;::&lt;/span>min();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint t &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">+=&lt;/span> sumX[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">+=&lt;/span> sumY[k &lt;span style="color:#f92672">-&lt;/span> i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">-=&lt;/span> (llint)i &lt;span style="color:#f92672">*&lt;/span> (k &lt;span style="color:#f92672">-&lt;/span> i) &lt;span style="color:#f92672">*&lt;/span> p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æŸå‚çš„g++ç‰ˆæœ¬æ˜¯3.4.xï¼Œæ²¡æœ‰C++11ï¼Œ&lt;strong>æ ¹æœ¬ç§€ä¸èµ·æ¥å•Š&lt;/strong>ï¼&lt;/p>
&lt;p>è¯´çš„å°±å’Œä½ ä¼šå†™C++11ä¸€æ ·_(:Ğ·ã€âˆ )_&lt;/p></description></item><item><title>CPU cacheå¼•å‘çš„æ€§èƒ½è¡€æ¡ˆ</title><link>https://wizmann.top/posts/cpu-cache-miss/</link><pubDate>Sun, 20 Jul 2014 00:18:00 +0000</pubDate><guid>https://wizmann.top/posts/cpu-cache-miss/</guid><description>&lt;p>åœ¨__&lt;a href="http://evol128.is-programmer.com/posts/35453.html">ä¸ºä»€ä¹ˆè½¬ç½®ä¸€ä¸ª512x512çš„çŸ©é˜µï¼Œä¼šæ¯”513x513çš„çŸ©é˜µæ…¢å¾ˆå¤šï¼Ÿ&lt;/a>__ä¸€æ–‡ä¸­ï¼Œä½œè€…å¼•ç”¨äº†ä¸€ä¸ªçŸ©é˜µè½¬ç½®çš„ä¾‹å­ï¼Œæ¥è®²è§£ç”±äºCPU cacheçš„å¤±æ•ˆè€Œå¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚&lt;/p>
&lt;p>ä¸Šé¢çš„æ–‡ç« å¯¹é—®é¢˜çš„è§£é‡Šä¸è®¨è®ºéƒ½éå¸¸çš„é€å½»ã€‚æˆ‘çš„è¿™ç¯‡æ–‡ç« åªæ˜¯å¯¹ä¸Šé¢æ–‡ç« çš„ä¸€ç¯‡è¯»åæ„Ÿå’Œå®éªŒæŠ¥å‘Šã€‚å°±é…±ã€‚&lt;/p>
&lt;h2 id="cpu-cache-ä¹‹-ç»„ç›¸è”">CPU cache ä¹‹ ç»„ç›¸è” &lt;a href="#cpu-cache-%e4%b9%8b-%e7%bb%84%e7%9b%b8%e8%81%94" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-cpu-cache-2-way-set-assosiate.jpg" alt="ç»„ç›¸è”">&lt;/p>
&lt;p>ç»„ç›¸è”çš„å®ç°å’ŒåŸç†ä¸å¿…å†èµ˜è¿°äº†ã€‚æˆ‘æƒ³è®¨è®ºçš„æ˜¯ï¼Œå¦‚ä½•åœ¨ç¼–ç¨‹ä¸­ä¼˜åŒ–CPUçš„cacheæ€§èƒ½ã€‚&lt;/p>
&lt;h2 id="æŸ¥çœ‹cpuä¿¡æ¯">æŸ¥çœ‹CPUä¿¡æ¯ &lt;a href="#%e6%9f%a5%e7%9c%8bcpu%e4%bf%a1%e6%81%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘çš„ç³»ç»Ÿæ˜¯Ubuntu 12.04ï¼ŒCPUæ˜¯i5-3230Mã€‚ï¼ˆå±Œä¸æœº :D)&lt;/p>
&lt;pre tabindex="0">&lt;code>wizmann@Wichmann:~$ ls /sys/devices/system/cpu/cpu0/cache/index0/
coherency_line_size physical_line_partition size
level shared_cpu_list type
number_of_sets shared_cpu_map ways_of_associativity
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨catå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥è·å¾—CPU L1 cacheçš„ä¸€äº›ä¿¡æ¯ã€‚&lt;/p>
&lt;table class="table table-striped-white table-bordered">
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>&lt;tr>
&lt;td>level&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>size&lt;/td>
&lt;td>32K&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ways_of_associativity&lt;/td>
&lt;td>8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>type&lt;/td>
&lt;td>Data&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>number_of_sets&lt;/td>
&lt;td>64&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;p>ä»¥ä¸Šå¯çŸ¥ï¼ŒCPU L1 cacheæœ‰64ç»„ï¼Œæ¯ç»„æœ‰8ä¸ªcache lineã€‚æ˜¯&lt;strong>8ä½ç»„ç›¸è”&lt;/strong>çš„Cacheç±»å‹ã€‚&lt;/p>
&lt;h2 id="åˆ†æç¼“å­˜å¤±æ•ˆç‡">åˆ†æç¼“å­˜å¤±æ•ˆç‡ &lt;a href="#%e5%88%86%e6%9e%90%e7%bc%93%e5%ad%98%e5%a4%b1%e6%95%88%e7%8e%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯¹äºä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹å·¥è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¨‹åºæ¨¡æ‹ŸCacheçš„å¤±æ•ˆç‡ã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼ŒValgrindä¸ºæˆ‘ä»¬æä¾›äº†cachegrindå·¥å…·æ¥åˆ†æcacheçš„å¤±æ•ˆã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>wizmann@Wichmann:/tmp$ valgrind --tool=cachegrind --D1=32768,2,16 ./test
==14282== Cachegrind, a cache and branch-prediction profiler
==14282== Copyright (C) 2002-2011, and GNU GPL&amp;#39;d, by Nicholas Nethercote et al.
==14282== Using Valgrind-3.7.0 and LibVEX; rerun with -h for copyright info
==14282== Command: ./test
==14282==
--14282-- warning: L3 cache found, using its data for the LL simulation.
Average for a matrix of 257: 1875==14282==
==14282== I refs: 18,708,198
==14282== I1 misses: 1,404
==14282== LLi misses: 1,355
==14282== I1 miss rate: 0.00%
==14282== LLi miss rate: 0.00%
==14282==
==14282== D refs: 8,936,548 (4,543,346 rd + 4,393,202 wr)
==14282== D1 misses: 1,107,687 (1,086,263 rd + 21,424 wr)
==14282== LLd misses: 10,502 ( 5,179 rd + 5,323 wr)
==14282== D1 miss rate: 12.3% ( 23.9% + 0.4% )
==14282== LLd miss rate: 0.1% ( 0.1% + 0.1% )
==14282==
==14282== LL refs: 1,109,091 (1,087,667 rd + 21,424 wr)
==14282== LL misses: 11,857 ( 6,534 rd + 5,323 wr)
==14282== LL miss rate: 0.0% ( 0.0% + 0.1% )
&lt;/code>&lt;/pre>&lt;p>å…¶ä¸­I1ä»£è¡¨æŒ‡ä»¤1çº§ç¼“å­˜ï¼ŒD1ä»£è¡¨æ•°æ®1çº§ç¼“å­˜ï¼Œè€ŒLLä»£è¡¨äºŒçº§æˆ–ä¸‰çº§ç¼“å­˜ã€‚&lt;/p>
&lt;p>ä¸Šé¢çš„è¾“å‡ºä¹Ÿè®¸è¿‡äºå¤æ‚ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢åˆ—è¡¨åˆ†æã€‚&lt;/p>
&lt;h3 id="æµ‹è¯•ç¯å¢ƒ">æµ‹è¯•ç¯å¢ƒ &lt;a href="#%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åªè®¨è®ºL1çš„æƒ…å†µï¼ŒL1å¤§å°32768 Bytesï¼Œ2è·¯ç»„ç›¸è”ï¼Œæ¯ä¸ªcache lineæœ‰16 Bytesã€‚&lt;/p>
&lt;p>valgrindæµ‹è¯•å‘½ä»¤ä¸ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>wizmann@Wichmann:/tmp$ valgrind --tool=cachegrind --D1=32768,2,16 ./test
&lt;/code>&lt;/pre>&lt;h3 id="æµ‹è¯•ç¨‹åº">æµ‹è¯•ç¨‹åº &lt;a href="#%e6%b5%8b%e8%af%95%e7%a8%8b%e5%ba%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define SAMPLES 64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define MATSIZE 256
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;time.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> mat[MATSIZE][MATSIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">transpose&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> ( &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> ; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> MATSIZE ; i&lt;span style="color:#f92672">++&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> ( &lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> ; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> i ; j&lt;span style="color:#f92672">++&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> aux &lt;span style="color:#f92672">=&lt;/span> mat[i][j];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mat[i][j] &lt;span style="color:#f92672">=&lt;/span> mat[j][i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mat[j][i] &lt;span style="color:#f92672">=&lt;/span> aux;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//initialize matrix
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> ( &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> ; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> MATSIZE ; i&lt;span style="color:#f92672">++&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> ( &lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> ; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> MATSIZE ; j&lt;span style="color:#f92672">++&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mat[i][j] &lt;span style="color:#f92672">=&lt;/span> i&lt;span style="color:#f92672">+&lt;/span>j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> t &lt;span style="color:#f92672">=&lt;/span> clock();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> ( &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> ; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SAMPLES ; i&lt;span style="color:#f92672">++&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> transpose();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> elapsed &lt;span style="color:#f92672">=&lt;/span> clock() &lt;span style="color:#f92672">-&lt;/span> t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Average for a matrix of &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> MATSIZE &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> elapsed &lt;span style="color:#f92672">/&lt;/span> SAMPLES;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ &lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;table class="table table-striped-white table-bordered">
&lt;thead>
&lt;tr>
&lt;th>-&lt;/th>
&lt;th>MATSIZE = 256&lt;/th>
&lt;th>MATSIZE = 256 + 1&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>&lt;tr>
&lt;td>è¿è¡Œæ—¶é—´ (g++ O2) 1024æ¬¡&lt;/td>
&lt;td>78ms&lt;/td>
&lt;td>39ms&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>D1 Miss&lt;/td>
&lt;td>2,621,967&lt;/td>
&lt;td>1,107,687&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>D1 Miss Rate&lt;/td>
&lt;td>29.5%&lt;/td>
&lt;td>12.3%&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;p>ç”±æ­¤å¯è§ï¼ŒCacheçš„Miss RateåŸºæœ¬å†³å®šäº†ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼Œè¿è¡Œæ—¶é—´æ¯”ä¾‹å’ŒD1 MISS RATEçš„æ¯”ä¾‹åŸºæœ¬ä¸€è‡´ã€‚&lt;/p>
&lt;ul>
&lt;li>æ³¨ï¼šæœ¬æœºç¯å¢ƒä¸cachegrindå‚æ•°æ˜¯ä¸ä¸€è‡´çš„ï¼Œåœ¨æœ¬æœºä¸Šç”±äºcacheè¾ƒå¤§ï¼Œä¸”é‡‡ç”¨8ä½ç»„ç›¸è”ï¼Œæ‰€ä»¥D1 cache missè¾ƒå°‘ï¼Œå·®å¼‚ä¸»è¦ä½“ç°åœ¨LLd Miss Rateä¸Šã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å®é™…æ„ä¹‰">å®é™…æ„ä¹‰ &lt;a href="#%e5%ae%9e%e9%99%85%e6%84%8f%e4%b9%89" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¦‚æœç¨‹åºå¯¹ä¸€æ®µå†…å­˜è¿›è¡Œé¡ºåºè¯»å–çš„æ—¶å€™ï¼Œä»¥ä¸Šçš„ç¼“å­˜å¤±æ•ˆé—®é¢˜æœ‰å¯èƒ½ä¼šæ˜¾ç°å‡ºæ¥ã€‚ä½†æ˜¯ç¼“å­˜å¤±æ•ˆåªæ˜¯ç¨‹åºæ€§èƒ½é—®é¢˜çš„ä¸€ä¸ªå¯èƒ½çš„åŸå› ï¼Œåº”è¯¥åœ¨å¯¹ç¨‹åºè¿›è¡Œprofileä¹‹åå†åšç»“è®ºã€‚&lt;/p>
&lt;h2 id="å…¶å®ƒprofileå·¥å…·">å…¶å®ƒprofileå·¥å…· &lt;a href="#%e5%85%b6%e5%ae%83profile%e5%b7%a5%e5%85%b7" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘çš„æé—®ï¼š__&lt;a href="http://www.zhihu.com/question/24540567/noti-answers?group_id=564624072">æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å¯¹CPU cacheå¤±æ•ˆè¿›è¡Œè®¡æ•°ï¼Ÿ&lt;/a>__ä¸­ï¼Œå„ä½ç­”ä¸»è¿˜æä¾›äº†ä»¥ä¸‹å‡ ç§å·¥å…·ï¼š&lt;/p>
&lt;ul>
&lt;li>perf (linux)&lt;/li>
&lt;li>&lt;a href="http://tiptop.gforge.inria.fr/">Tiptop&lt;/a>&lt;/li>
&lt;li>qemu&lt;/li>
&lt;li>visual studioçš„cpu counter&lt;/li>
&lt;li>intel performance counter monitor&lt;/li>
&lt;li>vtunes&lt;/li>
&lt;/ul>
&lt;p>profileçš„æ–¹æ³•å¾ˆå¤šï¼Œé€‰ä¸€ä¸ªæ˜“ç”¨æ€§ä¸æ­£ç¡®æ€§è¾¾åˆ°å¹³è¡¡å°±å¯ä»¥ã€‚åæ­£æˆ‘æ˜¯å“ªä¸ªä¹Ÿä¸ä¼š_(:Ğ·ã€âˆ )_&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://yoursunny.com/study/EI209/?topic=cache">cacheæ˜ å°„åŠŸèƒ½ã€å‘½ä¸­ç‡è®¡ç®—&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://blog.focus-linux.net/?p=391">ä½¿ç”¨valgrindæ£€æŸ¥cacheå‘½ä¸­ç‡ï¼Œæé«˜ç¨‹åºæ€§èƒ½&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://valgrind.org/docs/manual/cg-manual.html">Cachegrind: a cache and branch-prediction profiler&lt;/a> ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰&lt;/li>
&lt;li>&lt;a href="https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/ch05s03s02.html">ä½¿ç”¨ Cachegrind ç®€è¦æ¦‚è¿°ç¼“å­˜ä½¿ç”¨&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://wwwcdf.pd.infn.it/valgrind/cg_main.html">Cachegrind: a cache-miss profiler&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.ibm.com/developerworks/cn/linux/l-cn-perf">Perf &amp;ndash; Linuxä¸‹çš„ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜å·¥å…·ï¼Œç¬¬ 1 éƒ¨åˆ†&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://coolshell.cn/articles/10249.html">7ä¸ªç¤ºä¾‹ç§‘æ™®CPU Cacheï¼ˆæ‰©å±•é˜…è¯»ï¼‰&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ç©ç©ç®—æ³•é¢˜1ï¼šSherlock and Queries</title><link>https://wizmann.top/posts/interview-problem-1-sherlock-and-queries/</link><pubDate>Sat, 19 Jul 2014 11:00:38 +0000</pubDate><guid>https://wizmann.top/posts/interview-problem-1-sherlock-and-queries/</guid><description>&lt;h2 id="é¢˜ç›®å¤§æ„">é¢˜ç›®å¤§æ„ &lt;a href="#%e9%a2%98%e7%9b%ae%e5%a4%a7%e6%84%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç»™ä½ ä¸‰ä¸ªæ•°ç»„:A[N], B[M], C[M]ã€‚è®©ä½ æŒ‰å¦‚ä¸‹pseudo-codeç»™å‡ºçš„è§„åˆ™è®¡ç®—ï¼Œæ±‚å‡ºæœ€ç»ˆA[N]æ¯ä¸€é¡¹çš„å€¼ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>for i = 1 to M do
for j = 1 to N do
if j % B[i] == 0 then
A[j] = A[j] * C[i]
endif
end do
end do
&lt;/code>&lt;/pre>&lt;h2 id="æ•°æ®èŒƒå›´">æ•°æ®èŒƒå›´ &lt;a href="#%e6%95%b0%e6%8d%ae%e8%8c%83%e5%9b%b4" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>1â‰¤ N,M â‰¤ 10^5&lt;/p>
&lt;p>1 â‰¤ B[i] â‰¤ N&lt;/p>
&lt;p>1 â‰¤ A[i],C[i] â‰¤10^5&lt;/p>
&lt;h2 id="brute-forceè§£æ³•">Brute-Forceè§£æ³• &lt;a href="#brute-force%e8%a7%a3%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æš´åŠ›è§£æ³•å°±æ˜¯é¢˜ç›®ä¸­ç»™å‡ºçš„èŒƒä¾‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(M * N)ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´ä¼˜åŒ–çš„è§£æ³•ã€‚&lt;/p>
&lt;h2 id="ç­›æ³•">ç­›æ³• &lt;a href="#%e7%ad%9b%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»&lt;code>j % B[i] == 0&lt;/code>è¿™ä¸ªå…³ç³»æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„è”æƒ³åˆ°&lt;a href="https://zh.wikipedia.org/zh-cn/%E5%9F%83%E6%8B%89%E6%89%98%E6%96%AF%E7%89%B9%E5%B0%BC%E7%AD%9B%E6%B3%95">ç­›æ³•&lt;/a>ï¼Œæˆ‘ä»¬ä¸å¿…è¦ä»1åˆ°Næ¯æ¬¡å»å°è¯•æ˜¯å¦å¯ä»¥è¢«B[i]æ•´é™¤ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æ•°ç»„Açš„ç¬¬&lt;code>B[i], B[i] * 2 ... B[i] * k&lt;/code>é¡¹ä¸Šç›´æ¥ä¹˜ä¸ŠC[i]ã€‚&lt;/p>
&lt;p>æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(k)ï¼Œk = sum(N / B[i])&lt;/p>
&lt;p>å¦‚æœæ•°ç»„Bä¸­çš„å€¼ä¸¤ä¸¤ä¸ç­‰ã€‚é‚£ä¹ˆkçš„æœ€å¤§å€¼å°±æ˜¯è°ƒå’Œçº§æ•°&lt;code>N + N / 2 + N / 3 + ... + N / N&lt;/code>ï¼Œå…¶å€¼çº¦ä¸º&lt;code>N * lnN&lt;/code>ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¦‚æœæ•°ç»„Bä¸­çš„å€¼æœ‰å¤§é‡ç›¸ç­‰ï¼Œå¹¶ä¸”å€¼éå¸¸å°ï¼ˆå¦‚1æˆ–2ç­‰ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦ä»ç„¶ä¼šé€€åŒ–åˆ°O(N * M)ã€‚&lt;/p>
&lt;h2 id="è®©æˆ‘ä»¬å†ä¼˜åŒ–ä¸€å°ä¸‹">è®©æˆ‘ä»¬å†ä¼˜åŒ–ä¸€å°ä¸‹ &lt;a href="#%e8%ae%a9%e6%88%91%e4%bb%ac%e5%86%8d%e4%bc%98%e5%8c%96%e4%b8%80%e5%b0%8f%e4%b8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸Šæ–‡æˆ‘ä»¬åˆ†æåˆ°ï¼Œå¦‚æœæ•°ç»„Bä¸­çš„å€¼æœ‰å¤§é‡ç›¸ç­‰æ—¶ï¼Œç¨‹åºçš„æ—¶é—´å¤æ‚åº¦ä¼šä¸¥é‡é€€åŒ–ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ä¼˜åŒ–æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>ä»ä¸Šé¢çš„pseudo-codeæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœB[i] == B[i&amp;rsquo;]ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šå¯¹Açš„åŒä¸€é¡¹è¿›è¡Œæ“ä½œï¼Œäºæ˜¯æˆ‘ä»¬å°±æŠŠæœ‰ç€ç›¸åŒå€¼çš„B[i]åˆå¹¶åœ¨ä¸€èµ·ï¼Œè€Œæ“ä½œæ•°C[i]ç´¯ä¹˜ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„æ—¶é—´å¤æ‚åº¦å°±ä¼šæ¥è¿‘äºæœ€ä¼˜å€¼O(N * lnN)ã€‚&lt;/p>
&lt;h2 id="show-me-the-code">Show me the code &lt;a href="#show-me-the-code" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100010&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> MOD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000000007&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> vb, vc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">friend&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> node&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> node&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a.vb &lt;span style="color:#f92672">&amp;lt;&lt;/span> b.vb;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node nodes[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> A[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint g &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pre &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> m &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nodes[i].vb &lt;span style="color:#f92672">==&lt;/span> pre) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g &lt;span style="color:#f92672">*=&lt;/span> nodes[i].vc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g &lt;span style="color:#f92672">%=&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nodes[i].vb &lt;span style="color:#f92672">!=&lt;/span> pre &lt;span style="color:#f92672">||&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> m &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> pre;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; b &lt;span style="color:#f92672">*&lt;/span> j &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> b &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pa &lt;span style="color:#f92672">=&lt;/span> b &lt;span style="color:#f92672">*&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> A[pa] &lt;span style="color:#f92672">=&lt;/span> llint(A[pa]) &lt;span style="color:#f92672">*&lt;/span> g &lt;span style="color:#f92672">%&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g &lt;span style="color:#f92672">=&lt;/span> nodes[i].vc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pre &lt;span style="color:#f92672">=&lt;/span> nodes[i].vb;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>A[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>(nodes[i].vb));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>(nodes[i].vc));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(nodes &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, nodes &lt;span style="color:#f92672">+&lt;/span> m &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> solve();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>, A[i] &lt;span style="color:#f92672">%&lt;/span> MOD);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å…³é”®ç‚¹">å…³é”®ç‚¹ &lt;a href="#%e5%85%b3%e9%94%ae%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>æ˜¯å¦äº†è§£ç­›æ³•ï¼Œå¹¶ä¸”å¯ä»¥ä»é¢˜ç›®çš„æç¤ºä¸­è”æƒ³åˆ°ç­›æ³•&lt;/li>
&lt;li>æ˜¯å¦äº†è§£è°ƒå’Œçº§æ•°ä¼°è®¡æ—¶é—´å¤æ‚åº¦çš„æ–¹æ³•&lt;/li>
&lt;li>æ˜¯å¦äº†è§£ç®—æ³•çš„best-caseå’Œworst-case&lt;/li>
&lt;li>æ˜¯å¦å¯ä»¥äº†è§£ç®—æ³•çš„ç“¶é¢ˆï¼Œå¹¶ä¼˜åŒ–è‡ªå·±çš„ç®—æ³•&lt;/li>
&lt;/ul>
&lt;h2 id="ç®—æ³•åˆ†æç”¨åˆ°çš„ä¸€äº›è¿‘ä¼¼å…¬å¼">ç®—æ³•åˆ†æç”¨åˆ°çš„ä¸€äº›è¿‘ä¼¼å…¬å¼ &lt;a href="#%e7%ae%97%e6%b3%95%e5%88%86%e6%9e%90%e7%94%a8%e5%88%b0%e7%9a%84%e4%b8%80%e4%ba%9b%e8%bf%91%e4%bc%bc%e5%85%ac%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/book-algorithm-approximate-functions.png" alt="cheetsheet">&lt;/p>
&lt;ul>
&lt;li>æœ¬å›¾æ¥è‡ªã€Šç®—æ³• ç¬¬å››ç‰ˆã€‹&lt;/li>
&lt;/ul>
&lt;h2 id="åŸé¢˜é“¾æ¥">åŸé¢˜é“¾æ¥ &lt;a href="#%e5%8e%9f%e9%a2%98%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://www.hackerrank.com/challenges/sherlock-and-queries">æˆ³æˆ‘ä¹ˆä¹ˆå“’&lt;/a>&lt;/p></description></item><item><title>Codeforces Round #253 Tutorial</title><link>https://wizmann.top/posts/cf-253/</link><pubDate>Sat, 21 Jun 2014 19:24:37 +0000</pubDate><guid>https://wizmann.top/posts/cf-253/</guid><description>&lt;hr>
&lt;h2 id="443a---anton-and-letters">443A - Anton and Letters &lt;a href="#443a---anton-and-letters" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Simple and easy, solved by two lines of python code.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>ls &lt;span style="color:#f92672">=&lt;/span> filter(&lt;span style="color:#66d9ef">lambda&lt;/span> y: y, map(&lt;span style="color:#66d9ef">lambda&lt;/span> x: x&lt;span style="color:#f92672">.&lt;/span>strip(), raw_input()[&lt;span style="color:#ae81ff">1&lt;/span>:&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#34;,&amp;#34;&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print len(set(ls))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="443b---kolya-and-tandem-repeat">443B - Kolya and Tandem Repeat &lt;a href="#443b---kolya-and-tandem-repeat" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Brute force. Just enumerate the beginning and the end of the substring, and check if that substring is &lt;strong>tandem repeat&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>string str;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(str &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> k);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> str &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;?&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> len &lt;span style="color:#f92672">=&lt;/span> str.length();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> len; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (str[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;?&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">+&lt;/span> j &lt;span style="color:#f92672">&amp;lt;&lt;/span> len; j &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> slip &lt;span style="color:#f92672">=&lt;/span> (j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; k &lt;span style="color:#f92672">&amp;lt;&lt;/span> slip; k&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (str[i &lt;span style="color:#f92672">+&lt;/span> k] &lt;span style="color:#f92672">==&lt;/span> str[i &lt;span style="color:#f92672">+&lt;/span> k &lt;span style="color:#f92672">+&lt;/span> slip] &lt;span style="color:#f92672">||&lt;/span> str[i &lt;span style="color:#f92672">+&lt;/span> k &lt;span style="color:#f92672">+&lt;/span> slip] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;?&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* pass */&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">goto&lt;/span> fail;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fail: &lt;span style="color:#75715e">/*pass*/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="442a---borya-and-hanabig">442A - Borya and Hanabig &lt;a href="#442a---borya-and-hanabig" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Because Borya knows about the color and value of all his cards, he just need to distinguish each card from the others.&lt;/p>
&lt;p>Distinguish one card from all others seems difficult, but distinguish one card from &lt;em>ONE&lt;/em> other card is simple enough. So if we can tell the difference between one card and any other, it can be determined from all pairs which contain this card. At last, if all pairs of cards can be distinguished, we can claim that we can distinguish all cards.&lt;/p>
&lt;p>It&amp;rsquo;s easy to find out that we have 10 different kind of hints in total(5 colors and 5 values) and 1024 different combination of all that hints(1 &amp;laquo; 10). As a result, we can enumerate all combinations, and try to indicate whether this batch of hints can distinguish all these cards.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cassert&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;set&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">29&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> instr[&lt;span style="color:#ae81ff">10&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> mp[&lt;span style="color:#ae81ff">256&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> _str[] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;12345RGBYW&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; _str[i]; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[&lt;span style="color:#66d9ef">int&lt;/span>(_str[i])] &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">conv&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> mp[&lt;span style="color:#66d9ef">int&lt;/span>(x)];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (input(n)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> set&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, instr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> conv(instr[&lt;span style="color:#ae81ff">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> b &lt;span style="color:#f92672">=&lt;/span> conv(instr[&lt;span style="color:#ae81ff">1&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> v &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> a) &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// print(a &amp;lt;&amp;lt; &amp;#39; &amp;#39; &amp;lt;&amp;lt; b &amp;lt;&amp;lt; &amp;#39; &amp;#39; &amp;lt;&amp;lt; v);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (st.find(v) &lt;span style="color:#f92672">!=&lt;/span> st.end()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.insert(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)vec.size(); j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; k &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)vec.size(); k&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> diff &lt;span style="color:#f92672">=&lt;/span> vec[j] &lt;span style="color:#f92672">^&lt;/span> vec[k];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>(i &lt;span style="color:#f92672">&amp;amp;&lt;/span> diff)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">goto&lt;/span> fail;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> min(ans, __builtin_popcount(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fail: &lt;span style="color:#75715e">/*pass*/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="442b---andrey-and-problem">442B - Andrey and Problem &lt;a href="#442b---andrey-and-problem" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Assuming that the possibility of getting exactly one problem from some of Andrey&amp;rsquo;s friends is &lt;code>p1&lt;/code> and get no problem is &lt;code>p0&lt;/code>. So, if we want to add one friend whose possibility of comming up a problem is &lt;code>pa&lt;/code> to this very friend set, we can get &lt;code>next_p1 = p1 * (1 - pa) + p0 * pa&lt;/code> and &lt;code>next_p0 = p0 * (1 - pa)&lt;/code>. And it easy to indicate that a greater &lt;code>pa&lt;/code> will lead to a greater &lt;code>next_p1&lt;/code>.&lt;/p>
&lt;p>The initial value is that &lt;code>p0 == 1; p1 == 0&lt;/code>. And we add the friends one by one ordered by the possibilites reversely. At last, the max &lt;code>p1&lt;/code> is the final result.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps &lt;span style="color:#f92672">=&lt;/span> map(float, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps&lt;span style="color:#f92672">.&lt;/span>sort(reverse&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>good &lt;span style="color:#f92672">=&lt;/span> ps[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bad &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> good
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ans &lt;span style="color:#f92672">=&lt;/span> good
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> p &lt;span style="color:#f92672">in&lt;/span> ps[&lt;span style="color:#ae81ff">1&lt;/span>:]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> good, bad &lt;span style="color:#f92672">=&lt;/span> good &lt;span style="color:#f92672">*&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> p) &lt;span style="color:#f92672">+&lt;/span> p &lt;span style="color:#f92672">*&lt;/span> bad, bad &lt;span style="color:#f92672">*&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">-&lt;/span> p)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, good)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print ans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>A simple problem - World at War</title><link>https://wizmann.top/posts/world-at-war/</link><pubDate>Thu, 12 Jun 2014 17:42:51 +0000</pubDate><guid>https://wizmann.top/posts/world-at-war/</guid><description>&lt;h2 id="background">Background &lt;a href="#background" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>This problem is from the book &amp;ldquo;&lt;a href="http://book.douban.com/subject/19952400/">Algorithm 4th edition&lt;/a>&amp;rdquo; (Exersise 4.1.10)&lt;/p>&lt;/blockquote>
&lt;p>There are N cities and M undirected roads between those cities. People can travel to any city along the roads.&lt;/p>
&lt;p>One day, a war breaks out. Our cities are under attack! As we can&amp;rsquo;t defend all these N cities, the commander wants you to find the least important city, which means that if this city fell to the enemy, the traffic among other cities would not be affected.&lt;/p>
&lt;p>If there are multiple answers, print any one of them. If there&amp;rsquo;s no that kind of city, print -1.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-world-at-war.png" alt="world-at-war">&lt;/p>
&lt;h2 id="the-spanning-tree-of-a-graph">The spanning tree of a graph &lt;a href="#the-spanning-tree-of-a-graph" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>It is a spanning tree of a graph G if it spans G (that is, it includes every vertex of G) and is a subgraph of G (every edge in the tree belongs to G).
&amp;ndash; wikipedia&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-spanning-tree.png" alt="spanning-tree">&lt;/p>
&lt;p>For example, there is a spanning tree of a graph. These nodes in green is leaf node. So it is easy to know that if we remove a leaf node, the graph won&amp;rsquo;t be affect. The rest of the graph (and the spanning tree) are still connected.&lt;/p>
&lt;p>So the answer is here.&lt;/p>
&lt;h2 id="how-to-generate-a-spanning-tree">How to generate a spanning tree &lt;a href="#how-to-generate-a-spanning-tree" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>There are multiple ways to generate a spanning three of a undirected graph. The most famous algorithm is &lt;strong>prim&lt;/strong>, which will generate a MST(minimum spanning tree) with O(n**2) time complexity.&lt;/p>
&lt;p>However, MST is not needed in this scenario, because an arbitrary spanning tree is enough to find one of the leaf nodes.&lt;/p>
&lt;p>Depth first search (a.k.a DFS) is one of the simplest way to generate the spanning tree. We just start from arbitrary node of the graph, and search through the graph until it comes to a dead-end &amp;ndash; the leaf node. Then print the answer.&lt;/p>
&lt;p>Problem solved.&lt;/p>
&lt;h2 id="show-me-the-code">Show me the code &lt;a href="#show-me-the-code" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Solution&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> least_important_city(vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> g) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (g.size() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n &lt;span style="color:#f92672">=&lt;/span> g.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">bool&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> visit;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit.resize(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fill(visit.begin(), visit.end(), false);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> flag &lt;span style="color:#f92672">=&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit[now] &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> g[now].begin();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iter &lt;span style="color:#f92672">!=&lt;/span> g[now].end();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">++&lt;/span>iter) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">*&lt;/span>iter;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>visit[next]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now &lt;span style="color:#f92672">=&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> flag &lt;span style="color:#f92672">=&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>flag) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> now;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>How to implement a queue with stack(s)?</title><link>https://wizmann.top/posts/implement-queue-with-stacks/</link><pubDate>Tue, 20 May 2014 13:23:03 +0000</pubDate><guid>https://wizmann.top/posts/implement-queue-with-stacks/</guid><description>&lt;p>This problem is from the book &lt;a href="http://book.douban.com/subject/19952400/">&lt;em>Algorithms, 4th Edition&lt;/em>&lt;/a>.&lt;/p>
&lt;blockquote>
&lt;p>Queue with three stacks. Implement a queue with three stacks so that each queue operation takes a constant (worst-case) number of stack operations.&lt;/p>
&lt;p>Warning : high degree of difficulty.&lt;/p>&lt;/blockquote>
&lt;p>When I search the Internet to find a solution, I find varieties of this problem, such as &amp;ldquo;implement a queue with ONE stack&amp;rdquo;, &amp;ldquo;implement a queue with TWO stack&amp;rdquo;, etc.&lt;/p>
&lt;p>It is fun, indeed. I spent the whole morning to finding the solution of these problems. So, let&amp;rsquo;s rock.&lt;/p>
&lt;h2 id="build-a-test-environment">Build a test environment &lt;a href="#build-a-test-environment" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>I choose python as a programming language.&lt;/p>
&lt;p>So firstly, I implement an &lt;strong>ABstract Class&lt;/strong>(ABC) of a queue as the template of all classes of queue, called &lt;code>QueueTpl&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> abc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">QueueTpl&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> __metaclass__ &lt;span style="color:#f92672">=&lt;/span> abc&lt;span style="color:#f92672">.&lt;/span>ABCMeta
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@abc.abstractmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@abc.abstractmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@abc.abstractmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">@abc.abstractmethod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Secondly, I write an &lt;strong>Adapter&lt;/strong> for &lt;code>Queue.Queue()&lt;/code> class of python, called &lt;code>QueueAdapter&lt;/code>, to make it returns &lt;code>None&lt;/code> when we get items from an empty instance.
And we use &lt;code>put_nowait&lt;/code> and &lt;code>get_nowait&lt;/code> to speed up because there&amp;rsquo;s no need to get the guarantee of &lt;strong>thread safe&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> Queue
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">QueueAdapter&lt;/span>(QueueTpl):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>clear()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>q &lt;span style="color:#f92672">=&lt;/span> Queue&lt;span style="color:#f92672">.&lt;/span>Queue()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>q&lt;span style="color:#f92672">.&lt;/span>put_nowait(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>q&lt;span style="color:#f92672">.&lt;/span>empty():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>q&lt;span style="color:#f92672">.&lt;/span>get_nowait()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>At last, use &lt;code>python unittest&lt;/code> to verify my solution.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">TestStQueue&lt;/span>(unittest&lt;span style="color:#f92672">.&lt;/span>TestCase):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_push_and_pop&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sq &lt;span style="color:#f92672">=&lt;/span> QueueAdapter()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sq&lt;span style="color:#f92672">.&lt;/span>push(&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>assertEqual(sq&lt;span style="color:#f92672">.&lt;/span>pop(), &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>assertFalse(sq&lt;span style="color:#f92672">.&lt;/span>pop())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">10&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sq&lt;span style="color:#f92672">.&lt;/span>push(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(&lt;span style="color:#ae81ff">10&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>assertEqual(sq&lt;span style="color:#f92672">.&lt;/span>pop(), i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>assertFalse(sq&lt;span style="color:#f92672">.&lt;/span>pop())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_rand_command&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cmd &lt;span style="color:#f92672">=&lt;/span> random&lt;span style="color:#f92672">.&lt;/span>choice([&lt;span style="color:#e6db74">&amp;#39;push&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;pop&amp;#39;&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">=&lt;/span> random&lt;span style="color:#f92672">.&lt;/span>randint(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> cmd, value
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_brute_force&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> qs &lt;span style="color:#f92672">=&lt;/span> [QueueAdapter(), StQueue3(), StQueue2(), StQueue1()]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(step):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a, b &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>get_rand_command()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> a &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;push&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> map(&lt;span style="color:#66d9ef">lambda&lt;/span> q: q&lt;span style="color:#f92672">.&lt;/span>push(b), qs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rs &lt;span style="color:#f92672">=&lt;/span> map(&lt;span style="color:#66d9ef">lambda&lt;/span> q: q&lt;span style="color:#f92672">.&lt;/span>pop(), qs)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>assertTrue(all(x &lt;span style="color:#f92672">==&lt;/span> rs[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#66d9ef">for&lt;/span> x &lt;span style="color:#f92672">in&lt;/span> rs))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="implement-a-queue-with-one-stack">Implement a queue with ONE stack &lt;a href="#implement-a-queue-with-one-stack" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>It&amp;rsquo;s said that it&amp;rsquo;s an interview problem of Microsoft.(gossip, perhaps)&lt;/p>
&lt;p>The problem asks us to implement a queue with ONLY ONE stack. It seems hard, but it is actually an easy problem.&lt;/p>
&lt;p>The &lt;code>push&lt;/code> function is easy, just push the value into the stack. And the &lt;code>pop&lt;/code> function is a little bit hard, but we can do it with recursion to get the first element of the &amp;ldquo;queue&amp;rdquo;, and put every items else in their origin order in the stack.&lt;/p>
&lt;p>The code is short, too.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">StQueue1&lt;/span>(QueueTpl):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>clear()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a &lt;span style="color:#f92672">=&lt;/span> []&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>append(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(self&lt;span style="color:#f92672">.&lt;/span>a) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>append(v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The time complexity of a &lt;code>push&lt;/code> is O(1) with no extra memory space; a &lt;code>pop&lt;/code> is takes O(n) of time, and O(n) extra memory space in the &lt;strong>stack area&lt;/strong>(not the stack).&lt;/p>
&lt;h2 id="implement-a-queue-with-two-stacks">Implement a queue with TWO stacks &lt;a href="#implement-a-queue-with-two-stacks" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>This problem is so classic and so popular, so I just paste my solution here as everyone knows the answer.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">StQueue2&lt;/span>(QueueTpl):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>clear()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b&lt;span style="color:#f92672">.&lt;/span>append(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>b:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>append(self&lt;span style="color:#f92672">.&lt;/span>b&lt;span style="color:#f92672">.&lt;/span>pop())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="implement-a-queue-with-three-stacks">Implement a queue with THREE stacks &lt;a href="#implement-a-queue-with-three-stacks" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>As it is said in the book, it&amp;rsquo;s a hard problem. And here is a &lt;a href="http://stackoverflow.com/questions/5538192/how-to-implement-a-queue-with-three-stacks">discuss&lt;/a> in the Stackoverflow where I find this &lt;a href="http://stackoverflow.com/a/5568094/2927439">solution&lt;/a>.&lt;/p>
&lt;pre tabindex="0">&lt;code>| | | |3| | | |
| | | |_| | | |
| | |_____| | |
| | | |
| | |2| | |
| | |_| | |
| |_________| |
| |
| |1| |
| |_| |
|_____________|
&lt;/code>&lt;/pre>&lt;p>This solution uses nested stacks to perform as a &lt;strong>linked-list&lt;/strong>, and use the &lt;strong>linked-list&lt;/strong> to perform as a queue.&lt;/p>
&lt;p>A queue of &amp;ldquo;1, 2, 3&amp;rdquo; looks like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#ae81ff">3&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>],
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We use three stack pointers &lt;code>stack_a&lt;/code> &lt;code>stack_b&lt;/code> and &lt;code>stack_c&lt;/code>, &lt;code>stack_a&lt;/code> points to the stack which stores the nested stacks, and &lt;code>stack_b&lt;/code> is a pointer to the last stack the nested stack, &lt;code>stack_c&lt;/code> as a temporary stack pointer.&lt;/p>
&lt;p>So, &lt;code>push&lt;/code> function is just push the new value in the last stack in the stack which is pointed by pointer &lt;code>stack_b&lt;/code>, and then push a new stack in &lt;code>stack_b&lt;/code> and make &lt;code>stack_b&lt;/code> to point to the new stack. (complicated, &amp;lt;(=&lt;em>/Ï‰ï¼¼&lt;/em>=)&amp;gt;)&lt;/p>
&lt;p>The &lt;code>pop&lt;/code> function is to get the first element of the nested stack, just get the first element, and make &lt;code>stack_a&lt;/code> point to the rest of the data.&lt;/p>
&lt;p>This code is easy but may hard to understand.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">StQueue3&lt;/span>(QueueTpl):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>clear()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">push&lt;/span>(self, value):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>c &lt;span style="color:#f92672">=&lt;/span> [value]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b&lt;span style="color:#f92672">.&lt;/span>append(self&lt;span style="color:#f92672">.&lt;/span>c)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>c &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b&lt;span style="color:#f92672">.&lt;/span>append(self&lt;span style="color:#f92672">.&lt;/span>c)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>b &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pop&lt;/span>(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(self&lt;span style="color:#f92672">.&lt;/span>a) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>c &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>a&lt;span style="color:#f92672">.&lt;/span>pop()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>a &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="the-main-function">The main function &lt;a href="#the-main-function" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;__main__&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> unittest&lt;span style="color:#f92672">.&lt;/span>main()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="to-sum-up">To sum up &lt;a href="#to-sum-up" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-queue-with-stack-summary.jpg" alt="summarize">&lt;/p></description></item><item><title>å†…å­˜å±éšœåˆæ¢</title><link>https://wizmann.top/posts/read-paper-barrier/</link><pubDate>Thu, 08 May 2014 19:05:26 +0000</pubDate><guid>https://wizmann.top/posts/read-paper-barrier/</guid><description>&lt;h2 id="åŸæ–‡åœ°å€">åŸæ–‡åœ°å€ &lt;a href="#%e5%8e%9f%e6%96%87%e5%9c%b0%e5%9d%80" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="http://ridiculousfish.com/blog/posts/barrier.html">Barrier February 17th, 2007&lt;/a>&lt;/p>
&lt;h2 id="å‰è¨€å¤šæ ¸æ—¶ä»£çš„æŒ‘æˆ˜">å‰è¨€ï¼šå¤šæ ¸æ—¶ä»£çš„æŒ‘æˆ˜ &lt;a href="#%e5%89%8d%e8%a8%80%e5%a4%9a%e6%a0%b8%e6%97%b6%e4%bb%a3%e7%9a%84%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å°½ç®¡80æ ¸å¿ƒçš„æµ®ç‚¹è¿ç®—å·¨å…½ä»ç„¶é¥ä¸å¯åŠï¼Œå¤šæ ¸å¤„ç†å™¨çš„æ—¶ä»£å·²ç»åˆ°æ¥ã€‚å¤šæ ¸å¤„ç†å™¨çš„æ¦‚å¿µå¹¶éæ–°é²œäº‹ç‰©ï¼Œåœ¨Power Macintosh 9500ä¸­å°±å·²ç»é‡‡ç”¨äº†å¤šæ ¸å¤„ç†å™¨æŠ€æœ¯ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥ç†è§£å¤šæ ¸å¤„ç†å™¨çš„å†…åœ¨æœºåˆ¶ã€‚&lt;/p>
&lt;h2 id="çº¿ç¨‹æŠ€æœ¯æ¢è®¨">çº¿ç¨‹æŠ€æœ¯æ¢è®¨ &lt;a href="#%e7%ba%bf%e7%a8%8b%e6%8a%80%e6%9c%af%e6%8e%a2%e8%ae%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åè¯è§£é‡Š">åè¯è§£é‡Š &lt;a href="#%e5%90%8d%e8%af%8d%e8%a7%a3%e9%87%8a" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="çº¿ç¨‹">çº¿ç¨‹ &lt;a href="#%e7%ba%bf%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>çº¿ç¨‹æ˜¯ä¸€ç§æ‹¥æœ‰å…±äº«åœ°å€ç©ºé—´çš„ã€èƒ½è¢«æŠ¢å å¼è°ƒåº¦çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚&lt;/p>
&lt;h4 id="å¤šçº¿ç¨‹">å¤šçº¿ç¨‹ &lt;a href="#%e5%a4%9a%e7%ba%bf%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>å¤šçº¿ç¨‹æ˜¯ä¸€ç§ç”¨äºç®€åŒ–æ§åˆ¶æµã€ç»•è¿‡é˜»å¡ç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•ï¼Œå¹¶ä¸ä¸“é—¨ç”¨äºå®ç°ç¨‹åºçš„å¹¶è¡ŒåŒ–ã€‚&lt;/p>
&lt;h4 id="å¹¶å‘å¤šçº¿ç¨‹">å¹¶å‘å¤šçº¿ç¨‹ &lt;a href="#%e5%b9%b6%e5%8f%91%e5%a4%9a%e7%ba%bf%e7%a8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>ç‰©ç†ä¸Šå¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ—¨åœ¨é€šè¿‡åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚&lt;/p>
&lt;h3 id="å¹¶å‘å¤šçº¿ç¨‹çš„æŒ‘æˆ˜">â€œå¹¶å‘å¤šçº¿ç¨‹â€çš„æŒ‘æˆ˜ &lt;a href="#%e5%b9%b6%e5%8f%91%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%8c%91%e6%88%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å°½ç®¡å¹¶å‘å¤šçº¿ç¨‹è¢«å¹¿æ³›è®¨è®ºï¼Œå…¶æŒ‘æˆ˜å¹¶éæºè‡ªè‡ªç„¶åŸå› ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±çš„è®¾è®¡é€‰æ‹©æ‰€é€ æˆçš„ã€‚ä¸»è¦é—®é¢˜åœ¨äºï¼Œé’ˆå¯¹å•çº¿ç¨‹ç¨‹åºçš„è¿‡åº¦ä¼˜åŒ–åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸å†é€‚ç”¨ã€‚&lt;/p>
&lt;p>å…·ä½“æ¥è¯´ï¼Œç”±äºCPUçš„æ‰§è¡Œé€Ÿåº¦è¿œè¶…å†…å­˜å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹å†…å­˜å†…å®¹è¿›è¡Œâ€œé¢„æµ‹â€ï¼Œä»è€Œé¿å…CPUç­‰å¾…å†…å­˜æ£€æŸ¥ã€‚è¿™é‡Œçš„â€œé¢„æµ‹â€å®é™…ä¸Šæ˜¯CPUå’Œç¼–è¯‘å™¨å¯¹å†…å­˜çŠ¶æ€åšå‡ºçš„è¶Šæ¥è¶Šæ¿€è¿›çš„å‡è®¾ã€‚&lt;/p>
&lt;h2 id="ç¤ºä¾‹åˆ†æ">ç¤ºä¾‹åˆ†æ &lt;a href="#%e7%a4%ba%e4%be%8b%e5%88%86%e6%9e%90" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="å†™çº¿ç¨‹ç¤ºä¾‹">å†™çº¿ç¨‹ç¤ºä¾‹ &lt;a href="#%e5%86%99%e7%ba%bf%e7%a8%8b%e7%a4%ba%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆå§‹æ—¶ variable1 = variable2 = 0;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> variable1&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> variable2&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¯»çº¿ç¨‹ç¤ºä¾‹">è¯»çº¿ç¨‹ç¤ºä¾‹ &lt;a href="#%e8%af%bb%e7%ba%bf%e7%a8%8b%e7%a4%ba%e4%be%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local2 &lt;span style="color:#f92672">=&lt;/span> variable2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local1 &lt;span style="color:#f92672">=&lt;/span> variable1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (local2 &lt;span style="color:#f92672">&amp;gt;&lt;/span> local1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;Error!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­£å¸¸é€»è¾‘ä¸‹ï¼Œlocal2 åº”å½“å§‹ç»ˆå°äºæˆ–ç­‰äº local1ï¼Œå› ä¸º variable1 æ€»æ˜¯åœ¨ variable2 ä¹‹åå¢åŠ ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œç°å®æ˜¯å¦å¦‚æ­¤ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;ctime&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;pthread.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;sys/time.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">unsigned&lt;/span> variable1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">unsigned&lt;/span> variable2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ITERATIONS 200000000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">writer&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>unused) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (;;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> variable1 &lt;span style="color:#f92672">=&lt;/span> variable1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> variable2 &lt;span style="color:#f92672">=&lt;/span> variable2 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">reader&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>unused) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">timeval&lt;/span> start, end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gettimeofday(&lt;span style="color:#f92672">&amp;amp;&lt;/span>start, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> i, failureCount &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (i&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> ITERATIONS; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> v2 &lt;span style="color:#f92672">=&lt;/span> variable2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> v1 &lt;span style="color:#f92672">=&lt;/span> variable1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (v2 &lt;span style="color:#f92672">&amp;gt;&lt;/span> v1) failureCount&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gettimeofday(&lt;span style="color:#f92672">&amp;amp;&lt;/span>end, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">double&lt;/span> seconds &lt;span style="color:#f92672">=&lt;/span> end.tv_sec &lt;span style="color:#f92672">+&lt;/span> end.tv_usec &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">1000000.&lt;/span> &lt;span style="color:#f92672">-&lt;/span> start.tv_sec &lt;span style="color:#f92672">-&lt;/span> start.tv_usec &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">1000000.&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%u failure%s (%2.1f percent of the time) in %2.1f seconds&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> failureCount, failureCount &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#ae81ff">100.&lt;/span> &lt;span style="color:#f92672">*&lt;/span> failureCount) &lt;span style="color:#f92672">/&lt;/span> ITERATIONS, seconds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_t thread1, thread2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_create(&lt;span style="color:#f92672">&amp;amp;&lt;/span>thread1, NULL, writer, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_create(&lt;span style="color:#f92672">&amp;amp;&lt;/span>thread2, NULL, reader, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (;;) sleep(&lt;span style="color:#ae81ff">1000000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºç»“æœï¼š&lt;code>0 failures (0.0 percent of the time) in 1.2 seconds&lt;/code>&lt;/p>
&lt;h3 id="è²Œä¼¼æ˜¯æ­£ç¡®çš„">è²Œä¼¼æ˜¯æ­£ç¡®çš„ï¼Ÿ &lt;a href="#%e8%b2%8c%e4%bc%bc%e6%98%af%e6%ad%a3%e7%a1%ae%e7%9a%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç¨‹åºè¿è¡Œçš„æ­£å¦‚æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¡®ä¿¡ç¨‹åºæ˜¯ä¸€å®šæ­£ç¡®çš„å—ï¼Ÿ&lt;/p>
&lt;p>ä¸èƒ½ã€‚&lt;/p>
&lt;p>å› ä¸ºç¨‹åºä¸­çš„ä¸¤ä¸ªçº¿ç¨‹å¦‚æœåœ¨åŒä¸€ä¸ªCPUä¸Šè¢«è°ƒåº¦ï¼Œæˆ‘ä»¬æ°¸è¿œéƒ½ä¼šå¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚&lt;/p>
&lt;h3 id="çº¿ç¨‹ä¸ä¸åŒçš„cpuè¿›è¡Œç»‘å®š">çº¿ç¨‹ä¸ä¸åŒçš„CPUè¿›è¡Œç»‘å®š &lt;a href="#%e7%ba%bf%e7%a8%8b%e4%b8%8e%e4%b8%8d%e5%90%8c%e7%9a%84cpu%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">writer&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>unused) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cpu_set_t cpuset;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_ZERO(&lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_SET(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sched_setaffinity(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(cpuset), &lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">reader&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>unused) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cpu_set_t cpuset;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_ZERO(&lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CPU_SET(&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sched_setaffinity(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(cpuset), &lt;span style="color:#f92672">&amp;amp;&lt;/span>cpuset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// p.s. æˆ‘æœºå™¨æ˜¯i5åŒæ ¸å››çº¿ç¨‹ï¼Œæ‰€ä»¥ç»‘åœ¨äº†CPU0å’ŒCPU2ä¸Š
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœï¼š&lt;code>0 failures (0.0 percent of the time) in 1.4 seconds&lt;/code>&lt;/p>
&lt;h3 id="ä¼¼ä¹ä»ç„¶æ˜¯å‡†ç¡®çš„">ä¼¼ä¹ä»ç„¶æ˜¯å‡†ç¡®çš„ &lt;a href="#%e4%bc%bc%e4%b9%8e%e4%bb%8d%e7%84%b6%e6%98%af%e5%87%86%e7%a1%ae%e7%9a%84" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘åˆ°CPUå¯¹å˜é‡çš„æ“ä½œå…¶å®æ˜¯ä½œç”¨åœ¨å¯„å­˜å™¨ä¸Šï¼Œè€Œvariable1å’Œvariable2ç´§å¯†ç›¸é‚»ï¼Œè¿™å¯èƒ½å¯¼è‡´å®ƒä»¬ä½äºç¼“å­˜çš„åŒä¸€è¡Œã€‚å› æ­¤ï¼Œå®ƒä»¬æœ‰å¯èƒ½ä¼šåŒæ—¶è¢«å†™å…¥ç¼“å­˜å¹¶ä¸€èµ·å†™å›å†…å­˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§‚å¯Ÿä¸åŒçš„æ•ˆæœï¼Œæˆ‘ä»¬å°è¯•å°†è¿™ä¸¤ä¸ªå˜é‡åˆ†åˆ«æ”¾ç½®åœ¨å †å’Œæ ˆä¸Šã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>0 failures (0.0 percent of the time) in 1.2 seconds
0 failures (0.0 percent of the time) in 1.2 seconds
2000000000 failures (100.0 percent of the time) in 1.2 seconds
&lt;/code>&lt;/pre>&lt;p>&lt;strong>å¤ªæ„Ÿäººäº†ï¼&lt;/strong>&lt;/p>
&lt;h3 id="æˆ‘ä»¬çš„æ•Œäºº--ç¼–è¯‘å™¨">æˆ‘ä»¬çš„æ•Œäºº â€”â€” ç¼–è¯‘å™¨ &lt;a href="#%e6%88%91%e4%bb%ac%e7%9a%84%e6%95%8c%e4%ba%ba--%e7%bc%96%e8%af%91%e5%99%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Multithreading bugs are very delicate.&lt;/p>&lt;/blockquote>
&lt;p>å¹¶è¡Œå¤šçº¿ç¨‹çš„é”™è¯¯æ€»æ˜¯é‚£ä¹ˆçš„å¥‡å¦™ï¼Œä¹Ÿè®¸ä½ çš„ç¨‹åºè¿è¡Œäº†å‡ å¤©å®‰ç„¶æ— æ™ï¼Œä½†æ˜¯åœ¨æŸä¸€å¤©æŸä¸€æ—¶çªç„¶å‡ºç°äº†éš¾ä»¥å¤ç°çš„ç²¾å¦™bugã€‚&lt;/p>
&lt;p>å¦‚æœå¤šä¸ªçº¿ç¨‹è°ƒåº¦åœ¨åŒä¸€ä¸ªCPUæ ¸å¿ƒä¸Šï¼ŒBugä¼šè¢«æ©ç›–ã€‚ &lt;br>
å¦‚æœå¤šä¸ªå˜é‡åœ¨CPUåŒä¸€è¡ŒCacheä¸Šï¼ŒBugä¼šè¢«æ©ç›–ã€‚ &lt;br>
å¦‚æœä½ äººå“è¶³å¤Ÿå¥½çš„è¯ï¼ŒBugåŒæ ·ä¼šè¢«æ©ç›–ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ’é™¤äº†ä»¥ä¸Šçš„æƒ…å†µåï¼Œé—®é¢˜å°±æµ®ç°å‡ºæ¥äº†ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹readerçš„åæ±‡ç¼–ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>(gdb) disas reader
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dump of assembler code &lt;span style="color:#66d9ef">for&lt;/span> function reader(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400950&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> push &lt;span style="color:#f92672">%&lt;/span>rbx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400951&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>eax,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400953&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x10&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>ecx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400958&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x80&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>esi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040095d&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">13&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>ebx,&lt;span style="color:#f92672">%&lt;/span>ebx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040095f&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">15&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> sub &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0xa0&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>rsp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400966&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">22&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#f92672">%&lt;/span>rsp,&lt;span style="color:#f92672">%&lt;/span>rdi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400969&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">25&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#f92672">%&lt;/span>rsp,&lt;span style="color:#f92672">%&lt;/span>rdx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040096c&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">28&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> rep stos &lt;span style="color:#f92672">%&lt;/span>rax,&lt;span style="color:#f92672">%&lt;/span>es:(&lt;span style="color:#f92672">%&lt;/span>rdi)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040096f&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">31&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>edi,&lt;span style="color:#f92672">%&lt;/span>edi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400971&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">33&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> movq &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x4&lt;/span>,(&lt;span style="color:#f92672">%&lt;/span>rsp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400979&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">41&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> callq &lt;span style="color:#ae81ff">0x400790&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>sched_setaffinity&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>plt&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040097e&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> lea &lt;span style="color:#ae81ff">0x80&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>rdi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400986&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">54&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>esi,&lt;span style="color:#f92672">%&lt;/span>esi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400988&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">56&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> callq &lt;span style="color:#ae81ff">0x400710&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>gettimeofday&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>plt&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040098d&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">61&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#ae81ff">0x2006e4&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>rax &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x601078&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>variable2_p&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400994&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">68&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#ae81ff">0x2006e6&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>edx &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x601080&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>variable1&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040099a&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">74&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov (&lt;span style="color:#f92672">%&lt;/span>rax),&lt;span style="color:#f92672">%&lt;/span>ecx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x000000000040099c&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">76&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x77359400&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009a1&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> nopl &lt;span style="color:#ae81ff">0x0&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rax)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009a8&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">88&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cmp &lt;span style="color:#f92672">%&lt;/span>ecx,&lt;span style="color:#f92672">%&lt;/span>edx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009aa&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">90&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> adc &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x0&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>ebx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009ad&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">93&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> sub &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x1&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009b0&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">96&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> jne &lt;span style="color:#ae81ff">0x4009a8&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>reader(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">88&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009b2&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">98&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> lea &lt;span style="color:#ae81ff">0x90&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>rdi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009ba&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">106&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>esi,&lt;span style="color:#f92672">%&lt;/span>esi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009bc&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> callq &lt;span style="color:#ae81ff">0x400710&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>gettimeofday&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>plt&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009c1&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">113&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cvtsi2sdq &lt;span style="color:#ae81ff">0x98&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>xmm0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009cb&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">123&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cvtsi2sdq &lt;span style="color:#ae81ff">0x90&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>xmm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009d5&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">133&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> movsd &lt;span style="color:#ae81ff">0x1a3&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>xmm3 &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x400b80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009dd&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">141&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#f92672">%&lt;/span>ebx,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009df&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">143&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cvtsi2sdq &lt;span style="color:#ae81ff">0x88&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>xmm2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009e9&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">153&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cmp &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x1&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>ebx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009ec&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">156&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x400b3d&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>ecx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009f1&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">161&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x1&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>edi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009f6&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">166&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> divsd &lt;span style="color:#f92672">%&lt;/span>xmm3,&lt;span style="color:#f92672">%&lt;/span>xmm0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009fa&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">170&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#f92672">%&lt;/span>ebx,&lt;span style="color:#f92672">%&lt;/span>edx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x00000000004009fc&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">172&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x400b40&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>esi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a01&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">177&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> divsd &lt;span style="color:#f92672">%&lt;/span>xmm3,&lt;span style="color:#f92672">%&lt;/span>xmm2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a05&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">181&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> addsd &lt;span style="color:#f92672">%&lt;/span>xmm0,&lt;span style="color:#f92672">%&lt;/span>xmm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a09&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">185&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cvtsi2sdq &lt;span style="color:#ae81ff">0x80&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rsp),&lt;span style="color:#f92672">%&lt;/span>xmm0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a13&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">195&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> subsd &lt;span style="color:#f92672">%&lt;/span>xmm0,&lt;span style="color:#f92672">%&lt;/span>xmm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a17&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">199&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cvtsi2sd &lt;span style="color:#f92672">%&lt;/span>rax,&lt;span style="color:#f92672">%&lt;/span>xmm0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a1c&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">204&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x400b3c&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a21&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">209&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cmovne &lt;span style="color:#f92672">%&lt;/span>rax,&lt;span style="color:#f92672">%&lt;/span>rcx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a25&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">213&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x2&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a2a&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">218&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mulsd &lt;span style="color:#ae81ff">0x156&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>xmm0 &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x400b88&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a32&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">226&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> subsd &lt;span style="color:#f92672">%&lt;/span>xmm2,&lt;span style="color:#f92672">%&lt;/span>xmm1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a36&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">230&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> divsd &lt;span style="color:#ae81ff">0x152&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>xmm0 &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x400b90&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a3e&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">238&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> callq &lt;span style="color:#ae81ff">0x400700&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>__printf_chk&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>plt&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a43&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">243&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> xor &lt;span style="color:#f92672">%&lt;/span>edi,&lt;span style="color:#f92672">%&lt;/span>edi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0000000000400a45&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">245&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> callq &lt;span style="color:#ae81ff">0x4006f0&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>exit&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>plt&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€è€Œè¨€ä¹‹ï¼Œå…³é”®åœ¨ä»¥ä¸‹å‡ å¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x000000000040098d&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">61&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#ae81ff">0x2006e4&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>rax &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x601078&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>variable2_p&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x0000000000400994&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">68&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#ae81ff">0x2006e6&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rip),&lt;span style="color:#f92672">%&lt;/span>edx &lt;span style="color:#960050;background-color:#1e0010">#&lt;/span> &lt;span style="color:#ae81ff">0x601080&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>variable1&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x000000000040099a&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">74&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov (&lt;span style="color:#f92672">%&lt;/span>rax),&lt;span style="color:#f92672">%&lt;/span>ecx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x000000000040099c&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">76&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> mov &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x77359400&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x00000000004009a1&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> nopl &lt;span style="color:#ae81ff">0x0&lt;/span>(&lt;span style="color:#f92672">%&lt;/span>rax)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x00000000004009a8&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">88&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> cmp &lt;span style="color:#f92672">%&lt;/span>ecx,&lt;span style="color:#f92672">%&lt;/span>edx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x00000000004009aa&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">90&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> adc &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x0&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>ebx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x00000000004009ad&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">93&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> sub &lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">0x1&lt;/span>,&lt;span style="color:#f92672">%&lt;/span>eax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0x00000000004009b0&lt;/span> &lt;span style="color:#f92672">&amp;lt;+&lt;/span>&lt;span style="color:#ae81ff">96&lt;/span>&lt;span style="color:#f92672">&amp;gt;:&lt;/span> jne &lt;span style="color:#ae81ff">0x4009a8&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>reader(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">88&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¾ªç¯ä½“åœ¨+88ï½+96è¡Œï¼Œè€Œå¯¹variable1ä¸variable2çš„å–å€¼éƒ½æ”¾åœ¨äº†å¾ªç¯ä»¥å¤–ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ³¨ï¼š&lt;br>
adcæ˜¯å¸¦è¿›ä½åŠ æ³•ï¼Œadc $0x0, %ebx =&amp;gt; %ebx = $0x0 + %ebx + CF &lt;br>
cmpçš„ç»“æœæ­£æ˜¯æ”¾åœ¨CFï¼ˆå¤§äºè¡¨ç¤ºä¸ºæº¢å‡ºï¼‰ï¼ŒZFï¼ˆç›¸ç­‰è¡¨ç¤ºä¸º0ï¼‰ï¼ŒPFï¼ˆå°äºè¡¨ç¤ºä¸º-1,åˆ™ä½8ä½å…¨ä¸º1,æ•…æœ‰å¶æ•°ä¸ª1ï¼‰&lt;/p>&lt;/blockquote>
&lt;p>æ­£æ˜¯è¿™ä¸ªâ€œå°æ„å¤–â€ï¼Œå¯¼è‡´äº†æˆ‘ä»¬çš„ç»“æœè¦ä¸æ˜¯100%æ­£ç¡®ï¼Œè¦ä¸æ˜¯100%é”™è¯¯ã€‚&lt;/p>
&lt;h4 id="ä½¿ç”¨volitile">ä½¿ç”¨volitileï¼ˆï¼Ÿï¼‰ &lt;a href="#%e4%bd%bf%e7%94%a8volitile" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">volatile&lt;/span> &lt;span style="color:#66d9ef">unsigned&lt;/span> variable1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">volatile&lt;/span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#f92672">*&lt;/span>variable2_p &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ITERATIONS 500000000LL &lt;/span>&lt;span style="color:#75715e">// è°ƒå°ä¸€ä¸‹æ•°æ®è§„æ¨¡ï¼Œå› ä¸ºvolatileå¤ªæ…¢äº†_(:Ğ·ã€âˆ )_
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘å¾—å‡ºçš„æ¥çš„ç»“æœæ˜¯ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>0 failures (0.0 percent of the time) in 9.6 seconds
&lt;/code>&lt;/pre>&lt;p>è€Œä½œè€…å¾—å‡ºçš„ç»“æœæ˜¯ï¼š
ï¼ˆæ—¶é—´ä¸Šçš„å·®å¼‚ä¸è®¡ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®è§„æ¨¡ä¸ä¸€æ ·ï¼Œæˆ‘å®éªŒçš„æ¬¡æ•°è¦å¤šä¸€äº›ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>fish ) ./a.out
12462711 failures (24.9 percent of the time) in 3.7 seconds
&lt;/code>&lt;/pre>&lt;p>ä»ä½œè€…çš„ç»“æœæ¥çœ‹ï¼Œçœ‹èµ·æ¥æ•ˆæœå¥½äº†å¾ˆå¤šï¼Œè™½ç„¶æ…¢äº†30å¤šå€ï¼Œä½†æ˜¯ç»“æœå¹¶ä¸æ˜¯å…¨å¯¹å…¨é”™äº†ã€‚&lt;/p>
&lt;p>è€Œä»æˆ‘çš„ç»“æœæ¥çœ‹ï¼Œvolatileçœ‹ä¼¼ç¥ä¸¹å¦™è¯ï¼Œè§£å†³äº†æ‰€æœ‰çš„é—®é¢˜ã€‚(both g++ and clang++)&lt;/p>
&lt;p>&lt;strong>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?&lt;/strong>&lt;/p>
&lt;p>å…¶åŸå› åœ¨äºä½“ç³»ç»“æ„çš„å·®å¼‚ã€‚volatileåªèƒ½ä¿è¯å¦‚ä¸‹ä¸¤ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>volatileå˜é‡çš„è®¿é—®ä¸ä¼šä¼˜åŒ–æˆå¯„å­˜å™¨è®¿é—®ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å»è®¿é—®â€œå†…å­˜â€ï¼ˆè¿™ä¸ªå¼•å·ä¸€ä¼šå†è§£é‡Šï¼‰&lt;/li>
&lt;li>volatileå˜é‡é—´çš„è®¿é—®é¡ºåºä¸ä¼šè¢«ç¼–è¯‘å™¨ä¹±åº&lt;/li>
&lt;/ul>
&lt;p>è€Œå…¶ä»–çš„ä¸€åˆ‡ï¼Œvolatileå’Œç¼–è¯‘å™¨éƒ½ä¸ä¼šç»™å‡ºä»»ä½•ä¿è¯ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œä¸åŒçš„CPUéƒ½æœ‰å…¶å†…éƒ¨çš„ç§æœ‰Cacheï¼ŒCPUçš„å†…å­˜è®¿é—®ï¼Œå¦‚æœå‘½ä¸­äº†Cacheï¼Œåˆ™ä¸ä¼šçœŸæ­£çš„è®¿é—®å†…å­˜ã€‚ä½†ç”±äºå…¶ç§æœ‰Cacheå¯¹äºå…¶å®ƒçš„CPUæ˜¯ä¸å¯è§çš„ï¼Œä½¿ç”¨volatileå°±åŸ‹ä¸‹çš„Bugçš„ç§å­ã€‚&lt;/p>
&lt;p>è™½ç„¶åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œç¨‹åºè¿è¡Œçš„å¾ˆå¥½ï¼Œæ²¡æœ‰å‡ºç°Bugã€‚ä½†æ˜¯ï¼Œä¸€æ˜¯ç”±äºå¤šçº¿ç¨‹çš„Bugéƒ½æ˜¯subtleå’Œdelicateçš„ï¼Œæˆ‘ä¸èƒ½ä¿è¯åœ¨ä¸€ä¸ªéœ€è¦7x24å·¥ä½œçš„æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œå®ƒä¸ä¼šå‡ºç°ä»»ä½•Bugï¼›äºŒæ˜¯è‡³å°‘æˆ‘ä»¬çš„ä»£ç æ˜¯** not portable **çš„ï¼Œå¦‚æœæœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬ä»x86-64å¹³å°åˆ‡æ¢åˆ°äº†&lt;code>PowerPC&lt;/code>ï¼Ÿæˆ–æ˜¯&lt;code>IA64&lt;/code>ï¼Ÿæˆ‘ä»¬ä¸èƒ½ä¿è¯åœ¨è¿™äº›ä½“ç³»ç»“æ„ä¸Šï¼Œç¼–è¯‘å™¨å’ŒCPUèƒ½ä¸ºæˆ‘ä»¬æä¾›åŒæ ·çš„ä¿éšœã€‚&lt;/p>
&lt;p>äºæ˜¯æœ‰äººé«˜å£°ç–¾å‘¼ï¼š volatileä¸èƒ½ç”¨æ¥åšä¸ºå¤šçº¿ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼&lt;/p>
&lt;blockquote>
&lt;p>è¡¥å……äº20240317ï¼šåœ¨ä¸€å°è€æ—§çš„å®‰å“æ‰‹æœºä¸Šé‡å¤äº†å®éªŒï¼Œvolatileç¡®å®æ— æ³•æä¾›ç›¸å…³çš„ä¿éšœ&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>~/tmp $ clang++ -O2 a.cc &amp;amp;&amp;amp; ./a.out
99880586 failures (49.9 percent of the time) in 3.0 seconds
&lt;/code>&lt;/pre>&lt;h4 id="å°å¿ƒcpuçš„è¡Œä¸º">å°å¿ƒCPUçš„è¡Œä¸º &lt;a href="#%e5%b0%8f%e5%bf%83cpu%e7%9a%84%e8%a1%8c%e4%b8%ba" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>åœ¨å…ˆå‰çš„å®éªŒä¸­ï¼Œå°½ç®¡ç¨‹åºçš„è¡¨ç°ä¸é¢„æœŸä¸€è‡´ï¼Œä½†æˆ‘ä»¬æ— æ³•ç¡®ä¿CPUå°†å§‹ç»ˆæŒ‰é¡ºåºæ‰§è¡Œä»£ç ã€‚å®é™…ä¸Šï¼ŒCPUå¯èƒ½ä¼šå¯¹æ“ä½œé¡ºåºè¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼Œå°†var1++å’Œvar2++çš„æ‰§è¡Œé¡ºåºè°ƒæ¢ï¼Œè¿™åœ¨å½“å‰ä¸»æµçš„CPUä¸­æ˜¯å¸¸è§çš„åšæ³•ã€‚&lt;/p>
&lt;p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºä¹±åºæ‰§è¡Œä¼šå¯¼è‡´åŠŸè€—å¢åŠ ï¼ŒæŸäº›å¤„ç†å™¨å¦‚ARMå’ŒIntel Atomå·²ç»å–æ¶ˆäº†è¿™ä¸€æœºåˆ¶ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ— æ³•é¢„çŸ¥æœªæ¥ä»£ç å¯èƒ½ä¼šåœ¨å“ªç§ç¡¬ä»¶æ¶æ„ä¸Šè¿è¡Œï¼Œä¾‹å¦‚ARMé›†ç¾¤ï¼Œè¿™éœ€è¦æˆ‘ä»¬ä¿æŒè­¦æƒ•ã€‚&lt;/p>
&lt;h4 id="é¿å…ä½¿ç”¨é”">é¿å…ä½¿ç”¨é” &lt;a href="#%e9%81%bf%e5%85%8d%e4%bd%bf%e7%94%a8%e9%94%81" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡å¼•å…¥äº’æ–¥é”ï¼ˆmutexï¼‰ä¼¼ä¹èƒ½å¤Ÿè§£å†³å¹¶å‘é—®é¢˜ã€‚ç„¶è€Œï¼Œæ ¹æ®ä½œè€…çš„æµ‹è¯•ï¼Œå¼•å…¥äº’æ–¥é”å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºé€Ÿåº¦é™ä½è‡³åŸæ¥çš„1/130ï¼Œè€Œè‡ªæ—‹é”ï¼ˆspinlockï¼‰ä¹Ÿå¯èƒ½ä½¿å¾—é€Ÿåº¦é™ä½è‡³åŸæ¥çš„1/4ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥æš‚ç¼“ï¼Œä»”ç»†è€ƒè™‘ä½œè€…æ¥ä¸‹æ¥çš„å»ºè®®ã€‚&lt;/p>
&lt;h3 id="å†…å­˜å±éšœçš„åº”ç”¨">å†…å­˜å±éšœçš„åº”ç”¨ &lt;a href="#%e5%86%85%e5%ad%98%e5%b1%8f%e9%9a%9c%e7%9a%84%e5%ba%94%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨å¤šCPUç¯å¢ƒä¸­ï¼Œå¤„ç†å™¨å¾€å¾€ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¼šåè°ƒå½¼æ­¤çš„æ“ä½œã€‚&lt;/p>
&lt;p>ç›®å‰ï¼Œæˆ‘ä»¬é¢ä¸´ä¸¤ä¸ªå¹¶ä¸ç†æƒ³çš„è§£å†³æ–¹æ¡ˆï¼šä¸€æ˜¯å°†æ‰€æœ‰çº¿ç¨‹é™åˆ¶åœ¨å•ä¸ªCPUä¸Šè¿è¡Œï¼ŒäºŒæ˜¯é€šè¿‡å¼•å…¥é‡é‡çº§é”æ¥åŒæ­¥æ“ä½œã€‚è¿™äº›æ–¹æ³•éƒ½ä¸å°½äººæ„ï¼Œä¸”æ•ˆç‡ä½ä¸‹ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼Œé€šè¿‡å†…å­˜å±éšœæŠ€æœ¯ï¼Œæš‚æ—¶é˜»æ­¢ç¼–è¯‘å™¨æˆ–CPUå¯¹ç¨‹åºä¸­çš„æ•°æ®è¯»å†™æ“ä½œè¿›è¡Œé‡æ’åºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (;;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> variable1 &lt;span style="color:#f92672">=&lt;/span> variable1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> barrier();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>variable2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">*&lt;/span>variable2 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·æˆ‘ä»¬ä¿è¯äº†ï¼Œåœ¨var1++å¿…ç„¶æ—©äºvar2++ã€‚var2++åé¢ä¹Ÿå¯ä»¥åŠ ä¸€é“barrierï¼Œåªä¸è¿‡åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹ï¼Œæä¾›è¿™ç§ä¿è¯æ˜¯ä¸å¿…é¡»çš„ã€‚&lt;/p>
&lt;p>ä½œè€…åˆåšäº†ä¸€æ¬¡è¯•éªŒã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>fish ) ./a.out
260 failures (0.0 percent of the time) in 0.9 seconds
&lt;/code>&lt;/pre>&lt;p>è¿™æ¬¡ä¸”é”™è¯¯å‡å°‘äº†è®¸å¤šã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å†æŠŠè¯»çº¿ç¨‹å†™åŠ ä¸Šmemory barrier.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (i&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> ITERATIONS; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> v2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">*&lt;/span>variable2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> barrier();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> v1 &lt;span style="color:#f92672">=&lt;/span> variable1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (v2 &lt;span style="color:#f92672">&amp;gt;&lt;/span> v1) failureCount&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹çœ‹ç»“æœï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>fish ) ./a.out
0 failures (0.0 percent of the time) in 4.2 seconds
&lt;/code>&lt;/pre>&lt;p>ç¨‹åºè¡¨ç°å‡ºäº†æ­£ç¡®çš„ç»“æœã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½ å¯¹çº¿ç¨‹Açš„è¯»å†™é¡ºåºåšå‡ºè¦æ±‚ï¼Œå¿…ç„¶çš„ï¼Œä½ ä¹Ÿè¦å¯¹çº¿ç¨‹Bçš„é¡ºåºåšè¦æ±‚ï¼Œä»¥æ­¤ç±»æ¨ï¼Œçº¿ç¨‹Cï¼Œçº¿ç¨‹Dâ€¦â€¦&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;strong>Memory barriers always come in pairs, or triplets or more.&lt;/strong>&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œçº¿ç¨‹é”ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±é”è‡ªå·±æ€»ä¸æ˜¯ä¸€ç§æ„‰å¿«çš„ä½“éªŒï¼ˆç¬‘&lt;/p>
&lt;h3 id="cpuçš„ä¹±åºæ‰§è¡Œ">CPUçš„ä¹±åºæ‰§è¡Œ &lt;a href="#cpu%e7%9a%84%e4%b9%b1%e5%ba%8f%e6%89%a7%e8%a1%8c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°PowerPCæœ‰ä¸‰ç§å†…å­˜å±éšœï¼Œè€ŒDEC Alphaå¹³å°æœ‰æ›´å¤šã€‚è¿™æ„å‘³ç€ï¼ŒCPUä½¿ç”¨æ›´æ¿€è¿›çš„ç­–ç•¥æ¥é‡æ’æŒ‡ä»¤ï¼Œè€Œå¼ºåˆ¶é™åˆ¶å…¶é‡æ’çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚&lt;/p>
&lt;p>è€Œx86å¹³å°åˆ™éå¸¸å®ˆåºï¼Œä½œè€…çŒœæµ‹å…¶åŸå› æ˜¯ç”±äºæ—©æœŸx86çš„æŒ‡ä»¤æŠ€æœ¯å¹¶éå®Œå–„ï¼Œè€Œåœ¨é‚£æ—¶å†…å­˜ä¸CPUçš„é€Ÿåº¦ä¸åƒç°åœ¨è¿™æ ·æ‚¬æ®Šï¼Œæ‰€ä»¥x86ä½¿ç”¨äº†&lt;code>strongly ordered memory&lt;/code>è€Œéåƒä¸Šé¢å‡ æ¬¾CPUä¸€æ ·çš„é‡‡ç”¨è¿‡å¤šçš„æŒ‡ä»¤é‡æ’åºã€‚å¦‚ä»Šï¼Œç”±äºx86èƒŒä¸Šäº†å‘å‰å…¼å®¹æ€§çš„åŒ…è¢±ï¼Œçœ‹ä¼¼æˆ‘ä»¬çš„&amp;quot;å¥½æ—¥å­&amp;quot;ä¸€ç›´ä¸ä¼šç»“æŸã€‚&lt;/p>
&lt;p>x86-64ï¼Œåšä¸ºx86çš„64ä½å‡çº§ç‰ˆï¼ŒåŒæ ·æ²¡æœ‰å®ç°&lt;code>weakly ordered&lt;/code>ï¼Œæˆ–è€…è¯´ï¼Œä¿ç•™äº†å®ç°&lt;code>weakly ordered&lt;/code>çš„æƒåˆ©ã€‚è€Œ&lt;code>IA64&lt;/code>å¹³å°ï¼Œå¦‚&lt;code>Itanium&lt;/code>ï¼Œåˆ™å®ç°äº†&lt;code>weakly ordered&lt;/code>ã€‚&lt;/p>
&lt;p>ä½œè€…çŒœæµ‹x86_64ä¹‹æ‰€ä»¥ä¿å®ˆï¼Œæ˜¯ä¸ºäº†ä¸IA64å¹³å°å¯¹æŠ—ã€‚x86_64çš„å¯¹äºx86è‰¯å¥½çš„å…¼å®¹æ€§å¯ä»¥è®©ç¨‹åºå‘˜å¤šæ´»å‡ å¹´ï¼Œæ‰€ä»¥x86_64åœ¨å¸‚åœºçš„è¡¨ç°æ›´å¥½ã€‚&lt;/p>
&lt;p>ä½œè€…è¿˜è¡¨ç¤ºï¼Œè€Œè‹¹æœæ”¾å¼ƒIA64å¹³å°è½¬æŠ•x86-64å¤šå°‘æœ‰ä¸€äº›å¯æƒœï¼Œå› ä¸ºè‹¹æœå¹¶æ²¡æœ‰ç§»æ¤æ€§é—®é¢˜ï¼ŒPowerPCå·²ç»é€æ¸è¡°è½ï¼Œä¸ºä»€ä¹ˆä¸è¯•è¯•IA64å‘¢ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œæ ¹æ®Wikipediaï¼Œç°åœ¨æ”¯æŒIA64çš„æ“ä½œç³»ç»Ÿéå¸¸å°‘ï¼Œåªæœ‰WinNT Familyï¼ŒRed Hat Linuxï¼ŒDebian/Gentoo/Suseä»¥åŠå…¶å®ƒã€‚è€Œä»Windows Server 2008 R2ä¹‹åï¼ŒMicrosoftä¹Ÿè¡¨ç¤ºä¸å†æ”¯æŒItaniumã€‚æ‰€ä»¥ä»ç°åœ¨çœ‹æ¥ï¼ŒIA64å¹³å°ç›¸å¯¹x86/x64æ¥è¯´ï¼Œæ˜¯å¤±è´¥çš„ã€‚&lt;/p>
&lt;h3 id="åŒé‡æ£€æŸ¥é”">åŒé‡æ£€æŸ¥é” &lt;a href="#%e5%8f%8c%e9%87%8d%e6%a3%80%e6%9f%a5%e9%94%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä¸‹çš„Obj-Cä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-objc" data-lang="objc">&lt;span style="display:flex;">&lt;span>+ &lt;span style="color:#a6e22e">getSharedObject&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">id&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sharedObject &lt;span style="color:#f92672">=&lt;/span> [[self alloc] init];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UNLOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯éå¸¸ç»å…¸çš„ä¸€ç§DCLP(Double Checked Lock Pattern)çš„å®ç°ã€‚&lt;/p>
&lt;p>è¿™ä¸ªçœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä½ å·²ç»çŸ¥é“è¿™å¹¶ä¸é è°±äº†ã€‚å½“æˆ‘ä»¬åˆå§‹åŒ–æˆ‘ä»¬çš„å…±äº«å•ä¾‹ï¼Œå…ˆè¦å†ä¿®æ”¹ç±»å†…çš„æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ä¸€å—å£°æ˜å¥½çš„å†…å­˜ï¼Œå†åˆå§‹åŒ–ä¸€ä¸ªsharedObjectçš„instanceã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œä½ æ˜¯çŸ¥é“çš„ï¼ŒCPUå’Œç¼–è¯‘å™¨ä¼šæŠŠä¸€åˆ‡éƒ½æç ¸ï¼Œå®ƒä»¬ä¼šä»¥ä»»æ„çš„é¡ºåºæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ï¼ŒåŒæ—¶å¤„ç†å™¨ä¹‹é—´äº’ç›¸ä¸é€šæ°”ï¼Œäºæ˜¯å°±ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š&lt;/p>
&lt;p>çº¿ç¨‹Aä¸ºæŒ‡é’ˆå£°æ˜äº†ä¸€æ®µç©ºé—´ï¼Œä½†æ˜¯è¿˜æ²¡æ¥åŠåˆå§‹åŒ–è¿™ä¸ªinstanceï¼Œçº¿ç¨‹Aå°±è¢«æŒ‚èµ·äº†ã€‚&lt;/p>
&lt;p>ä¹‹åçº¿ç¨‹Bæ¥ç®¡ä¸€åˆ‡ï¼Œå‘ç°æŒ‡é’ˆæœ‰å€¼ï¼Œç»“æœå› ä¸ºè®¿é—®äº†é‡æŒ‡é’ˆå¯¼è‡´ç¨‹åºæŒ‚æ‰ã€‚&lt;/p>
&lt;p>ä¸è¿‡æ ¹æ®ä¸Šé¢çš„æ–‡ç« ï¼Œä½ ä»¬åº”è¯¥çŸ¥é“æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜äº† â€”â€” è¯•è¯•å†…å­˜å±éšœï¼&lt;/p>
&lt;p>p.s. å¦‚æœå¤§å®¶å¯¹obj-cä¸ç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥çœ‹æˆ‘å¦å¤–ä¸€ç¯‡æ–‡ç« ã€‚é‚£ç¯‡æ–‡ç« æ˜¯å…³äºScott Meyerså¤§ç¥å†™çš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸“é—¨ç”¨æ¥è®¨è®ºDCLPé—®é¢˜çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-objc" data-lang="objc">&lt;span style="display:flex;">&lt;span>+ &lt;span style="color:#a6e22e">getSharedObject&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">id&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">id&lt;/span> temp &lt;span style="color:#f92672">=&lt;/span> [[self alloc] init];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OSMemoryBarrier();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sharedObject &lt;span style="color:#f92672">=&lt;/span> temp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UNLOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OSMemoryBarrier();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œåœ¨ã€ŠC++ and the Perils of Double-Checked Lockingã€‹ä¸€æ–‡ä¸­ï¼ŒScott Meyerså’ŒAndrei Alexandrescuç»™å‡ºçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>Singleton&lt;span style="color:#f92672">*&lt;/span> Singleton&lt;span style="color:#f92672">::&lt;/span>instance () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Singleton&lt;span style="color:#f92672">*&lt;/span> tmp &lt;span style="color:#f92672">=&lt;/span> pInstance;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// insert memory barrier
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// clear the cache to flush ``pInstance``
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// prevents &amp;#34;downwards migration&amp;#34; of Singletonâ€™s construction (by another thread);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (tmp &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Lock lock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tmp &lt;span style="color:#f92672">=&lt;/span> pInstance;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (tmp &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tmp &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Singleton;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// insert memory barrier
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// prevent optimistic that eliminate the temporary variable ``tmp``
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// prevents &amp;#34;upwards migration&amp;#34; of pInstanceâ€™s initialization
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> pInstance &lt;span style="color:#f92672">=&lt;/span> tmp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> tmp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„memory barrieræ’å…¥çš„ä½ç½®ä¸åŒã€‚ä½†æ˜¯éƒ½ä¸èƒ½è¯´æ˜¯é”™çš„ã€‚å› ä¸ºä¸€ä¸ªæ˜¯ä¼ static instanceï¼Œä¸€ä¸ªæ˜¯ä¼ pointerã€‚&lt;/p>
&lt;p>å…¶å®è¿˜æœ‰æ›´â€œæš´åŠ›â€çš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>ç›´æ¥æ¥ä¸€æŠŠå¤§é”ï¼Œå“å½“æŠŠæ•´ä¸ªå‡½æ•°é”èµ·æ¥ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹å†…ä¿ç•™ä¸€ä¸ª&lt;strong>æœ¬çº¿ç¨‹ä¸“å±&lt;/strong>æŒ‡å‘å•ä¾‹çš„æŒ‡é’ˆï¼ˆåšcacheï¼‰ã€‚è¿™æ ·Nä¸ªçº¿ç¨‹åªéœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°Næ¬¡ï¼Œçº¿ç¨‹ç«äº‰ä¹Ÿç›¸å¯¹å°‘å¾ˆå¤šã€‚å¹¶ä¸”æ ¹æ®Linuxä¸‹çš„futexæŠ€æœ¯ï¼Œæ— ç«äº‰ä¸‹çš„é”ç›¸å¯¹èŠ‚çœäº†ä¸å°‘èµ„æºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>Singleton&lt;span style="color:#f92672">*&lt;/span> Singleton&lt;span style="color:#f92672">::&lt;/span>instance() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Lock lock;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(pInstance &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pInstance &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Singleton;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> pInstance;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¹ˆåšå—">æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¹ˆåšå— &lt;a href="#%e6%88%91%e4%bb%ac%e7%9c%9f%e7%9a%84%e9%9c%80%e8%a6%81%e8%bf%99%e4%b9%88%e5%81%9a%e5%90%97" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢çš„obj-cä»£ç ä¸­ï¼Œä¿è¯åŒé‡æ£€æŸ¥é”æ­£ç¡®çš„ï¼Œå…¶å®æ˜¯ç¬¬äºŒä¸ªå†…å­˜å±éšœã€‚ä½†æ˜¯ï¼Œåœ¨é‚£é‡Œï¼Œæˆ‘ä»¬éœ€è¦çš„å…¶å®æ˜¯ä¸€ä¸ª&amp;quot;data dependency barrier&amp;quot;ã€‚&lt;/p>
&lt;p>Linuxå†…æ ¸ä¸­ç»™å‡ºå¾ˆå¤šç»è¿‡ç²¾å¿ƒä¼˜åŒ–çš„å†…å­˜å±éšœï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œè¦åœ¨ä½¿ç”¨çš„æ—¶å€™å†™å¥½æ³¨é‡Šï¼Œä¸€æ˜¯ä¸ºäº†æœªæ¥çš„éªŒè¯ï¼ŒäºŒæ˜¯ä¸ºäº†è®°å½•è‡ªå·±å½“æ—¶çš„æ€è·¯ã€‚&lt;/p>
&lt;p>æ¯•ç«Ÿå¤šçº¿ç¨‹çš„æ“ä½œè¦å°å¿ƒå†å°å¿ƒï¼Œæˆ‘ä»¬éœ€è¦å……è¶³çš„ç†ç”±ï¼Œæ›´å¤šçš„å°å¿ƒæ¥åº”å¯¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-obj-c" data-lang="obj-c">&lt;span style="display:flex;">&lt;span>+ &lt;span style="color:#a6e22e">getSharedObject&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">id&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span> sharedObject) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">id&lt;/span> temp &lt;span style="color:#f92672">=&lt;/span> [[self alloc] init];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OSMemoryBarrier();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sharedObject &lt;span style="color:#f92672">=&lt;/span> temp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UNLOCK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* data dependency memory barrier here */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sharedObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¸€åˆ‡éƒ½ç»“æŸäº†å—">ä¸€åˆ‡éƒ½ç»“æŸäº†å—ï¼Ÿ &lt;a href="#%e4%b8%80%e5%88%87%e9%83%bd%e7%bb%93%e6%9d%9f%e4%ba%86%e5%90%97" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ˜¯çš„ã€‚ä¸è¿‡è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å§ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/barrier_tank.png" alt="Mutex Tank">&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å™¨å’Œç¼–è¯‘å™¨å¹¶ä¸èƒ½å……åˆ†ä¿è¯ä»£ç æ‰§è¡Œçš„é¡ºåºï¼Œå®ƒä»¬ä¼šæŠŠä½ çš„ä»£ç åˆ°å¤„ç§»åŠ¨ã€‚æ‰€ä»¥&lt;strong>Be warned and wary!&lt;/strong>&lt;/li>
&lt;li>å¤šçº¿ç¨‹çš„é”™è¯¯æ˜¯éå¸¸subtleå’Œdelicateçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾è®¾è®¡æµ‹è¯•ç”¨ä¾‹&lt;/li>
&lt;li>å› æ­¤ï¼Œåˆ«æŒ‡è´£QAäº†ï¼Œä»–ä»¬ä¹Ÿä¸æ˜¯æ•…æ„çš„ã€‚RDè¦å¯¹è‡ªå·±çš„ä»£ç è´Ÿè´£&lt;/li>
&lt;li>é”å¾ˆå®‰å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆé‡&lt;/li>
&lt;li>å†…å­˜å±éšœæ˜¯ä¸€ç§æ›´å¿«çš„ï¼Œä¸é˜»å¡çš„ï¼Œä¸ä¼šæ­»é”çš„ä¸€ç§é”çš„æ›¿ä»£ç‰©ã€‚å®ƒä»¬æ€»è¦èŠ±è´¹æ›´å¤šçš„å¿ƒæ€ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯åˆ°å¤„å¯ç”¨çš„é“¶å¼¹ã€‚ä½†æ˜¯å®ƒç¡®å®å¾ˆå¿«ï¼Œæœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§ã€‚&lt;/li>
&lt;li>å†…å­˜å±éšœå¾€å¾€æ˜¯æˆå¯¹å‡ºç°çš„ã€‚äº†è§£ç¬¬äºŒä¸ªå†…å­˜å±éšœè¦å‡ºç°åœ¨å“ªé‡Œï¼Œæœ‰åŠ©äºä½ ç†è§£ä½ çš„ä»£ç ï¼Œå³ä½¿ä½ æ‰€ä½¿ç”¨çš„ä½“ç³»ç»“æ„ä¸éœ€è¦ç¬¬äºŒä¸ªå†…å­˜å±éšœã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯» &lt;a href="#%e6%89%a9%e5%b1%95%e9%98%85%e8%af%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://www.kernel.org/doc/Documentation/memory-barriers.txt">LINUX KERNEL MEMORY BARRIERS&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.17.8112">Memory Consistency and Event Ordering in Scalable Shared-Memory Multiprocessors&lt;/a>&lt;/p></description></item><item><title>Codeforces Round #242 (Div. 2) Tutorials and Solutions</title><link>https://wizmann.top/posts/cf-242-div-2/</link><pubDate>Wed, 30 Apr 2014 17:39:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-242-div-2/</guid><description>&lt;h2 id="a-squats">A. Squats &lt;a href="#a-squats" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Trun &lt;code>x =&amp;gt; X&lt;/code> or &lt;code>X =&amp;gt; x&lt;/code> to make the number of &amp;lsquo;x&amp;rsquo; is equal to the number of &amp;lsquo;X&amp;rsquo;.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hamsters &lt;span style="color:#f92672">=&lt;/span> [c &lt;span style="color:#66d9ef">for&lt;/span> c &lt;span style="color:#f92672">in&lt;/span> raw_input()]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sits &lt;span style="color:#f92672">=&lt;/span> hamsters&lt;span style="color:#f92672">.&lt;/span>count(&lt;span style="color:#e6db74">&amp;#39;x&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stands &lt;span style="color:#f92672">=&lt;/span> hamsters&lt;span style="color:#f92672">.&lt;/span>count(&lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> sits &lt;span style="color:#f92672">==&lt;/span> stands:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(hamsters)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> sits &lt;span style="color:#f92672">&amp;gt;&lt;/span> stands:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> sits &lt;span style="color:#f92672">-&lt;/span> n&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> key &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;x&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">=&lt;/span> stands &lt;span style="color:#f92672">-&lt;/span> n&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> key &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print num
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i, c &lt;span style="color:#f92672">in&lt;/span> enumerate(hamsters):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> c &lt;span style="color:#f92672">==&lt;/span> key:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hamsters[i] &lt;span style="color:#f92672">=&lt;/span> c&lt;span style="color:#f92672">.&lt;/span>swapcase()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> num &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> num:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(hamsters)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-megacity">B. Megacity &lt;a href="#b-megacity" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Binary search.&lt;/p>
&lt;p>Find the minimal radius of the circle to contain as many city as we need to form a &lt;strong>megacity&lt;/strong>. But beware that you may get wrong answer if you take the lower bound of the binary search, and the answer may not exist if there no way to make a &lt;strong>megacity&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> math
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Point&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self, x, y, v):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>x &lt;span style="color:#f92672">=&lt;/span> x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>y &lt;span style="color:#f92672">=&lt;/span> y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>v &lt;span style="color:#f92672">=&lt;/span> v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">distance&lt;/span>(a, b):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> math&lt;span style="color:#f92672">.&lt;/span>sqrt((a&lt;span style="color:#f92672">.&lt;/span>x &lt;span style="color:#f92672">-&lt;/span> b&lt;span style="color:#f92672">.&lt;/span>x) &lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> (a&lt;span style="color:#f92672">.&lt;/span>y &lt;span style="color:#f92672">-&lt;/span> b&lt;span style="color:#f92672">.&lt;/span>y) &lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">megacity&lt;/span>(r, cities, v):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> u &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000000&lt;/span> &lt;span style="color:#f92672">-&lt;/span> v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rem &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> city &lt;span style="color:#f92672">in&lt;/span> cities:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> distance(Point(&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>), city) &lt;span style="color:#f92672">&amp;lt;=&lt;/span> r:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rem &lt;span style="color:#f92672">+=&lt;/span> city&lt;span style="color:#f92672">.&lt;/span>v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> rem &lt;span style="color:#f92672">&amp;gt;=&lt;/span> u
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>n, v &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cities &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (x, y, p) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cities&lt;span style="color:#f92672">.&lt;/span>append(Point(x, y, p))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>left, right &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">2e6&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">while&lt;/span> abs(left &lt;span style="color:#f92672">-&lt;/span> right) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1e-7&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mid &lt;span style="color:#f92672">=&lt;/span> (left &lt;span style="color:#f92672">+&lt;/span> right) &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#print mid&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> megacity(mid, cities, v):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right &lt;span style="color:#f92672">=&lt;/span> mid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> left &lt;span style="color:#f92672">=&lt;/span> mid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> megacity(right, cities, v):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print right
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-magic-formulas">C. Magic Formulas &lt;a href="#c-magic-formulas" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/Magic-Formula.png" alt="Magic Formula">&lt;/p>
&lt;pre tabindex="0">&lt;code>U = reduce(xor, p[1...n])
V[i] = reduce(xor, map(j % i, [for j in 1...n]))
Q = U ^ reduce(xor, V[1...n])
&lt;/code>&lt;/pre>&lt;p>First of all, we can easily get the value of &lt;code>U&lt;/code>.&lt;/p>
&lt;p>Secondly, as &lt;code>n&lt;/code> is up to &lt;code>1e6&lt;/code>. We have to reduce the calculation and the method will shown by code.&lt;/p>
&lt;p>At last, we xor them all together to get the final result.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000010&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> xorsum[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sum &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xorsum[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sum &lt;span style="color:#f92672">^=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xorsum[i] &lt;span style="color:#f92672">=&lt;/span> sum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> n, Q &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Q &lt;span style="color:#f92672">^=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> div &lt;span style="color:#f92672">=&lt;/span> (n &lt;span style="color:#f92672">/&lt;/span> i) &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> rem &lt;span style="color:#f92672">=&lt;/span> n &lt;span style="color:#f92672">%&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (div) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Q &lt;span style="color:#f92672">^=&lt;/span> xorsum[i&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Q &lt;span style="color:#f92672">^=&lt;/span> xorsum[rem];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(Q);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-biathlon-track">D. Biathlon Track &lt;a href="#d-biathlon-track" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Binary search again.&lt;/p>
&lt;p>I calculate the wrong time complexity and get many &lt;code>TLE&lt;/code>s using brute force algorithm.&lt;/p>
&lt;p>The idea is to fix the left-up point A, &lt;code>(ax, ay)&lt;/code>, and fix the y-axis of the right-buttom point B, &lt;code>(bx, by)&lt;/code>. And then, using binary search to get the x-axis of the B to get the nearest cost (aka &amp;ldquo;distance covering time&amp;rdquo;) to the desired time &lt;code>t&lt;/code>.&lt;/p>
&lt;p>The time complexity is &lt;code>O(logn * n^3)&lt;/code>. A bad ass code is below.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">301&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> DIRS &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> INF &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">29&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m, t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> tp, tu, td;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">enum&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> NORTH, EAST, SOUTH, WEST
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> land[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> costxy[&lt;span style="color:#ae81ff">4&lt;/span>][SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">move&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> now, &lt;span style="color:#66d9ef">int&lt;/span> next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (now &lt;span style="color:#f92672">&amp;gt;&lt;/span> next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> td;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (now &lt;span style="color:#f92672">==&lt;/span> next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> tp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> tu;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">count_time&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; j &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> costxy[NORTH][j][i] &lt;span style="color:#f92672">=&lt;/span> costxy[NORTH][j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][i] &lt;span style="color:#f92672">+&lt;/span> move(land[j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][i], land[j][i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> costxy[SOUTH][j][i] &lt;span style="color:#f92672">=&lt;/span> costxy[SOUTH][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][i] &lt;span style="color:#f92672">+&lt;/span> move(land[j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>][i], land[j][i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> costxy[EAST][i][j] &lt;span style="color:#f92672">=&lt;/span> costxy[EAST][i][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> move(land[i][j &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>], land[i][j]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> costxy[WEST][i][j] &lt;span style="color:#f92672">=&lt;/span> costxy[WEST][i][j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> move(land[i][j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>], land[i][j]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_cost&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> ay, &lt;span style="color:#66d9ef">int&lt;/span> ax, &lt;span style="color:#66d9ef">int&lt;/span> by, &lt;span style="color:#66d9ef">int&lt;/span> bx)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cost &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cost &lt;span style="color:#f92672">+=&lt;/span> costxy[NORTH][ay][ax] &lt;span style="color:#f92672">-&lt;/span> costxy[NORTH][by][ax];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cost &lt;span style="color:#f92672">+=&lt;/span> costxy[SOUTH][by][bx] &lt;span style="color:#f92672">-&lt;/span> costxy[SOUTH][ay][bx];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cost &lt;span style="color:#f92672">+=&lt;/span> costxy[EAST][ay][bx] &lt;span style="color:#f92672">-&lt;/span> costxy[EAST][ay][ax];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cost &lt;span style="color:#f92672">+=&lt;/span> costxy[WEST][by][ax] &lt;span style="color:#f92672">-&lt;/span> costxy[WEST][by][bx];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> cost;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d%d%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>n, &lt;span style="color:#f92672">&amp;amp;&lt;/span>m, &lt;span style="color:#f92672">&amp;amp;&lt;/span>t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d%d%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>tp, &lt;span style="color:#f92672">&amp;amp;&lt;/span>tu, &lt;span style="color:#f92672">&amp;amp;&lt;/span>td);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, &lt;span style="color:#f92672">&amp;amp;&lt;/span>land[i][j]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> count_time();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>INF;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> rsax, rsay, rsbx, rsby;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> ay &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; ay &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; ay&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> ax &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; ax &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; ax&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> by &lt;span style="color:#f92672">=&lt;/span> ay &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; by &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; by&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> lbx &lt;span style="color:#f92672">=&lt;/span> ax &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>, rbx &lt;span style="color:#f92672">=&lt;/span> m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> lbx, step &lt;span style="color:#f92672">=&lt;/span> rbx &lt;span style="color:#f92672">-&lt;/span> lbx;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (step &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> half &lt;span style="color:#f92672">=&lt;/span> step &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> mid &lt;span style="color:#f92672">=&lt;/span> now &lt;span style="color:#f92672">+&lt;/span> half;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cost &lt;span style="color:#f92672">=&lt;/span> get_cost(ay, ax, by, mid);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cost &lt;span style="color:#f92672">&amp;gt;=&lt;/span> t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">=&lt;/span> half;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now &lt;span style="color:#f92672">=&lt;/span> mid &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">=&lt;/span> step &lt;span style="color:#f92672">-&lt;/span> half &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> bx &lt;span style="color:#f92672">=&lt;/span> now &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>; bx &lt;span style="color:#f92672">&amp;lt;=&lt;/span> now &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>; bx&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (bx &lt;span style="color:#f92672">&amp;lt;&lt;/span> lbx &lt;span style="color:#f92672">||&lt;/span> bx &lt;span style="color:#f92672">&amp;gt;&lt;/span> rbx) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cost &lt;span style="color:#f92672">=&lt;/span> get_cost(ay, ax, by, bx);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// printf(&amp;#34;%d %d %d %d =&amp;gt; %d\n&amp;#34;, ay, ax, by, bx, cost);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (abs(cost &lt;span style="color:#f92672">-&lt;/span> t) &lt;span style="color:#f92672">&amp;lt;&lt;/span> abs(ans &lt;span style="color:#f92672">-&lt;/span> t)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> cost;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//print(ans);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> rsax &lt;span style="color:#f92672">=&lt;/span> ax; rsay &lt;span style="color:#f92672">=&lt;/span> ay; rsbx &lt;span style="color:#f92672">=&lt;/span> bx; rsby &lt;span style="color:#f92672">=&lt;/span> by;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//printf(&amp;#34;%d %d %d %d\n&amp;#34;, rsay + 1, rsax + 1, rsby + 1, rsbx + 1);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d %d %d %d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, rsay &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, rsax &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, rsby &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, rsbx &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Codeforces Round #240 (Div. 2) Tutorials and Solutions(incomplete and incorrect)</title><link>https://wizmann.top/posts/cf-240-div-2/</link><pubDate>Tue, 08 Apr 2014 14:39:11 +0000</pubDate><guid>https://wizmann.top/posts/cf-240-div-2/</guid><description>&lt;h2 id="overview">Overview &lt;a href="#overview" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>It has been months that I didn&amp;rsquo;t participate in the contest on CF, now I&amp;rsquo;m back. :)&lt;/p>
&lt;p>This round of contest makes me confused that the problem B and C is a little bit too twisted, if you can&amp;rsquo;t catch the vital point, you will get a lot of WAs in the end.&lt;/p>
&lt;p>Additionally, the problem D is too easy, just a simple DP and the time limit is too long for an unoptimized solution.&lt;/p>
&lt;p>And as usual, I have no idea to the problem E. :(&lt;/p>
&lt;h2 id="a-mashmokh-and-lights">A. Mashmokh and Lights &lt;a href="#a-mashmokh-and-lights" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The description is too long for a problem A, but it is as easy as it used to be.&lt;/p>
&lt;p>Just decalre an array to keep the records of who is the first to turn off the light.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>(n, m) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>bs &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ts &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> b &lt;span style="color:#f92672">in&lt;/span> bs:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(b, n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> ts[i]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ts[i] &lt;span style="color:#f92672">=&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, ts[&lt;span style="color:#ae81ff">1&lt;/span>:]))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-mashmokh-and-tokens">B. Mashmokh and Tokens &lt;a href="#b-mashmokh-and-tokens" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>It is quite confused that Mashmokh just save the tokens for NOTHING?! I took it for granted that Mashmokh should save all the extra token for a final exchange. But I was wrong. The problem just asks for how many tokens is useless for the tokens-salary exchange everyday.&lt;/p>
&lt;p>Uh, so sad. If I was Mashmokh, I just give all my tokens to my boss as the saved tokens would never counts.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n, a, b &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ts &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> t &lt;span style="color:#f92672">in&lt;/span> ts:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (t &lt;span style="color:#f92672">*&lt;/span> a) &lt;span style="color:#f92672">%&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print c &lt;span style="color:#f92672">/&lt;/span> a,
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-mashmokh-and-numbers">C. Mashmokh and Numbers &lt;a href="#c-mashmokh-and-numbers" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>You need a full-time QA for this problem because some of the scenarios will lead to hours of debuging. :(&lt;/p>
&lt;p>The thought of the problem is easy enough, just print two numbers with the gcd equal to &lt;code>g&lt;/code> and a sequence of squential numbers with m pairs that each pair has a gcd equals to &lt;code>1&lt;/code>. At last, just make sure that &lt;code>g + m == k&lt;/code>.&lt;/p>
&lt;p>However, there are some &lt;strong>special&lt;/strong> test cases.&lt;/p>
&lt;p>n = 1, k = 0.
You can pass this case if you print any positive number.&lt;/p>
&lt;p>n = 1, k - (n / 2) + 1 &amp;lt;= 0.
It will lead to &amp;ldquo;-1&amp;rdquo;.&lt;/p>
&lt;p>And the scenarios that the n is odd.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n, k &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>m &lt;span style="color:#f92672">=&lt;/span> n &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>t &lt;span style="color:#f92672">=&lt;/span> k &lt;span style="color:#f92672">-&lt;/span> (m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> n &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">and&lt;/span> k &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#ae81ff">19&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">elif&lt;/span> n &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">or&lt;/span> t &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print t, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">*&lt;/span> t,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> idx &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(m):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a, b &lt;span style="color:#f92672">=&lt;/span> idx, idx &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> idx &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> [a, b] &lt;span style="color:#f92672">!=&lt;/span> [t, &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">*&lt;/span> t]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> n &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print a,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print a, b,
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-mashmokh-and-acm">D. Mashmokh and ACM &lt;a href="#d-mashmokh-and-acm" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>A simple DP problem. The formula is quite easy.&lt;/p>
&lt;pre tabindex="0">&lt;code>dp[k][i] = sum(dp[a0][i - 1] + dp[a1][i - 1] ... dp[ai][i - 1])
(k % ai == 0)
&lt;/code>&lt;/pre>&lt;p>The time complexity is &lt;code>m * n * (1 + 1/2 + 1/3 + ... 1/n)&lt;/code>, and the sum of series &lt;code>1 + 1/2 + ...&lt;/code> is called harmonic number of n which approximately equals to &lt;code>ln(n)&lt;/code>. So the final time complexity is &lt;code>m * n * ln(n)&lt;/code>.&lt;/p>
&lt;p>Further, we can reuse the space of dp array to gain a better CPU cache optimizism.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;ctime&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout&amp;lt;&amp;lt;x&amp;lt;&amp;lt;endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin&amp;gt;&amp;gt;x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2048&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> llint MOD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000000007LL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint dp[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(dp, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(dp));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[i][&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">*&lt;/span> k &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; k&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[j &lt;span style="color:#f92672">*&lt;/span> k][i] &lt;span style="color:#f92672">+=&lt;/span> dp[j][i &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dp[j &lt;span style="color:#f92672">*&lt;/span> k][i] &lt;span style="color:#f92672">%=&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> dp[i][m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">%=&lt;/span> MOD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print (ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>alloca vs placement new</title><link>https://wizmann.top/posts/alloca-vs-placement-new/</link><pubDate>Mon, 07 Apr 2014 21:08:59 +0000</pubDate><guid>https://wizmann.top/posts/alloca-vs-placement-new/</guid><description>&lt;h2 id="what">WHAT?! &lt;a href="#what" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>For most time, we use &lt;code>malloc&lt;/code> or &lt;code>new&lt;/code> for memory allocation, which will get it on &lt;em>heap&lt;/em>.&lt;/p>
&lt;p>However, access memory on &lt;em>heap&lt;/em> is not as effective as the memory on &lt;em>stack&lt;/em>, because the heap is &amp;ldquo;free-floating region of memory&amp;rdquo;. To the contrary, memory on &lt;em>stack&lt;/em> is managed by CPU automacitally and tightly. As a result, the further of the &lt;em>stack&lt;/em> compared to &lt;em>heap&lt;/em> is that we can have a faster read/write speed due to the fact that &lt;em>stack&lt;/em> memory is more likely to optimized by &lt;strong>CPU cache&lt;/strong>, in addition, it only uses a single instruction to allocate or deallocate &lt;em>stack&lt;/em> memory. Just like this.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>sub esp, &lt;span style="color:#ae81ff">0x10&lt;/span>; &lt;span style="color:#f92672">=&amp;gt;&lt;/span> allocate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>add esp, &lt;span style="color:#ae81ff">0x10&lt;/span>; &lt;span style="color:#f92672">=&amp;gt;&lt;/span> deallocate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="alloca">alloca &lt;a href="#alloca" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The &lt;code>alloca()&lt;/code> function allocates memory from the &lt;em>stack&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)alloca(&lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> size);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s quite the same as the &lt;code>malloc&lt;/code> way. But we shouldn&amp;rsquo;t free the memory allocated on the &lt;em>stack&lt;/em>; these memory will be automatically deallocated when you leave the function(&lt;strong>not the code block&lt;/strong>).&lt;/p>
&lt;h2 id="placement-new">placement new &lt;a href="#placement-new" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>The placement new is one of the overloads of the &lt;code>new&lt;/code> functions; this new syntax can do something as the &lt;code>alloca()&lt;/code> function.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> buffer[&lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span>(buffer) &lt;span style="color:#66d9ef">int&lt;/span>[&lt;span style="color:#ae81ff">64&lt;/span>];
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The placement new can be also used in some other scenarios but won&amp;rsquo;t be mentioned here.&lt;/p>
&lt;h2 id="variable-length-array">variable-length array &lt;a href="#variable-length-array" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>C90 and C++ both support the variable-length array which will be allocated on &lt;em>stack&lt;/em>, and it will be deallocted whhen you leave the &lt;strong>clode block&lt;/strong>, such as &amp;ldquo;if&amp;rdquo;, &amp;ldquo;while&amp;rdquo;, etc.&lt;/p>
&lt;p>This is much simplified, but be ware if you use both variable-length array and &lt;code>alloca()&lt;/code> in the same function, the deallocation of the array will also free anything more recenly allocated by alloca.&lt;/p>
&lt;h2 id="defects">Defects &lt;a href="#defects" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;em>Stack&lt;/em> has its limitation. If the allocation on &lt;em>stack&lt;/em> causes &lt;strong>stack overflow&lt;/strong> error, then the behavior of the program is undefined.&lt;/p>
&lt;p>Further, the variable-length array and &lt;code>alloca()&lt;/code> are not included in &lt;em>ANSI-C&lt;/em> standard and therefore could limit portability.&lt;/p>
&lt;p>The Google C++ style guide encourage developers to use &lt;code>scoped_ptr&lt;/code> or &lt;code>scopted_array&lt;/code> instead of variable-length array and &lt;code>alloca()&lt;/code>.&lt;/p>
&lt;h2 id="some-experiment">Some experiment &lt;a href="#some-experiment" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// compile with: g++ -std=c++0x -O2 -Wall -g -o &amp;#34;foo.cc&amp;#34; &amp;#34;foo&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#if defined(__i386__)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">static&lt;/span> __inline__ &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#a6e22e">rdtsc&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> __asm__ &lt;span style="color:#66d9ef">volatile&lt;/span> (&lt;span style="color:#e6db74">&amp;#34;.byte 0x0f, 0x31&amp;#34;&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;=A&amp;#34;&lt;/span> (x));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#elif defined(__x86_64__)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">static&lt;/span> __inline__ &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#a6e22e">rdtsc&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> hi, lo;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> __asm__ __volatile__ (&lt;span style="color:#e6db74">&amp;#34;rdtsc&amp;#34;&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;=a&amp;#34;&lt;/span>(lo), &lt;span style="color:#e6db74">&amp;#34;=d&amp;#34;&lt;/span>(hi));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ( (&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span>)lo)&lt;span style="color:#f92672">|&lt;/span>( ((&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span>)hi)&lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span> );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//#define MEMORY_ON_HEAP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//#define MEMORY_ON_STACK
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">102400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#f92672">*&lt;/span>array[SIZE] &lt;span style="color:#f92672">=&lt;/span> {NULL};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> start &lt;span style="color:#f92672">=&lt;/span> rdtsc();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#ifdef MEMORY_ON_HEAP &lt;/span>&lt;span style="color:#75715e">// RDSTC: 20586280
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array[i] &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)malloc(&lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>array[i] &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#ifdef MEMORY_ON_STACK &lt;/span>&lt;span style="color:#75715e">// RDSTC: 3660502
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array[i] &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)alloca(&lt;span style="color:#66d9ef">sizeof&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>array[i] &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> end &lt;span style="color:#f92672">=&lt;/span> rdtsc();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(end &lt;span style="color:#f92672">-&lt;/span> start);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can use &lt;code>info register esp&lt;/code> in gdb to inspect the &lt;em>stack&lt;/em> pointer before and after you call the allocation function or declare a variable-length array.&lt;/p></description></item><item><title>Quartile and Normal Distribution</title><link>https://wizmann.top/posts/quartile-and-normal-distribution/</link><pubDate>Sun, 09 Mar 2014 22:44:15 +0000</pubDate><guid>https://wizmann.top/posts/quartile-and-normal-distribution/</guid><description>&lt;h2 id="what-is-quartile">What is Quartile? &lt;a href="#what-is-quartile" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Quartile is a concept of descriptive statics. The quartiles of a ranked data set are the three points that divide the data set into four equal groups, each group comprising a quarter of data.&lt;/p>
&lt;h2 id="definitions">Definitions &lt;a href="#definitions" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="first-quartile-q1">first quartile (Q1) &lt;a href="#first-quartile-q1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>First quartile, also known as lower quartile, splits off the lowest 25% of data.&lt;/p>
&lt;h3 id="second-quartile-q2">second quartile (Q2) &lt;a href="#second-quartile-q2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Second quartile is the median of the data set, cuts data set in half.&lt;/p>
&lt;h3 id="third-quartile-q3">third quartile (Q3) &lt;a href="#third-quartile-q3" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Third quartile, known as upper quartile, splits off the highest 25% data.&lt;/p>
&lt;p>The different between &lt;em>Q1&lt;/em> and &lt;em>Q3&lt;/em> is called the InterQuartile Range(IQR).&lt;/p>
&lt;h2 id="box-and-whisker-plot-and-quartile">Box-and-Whisker-plot and Quartile &lt;a href="#box-and-whisker-plot-and-quartile" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>A box-and-whisker-plot is a convenient way of graphically depicting groups of numerical data through their quartiles.&lt;/p>
&lt;p>The buttom and top of the box is always Q1 and Q3, and the band in the box is always Q2(the median). And the ends of the whiskers can be presented in several different ways.&lt;/p>
&lt;h2 id="tukey-boxplot">Tukey Boxplot &lt;a href="#tukey-boxplot" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Tukey boxplot defines two type of whiskers, which are called &lt;em>inner fence&lt;/em> and &lt;em>outer fence&lt;/em>. The value of &lt;em>inner fence&lt;/em> is &lt;code>Q1 - 1.5 * IQR&lt;/code> and &lt;code>Q3 + 1.5 * IQR&lt;/code>. At the same time, the value of &lt;em>outer fence&lt;/em> is &lt;code>Q1 + 3 * IQR&lt;/code> and &lt;code>Q3 + 3 * IQR&lt;/code>.&lt;/p>
&lt;p>The data outside the fence is called the &lt;em>suspected outliers&lt;/em> and &lt;em>outliners&lt;/em>.&lt;/p>
&lt;p>If the data happens to be normally distributed, &lt;code>IQR = 1.35Ïƒ&lt;/code>. It means that only 0.52% of the set of data should be out of the &lt;em>inner fence&lt;/em> and hardly any of the data should be out of the &lt;em>outer fence&lt;/em>. As a result, if a data is considered as a &lt;em>outliners&lt;/em>, it is largely an exception.&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/Boxplot.png" alt="Boxplot and Normal Distribution">&lt;/p>
&lt;h2 id="reference">Reference &lt;a href="#reference" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Boxplot">Box plot - Wikipedia&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.physics.csbsju.edu/stats/box2.html">Box Plot: Display of Distribution&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.wasu.com.cn/fwyzc/wasubzhzl/201207/P020140102519718744101.pdf">Tables for statistical distributions&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>GeoHashç®—æ³•</title><link>https://wizmann.top/posts/geo-hash-algorithm/</link><pubDate>Tue, 04 Feb 2014 00:10:00 +0000</pubDate><guid>https://wizmann.top/posts/geo-hash-algorithm/</guid><description>&lt;h2 id="geohash">GeoHash &lt;a href="#geohash" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Geohash is a latitude/longitude geocode system invented by Gustavo Niemeyer when writing the web service at geohash.org, and put into the public domain. It is a hierarchical spatial data structure which subdivides space into buckets of grid shape.&lt;/p>&lt;/blockquote>
&lt;p>ç®€å•è¯´ï¼ŒGeoHashæ˜¯ä¸€ä¸ªå°†ç»çº¬åº¦ä¿¡æ¯ç¼–ç æˆä¸€ä¸ªstringçš„ç®—æ³•ã€‚ä»è€Œä¾¿äºå‚¨å­˜ã€æŸ¥æ‰¾ã€‚&lt;/p>
&lt;h2 id="geohashç®—æ³•çš„æ­¥éª¤">GeoHashç®—æ³•çš„æ­¥éª¤ &lt;a href="#geohash%e7%ae%97%e6%b3%95%e7%9a%84%e6%ad%a5%e9%aa%a4" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>GeoHashå¯¹ç»åº¦çº¬åº¦åˆ†åˆ«ç¼–ç ï¼ŒåŸç†æ˜¯è¿­ä»£åšäºŒåˆ†ï¼Œè¿›è€Œé€¼è¿‘çœŸå®å€¼ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä»¥çº¬åº¦ä¸¾ä¾‹ã€‚&lt;/p>
&lt;p>ç”±äºåœ°çƒçº¬åº¦åŒºé—´æ˜¯[-90,90]ï¼Œæ‰€ä»¥å–åŒºé—´ä¸­ç‚¹&lt;code>pivot&lt;/code>ã€‚å¦‚æœæŸåœ°ç‚¹Pçš„çº¬åº¦å¤§äº&lt;code>pivot&lt;/code>çš„å€¼ï¼Œåˆ™ç¼–ç çš„ç¬¬1ä½ä¸º&lt;code>1&lt;/code>ï¼Œåä¹‹ä¸º&lt;code>0&lt;/code>ã€‚&lt;/p>
&lt;p>ç„¶åç¼©å°èŒƒå›´ï¼Œè¿­ä»£Næ¬¡ã€‚å¾—åˆ°æœ€åçš„ç»“æœã€‚&lt;/p>
&lt;p>ç»åº¦çš„èŒƒå›´æ˜¯[-180, 180]ã€‚æˆ‘ä»¬é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ç»åº¦ç¼–ç ã€‚&lt;/p>
&lt;p>æœ€åæˆ‘ä»¬æŠŠç»åº¦å’Œçº¬åº¦çš„ç¼–ç è¿›è¡Œäº¤é”™ç»„åˆï¼Œå¶æ•°ä½æ”¾ç»åº¦ï¼Œå¥‡æ•°ä½æ”¾çº¬åº¦ã€‚å¾—åˆ°æœ€åçš„GeoHashç¼–ç ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œç»çº¬åº¦&lt;code>(57.64911,10.40744)&lt;/code>å¯ä»¥ä½¿ç”¨base32ç¼–ç ä¸º &lt;code>u4pruydqqvj&lt;/code>ã€‚&lt;/p>
&lt;h2 id="geohashç®—æ³•çš„ç”¨é€”">GeoHashç®—æ³•çš„ç”¨é€” &lt;a href="#geohash%e7%ae%97%e6%b3%95%e7%9a%84%e7%94%a8%e9%80%94" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºGeoHashä½¿ç”¨ç»çº¬åº¦äº¤é”™ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨æŸä¸€ä¸ª&lt;b>å‰è¾&lt;/b>ï¼Œå°±å¯ä»¥åˆ’å®šä¸€ä¸ªç»çº¬åº¦èŒƒå›´ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-geohash-grid.jpg" alt="GeoHash-grid">&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬å¯¹GeoHashç¼–ç è¿™ä¸€åˆ—è¿›è¡Œç´¢å¼•åŠ é€Ÿï¼Œåˆ™å¯ä»¥åœ¨è¾ƒå¿«çš„æ—¶é—´å†…æŸ¥æ‰¾åˆ°æŸä¸€ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰gridï¼Œè¿›è€Œè·å¾—POIç­‰ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="geohashçš„å‹ç¼©æ€æƒ³">GeoHashçš„å‹ç¼©æ€æƒ³ &lt;a href="#geohash%e7%9a%84%e5%8e%8b%e7%bc%a9%e6%80%9d%e6%83%b3" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>GeoHashçš„äº¤é”™ç¼–ç ä¸ºåŒºé—´æŸ¥æ‰¾æä¾›äº†éå†ã€‚è€Œå¯¹ç»çº¬åº¦çš„é€¼è¿‘ç¼–ç åˆ™æä¾›äº†éå¸¸å¥½çš„å‹ç¼©ç‰¹æ€§ã€‚&lt;/p>
&lt;p>æ˜“å¾—ï¼Œä¸€ä¸ªç‚¹ä½äº&lt;code>pivot&lt;/code>çš„å·¦å³/ä¸Šä¸‹çš„æœºç‡æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥ç¼–ç çš„æ¯ä¸€ä½çš„ä¿¡æ¯é‡éƒ½æ˜¯&lt;code>-logPr[s]&lt;/code>=&amp;gt;&lt;code>1bit&lt;/code>ï¼Œè¾¾åˆ°äº†æ•°æ®å‹ç¼©çš„ä¸‹é™ã€‚&lt;/p>
&lt;p>åˆç”±äºäºŒåˆ†é€¼è¿‘çš„è‰¯å¥½æ€§èƒ½ï¼Œä½¿å¾—å‹ç¼©/è§£å‹ç¼©çš„é€Ÿåº¦å¯ä»¥è¾¾åˆ°æé™ã€‚&lt;/p>
&lt;p>ä¸è¿‡åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒPOIä¸å¯èƒ½å®Œå…¨å¹³å‡åˆ†å¸ƒï¼Œæ‰€ä»¥GeoHashçš„å‹ç¼©åªæ˜¯ä¸€ç§æ¥è¿‘æœ€ä¼˜è§£çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ç”±äºäºŒåˆ†é€¼è¿‘æ³•å¸¦æ¥çš„å¯ç´¢å¼•æ€§ï¼ŒGeoHashç»å¯¹å¯ä»¥ç§°çš„ä¸Šæ˜¯ä¸€ä¸ªç²¾å¦™å®Œç¾çš„è®¾è®¡äº†ã€‚&lt;/p>
&lt;h2 id="åº”ç”¨---æ‹‰å–ç›®æ ‡å‘¨å›´çš„poi">åº”ç”¨ - æ‹‰å–ç›®æ ‡å‘¨å›´çš„POI &lt;a href="#%e5%ba%94%e7%94%a8---%e6%8b%89%e5%8f%96%e7%9b%ae%e6%a0%87%e5%91%a8%e5%9b%b4%e7%9a%84poi" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬åœ¨ä¸€äº›LBSåº”ç”¨ä¸­ï¼Œç»å¸¸éœ€è¦æ‹‰å–æŸä¸€ç‚¹å‘¨å›´çš„POIã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬å°†POIå­˜å‚¨ä¸ºä¸€ä¸ª&lt;code>pvlist&lt;/code>æ˜ å°„ã€‚å¹¶ä¸”è·å¾—äº†æŸç‚¹çš„GeoHashå€¼ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå–å¾—å‘¨å›´çš„POIå‘¢ï¼Ÿ&lt;/p>
&lt;p>ç†æƒ³çŠ¶æ€ä¸‹ï¼Œâ€œé™„è¿‘çš„POIâ€éƒ½æ˜¯åœ¨ä¸€ä¸ªä»¥æŸç‚¹ä¸ºåœ†å¿ƒçš„åœ†è¿›è¡ŒæŸ¥æ‰¾ã€‚ä½†æ˜¯ç”±äºGeoHashåˆ’åˆ†çš„èŒƒå›´æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª&lt;code>3Ã—3&lt;/code>çš„å¤§çŸ©å½¢æ¥æ›¿ä»£åœ†å½¢èŒƒå›´ã€‚&lt;/p>
&lt;p>å…¶ä¸­&lt;code>3Ã—3&lt;/code>çŸ©å½¢ä¸­æœ€ä¸­é—´çš„çŸ©å½¢æ˜¯æˆ‘ä»¬ç¡®å®šçš„é‚£ä¸ªç‚¹ã€‚&lt;/p>
&lt;p>ç„¶åï¼Œæˆ‘ä»¬æ ¹æ®ç»™å‡ºçš„åŠå¾„&lt;code>r&lt;/code>ç¡®å®šGeoHashçš„ç²¾ç¡®åº¦ã€‚ä½¿å¾—æˆ‘ä»¬çš„&lt;code>3Ã—3&lt;/code>å¤§çŸ©å½¢å¯ä»¥åŒ…å«ç†æƒ³çš„åœ†å½¢èŒƒå›´ã€‚&lt;/p>
&lt;p>äºæ˜¯ä¸‹ä¸€æ­¥çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°æŸç‚¹GeoHashçš„&lt;strong>8ä¸ª&lt;/strong>ä¸´è¿‘çš„GeoHashã€‚&lt;/p>
&lt;p>ç”±ä¸Šæ–‡æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼ŒGeoHashçš„ç»çº¬åº¦æ˜¯åˆ†åˆ«ç¼–ç çš„ã€‚ä»¥ä¸€ä¸ª&lt;code>4Ã—4&lt;/code>çš„åœ°å›¾ä¸ºä¾‹ã€‚&lt;/p>
&lt;p>è¿™æ˜¯åœ¨çº¬åº¦ä¸Šçš„åˆ’åˆ†ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-geohash-latitude-grid.png" alt="çº¬åº¦">&lt;/p>
&lt;p>å¯ä»¥çœ‹å‡ºï¼Œè¿ç»­çš„&lt;code>GeoHash Grid&lt;/code>çš„çº¬åº¦ç¼–ç ä¹Ÿæ˜¯è¿ç»­çš„ã€‚&lt;/p>
&lt;p>ç»åº¦åŒç†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦&lt;code>decode&lt;/code>æˆ‘ä»¬çš„GeoHashç¼–ç ï¼Œå°†&lt;code>longitude&lt;/code>å’Œ&lt;code>latitude&lt;/code>ç¼–ç åˆ†åˆ«è¿›è¡Œ&lt;code>-1/+1&lt;/code>çš„æ“ä½œå°±å¯ä»¥è·å¾—&lt;strong>é™„è¿‘çš„POI&lt;/strong>çš„GeoHashç /å‰è¾äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>GeoHashçš„ä¸‰ä¸ªç‰¹æ€§ï¼Œ&lt;b>å¯ç´¢å¼•&lt;/b>ï¼Œ&lt;b>å‹ç¼©&lt;/b>ï¼Œ&lt;b>ä¾¿äºå­˜å‚¨&lt;/b>ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ï¼Œå¥½ä¹…ä¸å†™æ–‡äº†ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™ &lt;a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://book.douban.com/subject/11554138/">HBase in Action&lt;/a>, Chpt. 8&lt;/li>
&lt;li>&lt;a href="http://book.douban.com/subject/3729518/">æ·±å…¥æœç´¢å¼•æ“&lt;/a>, Chpt. 2&lt;/li>
&lt;li>&lt;a href="http://en.wikipedia.org/wiki/Geohash">GeoHash - Wikipedia&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.cnblogs.com/LBSer/p/3310455.html">GeoHashæ ¸å¿ƒåŸç†è§£æ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://code.google.com/p/python-geohash/">python-geohash&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç½‘ç«™çš„åœ°ç†ä¿¡æ¯</title><link>https://wizmann.top/posts/find-the-geo-location-of-a-host/</link><pubDate>Fri, 24 Jan 2014 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/find-the-geo-location-of-a-host/</guid><description>&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¢è¯•é¢˜ï¼š&lt;/p>
&lt;blockquote>
&lt;p>æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œå¦‚ä½•åˆ¤æ–­è¿™ä¸ªç½‘ç«™çš„åœ°ç†ä¿¡æ¯&lt;/p>&lt;/blockquote>
&lt;h2 id="æ–¹æ³•">æ–¹æ³• &lt;a href="#%e6%96%b9%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="ä½¿ç”¨åå‘dns">ä½¿ç”¨åå‘DNS &lt;a href="#%e4%bd%bf%e7%94%a8%e5%8f%8d%e5%90%91dns" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å½“æˆ‘ä»¬åªæœ‰ç½‘ç«™çš„IPåœ°å€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;strong>åå‘DNS&lt;/strong>æ¥è·å¾—è¿™ä¸ªIPåœ°å€å¯¹åº”çš„åŸŸåã€‚&lt;/p>
&lt;blockquote>
&lt;p>åå‘åŸŸåè§£æï¼ŒReverse DNSã€‚åå‘åŸŸåè§£æä¸é€šå¸¸çš„æ­£å‘åŸŸåè§£æç›¸åï¼Œæä¾›IPåœ°å€åˆ°åŸŸåçš„å¯¹åº”ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code>dig -x&lt;/code>æ¥è¿›è¡ŒæŸ¥è¯¢&lt;/p>
&lt;pre tabindex="0">&lt;code>$ dig -x 75.126.43.235
; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.8.1-P1 &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 75.126.43.235
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 26688
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
;; QUESTION SECTION:
;235.43.126.75.in-addr.arpa. IN PTR
;; ANSWER SECTION:
235.43.126.75.in-addr.arpa. 3518 IN PTR 75.126.43.235-static.reverse.softlayer.com.
;; Query time: 76 msec
;; SERVER: 8.8.4.4#53(8.8.4.4)
;; WHEN: Fri Jan 24 18:15:22 2014
;; MSG SIZE rcvd: 100
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å¯ä»¥ä»æ¥ç»­å‡ºæ¥çš„åŸŸåä¸­ï¼Œè·å¾—ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å…¬å¸å/æœºæ„åï¼Œä»¥åŠ&lt;code>.cn&lt;/code>, &lt;code>.us&lt;/code>ç­‰æœ‰å¯èƒ½æ ‡è¯†åœ°ç†ä½ç½®çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œåå‘DNSä¸ä¸€å®šæˆåŠŸã€‚&lt;/p>
&lt;h2 id="æŸ¥è¯¢dns-locä¿¡æ¯">æŸ¥è¯¢DNS LOCä¿¡æ¯ &lt;a href="#%e6%9f%a5%e8%af%a2dns-loc%e4%bf%a1%e6%81%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>In the Domain Name System, a LOC record (RFC 1876) is a means for expressing geographic location information for a domain name.&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨&lt;code>dig loc&lt;/code>å‘½ä»¤æ¥æŸ¥è¯¢ä½ç½®ä¿¡æ¯ã€‚ï¼ˆä¸ä¸€å®šæˆåŠŸ&lt;/p>
&lt;pre tabindex="0">&lt;code>$ dig loc SW1A2AA.find.me.uk
; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.8.1-P1 &amp;lt;&amp;lt;&amp;gt;&amp;gt; loc SW1A2AA.find.me.uk
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 49682
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
;; QUESTION SECTION:
;SW1A2AA.find.me.uk. IN LOC
;; ANSWER SECTION:
SW1A2AA.find.me.uk. 21600 IN LOC 51 30 12.748 N 0 7 39.611 W 0.00m 0.00m 0.00m 0.00m
;; Query time: 1232 msec
;; SERVER: 8.8.4.4#53(8.8.4.4)
;; WHEN: Fri Jan 24 18:21:44 2014
;; MSG SIZE rcvd: 64
&lt;/code>&lt;/pre>&lt;h2 id="éšä¾¿çœ‹çœ‹">éšä¾¿çœ‹çœ‹ &lt;a href="#%e9%9a%8f%e4%be%bf%e7%9c%8b%e7%9c%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æŸ¥çœ‹æˆ‘ä»¬è¦è°ƒæŸ¥çš„ç½‘ç«™ï¼Œæ‰¾å¯»å¯ç”¨çš„çº¿ç´¢ã€‚ï¼ˆå›§&lt;/p>
&lt;h2 id="ä½¿ç”¨whoisæœåŠ¡">ä½¿ç”¨whoisæœåŠ¡ &lt;a href="#%e4%bd%bf%e7%94%a8whois%e6%9c%8d%e5%8a%a1" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="http://whois.chinaz.com/sina.com">http://whois.chinaz.com/sina.com&lt;/a>&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸŸåçš„æ³¨å†Œä¿¡æ¯ï¼Œå…¶ä¸­ä¹Ÿå¿…ç„¶é€éœ²äº†çº¿ç´¢ã€‚&lt;/p>
&lt;h2 id="tracerouteä¸whoisé…åˆä½¿ç”¨">tracerouteä¸whoisé…åˆä½¿ç”¨ &lt;a href="#traceroute%e4%b8%8ewhois%e9%85%8d%e5%90%88%e4%bd%bf%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¯ä»¥æ ¹æ®åŒ…çš„è½¬å‘çŠ¶å†µæ¥è·å¾—æœ€ç»ˆçš„åœ°ç†ä½ç½®&lt;/p>
&lt;h2 id="ä½¿ç”¨time-of-day-service">ä½¿ç”¨Time of day service &lt;a href="#%e4%bd%bf%e7%94%a8time-of-day-service" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;code>telnet www.bupt.edu.cn 13&lt;/code>å¯ä»¥è·å¾—ä¸»æœºçš„å½“å‰æ—¶é—´ï¼Œä»è€Œåˆ¤æ–­ä¸»æœºæ‰€åœ¨çš„ç»åº¦ã€‚ï¼ˆä¸ä¸€å®šæˆåŠŸã€‚ã€‚ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="http://www.private.org.il/IP2geo.html">http://www.private.org.il/IP2geo.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://www.ipgeo.com/">http://www.ipgeo.com/&lt;/a>&lt;/p></description></item><item><title>Codeforces Round #223 (Div. 2) ä¸å®Œå…¨ä¸æ­£ç¡®é¢˜è§£</title><link>https://wizmann.top/posts/cf-223-div-2/</link><pubDate>Sat, 18 Jan 2014 14:47:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-223-div-2/</guid><description>&lt;p>ç”±äºå¤§å·å·²ç»è¿›Div. 1äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„å‡ åœºDiv. 2éƒ½æ˜¯ç”¨å°å·åšçš„ã€‚&lt;/p>
&lt;p>ç­‰æœ‰å®åŠ›åˆ‡Dé¢˜äº†ï¼Œå†å»æ‰“ä¸€åŒºã€‚ï¼ˆå¼±&lt;/p>
&lt;p>äº‹æƒ…ä¸€ç›´å¾ˆå¤šï¼Œæ‰€ä»¥é¢˜è§£è½åäº†å¥½ä¹…æ‰å‘ã€‚&lt;/p>
&lt;h2 id="a-sereja-and-dima">A. Sereja and Dima &lt;a href="#a-sereja-and-dima" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>çº¯æ¨¡æ‹Ÿï¼ŒPythonéšä¾¿æ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pokers &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>v &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> pokers[&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">&amp;gt;&lt;/span> pokers[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v[p] &lt;span style="color:#f92672">+=&lt;/span> pokers[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">del&lt;/span> pokers[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v[p] &lt;span style="color:#f92672">+=&lt;/span> pokers[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">del&lt;/span> pokers[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">^=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print v[&lt;span style="color:#ae81ff">0&lt;/span>], v[&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-sereja-and-stairs">B. Sereja and Stairs &lt;a href="#b-sereja-and-stairs" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¢˜ç›®è¦æ±‚å®ç°ä¸€ä¸ªæ•°ç»„ï¼Œä½¿å‰ä¸€åŠä¸ºé€’å¢ï¼Œåä¸€åŠä¸ºé€’å‡ã€‚&lt;/p>
&lt;p>&lt;code>a[1]â€‰&amp;lt;â€‰a[2]â€‰&amp;lt;â€‰...â€‰&amp;lt;â€‰a[iâ€‰-â€‰1]â€‰&amp;lt;â€‰a[i]â€‰&amp;gt;â€‰a[iâ€‰+â€‰1]â€‰&amp;gt;â€‰...â€‰&amp;gt;â€‰a[n - â€‰1]â€‰&amp;gt;â€‰a[n]&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼ŒæŸä¸€ä¸ªæ•°&lt;code>x&lt;/code>åœ¨æ•°ç»„&lt;code>a&lt;/code>ä¸­æœ€å¤šå¯ä»¥å‡ºç°ä¸¤æ¬¡ï¼Œå…¶ä¸­ä¸€æ¬¡åœ¨å·¦è¾¹çš„åºåˆ—ï¼Œä¸€æ¬¡åœ¨å³è¾¹çš„åºåˆ—ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬å°±å¯¹ç»™å‡ºçš„æ•°ç»„&lt;code>s&lt;/code>è¿›è¡Œä¸€æ¬¡ç»Ÿè®¡ï¼Œæ‰¾å‡ºæ¯ä¸€ä¸ªæ•°å‡ºç°çš„æ¬¡æ•°ã€‚&lt;/p>
&lt;p>å¹¶åˆ†åˆ«è®¨è®ºå‡ºç°ä¸€æ¬¡å’Œå‡ºç°ä¸¤æ¬¡çš„æƒ…å†µã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5120&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>n &lt;span style="color:#f92672">=&lt;/span> int(raw_input())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cards &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cnt &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(SIZE)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>maxi &lt;span style="color:#f92672">=&lt;/span> max(cards)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> item &lt;span style="color:#f92672">in&lt;/span> cards:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt[item] &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>left &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>right &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(maxi):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> cnt[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> left&lt;span style="color:#f92672">.&lt;/span>append(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">elif&lt;/span> cnt[i] &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> left&lt;span style="color:#f92672">.&lt;/span>append(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> right&lt;span style="color:#f92672">.&lt;/span>append(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>left&lt;span style="color:#f92672">.&lt;/span>sort()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>right&lt;span style="color:#f92672">.&lt;/span>sort(reverse&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ans &lt;span style="color:#f92672">=&lt;/span> left &lt;span style="color:#f92672">+&lt;/span> [maxi] &lt;span style="color:#f92672">+&lt;/span> right
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print len(ans)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(map(str, ans))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-sereja-and-prefixes">C. Sereja and Prefixes &lt;a href="#c-sereja-and-prefixes" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç»™å®šä¸€ä¸ªç©ºåºåˆ—&lt;code>A&lt;/code>ï¼Œç„¶åè¿™ä¸ªåºåˆ—ä¸Šå¯ä»¥æœ‰ä¸¤ç§æ“ä½œã€‚&lt;/p>
&lt;p>ä¸€æ˜¯&lt;code>A.push_back(x)&lt;/code>ï¼ŒäºŒæ˜¯&lt;code>A.push_back_batch(A[0]...A[i])&lt;/code>ã€‚&lt;/p>
&lt;p>ç”±äºæ“ä½œçš„æ¬¡æ•°æ˜¯&lt;code>10^5&lt;/code>ï¼Œäºæ˜¯æˆ‘ä»¬å°†åºåˆ—&lt;code>A&lt;/code>å­˜æˆä¸€ä¸ªå¦‚ä¸‹çš„å½¢å¼ã€‚&lt;/p>
&lt;p>&lt;code>a -&amp;gt; b -&amp;gt; c -&amp;gt; copy(0...i) -&amp;gt; d -&amp;gt; copy(0 ... j)&lt;/code>&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè¯¢é—®çš„ä½ç½®&lt;code>pos&lt;/code>æ˜¯ä¸€ä¸ªæ•°ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›ç»“æœã€‚å¦‚æœè¯¢é—®çš„ä½ç½®&lt;code>pos&lt;/code>ä½äºä¸€ä¸ª&lt;code>copy&lt;/code>å—é‡Œé¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ä¸€å®šä¼šåœ¨&lt;code>A[0...i]&lt;/code>ä¸­å‡ºç°ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å¤„ç†&lt;code>pos&lt;/code> -&amp;gt; &lt;code>pos'&lt;/code>ï¼Œä½¿&lt;code>pos'&lt;/code>ä½äº&lt;code>A[0...i]&lt;/code>åŒºé—´å†…ã€‚å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°&lt;code>pos&lt;/code>æ˜¯ä¸€ä¸ªæ•°ä¸ºæ­¢ã€‚&lt;/p>
&lt;p>ç„¶åè¿™é¢˜ç”¨çš„ç®—æ³•è²Œä¼¼ä¸æ˜¯æœ€å¿«çš„ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ˜¯æœ€å¥½ç†è§£çš„ä¸€ç§ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ä¸€ä¸ªå¤§æ ¹å †å¾ªç¯å–&lt;code>query&lt;/code>ä¸­æœ€å¤§çš„å€¼ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100010&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint st, end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint prefix, rep;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(llint ist, llint pre, llint r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st &lt;span style="color:#f92672">=&lt;/span> ist;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> end &lt;span style="color:#f92672">=&lt;/span> st &lt;span style="color:#f92672">+&lt;/span> pre &lt;span style="color:#f92672">*&lt;/span> r &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> prefix &lt;span style="color:#f92672">=&lt;/span> pre;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rep &lt;span style="color:#f92672">=&lt;/span> r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(llint ist, llint v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st &lt;span style="color:#f92672">=&lt;/span> end &lt;span style="color:#f92672">=&lt;/span> ist;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> prefix &lt;span style="color:#f92672">=&lt;/span> v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rep &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">is_value&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> rep &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint &lt;span style="color:#a6e22e">value&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> prefix;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">contains&lt;/span>(llint v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> st &lt;span style="color:#f92672">&amp;lt;=&lt;/span> v &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> v &lt;span style="color:#f92672">&amp;lt;=&lt;/span> end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint v, q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> query(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> query(llint iv, llint iq)&lt;span style="color:#f92672">:&lt;/span> v(iv), q(iq){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">friend&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> query&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> query&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a.v &lt;span style="color:#f92672">&amp;lt;&lt;/span> b.v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>priority_queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>query&lt;span style="color:#f92672">&amp;gt;&lt;/span> pq;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>node&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>map&lt;span style="color:#f92672">&amp;lt;&lt;/span>llint, llint&lt;span style="color:#f92672">&amp;gt;&lt;/span> mp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint ask[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ptr &lt;span style="color:#f92672">=&lt;/span> vec.size() &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>pq.empty()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> query nn &lt;span style="color:#f92672">=&lt;/span> pq.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint now &lt;span style="color:#f92672">=&lt;/span> nn.v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint q &lt;span style="color:#f92672">=&lt;/span> nn.q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>vec[ptr].contains(now)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (vec[ptr].is_value()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp[q] &lt;span style="color:#f92672">=&lt;/span> vec[ptr].value();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint delta &lt;span style="color:#f92672">=&lt;/span> now &lt;span style="color:#f92672">-&lt;/span> vec[ptr].st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> delta &lt;span style="color:#f92672">%=&lt;/span> vec[ptr].prefix;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.push(query(delta &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, q));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint a, b, c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint st &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(node(st, b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(b &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(node(st, b, c));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#f92672">--&lt;/span>vec.end()) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> end &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ask[i] &lt;span style="color:#f92672">=&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pq.push(query(a, a));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> solve();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i) printf(&lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%lld&amp;#34;&lt;/span>, mp[ask[i]]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-sereja-and-tree">D. Sereja and Tree &lt;a href="#d-sereja-and-tree" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æš´åŠ›ä¹±æï¼Œå› ä¸ºæ ‘çš„é«˜åº¦åªæœ‰7000ï¼Œæ‰€ä»¥æ€ä¹ˆæéƒ½å¤§æ¦‚èƒ½è¿‡ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆåšçš„äººå¥½å°‘ã€‚&lt;/p>
&lt;p>å¯èƒ½æ˜¯é¢˜ç›®è¡¨è¿°çš„ä¸å¤ªå¥½å§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;set&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">7010&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> LINE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">501000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l, r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(&lt;span style="color:#66d9ef">int&lt;/span> il, &lt;span style="color:#66d9ef">int&lt;/span> ir, &lt;span style="color:#66d9ef">int&lt;/span> ival)&lt;span style="color:#f92672">:&lt;/span> l(il), r(ir), val(ival) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> ls[LINE], rs[LINE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>node&lt;span style="color:#f92672">&amp;gt;&lt;/span> ins[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">intersect&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b, &lt;span style="color:#66d9ef">int&lt;/span> c, &lt;span style="color:#66d9ef">int&lt;/span> d) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (b &lt;span style="color:#f92672">&amp;lt;&lt;/span> c &lt;span style="color:#f92672">||&lt;/span> a &lt;span style="color:#f92672">&amp;gt;&lt;/span> d) &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ls[&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rs[&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt, p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> LINE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ((&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> cnt) &lt;span style="color:#f92672">==&lt;/span> i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ls[i] &lt;span style="color:#f92672">=&lt;/span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rs[i] &lt;span style="color:#f92672">=&lt;/span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ls[i] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rs[i] &lt;span style="color:#f92672">=&lt;/span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">query&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a, &lt;span style="color:#66d9ef">int&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> set&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> s;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ll &lt;span style="color:#f92672">=&lt;/span> b, rr &lt;span style="color:#f92672">=&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> level &lt;span style="color:#f92672">=&lt;/span> a; level &lt;span style="color:#f92672">&amp;lt;=&lt;/span> n; level&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)ins[level].size(); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (intersect(ll, rr, ins[level][i].l, ins[level][i].r)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s.insert(ins[level][i].val);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ll &lt;span style="color:#f92672">=&lt;/span> ls[ll] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">?&lt;/span> rs[ll]&lt;span style="color:#f92672">:&lt;/span> ls[ll];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rr &lt;span style="color:#f92672">=&lt;/span> rs[rr];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> s.size();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> tp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l, r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a, b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (m&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(tp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (tp &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> l &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> r &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ins[a].push_back(node(l, r, b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(query(a, b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="e-sereja-and-brackets">E. Sereja and Brackets &lt;a href="#e-sereja-and-brackets" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¸å‡ºæ„å¤–çš„åˆçœ‹é”™é¢˜äº†ã€‚ã€‚ã€‚_(:Ğ·ã€âˆ )_&lt;/p>
&lt;p>æœ€é•¿çš„æ‹¬å·åŒºé—´å±…ç„¶æ˜¯å¯ä»¥åœ¨ä¸­é—´åˆ é™¤ä¸€äº›æ‹¬å·çš„åŒºé—´ã€‚è¿™æ ·é¢˜ç›®å°±å˜æˆäº†ä¸€é“æ¯”è¾ƒç®€å•çš„&lt;code>ç¦»çº¿åŒ–+æ ‘çŠ¶æ•°ç»„&lt;/code>äº†ã€‚&lt;/p>
&lt;p>ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1000100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ppair&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> l, r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ppair(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ppair(&lt;span style="color:#66d9ef">int&lt;/span> il, &lt;span style="color:#66d9ef">int&lt;/span> ir, &lt;span style="color:#66d9ef">int&lt;/span> iid)&lt;span style="color:#f92672">:&lt;/span> l(il), r(ir), id(iid) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">friend&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> ppair&lt;span style="color:#f92672">&amp;amp;&lt;/span> a, &lt;span style="color:#66d9ef">const&lt;/span> ppair&lt;span style="color:#f92672">&amp;amp;&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> a.r &lt;span style="color:#f92672">&amp;lt;&lt;/span> b.r;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">lowbit&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> x&lt;span style="color:#f92672">&amp;amp;&lt;/span>(&lt;span style="color:#f92672">-&lt;/span>x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">BIT&lt;/span>&lt;span style="color:#75715e">//ç‚¹æ›´æ–°ï¼ŒåŒºé—´æŸ¥è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> baum[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(baum,&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#66d9ef">sizeof&lt;/span>(baum));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x,&lt;span style="color:#66d9ef">int&lt;/span> val)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span>(x&lt;span style="color:#f92672">&amp;lt;&lt;/span>SIZE)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> baum[x]&lt;span style="color:#f92672">+=&lt;/span>val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x&lt;span style="color:#f92672">+=&lt;/span>lowbit(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">sum&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span>(x&lt;span style="color:#f92672">&amp;gt;&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res&lt;span style="color:#f92672">+=&lt;/span>baum[x];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x&lt;span style="color:#f92672">-=&lt;/span>lowbit(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">sum&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> a,&lt;span style="color:#66d9ef">int&lt;/span> b)&lt;span style="color:#75715e">//æŸ¥è¯¢åŒºé—´å’Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sum(b)&lt;span style="color:#f92672">-&lt;/span>sum(a&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> ss[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>ppair&lt;span style="color:#f92672">&amp;gt;&lt;/span> match;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>ppair&lt;span style="color:#f92672">&amp;gt;&lt;/span> query;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> ans;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">preload&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stack&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; ss[i]; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> ss[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (c &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;(&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.push(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (c &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;)&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>st.empty()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> now &lt;span style="color:#f92672">=&lt;/span> st.top();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> match.push_back(ppair(now &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">solve&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(match.begin(), match.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(query.begin(), query.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans.resize(query.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BIT bit;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bit.init();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)query.size(); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (p &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)match.size() &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> match[p].r &lt;span style="color:#f92672">&amp;lt;=&lt;/span> query[i].r) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bit.add(match[p].l, &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans[query[i].id] &lt;span style="color:#f92672">=&lt;/span> bit.sum(query[i].l, query[i].r);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a, b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, ss);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> preload();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(q);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> q; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> query.push_back(ppair(a, b, i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> solve();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">auto&lt;/span> iter &lt;span style="color:#f92672">=&lt;/span> ans.begin(); iter &lt;span style="color:#f92672">!=&lt;/span> ans.end(); &lt;span style="color:#f92672">++&lt;/span>iter) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#f92672">*&lt;/span>iter &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç”¨Misakaåšä¸ºpelicançš„Markdownè§£æå™¨</title><link>https://wizmann.top/posts/misaka-pelican/</link><pubDate>Thu, 09 Jan 2014 14:55:00 +0000</pubDate><guid>https://wizmann.top/posts/misaka-pelican/</guid><description>&lt;h2 id="ä¸ºå•¥">ä¸ºå•¥ï¼Ÿ &lt;a href="#%e4%b8%ba%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Pelicanå†…ç½®&lt;a href="http://pythonhosted.org/Markdown/">python-markdown&lt;/a>åšä¸ºé»˜è®¤è§£æå™¨ï¼Œç”¨æ¥å°†ç”¨æˆ·çš„&lt;code>Markdown&lt;/code>æ ¼å¼çš„æ–‡ç« è½¬ä¸ºç½‘é¡µæ ¼å¼å±•ç¤ºã€‚&lt;/p>
&lt;p>&lt;strong>ç„¶è€Œ&lt;/strong>ï¼Œ&lt;code>python-markdown&lt;/code>æ¨¡å—çš„è§£æé€»è¾‘æœ‰ä¸¥é‡çš„Bugã€‚ä¾‹å¦‚ä¸€ä¸ª&lt;code>æœªæ ‡æ˜è¯­è¨€çš„ä»£ç å—&lt;/code>ä¼šè¢«æ ‡å‡ºå¾ˆå¤šè«åå¥‡å¦™çš„é”™è¯¯ï¼›è¿˜æœ‰&lt;code>C++&lt;/code>ä¸­çš„æŒ‡é’ˆç¬¦å·&lt;code>*&lt;/code>ä¼šè¢«è§£æä¸ºæ–œä½“çš„ç¬¦å·&lt;code>*SomeText*&lt;/code>ï¼Œåœ¨ä»£ç å—ä¸­ä¼šäº§ç”Ÿå¤§é‡å’Œè¯­æ³•é«˜äº®æ— å…³çš„æ–œä½“å­—ã€‚&lt;/p>
&lt;p>åœ¨ç½‘ä¸Šå¯»æ‰¾äº†å¾ˆä¹…çš„ç­”æ¡ˆï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ç¯‡&lt;a href="http://qiita.com/5t111111/items/4614b207f3942d05e55c">æ—¥æ–‡åšå®¢&lt;/a>ï¼Œå…¶ä¸­è®²åˆ°äº†ä½¿ç”¨&lt;a href="http://misaka.61924.nl/">misaka&lt;/a>æ¥æ›¿æ¢&lt;code>python-markdown&lt;/code>æ¥è§£ææ—¥å¿—ã€‚&lt;/p>
&lt;h2 id="ä¸¤éš¾çš„metadata">ä¸¤éš¾çš„Metadata &lt;a href="#%e4%b8%a4%e9%9a%be%e7%9a%84metadata" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä½¿ç”¨äº†ä¸Šæ–‡æåˆ°çš„æ—¥å¿—ä¸­çš„æ–¹æ³•æ¥æ›¿æ¢è§£æå™¨ï¼Œæ•ˆæœæ‹”ç¾¤ï¼Œæ—¥å¿—ä¸­çš„è§£æé—®é¢˜å®Œå…¨è§£å†³äº†ã€‚ä½†æ˜¯æ—¥å¿—ä¸­çš„&lt;code>Metadata&lt;/code>å¹¶æ²¡æœ‰è¢«éšè—ï¼Œè€Œæ˜¯æ˜¾ç¤ºåœ¨äº†æ—¥å¿—çš„æœ€å‰é¢ï¼Œéå¸¸å½±å“å¿ƒæƒ…ï¼ˆå¼ºè¿«ç—‡ï¼Ÿï¼‰ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘åˆ†æäº†è§£ææ¨¡å—çš„ä»£ç ã€‚åŸæ¥çš„è§£ææ¨¡å—ä½¿ç”¨äº†&lt;code>python-markdown&lt;/code>çš„ä¸€ä¸ªå¤„ç†&lt;code>Metadata&lt;/code>çš„&lt;a href="https://github.com/waylan/Python-Markdown/blob/master/markdown/extensions/meta.py">æ‰©å±•&lt;/a>ï¼Œç”¨æ¥è§£æ&lt;code>Metadata&lt;/code>ï¼Œå¹¶ä»æ­£æ–‡ä¸­åˆ é™¤è¿™ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯&lt;code>Misaka&lt;/code>å¹¶ä¸æ”¯æŒè¿™ç§è¯­æ³•ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å¤„ç†&lt;code>Metadata&lt;/code>çš„æ’ä»¶ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘æƒ³å¯ä¸å¯ä»¥æŠŠè¿™ä¸¤ç§&lt;code>Markdown&lt;/code>è§£æå™¨çš„é•¿å¤„åˆå¹¶ä¸€ä¸‹ï¼Œä»è€Œå®ç°æœ€ç»ˆçš„ç›®æ ‡ã€‚&lt;/p>
&lt;h2 id="å°å°çš„æ”¹åŠ¨">å°å°çš„æ”¹åŠ¨ &lt;a href="#%e5%b0%8f%e5%b0%8f%e7%9a%84%e6%94%b9%e5%8a%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç¼–è¾‘&lt;code>pelican&lt;/code>çš„&lt;code>readers.py&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ï¼ˆæˆ‘æ˜¯ç›´æ¥æ”¹çš„&lt;code>/usr/local/lib/python2.7/dist-packages/pelican&lt;/code>ä¸‹çš„æ–‡ä»¶ï¼Œä¸å¤ªä¼˜é›…ï¼Œä¸è¿‡è¿™ä¸ªæ”¹åŠ¨ä¹Ÿæ˜¯éå¸¸Dirtyçš„ï¼Œåªæ˜¯ç”¨æ¥è§£å†³é—®é¢˜ï¼‰&lt;/p>
&lt;p>é¦–å…ˆå¼•ç”¨&lt;code>Misaka&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">try&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">from&lt;/span> markdown &lt;span style="color:#f92672">import&lt;/span> Markdown
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> misaka
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> pygments
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">except&lt;/span> &lt;span style="color:#a6e22e">ImportError&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Markdown &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">False&lt;/span> &lt;span style="color:#75715e"># NOQA&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†ä¿®æ”¹&lt;code>class MarkdownReader&lt;/code>ï¼Œæ”¹å˜è§£æé€»è¾‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">read&lt;/span>(self, source_path):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;Parse content and metadata of markdown files&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#æå–Metadata&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>_md &lt;span style="color:#f92672">=&lt;/span> Markdown(extensions&lt;span style="color:#f92672">=&lt;/span>self&lt;span style="color:#f92672">.&lt;/span>extensions)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> pelican_open(source_path) &lt;span style="color:#66d9ef">as&lt;/span> text:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> content &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_md&lt;span style="color:#f92672">.&lt;/span>convert(text)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> metadata &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_parse_metadata(self&lt;span style="color:#f92672">.&lt;/span>_md&lt;span style="color:#f92672">.&lt;/span>Meta)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#è‡ªå®šä¹‰Misakaè§£æå™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> renderer &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>BleepRenderer()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> misaka_md &lt;span style="color:#f92672">=&lt;/span> misaka&lt;span style="color:#f92672">.&lt;/span>Markdown(renderer,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> extensions&lt;span style="color:#f92672">=&lt;/span>misaka&lt;span style="color:#f92672">.&lt;/span>EXT_FENCED_CODE &lt;span style="color:#f92672">|&lt;/span> misaka&lt;span style="color:#f92672">.&lt;/span>EXT_NO_INTRA_EMPHASIS)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> misaka_content &lt;span style="color:#f92672">=&lt;/span> misaka_md&lt;span style="color:#f92672">.&lt;/span>render(text)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> misaka_content, metadata
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„&lt;code>Misaka&lt;/code>è§£æå™¨ï¼Œç”¨æ¥å»é™¤&lt;code>Metadata&lt;/code>ä¿¡æ¯&lt;/p>
&lt;p>è¿™æ®µä»£ç æ˜¯åŸºäºä¸Šæ–‡è¯´çš„é‚£ç¯‡æ—¥å¿—å’Œ&lt;code>Misaka&lt;/code>çš„å®˜æ–¹æ–‡æ¡£ï¼Œæœ‰é—®é¢˜çš„è¯å¯ä»¥å»æŸ¥é˜…ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">BleepRenderer&lt;/span>(misaka&lt;span style="color:#f92672">.&lt;/span>HtmlRenderer, misaka&lt;span style="color:#f92672">.&lt;/span>SmartyPants):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#é¢„å¤„ç†å‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">preprocess&lt;/span>(self, text):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#ä½¿ç”¨ä¸€ä¸ªFakeClassæ¥éª—è¿‡å¯¹è±¡å…ƒç´ çš„æ£€æŸ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#åŒæ—¶æˆ‘ä»¬åªæ˜¯åˆ é™¤Metadataï¼Œå¹¶ä¸ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥è¿™æ ·çš„ä¿®æ”¹æ˜¯å¯ä»¥æ¥å—çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FakeClass&lt;/span>(object):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> __init__(self):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> self&lt;span style="color:#f92672">.&lt;/span>Meta &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#è°ƒç”¨Markdownçš„æ’ä»¶æ¥å¤„ç†Metadata&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> markdown
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp &lt;span style="color:#f92672">=&lt;/span> markdown&lt;span style="color:#f92672">.&lt;/span>extensions&lt;span style="color:#f92672">.&lt;/span>meta&lt;span style="color:#f92672">.&lt;/span>MetaPreprocessor()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mp&lt;span style="color:#f92672">.&lt;/span>markdown &lt;span style="color:#f92672">=&lt;/span> FakeClass()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lines &lt;span style="color:#f92672">=&lt;/span> mp&lt;span style="color:#f92672">.&lt;/span>run(text&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(lines)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#å‘Šè¯‰Misakaå¦‚ä½•å¤„ç†ä»£ç ï¼Œä½¿ç”¨pygmentsè¿›è¡Œé«˜äº®å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">block_code&lt;/span>(self, text, lang):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> lang:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;&lt;/span>&lt;span style="color:#e6db74">%s&lt;/span>&lt;span style="color:#e6db74">&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> escape(text&lt;span style="color:#f92672">.&lt;/span>strip())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lexer &lt;span style="color:#f92672">=&lt;/span> pygments&lt;span style="color:#f92672">.&lt;/span>lexers&lt;span style="color:#f92672">.&lt;/span>get_lexer_by_name(lang, stripall&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> formatter &lt;span style="color:#f92672">=&lt;/span> pygments&lt;span style="color:#f92672">.&lt;/span>formatters&lt;span style="color:#f92672">.&lt;/span>HtmlFormatter()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> pygments&lt;span style="color:#f92672">.&lt;/span>highlight(text, lexer, formatter)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç»“è¯­">ç»“è¯­ &lt;a href="#%e7%bb%93%e8%af%ad" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªä¿®æ”¹çœŸTMD&lt;strong>ç³™å¿«çŒ›&lt;/strong>å•Šï¼&lt;/p>
&lt;h2 id="æ–‡ä»¶ä¸‹è½½">æ–‡ä»¶ä¸‹è½½ &lt;a href="#%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä¿®æ”¹å¥½çš„&lt;code>readers.py&lt;/code>æ–‡ä»¶ï¼š
&lt;a href="https://s.yunio.com/_Lt!Lb">æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>è¯»ä¹¦ - ã€ŠHead first è®¾è®¡æ¨¡å¼ã€‹</title><link>https://wizmann.top/posts/read-head-first-design-pattern/</link><pubDate>Fri, 03 Jan 2014 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/read-head-first-design-pattern/</guid><description>&lt;p>&lt;img src="http://img5.douban.com/lpic/s2686916.jpg" alt="Head firstè®¾è®¡æ¨¡å¼">&lt;/p>
&lt;p>&lt;a href="http://book.douban.com/subject/2243615/">è±†ç“£è¯»ä¹¦&lt;/a>&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¯»è¿™æœ¬ä¹¦">ä¸ºä»€ä¹ˆè¯»è¿™æœ¬ä¹¦ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%af%bb%e8%bf%99%e6%9c%ac%e4%b9%a6" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨é¢XXå®¶çš„æ—¶å€™ï¼Œè¢«é—®è¿‡ä¸€ä¸ªè®¾è®¡æ¨¡å¼é—®é¢˜ã€‚å½“æ—¶è¿é¢å‘å¯¹è±¡éƒ½æä¸æ‡‚ï¼Œæ›´ä¸ç”¨è¯´è®¾è®¡æ¨¡å¼ã€‚&lt;/p>
&lt;p>äºæ˜¯å…¥äº†â€œå››äººå¸®â€çš„&lt;a href="http://book.douban.com/subject/1052241/">è®¾è®¡æ¨¡å¼&lt;/a>æ¥çœ‹ï¼Œè¢«é‡Œé¢çš„å†…å®¹å½»åº•ææ™•ã€‚ç„¶ååªèƒ½æ‰¾äº†è¿™æœ¬çœ‹èµ·æ¥å¾ˆå¨±ä¹åŒ–çš„ä¹¦æ¥è¯»ã€‚&lt;/p>
&lt;p>è¿™æœ¬ä¹¦å¤§æ¦‚æœ‰600å¤šé¡µï¼Œæ¯”â€œå››äººå¸®â€ä¹¦åšå¾ˆå¤šã€‚ä¸€ä¸ªåŸå› æ˜¯è¿™æœ¬ä¹¦æ˜¯â€œèŒƒä¾‹é©±åŠ¨â€çš„ï¼ŒåŒ…å«å¾ˆå¤šâ€œé¡¹ç›®â€èƒŒæ™¯ä»‹ç»ï¼Œä»¥åŠå®ç°æ€è·¯ï¼›ç¬¬äºŒä¸ªåŸå› æ˜¯ï¼Œè¿™æœ¬ä¹¦çš„ç¤ºä¾‹ä»£ç ç”¨çš„æ˜¯&lt;strong>Java&lt;/strong>ã€‚&lt;/p>
&lt;p>ï¼ˆç¬‘ï¼Œä¸é»‘äº†å¥½å˜›ã€‚ã€‚ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¦è®¾è®¡æ¨¡å¼">ä¸ºä»€ä¹ˆè¦è®¾è®¡æ¨¡å¼ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>è¿™ä¸–ç•Œå”¯ä¸€ä¸å˜çš„ï¼Œå°±æ˜¯å˜åŒ–&lt;/p>&lt;/blockquote>
&lt;p>ï¼ˆæ²¡æœ‰é€¼æ ¼çš„äººè¿åäººåè¨€éƒ½å¼•ç”¨ä¸å¥½ã€‚ã€‚ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çš„ä»£ç æ€»æ˜¯éœ€è¦ä¸æ–­çš„æ”¹å˜æ¥é€‚åº”ç°å®ä¸–ç•Œä¸­ä¸æ–­çš„å˜åŒ–ã€‚ï¼ˆçƒ§æ­»é‚£ä¸ªPMï¼ï¼‰&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦ä¸€ç§&lt;code>å¯¹ä»£ç å½±å“æœ€å°&lt;/code>çš„æ–¹å¼æ¥ä¿®æ”¹è½¯ä»¶ä»¥é€‚åº”å˜åŒ–ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åŸå› ã€‚&lt;/p>
&lt;h2 id="å†…éšçŸ¥è¯†">â€œå†…éšçŸ¥è¯†â€ &lt;a href="#%e5%86%85%e9%9a%90%e7%9f%a5%e8%af%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>è®¾è®¡æ¨¡å¼æœ‰äº†åå­—ï¼Œäººä»¬å°±å¯ä»¥è®¤è¯†åˆ°å®ƒçš„å­˜åœ¨ã€‚å¯¹äºæ²¡æœ‰åå­—çš„ä¸œè¥¿ï¼Œäººä»¬å‡ ä¹ä¸å¯èƒ½è®¤è¯†åˆ°å®ƒçš„å­˜åœ¨ï¼Œå¹¶å¯¹ä¹‹è¿›è¡Œè®¨è®ºã€‚è¿™ç§ä¸èƒ½ç”¨è¯­è¨€è¡¨è¾¾çš„çŸ¥è¯†æˆ‘ä»¬ç§°ä¹‹ä¸ºå†…éšçŸ¥è¯†ã€‚&lt;/p>&lt;/blockquote>
&lt;p>å…¶å®æˆ‘ä»¬åœ¨å†™ç¨‹åºçš„æ—¶å€™ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ç”¨åˆ°äº†â€œè®¾è®¡æ¨¡å¼â€ï¼Œåªæ˜¯æˆ‘ä»¬æ²¡æœ‰æ„è¯†åˆ°è€Œå·²ã€‚&lt;/p>
&lt;p>è€Œè®¡ç®—æœºç§‘å­¦å®¶æ€»ç»“å‡ºäº†è®¾è®¡æ¨¡å¼ï¼Œä½¿å…¶ä»&lt;code>å†…éšçŸ¥è¯†&lt;/code>æˆ–&lt;code>ç»éªŒè®º&lt;/code>çš„èŒƒç•´ä¸­è„±ç¦»å‡ºæ¥ï¼Œæˆä¸ºçœŸæ­£å¯ä»¥è®¨è®ºã€å­¦ä¹ ã€è¿ç”¨çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;h2 id="è¯»ä¹¦å½“ä¸­çš„ç¼ºæ†¾">è¯»ä¹¦å½“ä¸­çš„ç¼ºæ†¾ &lt;a href="#%e8%af%bb%e4%b9%a6%e5%bd%93%e4%b8%ad%e7%9a%84%e7%bc%ba%e6%86%be" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿˜æ˜¯ç”±äºä¸ªäººå·¥ç¨‹ä»£ç ç»éªŒä¸è¶³ï¼Œä¸èƒ½100%çš„ç†è§£è®¾è®¡æ¨¡å¼çš„çœŸè°›ã€‚&lt;/p>
&lt;p>ä¸Šæ¬¡åŠ¨æ‰‹å†™äº†ä¸€ä¸ª&lt;code>çŠ¶æ€æ¨¡å¼&lt;/code>çš„äº•å­—æ¸¸æˆï¼Œè¿˜æ˜¯å†™çš„æœ‰äº›åƒåŠ›çš„ã€‚ä¹Ÿè®¸åœ¨å·¥ä½œä¸­æˆ–æ—¶ä¸ªäººé¡¹ç›®ä¸­ï¼Œèƒ½å¤šå®è·µå§ã€‚&lt;/p>
&lt;h2 id="æ€ç»´å¯¼å›¾">æ€ç»´å¯¼å›¾ &lt;a href="#%e6%80%9d%e7%bb%b4%e5%af%bc%e5%9b%be" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-design-pattern-mindmap.png">æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>åŒˆç‰™åˆ©ç®—æ³•</title><link>https://wizmann.top/posts/hungary-algorithm/</link><pubDate>Wed, 01 Jan 2014 22:01:00 +0000</pubDate><guid>https://wizmann.top/posts/hungary-algorithm/</guid><description>&lt;h2 id="æ¦‚å¿µ">æ¦‚å¿µ &lt;a href="#%e6%a6%82%e5%bf%b5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="äº¤é”™è·¯">äº¤é”™è·¯ &lt;a href="#%e4%ba%a4%e9%94%99%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>äº¤é”™è·¯ï¼šè®¾Pæ˜¯å›¾Gçš„ä¸€æ¡è·¯ï¼Œå¦‚æœPçš„ä»»æ„ä¸¤æ¡ç›¸é‚»çš„è¾¹ä¸€å®šæ˜¯ä¸€æ¡å±äºMè€Œå¦ä¸€æ¡ä¸å±äºMï¼Œå°±ç§°Pæ˜¯ä¸€æ¡äº¤é”™è·¯ã€‚&lt;/p>&lt;/blockquote>
&lt;p>é€šä¿—ç‚¹æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå›¾ä¸­çš„è·¯å¾„æŸ“æˆçº¢é»‘ä¸¤ç§ã€‚ç„¶åæ‰¾å‡ºä¸€æ¡è·¯ï¼Œä½¿è¿™æ¡è·¯&lt;strong>çº¢é»‘äº¤é”™&lt;/strong>ã€‚&lt;/p>
&lt;p>æ³¨ï¼šäº¤é”™è·¯æ˜¯æ— å‘å›¾ï¼Œå›¾ä¸­çš„ç®­å¤´åªæ˜¯ä¸ºäº†ä¾¿äºè§‚å¯Ÿã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ä¸‹å›¾ä¸­çš„ï¼š&lt;code>(3) -&amp;gt; (2) -&amp;gt; (1)&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-hungary-1.png" alt="å›¾1">&lt;/p>
&lt;h3 id="ä»ç«¯ç‚¹æ‰©å¼ äº¤é”™è·¯">ä»ç«¯ç‚¹æ‰©å¼ äº¤é”™è·¯ &lt;a href="#%e4%bb%8e%e7%ab%af%e7%82%b9%e6%89%a9%e5%bc%a0%e4%ba%a4%e9%94%99%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªçº¢é»‘äº¤é”™è·¯&lt;code>P&lt;/code>ï¼Œå…¶ç«¯ç‚¹ä¸º&lt;code>A&lt;/code>å’Œ&lt;code>B&lt;/code>ï¼Œå…¶è·¯å¾„è¢«æ ‡è®°ä¸º&lt;code>é»‘çº¢&lt;/code>ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘&lt;code>P&lt;/code>ä¸­çš„ä¸€ä¸ªç«¯ç‚¹ï¼ˆå‡è®¾ä¸º&lt;code>A&lt;/code>ï¼‰åŠ å…¥ä¸€æ¡è¾¹&lt;code>T&lt;/code>ã€‚&lt;/p>
&lt;p>æ­¤æ—¶æˆ‘ä»¬æœ‰&lt;code>è¾¹T + äº¤é”™è·¯Pï¼ˆé»‘çº¢ï¼‰&lt;/code>ã€‚å½“æˆ‘ä»¬å°†è¾¹&lt;code>T&lt;/code>æ ‡è®°ä¸º&lt;code>é»‘è‰²&lt;/code>æ—¶ï¼Œæˆ‘ä»¬å°±æ‰©å±•äº†äº¤é”™è·¯&lt;code>P&lt;/code>ã€‚
å¦‚æœæˆ‘ä»¬è¦ä¿æŒçº¢é»‘äº¤é”™è·¯çš„&lt;strong>æ€§è´¨&lt;/strong>ã€‚åˆ™æˆ‘ä»¬å¿…é¡»å°†è¾¹&lt;code>T&lt;/code>æ ‡è®°ä¸º&lt;code>é»‘è‰²&lt;/code>ã€‚&lt;/p>
&lt;p>äºæ˜¯&lt;code>Pï¼ˆBRï¼‰ =&amp;gt; P'(BRB)&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-hungary-2.png" alt="å›¾2">&lt;/p>
&lt;h3 id="åˆ†å‰²äº¤é”™è·¯">åˆ†å‰²äº¤é”™è·¯ &lt;a href="#%e5%88%86%e5%89%b2%e4%ba%a4%e9%94%99%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ˜“å¾—ï¼Œåˆ†å‰²äº¤é”™è·¯ä¸ä¼šæ”¹å˜å®ƒçš„æ€§è´¨ã€‚&lt;/p>
&lt;h3 id="æˆ‘ä»¬è¦çº¢è¿˜æ˜¯è¦é»‘">æˆ‘ä»¬è¦çº¢è¿˜æ˜¯è¦é»‘ &lt;a href="#%e6%88%91%e4%bb%ac%e8%a6%81%e7%ba%a2%e8%bf%98%e6%98%af%e8%a6%81%e9%bb%91" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœæˆ‘ä»¬ç¿»è½¬çº¢é»‘äº¤é”™è·¯çš„é¢œè‰²ï¼Œä¾‹å¦‚ä»&lt;code>RBR =&amp;gt; BRB&lt;/code>ï¼Œåˆ™æˆ‘ä»¬çš„äº¤é”™è·¯ä»ç„¶&lt;strong>ä¿æŒåŸæ¥çš„æ€§è´¨&lt;/strong>ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ç¿»è½¬é¢œè‰²æ˜¯å®‰å…¨çš„ã€‚&lt;/p>
&lt;h2 id="ç®—æ³•å®ç°">ç®—æ³•å®ç° &lt;a href="#%e7%ae%97%e6%b3%95%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="åŒ¹é…">åŒ¹é… &lt;a href="#%e5%8c%b9%e9%85%8d" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åŒˆç‰™åˆ©ç®—æ³•æ˜¯ç”¨æ¥æ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…çš„ç®—æ³•ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬äººä¸ºæ ‡è®°é›†åˆä¸­çš„ç‚¹ä¸º&lt;code>å·¦é›†&lt;/code>å’Œ&lt;code>å³é›†&lt;/code>ã€‚&lt;/p>
&lt;h3 id="çº¢è‰²æ˜¯ç§å¥½é¢œè‰²">çº¢è‰²æ˜¯ç§å¥½é¢œè‰² &lt;a href="#%e7%ba%a2%e8%89%b2%e6%98%af%e7%a7%8d%e5%a5%bd%e9%a2%9c%e8%89%b2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ç”±äº&lt;code>çº¢é»‘äº¤é”™è·¯&lt;/code>å¯ä»¥å®‰å…¨çš„ç¿»è½¬é¢œè‰²ã€‚æ‰€ä»¥æˆ‘ä»¬ä¿æŒäº¤é”™è·¯ä¸­&lt;strong>çº¢è‰²è·¯å¤šäºé»‘è‰²è·¯&lt;/strong>çš„æ€§è´¨ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚&lt;/p>
&lt;p>å› ä¸ºæˆ‘ä»¬è¦æ±‚å‡ºæœ€å¤§åŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾å®ŒæˆåŒ¹é…çš„è¾¹ä¸ºçº¢è‰²ã€‚&lt;/p>
&lt;h3 id="ä½ å¯ä»¥è¯æ˜ä½ çš„ç®—æ³•å—">ä½ å¯ä»¥è¯æ˜ä½ çš„ç®—æ³•å— &lt;a href="#%e4%bd%a0%e5%8f%af%e4%bb%a5%e8%af%81%e6%98%8e%e4%bd%a0%e7%9a%84%e7%ae%97%e6%b3%95%e5%90%97" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬é€‰å–å·¦é›†ç«¯ç‚¹&lt;code>T&lt;/code>åˆ°å›¾ä¸­ï¼Œæ­¤æ—¶å›¾ä¸­æœ‰&lt;code>k&lt;/code>æ¡è¾¹ä¸ç‚¹&lt;code>T&lt;/code>è¿æ¥ã€‚è¿™&lt;code>k&lt;/code>æ¡è¾¹åˆ†åˆ«ä¸º&lt;code>p1...pk&lt;/code>ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>é€‰å–p1...pkä¸­çš„ä»»ä¸€æ¡è¾¹px
å¦‚æœ å›¾ä¸­æ²¡æœ‰äº¤é”™è·¯ æˆ–è€… å›¾ä¸­æœ‰äº¤é”™è·¯ä½†pxçš„ç«¯ç‚¹ä¸åœ¨äº¤é”™è·¯ä¸­ ï¼š
å°†pxæ ‡ä¸ºçº¢è‰²
è¿”å›trueã€‚
å¦‚æœ å›¾ä¸­æœ‰äº¤é”™è·¯ï¼Œä¸”pxçš„ç«¯ç‚¹åœ¨äº¤é”™è·¯ä¸­ï¼š
å¦‚æœ pxçš„å¦ä¸€ä¸ªç«¯ç‚¹æ˜¯äº¤é”™è·¯çš„å¤´/å°¾ç«¯ç‚¹ã€‚ï¼ˆé‡ç”³ï¼Œäº¤é”™è·¯æ˜¯æ— å‘çš„ï¼‰
é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰©å±•äº¤é”™è·¯ã€‚pxæ ‡ä¸ºçº¢è‰²
è¿”å›true
å¦‚æœ pxçš„å¦ä¸€ä¸ªç«¯ç‚¹åœ¨äº¤é”™è·¯çš„ä¸­é—´ã€‚
åˆ™æˆ‘ä»¬åœ¨æ­¤ç«¯ç‚¹åˆ†å‰²äº¤é”™è·¯ï¼Œå°†Tç‚¹åŠ å…¥æŸä¸€äº¤é”™è·¯ã€‚å¹¶ä¸”é€‰å–æ­¤äº¤é”™è·¯çš„ä¸€ä¸ªç«¯ç‚¹æ‰§è¡Œè¿™ä¸ªæ‰©å±•æ“ä½œ
å¦‚æœ pxä¸å­˜åœ¨ï¼š
åˆ™è¿”å›falseï¼Œ æ´—æ´—ç¡äº†
æ‰€ä»¥æˆ‘ä»¬åœ¨æ¯ä¸€æ¬¡æ“ä½œä¹‹åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªè¿”å›å€¼ã€‚å¦‚æœä¸ºtrueï¼Œåˆ™åŒ¹é…æ•°+1ã€‚åä¹‹åˆ™ä¸å˜ã€‚
&lt;/code>&lt;/pre>&lt;p>p.s. æˆ‘è§‰å¾—æˆ‘çš„è¯æ˜æˆ‘è‡ªå·±éƒ½TMDçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚å¥½æŒ«è´¥ã€‚ã€‚ã€‚&lt;/p>
&lt;h2 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m; &lt;span style="color:#75715e">//å·¦é›†ç«¯ç‚¹æ•°ï¼Œå³é›†ç«¯ç‚¹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> g[SIZE]; &lt;span style="color:#75715e">// è¾¹é›†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">char&lt;/span> inPath[SIZE]; &lt;span style="color:#75715e">// æ˜¯å¦åœ¨äº¤é”™è·¯ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> match[SIZE]; &lt;span style="color:#75715e">// åªå­˜å‚¨é»‘è‰²è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">hungary&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sum &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#75715e">// æ€»æ•°æ ‡ä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(inPath, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(inPath)); &lt;span style="color:#75715e">// æ–°åŠ å…¥çš„ç‚¹ä¸åœ¨ä»»ä½•äº¤é”™è·¯ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sum &lt;span style="color:#f92672">+=&lt;/span> deal(i)&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sum;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">deal&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éå†æ‰€æœ‰çš„è¾¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span>)g[x].size(); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next &lt;span style="color:#f92672">=&lt;/span> g[x][i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (inPath[next]) &lt;span style="color:#66d9ef">continue&lt;/span>; &lt;span style="color:#75715e">// å¦‚æœç‚¹åœ¨äº¤é”™è·¯ä¸­ï¼Œpass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> inPath[next] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœæ‰¾åˆ°ä¸€ä¸ªä¸åœ¨äº¤é”™è·¯ä¸­çš„ç‚¹ï¼Œå°†å…¶åŠ å…¥äº¤é”™è·¯ï¼Œæ­¤è½®ç®—æ³•ç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// å¦åˆ™ï¼Œåˆ†å‰²äº¤é”™è·¯ï¼Œä»ä¸‹ä¸€ä¸ªç‚¹é‡æ–°å¯»æ‰¾æ‰©å±•äº¤é”™è·¯çš„æ–¹æ³•ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ–¹æ³•å­˜åœ¨åˆ™æ›´æ–°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œä¸æ›´æ–°ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (match[next] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">||&lt;/span> deal(match[next])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> match[next] &lt;span style="color:#f92672">=&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> true;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> false;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‚è€ƒ">å‚è€ƒ &lt;a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>byvoid: &lt;a href="https://www.byvoid.com/blog/hungary">åŒˆç‰™åˆ©ç®—æ³•&lt;/a>&lt;/p>
&lt;p>Matrix67: &lt;a href="http://www.matrix67.com/blog/archives/116">äºŒåˆ†å›¾æœ€å¤§åŒ¹é…çš„KÃ¶nigå®šç†åŠå…¶è¯æ˜&lt;/a>&lt;/p>
&lt;p>wikipedia: &lt;a href="http://zh.wikipedia.org/wiki/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95">åŒˆç‰™åˆ©ç®—æ³•&lt;/a>&lt;/p></description></item><item><title>Codeforces 3C - Tic-tac-toe</title><link>https://wizmann.top/posts/cf-3c-tic-tac-toe/</link><pubDate>Sun, 29 Dec 2013 20:23:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-3c-tic-tac-toe/</guid><description>&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="http://codeforces.com/problemset/problem/3/C">Tic-tac-toe&lt;/a>æ˜¯æˆ‘å¾ˆä¹…ä¹‹å‰åœ¨CFä¸Šåšçš„ä¸€é“é¢˜ã€‚éå¸¸è€ƒç»†å¿ƒçš„æ¨¡æ‹Ÿé¢˜ã€‚&lt;/p>
&lt;p>æœ€è¿‘æœ‰åŒå­¦å’Œæˆ‘è®¨è®ºè¿‡ç±»ä¼¼çš„é—®é¢˜ã€‚äºæ˜¯æ‹¿å‡ºæ¥é‡æ–°åšä¸€éã€‚ç»ƒç»ƒæ‰‹ã€‚&lt;/p>
&lt;h2 id="åŸé¢˜åšæ³•">åŸé¢˜åšæ³• &lt;a href="#%e5%8e%9f%e9%a2%98%e5%81%9a%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ²¡æœ‰ä»»ä½•â€œç®—æ³•â€æˆåˆ†ã€‚çº¯æ¨¡æ‹Ÿã€‚&lt;/p>
&lt;p>åˆç”±äºæ•°æ®é‡å®åœ¨æ˜¯å¤ªå°ï¼ˆ3 Ã— 3çš„çŸ©é˜µï¼‰ï¼Œæ‰€ä»¥åªè¦æ˜¯æ€è·¯æ­£ç¡®ã€‚ä»£ç æ€ä¹ˆå†™éƒ½èƒ½è¿‡ã€‚&lt;/p>
&lt;p>äºæ˜¯åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°ã€‚æ‰‹å¿«çš„ä¼—ä½10åˆ†é’Ÿåˆ‡æ­¤é¢˜æ— å‹åŠ›ã€‚&lt;/p>
&lt;h2 id="whats-new">What&amp;rsquo;s new? &lt;a href="#whats-new" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¦‚æœæˆ‘ä»¬æ‰©å±•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªTic-tac-toeçš„å¯¹æˆ˜ç³»ç»Ÿï¼ˆäººæœºå¯¹æˆ˜ã€äººäººå¯¹æˆ˜ç­‰ï¼‰ï¼Œä½ å°†å¦‚ä½•è®¾è®¡ï¼Ÿ&lt;/p>
&lt;h2 id="the-state-pattern">the STATE pattern &lt;a href="#the-state-pattern" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå¯¹æˆ˜ç³»ç»Ÿå…¶å®å¯ä»¥ç”¨ä¸€ä¸ªçŠ¶æ€æœºæ¥è¡¨ç¤ºã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-tick-tac-toe.png" alt="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-tick-tac-toe.png">&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬çš„å¯¹æˆ˜ç³»ç»Ÿä¹Ÿå¯ä»¥å†™æˆä¸€ä¸ªçŠ¶æ€æœºçš„æ¨¡å¼ã€‚&lt;/p>
&lt;h2 id="show-me-the-code">show me the CODE &lt;a href="#show-me-the-code" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>é¦–å…ˆæˆ‘ä»¬å£°æ˜ä¸€ä¸ª&lt;code>State&lt;/code>æ¥å£ç±»å‹ã€‚&lt;/p>
&lt;p>ç”±äºTic-tac-toeæ¸¸æˆåªæœ‰ä¸¤ç§æ“ä½œç±»å‹ï¼š&lt;code>P1 move&lt;/code>å’Œ&lt;code>P2 move&lt;/code>ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬çš„æ¥å£å°±å¾ˆç®€å•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">State&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">set_game&lt;/span>(Game&lt;span style="color:#f92672">*&lt;/span> igame) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">=&lt;/span> igame;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">first&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">second&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#f92672">~&lt;/span>State(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">protected&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Game &lt;span style="color:#f92672">*&lt;/span>game;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State(&lt;span style="color:#66d9ef">const&lt;/span> State&lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£ä¹ˆ&lt;code>FirstState&lt;/code>çš„å®ç°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FirstState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> State {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> first(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">second&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;FirstState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> FirstState&lt;span style="color:#f92672">::&lt;/span>first(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> make_move(x, y, FIRST);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (res &lt;span style="color:#f92672">==&lt;/span> ILLEGAL) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(ILLEGAL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next &lt;span style="color:#f92672">=&lt;/span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> next();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span>(next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> SECOND:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(SECOND);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> FIRST_WIN:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(FIRST_WIN);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> DRAW:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(DRAW);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(ILLEGAL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> FirstState&lt;span style="color:#f92672">::&lt;/span>second(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// P2ä¸èƒ½æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒç†ï¼Œ&lt;code>SecondState&lt;/code>çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SecondState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> State {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> first(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">second&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;SecondState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> SecondState&lt;span style="color:#f92672">::&lt;/span>first(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// P1ä¸èƒ½æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> SecondState&lt;span style="color:#f92672">::&lt;/span>second(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> make_move(x, y, SECOND);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (res &lt;span style="color:#f92672">==&lt;/span> ILLEGAL) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next &lt;span style="color:#f92672">=&lt;/span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> next();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span>(next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> FIRST:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(FIRST);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> SECOND_WIN:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(SECOND_WIN);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> DRAW:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(DRAW);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> game &lt;span style="color:#f92672">-&amp;gt;&lt;/span> set_state(ILLEGAL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºç»“æŸçŠ¶æ€ï¼Œå› ä¸ºæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯éæ³•çš„ã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">EndState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> State {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> first(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">second&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x,&lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">FirstWinState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> EndState {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;FirstWinState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">SecondWinState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> EndState {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;SecondWinState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">DrawState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> EndState {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;DrawState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">IllegalState&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> EndState {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">show_state&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">&amp;#34;IllegalState&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™é‡Œï¼ŒçŠ¶æ€æœºé‡Œçš„æ‰€æœ‰çŠ¶æ€æˆ‘ä»¬éƒ½å·²ç»å£°æ˜å¥½äº†ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬å¼€å§‹å®ç°&lt;code>Game&lt;/code>ç±»ã€‚å› ä¸ºæ˜¯ç¤ºä¾‹ä»£ç ï¼Œæ‰€ä»¥æœ‰çš„å‡½æ•°éƒ½å†…è”äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Game&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Game();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">set_state&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> next_state);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">get_state&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">make_move&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y, &lt;span style="color:#66d9ef">int&lt;/span> player);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">next&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">first&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> state_ptr &lt;span style="color:#f92672">-&amp;gt;&lt;/span> first(x, y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">second&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> state_ptr &lt;span style="color:#f92672">-&amp;gt;&lt;/span> second(x, y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> state;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> State&lt;span style="color:#f92672">*&lt;/span> state_ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> board[&lt;span style="color:#ae81ff">3&lt;/span>][&lt;span style="color:#ae81ff">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FirstState firststate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SecondState secondstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FirstWinState firstwinstate ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SecondWinState secondwinstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DrawState drawstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IllegalState illegalstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Game&lt;span style="color:#f92672">::&lt;/span>Game()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> board[i][j] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> firststate .set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> secondstate .set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> firstwinstate .set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> secondwinstate.set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> drawstate .set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> illegalstate .set_game((Game&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#66d9ef">this&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œè¦P1å…ˆæ‰‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> set_state(FIRST);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> Game&lt;span style="color:#f92672">::&lt;/span>set_state(&lt;span style="color:#66d9ef">int&lt;/span> next_state)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state &lt;span style="color:#f92672">=&lt;/span> next_state;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span>(next_state) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(DRAW)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>drawstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(FIRST)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>firststate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(SECOND)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>secondstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(FIRST_WIN)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>firstwinstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(SECOND_WIN)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>secondwinstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span>(ILLEGAL)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>illegalstate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> Game&lt;span style="color:#f92672">::&lt;/span>get_state() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> state_ptr &lt;span style="color:#f92672">-&amp;gt;&lt;/span>show_state();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> state;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> Game&lt;span style="color:#f92672">::&lt;/span>make_move(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y, &lt;span style="color:#66d9ef">int&lt;/span> player) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span>(player) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> FIRST:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> SECOND:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[y][x] &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> board[y][x] &lt;span style="color:#f92672">=&lt;/span> c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> Game&lt;span style="color:#f92672">::&lt;/span>next() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">judge&lt;/span>(board);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿™ä¸ªå‡½æ•°å†™çš„å¤ªå±äº†ï¼Œä¸å¿ç›´è§†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">check_win&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> board[&lt;span style="color:#ae81ff">3&lt;/span>][&lt;span style="color:#ae81ff">3&lt;/span>], &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> a_cnt, &lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span> b_cnt)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a_cnt &lt;span style="color:#f92672">=&lt;/span> b_cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> type &lt;span style="color:#f92672">=&lt;/span> board[i][&lt;span style="color:#ae81ff">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[i][j] &lt;span style="color:#f92672">==&lt;/span> type) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>) a_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>) b_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> type &lt;span style="color:#f92672">=&lt;/span> board[&lt;span style="color:#ae81ff">0&lt;/span>][i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[j][i] &lt;span style="color:#f92672">==&lt;/span> type) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>) a_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>) b_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> type &lt;span style="color:#f92672">=&lt;/span> board[&lt;span style="color:#ae81ff">0&lt;/span>][&lt;span style="color:#ae81ff">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[i][i] &lt;span style="color:#f92672">==&lt;/span> type) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>) a_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>) b_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">while&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> type &lt;span style="color:#f92672">=&lt;/span> board[&lt;span style="color:#ae81ff">0&lt;/span>][&lt;span style="color:#ae81ff">2&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">-&lt;/span> i][i] &lt;span style="color:#f92672">==&lt;/span> type) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>) a_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (type &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>) b_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">while&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åŒä¸Šã€‚ã€‚ã€‚æ¨¡æ‹Ÿé¢˜å°±æ˜¯é‚£ä¹ˆæ¶å¿ƒã€‚ã€‚ã€‚_(:Ğ·ã€âˆ )_
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¹Ÿè®¸æˆ‘ä¼šæœ‰æœºä¼šé‡æ„ä¸€ä¸‹ã€‚ã€‚ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">judge&lt;/span>(&lt;span style="color:#66d9ef">char&lt;/span> board[&lt;span style="color:#ae81ff">3&lt;/span>][&lt;span style="color:#ae81ff">3&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> next &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> a_cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, b_cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (board[i][j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;X&amp;#39;&lt;/span>) a_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (board[i][j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>) b_cnt&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a_cnt &lt;span style="color:#f92672">&amp;lt;&lt;/span> b_cnt &lt;span style="color:#f92672">||&lt;/span> a_cnt &lt;span style="color:#f92672">-&lt;/span> b_cnt &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a_cnt &lt;span style="color:#f92672">+&lt;/span> b_cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// PASS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (a_cnt &lt;span style="color:#f92672">==&lt;/span> b_cnt) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a_cnt &lt;span style="color:#f92672">=&lt;/span> b_cnt &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> check_win(board, a_cnt, b_cnt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a_cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> b_cnt &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//nobody wins and the board is full
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">switch&lt;/span>(next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> DRAW;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> FIRST;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> SECOND;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (b_cnt &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> a_cnt) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (b_cnt &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>a_cnt) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (next &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> SECOND_WIN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (a_cnt &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>b_cnt) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (next &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ILLEGAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> FIRST_WIN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// NO ELSE HERE;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> next &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">?&lt;/span> FIRST : SECOND;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åè¡¥ä¸Šæˆ‘ä»¬çš„å¸¸é‡å£°æ˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> ILLEGAL &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> DRAW &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> FIRST &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SECOND &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> FIRST_WIN &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SECOND_WIN &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="how-it-works">how it works &lt;a href="#how-it-works" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>çŠ¶æ€æ¨¡å¼ï¼š å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½è±¡ä¿®æ”¹äº†å®ƒçš„ç±»&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>class Game&lt;/code>ä¸­çš„&lt;code>state_ptr&lt;/code>æŒ‡é’ˆæ ‡ç¤ºäº†å½“ç„¶è‡ªåŠ¨æœºçš„çŠ¶æ€ã€‚ä»&lt;code>class Game&lt;/code>è°ƒç”¨&lt;code>first&lt;/code>å’Œ&lt;code>second&lt;/code>å‡½æ•°çš„è¡Œä¸ºè¢«å§”æ‰˜ç»™äº†å½“å‰çš„&lt;code>State&lt;/code>ï¼Œäº§ç”Ÿäº†ä¸åŒçš„åŠ¨ä½œã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™">ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e8%bf%99%e4%b9%88%e5%86%99" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†é‚£ä¸¤ä¸ªå†™çš„åƒå±ä¸€æ ·çš„å‡½æ•°ï¼Œæˆ‘ä»¬å†™äº†å¥½å¤šçœ‹èµ·æ¥&lt;strong>æ— ç”¨&lt;/strong>çš„ä»£ç ã€‚å¦‚æœç”¨åˆ«çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿè®¸åœ¨200è¡Œä¹‹å†…å°±å¯ä»¥å®Œæˆç°æœ‰çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ã€‚ã€‚ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä¸–ç•Œä¸Šå”¯ä¸€ä¸å˜çš„ï¼Œå°±æ˜¯ä¸€åˆ‡éƒ½åœ¨å˜&lt;/p>&lt;/blockquote>
&lt;p>ä½¿ç”¨&lt;strong>çŠ¶æ€æ¨¡å¼&lt;/strong>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„æ‰©å±•ç°æœ‰çš„çŠ¶æ€ã€‚å¹¶ä¸”ï¼Œå¯¹äºç±»çš„å†…éƒ¨åŠ¨ä½œæœ‰ä¸€ä¸ªè‰¯å¥½çš„å°è£…ã€‚&lt;/p>
&lt;p>è¿™æ ·ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æˆ‘ä»¬çš„çŠ¶æ€æœºæ—¶åªéœ€è¦æ ¹æ®éœ€è¦æ”¹å˜å®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“å®ƒæ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œ&lt;a href="http://book.douban.com/subject/21964984/">ã€Šé¢†åŸŸç‰¹å®šè¯­è¨€ã€‹&lt;/a>ä¸€ä¹¦ä¸­ï¼Œå°±æœ‰ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ„å»ºæ˜“äºè¢«é¢†åŸŸä¸“å®¶ç†è§£å’Œä½¿ç”¨çš„DSLã€‚&lt;/p>
&lt;p>ï¼ˆp.s. DSLæˆ‘äº†è§£ä¸å¤šï¼Œå¦‚æœç†è§£æœ‰åå·®ï¼Œè¯·è°…è§£ï¼‰&lt;/p>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™ &lt;a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>&lt;a href="http://codeforces.com/problemset/problem/3/C">Codeforces 3C - Tic-tac-toe&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://book.douban.com/subject/2243615/">Head First è®¾è®¡æ¨¡å¼&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ä»£ç ä¸‹è½½">ä»£ç ä¸‹è½½ &lt;a href="#%e4%bb%a3%e7%a0%81%e4%b8%8b%e8%bd%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://s.yunio.com/voeWtA">äº‘è¯ºç½‘ç›˜ - æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>How to "Rotate Image"?</title><link>https://wizmann.top/posts/how-to-rotate-image-leetcode/</link><pubDate>Sat, 28 Dec 2013 14:42:00 +0000</pubDate><guid>https://wizmann.top/posts/how-to-rotate-image-leetcode/</guid><description>&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åŸé¢˜&lt;a href="http://oj.leetcode.com/problems/rotate-image/">æˆ³æˆ‘&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Rotate Image&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>You are given an n x n 2D matrix representing an image.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Rotate the image by 90 degrees (clockwise).&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Follow up:&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Could you do this in-place?&lt;/p>&lt;/blockquote>
&lt;p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-rotate-image-leetcode.png" alt="rotate-image">&lt;/p>
&lt;p>å½“ç„¶ï¼ŒçŸ©é˜µä¸­çš„æ•°å­—&lt;strong>ä¸ä¸€å®š&lt;/strong>æ˜¯è§„å¾‹çš„ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¦æå‡ºè¿™ä¸ªé—®é¢˜">ä¸ºä»€ä¹ˆè¦æå‡ºè¿™ä¸ªé—®é¢˜ &lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%8f%90%e5%87%ba%e8%bf%99%e4%b8%aa%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è‡ªè§‰æ˜¯ä¸€ä¸ª&lt;strong>ä¸èªæ˜&lt;/strong>çš„äººï¼ˆåŒä½ã€‚ã€‚ã€‚&amp;lt;(=ï¼ _ï¼ ;=)?&amp;gt;ï¼‰ã€‚&lt;/p>
&lt;p>åˆ«äººä¸€ä¸‹å­å°±æƒ³æ˜ç™½çš„äº‹ï¼Œåœ¨æˆ‘è¿™é‡Œè¦è®¡ç®—å¥½å‡ ä¸ªæ¥å›ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åŠªåŠ›æƒ³æ‰¾åˆ°ä¸€ä¸ªæ€ç»´æ–¹æ³•å»å¼¥è¡¥è¿™ä¸ªä¸è¶³ã€‚&lt;/p>
&lt;p>å°±ä»¥è¿™é¢˜ä¸ºä¾‹ï¼Œå¦‚ä½•ä½¿ç”¨ç®€å•ã€ç›´æ¥çš„æ–¹æ³•ï¼Œè¿…é€Ÿæ­£ç¡®çš„æ‰¾å‡ºå˜åŒ–çš„æ˜ å°„è§„å¾‹ã€‚&lt;/p>
&lt;h2 id="åˆæ­¥æ€è·¯">åˆæ­¥æ€è·¯ &lt;a href="#%e5%88%9d%e6%ad%a5%e6%80%9d%e8%b7%af" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºä¸å¯ä»¥ä½¿ç”¨&lt;strong>é¢å¤–çš„ç©ºé—´&lt;/strong>ã€‚æ‰€ä»¥å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåæ ‡æ˜ å°„&lt;code>f(x, y) =&amp;gt; (next_x, next_y)&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¾ªç¯æ¥&lt;code>swap&lt;/code>çŸ©é˜µä¸­çš„å…ƒç´ ã€‚&lt;/p>
&lt;h2 id="é‡åˆ°é—®é¢˜">é‡åˆ°é—®é¢˜ &lt;a href="#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¦‚ä½•ç¡®å®šæ˜ å°„&lt;code>f(x, y)&lt;/code>ï¼Ÿ&lt;/p>
&lt;p>ç”±äºæˆ‘çš„æ€ç»´ä¸èƒ½æ”¯æŒæˆ‘åœ¨å¤´è„‘ä¸­å½¢æˆæ­£ç¡®çš„å…¬å¼ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘æƒ³åˆ°ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ±‚çš„å˜æ¢æ˜¯åœ¨äºŒç»´çŸ©é˜µä¸­çš„ç®€å•ç§»ä½ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšå‡ºå¦‚ä¸‹ä¸€ä¸ªæ–¹ç¨‹ã€‚&lt;/p>
&lt;p>&lt;code>f(x, y) = (ax + by + c, dx + ey + f)&lt;/code>&lt;/p>
&lt;p>ç„¶åæ‰¾å‡ºç‰¹æ®Šç‚¹ï¼Œä»£å…¥æ–¹ç¨‹ä¸­ï¼Œæ±‚å‡º&lt;code>a&lt;/code>åˆ°&lt;code>f&lt;/code>å„è‡ªä»£è¡¨çš„å€¼ã€‚&lt;/p>
&lt;p>äºæ˜¯æ±‚å‡ºæ˜ å°„&lt;code>f(x, y) =&amp;gt; (y, n - x)&lt;/code>ã€‚&lt;/p>
&lt;p>å³å¯ä»¥åˆ†è§£ä¸ºï¼š&lt;code>reverse_X(Matrix.T)&lt;/code>&lt;/p>
&lt;h2 id="æ€è€ƒæ–¹å¼">æ€è€ƒæ–¹å¼ &lt;a href="#%e6%80%9d%e8%80%83%e6%96%b9%e5%bc%8f" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ä»¥ä¸Šçš„æ–¹æ³•æ˜¯æˆ‘å¤±è´¥äº†Næ¬¡ä¹‹åæ‰æƒ³åˆ°çš„ã€‚ï¼ˆå¼±ã€‚ã€‚ã€‚ï¼‰&lt;/p>
&lt;p>äºæ˜¯æˆ‘åˆæœ‰äº†è¿›ä¸€æ­¥çš„æ€è€ƒã€‚&lt;/p>
&lt;p>è¿™æ ·çš„æ€è€ƒæ–¹å¼æ˜¯ä¸æ˜¯æœ€ä½³çš„ã€‚å¦‚æœå¤§å®¶é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œä¼šç”¨ä»€ä¹ˆå·§å¦™çš„æ–¹æ³•å»æ€è€ƒï¼Œå»ä¼˜é›…çš„è§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸è¿‡è¦è®°å¾—æˆ‘ä»¬çš„æ¡ä»¶&lt;/p>
&lt;ul>
&lt;li>çŸ©é˜µé¡ºæ—¶é’ˆæ—‹è½¬90åº¦&lt;/li>
&lt;li>in-placeå˜æ¢ï¼Œä¸å¾—ä½¿ç”¨é¢å¤–çš„ç©ºé—´&lt;/li>
&lt;/ul>
&lt;p>æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„çœ‹æ³•ã€‚ä»£ç è¯·è´´åˆ°&lt;a href="https://gist.github.com/">gist&lt;/a>æˆ–&lt;a href="http://lpaste.net/">hpaste&lt;/a>ç­‰ç½‘ç«™ä¸Šï¼Œä¸è¦æŠŠä»£ç ç›´æ¥å†™åˆ°è¯„è®ºä¸­ï¼Œæˆ‘ä¼šåŠæ—¶updateæœ¬æ–‡ï¼Œå±•ç¤ºå¤§å®¶çš„æƒ³æ³•ã€‚&lt;/p></description></item><item><title>Codeforces Round #221 (Div. 2)ä¸å®Œå…¨ä¸æ­£ç¡®é¢˜è§£</title><link>https://wizmann.top/posts/cf-221-div-2/</link><pubDate>Wed, 25 Dec 2013 19:05:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-221-div-2/</guid><description>&lt;h2 id="a-lever">A. Lever &lt;a href="#a-lever" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ°´é¢˜ï¼Œæ æ†åŸç†ã€‚&lt;/p>
&lt;p>ç”¨&lt;code>^&lt;/code>æŠŠå­—ç¬¦ä¸²åˆ†å‰²å¼€ã€‚ç„¶ååˆ†åˆ«è®¡ç®—ä¸¤è¾¹çš„é‡é‡å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Result: Dec 24, 2013 6:04:41 PM Wizmann A - Lever Python 2 Accepted 312 ms 4200 KB&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">calc&lt;/span>(ss):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> item &lt;span style="color:#f92672">in&lt;/span> ss:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> item &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;=&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> int(item)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> t &lt;span style="color:#f92672">*&lt;/span> p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>s &lt;span style="color:#f92672">=&lt;/span> raw_input()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(a, b) &lt;span style="color:#f92672">=&lt;/span> s&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#39;^&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>left &lt;span style="color:#f92672">=&lt;/span> calc(a[::&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>right &lt;span style="color:#f92672">=&lt;/span> calc(b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> left &lt;span style="color:#f92672">==&lt;/span> right:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;balance&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">elif&lt;/span> left &lt;span style="color:#f92672">&amp;gt;&lt;/span> right:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;left&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;right&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="b-iou">B. I.O.U. &lt;a href="#b-iou" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ°´é¢˜ï¼Œç®—å‡ºæ¯ä¸ªäººè´Ÿå€ºå’Œè´·å‡ºï¼ˆè¿™ä¸ªè¯çš„ç°å­¦çš„~ï¼‰çš„ç»å¯¹å€¼å·®ã€‚&lt;/p>
&lt;p>ç„¶åå†æ±‚å’Œé™¤2ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Result: Dec 24, 2013 6:12:53 PM Wizmann B - I.O.U. Python 2 Accepted 46 ms 0 KB&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(n, m) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>inv &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>outv &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(m):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (a, b, c) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outv[a] &lt;span style="color:#f92672">+=&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inv[b] &lt;span style="color:#f92672">+=&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> abs(inv[i] &lt;span style="color:#f92672">-&lt;/span> outv[i])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">while&lt;/span> res &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#Trickï¼Œå¦‚æœres % 2 != 0çš„è¯ï¼Œæˆ‘çš„ç®—æ³•å°±æ˜¯å®Œå…¨é”™è¯¯çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#æ­¤æ—¶è¿”å›TLEè€Œä¸æ˜¯WA&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print res &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="c-divisible-by-seven">C. Divisible by Seven &lt;a href="#c-divisible-by-seven" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è„‘ç­‹æ€¥è½¬å¼¯ã€‚&lt;/p>
&lt;p>é€šè¿‡æ‰“è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºã€‚&lt;code>permutation(1, 6, 8, 9) % 7 == [0 ... 6]&lt;/code>ã€‚&lt;/p>
&lt;p>ç”±æ­¤æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºå…¶å®ƒæ•°å­—æ’åˆ—å¦‚ä½•ï¼Œåªè¦åœ¨å…¶åé¢è¡¥ä¸Š&lt;code>1, 6, 8, 9&lt;/code>çš„ä¸€ä¸ªæ’åˆ—ã€‚å°±å¯ä»¥ä½¿å…¶æ¨¡7å¾—0ã€‚&lt;/p>
&lt;p>å¯¹äºåªæœ‰&lt;code>1ï¼Œ6, 8, 9&lt;/code>å’Œå¾ˆå¤š&lt;code>0&lt;/code>çš„æƒ…å†µã€‚æˆ‘ä»¬å°±æŠŠ&lt;code>0&lt;/code>æ”¾åœ¨&lt;code>1, 6ï¼Œ8ï¼Œ9&lt;/code>åé¢ã€‚&lt;/p>
&lt;p>ä»£ç æ¯”è¾ƒä¹±ã€‚ä¸è¿‡æ€è·¯å¾ˆæ˜æ˜¾:)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//Result: Dec 24, 2013 7:48:42 PM Wizmann C - Divisible by Seven GNU C++ Accepted 140 ms 1000 KB
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1001000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> g[&lt;span style="color:#ae81ff">12&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> buffer[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, buffer) &lt;span style="color:#f92672">!=&lt;/span> EOF) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(g, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(g));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> all &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; buffer[i]; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> t &lt;span style="color:#f92672">=&lt;/span> buffer[i] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[t]&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> all&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[&lt;span style="color:#ae81ff">6&lt;/span>]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[&lt;span style="color:#ae81ff">8&lt;/span>]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[&lt;span style="color:#ae81ff">9&lt;/span>]&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> all &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (all &lt;span style="color:#f92672">==&lt;/span> g[&lt;span style="color:#ae81ff">0&lt;/span>]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;1869&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> all; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;0&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> mod &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ii &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> g[ii]; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d&amp;#34;&lt;/span>, ii);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">=&lt;/span> mod &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#f92672">+&lt;/span> ii;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">%=&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">*=&lt;/span> &lt;span style="color:#ae81ff">10000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">%=&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mod &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">7&lt;/span> &lt;span style="color:#f92672">-&lt;/span> mod)&lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span>(mod) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;1869&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;6819&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;6918&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;6891&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;8691&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;1986&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;8196&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-maximum-submatrix-2">D. Maximum Submatrix 2 &lt;a href="#d-maximum-submatrix-2" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å…¶å®è¿™é¢˜ä¹Ÿåº”è¯¥æ˜¯æ°´é¢˜ã€‚&lt;/p>
&lt;p>ç»™ä½ ä¸€ä¸ª&lt;code>0/1&lt;/code>çŸ©é˜µï¼Œå¯ä»¥åšè¡Œäº¤æ¢ï¼Œè®©ä½ æ±‚å‡ºäº¤æ¢åèƒ½è·å¾—çš„æœ€å¤§ç”±&lt;code>1&lt;/code>ç»„æˆçš„å­é˜µã€‚&lt;/p>
&lt;p>è¿™ä¸ªé¢˜å’Œä¸¤ä¸ªé¢˜å¾ˆç›¸ä¼¼ï¼Œä¸€ä¸ªæ˜¯ç»å…¸çš„&lt;code>æœ€å¤§å­é˜µå’Œ&lt;/code>é—®é¢˜ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸å¤ªç»å…¸çš„&lt;code>ç›´æ–¹å›¾ä¸­æœ€å¤§çŸ©å½¢&lt;/code>é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºåªæœ‰è¡Œå˜æ¢ï¼Œæ‰€ä»¥å¯¹åˆ—ä¸Šçš„&lt;code>0/1&lt;/code>åˆ†å¸ƒæ²¡æœ‰ä»»ä½•å½±å“ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å¤„ç†å‡ºä»¥æŸåˆ—ä¸ºåŸºå‡†æ—¶ï¼ŒæŸè¡Œçš„æœ€å¤§å­é˜µã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-cf221-div2-d.png" alt="å­é˜µ">&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è®¡ç®—åˆ°ç¬¬äºŒåˆ—çš„æ—¶å€™ã€‚å¯ä»¥å¤„ç†å‡ºæ¯ä¸€è¡Œçš„æœ€å¤§å­é˜µã€‚ç”±äºæˆ‘ä»¬å¯ä»¥è¿›è¡Œè¡Œå˜æ¢ï¼Œäºæ˜¯æˆ‘ä»¬å°†æ¯è¡Œçš„æœ€å¤§å­é˜µè¿›è¡Œæ’åºã€‚ç„¶åéå†æ±‚å‡ºå½“å‰çš„æœ€å¤§å­é˜µï¼Œä»è€Œå¾—å‡ºç­”æ¡ˆã€‚&lt;/p>
&lt;p>ä»£ç ç®€å•ã€‚ä¸è¿‡æœ‰æ€§èƒ½é—®é¢˜ã€‚æ²¡æœ‰å……åˆ†ä½¿ç”¨cacheï¼Œä¸è¿‡100+mså°±è¿‡äº†ï¼Œæ‡’å¾—ä¼˜åŒ–äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5120&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> g[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> buffer[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stack&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(g, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(g));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(buffer, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(buffer));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st &lt;span style="color:#f92672">=&lt;/span> stack&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, buffer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> m &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; j &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buffer[j] &lt;span style="color:#f92672">-=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (buffer[j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> g[i][j] &lt;span style="color:#f92672">=&lt;/span> p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vec.push_back(g[j][i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(vec.begin(), vec.end());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> t &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> max(t, vec[j] &lt;span style="color:#f92672">*&lt;/span> (n &lt;span style="color:#f92672">-&lt;/span> j));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="e-circling-round-treasures">E. Circling Round Treasures &lt;a href="#e-circling-round-treasures" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>èµ›åå­¦ä¹ æ¥çš„ä»£ç ã€‚çŠ¶å‹DPã€‚&lt;/p>
&lt;p>é¢˜ç›®æè¿°è¶…çº§å¤æ‚ï¼Œå…¶å®åœ¨é¢˜ç›®ä¸­å·²ç»æš—ç¤ºäº†åšæ³•ã€‚&lt;/p>
&lt;p>ä¸è¿‡ä»¥è¿™ä¸ªä»£ç å¤æ‚ç¨‹åº¦ï¼Œæ¯”èµ›æ—¶èƒ½åšå‡ºæ¥ä¹Ÿæ˜¯æ¯”è¾ƒç‰›çš„äººäº†ã€‚&lt;/p>
&lt;p>ä¸æƒ³èµ˜è¿°è§£æ³•äº†ï¼Œåªè¯´ä¸€ä¸ªå…³é”®ç‚¹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Let&amp;rsquo;s draw a ray that starts from point p and does not intersect other points of the table (such ray must exist).&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Let&amp;rsquo;s count the number of segments of the polyline that intersect the painted ray. If this number is odd, we assume that point p (and consequently, the table cell) lie inside the polyline (path). Otherwise, we assume that it lies outside.&lt;/p>&lt;/blockquote>
&lt;p>é¢˜ç›®ä¸­ç»™å‡ºäº†åˆ¤æ–­ä¸€ä¸ªå®è—æ˜¯å¦åœ¨è·¯å¾„ä¸­çš„ä¸€ä¸ªåˆ¤æ–­ç®—æ³•ã€‚å³åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢ä¸­çš„ç»å…¸å°„çº¿æ³•ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥è®°å½•æŸä¸€æ­¥æ˜¯å¦åœ¨æŸä¸ªå®è—çš„&lt;code>å°„çº¿&lt;/code>ä¸Šã€‚è€Œå°„çº¿çš„æ–¹å‘åˆ™å¯ä»¥è‡ªå®šã€‚ä»£ç ä¸­çš„å°„çº¿æ–¹å‘æ˜¯&lt;code>+x&lt;/code>æ–¹å‘ã€‚å¦‚æœæŸä¸€æ¡è¾¹ç»è¿‡äº†è¿™æ¡å°„çº¿ï¼Œåˆ™ä¿®æ”¹å½“å‰çŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//Result: Dec 25, 2013 2:22:27 PM Wizmann E - Circling Round Treasures GNU C++ Accepted 31 ms 1400 KB
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stack&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;queue&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> mx[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> my[] &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> GOLD &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">point&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x, y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> point(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> point(&lt;span style="color:#66d9ef">int&lt;/span> ix, &lt;span style="color:#66d9ef">int&lt;/span> iy)&lt;span style="color:#f92672">:&lt;/span> x(ix), y(iy){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> point p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> status;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(&lt;span style="color:#66d9ef">int&lt;/span> ix, &lt;span style="color:#66d9ef">int&lt;/span> iy, &lt;span style="color:#66d9ef">int&lt;/span> istatus)&lt;span style="color:#f92672">:&lt;/span> p(ix, iy), status(istatus) {};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n,m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> gold, bomb;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> maze[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> status[SIZE][SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">char&lt;/span> visit[SIZE][SIZE][&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> GOLD];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> step[SIZE][SIZE][&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> GOLD];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> sum[&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> GOLD];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> v[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>point st;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">bfs&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> queue&lt;span style="color:#f92672">&amp;lt;&lt;/span>node&lt;span style="color:#f92672">&amp;gt;&lt;/span> q;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit[st.y][st.x][&lt;span style="color:#ae81ff">0&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.push(node(st.x, st.y, &lt;span style="color:#ae81ff">0&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>q.empty()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node now &lt;span style="color:#f92672">=&lt;/span> q.front();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.pop();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x &lt;span style="color:#f92672">=&lt;/span> now.p.x, y &lt;span style="color:#f92672">=&lt;/span> now.p.y, nowst &lt;span style="color:#f92672">=&lt;/span> now.status;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nx &lt;span style="color:#f92672">=&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> mx[i], ny &lt;span style="color:#f92672">=&lt;/span> y &lt;span style="color:#f92672">+&lt;/span> my[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (nx &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> nx &lt;span style="color:#f92672">==&lt;/span> m &lt;span style="color:#f92672">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ny &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> ny &lt;span style="color:#f92672">==&lt;/span> n &lt;span style="color:#f92672">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> maze[ny][nx] &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span>) &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nst &lt;span style="color:#f92672">=&lt;/span> nowst;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (my[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) nst &lt;span style="color:#f92672">^=&lt;/span> status[ny][nx];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (my[i] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) nst &lt;span style="color:#f92672">^=&lt;/span> status[y][x];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (visit[ny][nx][nst]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> visit[ny][nx][nst] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> q.push(node(nx, ny, nst));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step[ny][nx][nst] &lt;span style="color:#f92672">=&lt;/span> step[y][x][nowst] &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gold &lt;span style="color:#f92672">=&lt;/span> bomb &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scanf(&lt;span style="color:#e6db74">&amp;#34;%s&amp;#34;&lt;/span>, maze[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (maze[i][j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;S&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> st &lt;span style="color:#f92672">=&lt;/span> point(j, i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> maze[i][j] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;.&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (isdigit(maze[i][j])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gold&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> nr &lt;span style="color:#f92672">=&lt;/span> maze[i][j] &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#e6db74">&amp;#39;1&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; k &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; k&lt;span style="color:#f92672">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> status[i][k] &lt;span style="color:#f92672">|=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> nr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> gold; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(v[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> gold); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> gold; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (i &lt;span style="color:#f92672">&amp;amp;&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> j)) sum[i] &lt;span style="color:#f92672">+=&lt;/span> v[j];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bomb &lt;span style="color:#f92672">=&lt;/span> gold;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> j &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; j &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; j&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (maze[i][j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;B&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> k &lt;span style="color:#f92672">=&lt;/span> j &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; k &lt;span style="color:#f92672">&amp;lt;&lt;/span> m; k&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> status[i][k] &lt;span style="color:#f92672">|=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> bomb;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bomb&lt;span style="color:#f92672">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bfs();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> gold); i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (visit[st.y][st.x][i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> max(ans, sum[i] &lt;span style="color:#f92672">-&lt;/span> step[st.y][st.x][i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(ans);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æœ€åç‚«è€€ä¸€ä¸‹">æœ€åï¼Œç‚«è€€ä¸€ä¸‹ &lt;a href="#%e6%9c%80%e5%90%8e%e7%82%ab%e8%80%80%e4%b8%80%e4%b8%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-cf221-div2-rank.png" alt="rank">&lt;/p></description></item><item><title>è‡ªå·±åŠ¨æ‰‹æ­å»ºç¬¬ä¸‰æ–¹çš„Codeforces CDN</title><link>https://wizmann.top/posts/third-party-codeforces-cdn/</link><pubDate>Sat, 14 Dec 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/third-party-codeforces-cdn/</guid><description>&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ ¡å›­ç½‘ä¸ŠCFé‚£å«ä¸€ä¸ªå¡ã€‚&lt;/p>
&lt;p>åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸ºcodeforceså¤§é‡çš„ä½¿ç”¨äº†ajaxæŠ€æœ¯ï¼Œæ‰€ä»¥å¼•ç”¨äº†å¾ˆå¤šjs/cssæ–‡ä»¶ï¼Œå¹¶ä¸”å¼•ç”¨çš„ä½ç½®ä½äºé¡µé¢ä¹‹å‰ã€‚&lt;/p>
&lt;p>è¿™å°±é€ æˆäº†ï¼Œæˆ‘ä»¬åœ¨ä¸ŠCFçš„æ—¶å€™ï¼Œå…¶å®é¡µé¢å†…å®¹å·²ç»è¯»å–å‡ºæ¥äº†ã€‚ä½†æ˜¯å› ä¸ºjs/cssæ–‡ä»¶æ²¡æœ‰åŠ è½½å®Œæˆï¼Œæ‰€ä»¥é¡µé¢è¿˜æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚&lt;/p>
&lt;h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºjs/css/imgæ–‡ä»¶éƒ½æ˜¯æ‰€è°“çš„&lt;code>é™æ€&lt;/code>æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼“å­˜è¿™äº›æ–‡ä»¶åˆ°ä¸€ä¸ªè®¿é—®é€Ÿåº¦å¿«çš„ç½‘ç»œä¸Šæ¥ã€‚&lt;/p>
&lt;p>è¿™å°±æ˜¯CDNæŠ€æœ¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>CDNçš„å…¨ç§°æ˜¯Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚å…¶ç›®çš„æ˜¯é€šè¿‡åœ¨ç°æœ‰çš„Internetä¸­å¢åŠ ä¸€å±‚æ–°çš„ç½‘ç»œæ¶æ„ï¼Œå°†ç½‘ç«™çš„å†…å®¹å‘å¸ƒåˆ°æœ€æ¥è¿‘ç”¨æˆ·çš„ç½‘ç»œâ€œè¾¹ç¼˜â€ï¼Œä½¿ç”¨æˆ·å¯ä»¥å°±è¿‘å–å¾—æ‰€éœ€çš„å†…å®¹ï¼Œæé«˜ç”¨æˆ·è®¿é—®ç½‘ç«™çš„å“åº”é€Ÿåº¦&lt;/p>&lt;/blockquote>
&lt;p>ä½†æ˜¯ä¿„ç½—æ–¯äººé‚£è¾¹æ²¡æœ‰åšCDNï¼Œæˆ–è€…ä»–ä»¬çš„CDNè·ç¦»å¤©æœå®åœ¨æ˜¯å¤ªè¿œäº†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åªå¥½æ‰‹åŠ¨ç¼“å­˜è¿™äº›é™æ€æ–‡ä»¶åˆ°ä¸ƒç‰›äº‘ä¸Šï¼Œä½¿ç”¨ä¸ƒç‰›çš„CDNæŠ€æœ¯æ¥åŠ é€Ÿæˆ‘ä»¬çš„è®¿é—®äº†ã€‚&lt;/p>
&lt;p>&lt;a href="http://www.qiniu.com/">ä¸ƒç‰›äº‘&lt;/a>ä¸ºä¸ªäººç”¨æˆ·æä¾›äº†10Gå­˜å‚¨ç©ºé—´å’Œæ¯æœˆ10Gæµé‡ï¼Œè¿™å¯¹äºæˆ‘ä»¬ç¼“å­˜ä¸€ä¸ªç½‘ç«™çš„é™æ€æ–‡ä»¶æ¥è¯´ï¼Œå·²ç»è¶³å¯Œè£•äº†ã€‚æ ¹æ®æˆ‘ç°åœ¨çš„ä½¿ç”¨çŠ¶å†µï¼Œæ‰€æœ‰é™æ€æ–‡ä»¶åŠ åœ¨ä¸€èµ·å¤§æ¦‚åœ¨3Må·¦å³ï¼Œæ­å»ºè¿™æ ·ä¸€ä¸ªå…è´¹CDNå¯ä»¥ä¾›åå‡ ä¸ªäººä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="è®¾è®¡æ¶æ„">è®¾è®¡æ¶æ„ &lt;a href="#%e8%ae%be%e8%ae%a1%e6%9e%b6%e6%9e%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬ä½¿ç”¨&lt;code>CSæ¨¡å¼&lt;/code>æ¥å®Œæˆè¿™ä¸ªç½‘ç«™åŠ é€Ÿçš„ä»»åŠ¡ã€‚&lt;/p>
&lt;p>Serverç«¯å½“ç„¶å°±æ˜¯ä¸ƒç‰›äº‘å•¦ã€‚å¤æ‚çš„ä»»åŠ¡éƒ½äº¤ç»™äº†å·¥ç¨‹å¸ˆä»¬å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜éœ€è¦ç¼“å­˜&lt;code>codeforces.com&lt;/code>çš„é™æ€æ–‡ä»¶å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>Clientç«¯ä½¿ç”¨çš„æ˜¯Chrome-extensionã€‚Chrome-extensionä½¿ç”¨&lt;code>webRequest&lt;/code>æ¥â€œåŠ«æŒâ€æˆ‘ä»¬çš„æµé‡ï¼Œå°†å…¶æŒ‡å‘æˆ‘ä»¬çš„ä¸ƒç‰›äº‘ç¼“å­˜ã€‚&lt;/p>
&lt;h2 id="serverç«¯é…ç½®">Serverç«¯é…ç½® &lt;a href="#server%e7%ab%af%e9%85%8d%e7%bd%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>éå¸¸ç®€å•çš„æ“ä½œã€‚è®¾ç½®ä¸€ä¸ªé•œåƒå­˜å‚¨å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-codeforces-cdn-qiniu-settings.png" alt="ä¸ƒç‰›äº‘è®¾ç½®">&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬è®°ä¸‹ä¸ƒç‰›äº‘ä¸ºæˆ‘ä»¬åˆ†é…çš„åŸŸåï¼Œä»¥å¤‡åç”¨ã€‚&lt;/p>
&lt;h2 id="clientç«¯é…ç½®">Clientç«¯é…ç½® &lt;a href="#client%e7%ab%af%e9%85%8d%e7%bd%ae" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä¸è¿‡ä¹Ÿæ˜¯å¾ˆè½»æ¾çš„ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå¼€å‘ç‰ˆçš„chrome-extensionã€‚ï¼ˆç”±äºæˆ‘æ²¡æœ‰å¼€å‘è€…è´¦å·ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯çº¿ä¸‹å¼€å‘ï¼Œæ”¾åˆ°githubä¸Šè®©å¤§å®¶æçš„ã€‚&lt;/p>
&lt;p>å†™&lt;code>manifest.json&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;name&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Codeforce CDNåŠ é€Ÿ&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;version&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;0.1&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;description&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;ä¸ªäººæ€§è¶£æ‰€è‡´ï¼Œä¸æ‰¿æ‹…ä»»ä½•å¯èƒ½çš„é£é™©&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;permissions&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;tabs&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;http://*.codeforces.com/*&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;http://*.codeforces.ru/*&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;webRequestBlocking&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;webRequest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;background&amp;#34;&lt;/span>: { &lt;span style="color:#f92672">&amp;#34;scripts&amp;#34;&lt;/span>: [&lt;span style="color:#e6db74">&amp;#34;codeforces_cdn.js&amp;#34;&lt;/span>] },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;browser_action&amp;#34;&lt;/span>:{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;default_title&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Codeforce CDNåŠ é€Ÿ&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;default_icon&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;icon.png&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;icons&amp;#34;&lt;/span>:{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;16&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;icon.png&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;48&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;icon.png&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;128&amp;#34;&lt;/span>:&lt;span style="color:#e6db74">&amp;#34;icon.png&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;manifest_version&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åå†™&lt;code>background.js&lt;/code>ï¼Œâ€œåŠ«æŒâ€å‘å¾€&lt;code>work.codeforces.ru&lt;/code>çš„æµé‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">chrome&lt;/span>.&lt;span style="color:#a6e22e">webRequest&lt;/span>.&lt;span style="color:#a6e22e">onBeforeRequest&lt;/span>.&lt;span style="color:#a6e22e">addListener&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">details&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">details&lt;/span>.&lt;span style="color:#a6e22e">url&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">details&lt;/span>.&lt;span style="color:#a6e22e">url&lt;/span>.&lt;span style="color:#a6e22e">match&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;http://worker.codeforces.ru&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">details&lt;/span>.&lt;span style="color:#a6e22e">url&lt;/span>.&lt;span style="color:#a6e22e">replace&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;http://worker.codeforces.ru&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;http://ä½ çš„ä¸ƒç‰›äº‘åŸŸå.com&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> {&lt;span style="color:#a6e22e">redirectUrl&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">url&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#a6e22e">urls&lt;/span>&lt;span style="color:#f92672">:&lt;/span>[&lt;span style="color:#e6db74">&amp;#34;http://worker.codeforces.ru/*&amp;#34;&lt;/span>]},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [&lt;span style="color:#e6db74">&amp;#34;blocking&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åå®‰è£…æ’ä»¶ï¼Œå°±å¯ä»¥å®Œç¾ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>æ ¹æ®æˆ‘çš„å®éªŒï¼Œåœ¨æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜çš„æƒ…å†µä¸‹ã€‚åŠ é€Ÿå‰éœ€è¦3minçš„é¡µé¢å¤§æ¦‚ç°åœ¨åªéœ€è¦ä¸åˆ°10sã€‚&lt;/p>
&lt;h2 id="æ½œåœ¨é—®é¢˜ä»¥åŠä¸å®Œç¾çš„è§£å†³æ–¹æ¡ˆ">æ½œåœ¨é—®é¢˜ä»¥åŠä¸å®Œç¾çš„è§£å†³æ–¹æ¡ˆ &lt;a href="#%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98%e4%bb%a5%e5%8f%8a%e4%b8%8d%e5%ae%8c%e7%be%8e%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>ç”±äºæˆ‘ä»¬æ˜¯ç¬¬ä¸‰æ–¹çš„å±±å¯¨CDNï¼Œæ‰€ä»¥å½“codeforces.comæ›´æ–°å®ƒçš„é™æ€æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ·æ–°é™æ€æ–‡ä»¶çš„æœºåˆ¶ã€‚ä½†æ˜¯æˆ‘ä»¬åˆä¸èƒ½ç›‘æ§æ–‡ä»¶æ”¹å˜ã€‚&lt;/p>
&lt;p>æœ€ç»ˆï¼Œæˆ‘æƒ³åˆ°çš„ä¸€ä¸ªä¸å®Œç¾çš„è§£å†³æ–¹æ¡ˆæ˜¯å®šæ—¶åˆ·æ–°ã€‚&lt;/p>
&lt;p>è¯¦ç»†æ¥è¯´ï¼Œå°±æ˜¯æ¯å‘¨æ‰¾ä¸€ä¸ªæ—¶é—´ï¼Œæ¸…ç©ºæˆ‘ä»¬çš„ç¼“å­˜ã€‚åœ¨ä¸‹ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œä¸ƒç‰›äº‘ä¼šè‡ªåŠ¨æ›¿æˆ‘ä»¬åˆ·æ–°æ‰€æœ‰çš„é™æ€æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸ƒç‰›äº‘çš„python-sdkæä¾›äº†éå†/åˆ é™¤æ–‡ä»¶çš„æ–¹æ¡ˆï¼ˆæˆ‘åœ¨é‡Œé¢è¿˜æ‰¾åˆ°äº†ä¸€ä¸ªå°å°çš„Bugï¼‰ã€‚æˆ‘ä»¬åªéœ€è¦å®šæ—¶æ‰§è¡Œå®ƒå°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä½¿ç”¨äº†BAE + bottle.py + niqiu-python-sdkçš„ç»„åˆã€‚åœ¨BAEä¸Šéƒ¨ç½²äº†ä¸€ä¸ªbottle.pyåº”ç”¨ï¼Œç„¶åä½¿ç”¨&lt;code>cron&lt;/code>å®šæ—¶æ‰§è¡Œåˆ·æ–°ä»»åŠ¡ã€‚&lt;/p>
&lt;h2 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Github: &lt;a href="https://github.com/Wizmann/codeforces-cdn">æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>Codeforces Round #218 (Div. 2)ä¸å®Œå…¨ä¸æ­£ç¡®é¢˜è§£</title><link>https://wizmann.top/posts/cf-218-div-2/</link><pubDate>Mon, 09 Dec 2013 23:02:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-218-div-2/</guid><description>&lt;h3 id="a-k-periodic-array">A. K-Periodic Array &lt;a href="#a-k-periodic-array" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å°†Arrayåˆ‡ç‰‡ï¼Œç„¶åæŒ‰ä½ç»Ÿè®¡æŸä¸€ä½ä¸Š1çš„ä¸ªæ•°C(1)å’Œ2çš„ä¸ªæ•°C(2)ã€‚ç„¶ååœ¨è¿™ä¸€ä½ä¸Šçš„æ“ä½œæ•°å°±ä¸ºM = min(C(1), C(2))ã€‚&lt;/p>
&lt;p>ç®€å•é¢˜&lt;/p>
&lt;h3 id="b-fox-dividing-cheese">B. Fox Dividing Cheese &lt;a href="#b-fox-dividing-cheese" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‚»é€¼æ‰é”™çš„é¢˜ï¼Œä¸å¹¸ä¸­æªã€‚&lt;/p>
&lt;p>ä¸æƒ³å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä»£ç å§ã€‚æ‰‹è´±ä¸æ˜¯ç—…ï¼Œè´±èµ·æ¥è¦äººå‘½ã€‚&lt;/p>
&lt;h3 id="c-hamburgers">C. Hamburgers &lt;a href="#c-hamburgers" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ¨¡æ‹Ÿ + äºŒåˆ†ã€‚&lt;/p>
&lt;p>å’ŒCJLè¿˜è®¨è®ºè¿‡è¿™é¢˜çš„çº¯æ¨¡æ‹Ÿåšæ³•ï¼Œçœ‹äº†åŠå¤©ä»£ç æ²¡æ‰¾åˆ°é—®é¢˜ã€‚äºæ˜¯åˆšæ‰ç”¨Pythonè‡ªå·±å®ç°äº†ä¸€ä¸ªï¼Œåœ¨ä»£ç æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰WAï¼Œä½†æ˜¯Tåœ¨äº†22ç»„ä¸Šã€‚&lt;/p>
&lt;p>æ‰€ä»¥è¿™é¢˜æœ€å¥½ä½¿ç”¨äºŒåˆ†ï¼Œå¦‚æœç”¨æ¨¡æ‹Ÿçš„è¯ï¼Œéœ€è¦è€ƒè™‘å„ç§æƒ…å†µã€‚ä»£ç è§ä¸‹ï¼Œç»†èŠ‚ä¸Šæ³¨æ„å°±å¥½ã€‚&lt;/p>
&lt;h3 id="d-vessels">D. Vessels &lt;a href="#d-vessels" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é¢˜å¾—å¥½å¥½è®²ä¸€ä¸‹ï½æ¯”èµ›æ—¶åšå‡ºæ¥äº†å¥½å¾—æ„ï½&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-cf-218-div-2-d-vessels.png" alt="Vessels">&lt;/p>
&lt;p>é¢˜æ„æ˜¯ç»™å‡ºä¸€ç»„å±‚å±‚å çš„å®¹å™¨ï¼Œæ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±çš„å®¹é‡ã€‚ç„¶åæˆ‘ä»¬å‘æŸäº›å®¹å™¨é‡ŒçŒæ°´ï¼Œå¦‚æœæ°´çš„ä½“ç§¯è¶…è¿‡äº†æŸä¸ªå®¹å™¨çš„å®¹é‡ï¼Œåˆ™å‰©ä½™çš„æ°´æº¢å‡ºåˆ°ä¸‹ä¸€ä¸ªå®¹å™¨ä¸­ã€‚æœ€åä¸€ä¸ªå®¹å™¨æº¢å‡ºçš„æ°´ä¼šè½åˆ°åœ°é¢ä¸Šï¼Œæ‰€ä»¥å¿½ç•¥ä¸è®¡ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæŸä¸€ä¸ªå®¹å™¨æ˜¯æ»¡çš„ï¼Œé‚£ä¹ˆå®ƒå°±å†ä¹Ÿä¸ä¼šç©ºä¸‹æ¥ï¼Œå¹¶ä¸”æµç»å®ƒçš„æ°´å…¨éƒ¨æº¢å‡ºç»™ä¸‹é¢çš„å®¹å™¨ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„è®°å½•å½“å‰å®¹å™¨æ³¨æ°´çš„æ—¶å€™ï¼Œæ°´ä¼šæµå‘å“ªä¸ªå®¹å™¨ã€‚&lt;/p>
&lt;p>ç”±äºåœ¨åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰å®¹å™¨éƒ½æ˜¯ç©ºçš„ã€‚æ‰€ä»¥&lt;code>to[i] = i&lt;/code>ã€‚&lt;/p>
&lt;p>å¦‚æœæŸå®¹å™¨ç”±äºæ³¨æ°´æ»¡æ‰äº†ï¼Œæˆ‘ä»¬å°±æŠŠæ³¨æ°´çš„æŒ‡å‘æŒ‡åˆ°&lt;code>i + 1&lt;/code>ï¼Œå°±æœ‰&lt;code>to[i] = i + 1&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸‹æ¬¡åœ¨å‘å®¹å™¨iæ³¨æ°´çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥è¯¢&lt;code>to[i]&lt;/code>çš„å€¼ï¼Œå°±å¯ä»¥çŸ¥é“æ°´çš„æµå‘ã€‚&lt;/p>
&lt;p>è¿™å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªå¹¶æŸ¥é›†é—®é¢˜ã€‚å¦‚æœiæ»¡äº†ï¼Œ&lt;code>to[i] == i + 1&lt;/code>ã€‚ä¸æ­¤åŒæ—¶ï¼Œi+1ä¹Ÿæ»¡äº†ï¼Œåˆ™&lt;code>to[i + 1] == i + 2&lt;/code>ã€‚ä»é¢˜æ„æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶&lt;code>to[i] == to[i + 1] == i + 2&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™æ ·æˆ‘ä»¬å°±å‡ ä¹å¯ä»¥æŠŠæ¯æ¬¡æ³¨æ°´çš„æµå‘çš„æŸ¥è¯¢ä¼˜åŒ–åˆ°&lt;code>O(1)&lt;/code>ã€‚å‰©ä¸‹çš„å°±æ˜¯åŸºæœ¬çš„åŠ å‡æ³•å’Œè¾“å…¥è¾“å‡ºæ“ä½œäº†ã€‚&lt;/p>
&lt;h3 id="e-subway-innovation">E. Subway Innovation &lt;a href="#e-subway-innovation" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ¨å…¬å¼é¢˜ï¼Œä¸“æ²»æ™ºå•†ä¸å¤Ÿã€‚&lt;/p>
&lt;p>ä¸Šä¸€ä»½åˆ«äººçš„é¢˜è§£ï¼Œæˆ‘ä¼°è®¡æ¨ä¸å‡ºæ¥äº†ã€‚ã€‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-cf-218-div-2-e.png" alt="Eé¢˜é¢˜è§£">&lt;/p>
&lt;h3 id="ä»¥ä¸‹æ˜¯ä»£ç ">ä»¥ä¸‹æ˜¯ä»£ç  &lt;a href="#%e4%bb%a5%e4%b8%8b%e6%98%af%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="a">A &lt;a href="#a" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>(n, k) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ll &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(k):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ones &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> twos &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> xrange(i, n, k):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ll[j] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ones &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> twos &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> min(ones, twos)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print ans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="b">B &lt;a href="#b" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> fractions &lt;span style="color:#f92672">import&lt;/span> gcd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">avail&lt;/span>(a):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> a &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">/=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> a &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">/=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> a &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ans &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> a &lt;span style="color:#f92672">/=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> a &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ans
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(a, b) &lt;span style="color:#f92672">=&lt;/span> map(int, raw_input()&lt;span style="color:#f92672">.&lt;/span>split())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>c &lt;span style="color:#f92672">=&lt;/span> gcd(a, b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a &lt;span style="color:#f92672">/=&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>b &lt;span style="color:#f92672">/=&lt;/span> c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>av &lt;span style="color:#f92672">=&lt;/span> avail(a)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gv &lt;span style="color:#f92672">=&lt;/span> avail(b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> av &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">and&lt;/span> gv &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print av &lt;span style="color:#f92672">+&lt;/span> gv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="c">C &lt;a href="#c" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> BUFFER &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">128&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint need[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint have[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint cost[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint money;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint &lt;span style="color:#a6e22e">calc&lt;/span>(llint num) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint t &lt;span style="color:#f92672">=&lt;/span> max(&lt;span style="color:#ae81ff">0LL&lt;/span>, num &lt;span style="color:#f92672">*&lt;/span> need[i] &lt;span style="color:#f92672">-&lt;/span> have[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> t &lt;span style="color:#f92672">*&lt;/span> cost[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint &lt;span style="color:#a6e22e">solve&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint step &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">10000000000000LL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint now &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (step) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint half &lt;span style="color:#f92672">=&lt;/span> step &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint mid &lt;span style="color:#f92672">=&lt;/span> now &lt;span style="color:#f92672">+&lt;/span> half;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (calc(mid) &lt;span style="color:#f92672">&amp;gt;&lt;/span> money) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">=&lt;/span> half;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> now &lt;span style="color:#f92672">=&lt;/span> mid &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> step &lt;span style="color:#f92672">=&lt;/span> step &lt;span style="color:#f92672">-&lt;/span> half &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> now;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> buffer[BUFFER];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (input(buffer)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(need, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(need));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(have, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(have));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(cost, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(money));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; buffer[i]; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (buffer[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;B&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> need[&lt;span style="color:#ae81ff">0&lt;/span>]&lt;span style="color:#f92672">++&lt;/span>; &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;S&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> need[&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">++&lt;/span>; &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;C&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> need[&lt;span style="color:#ae81ff">2&lt;/span>]&lt;span style="color:#f92672">++&lt;/span>; &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(have[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(cost[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(money);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint ans &lt;span style="color:#f92672">=&lt;/span> solve() &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(max(&lt;span style="color:#ae81ff">0LL&lt;/span>, ans));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="d">D &lt;a href="#d" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">200100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> n, m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint cap[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint vessel[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> father[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">find_father&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (father[x] &lt;span style="color:#f92672">==&lt;/span> x) &lt;span style="color:#66d9ef">return&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> father[x] &lt;span style="color:#f92672">=&lt;/span> find_father(father[x]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">pour&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> pos, llint value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vessel[pos] &lt;span style="color:#f92672">+=&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (vessel[pos] &lt;span style="color:#f92672">&amp;gt;&lt;/span> cap[pos]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pos &lt;span style="color:#f92672">==&lt;/span> n &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vessel[pos] &lt;span style="color:#f92672">=&lt;/span> cap[pos];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint overflow &lt;span style="color:#f92672">=&lt;/span> vessel[pos] &lt;span style="color:#f92672">-&lt;/span> cap[pos];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> father[pos] &lt;span style="color:#f92672">=&lt;/span> find_father(pos &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vessel[pos] &lt;span style="color:#f92672">=&lt;/span> cap[pos];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pour(father[pos], overflow);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint &lt;span style="color:#a6e22e">query&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> pos)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> vessel[pos];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> freopen(&lt;span style="color:#e6db74">&amp;#34;input.txt&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;r&amp;#34;&lt;/span>, stdin);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint a, b, c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> SIZE; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> father[i] &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(cap, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(cap));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(vessel, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(vessel));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(cap[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(m);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (m&lt;span style="color:#f92672">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (a &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(b &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pour(&lt;span style="color:#f92672">--&lt;/span>b, c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(query(&lt;span style="color:#f92672">--&lt;/span>b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="e">E &lt;a href="#e" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;set&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> &lt;span style="color:#66d9ef">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define print(x) cout &amp;lt;&amp;lt; x &amp;lt;&amp;lt; endl
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define input(x) cin &amp;gt;&amp;gt; x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#66d9ef">long&lt;/span> llint;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pos, nr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node(&lt;span style="color:#66d9ef">int&lt;/span> ipos, &lt;span style="color:#66d9ef">int&lt;/span> inr)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pos(ipos), nr(inr) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> (&lt;span style="color:#66d9ef">const&lt;/span> node&lt;span style="color:#f92672">&amp;amp;&lt;/span> x) &lt;span style="color:#66d9ef">const&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> pos &lt;span style="color:#f92672">&amp;lt;&lt;/span> x.pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">300008&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>node station[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint leftsum[SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>llint n, k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(station[i].pos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> station[i].nr &lt;span style="color:#f92672">=&lt;/span> i &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input(k);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sort(station, station &lt;span style="color:#f92672">+&lt;/span> n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> leftsum[i] &lt;span style="color:#f92672">=&lt;/span> leftsum[i&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">+&lt;/span> station[i].pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint f &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;=&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#f92672">+=&lt;/span> (llint)station[i].pos &lt;span style="color:#f92672">*&lt;/span> i &lt;span style="color:#f92672">-&lt;/span> leftsum[i&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> llint res &lt;span style="color:#f92672">=&lt;/span> f;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> pos &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> k&lt;span style="color:#f92672">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> n &lt;span style="color:#f92672">-&lt;/span> k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#f92672">+=&lt;/span> station[i&lt;span style="color:#f92672">+&lt;/span>k].pos &lt;span style="color:#f92672">*&lt;/span> k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#f92672">-=&lt;/span> leftsum[i&lt;span style="color:#f92672">+&lt;/span>k&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#f92672">+=&lt;/span> leftsum[i&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#f92672">+=&lt;/span> station[i&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].pos &lt;span style="color:#f92672">*&lt;/span> k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (f &lt;span style="color:#f92672">&amp;lt;&lt;/span> res) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> f;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pos &lt;span style="color:#f92672">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>; i&lt;span style="color:#f92672">&amp;lt;=&lt;/span>k; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;%d &amp;#34;&lt;/span>, station[pos &lt;span style="color:#f92672">+&lt;/span> i].nr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ä½¿ç”¨æ–°ç±»å‹åˆ›å»ºæ›´äººæ€§åŒ–çš„ä»£ç </title><link>https://wizmann.top/posts/humanity-code-with-new-classes/</link><pubDate>Mon, 09 Dec 2013 15:01:00 +0000</pubDate><guid>https://wizmann.top/posts/humanity-code-with-new-classes/</guid><description>&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ç¯‡æ–‡ç« è®¨è®ºäº†å¦‚ä½•é€šè¿‡æ–°å»ºå¹¶éâ€å¿…è¦â€œçš„æ–°ç±»å‹ï¼Œæ¥äº§ç”Ÿæ›´äººæ€§åŒ–çš„C++ä»£ç ã€‚&lt;/p>
&lt;p>å…³é”®è¯ï¼š&lt;/p>
&lt;ul>
&lt;li>RAII&lt;/li>
&lt;li>æ™ºèƒ½æŒ‡é’ˆ&lt;/li>
&lt;li>æ¥å£å‹å¥½&lt;/li>
&lt;li>æ¨¡æ¿&lt;/li>
&lt;li>æ¨¡æ¿ç‰¹åŒ–&lt;/li>
&lt;li>ä¾èµ–ç¼–è¯‘å™¨çš„ç¼ºçœè¡Œä¸º&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºC++çš„è‰ºæœ¯ï¼Œæˆ‘åªæ˜¯ä¸ªå…¥é—¨è€…ã€‚å¦‚æœæ–‡ç« ä¸­æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼Œæˆ‘ä¼šåŠæ—¶è¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;h2 id="ä¸€ä¸ªå‹å¥½çš„äº’æ–¥é”">ä¸€ä¸ªå‹å¥½çš„äº’æ–¥é” &lt;a href="#%e4%b8%80%e4%b8%aa%e5%8f%8b%e5%a5%bd%e7%9a%84%e4%ba%92%e6%96%a5%e9%94%81" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="äº’æ–¥é”çš„å®šä¹‰">äº’æ–¥é”çš„å®šä¹‰ &lt;a href="#%e4%ba%92%e6%96%a5%e9%94%81%e7%9a%84%e5%ae%9a%e4%b9%89" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>äº’æ–¥é”ï¼ˆè‹±è¯­ï¼šè‹±è¯­ï¼šMutual exclusionï¼Œç¼©å†™ Mutexï¼‰æ˜¯ä¸€ç§ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œé˜²æ­¢ä¸¤æ¡çº¿ç¨‹åŒæ—¶å¯¹åŒä¸€å…¬å…±èµ„æºï¼ˆæ¯”å¦‚å…¨å±€å˜é‡ï¼‰è¿›è¡Œè¯»å†™çš„æœºåˆ¶ã€‚è¯¥ç›®çš„é€šè¿‡å°†ä»£ç åˆ‡ç‰‡æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸´ç•ŒåŒºåŸŸï¼ˆcritical sectionï¼‰è¾¾æˆã€‚ä¸´ç•ŒåŒºåŸŸæŒ‡çš„æ˜¯ä¸€å—å¯¹å…¬å…±èµ„æºè¿›è¡Œè®¿é—®çš„ä»£ç ï¼Œå¹¶éä¸€ç§æœºåˆ¶æˆ–æ˜¯ç®—æ³•ã€‚ä¸€ä¸ªç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªä¸´ç•ŒåŒºåŸŸï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šä¼šåº”ç”¨äº’æ–¥é”ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="å¦‚ä½•ä½¿ç”¨äº’æ–¥é”">å¦‚ä½•ä½¿ç”¨äº’æ–¥é” &lt;a href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e4%ba%92%e6%96%a5%e9%94%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™é‡Œåªåšæœ€ç®€å•çš„ç¤ºèŒƒã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å’ŒåŸç†ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;pthread.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyIntArray&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸€ä¸ªå‡æƒ³çš„æ•°ç»„ç±»å‹ï¼Œæ”¯æŒå¤šçº¿ç¨‹ä¸‹çš„Append Onlyæ“ä½œã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MyIntArray()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _vec.clear();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_init(&lt;span style="color:#f92672">&amp;amp;&lt;/span>_mutex, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">push_back&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_lock(&lt;span style="color:#f92672">&amp;amp;&lt;/span>_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// åœ¨è¿™é‡Œåšä¸€äº›å·¥ä½œ, ä¾‹å¦‚æ‰“Logï¼ŒæŠ½é£ç­‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> vec.push_back(v);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_unlock(&lt;span style="color:#f92672">&amp;amp;&lt;/span>_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_t _mutex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vector&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> _vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç ä¸éœ€è¦å¤šè§£é‡Šï¼Œé€šè¿‡ä¸€ä¸ªé”æ¥ä¿è¯å¤šçº¿ç¨‹push_backå‡½æ•°çš„å¯é‡å…¥æ€§ã€‚&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦å¯¹ä»£ç çš„å®‰å…¨æ€§åšä¸€äº›è¯„ä¼°ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚ä½•å¤„ç†ï¼Œå‡½æ•°åœ¨unlock mutexä¹‹å‰å¼‚å¸¸ç»“æŸçš„æƒ…å†µã€‚&lt;/p>
&lt;p>è¿™å¹¶ä¸æ˜¯ä¸å¯èƒ½çš„ï¼Œä¾‹å¦‚&lt;code>vec.push_back(v)&lt;/code>æŠ›å‡ºäº†ä¸€ä¸ª&lt;code>std::bad_alloc&lt;/code>å¼‚å¸¸ã€‚æˆ–è€…åœ¨è¿™ä¹‹å‰å› ä¸ºä¸€äº›åŸå› ï¼Œå‡½æ•°åšå‡ºäº†&lt;code>return -1&lt;/code>çš„è¡Œä¸ºã€‚&lt;/p>
&lt;p>ä¹Ÿè®¸æˆ‘ä»¬åœ¨é€»è¾‘ä¸Šå¯ä»¥æ¥å—è¿™äº›é”™è¯¯ï¼ˆæ¯”å¦‚åšå‡ºä¸€äº›å¤±è´¥å¤„ç†ï¼‰ã€‚ä½†æ˜¯ï¼Œå¯¹äºå› ä¸ºæˆ‘ä»¬æ²¡æœ‰unlockæˆ‘ä»¬çš„åŒæ­¥é”ï¼Œäºæ˜¯æ­»é”å°±äº§ç”Ÿäº†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªæå¤§çš„éšæ‚£ï¼Œæ­»é”çš„å±å®³æˆ‘ä¹Ÿä¸ç”¨å¤šè¯´ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å…è¿™ç§å±€é¢ã€‚&lt;/p>
&lt;h3 id="ä¸€ä¸ªæ–°çš„mutexç±»å‹">ä¸€ä¸ªæ–°çš„Mutexç±»å‹ &lt;a href="#%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84mutex%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;strong>ææ„å‡½æ•°&lt;/strong>çš„ç‰¹æ€§æ¥ç¼–å†™å¦‚ä¸‹çš„ç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;pthread.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Mutex&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Mutex(&lt;span style="color:#66d9ef">explicit&lt;/span> pthread_mutex_t&lt;span style="color:#f92672">*&lt;/span> i_mutex_ptr)&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _mutex(i_mutex_ptr){}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">lock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_lock(_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">~&lt;/span>Mutex()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pthread_mutex_unlock(_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Mutex(); &lt;span style="color:#75715e">// disable the empty construct funtion
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> pthread_mutex_t &lt;span style="color:#f92672">*&lt;/span>_mutex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OKï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç±»åšä¸ºåŒæ­¥é”çš„ç®¡ç†ç±»ï¼Œé‚£ä¹ˆï¼Œå¦‚æœå‡½æ•°ä¸­å‡ºç°äº†éé¢„æœŸçš„æƒ…å†µè€Œè·³å‡ºçš„æ—¶å€™ã€‚&lt;code>Mutex&lt;/code>ç±»å°±ä¼šè‡ªåŠ¨è°ƒç”¨è‡ªèº«çš„ææ„å‡½æ•°æ¥è§£é”ã€‚é¿å…äº†æ­»é”çš„å‘ç”Ÿã€‚&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“ &lt;a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>pthread_mutex_t&lt;/code>æ˜¯ä¸€ä¸ªç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªç±»å‹ä¹‹ä¸Šåˆæ–°å»ºäº†ä¸€ä¸ªæ–°çš„ç±»å‹æ¥è¿›è¡Œèµ„æºç®¡ç†ã€‚ä»¥æ­¤æ¥è·å¾—æ›´äººæ€§åŒ–ï¼Œæ›´å®‰å…¨ä»¥åŠæ›´å¯è¯»çš„ä»£ç ã€‚&lt;/p>
&lt;h3 id="æ‹“å±•é˜…è¯»">æ‹“å±•é˜…è¯» &lt;a href="#%e6%8b%93%e5%b1%95%e9%98%85%e8%af%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>&lt;a href="http://www.searchtb.com/2011/01/pthreads-mutex-vs-pthread-spinlock.html">Pthreads mutex vs Pthreads spinlock&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºmutexå’Œspinlockæœ‰ä¸€ä¸ªè¯¦ç»†çš„ä»‹ç»ï¼Œå¹¶ä¸”å¯¹æ¯”äº†è¿™ä¸¤ç§é”çš„æ€§èƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>Effective C++ æ¡æ¬¾14&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šçš„ä¾‹å­æ¥æºäºæ­¤ï¼Œå¹¶ä¸”åšäº†ä¸€äº›ç®€åŒ–ã€‚&lt;/p>
&lt;h2 id="å¥æŸ„ç±»">å¥æŸ„ç±» &lt;a href="#%e5%8f%a5%e6%9f%84%e7%b1%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç”±äºC++æ²¡æœ‰è‡ªåŠ¨å†…å­˜å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥å†…å­˜æ“ä½œéƒ½éœ€è¦ä»£ç ç¼–å†™è€…æ‰‹åŠ¨å®Œæˆã€‚&lt;/p>
&lt;p>è¿™å°±é€ æˆäº†æ½œåœ¨çš„å†…å­˜æ³„éœ²é—®é¢˜ â€”â€”â€”â€” ä¸å°å¿ƒæ‰‹è´±æ€ä¹ˆåŠï¼Ÿ&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬å°±å¼•å…¥äº†å¥æŸ„ç±»ï¼Œä¸€ç§ä½¿ç”¨&lt;strong>å¼•ç”¨è®¡æ•°æ³•&lt;/strong>æ¥ç®¡ç†å†…å­˜çš„æ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="ä¸€ä¸ªæ³›å‹å¥æŸ„ç±»">ä¸€ä¸ªæ³›å‹å¥æŸ„ç±» &lt;a href="#%e4%b8%80%e4%b8%aa%e6%b3%9b%e5%9e%8b%e5%8f%a5%e6%9f%84%e7%b1%bb" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»£ç æ¥è‡ªã€ŠC++ Primer ç¬¬4ç‰ˆã€‹ï¼Œæœ‰å°å°çš„æ ¼å¼ä¸Šçš„æ”¹åŠ¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/* generic handle class: Provides pointerlike behavior. Although
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">access through
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">* an unbound Handle is checked and throws a runtime_error exception.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">* The object to which the Handle points is deleted when the last
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">Handle goes away.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">* Users should allocate new objects of type T and bind them to a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">Handle.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">* Once an object is bound to a Handle,, the user must not delete
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">that object.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">T&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Handle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// unbound handle
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Handle(T &lt;span style="color:#f92672">*&lt;/span>p &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>)&lt;span style="color:#f92672">:&lt;/span> ptr(p), use(&lt;span style="color:#66d9ef">new&lt;/span> size_t(&lt;span style="color:#ae81ff">1&lt;/span>)) { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// overloaded operators to support pointer behavior
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">*&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">*&lt;/span>() &lt;span style="color:#66d9ef">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> T&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>() &lt;span style="color:#66d9ef">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// copy control: normal pointer behavior, but last Handle deletes the object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Handle(&lt;span style="color:#66d9ef">const&lt;/span> Handle&lt;span style="color:#f92672">&amp;amp;&lt;/span> h)&lt;span style="color:#f92672">:&lt;/span> ptr(h.ptr), use(h.use) { &lt;span style="color:#f92672">++*&lt;/span>use; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Handle&lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#66d9ef">operator&lt;/span>&lt;span style="color:#f92672">=&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> Handle&lt;span style="color:#f92672">&amp;amp;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">~&lt;/span>Handle() { rem_ref(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> T&lt;span style="color:#f92672">*&lt;/span> ptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// shared object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> size_t &lt;span style="color:#f92672">*&lt;/span>use;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// count of how many Handle spointto *ptr
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">rem_ref&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">--*&lt;/span>use &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) { &lt;span style="color:#66d9ef">delete&lt;/span> ptr; &lt;span style="color:#66d9ef">delete&lt;/span> use; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒHandleç±»ä¸­ä½¿ç”¨äº†&lt;code>size_t *use&lt;/code>ç”¨æ¥å¯¹äºå¯¹è±¡è¿›è¡Œå¼•ç”¨è®¡æ•°ã€‚å¦‚æœè®¡æ•°ä¸º0ï¼Œåˆ™Handleç±»ä¼šåˆ é™¤è‡ªèº«ã€‚ä¹Ÿè®¸æˆ‘ä»¬ä¼šå¿˜è®°é‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¼šå¸®ä½ ç®¡ç†å¥½ä½ çš„å¯¹è±¡çš„ã€‚&lt;/p>
&lt;h3 id="å¥æŸ„ç±»çš„å¦ä¸€ä¸ªä¼˜ç‚¹">å¥æŸ„ç±»çš„å¦ä¸€ä¸ªä¼˜ç‚¹ &lt;a href="#%e5%8f%a5%e6%9f%84%e7%b1%bb%e7%9a%84%e5%8f%a6%e4%b8%80%e4%b8%aa%e4%bc%98%e7%82%b9" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¥æŸ„ç±»çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥é™ä½æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»ã€‚&lt;/p>
&lt;p>å¥æŸ„ç±»å¯ä»¥å°†æ¥å£ä»å®ç°ä¸­åˆ†ç¦»ï¼Œä»è€Œåˆ†ç¦»ç¼–è¯‘ä¾èµ–ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª&lt;code>Person&lt;/code>ç±»ï¼Œåˆå£°æ˜äº†&lt;code>PersonImpl&lt;/code>å¥æŸ„ç±»ã€‚&lt;/p>
&lt;p>åˆ™æˆ‘ä»¬å¦‚æœä¿®æ”¹äº†&lt;code>Person&lt;/code>ç±»çš„å®ç°éƒ¨åˆ†ï¼Œå¹¶ä¸”ä¿æŒæ¥å£éƒ¨åˆ†ä¸å˜ã€‚åˆ™æˆ‘ä»¬åªéœ€è¦é‡æ–°ç¼–è¯‘å«å…¥&lt;code>Person&lt;/code>ç±»çš„æ–‡ä»¶ã€‚å«å…¥&lt;code>PersonImpl&lt;/code>ç±»çš„æ–‡ä»¶ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚&lt;/p>
&lt;h3 id="shared_ptr">shared_ptr &lt;a href="#shared_ptr" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>shared_ptræ˜¯boostä¸­å¼•å…¥çš„æ–°ç±»å‹ï¼ŒåŸç†å’Œå¥æŸ„ç±»ç±»ä¼¼ï¼Œä½†æ˜¯åŠ å…¥äº†å¦‚ä¸‹ç‰¹æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>çº¿ç¨‹å®‰å…¨&lt;/li>
&lt;li>æ”¯æŒè‡ªå®šä¹‰ææ„æ“ä½œï¼ˆåˆ é™¤å™¨ï¼‰&lt;/li>
&lt;li>æœ‰ç°æˆçš„åº“ä¸ºå•¥ä¸ç”¨&lt;/li>
&lt;/ul>
&lt;p>åœ¨ã€ŠEffective C++ã€‹ä¸€ä¹¦ä¸­ï¼Œä½œè€…å¯¹äº&lt;code>shared_ptr&lt;/code>å¤§ä¸ºæ¨å´‡ï¼Œç”¨äº†å¾ˆå¤§ç¯‡å¹…æ¥ä»‹ç»å®ƒçš„ç”¨æ³•ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚&lt;/p>
&lt;h3 id="æ½œåœ¨é—®é¢˜">æ½œåœ¨é—®é¢˜ &lt;a href="#%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æœ‰å¤±æœ‰å¾—ï¼Œæˆ‘ä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡äº†å†…å­˜å®‰å…¨æ€§çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»ä»˜å‡ºä¸€å®šçš„ä»£ä»·ã€‚&lt;/p>
&lt;ul>
&lt;li>å†…å­˜æ€§èƒ½é—®é¢˜&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬çš„ä¸€ä¸ªå¥æŸ„ç±»æˆ–æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œä¸ä»…æœ‰æˆ‘ä»¬çš„å¯¹è±¡æŒ‡é’ˆï¼Œè€Œä¸”è¿˜ä¿å­˜ç€å¼•ç”¨è®¡æ•°ã€‚å¦‚æœæˆ‘ä»¬å¤„äºå†…å­˜æ•æ„Ÿçš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»è®¤çœŸçš„è€ƒè™‘æ”¶ç›Šå’Œä»£ä»·ã€‚&lt;/p>
&lt;ul>
&lt;li>è®¡ç®—æ€§èƒ½é—®é¢˜&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœæˆ‘ä»¬çš„å¥æŸ„ç±»éœ€è¦çº¿ç¨‹å®‰å…¨æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¿…é¡»è¦ä»˜å‡ºç›¸åº”çš„æ—¶é—´ä¸Šçš„ä»£ä»·ã€‚&lt;/p>
&lt;h3 id="æ‹“å±•é˜…è¯»-1">æ‹“å±•é˜…è¯» &lt;a href="#%e6%8b%93%e5%b1%95%e9%98%85%e8%af%bb-1" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;ul>
&lt;li>
&lt;p>ã€ŠEffective C++ã€‹ç¬¬ä¸‰ç«  èµ„æºç®¡ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ã€ŠC++ Primerç¬¬å››ç‰ˆã€‹ 16.5 ä¸€ä¸ªæ³›å‹å¥æŸ„ç±»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="é˜²æ­¢æ¥å£è¯¯ç”¨">é˜²æ­¢æ¥å£è¯¯ç”¨ &lt;a href="#%e9%98%b2%e6%ad%a2%e6%8e%a5%e5%8f%a3%e8%af%af%e7%94%a8" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>Pythonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§ï¼ˆä¹Ÿè®¸åˆ«çš„è¯­è¨€ä¹Ÿæœ‰ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pass_date&lt;/span>(year, month, day):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">foo&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pass_date(year&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1234&lt;/span>, month&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>, day&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œå¯ä»¥æ˜ç¡®å½¢å‚ä¸å®å‚çš„å¯¹åº”å…³ç³»ã€‚è¿™å°±å¯ä»¥ä»å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†æ¥å£è¯¯ç”¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>è€Œåœ¨C++ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°å»ºç±»å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>è¿˜ä»¥&lt;code>pass_date&lt;/code>è¿™ä¸ªå‡½æ•°ä¸ºä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Year&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> year;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Month&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> month;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Day&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">explicit&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> day;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Date&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> pass_date(Year year, Month month, Day day) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// pass
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">foo&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Date date;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> date.psss_date(Year(&lt;span style="color:#ae81ff">1234&lt;/span>), Month(&lt;span style="color:#ae81ff">5&lt;/span>), Day(&lt;span style="color:#ae81ff">6&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åç‰¹åŒ–ç±»ä¸­çš„æˆå‘˜å‡½æ•°">åç‰¹åŒ–ç±»ä¸­çš„æˆå‘˜å‡½æ•° &lt;a href="#%e5%81%8f%e7%89%b9%e5%8c%96%e7%b1%bb%e4%b8%ad%e7%9a%84%e6%88%90%e5%91%98%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>è¿™ä¸ªæ–¹æ³•æ¥æºäºstackoverflowä¸Šçš„ä¸€ä¸ª&lt;a href="http://stackoverflow.com/questions/20147821/c-how-to-partial-specialization-a-template-function-in-a-template-class">é—®é¢˜&lt;/a>ã€‚&lt;/p>
&lt;p>æˆ‘æ¯”è¾ƒæ¨å´‡ä¸‹é¢è¿™ä¸ªç­”æ¡ˆï¼Œè™½ç„¶å®ƒä¸æ˜¯è¢«é¡¶çš„æœ€å¤šçš„é‚£ä¸ªã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> Group, &lt;span style="color:#66d9ef">int&lt;/span> p&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ApplyNorm&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> Group &lt;span style="color:#a6e22e">apply&lt;/span>(Group x, Group y, Group z)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> { &lt;span style="color:#66d9ef">return&lt;/span> pow( pow(x, p) &lt;span style="color:#f92672">+&lt;/span> pow(y, p) &lt;span style="color:#f92672">+&lt;/span> pow(z, p), (&lt;span style="color:#ae81ff">1.0&lt;/span> &lt;span style="color:#f92672">/&lt;/span> p) ); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Here specialize for 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">template&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> Group&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">ApplyNorm&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>Group, &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">static&lt;/span> Group &lt;span style="color:#a6e22e">apply&lt;/span>(Group x, Group y, Group z)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;spec: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> sqrt( x &lt;span style="color:#f92672">*&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> y &lt;span style="color:#f92672">*&lt;/span> y &lt;span style="color:#f92672">+&lt;/span> z &lt;span style="color:#f92672">*&lt;/span> z );
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> Group&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">Vector3D&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Group x, y, z;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Vector3D(Group x, Group y, Group z) &lt;span style="color:#f92672">:&lt;/span> x(x), y(y), z(z) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> p&lt;span style="color:#f92672">&amp;gt;&lt;/span> Group Norm() &lt;span style="color:#66d9ef">const&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">typename&lt;/span> Group&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">template&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> p&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Group Vector3D&lt;span style="color:#f92672">&amp;lt;&lt;/span>Group&lt;span style="color:#f92672">&amp;gt;::&lt;/span>Norm() &lt;span style="color:#66d9ef">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ApplyNorm&lt;span style="color:#f92672">&amp;lt;&lt;/span>Group, p&lt;span style="color:#f92672">&amp;gt;::&lt;/span>apply(x, y, z); &lt;span style="color:#75715e">// use the helper...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// your code goes here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> Vector3D&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">double&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> v(&lt;span style="color:#ae81ff">1.&lt;/span>, &lt;span style="color:#ae81ff">2.&lt;/span>, &lt;span style="color:#ae81ff">3.&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> v.Norm&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>() &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> v.Norm&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>() &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ƒä½¿ç”¨ä¸€ä¸ªæ–°ç±»&lt;code>ApplyNorm&lt;/code>å®ç°äº†ç±»æˆå‘˜å‡½æ•°çš„åç‰¹åŒ–ã€‚&lt;/p>
&lt;h3 id="æ‹“å±•é˜…è¯»-2">æ‹“å±•é˜…è¯» &lt;a href="#%e6%8b%93%e5%b1%95%e9%98%85%e8%af%bb-2" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ã€ŠC++ Primerç¬¬4ç‰ˆã€‹ 16.6 æ¨¡æ¿ç‰¹åŒ–&lt;/p></description></item><item><title>Yunfileä¸‹è½½ç ´è§£[åºŸå¼ƒ]</title><link>https://wizmann.top/posts/yunfile-cracker/</link><pubDate>Mon, 02 Dec 2013 21:16:00 +0000</pubDate><guid>https://wizmann.top/posts/yunfile-cracker/</guid><description>&lt;h2 id="åºŸå¼ƒåŸå› ">åºŸå¼ƒåŸå›  &lt;a href="#%e5%ba%9f%e5%bc%83%e5%8e%9f%e5%9b%a0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å› ä¸ºYunfileç°åœ¨å¼€å§‹é™IP + æ— é™æŠ½é£ï¼Œæ‰€ä»¥æ’ä»¶å·²ç»åºŸå¼ƒä¸ç”¨äº†ã€‚ç°åœ¨ä¹Ÿæ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚\o&amp;lt;(=â•¯â–¡â•°=)&amp;gt;o&lt;/p>
&lt;h2 id="å•¥">å•¥ï¼Ÿ &lt;a href="#%e5%95%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>å¤§å®¶éƒ½çŸ¥é“&lt;code>Yunfile&lt;/code>æ˜¯åšä»€ä¹ˆçš„å’©ï¼Ÿåæ­£æˆ‘æ˜¯ä¸çŸ¥é“ã€‚ã€‚ã€‚&lt;/p>
&lt;p>ä»Šå¤©ä¸‹åˆæ— èŠï¼Œå†™äº†ä¸€ä¸ªyunfileä¸‹è½½çš„ç ´è§£æ’ä»¶ã€‚&lt;/p>
&lt;h2 id="åŠŸèƒ½">åŠŸèƒ½ï¼š &lt;a href="#%e5%8a%9f%e8%83%bd" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;ul>
&lt;li>
&lt;p>éä¼šå‘˜è·³è¿‡ä¸‹è½½ç­‰å¾…çš„30sï¼ˆæˆ–è€…æ›´é•¿æ—¶é—´ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸‹è½½é¡µé¢ä¸ä¼šæŠ¥â€œå› é•¿æ—¶é—´æœªæ“ä½œï¼Œéœ€è¦é‡æ–°ä¸‹è½½â€çš„é”™è¯¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œæ„Ÿè°¢&lt;strong>luacloud&lt;/strong>çš„&lt;a href="http://www.luacloud.com/2012/crack-yunfile-network-disk-30-wait-for-restrictions.html">åšæ–‡&lt;/a>ï¼Œä¸ºæ’ä»¶çš„ç¼–å†™æä¾›äº†åŸå‹ã€‚&lt;/p>
&lt;h2 id="å…·ä½“åŠŸèƒ½å®ç°">å…·ä½“åŠŸèƒ½å®ç°ï¼š &lt;a href="#%e5%85%b7%e4%bd%93%e5%8a%9f%e8%83%bd%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="è·³è¿‡ç­‰å¾…">è·³è¿‡ç­‰å¾… &lt;a href="#%e8%b7%b3%e8%bf%87%e7%ad%89%e5%be%85" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨ä¸Šé¢å¼•ç”¨çš„åšæ–‡é‡Œé¢æœ‰è¯´ï¼Œå°±æ˜¯å¼ºåˆ¶æ‰§è¡Œé¡µé¢ä¸­çš„jsï¼Œå®ç°è·³è½¬ã€‚&lt;/p>
&lt;p>è¿˜åšäº†ä¸€ä¸ªDOMä¿®æ”¹ï¼Œå˜æˆç°åœ¨è¿™ç§å¾ˆæ¼‚æ¼‚çš„æ ·å­ï½ï½&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/yunfile-craker-1.png" alt="Yunfile-Craker-1">&lt;/p>
&lt;h3 id="å¿½ç•¥è¶…æ—¶é”™è¯¯">å¿½ç•¥è¶…æ—¶é”™è¯¯ &lt;a href="#%e5%bf%bd%e7%95%a5%e8%b6%85%e6%97%b6%e9%94%99%e8%af%af" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¦†ç›–äº†ä¸‹è½½å‡½æ•°ï¼Œè·³è¿‡è¶…æ—¶åˆ¤æ–­ã€‚&lt;/p>
&lt;h2 id="ç°æœ‰é—®é¢˜">ç°æœ‰é—®é¢˜ &lt;a href="#%e7%8e%b0%e6%9c%89%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¼šè¿”å›åˆ°ä¸‹è½½é¡µã€‚&lt;/p>
&lt;p>è™½ç„¶æˆ‘ä»¬ä¸éœ€è¦å†ç­‰30säº†ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆçƒ¦ã€‚&lt;/p>
&lt;p>ä¹Ÿæœ‰æˆ‘æœ‰æœºä¼šä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;h3 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»£ç åœ¨&lt;a href="https://github.com/Wizmann/Utils/tree/master/Chrome-extension/yunfile-cracker">è¿™é‡Œ&lt;/a>å‘€ï½&lt;/p></description></item><item><title>æ©Ÿå™¨å­¸ç¿’åŸºçŸ³ - PLAç®—æ³•åˆæ­¥</title><link>https://wizmann.top/posts/ml-foundations-pla/</link><pubDate>Fri, 29 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/ml-foundations-pla/</guid><description>&lt;h2 id="ä»€ä¹ˆæ˜¯plaç®—æ³•">ä»€ä¹ˆæ˜¯PLAç®—æ³• &lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afpla%e7%ae%97%e6%b3%95" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>PLA = Perceptrons Learning Alogrithm&lt;/p>
&lt;p>WikiPediaä¸Šæœ‰ä¸€ä¸ªå¤§æ¦‚çš„å†å²èƒŒæ™¯ä»‹ç»ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ„ŸçŸ¥æœºï¼ˆè‹±è¯­ï¼šPerceptronï¼‰æ˜¯Frank Rosenblattåœ¨1957å¹´å°±èŒäºCornellèˆªç©ºå®éªŒå®¤(Cornell Aeronautical Laboratory)æ—¶æ‰€å‘æ˜çš„ä¸€ç§äººå·¥ç¥ç»ç½‘ç»œã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§æœ€ç®€å•å½¢å¼çš„å‰é¦ˆå¼äººå·¥ç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§äºŒå…ƒçº¿æ€§åˆ†ç±»å™¨ã€‚&lt;/p>&lt;/blockquote>
&lt;h2 id="plaç®—æ³•çš„åŸç†">PLAç®—æ³•çš„åŸç† &lt;a href="#pla%e7%ae%97%e6%b3%95%e7%9a%84%e5%8e%9f%e7%90%86" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-perceptron-Ncell.png" alt="æ„ŸçŸ¥æœºç¤ºæ„å›¾">&lt;/p>
&lt;blockquote>
&lt;p>å¯¹äºæ¯ç§è¾“å…¥å€¼(1 - D)ï¼Œæˆ‘ä»¬è®¡ç®—ä¸€ä¸ªæƒé‡ã€‚å½“å‰ç¥ç»å…ƒçš„æ€»æ¿€å‘å€¼(a)å°±ç­‰äºæ¯ç§è¾“å…¥å€¼(x)ä¹˜ä»¥æƒé‡(w)ä¹‹å’Œã€‚&lt;/p>&lt;/blockquote>
&lt;p>ç”±æ­¤æˆ‘ä»¬å°±å¯ä»¥æ¨å¯¼å‡ºå…¬å¼å¦‚ä¸‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-perceptron-formula-1.jpg" alt="neuron sum">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥ä¸ºè¿™ä¸ªâ€œç¥ç»å…ƒâ€çš„æ¿€å‘å€¼è®¾å®šä¸€ä¸ªé˜ˆå€¼&lt;code>threshold&lt;/code>ã€‚&lt;/p>
&lt;p>å¦‚æœ &lt;code>a &amp;gt; threshold&lt;/code>ï¼Œåˆ™åˆ¤å®šè¾“å…¥ä¸ºæ­£ä¾‹ã€‚
å¦‚æœ &lt;code>a &amp;lt; threshold&lt;/code>ï¼Œåˆ™åˆ¤å®šè¾“å…¥ä¸ºè´Ÿä¾‹ã€‚
å¯¹äº &lt;code>a == threshold&lt;/code>çš„æƒ…å†µï¼Œè®¤ä¸ºæ˜¯ç‰¹æ®Šæƒ…å†µï¼Œä¸äºˆè€ƒè™‘ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æ„ŸçŸ¥å™¨åˆ†ç±»å™¨å°±å¯ä»¥å¾—åˆ°ä»¥ä¸‹å¼å­ã€‚&lt;/p>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-perceptron-formula-2.png" alt="perceptron-formula-2">&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨æ•°æ®å‘é‡ä¸­åŠ å…¥äº†é˜ˆå€¼ï¼Œå¹¶æŠŠå¼å­ç»Ÿä¸€æˆå‘é‡ç§¯çš„å½¢å¼ã€‚&lt;/p>
&lt;h2 id="plaç®—æ³•çš„é”™è¯¯ä¿®æ­£">PLAç®—æ³•çš„é”™è¯¯ä¿®æ­£ &lt;a href="#pla%e7%ae%97%e6%b3%95%e7%9a%84%e9%94%99%e8%af%af%e4%bf%ae%e6%ad%a3" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>PLAç®—æ³•æ˜¯_é”™è¯¯é©±åŠ¨_çš„ç®—æ³•ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å½“æˆ‘ä»¬è®­ç»ƒè¿™ä¸ªç®—æ³•æ—¶ï¼Œåªè¦è¾“å‡ºå€¼æ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¸ªç®—æ³•å°±ä¸ä¼šè¿›è¡Œä»»ä½•æ•°æ®çš„è°ƒæ•´ã€‚åä¹‹ï¼Œå½“è¾“å‡ºå€¼ä¸å®é™…å€¼å¼‚å·ï¼Œè¿™ä¸ªç®—æ³•å°±ä¼šè‡ªåŠ¨è°ƒæ•´å‚æ•°çš„æ¯”é‡ã€‚&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/blog-perceptron-update.png" alt="é”™è¯¯ä¿®æ­£">&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå–ä¸€ä¸ªéšæœºå‘é‡&lt;code>W&lt;/code>ï¼Œä¸ç°æœ‰çš„æ•°æ®&lt;code>X[i]&lt;/code>åšç‚¹ä¹˜ï¼Œå–å¾—ç»“æœçš„ç¬¦å·ã€‚&lt;/p>
&lt;p>å¦‚æœç¬¦å·ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸçš„è¯ï¼Œåˆ™&lt;code>continue&lt;/code>ã€‚
å¦åˆ™å°±è¦å¯¹&lt;code>W&lt;/code>è¿›è¡Œä¿®æ­£ã€‚&lt;/p>
&lt;p>ä¿®æ­£çš„æ–¹å¼æ˜¯&lt;code>W += y * X[i]&lt;/code>ï¼Œæ¯ä¸€æ¬¡ä¿®æ­£éƒ½æ˜¯å‡å°‘ç°æœ‰å‘é‡&lt;code>W&lt;/code>ä¸å‘é‡&lt;code>y * X[i]&lt;/code>çš„å¤¹è§’ï¼Œä»è€Œè°ƒæ•´ç­”æ¡ˆçš„æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;h2 id="naive-pla-ä¸-pocket-pla">Naive PLA ä¸ Pocket PLA &lt;a href="#naive-pla-%e4%b8%8e-pocket-pla" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="naive-pla">Naive PLA &lt;a href="#naive-pla" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Naive PLAç®—æ³•çš„æ€æƒ³å¾ˆç®€å•ã€‚ä¸€ç›´ä¿®æ­£å‘é‡&lt;code>W&lt;/code>ï¼Œç›´åˆ°å‘é‡&lt;code>W&lt;/code>æ»¡è¶³æ‰€æœ‰æ•°æ®ä¸ºæ­¢ã€‚&lt;/p>
&lt;p>ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> numpy &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#f92672">*&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">naive_pla&lt;/span>(datas):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> w &lt;span style="color:#f92672">=&lt;/span> datas[&lt;span style="color:#ae81ff">0&lt;/span>][&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iteration &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iteration &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> false_data &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> data &lt;span style="color:#f92672">in&lt;/span> datas:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> dot(w, data[&lt;span style="color:#ae81ff">0&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> sign(data[&lt;span style="color:#ae81ff">1&lt;/span>]) &lt;span style="color:#f92672">!=&lt;/span> sign(t):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> error &lt;span style="color:#f92672">=&lt;/span> data[&lt;span style="color:#ae81ff">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> false_data &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> w &lt;span style="color:#f92672">+=&lt;/span> error &lt;span style="color:#f92672">*&lt;/span> data[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print &lt;span style="color:#e6db74">&amp;#39;iter&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74"> (&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74"> / &lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">)&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> (iteration, false_data, len(datas))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> false_data:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> w
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="pocket-pla">Pocket PLA &lt;a href="#pocket-pla" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>Naive PLAçš„ä¸€å¤§é—®é¢˜å°±æ˜¯å¦‚æœæ•°æ®æœ‰æ‚éŸ³ï¼Œä¸èƒ½å®Œç¾çš„åˆ†ç±»çš„è¯ï¼Œç®—æ³•å°±ä¸ä¼šä¸­æ­¢ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œå¯¹äºæœ‰æ‚éŸ³çš„æ•°æ®ï¼Œæˆ‘ä»¬åªèƒ½æœŸæœ›æ‰¾åˆ°é”™è¯¯æœ€å°‘çš„ç»“æœã€‚ç„¶åè¿™æ˜¯ä¸€ä¸ª&lt;code>NP Hard&lt;/code>é—®é¢˜ã€‚&lt;/p>
&lt;p>Pocket PLAä¸€ä¸ªè´ªå¿ƒçš„è¿‘ä¼¼ç®—æ³•ã€‚å’ŒNaive PLAç®—æ³•ç±»ä¼¼ã€‚&lt;/p>
&lt;p>å˜é¡ºåºè¿­ä»£ä¸ºéšæœºè¿­ä»£ï¼Œå¦‚æœæ‰¾å‡ºé”™è¯¯ï¼Œåˆ™ä¿®æ­£ç»“æœã€‚åœ¨ä¿®æ­£è¿‡ç¨‹ä¸­ï¼Œè®°å½•çŠ¯é”™è¯¯æœ€å°‘çš„å‘é‡ã€‚&lt;/p>
&lt;p>ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> numpy &lt;span style="color:#66d9ef">as&lt;/span> np
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">pocket_pla&lt;/span>(datas, limit):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">###############&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_calc_false&lt;/span>(vec):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> data &lt;span style="color:#f92672">in&lt;/span> datas:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>dot(vec, data[&lt;span style="color:#ae81ff">0&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>sign(data[&lt;span style="color:#ae81ff">1&lt;/span>]) &lt;span style="color:#f92672">!=&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>sign(t):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">###############&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> w &lt;span style="color:#f92672">=&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>random&lt;span style="color:#f92672">.&lt;/span>rand(&lt;span style="color:#ae81ff">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> least_false &lt;span style="color:#f92672">=&lt;/span> _calc_false(w)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> w
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> xrange(limit):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data &lt;span style="color:#f92672">=&lt;/span> random&lt;span style="color:#f92672">.&lt;/span>choice(datas)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>dot(w, data[&lt;span style="color:#ae81ff">0&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>sign(data[&lt;span style="color:#ae81ff">1&lt;/span>]) &lt;span style="color:#f92672">!=&lt;/span> np&lt;span style="color:#f92672">.&lt;/span>sign(t):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#f92672">=&lt;/span> w &lt;span style="color:#f92672">+&lt;/span> data[&lt;span style="color:#ae81ff">1&lt;/span>] &lt;span style="color:#f92672">*&lt;/span> data[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t_false &lt;span style="color:#f92672">=&lt;/span> _calc_false(t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> w &lt;span style="color:#f92672">=&lt;/span> t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> t_false &lt;span style="color:#f92672">&amp;lt;=&lt;/span> least_false:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> least_false &lt;span style="color:#f92672">=&lt;/span> t_false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> res &lt;span style="color:#f92672">=&lt;/span> t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res, least_false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ &lt;a href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ¬æ–‡ä¸»è¦å‚è€ƒäº†&lt;a href="http://shaoxiongjiang.com/2013/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8-%E6%84%9F%E7%9F%A5%E5%99%A8-perceptron/">æœºå™¨å­¦ä¹ å…¥é—¨ - æ„ŸçŸ¥å™¨ (Perceptron)&lt;/a>å’ŒWikipediaä¸Šé¢&lt;a href="http://zh.wikipedia.org/wiki/%E6%84%9F%E7%9F%A5%E5%99%A8">æ„ŸçŸ¥æœº&lt;/a>çš„è¯æ¡ã€‚&lt;/p>
&lt;p>ä»¥åŠ&lt;a href="https://class.coursera.org/ntumlone-001/class">æ©Ÿå™¨å­¸ç¿’åŸºçŸ³ (Machine Learning Foundations)&lt;/a>å…¬å¼€è¯¾çš„å¹»ç¯ç‰‡ã€‚&lt;/p>
&lt;h2 id="updated">Updated &lt;a href="#updated" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>2013-12-8&lt;/p>
&lt;p>ä¿®æ”¹äº†pocket-plaç®—æ³•ï¼Œæå‡äº†æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚&lt;/p>
&lt;p>å‚è€ƒäº†&lt;a href="https://class.coursera.org/ntumlone-001/forum/thread?thread_id=116#post-632">è¯¾ç¨‹è®ºå›&lt;/a>çš„è®¨è®ºã€‚å¹¶ä¸”æ„Ÿè°¢Li TianyiåŒå­¦æŒ‡å‡ºæˆ‘çš„é—®é¢˜ã€‚&lt;/p></description></item><item><title>Linuxå†…æ ¸ä¸­çš„å°‘é”é“¾è¡¨</title><link>https://wizmann.top/posts/linux-lockless-llist/</link><pubDate>Thu, 28 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/linux-lockless-llist/</guid><description>&lt;h1 id="å‰è¨€">å‰è¨€ &lt;a href="#%e5%89%8d%e8%a8%80" class="anchor">ğŸ”—&lt;/a>&lt;/h1>&lt;p>æœ€è¿‘åœ¨stackexchangeä¸Šçœ‹åˆ°ä¸€ä¸ªé—®ç­”ï¼Œè®¨è®ºæˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•åœ¨å®é™…å·¥ç¨‹ä¸­çš„åº”ç”¨ã€‚(&lt;a href="http://cstheory.stackexchange.com/questions/19759/core-algorithms-deployed/19773#19773">æˆ³æˆ‘&lt;/a>)&lt;/p>
&lt;p>æˆ‘æ‰“ç®—å€ŸåŠ©è¿™ä¸ªé—®ç­”ä¸­çš„å†…å®¹ï¼Œä»¥æˆ‘æ¯”è¾ƒç†Ÿæ‚‰çš„æ•°æ®ç»“æ„ä¸ç®—æ³•ä¸ºç´¢å¼•æ¥é˜…è¯»å¼€æºä»£ç ã€‚&lt;/p>
&lt;h1 id="æ­£æ–‡">æ­£æ–‡ &lt;a href="#%e6%ad%a3%e6%96%87" class="anchor">ğŸ”—&lt;/a>&lt;/h1>&lt;h2 id="talk-is-cheap">Talk is cheap &lt;a href="#talk-is-cheap" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;blockquote>
&lt;p>Lock-less NULL terminated single linked list&lt;/p>&lt;/blockquote>
&lt;p>&lt;a href="https://github.com/mirrors/linux-2.6/blob/master/include/linux/llist.h">linux-2.6/include/linux/llist.h&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/mirrors/linux-2.6/blob/master/lib/llist.c">linux-2.6/lib/llist.c&lt;/a>&lt;/p>
&lt;h2 id="çŸ¥è¯†å‡†å¤‡">çŸ¥è¯†å‡†å¤‡ &lt;a href="#%e7%9f%a5%e8%af%86%e5%87%86%e5%a4%87" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="volatile">volatile &lt;a href="#volatile" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>volatileå…³é”®å­—å£°æ˜çš„å˜é‡æˆ–å¯¹è±¡é€šå¸¸æ‹¥æœ‰å’Œä¼˜åŒ–å’Œï¼ˆæˆ–ï¼‰å¤šçº¿ç¨‹ç›¸å…³çš„ç‰¹æ®Šå±æ€§ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>é€šå¸¸ï¼Œvolatileå…³é”®å­—ç”¨æ¥é˜»æ­¢ï¼ˆä¼ªï¼‰ç¼–è¯‘å™¨å¯¹é‚£äº›å®ƒè®¤ä¸ºå˜é‡çš„å€¼ä¸èƒ½â€œè¢«ä»£ç æœ¬èº«â€æ”¹å˜çš„ä»£ç ä¸Šæ‰§è¡Œä»»ä½•ä¼˜åŒ–ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>å¦‚æœä¸ä½¿ç”¨volatileå…³é”®å­—ï¼Œç¼–è¯‘å™¨å°†å‡è®¾å½“å‰ç¨‹åºæ˜¯ç³»ç»Ÿä¸­å”¯ä¸€èƒ½æ”¹å˜è¿™ä¸ªå€¼éƒ¨åˆ†ã€‚ ä¸ºäº†é˜»æ­¢ç¼–è¯‘å™¨åƒä¸Šé¢é‚£æ ·ä¼˜åŒ–ä»£ç ï¼Œéœ€è¦ä½¿ç”¨volatileå…³é”®å­—ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>From: &lt;a href="http://zh.wikipedia.org/wiki/Volatile%E5%8F%98%E9%87%8F">http://zh.wikipedia.org/wiki/Volatile%E5%8F%98%E9%87%8F&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h3 id="typeof">typeof &lt;a href="#typeof" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>Another way to refer to the type of an expression is with typeof. The syntax of using of this keyword looks like sizeof, but the construct acts semantically like a type name defined with typedef.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>From: &lt;a href="http://gcc.gnu.org/onlinedocs/gcc/Typeof.html">http://gcc.gnu.org/onlinedocs/gcc/Typeof.html&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>typeof&lt;/code>å’Œ&lt;code>sizeof&lt;/code>ç±»ä¼¼ï¼Œsizeofæ±‚çš„æ˜¯å˜é‡/ç±»å‹çš„å¤§å°ï¼Œè€Œtypeofæ˜¯æ±‚å˜é‡/ç±»å‹çš„&lt;strong>æ•°æ®ç±»å‹&lt;/strong>ã€‚&lt;/p>
&lt;p>typeofåœ¨#defineä¸­çš„åº”ç”¨å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define max(a,b) \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> ({ typeof (a) _a = (a); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> typeof (b) _b = (b); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> _a &amp;gt; _b ? _a : _b; })
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>typeof(a)&lt;/code>è·å¾—äº†&lt;code>a&lt;/code>çš„ç±»å‹ï¼Œå£°æ˜äº†ä¸€ä¸ªåŒç±»å‹çš„&lt;code>_a&lt;/code>å˜é‡ã€‚&lt;/p>
&lt;p>p.s. ä¸Šé¢æ˜¯ä¸€ä¸ªå®‰å…¨çš„ç”¨&lt;code>#define&lt;/code>å®ç°çš„&lt;code>max&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;h3 id="access_once">ACCESS_ONCE &lt;a href="#access_once" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ACCESS_ONCE(x) (*(volatile typeof(x) *)&amp;amp;(x))ï¼›
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ACCESS_ONCE&lt;/code>ä½¿ç”¨äº†ä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œä½¿ç”¨&lt;code>volatile&lt;/code>ä¿®é¥° &lt;code>x&lt;/code>ã€‚é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„æ½œåœ¨å²ä¹‰ã€‚&lt;/p>
&lt;h3 id="cmpxchg">cmpxchg &lt;a href="#cmpxchg" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;blockquote>
&lt;p>compare-and-swap (CAS) is an atomic instruction used in multithreading to achieve synchronization.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>It compares the contents of a memory location to a given value and, only if they are the same, modifies the contents of that memory location to a given new value.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>This is done as a single atomic operation. The atomicity guarantees that the new value is calculated based on up-to-date information; if the value had been updated by another thread in the meantime, the write would fail.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>The result of the operation must indicate whether it performed the substitution; this can be done either with a simple Boolean response (this variant is often called compare-and-set), or by returning the value read from the memory location (not the value written to it).&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;hellip;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>In the x86 (since 80486) and Itanium architectures this is implemented as the compare and exchange (CMPXCHG) instruction, though here the LOCK prefix should be there to make it really atomic.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>From: &lt;a href="http://en.wikipedia.org/wiki/Compare-and-swap">http://en.wikipedia.org/wiki/Compare-and-swap&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>cmpxchg&lt;/code>æ˜¯åœ¨Intelå¹³å°ä¸Š&lt;code>atomic compare-and-swap&lt;/code>æ“ä½œçš„å®ç°ã€‚&lt;/p>
&lt;p>&lt;code>cmpxchg&lt;/code>è¿˜è¢«ç”¨æ¥å®ç°&lt;code>spinlock&lt;/code>ï¼Œ&lt;a href="http://stackoverflow.com/questions/6935442/x86-spinlock-using-cmpxchg">æˆ³æˆ‘&lt;/a>ã€‚&lt;/p>
&lt;h2 id="show-me-the-code">Show me the code &lt;a href="#show-me-the-code" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹ &lt;a href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> llist_head {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> llist_node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ªç®€å•çš„ç±»å‹åŒ…è£¹ã€‚&lt;/p>
&lt;p>&lt;code>llist_head&lt;/code>æ˜¯é“¾è¡¨å¤´ï¼Œè€Œ&lt;code>llist_node&lt;/code>æ˜¯é“¾è¡¨ä¸­&lt;strong>é“¾&lt;/strong>çš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;h3 id="åˆå§‹åŒ–">åˆå§‹åŒ– &lt;a href="#%e5%88%9d%e5%a7%8b%e5%8c%96" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define LLIST_HEAD_INIT(name) { NULL }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define LLIST_HEAD(name) struct llist_head name = LLIST_HEAD_INIT(name)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * init_llist_head - initialize lock-less list head
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the head for your lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">init_llist_head&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>list)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> list&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é“¾è¡¨çš„éå†">é“¾è¡¨çš„éå† &lt;a href="#%e9%93%be%e8%a1%a8%e7%9a%84%e9%81%8d%e5%8e%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h4 id="llist_entry">llist_entry &lt;a href="#llist_entry" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_entry - get the struct of this entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @ptr: the &amp;amp;struct llist_node pointer.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @type: the type of the struct this is embedded in.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @member: the name of the llist_node within the struct.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define llist_entry(ptr, type, member) \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> container_of(ptr, type, member)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å£°æ˜ä¸€ä¸ªé“¾è¡¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ&lt;code>llist_node&lt;/code>åŒ…å«åœ¨é“¾è¡¨èŠ‚ç‚¹ä¸­ï¼Œ&lt;code>llist_head&lt;/code>æ˜¯é“¾è¡¨å¤´ã€‚&lt;/p>
&lt;p>&lt;code>llist_entry&lt;/code>æ˜¯ä»é“¾è¡¨èŠ‚ç‚¹ä¸­çš„&lt;code>llist_node&lt;/code>æˆå‘˜å˜é‡è·å¾—é“¾è¡¨èŠ‚ç‚¹çš„åœ°å€ã€‚&lt;/p>
&lt;p>&lt;code>llist_entry&lt;/code>å®æ˜¯ä»&lt;code>container_of&lt;/code>å®ç»§æ‰¿è€Œæ¥çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * container_of - cast a member of a structure out to the containing structure
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @ptr: the pointer to the member.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @type: the type of the container struct this is embedded in.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @member: the name of the member within the struct.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define container_of(ptr, type, member) ({ \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> const typeof( ((type *)0)-&amp;gt;member ) *__mptr = (ptr); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> (type *)( (char *)__mptr - offsetof(type,member) );})
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“åŸç†å¯ä»¥å°å°å‚è€ƒä¸€ä¸‹&lt;a href="http://hi.baidu.com/holinux/item/af2e32c9dcbd3953ac00ef49">è¿™é‡Œ&lt;/a>ã€‚&lt;/p>
&lt;h4 id="for_each">for_each &lt;a href="#for_each" class="anchor">ğŸ”—&lt;/a>&lt;/h4>&lt;h5 id="llist_for_each">llist_for_each &lt;a href="#llist_for_each" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_for_each - iterate over some deleted entries of a lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @pos: the &amp;amp;struct llist_node to use as a loop cursor
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @node: the first entry of deleted list entries
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * In general, some entries of the lock-less list can be traversed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * safely only after being deleted from list, so start with an entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * instead of list head.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * If being used on entries deleted from lock-less list directly, the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * traverse order is from the newest to the oldest added entry. If
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * you want to traverse from the oldest to the newest, you must
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * reverse the order by yourself before traversing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define llist_for_each(pos, node) \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for ((pos) = (node); pos; (pos) = (pos)-&amp;gt;next)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ª&lt;code>forå¾ªç¯&lt;/code>ã€‚ç®€å•çš„å®ã€‚&lt;/p>
&lt;h5 id="llist_for_each_entry">llist_for_each_entry &lt;a href="#llist_for_each_entry" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_for_each_entry - iterate over some deleted entries of lock-less list of given type
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @pos: the type * to use as a loop cursor.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @node: the fist entry of deleted list entries.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @member: the name of the llist_node with the struct.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * In general, some entries of the lock-less list can be traversed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * safely only after being removed from list, so start with an entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * instead of list head.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * If being used on entries deleted from lock-less list directly, the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * traverse order is from the newest to the oldest added entry. If
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * you want to traverse from the oldest to the newest, you must
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * reverse the order by yourself before traversing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define llist_for_each_entry(pos, node, member) \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for ((pos) = llist_entry((node), typeof(*(pos)), member); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> &amp;amp;(pos)-&amp;gt;member != NULL; \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> (pos) = llist_entry((pos)-&amp;gt;member.next, typeof(*(pos)), member))
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éå†é“¾è¡¨çš„ç±»ã€‚
ç”¨ä¼ªä»£ç æ¥è¡¨è¿°ä¸€ä¸‹å°±æ˜¯ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>for ((pos) = é“¾è¡¨èŠ‚ç‚¹;
&amp;amp;(pos)-&amp;gt;nextæŒ‡é’ˆ != NULL;
(pos) = é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹) {
// éå†æ“ä½œ
pos.foo = bar;
}
&lt;/code>&lt;/pre>&lt;h5 id="llist_for_each_entry_safe">llist_for_each_entry_safe &lt;a href="#llist_for_each_entry_safe" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_for_each_entry_safe - iterate over some deleted entries of lock-less list of given type
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * safe against removal of list entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @pos: the type * to use as a loop cursor.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @n: another type * to use as temporary storage
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @node: the first entry of deleted list entries.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @member: the name of the llist_node with the struct.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * In general, some entries of the lock-less list can be traversed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * safely only after being removed from list, so start with an entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * instead of list head.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * If being used on entries deleted from lock-less list directly, the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * traverse order is from the newest to the oldest added entry. If
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * you want to traverse from the oldest to the newest, you must
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * reverse the order by yourself before traversing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define llist_for_each_entry_safe(pos, n, node, member) \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for (pos = llist_entry((node), typeof(*pos), member); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> &amp;amp;pos-&amp;gt;member != NULL &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> (n = llist_entry(pos-&amp;gt;member.next, typeof(*n), member), true); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> pos = n)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>safe&lt;/code>è¡¨ç¤ºå•é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æœ‰å¯èƒ½è¢«å¢åŠ /åˆ é™¤ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>(n = llist_entry(pos-&amp;gt;member.next, typeof(*n), member), true)&lt;/code>å¯ä»¥ä¿æŒéå†çš„å®‰å…¨æ€§ã€‚&lt;/p>
&lt;h6 id="llist_next">llist_next &lt;a href="#llist_next" class="anchor">ğŸ”—&lt;/a>&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">llist_next&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>node)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> node&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é“¾è¡¨å…ƒç´ çš„æ“ä½œ">é“¾è¡¨å…ƒç´ çš„æ“ä½œ &lt;a href="#%e9%93%be%e8%a1%a8%e5%85%83%e7%b4%a0%e7%9a%84%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;h5 id="llist_add_batch">llist_add_batch &lt;a href="#llist_add_batch" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_add_batch - add several linked entries in batch
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @new_first: first entry in batch to be added
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @new_last: last entry in batch to be added
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the head for your lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Return whether list is empty before adding.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">llist_add_batch&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>new_first, &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>new_last,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new_last&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> first &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ACCESS_ONCE&lt;/span>(head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#a6e22e">cmpxchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, first, new_first) &lt;span style="color:#f92672">!=&lt;/span> first);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!&lt;/span>first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰¹é‡å¢åŠ å‘½ä»¤ï¼Œä½¿ç”¨&lt;code>cmpxchg&lt;/code>ä¿æŒçº¿ç¨‹å®‰å…¨ã€‚&lt;/p>
&lt;h5 id="llist_add">llist_add &lt;a href="#llist_add" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_add - add a new entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @new: new entry to be added
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the head for your lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Returns true if the list was empty prior to adding this entry.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">llist_add&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>new, &lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">llist_add_batch&lt;/span>(new, new, head);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="llist_empty">llist_empty &lt;a href="#llist_empty" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_empty - tests whether a lock-less list is empty
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the list to test
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Not guaranteed to be accurate or up to date. Just a quick way to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * test whether the list is empty without deleting something from the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * list.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#a6e22e">llist_empty&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">ACCESS_ONCE&lt;/span>(head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first) &lt;span style="color:#f92672">==&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨&lt;code>ACCESS_ONCE&lt;/code>é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¿æŒçº¿ç¨‹å®‰å…¨æ€§ã€‚&lt;/p>
&lt;h5 id="llist_del_all">llist_del_all &lt;a href="#llist_del_all" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_del_all - delete all entries from lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the head of lock-less list to delete all entries
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * If list is empty, return NULL, otherwise, delete all entries and
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * return the pointer to the first entry. The order of entries
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * deleted is from the newest to the oldest added one.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">inline&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">llist_del_all&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">xchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="llist_del_first">llist_del_first &lt;a href="#llist_del_first" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_del_first - delete the first entry of lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: the head for your lock-less list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * If list is empty, return NULL, otherwise, return the first entry
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * deleted, this is the newest added one.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Only one llist_del_first user can be used simultaneously with
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * multiple llist_add users without lock. Because otherwise
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_del_first, llist_add, llist_add (or llist_del_all, llist_add,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_add) sequence in another user may change @head-&amp;gt;first-&amp;gt;next,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * but keep @head-&amp;gt;first. If multiple consumers are needed, please
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * use llist_del_all or use lock between consumers.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">llist_del_first&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_head &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>entry, &lt;span style="color:#f92672">*&lt;/span>old_entry, &lt;span style="color:#f92672">*&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> entry &lt;span style="color:#f92672">=&lt;/span> head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (;;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (entry &lt;span style="color:#f92672">==&lt;/span> NULL)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> old_entry &lt;span style="color:#f92672">=&lt;/span> entry;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next &lt;span style="color:#f92672">=&lt;/span> entry&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> entry &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">cmpxchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, old_entry, next);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (entry &lt;span style="color:#f92672">==&lt;/span> old_entry)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> entry;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ é™¤ç¬¬ä¸€ä¸ªå€¼ã€‚åŒæ ·çš„æ— é”æ“ä½œã€‚&lt;/p>
&lt;h5 id="llist_reverse_order">llist_reverse_order &lt;a href="#llist_reverse_order" class="anchor">ğŸ”—&lt;/a>&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * llist_reverse_order - reverse order of a llist chain
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @head: first item of the list to be reversed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Reverse the order of a chain of llist entries and return the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * new first entry.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">llist_reverse_order&lt;/span>(&lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>head)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>new_head &lt;span style="color:#f92672">=&lt;/span> NULL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (head) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> llist_node &lt;span style="color:#f92672">*&lt;/span>tmp &lt;span style="color:#f92672">=&lt;/span> head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head &lt;span style="color:#f92672">=&lt;/span> head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tmp&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> new_head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new_head &lt;span style="color:#f92672">=&lt;/span> tmp;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> new_head;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">EXPORT_SYMBOL_GPL&lt;/span>(llist_reverse_order);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä½•åè½¬ä¸€ä¸ªå•é“¾è¡¨&lt;/p>
&lt;h2 id="å°‘é”é“¾è¡¨æ˜¯å¦‚ä½•å®ç°çš„">å°‘é”é“¾è¡¨æ˜¯å¦‚ä½•å®ç°çš„ &lt;a href="#%e5%b0%91%e9%94%81%e9%93%be%e8%a1%a8%e6%98%af%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e7%9a%84" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;h3 id="addå‡½æ•°ä¸­çš„åŸå­æ“ä½œ">addå‡½æ•°ä¸­çš„åŸå­æ“ä½œ &lt;a href="#add%e5%87%bd%e6%95%b0%e4%b8%ad%e7%9a%84%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new_last&lt;span style="color:#f92672">-&amp;gt;&lt;/span>next &lt;span style="color:#f92672">=&lt;/span> first &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ACCESS_ONCE&lt;/span>(head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#a6e22e">cmpxchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, first, new_first) &lt;span style="color:#f92672">!=&lt;/span> first);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­&lt;code>cmpxchg&lt;/code>çš„æ€§è´¨ç±»ä¼¼äºé”ã€‚ä¿è¯èµ‹å€¼æ˜¯æˆåŠŸçš„ä¸”æ˜¯æ˜¯åŸå­çš„ã€‚&lt;/p>
&lt;h3 id="del_firstä¸­çš„åŸå­æ“ä½œ">del_firstä¸­çš„åŸå­æ“ä½œ &lt;a href="#del_first%e4%b8%ad%e7%9a%84%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>entry &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">cmpxchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, old_entry, next);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="del_allä¸­çš„åŸå­æ“ä½œ">del_allä¸­çš„åŸå­æ“ä½œ &lt;a href="#del_all%e4%b8%ad%e7%9a%84%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">xchg&lt;/span>(&lt;span style="color:#f92672">&amp;amp;&lt;/span>head&lt;span style="color:#f92672">-&amp;gt;&lt;/span>first, NULL);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å°‘é”é“¾è¡¨å¦‚ä½•å¤„ç†å¹¶å‘">å°‘é”é“¾è¡¨å¦‚ä½•å¤„ç†å¹¶å‘ &lt;a href="#%e5%b0%91%e9%94%81%e9%93%be%e8%a1%a8%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86%e5%b9%b6%e5%8f%91" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>åœ¨llist.hä¸­æœ‰å¦‚ä¸‹çš„æ³¨é‡Šè¡¨æ˜å¦‚æœä¸¤ç§æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œæ˜¯å¦éœ€è¦åŠ é¢å¤–çš„é”ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code> /*
* | add | del_first | del_all
* add | - | - | -
* del_first | | L | L
* del_all | | | -
*/
&lt;/code>&lt;/pre>&lt;p>&lt;code>add&lt;/code>æ“ä½œå’Œå¤´æŒ‡é’ˆæ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å’Œå…¶å®ƒæ“ä½œå¹¶è¡Œã€‚
&lt;code>del_first&lt;/code>ä¾èµ–äº&lt;code>list-&amp;gt;first-&amp;gt;next&lt;/code>åœ¨æ“ä½œæ—¶ä¸å˜åŒ–ã€‚
è€Œ&lt;code>del_all&lt;/code>åªå¯¹&lt;code>list-&amp;gt;first&lt;/code>çš„æŒ‡é’ˆè¿›è¡Œæ“ä½œã€‚æ‰€ä»¥æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚&lt;/p>
&lt;h3 id="å°‘é”é“¾è¡¨å¦‚ä½•å¤„ç†éå†">å°‘é”é“¾è¡¨å¦‚ä½•å¤„ç†éå† &lt;a href="#%e5%b0%91%e9%94%81%e9%93%be%e8%a1%a8%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86%e9%81%8d%e5%8e%86" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * The list entries deleted via llist_del_all can be traversed with
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * traversing function such as llist_for_each etc. But the list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * entries can not be traversed safely before deleted from the list.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * The order of deleted entries is from the newest to the oldest added
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * one. If you want to traverse from the oldest to the newest, you
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * must reverse the order by yourself before traversing.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤§æ¦‚æ„æ€æ˜¯è¯´åªæœ‰ä»åˆ—è¡¨ä¸Šåˆ é™¤ä¸‹æ¥çš„å…ƒç´ æ‰å¯ä»¥å®‰å…¨çš„éå†ã€‚ï¼ˆè¿™ç‚¹ç†è§£çš„ä¸æ·±å…¥ï¼‰&lt;/p>
&lt;h2 id="åè®°">åè®° &lt;a href="#%e5%90%8e%e8%ae%b0" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æœ¬æ¥æ˜¯æƒ³æŠŠè¿™llistçš„ä»£ç çœ‹æ˜ç™½çš„ã€‚ä½†æ˜¯ï¼Œå¤§æ¦‚åªçœ‹æ‡‚äº†60%ã€‚ã€‚ã€‚&lt;/p>
&lt;p>ä»¥åå¦‚æœæœ‰æ–°çš„æƒ³æ³•ï¼Œçœ‹åˆ°äº†æ–°çš„ä¸œè¥¿ï¼Œä¹Ÿè®¸ä¼šæœ‰ä¸å°‘æœ‰ç”¨çš„updateå§ã€‚ã€‚&lt;/p></description></item><item><title>Codeforces Round #215 (Div. 2)ä¸å®Œå…¨ä¸æ­£ç¡®é¢˜è§£</title><link>https://wizmann.top/posts/cf-215-div-2/</link><pubDate>Wed, 27 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/cf-215-div-2/</guid><description>&lt;h3 id="a-sereja-and-coat-rack">A. Sereja and Coat Rack &lt;a href="#a-sereja-and-coat-rack" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‚»é€¼æ‰é”™çš„é¢˜ã€‚ä¸å¹¸ä¸­æªã€‚&lt;/p>
&lt;p>æ²¡ä»€ä¹ˆå¯è¯´çš„ã€‚ç›´æ¥çœ‹ä»£ç å°±å¥½ã€‚&lt;/p>
&lt;h3 id="b-sereja-and-suffixes">B. Sereja and Suffixes &lt;a href="#b-sereja-and-suffixes" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å…³é”®æ€æƒ³åœ¨äºç»Ÿè®¡A[i&amp;hellip;n-1]ä¸­æœ‰å¤šå°‘äº’ä¸ç›¸åŒçš„æ•°ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ç¦»çº¿æ€æƒ³ï¼ŒæŠŠæŸ¥è¯¢æŒ‰&lt;code>greater&amp;lt;int&amp;gt;&lt;/code>æ’åºï¼Œç„¶åä½¿ç”¨Hashè¡¨è¿›è¡Œç»Ÿè®¡ï¼Œç®€å•é¢˜ã€‚&lt;/p>
&lt;h3 id="c-sereja-and-algorithm">C. Sereja and Algorithm &lt;a href="#c-sereja-and-algorithm" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ€è·¯é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å®¹æ˜“æƒ³åˆ°å¦‚æœå¯ä»¥äº¤æ¢ç›¸é‚»ä¸¤ä¸ªå­—æ¯çš„ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—è¿™ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰çš„æ’åˆ—ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç»Ÿè®¡å‡ºA[i&amp;hellip;j]ä¸­x, y, zçš„ä¸ªæ•°ã€‚&lt;/p>
&lt;p>ç„¶åè¿›è¡Œæ’åˆ—ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ¨å‡ºï¼Œç¨³å®šçš„æ’åˆ—ï¼ˆå³å¯ä»¥ä½¿ç®—æ³•åœä¸‹æ¥çš„æ’åˆ—ï¼‰åªæœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>zy[xzy][xzy]...
xz[yxz][yxz]...
yx[zyx][zyx]...
//[]ä¸­çš„æ˜¯å¾ªç¯èŠ‚
&lt;/code>&lt;/pre>&lt;p>æ‰€ä»¥åªéœ€è¦æ•°å­¦ä¸Šçš„ä¸€ç‚¹è®¡ç®—å°±å¯ç®—å‡ºæˆ‘ä»¬å¯ä¸å¯ä»¥ç”Ÿæˆä»¥ä¸Šçš„æ’åˆ—ã€‚&lt;/p>
&lt;h3 id="d-sereja-ans-anagrams">D. Sereja ans Anagrams &lt;a href="#d-sereja-ans-anagrams" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å‘é¢˜ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªç®€å•çš„åŒç«¯é˜Ÿåˆ— + Hashè¡¨ç»Ÿè®¡ã€‚&lt;/p>
&lt;p>å‘æœ‰ä¸¤å¤„ï¼Œä¸€æ˜¯æœ€åçš„ç»“æœéœ€è¦å»é‡ã€‚è¿™ä¸ªæ˜¯æˆ‘åšæ³•çš„é—®é¢˜ï¼Œç”¨ä¸€ä¸ªHashè¡¨åˆ¤é‡ï¼Œå¦‚æœqaæ»¡è¶³æ¡ä»¶ï¼Œåç»­å°±ä¸éœ€è¦æšä¸¾qaè¿™ä¸ªç‚¹äº†ã€‚&lt;/p>
&lt;p>äºŒæ˜¯ä¸€äº›ä¸­é—´ç»“æœä¼šçˆ†intï¼Œæ‰€ä»¥è¦å®æ—¶ä¼°è®¡æ•°æ®è§„æ¨¡ã€‚&lt;/p>
&lt;h2 id="e-sereja-and-the-arrangement-of-numbers">E. Sereja and the Arrangement of Numbers &lt;a href="#e-sereja-and-the-arrangement-of-numbers" class="anchor">ğŸ”—&lt;/a>&lt;/h2>&lt;p>æ¬§æ‹‰è·¯å¾„ã€‚&lt;/p>
&lt;p>å…ˆç§‘æ™®ä¸€ä¸‹ã€‚ï¼ˆå¥½å§ï¼Œå…¶å®å¤§å®¶éƒ½çŸ¥é“ï¼Œåªæœ‰æˆ‘å¿˜è®°äº†ã€‚ã€‚ã€‚ï¼‰&lt;/p>
&lt;blockquote>
&lt;p>å¯¹äºä¸€ä¸ªç»™å®šçš„è¿é€šå›¾ï¼Œæ€æ ·åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç€ä¸€ä¸ªæ°å¥½åŒ…å«äº†æ‰€æœ‰çš„è¾¹ï¼Œå¹¶ä¸”æ²¡æœ‰é‡å¤çš„è·¯å¾„ï¼Ÿ&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>è¿™å°±æ˜¯ä¸€ç¬”ç”»é—®é¢˜ã€‚ç”¨å›¾è®ºçš„æœ¯è¯­æ¥è¯´ï¼Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªå›¾æ˜¯å¦æ˜¯ä¸€ä¸ªèƒ½å¤Ÿéå†å®Œæ‰€æœ‰çš„è¾¹è€Œæ²¡æœ‰é‡å¤ã€‚è¿™æ ·çš„å›¾ç°ç§°ä¸ºæ¬§æ‹‰å›¾ã€‚è¿™æ—¶éå†çš„è·¯å¾„ç§°ä½œæ¬§æ‹‰è·¯å¾„ï¼ˆä¸€ä¸ªç¯æˆ–è€…ä¸€æ¡é“¾ï¼‰ï¼Œå¦‚æœè·¯å¾„é—­åˆï¼ˆä¸€ä¸ªåœˆï¼‰ï¼Œåˆ™ç§°ä¸ºæ¬§æ‹‰å›è·¯ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æœ‰kä¸ªnumbersï¼Œè‹¥è¦ç”Ÿæˆä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„åºåˆ—ã€‚åˆ™è¿™kä¸ªæ•°å­—çš„ç›¸é‚»å…³ç³»å¿…ç„¶èƒ½æ„æˆä¸€ä¸ªæ¬§æ‹‰è·¯å¾„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿é€šçš„æ— å‘å›¾ G æœ‰æ¬§æ‹‰è·¯å¾„çš„å……è¦æ¡ä»¶æ˜¯ï¼šGä¸­å¥‡é¡¶ç‚¹ï¼ˆè¿æ¥çš„è¾¹æ•°é‡ä¸ºå¥‡æ•°çš„é¡¶ç‚¹ï¼‰çš„æ•°ç›®ç­‰äº0æˆ–è€…2ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æ‰€ä»¥æˆ‘ä»¬å®¹æ˜“æ±‚å‡ºåœ¨æœ‰kä¸ªç‚¹æ—¶ï¼Œå›¾ä¸­åº”è¯¥æœ‰å¤šå°‘æ¡è¾¹ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬çš„åºåˆ—åº”è¯¥æœ‰å¤šé•¿ã€‚&lt;/p>
&lt;p>å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ä¸Šæ¥ï¼Œæˆ‘ä»¬é™å®šäº†åºåˆ—çš„é•¿åº¦ï¼Œæ‰€ä»¥å›¾ä¸­è¾¹çš„æ•°ç›®ä¹Ÿæœ‰äº†é™åˆ¶ã€‚äºæ˜¯æˆ‘ä»¬ç”±è¾¹æ•°ä½¿ç”¨äºŒåˆ†æšä¸¾åæ¨ç‚¹æ•°ã€‚&lt;/p>
&lt;p>ç„¶åé€‰å–ä»·æ ¼æœ€é«˜çš„tä¸ªç‚¹æ•°ï¼Œå¹¶ç®—å‡ºæ€»èŠ±è´¹ã€‚&lt;/p>
&lt;p>å‚è€ƒè‡ª&lt;a href="http://codeforces.com/blog/entry/9728">liyishuai&lt;/a>&lt;/p>
&lt;h3 id="ä»£ç ">ä»£ç  &lt;a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>ä»…ä¾›å‚è€ƒï¼š&lt;a href="https://github.com/Wizmann/ACM-ICPC/tree/master/Codeforces/Codeforces%20Round%20%23216%20(Div.%202)">æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>CSE351 - Lab 1: Manipulating Bits Using C</title><link>https://wizmann.top/posts/cse351-lab1/</link><pubDate>Wed, 27 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/cse351-lab1/</guid><description>&lt;p>ä»Šå¤©åšäº†CSE351 - Lab1ï¼Œæ·±æ·±çš„æ„Ÿè§‰å›½å¤–çš„è®¡ç®—æœºæ•™å­¦çˆ†äº†æˆ‘æ ¡ä¸€æ¡è¡—ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šæ˜¯å‰è¨€ã€‚&lt;/p>
&lt;hr>
&lt;h3 id="bitand--bitor">bitAnd &amp;amp; bitOr &lt;a href="#bitand--bitor" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¾·æ‘©æ ¹å®šç†çš„åº”ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * bitAnd - x&amp;amp;y using only ~ and |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Example: bitAnd(6, 5) = 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ~ |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">bitAnd&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">~&lt;/span>(&lt;span style="color:#f92672">~&lt;/span>x &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">~&lt;/span>y);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * bitOr - x|y using only ~ and &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Example: bitOr(6, 5) = 7
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ~ &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">bitOr&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">~&lt;/span>(&lt;span style="color:#f92672">~&lt;/span>x &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#f92672">~&lt;/span>y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="istmax">isTmax &lt;a href="#istmax" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å› ä¸º&lt;/p>
&lt;p>&lt;code>Tmax == INT_MAX == 0x7fff ffff&lt;/code>&lt;/p>
&lt;p>=&amp;gt; &lt;code>INT_MAX + INT_MAX + 2 == 0&lt;/code>&lt;/p>
&lt;p>åˆå› ä¸º&lt;code>-1 == 0xffff ffff&lt;/code>&lt;/p>
&lt;p>=&amp;gt; &lt;code>-1 + -1 + 2 = 0&lt;/code>&lt;/p>
&lt;p>äºæ˜¯æˆ‘ä»¬è¿˜è¦åŠ ä¸€æ¡åˆ¤æ–­æ˜¯å¦æ˜¯-1çš„é€»è¾‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * isTmax - returns 1 if x is the maximum, two&amp;#39;s complement number,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * and 0 otherwise
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | +
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">isTmax&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!&lt;/span>((x &lt;span style="color:#f92672">+&lt;/span> x &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">!&lt;/span>(&lt;span style="color:#f92672">~&lt;/span>x));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="iszero">isZero &lt;a href="#iszero" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * isZero - returns 1 if x == 0, and 0 otherwise
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: isZero(5) = 0, isZero(0) = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">isZero&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!&lt;/span>x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="fitsbits">fitsBits &lt;a href="#fitsbits" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * fitsBits - return 1 if x can be represented as an
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * n-bit, two&amp;#39;s complement integer.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * 1 &amp;lt;= n &amp;lt;= 32
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: fitsBits(5,3) = 0, fitsBits(-4,3) = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 15
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">fitsBits&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> shift &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span> &lt;span style="color:#f92672">+&lt;/span> (&lt;span style="color:#f92672">~&lt;/span>n &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>); &lt;span style="color:#75715e">// equal to 32 - n
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!&lt;/span>(((x &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> shift) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> shift) &lt;span style="color:#f92672">^&lt;/span> x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="getbyte">getByte &lt;a href="#getbyte" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * getByte - Extract byte n from word x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Bytes numbered from 0 (LSB) to 3 (MSB)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: getByte(0x12345678,1) = 0x56
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">getByte&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ((x &lt;span style="color:#f92672">&amp;amp;&lt;/span> (&lt;span style="color:#ae81ff">0xFF&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span>(n &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>))) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> (n &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>)) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0xFF&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="isnegative">isNegative &lt;a href="#isnegative" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>æ‰¾åˆ°ç¬¦å·ä½&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * isNegative - return 1 if x &amp;lt; 0, return 0 otherwise
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Example: isNegative(-1) = 1.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">isNegative&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!!&lt;/span>(x &lt;span style="color:#f92672">&amp;amp;&lt;/span> (&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="addok">addOK &lt;a href="#addok" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>å¦‚æœaå’ŒbåŒå·ï¼Œä¸”a + bä¸aå¼‚å·ï¼Œåˆ™ä¸å¯ä»¥åŠ &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * addOK - Determine if can compute x+y without overflow
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Example: addOK(0x80000000,0x80000000) = 0,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * addOK(0x80000000,0x70000000) = 1,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 20
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">addOK&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sum &lt;span style="color:#f92672">=&lt;/span> ((x &lt;span style="color:#f92672">+&lt;/span> y) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sx &lt;span style="color:#f92672">=&lt;/span> (x &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sy &lt;span style="color:#f92672">=&lt;/span> (y &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">!&lt;/span>((&lt;span style="color:#f92672">!&lt;/span>(sx &lt;span style="color:#f92672">^&lt;/span> sy)) &lt;span style="color:#f92672">&amp;amp;&lt;/span> (sx &lt;span style="color:#f92672">^&lt;/span> sum));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="isgreater">isGreater &lt;a href="#isgreater" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * isGreater - if x &amp;gt; y then return 1, else return 0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Example: isGreater(4,5) = 0, isGreater(5,4) = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 24
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">isGreater&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> y) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sx &lt;span style="color:#f92672">=&lt;/span> (x &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sy &lt;span style="color:#f92672">=&lt;/span> (y &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x_minus_y &lt;span style="color:#f92672">=&lt;/span> (x &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">~&lt;/span>y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sminus &lt;span style="color:#f92672">=&lt;/span> (((x_minus_y) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#f92672">!&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">^&lt;/span> x_minus_y);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>(sx &lt;span style="color:#f92672">^&lt;/span> sy) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>sminus) &lt;span style="color:#f92672">|&lt;/span> ((sx &lt;span style="color:#f92672">^&lt;/span> sy) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#f92672">!&lt;/span>sx);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="replacebyte">replaceByte &lt;a href="#replacebyte" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * replaceByte(x,n,c) - Replace byte n in x with c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Bytes numbered from 0 (LSB) to 3 (MSB)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: replaceByte(0x12345678,1,0xab) = 0x1234ab78
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * You can assume 0 &amp;lt;= n &amp;lt;= 3 and 0 &amp;lt;= c &amp;lt;= 255
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">replaceByte&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> n, &lt;span style="color:#66d9ef">int&lt;/span> c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (x &lt;span style="color:#f92672">&amp;amp;&lt;/span> (&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">^&lt;/span> &lt;span style="color:#ae81ff">0xFF&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> (n &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>))) &lt;span style="color:#f92672">|&lt;/span> (c &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> (n &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="rotateleft">rotateLeft &lt;a href="#rotateleft" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * rotateLeft - Rotate x to the left by n
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Can assume that 0 &amp;lt;= n &amp;lt;= 31
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: rotateLeft(0x87654321,4) = 0x76543218
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 25
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">rotateLeft&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x, &lt;span style="color:#66d9ef">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> mask &lt;span style="color:#f92672">=&lt;/span> ((&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> n) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> (&lt;span style="color:#ae81ff">33&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">~&lt;/span>n);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> t &lt;span style="color:#f92672">=&lt;/span> ((x &lt;span style="color:#f92672">&amp;amp;&lt;/span> mask) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> (&lt;span style="color:#ae81ff">33&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">~&lt;/span>n)) &lt;span style="color:#f92672">&amp;amp;&lt;/span> ((&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> n) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (x &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> n) &lt;span style="color:#f92672">|&lt;/span> t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="bitcount">bitCount &lt;a href="#bitcount" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>è¿™ä¸ªæ˜¯ä»&lt;a href="http://stackoverflow.com/a/3815253/2927439">stackoverflow&lt;/a>ä¸Šæ‰¾æ¥çš„ç­”æ¡ˆï¼Œå¾ˆå‰å®³ï¼Œä¸è¿‡è¿˜æ²¡çœ‹æ˜ç™½ä¸ºå•¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * bitCount - returns count of number of 1&amp;#39;s in word
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: bitCount(5) = 2, bitCount(7) = 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ! ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 40
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">bitCount&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (x &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x55555555&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> ((x &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x55555555&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (c &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x33333333&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> ((c &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x33333333&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (c &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x0F0F0F0F&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> ((c &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x0F0F0F0F&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (c &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x00FF00FF&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> ((c &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x00FF00FF&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> c &lt;span style="color:#f92672">=&lt;/span> (c &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x0000FFFF&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> ((c &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>)&lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0x0000FFFF&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="isnonzero">isNonZero &lt;a href="#isnonzero" class="anchor">ğŸ”—&lt;/a>&lt;/h3>&lt;p>&lt;code>(~x + 1) == -x&lt;/code>&lt;/p>
&lt;p>=&amp;gt; &lt;code>x | -x&lt;/code>çš„ç¬¦å·ä½ä¸ºè´Ÿ&lt;/p>
&lt;p>å¯¹äºç‰¹æ®Šæ•°æ®&lt;code>INT_MIN&lt;/code>ä¹Ÿå¯ä»¥å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * isNonZero - Check whether x is nonzero using
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * the legal operators except !
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Examples: isNonZero(3) = 1, isNonZero(0) = 0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Legal ops: ~ &amp;amp; ^ | + &amp;lt;&amp;lt; &amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Max ops: 10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * Rating: 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">isNonZero&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ((x &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#f92672">~&lt;/span>x &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">31&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>CSE 351 - Hardware/Software Interface</title><link>https://wizmann.top/posts/washington-university-cse351/</link><pubDate>Tue, 26 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/washington-university-cse351/</guid><description>&lt;p>å¼€ä¸€é—¨å…¬å¼€è¯¾ï¼ŒWashington Universityçš„Hardware/Software Interfaceã€‚&lt;/p>
&lt;p>ä¼ è¯´æ˜¯å¾ˆä¸é”™çš„è®¡ç®—æœºç§‘å­¦å…¬å¼€è¯¾ã€‚ä½¿ç”¨&lt;a href="http://book.douban.com/subject/5333562/">æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ&lt;/a>åšæ•™æï¼Œæ­£å¥½æ˜¯æˆ‘è¦è¯»çš„ä¹¦ï¼Œæ‰€ä»¥é¡ºä¾¿å¬å¬è¯¾ã€‚&lt;/p>
&lt;p>è±†ç“£ä¸Šæœ‰äººå†™äº†&lt;a href="http://book.douban.com/review/6093947/">æ¨è&lt;/a>ï¼Œè§‚ç‚¹æ˜¯è¿™è¯¾è™½ç„¶ä¸é”™ï¼Œä½†æ˜¯æ¯”è¾ƒæµ…ã€‚æ ¹æ®æˆ‘ç°åœ¨çš„ç†è§£æ¥è¯´ï¼Œç¡®å®æ¯”è¾ƒæµ…ï¼Œå¦‚æœæœ‰ä¸é”™çš„é«˜çº§è¯­è¨€ç¼–ç¨‹åŸºç¡€ï¼ˆC/C++/Java/Pascalç­‰ï¼Œè„šæœ¬å°±ç®—äº†ï¼‰ï¼Œå¾ˆå¤šä¸œè¥¿å¯ä»¥é€Ÿæ¨ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥çš„ä¸€äº›æ—¥å¿—ä¼šæ˜¯è¿™é—¨è¯¾çš„ä½œä¸šã€å®éªŒå’Œæ„Ÿæƒ³ã€‚ç°åœ¨å…ˆæŒ–ä¸ªå‘ã€‚æ…¢æ…¢å¡«ä¸Šã€‚&lt;/p>
&lt;hr>
&lt;p>è¯¾ç¨‹è§†é¢‘ï¼š&lt;a href="http://pan.baidu.com/wap/link?&amp;amp;shareid=3687486382&amp;amp;uk=2919707929&amp;amp;third=0&amp;amp;page=1">æˆ³æˆ‘&lt;/a>&lt;/p>
&lt;p>è¯¾ç¨‹ä¸»é¡µï¼š&lt;a href="https://courses.cs.washington.edu/courses/cse351/13su/index.html">æˆ³æˆ‘&lt;/a>&lt;/p></description></item><item><title>ä½¿ç”¨pipå’Œvirtuanenv</title><link>https://wizmann.top/posts/using-pip-and-virtualenv/</link><pubDate>Mon, 25 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/using-pip-and-virtualenv/</guid><description>&lt;p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªæ— èŠçš„å°æ®µå­å¼€å§‹ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&amp;ldquo;Whatâ€™s pip?&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;A python package manager&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;How do I install it?&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;easy_install pip&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;Whatâ€™s easy_install?&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;A python package manager&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;p>pipå’Œeasy_installéƒ½æ˜¯pythonçš„åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äºrubyçš„gemä»¥åŠnodejsçš„npmã€‚&lt;/p>
&lt;p>è€Œpipæ˜¯easy_installçš„å‡çº§ç‰ˆï¼Œåœ¨è¿™ä¸ª&lt;a href="http://www.pip-installer.org/en/1.0.2/#pip-compared-to-easy-install">é¡µé¢&lt;/a>ä¸­æåˆ°äº†pipå¯¹äºeasy_installçš„å‡çº§ã€‚å…¶ä¸­æåˆ°äº†ä¸€ç‚¹éå¸¸é‡è¦ã€‚&lt;/p>
&lt;blockquote>
&lt;p>pip is complementary with virtualenv, and it is encouraged that you use virtualenv to isolate your installation.&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æœæœ‰åŒå­¦ä¸ç†Ÿæ‚‰virtualenvï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªå°å°çš„ä»‹ç»ã€‚ï¼ˆä»¥ä¸‹ç¿»è¯‘æ¥è‡ªï¼š&lt;a href="http://blogs.360.cn/blog/how-360-uses-python-1-virtualenv/">æˆ³æˆ‘&lt;/a>ï¼‰&lt;/p>
&lt;blockquote>
&lt;p>virtualenv æ˜¯ä¸€ä¸ªåˆ›å»ºéš”ç¦»çš„Pythonç¯å¢ƒçš„å·¥å…·ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>virtualenvè¦è§£å†³çš„æ ¹æœ¬é—®é¢˜æ˜¯åº“çš„ç‰ˆæœ¬å’Œä¾èµ–ï¼Œä»¥åŠæƒé™é—®é¢˜ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦LibFooçš„ç‰ˆæœ¬1ï¼Œè€Œå¦ä¸€ä¸ªç¨‹åºéœ€è¦ç‰ˆæœ¬2ï¼Œå¦‚ä½•åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºå‘¢ï¼Ÿå¦‚æœå°†æ‰€æœ‰çš„åº“éƒ½å®‰è£…åœ¨ /usr/lib/python2.7/site-packagesï¼ˆæˆ–è€…ä½ çš„ç³»ç»Ÿçš„æ ‡å‡†åŒ…å®‰è£…è·¯å¾„ï¼‰ï¼Œéå¸¸å®¹æ˜“å‡ºç°å°†ä¸è¯¥å‡çº§çš„åº“å‡çº§çš„é—®é¢˜ã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>å¦å¤–ï¼Œåœ¨ä¸€å°å…±äº«çš„æœºå™¨ä¸Šï¼Œå¦‚æœæ²¡æœ‰å…¨å±€çš„ site-packages ç›®å½•çš„æƒé™ï¼ˆä¾‹å¦‚ä¸€ä¸ªå…±äº«çš„ä¸»æœºï¼‰ï¼Œå¦‚ä½•å®‰è£…Pythonåº“å‘¢ï¼Ÿ&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°±æ˜¯è¯¥ç”¨åˆ°virtualenvçš„åœ°æ–¹ã€‚å®ƒèƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªè‡ªå·±çš„å®‰è£…ç›®å½•ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒï¼Œä¸ä¼šå½±å“å…¶ä»–çš„virtualenvç¯å¢ƒï¼Œç”šè‡³å¯ä»¥ä¸å—å…¨å±€çš„site-packageså½“ä¸­å®‰è£…çš„åŒ…çš„å½±å“&lt;/p>&lt;/blockquote>
&lt;p>ç”±äºvirtualenvçš„ä»¥ä¸Šä¼˜ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨pipä¸virtualenvé…åˆï¼Œå¯ä»¥å¾ˆè½»æ¾ä¿è¯çº¿ä¸Šçº¿ä¸‹è¿è¡Œç¯å¢ƒä¸€è‡´ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚&lt;/p>
&lt;p>ä¸¾ä¸€ä¸ªä¾‹å­ã€‚&lt;/p>
&lt;p>åœ¨çº¿ä¸‹å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code>virtualenv env&lt;/code>åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒã€‚å¹¶ä½¿ç”¨&lt;code>source env/bin/activate&lt;/code>æ¿€æ´»ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…æˆ‘ä»¬éœ€è¦çš„åŒ…ã€‚æ­¤æ—¶æˆ‘ä»¬çš„ç¯å¢ƒä¸å…¨å±€å®Œå…¨éš”ç¦»ï¼Œæ‰€æœ‰Pythonè¿è¡Œç¯å¢ƒåªä»¥æ¥äºç°æœ‰çš„è™šæ‹Ÿç¯å¢ƒã€‚&lt;/p>
&lt;p>åœ¨éƒ¨ç½²æœåŠ¡æ—¶ï¼Œæ‹·è´æ•´ä¸ªè™šæ‹Ÿç¯å¢ƒå¿…ç„¶æ˜¯ä¸æ˜æ™ºçš„é€‰æ‹©ã€‚æˆ‘ä»¬ä½¿ç”¨&lt;code>pip freeze &amp;gt; requirements.txt&lt;/code>å°†æœ¬ç¯å¢ƒçš„ä¾èµ–å†™å…¥&lt;code>requirements.txt&lt;/code>æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ç„¶ååœ¨çº¿ä¸Šæ–°å»º&lt;code>env_online&lt;/code>ï¼Œæ¿€æ´»ä¹‹ã€‚å¹¶è°ƒç”¨&lt;code>pip install -r requirements.txt&lt;/code>ï¼Œæ­¤æ—¶çº¿ä¸ŠæœåŠ¡å™¨ä¼šä¸‹è½½æ‰€æœ‰ä¾èµ–åŒ…ã€‚åœ¨å®‰è£…ç»“æŸåï¼Œæˆ‘ä»¬å°±å…‹éš†äº†çº¿ä¸‹çš„ç¯å¢ƒã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œå¦‚æœçº¿ä¸ŠæœåŠ¡å™¨æ²¡æœ‰è¿æ¥å¤–ç½‘ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¦»çº¿æ–¹æ³•å®‰è£…éœ€è¦çš„åŒ…ã€‚&lt;/p>
&lt;p>&lt;code>pip bundle env.pybundle -r requirements.txt&lt;/code>ä¼šé‡æ–°ä¸‹è½½æ‰€æœ‰ä¾èµ–çš„åŒ…ï¼Œå¹¶å†™å…¥&lt;code>env.pybundle&lt;/code>ã€‚ç„¶åæˆ‘ä»¬å°†å…¶ä¸Šä¼ åˆ°çº¿ä¸Šï¼Œä½¿ç”¨&lt;code>pip install env.pybundle&lt;/code>å®‰è£…å³å¯ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šæ˜¯pipå’Œvirtualenvé…åˆä½¿ç”¨ä¸€äº›æŠ€å·§ã€‚å‚è€ƒè‡ªï¼š&lt;a href="http://blog.csdn.net/tulip527/article/details/8478093">æˆ³æˆ‘&lt;/a>ã€‚&lt;/p></description></item><item><title>Hello World</title><link>https://wizmann.top/posts/hello-world/</link><pubDate>Sun, 24 Nov 2013 00:00:00 +0000</pubDate><guid>https://wizmann.top/posts/hello-world/</guid><description>&lt;p>æ‰“ç®—æŠŠåšå®¢è¿åˆ°è¿™é‡Œæ¥äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>print &lt;span style="color:#e6db74">&amp;#39;Hello World&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>