<!doctype html><html><head><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}}</script><script defer src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><header class=header-wrapper><div class=header><a class=site-title href=https://wizmann.top/>Maerlyn's Rainbow</a><nav class=menu></nav></div></header><main class=main-wrapper><div class=main><section class=single><h1 class=title>å†…å­˜å±éšœåˆæ¢</h1><div class=tip><time datetime="2014-05-08 19:05:26 +0000 UTC">2014/05/08</time>
<span class=split>Â·</span>
<span>5204 words </span><span class=split>Â·</span>
<span>11 minutes to read</span></div><div class=taxonomies><div>Tags:
<a href=/tags/cpp>cpp</a>
<a href=/tags/memory-barrier>memory-barrier</a>
<a href=/tags/asm>asm</a>
<a href=/tags/multiprocess>multiprocess</a>
<a href=/tags/multithread>multithread</a>
<a href=/tags/thread>thread</a>
<a href=/tags/cocurrency>cocurrency</a></div></div><hr><div class=content><h2 id=åŸæ–‡åœ°å€>åŸæ–‡åœ°å€ <a href=#%e5%8e%9f%e6%96%87%e5%9c%b0%e5%9d%80 class=anchor>ğŸ”—</a></h2><p><a href=http://ridiculousfish.com/blog/posts/barrier.html>Barrier February 17th, 2007</a></p><h2 id=å‰è¨€å¤šæ ¸æ—¶ä»£çš„æŒ‘æˆ˜>å‰è¨€ï¼šå¤šæ ¸æ—¶ä»£çš„æŒ‘æˆ˜ <a href=#%e5%89%8d%e8%a8%80%e5%a4%9a%e6%a0%b8%e6%97%b6%e4%bb%a3%e7%9a%84%e6%8c%91%e6%88%98 class=anchor>ğŸ”—</a></h2><p>å°½ç®¡80æ ¸å¿ƒçš„æµ®ç‚¹è¿ç®—å·¨å…½ä»ç„¶é¥ä¸å¯åŠï¼Œå¤šæ ¸å¤„ç†å™¨çš„æ—¶ä»£å·²ç»åˆ°æ¥ã€‚å¤šæ ¸å¤„ç†å™¨çš„æ¦‚å¿µå¹¶éæ–°é²œäº‹ç‰©ï¼Œåœ¨Power Macintosh 9500ä¸­å°±å·²ç»é‡‡ç”¨äº†å¤šæ ¸å¤„ç†å™¨æŠ€æœ¯ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥ç†è§£å¤šæ ¸å¤„ç†å™¨çš„å†…åœ¨æœºåˆ¶ã€‚</p><h2 id=çº¿ç¨‹æŠ€æœ¯æ¢è®¨>çº¿ç¨‹æŠ€æœ¯æ¢è®¨ <a href=#%e7%ba%bf%e7%a8%8b%e6%8a%80%e6%9c%af%e6%8e%a2%e8%ae%a8 class=anchor>ğŸ”—</a></h2><h3 id=åè¯è§£é‡Š>åè¯è§£é‡Š <a href=#%e5%90%8d%e8%af%8d%e8%a7%a3%e9%87%8a class=anchor>ğŸ”—</a></h3><h4 id=çº¿ç¨‹>çº¿ç¨‹ <a href=#%e7%ba%bf%e7%a8%8b class=anchor>ğŸ”—</a></h4><p>çº¿ç¨‹æ˜¯ä¸€ç§æ‹¥æœ‰å…±äº«åœ°å€ç©ºé—´çš„ã€èƒ½è¢«æŠ¢å å¼è°ƒåº¦çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><h4 id=å¤šçº¿ç¨‹>å¤šçº¿ç¨‹ <a href=#%e5%a4%9a%e7%ba%bf%e7%a8%8b class=anchor>ğŸ”—</a></h4><p>å¤šçº¿ç¨‹æ˜¯ä¸€ç§ç”¨äºç®€åŒ–æ§åˆ¶æµã€ç»•è¿‡é˜»å¡ç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•ï¼Œå¹¶ä¸ä¸“é—¨ç”¨äºå®ç°ç¨‹åºçš„å¹¶è¡ŒåŒ–ã€‚</p><h4 id=å¹¶å‘å¤šçº¿ç¨‹>å¹¶å‘å¤šçº¿ç¨‹ <a href=#%e5%b9%b6%e5%8f%91%e5%a4%9a%e7%ba%bf%e7%a8%8b class=anchor>ğŸ”—</a></h4><p>ç‰©ç†ä¸Šå¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ—¨åœ¨é€šè¿‡åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚</p><h3 id=å¹¶å‘å¤šçº¿ç¨‹çš„æŒ‘æˆ˜>â€œå¹¶å‘å¤šçº¿ç¨‹â€çš„æŒ‘æˆ˜ <a href=#%e5%b9%b6%e5%8f%91%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%8c%91%e6%88%98 class=anchor>ğŸ”—</a></h3><p>å°½ç®¡å¹¶å‘å¤šçº¿ç¨‹è¢«å¹¿æ³›è®¨è®ºï¼Œå…¶æŒ‘æˆ˜å¹¶éæºè‡ªè‡ªç„¶åŸå› ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±çš„è®¾è®¡é€‰æ‹©æ‰€é€ æˆçš„ã€‚ä¸»è¦é—®é¢˜åœ¨äºï¼Œé’ˆå¯¹å•çº¿ç¨‹ç¨‹åºçš„è¿‡åº¦ä¼˜åŒ–åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸å†é€‚ç”¨ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œç”±äºCPUçš„æ‰§è¡Œé€Ÿåº¦è¿œè¶…å†…å­˜å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹å†…å­˜å†…å®¹è¿›è¡Œâ€œé¢„æµ‹â€ï¼Œä»è€Œé¿å…CPUç­‰å¾…å†…å­˜æ£€æŸ¥ã€‚è¿™é‡Œçš„â€œé¢„æµ‹â€å®é™…ä¸Šæ˜¯CPUå’Œç¼–è¯‘å™¨å¯¹å†…å­˜çŠ¶æ€åšå‡ºçš„è¶Šæ¥è¶Šæ¿€è¿›çš„å‡è®¾ã€‚</p><h2 id=ç¤ºä¾‹åˆ†æ>ç¤ºä¾‹åˆ†æ <a href=#%e7%a4%ba%e4%be%8b%e5%88%86%e6%9e%90 class=anchor>ğŸ”—</a></h2><h3 id=å†™çº¿ç¨‹ç¤ºä¾‹>å†™çº¿ç¨‹ç¤ºä¾‹ <a href=#%e5%86%99%e7%ba%bf%e7%a8%8b%e7%a4%ba%e4%be%8b class=anchor>ğŸ”—</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// åˆå§‹æ—¶ variable1 = variable2 = 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    variable1<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    variable2<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=è¯»çº¿ç¨‹ç¤ºä¾‹>è¯»çº¿ç¨‹ç¤ºä¾‹ <a href=#%e8%af%bb%e7%ba%bf%e7%a8%8b%e7%a4%ba%e4%be%8b class=anchor>ğŸ”—</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    local2 <span style=color:#f92672>=</span> variable2;
</span></span><span style=display:flex><span>    local1 <span style=color:#f92672>=</span> variable1;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (local2 <span style=color:#f92672>&gt;</span> local1) {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Error!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ­£å¸¸é€»è¾‘ä¸‹ï¼Œlocal2 åº”å½“å§‹ç»ˆå°äºæˆ–ç­‰äº local1ï¼Œå› ä¸º variable1 æ€»æ˜¯åœ¨ variable2 ä¹‹åå¢åŠ ã€‚</p><p>ç„¶è€Œï¼Œç°å®æ˜¯å¦å¦‚æ­¤ï¼Ÿ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cstdio&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ctime&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;pthread.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/time.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> <span style=color:#66d9ef>namespace</span> std;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>unsigned</span> variable1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>unsigned</span> variable2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#define ITERATIONS 200000000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>writer</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>unused) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (;;) {
</span></span><span style=display:flex><span>        variable1 <span style=color:#f92672>=</span> variable1 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        variable2 <span style=color:#f92672>=</span> variable2 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> NULL;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>reader</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>unused) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>timeval</span> start, end;
</span></span><span style=display:flex><span>    gettimeofday(<span style=color:#f92672>&amp;</span>start, NULL);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> i, failureCount <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> ITERATIONS; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> v2 <span style=color:#f92672>=</span> variable2;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> v1 <span style=color:#f92672>=</span> variable1;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (v2 <span style=color:#f92672>&gt;</span> v1) failureCount<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    gettimeofday(<span style=color:#f92672>&amp;</span>end, NULL);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> seconds <span style=color:#f92672>=</span> end.tv_sec <span style=color:#f92672>+</span> end.tv_usec <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000000.</span> <span style=color:#f92672>-</span> start.tv_sec <span style=color:#f92672>-</span> start.tv_usec <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000000.</span>;
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;%u failure%s (%2.1f percent of the time) in %2.1f seconds</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,
</span></span><span style=display:flex><span>           failureCount, failureCount <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;s&#34;</span>,
</span></span><span style=display:flex><span>           (<span style=color:#ae81ff>100.</span> <span style=color:#f92672>*</span> failureCount) <span style=color:#f92672>/</span> ITERATIONS, seconds);
</span></span><span style=display:flex><span>    exit(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> NULL;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>    pthread_t thread1, thread2;
</span></span><span style=display:flex><span>    pthread_create(<span style=color:#f92672>&amp;</span>thread1, NULL, writer, NULL);
</span></span><span style=display:flex><span>    pthread_create(<span style=color:#f92672>&amp;</span>thread2, NULL, reader, NULL);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (;;) sleep(<span style=color:#ae81ff>1000000</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š<code>0 failures (0.0 percent of the time) in 1.2 seconds</code></p><h3 id=è²Œä¼¼æ˜¯æ­£ç¡®çš„>è²Œä¼¼æ˜¯æ­£ç¡®çš„ï¼Ÿ <a href=#%e8%b2%8c%e4%bc%bc%e6%98%af%e6%ad%a3%e7%a1%ae%e7%9a%84 class=anchor>ğŸ”—</a></h3><p>ç¨‹åºè¿è¡Œçš„æ­£å¦‚æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¡®ä¿¡ç¨‹åºæ˜¯ä¸€å®šæ­£ç¡®çš„å—ï¼Ÿ</p><p>ä¸èƒ½ã€‚</p><p>å› ä¸ºç¨‹åºä¸­çš„ä¸¤ä¸ªçº¿ç¨‹å¦‚æœåœ¨åŒä¸€ä¸ªCPUä¸Šè¢«è°ƒåº¦ï¼Œæˆ‘ä»¬æ°¸è¿œéƒ½ä¼šå¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p><h3 id=çº¿ç¨‹ä¸ä¸åŒçš„cpuè¿›è¡Œç»‘å®š>çº¿ç¨‹ä¸ä¸åŒçš„CPUè¿›è¡Œç»‘å®š <a href=#%e7%ba%bf%e7%a8%8b%e4%b8%8e%e4%b8%8d%e5%90%8c%e7%9a%84cpu%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a class=anchor>ğŸ”—</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>writer</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>unused) {
</span></span><span style=display:flex><span>    cpu_set_t cpuset;
</span></span><span style=display:flex><span>    CPU_ZERO(<span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    CPU_SET(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    sched_setaffinity(<span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>sizeof</span>(cpuset), <span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>reader</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>unused) {
</span></span><span style=display:flex><span>    cpu_set_t cpuset;
</span></span><span style=display:flex><span>    CPU_ZERO(<span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    CPU_SET(<span style=color:#ae81ff>2</span>, <span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    sched_setaffinity(<span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>sizeof</span>(cpuset), <span style=color:#f92672>&amp;</span>cpuset);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// p.s. æˆ‘æœºå™¨æ˜¯i5åŒæ ¸å››çº¿ç¨‹ï¼Œæ‰€ä»¥ç»‘åœ¨äº†CPU0å’ŒCPU2ä¸Š
</span></span></span></code></pre></div><p>ç»“æœï¼š<code>0 failures (0.0 percent of the time) in 1.4 seconds</code></p><h3 id=ä¼¼ä¹ä»ç„¶æ˜¯å‡†ç¡®çš„>ä¼¼ä¹ä»ç„¶æ˜¯å‡†ç¡®çš„ <a href=#%e4%bc%bc%e4%b9%8e%e4%bb%8d%e7%84%b6%e6%98%af%e5%87%86%e7%a1%ae%e7%9a%84 class=anchor>ğŸ”—</a></h3><p>å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘åˆ°CPUå¯¹å˜é‡çš„æ“ä½œå…¶å®æ˜¯ä½œç”¨åœ¨å¯„å­˜å™¨ä¸Šï¼Œè€Œvariable1å’Œvariable2ç´§å¯†ç›¸é‚»ï¼Œè¿™å¯èƒ½å¯¼è‡´å®ƒä»¬ä½äºç¼“å­˜çš„åŒä¸€è¡Œã€‚å› æ­¤ï¼Œå®ƒä»¬æœ‰å¯èƒ½ä¼šåŒæ—¶è¢«å†™å…¥ç¼“å­˜å¹¶ä¸€èµ·å†™å›å†…å­˜ã€‚</p><p>ä¸ºäº†è§‚å¯Ÿä¸åŒçš„æ•ˆæœï¼Œæˆ‘ä»¬å°è¯•å°†è¿™ä¸¤ä¸ªå˜é‡åˆ†åˆ«æ”¾ç½®åœ¨å †å’Œæ ˆä¸Šã€‚</p><div class=mermaid>0 failures (0.0 percent of the time) in 1.2 seconds
0 failures (0.0 percent of the time) in 1.2 seconds
2000000000 failures (100.0 percent of the time) in 1.2 seconds</div><p><strong>å¤ªæ„Ÿäººäº†ï¼</strong></p><h3 id=æˆ‘ä»¬çš„æ•Œäºº--ç¼–è¯‘å™¨>æˆ‘ä»¬çš„æ•Œäºº â€”â€” ç¼–è¯‘å™¨ <a href=#%e6%88%91%e4%bb%ac%e7%9a%84%e6%95%8c%e4%ba%ba--%e7%bc%96%e8%af%91%e5%99%a8 class=anchor>ğŸ”—</a></h3><blockquote><p>Multithreading bugs are very delicate.</p></blockquote><p>å¹¶è¡Œå¤šçº¿ç¨‹çš„é”™è¯¯æ€»æ˜¯é‚£ä¹ˆçš„å¥‡å¦™ï¼Œä¹Ÿè®¸ä½ çš„ç¨‹åºè¿è¡Œäº†å‡ å¤©å®‰ç„¶æ— æ™ï¼Œä½†æ˜¯åœ¨æŸä¸€å¤©æŸä¸€æ—¶çªç„¶å‡ºç°äº†éš¾ä»¥å¤ç°çš„ç²¾å¦™bugã€‚</p><p>å¦‚æœå¤šä¸ªçº¿ç¨‹è°ƒåº¦åœ¨åŒä¸€ä¸ªCPUæ ¸å¿ƒä¸Šï¼ŒBugä¼šè¢«æ©ç›–ã€‚<br>å¦‚æœå¤šä¸ªå˜é‡åœ¨CPUåŒä¸€è¡ŒCacheä¸Šï¼ŒBugä¼šè¢«æ©ç›–ã€‚<br>å¦‚æœä½ äººå“è¶³å¤Ÿå¥½çš„è¯ï¼ŒBugåŒæ ·ä¼šè¢«æ©ç›–ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ’é™¤äº†ä»¥ä¸Šçš„æƒ…å†µåï¼Œé—®é¢˜å°±æµ®ç°å‡ºæ¥äº†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹readerçš„åæ±‡ç¼–ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>(gdb) disas reader
</span></span><span style=display:flex><span>Dump of assembler code <span style=color:#66d9ef>for</span> function reader(<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400950</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>0</span><span style=color:#f92672>&gt;:</span> push   <span style=color:#f92672>%</span>rbx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400951</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;:</span> xor    <span style=color:#f92672>%</span>eax,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400953</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>3</span><span style=color:#f92672>&gt;:</span> mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x10</span>,<span style=color:#f92672>%</span>ecx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400958</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>8</span><span style=color:#f92672>&gt;:</span> mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x80</span>,<span style=color:#f92672>%</span>esi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040095d</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>13</span><span style=color:#f92672>&gt;:</span>    xor    <span style=color:#f92672>%</span>ebx,<span style=color:#f92672>%</span>ebx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040095f</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>15</span><span style=color:#f92672>&gt;:</span>    sub    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0xa0</span>,<span style=color:#f92672>%</span>rsp
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400966</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>22</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#f92672>%</span>rsp,<span style=color:#f92672>%</span>rdi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400969</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>25</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#f92672>%</span>rsp,<span style=color:#f92672>%</span>rdx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040096c</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>28</span><span style=color:#f92672>&gt;:</span>    rep stos <span style=color:#f92672>%</span>rax,<span style=color:#f92672>%</span>es:(<span style=color:#f92672>%</span>rdi)
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040096f</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>31</span><span style=color:#f92672>&gt;:</span>    xor    <span style=color:#f92672>%</span>edi,<span style=color:#f92672>%</span>edi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400971</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>33</span><span style=color:#f92672>&gt;:</span>    movq   <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x4</span>,(<span style=color:#f92672>%</span>rsp)
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400979</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>41</span><span style=color:#f92672>&gt;:</span>    callq  <span style=color:#ae81ff>0x400790</span> <span style=color:#f92672>&lt;</span>sched_setaffinity<span style=color:#960050;background-color:#1e0010>@</span>plt<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040097e</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>46</span><span style=color:#f92672>&gt;:</span>    lea    <span style=color:#ae81ff>0x80</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>rdi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400986</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>54</span><span style=color:#f92672>&gt;:</span>    xor    <span style=color:#f92672>%</span>esi,<span style=color:#f92672>%</span>esi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400988</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>56</span><span style=color:#f92672>&gt;:</span>    callq  <span style=color:#ae81ff>0x400710</span> <span style=color:#f92672>&lt;</span>gettimeofday<span style=color:#960050;background-color:#1e0010>@</span>plt<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040098d</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>61</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#ae81ff>0x2006e4</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>rax        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x601078</span> <span style=color:#f92672>&lt;</span>variable2_p<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400994</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>68</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#ae81ff>0x2006e6</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>edx        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x601080</span> <span style=color:#f92672>&lt;</span>variable1<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040099a</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>74</span><span style=color:#f92672>&gt;:</span>    mov    (<span style=color:#f92672>%</span>rax),<span style=color:#f92672>%</span>ecx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x000000000040099c</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>76</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x77359400</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009a1</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>81</span><span style=color:#f92672>&gt;:</span>    nopl   <span style=color:#ae81ff>0x0</span>(<span style=color:#f92672>%</span>rax)
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009a8</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>88</span><span style=color:#f92672>&gt;:</span>    cmp    <span style=color:#f92672>%</span>ecx,<span style=color:#f92672>%</span>edx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009aa</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>90</span><span style=color:#f92672>&gt;:</span>    adc    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x0</span>,<span style=color:#f92672>%</span>ebx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009ad</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>93</span><span style=color:#f92672>&gt;:</span>    sub    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x1</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009b0</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>96</span><span style=color:#f92672>&gt;:</span>    jne    <span style=color:#ae81ff>0x4009a8</span> <span style=color:#f92672>&lt;</span>reader(<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>88</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009b2</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>98</span><span style=color:#f92672>&gt;:</span>    lea    <span style=color:#ae81ff>0x90</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>rdi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009ba</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>106</span><span style=color:#f92672>&gt;:</span>   xor    <span style=color:#f92672>%</span>esi,<span style=color:#f92672>%</span>esi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009bc</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>108</span><span style=color:#f92672>&gt;:</span>   callq  <span style=color:#ae81ff>0x400710</span> <span style=color:#f92672>&lt;</span>gettimeofday<span style=color:#960050;background-color:#1e0010>@</span>plt<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009c1</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>113</span><span style=color:#f92672>&gt;:</span>   cvtsi2sdq <span style=color:#ae81ff>0x98</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>xmm0
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009cb</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>123</span><span style=color:#f92672>&gt;:</span>   cvtsi2sdq <span style=color:#ae81ff>0x90</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>xmm1
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009d5</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>133</span><span style=color:#f92672>&gt;:</span>   movsd  <span style=color:#ae81ff>0x1a3</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>xmm3        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x400b80</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009dd</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>141</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#f92672>%</span>ebx,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009df</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>143</span><span style=color:#f92672>&gt;:</span>   cvtsi2sdq <span style=color:#ae81ff>0x88</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>xmm2
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009e9</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>153</span><span style=color:#f92672>&gt;:</span>   cmp    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x1</span>,<span style=color:#f92672>%</span>ebx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009ec</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>156</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x400b3d</span>,<span style=color:#f92672>%</span>ecx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009f1</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>161</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x1</span>,<span style=color:#f92672>%</span>edi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009f6</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>166</span><span style=color:#f92672>&gt;:</span>   divsd  <span style=color:#f92672>%</span>xmm3,<span style=color:#f92672>%</span>xmm0
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009fa</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>170</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#f92672>%</span>ebx,<span style=color:#f92672>%</span>edx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x00000000004009fc</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>172</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x400b40</span>,<span style=color:#f92672>%</span>esi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a01</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>177</span><span style=color:#f92672>&gt;:</span>   divsd  <span style=color:#f92672>%</span>xmm3,<span style=color:#f92672>%</span>xmm2
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a05</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>181</span><span style=color:#f92672>&gt;:</span>   addsd  <span style=color:#f92672>%</span>xmm0,<span style=color:#f92672>%</span>xmm1
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a09</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>185</span><span style=color:#f92672>&gt;:</span>   cvtsi2sdq <span style=color:#ae81ff>0x80</span>(<span style=color:#f92672>%</span>rsp),<span style=color:#f92672>%</span>xmm0
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a13</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>195</span><span style=color:#f92672>&gt;:</span>   subsd  <span style=color:#f92672>%</span>xmm0,<span style=color:#f92672>%</span>xmm1
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a17</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>199</span><span style=color:#f92672>&gt;:</span>   cvtsi2sd <span style=color:#f92672>%</span>rax,<span style=color:#f92672>%</span>xmm0
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a1c</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>204</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x400b3c</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a21</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>209</span><span style=color:#f92672>&gt;:</span>   cmovne <span style=color:#f92672>%</span>rax,<span style=color:#f92672>%</span>rcx
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a25</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>213</span><span style=color:#f92672>&gt;:</span>   mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x2</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a2a</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>218</span><span style=color:#f92672>&gt;:</span>   mulsd  <span style=color:#ae81ff>0x156</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>xmm0        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x400b88</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a32</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>226</span><span style=color:#f92672>&gt;:</span>   subsd  <span style=color:#f92672>%</span>xmm2,<span style=color:#f92672>%</span>xmm1
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a36</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>230</span><span style=color:#f92672>&gt;:</span>   divsd  <span style=color:#ae81ff>0x152</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>xmm0        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x400b90</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a3e</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>238</span><span style=color:#f92672>&gt;:</span>   callq  <span style=color:#ae81ff>0x400700</span> <span style=color:#f92672>&lt;</span>__printf_chk<span style=color:#960050;background-color:#1e0010>@</span>plt<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a43</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>243</span><span style=color:#f92672>&gt;:</span>   xor    <span style=color:#f92672>%</span>edi,<span style=color:#f92672>%</span>edi
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0x0000000000400a45</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>245</span><span style=color:#f92672>&gt;:</span>   callq  <span style=color:#ae81ff>0x4006f0</span> <span style=color:#f92672>&lt;</span>exit<span style=color:#960050;background-color:#1e0010>@</span>plt<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>ç®€è€Œè¨€ä¹‹ï¼Œå…³é”®åœ¨ä»¥ä¸‹å‡ å¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ae81ff>0x000000000040098d</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>61</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#ae81ff>0x2006e4</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>rax        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x601078</span> <span style=color:#f92672>&lt;</span>variable2_p<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x0000000000400994</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>68</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#ae81ff>0x2006e6</span>(<span style=color:#f92672>%</span>rip),<span style=color:#f92672>%</span>edx        <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#ae81ff>0x601080</span> <span style=color:#f92672>&lt;</span>variable1<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x000000000040099a</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>74</span><span style=color:#f92672>&gt;:</span>    mov    (<span style=color:#f92672>%</span>rax),<span style=color:#f92672>%</span>ecx
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x000000000040099c</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>76</span><span style=color:#f92672>&gt;:</span>    mov    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x77359400</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x00000000004009a1</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>81</span><span style=color:#f92672>&gt;:</span>    nopl   <span style=color:#ae81ff>0x0</span>(<span style=color:#f92672>%</span>rax)
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x00000000004009a8</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>88</span><span style=color:#f92672>&gt;:</span>    cmp    <span style=color:#f92672>%</span>ecx,<span style=color:#f92672>%</span>edx
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x00000000004009aa</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>90</span><span style=color:#f92672>&gt;:</span>    adc    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x0</span>,<span style=color:#f92672>%</span>ebx
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x00000000004009ad</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>93</span><span style=color:#f92672>&gt;:</span>    sub    <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#ae81ff>0x1</span>,<span style=color:#f92672>%</span>eax
</span></span><span style=display:flex><span><span style=color:#ae81ff>0x00000000004009b0</span> <span style=color:#f92672>&lt;+</span><span style=color:#ae81ff>96</span><span style=color:#f92672>&gt;:</span>    jne    <span style=color:#ae81ff>0x4009a8</span> <span style=color:#f92672>&lt;</span>reader(<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>88</span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¾ªç¯ä½“åœ¨+88ï½+96è¡Œï¼Œè€Œå¯¹variable1ä¸variable2çš„å–å€¼éƒ½æ”¾åœ¨äº†å¾ªç¯ä»¥å¤–ã€‚</p><blockquote><p>æ³¨ï¼š<br>adcæ˜¯å¸¦è¿›ä½åŠ æ³•ï¼Œadc $0x0, %ebx => %ebx = $0x0 + %ebx + CF<br>cmpçš„ç»“æœæ­£æ˜¯æ”¾åœ¨CFï¼ˆå¤§äºè¡¨ç¤ºä¸ºæº¢å‡ºï¼‰ï¼ŒZFï¼ˆç›¸ç­‰è¡¨ç¤ºä¸º0ï¼‰ï¼ŒPFï¼ˆå°äºè¡¨ç¤ºä¸º-1,åˆ™ä½8ä½å…¨ä¸º1,æ•…æœ‰å¶æ•°ä¸ª1ï¼‰</p></blockquote><p>æ­£æ˜¯è¿™ä¸ªâ€œå°æ„å¤–â€ï¼Œå¯¼è‡´äº†æˆ‘ä»¬çš„ç»“æœè¦ä¸æ˜¯100%æ­£ç¡®ï¼Œè¦ä¸æ˜¯100%é”™è¯¯ã€‚</p><h4 id=ä½¿ç”¨volitile>ä½¿ç”¨volitileï¼ˆï¼Ÿï¼‰ <a href=#%e4%bd%bf%e7%94%a8volitile class=anchor>ğŸ”—</a></h4><p>è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>unsigned</span> variable1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>unsigned</span> <span style=color:#f92672>*</span>variable2_p <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span><span style=color:#75715e>#define ITERATIONS 500000000LL </span><span style=color:#75715e>// è°ƒå°ä¸€ä¸‹æ•°æ®è§„æ¨¡ï¼Œå› ä¸ºvolatileå¤ªæ…¢äº†_(:Ğ·ã€âˆ )_
</span></span></span></code></pre></div><p>æˆ‘å¾—å‡ºçš„æ¥çš„ç»“æœæ˜¯ï¼š</p><div class=mermaid>0 failures (0.0 percent of the time) in 9.6 seconds</div><p>è€Œä½œè€…å¾—å‡ºçš„ç»“æœæ˜¯ï¼š
ï¼ˆæ—¶é—´ä¸Šçš„å·®å¼‚ä¸è®¡ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®è§„æ¨¡ä¸ä¸€æ ·ï¼Œæˆ‘å®éªŒçš„æ¬¡æ•°è¦å¤šä¸€äº›ã€‚</p><div class=mermaid>fish ) ./a.out
12462711 failures (24.9 percent of the time) in 3.7 seconds</div><p>ä»ä½œè€…çš„ç»“æœæ¥çœ‹ï¼Œçœ‹èµ·æ¥æ•ˆæœå¥½äº†å¾ˆå¤šï¼Œè™½ç„¶æ…¢äº†30å¤šå€ï¼Œä½†æ˜¯ç»“æœå¹¶ä¸æ˜¯å…¨å¯¹å…¨é”™äº†ã€‚</p><p>è€Œä»æˆ‘çš„ç»“æœæ¥çœ‹ï¼Œvolatileçœ‹ä¼¼ç¥ä¸¹å¦™è¯ï¼Œè§£å†³äº†æ‰€æœ‰çš„é—®é¢˜ã€‚(both g++ and clang++)</p><p><strong>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?</strong></p><p>å…¶åŸå› åœ¨äºä½“ç³»ç»“æ„çš„å·®å¼‚ã€‚volatileåªèƒ½ä¿è¯å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>volatileå˜é‡çš„è®¿é—®ä¸ä¼šä¼˜åŒ–æˆå¯„å­˜å™¨è®¿é—®ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å»è®¿é—®â€œå†…å­˜â€ï¼ˆè¿™ä¸ªå¼•å·ä¸€ä¼šå†è§£é‡Šï¼‰</li><li>volatileå˜é‡é—´çš„è®¿é—®é¡ºåºä¸ä¼šè¢«ç¼–è¯‘å™¨ä¹±åº</li></ul><p>è€Œå…¶ä»–çš„ä¸€åˆ‡ï¼Œvolatileå’Œç¼–è¯‘å™¨éƒ½ä¸ä¼šç»™å‡ºä»»ä½•ä¿è¯ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸åŒçš„CPUéƒ½æœ‰å…¶å†…éƒ¨çš„ç§æœ‰Cacheï¼ŒCPUçš„å†…å­˜è®¿é—®ï¼Œå¦‚æœå‘½ä¸­äº†Cacheï¼Œåˆ™ä¸ä¼šçœŸæ­£çš„è®¿é—®å†…å­˜ã€‚ä½†ç”±äºå…¶ç§æœ‰Cacheå¯¹äºå…¶å®ƒçš„CPUæ˜¯ä¸å¯è§çš„ï¼Œä½¿ç”¨volatileå°±åŸ‹ä¸‹çš„Bugçš„ç§å­ã€‚</p><p>è™½ç„¶åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œç¨‹åºè¿è¡Œçš„å¾ˆå¥½ï¼Œæ²¡æœ‰å‡ºç°Bugã€‚ä½†æ˜¯ï¼Œä¸€æ˜¯ç”±äºå¤šçº¿ç¨‹çš„Bugéƒ½æ˜¯subtleå’Œdelicateçš„ï¼Œæˆ‘ä¸èƒ½ä¿è¯åœ¨ä¸€ä¸ªéœ€è¦7x24å·¥ä½œçš„æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œå®ƒä¸ä¼šå‡ºç°ä»»ä½•Bugï¼›äºŒæ˜¯è‡³å°‘æˆ‘ä»¬çš„ä»£ç æ˜¯** not portable **çš„ï¼Œå¦‚æœæœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬ä»x86-64å¹³å°åˆ‡æ¢åˆ°äº†<code>PowerPC</code>ï¼Ÿæˆ–æ˜¯<code>IA64</code>ï¼Ÿæˆ‘ä»¬ä¸èƒ½ä¿è¯åœ¨è¿™äº›ä½“ç³»ç»“æ„ä¸Šï¼Œç¼–è¯‘å™¨å’ŒCPUèƒ½ä¸ºæˆ‘ä»¬æä¾›åŒæ ·çš„ä¿éšœã€‚</p><p>äºæ˜¯æœ‰äººé«˜å£°ç–¾å‘¼ï¼š volatileä¸èƒ½ç”¨æ¥åšä¸ºå¤šçº¿ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼</p><blockquote><p>è¡¥å……äº20240317ï¼šåœ¨ä¸€å°è€æ—§çš„å®‰å“æ‰‹æœºä¸Šé‡å¤äº†å®éªŒï¼Œvolatileç¡®å®æ— æ³•æä¾›ç›¸å…³çš„ä¿éšœ</p></blockquote><div class=mermaid>~/tmp $ clang++ -O2 a.cc && ./a.out
99880586 failures (49.9 percent of the time) in 3.0 seconds</div><h4 id=å°å¿ƒcpuçš„è¡Œä¸º>å°å¿ƒCPUçš„è¡Œä¸º <a href=#%e5%b0%8f%e5%bf%83cpu%e7%9a%84%e8%a1%8c%e4%b8%ba class=anchor>ğŸ”—</a></h4><p>åœ¨å…ˆå‰çš„å®éªŒä¸­ï¼Œå°½ç®¡ç¨‹åºçš„è¡¨ç°ä¸é¢„æœŸä¸€è‡´ï¼Œä½†æˆ‘ä»¬æ— æ³•ç¡®ä¿CPUå°†å§‹ç»ˆæŒ‰é¡ºåºæ‰§è¡Œä»£ç ã€‚å®é™…ä¸Šï¼ŒCPUå¯èƒ½ä¼šå¯¹æ“ä½œé¡ºåºè¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼Œå°†var1++å’Œvar2++çš„æ‰§è¡Œé¡ºåºè°ƒæ¢ï¼Œè¿™åœ¨å½“å‰ä¸»æµçš„CPUä¸­æ˜¯å¸¸è§çš„åšæ³•ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºä¹±åºæ‰§è¡Œä¼šå¯¼è‡´åŠŸè€—å¢åŠ ï¼ŒæŸäº›å¤„ç†å™¨å¦‚ARMå’ŒIntel Atomå·²ç»å–æ¶ˆäº†è¿™ä¸€æœºåˆ¶ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ— æ³•é¢„çŸ¥æœªæ¥ä»£ç å¯èƒ½ä¼šåœ¨å“ªç§ç¡¬ä»¶æ¶æ„ä¸Šè¿è¡Œï¼Œä¾‹å¦‚ARMé›†ç¾¤ï¼Œè¿™éœ€è¦æˆ‘ä»¬ä¿æŒè­¦æƒ•ã€‚</p><h4 id=é¿å…ä½¿ç”¨é”>é¿å…ä½¿ç”¨é” <a href=#%e9%81%bf%e5%85%8d%e4%bd%bf%e7%94%a8%e9%94%81 class=anchor>ğŸ”—</a></h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡å¼•å…¥äº’æ–¥é”ï¼ˆmutexï¼‰ä¼¼ä¹èƒ½å¤Ÿè§£å†³å¹¶å‘é—®é¢˜ã€‚ç„¶è€Œï¼Œæ ¹æ®ä½œè€…çš„æµ‹è¯•ï¼Œå¼•å…¥äº’æ–¥é”å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºé€Ÿåº¦é™ä½è‡³åŸæ¥çš„1/130ï¼Œè€Œè‡ªæ—‹é”ï¼ˆspinlockï¼‰ä¹Ÿå¯èƒ½ä½¿å¾—é€Ÿåº¦é™ä½è‡³åŸæ¥çš„1/4ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥æš‚ç¼“ï¼Œä»”ç»†è€ƒè™‘ä½œè€…æ¥ä¸‹æ¥çš„å»ºè®®ã€‚</p><h3 id=å†…å­˜å±éšœçš„åº”ç”¨>å†…å­˜å±éšœçš„åº”ç”¨ <a href=#%e5%86%85%e5%ad%98%e5%b1%8f%e9%9a%9c%e7%9a%84%e5%ba%94%e7%94%a8 class=anchor>ğŸ”—</a></h3><p>åœ¨å¤šCPUç¯å¢ƒä¸­ï¼Œå¤„ç†å™¨å¾€å¾€ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¼šåè°ƒå½¼æ­¤çš„æ“ä½œã€‚</p><p>ç›®å‰ï¼Œæˆ‘ä»¬é¢ä¸´ä¸¤ä¸ªå¹¶ä¸ç†æƒ³çš„è§£å†³æ–¹æ¡ˆï¼šä¸€æ˜¯å°†æ‰€æœ‰çº¿ç¨‹é™åˆ¶åœ¨å•ä¸ªCPUä¸Šè¿è¡Œï¼ŒäºŒæ˜¯é€šè¿‡å¼•å…¥é‡é‡çº§é”æ¥åŒæ­¥æ“ä½œã€‚è¿™äº›æ–¹æ³•éƒ½ä¸å°½äººæ„ï¼Œä¸”æ•ˆç‡ä½ä¸‹ã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼Œé€šè¿‡å†…å­˜å±éšœæŠ€æœ¯ï¼Œæš‚æ—¶é˜»æ­¢ç¼–è¯‘å™¨æˆ–CPUå¯¹ç¨‹åºä¸­çš„æ•°æ®è¯»å†™æ“ä½œè¿›è¡Œé‡æ’åºã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>for</span> (;;) {
</span></span><span style=display:flex><span>    variable1 <span style=color:#f92672>=</span> variable1 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    barrier();
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>variable2 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>variable2 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·æˆ‘ä»¬ä¿è¯äº†ï¼Œåœ¨var1++å¿…ç„¶æ—©äºvar2++ã€‚var2++åé¢ä¹Ÿå¯ä»¥åŠ ä¸€é“barrierï¼Œåªä¸è¿‡åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹ï¼Œæä¾›è¿™ç§ä¿è¯æ˜¯ä¸å¿…é¡»çš„ã€‚</p><p>ä½œè€…åˆåšäº†ä¸€æ¬¡è¯•éªŒã€‚</p><div class=mermaid>fish ) ./a.out
260 failures (0.0 percent of the time) in 0.9 seconds</div><p>è¿™æ¬¡ä¸”é”™è¯¯å‡å°‘äº†è®¸å¤šã€‚</p><p>æˆ‘ä»¬å†æŠŠè¯»çº¿ç¨‹å†™åŠ ä¸Šmemory barrier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>for</span> (i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> ITERATIONS; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> v2 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>variable2;
</span></span><span style=display:flex><span>    barrier();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> v1 <span style=color:#f92672>=</span> variable1;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (v2 <span style=color:#f92672>&gt;</span> v1) failureCount<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>çœ‹çœ‹ç»“æœï¼š</p><div class=mermaid>fish ) ./a.out
0 failures (0.0 percent of the time) in 4.2 seconds</div><p>ç¨‹åºè¡¨ç°å‡ºäº†æ­£ç¡®çš„ç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½ å¯¹çº¿ç¨‹Açš„è¯»å†™é¡ºåºåšå‡ºè¦æ±‚ï¼Œå¿…ç„¶çš„ï¼Œä½ ä¹Ÿè¦å¯¹çº¿ç¨‹Bçš„é¡ºåºåšè¦æ±‚ï¼Œä»¥æ­¤ç±»æ¨ï¼Œçº¿ç¨‹Cï¼Œçº¿ç¨‹Dâ€¦â€¦</p><p>æ‰€ä»¥ï¼Œ<strong>Memory barriers always come in pairs, or triplets or more.</strong></p><p>åŒæ ·çš„ï¼Œçº¿ç¨‹é”ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±é”è‡ªå·±æ€»ä¸æ˜¯ä¸€ç§æ„‰å¿«çš„ä½“éªŒï¼ˆç¬‘</p><h3 id=cpuçš„ä¹±åºæ‰§è¡Œ>CPUçš„ä¹±åºæ‰§è¡Œ <a href=#cpu%e7%9a%84%e4%b9%b1%e5%ba%8f%e6%89%a7%e8%a1%8c class=anchor>ğŸ”—</a></h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°PowerPCæœ‰ä¸‰ç§å†…å­˜å±éšœï¼Œè€ŒDEC Alphaå¹³å°æœ‰æ›´å¤šã€‚è¿™æ„å‘³ç€ï¼ŒCPUä½¿ç”¨æ›´æ¿€è¿›çš„ç­–ç•¥æ¥é‡æ’æŒ‡ä»¤ï¼Œè€Œå¼ºåˆ¶é™åˆ¶å…¶é‡æ’çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚</p><p>è€Œx86å¹³å°åˆ™éå¸¸å®ˆåºï¼Œä½œè€…çŒœæµ‹å…¶åŸå› æ˜¯ç”±äºæ—©æœŸx86çš„æŒ‡ä»¤æŠ€æœ¯å¹¶éå®Œå–„ï¼Œè€Œåœ¨é‚£æ—¶å†…å­˜ä¸CPUçš„é€Ÿåº¦ä¸åƒç°åœ¨è¿™æ ·æ‚¬æ®Šï¼Œæ‰€ä»¥x86ä½¿ç”¨äº†<code>strongly ordered memory</code>è€Œéåƒä¸Šé¢å‡ æ¬¾CPUä¸€æ ·çš„é‡‡ç”¨è¿‡å¤šçš„æŒ‡ä»¤é‡æ’åºã€‚å¦‚ä»Šï¼Œç”±äºx86èƒŒä¸Šäº†å‘å‰å…¼å®¹æ€§çš„åŒ…è¢±ï¼Œçœ‹ä¼¼æˆ‘ä»¬çš„"å¥½æ—¥å­"ä¸€ç›´ä¸ä¼šç»“æŸã€‚</p><p>x86-64ï¼Œåšä¸ºx86çš„64ä½å‡çº§ç‰ˆï¼ŒåŒæ ·æ²¡æœ‰å®ç°<code>weakly ordered</code>ï¼Œæˆ–è€…è¯´ï¼Œä¿ç•™äº†å®ç°<code>weakly ordered</code>çš„æƒåˆ©ã€‚è€Œ<code>IA64</code>å¹³å°ï¼Œå¦‚<code>Itanium</code>ï¼Œåˆ™å®ç°äº†<code>weakly ordered</code>ã€‚</p><p>ä½œè€…çŒœæµ‹x86_64ä¹‹æ‰€ä»¥ä¿å®ˆï¼Œæ˜¯ä¸ºäº†ä¸IA64å¹³å°å¯¹æŠ—ã€‚x86_64çš„å¯¹äºx86è‰¯å¥½çš„å…¼å®¹æ€§å¯ä»¥è®©ç¨‹åºå‘˜å¤šæ´»å‡ å¹´ï¼Œæ‰€ä»¥x86_64åœ¨å¸‚åœºçš„è¡¨ç°æ›´å¥½ã€‚</p><p>ä½œè€…è¿˜è¡¨ç¤ºï¼Œè€Œè‹¹æœæ”¾å¼ƒIA64å¹³å°è½¬æŠ•x86-64å¤šå°‘æœ‰ä¸€äº›å¯æƒœï¼Œå› ä¸ºè‹¹æœå¹¶æ²¡æœ‰ç§»æ¤æ€§é—®é¢˜ï¼ŒPowerPCå·²ç»é€æ¸è¡°è½ï¼Œä¸ºä»€ä¹ˆä¸è¯•è¯•IA64å‘¢ã€‚</p><p>å®é™…ä¸Šï¼Œæ ¹æ®Wikipediaï¼Œç°åœ¨æ”¯æŒIA64çš„æ“ä½œç³»ç»Ÿéå¸¸å°‘ï¼Œåªæœ‰WinNT Familyï¼ŒRed Hat Linuxï¼ŒDebian/Gentoo/Suseä»¥åŠå…¶å®ƒã€‚è€Œä»Windows Server 2008 R2ä¹‹åï¼ŒMicrosoftä¹Ÿè¡¨ç¤ºä¸å†æ”¯æŒItaniumã€‚æ‰€ä»¥ä»ç°åœ¨çœ‹æ¥ï¼ŒIA64å¹³å°ç›¸å¯¹x86/x64æ¥è¯´ï¼Œæ˜¯å¤±è´¥çš„ã€‚</p><h3 id=åŒé‡æ£€æŸ¥é”>åŒé‡æ£€æŸ¥é” <a href=#%e5%8f%8c%e9%87%8d%e6%a3%80%e6%9f%a5%e9%94%81 class=anchor>ğŸ”—</a></h3><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä¸‹çš„Obj-Cä»£ç </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>+ <span style=color:#a6e22e>getSharedObject</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>id</span> sharedObject;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>        LOCK;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>            sharedObject <span style=color:#f92672>=</span> [[self alloc] init];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        UNLOCK;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sharedObject;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ˜¯éå¸¸ç»å…¸çš„ä¸€ç§DCLP(Double Checked Lock Pattern)çš„å®ç°ã€‚</p><p>è¿™ä¸ªçœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä½ å·²ç»çŸ¥é“è¿™å¹¶ä¸é è°±äº†ã€‚å½“æˆ‘ä»¬åˆå§‹åŒ–æˆ‘ä»¬çš„å…±äº«å•ä¾‹ï¼Œå…ˆè¦å†ä¿®æ”¹ç±»å†…çš„æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ä¸€å—å£°æ˜å¥½çš„å†…å­˜ï¼Œå†åˆå§‹åŒ–ä¸€ä¸ªsharedObjectçš„instanceã€‚</p><p>ä¸è¿‡ï¼Œä½ æ˜¯çŸ¥é“çš„ï¼ŒCPUå’Œç¼–è¯‘å™¨ä¼šæŠŠä¸€åˆ‡éƒ½æç ¸ï¼Œå®ƒä»¬ä¼šä»¥ä»»æ„çš„é¡ºåºæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ï¼ŒåŒæ—¶å¤„ç†å™¨ä¹‹é—´äº’ç›¸ä¸é€šæ°”ï¼Œäºæ˜¯å°±ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š</p><p>çº¿ç¨‹Aä¸ºæŒ‡é’ˆå£°æ˜äº†ä¸€æ®µç©ºé—´ï¼Œä½†æ˜¯è¿˜æ²¡æ¥åŠåˆå§‹åŒ–è¿™ä¸ªinstanceï¼Œçº¿ç¨‹Aå°±è¢«æŒ‚èµ·äº†ã€‚</p><p>ä¹‹åçº¿ç¨‹Bæ¥ç®¡ä¸€åˆ‡ï¼Œå‘ç°æŒ‡é’ˆæœ‰å€¼ï¼Œç»“æœå› ä¸ºè®¿é—®äº†é‡æŒ‡é’ˆå¯¼è‡´ç¨‹åºæŒ‚æ‰ã€‚</p><p>ä¸è¿‡æ ¹æ®ä¸Šé¢çš„æ–‡ç« ï¼Œä½ ä»¬åº”è¯¥çŸ¥é“æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜äº† â€”â€” è¯•è¯•å†…å­˜å±éšœï¼</p><p>p.s. å¦‚æœå¤§å®¶å¯¹obj-cä¸ç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥çœ‹æˆ‘å¦å¤–ä¸€ç¯‡æ–‡ç« ã€‚é‚£ç¯‡æ–‡ç« æ˜¯å…³äºScott Meyerså¤§ç¥å†™çš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸“é—¨ç”¨æ¥è®¨è®ºDCLPé—®é¢˜çš„ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>+ <span style=color:#a6e22e>getSharedObject</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>id</span> sharedObject;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>        LOCK;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>id</span> temp <span style=color:#f92672>=</span> [[self alloc] init];
</span></span><span style=display:flex><span>            OSMemoryBarrier();
</span></span><span style=display:flex><span>            sharedObject <span style=color:#f92672>=</span> temp;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        UNLOCK;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    OSMemoryBarrier();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sharedObject;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è€Œåœ¨ã€ŠC++ and the Perils of Double-Checked Lockingã€‹ä¸€æ–‡ä¸­ï¼ŒScott Meyerså’ŒAndrei Alexandrescuç»™å‡ºçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>Singleton<span style=color:#f92672>*</span> Singleton<span style=color:#f92672>::</span>instance () {
</span></span><span style=display:flex><span>    Singleton<span style=color:#f92672>*</span> tmp <span style=color:#f92672>=</span> pInstance;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// insert memory barrier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// clear the cache to flush ``pInstance``
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// prevents &#34;downwards migration&#34; of Singletonâ€™s construction (by another thread);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (tmp <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        Lock lock;
</span></span><span style=display:flex><span>        tmp <span style=color:#f92672>=</span> pInstance;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (tmp <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            tmp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Singleton;
</span></span><span style=display:flex><span>            <span style=color:#75715e>// insert memory barrier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// prevent optimistic that eliminate the temporary variable ``tmp``
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// prevents &#34;upwards migration&#34; of pInstanceâ€™s initialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            pInstance <span style=color:#f92672>=</span> tmp;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>  tmp;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„memory barrieræ’å…¥çš„ä½ç½®ä¸åŒã€‚ä½†æ˜¯éƒ½ä¸èƒ½è¯´æ˜¯é”™çš„ã€‚å› ä¸ºä¸€ä¸ªæ˜¯ä¼ static instanceï¼Œä¸€ä¸ªæ˜¯ä¼ pointerã€‚</p><p>å…¶å®è¿˜æœ‰æ›´â€œæš´åŠ›â€çš„æ–¹æ³•ã€‚</p><p>ç›´æ¥æ¥ä¸€æŠŠå¤§é”ï¼Œå“å½“æŠŠæ•´ä¸ªå‡½æ•°é”èµ·æ¥ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹å†…ä¿ç•™ä¸€ä¸ª<strong>æœ¬çº¿ç¨‹ä¸“å±</strong>æŒ‡å‘å•ä¾‹çš„æŒ‡é’ˆï¼ˆåšcacheï¼‰ã€‚è¿™æ ·Nä¸ªçº¿ç¨‹åªéœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°Næ¬¡ï¼Œçº¿ç¨‹ç«äº‰ä¹Ÿç›¸å¯¹å°‘å¾ˆå¤šã€‚å¹¶ä¸”æ ¹æ®Linuxä¸‹çš„futexæŠ€æœ¯ï¼Œæ— ç«äº‰ä¸‹çš„é”ç›¸å¯¹èŠ‚çœäº†ä¸å°‘èµ„æºã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>Singleton<span style=color:#f92672>*</span> Singleton<span style=color:#f92672>::</span>instance() {
</span></span><span style=display:flex><span>    Lock lock;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(pInstance <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        pInstance <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Singleton;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pInstance;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¹ˆåšå—>æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¹ˆåšå— <a href=#%e6%88%91%e4%bb%ac%e7%9c%9f%e7%9a%84%e9%9c%80%e8%a6%81%e8%bf%99%e4%b9%88%e5%81%9a%e5%90%97 class=anchor>ğŸ”—</a></h3><p>ä¸Šé¢çš„obj-cä»£ç ä¸­ï¼Œä¿è¯åŒé‡æ£€æŸ¥é”æ­£ç¡®çš„ï¼Œå…¶å®æ˜¯ç¬¬äºŒä¸ªå†…å­˜å±éšœã€‚ä½†æ˜¯ï¼Œåœ¨é‚£é‡Œï¼Œæˆ‘ä»¬éœ€è¦çš„å…¶å®æ˜¯ä¸€ä¸ª"data dependency barrier"ã€‚</p><p>Linuxå†…æ ¸ä¸­ç»™å‡ºå¾ˆå¤šç»è¿‡ç²¾å¿ƒä¼˜åŒ–çš„å†…å­˜å±éšœï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œè¦åœ¨ä½¿ç”¨çš„æ—¶å€™å†™å¥½æ³¨é‡Šï¼Œä¸€æ˜¯ä¸ºäº†æœªæ¥çš„éªŒè¯ï¼ŒäºŒæ˜¯ä¸ºäº†è®°å½•è‡ªå·±å½“æ—¶çš„æ€è·¯ã€‚</p><p>æ¯•ç«Ÿå¤šçº¿ç¨‹çš„æ“ä½œè¦å°å¿ƒå†å°å¿ƒï¼Œæˆ‘ä»¬éœ€è¦å……è¶³çš„ç†ç”±ï¼Œæ›´å¤šçš„å°å¿ƒæ¥åº”å¯¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-obj-c data-lang=obj-c><span style=display:flex><span>+ <span style=color:#a6e22e>getSharedObject</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>id</span> sharedObject;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>        LOCK;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span> sharedObject) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>id</span> temp <span style=color:#f92672>=</span> [[self alloc] init];
</span></span><span style=display:flex><span>            OSMemoryBarrier();
</span></span><span style=display:flex><span>            sharedObject <span style=color:#f92672>=</span> temp;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        UNLOCK;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* data dependency memory barrier here */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sharedObject;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ä¸€åˆ‡éƒ½ç»“æŸäº†å—>ä¸€åˆ‡éƒ½ç»“æŸäº†å—ï¼Ÿ <a href=#%e4%b8%80%e5%88%87%e9%83%bd%e7%bb%93%e6%9d%9f%e4%ba%86%e5%90%97 class=anchor>ğŸ”—</a></h3><p>æ˜¯çš„ã€‚ä¸è¿‡è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å§ã€‚</p><p><img src=https://github.com/Wizmann/assets/raw/master/wizmann-tk-pic/barrier_tank.png alt="Mutex Tank"></p><ul><li>å¤„ç†å™¨å’Œç¼–è¯‘å™¨å¹¶ä¸èƒ½å……åˆ†ä¿è¯ä»£ç æ‰§è¡Œçš„é¡ºåºï¼Œå®ƒä»¬ä¼šæŠŠä½ çš„ä»£ç åˆ°å¤„ç§»åŠ¨ã€‚æ‰€ä»¥<strong>Be warned and wary!</strong></li><li>å¤šçº¿ç¨‹çš„é”™è¯¯æ˜¯éå¸¸subtleå’Œdelicateçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾è®¾è®¡æµ‹è¯•ç”¨ä¾‹</li><li>å› æ­¤ï¼Œåˆ«æŒ‡è´£QAäº†ï¼Œä»–ä»¬ä¹Ÿä¸æ˜¯æ•…æ„çš„ã€‚RDè¦å¯¹è‡ªå·±çš„ä»£ç è´Ÿè´£</li><li>é”å¾ˆå®‰å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆé‡</li><li>å†…å­˜å±éšœæ˜¯ä¸€ç§æ›´å¿«çš„ï¼Œä¸é˜»å¡çš„ï¼Œä¸ä¼šæ­»é”çš„ä¸€ç§é”çš„æ›¿ä»£ç‰©ã€‚å®ƒä»¬æ€»è¦èŠ±è´¹æ›´å¤šçš„å¿ƒæ€ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯åˆ°å¤„å¯ç”¨çš„é“¶å¼¹ã€‚ä½†æ˜¯å®ƒç¡®å®å¾ˆå¿«ï¼Œæœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§ã€‚</li><li>å†…å­˜å±éšœå¾€å¾€æ˜¯æˆå¯¹å‡ºç°çš„ã€‚äº†è§£ç¬¬äºŒä¸ªå†…å­˜å±éšœè¦å‡ºç°åœ¨å“ªé‡Œï¼Œæœ‰åŠ©äºä½ ç†è§£ä½ çš„ä»£ç ï¼Œå³ä½¿ä½ æ‰€ä½¿ç”¨çš„ä½“ç³»ç»“æ„ä¸éœ€è¦ç¬¬äºŒä¸ªå†…å­˜å±éšœã€‚</li></ul><h3 id=æ‰©å±•é˜…è¯»>æ‰©å±•é˜…è¯» <a href=#%e6%89%a9%e5%b1%95%e9%98%85%e8%af%bb class=anchor>ğŸ”—</a></h3><p><a href=https://www.kernel.org/doc/Documentation/memory-barriers.txt>LINUX KERNEL MEMORY BARRIERS</a></p><p><a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.17.8112">Memory Consistency and Event Ordering in Scalable Shared-Memory Multiprocessors</a></p></div></section></div><div class=side><div class=side-recent><h2 class=side-title><a href=/posts/>Recent Posts</a></h2><hr><ul><li><a href=/posts/why-not-start-with-ddia-part-1/>ä¸ºä»€ä¹ˆæˆ‘ä¸å»ºè®®ä½ é˜…è¯»ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ï¼ˆä¹‹ä¸€ï¼‰</a></li><li><a href=/posts/vertical-axis-wind-turbine-3d-model/>é£åŠ›æ¶¡è½®æœº 3D æ¨¡å‹ / Vertical Axis Wind Turbine (VAWT) 3D Model</a></li><li><a href=/posts/press-pad-3d-model/>3Dæ‰“å°è§£å‹ç©å…· / 3D Printed Fidget Toy</a></li><li><a href=/posts/lava-store/>è®ºæ–‡é˜…è¯»ï¼šLavaStore - é«˜æ€§èƒ½ã€æœ¬åœ°å­˜å‚¨å¼•æ“çš„æ¼”è¿›</a></li><li><a href=/posts/std-smart-ptrs-cpp-for-the-antiquated-4/>åŠ¨æ‰‹å®ç°æ™ºèƒ½æŒ‡é’ˆ ï¼ˆä¸Šç¯‡ï¼‰ - C++ for the Antiquatedï¼ˆä¹‹å››ï¼‰</a></li></ul></div><div class=side-categories><h2>Categories</h2><hr><ul></ul></div><div class=side-tags><h2>Tags</h2><hr><ul><li><a href=/tags/.net>.net (1)</a></li><li><a href=/tags/3d-printing>3d printing (2)</a></li><li><a href=/tags/a2b>a2b (1)</a></li><li><a href=/tags/ahk>ahk (1)</a></li><li><a href=/tags/algorithm>algorithm (26)</a></li><li><a href=/tags/alloca>alloca (1)</a></li><li><a href=/tags/allocate>allocate (1)</a></li><li><a href=/tags/arduino>arduino (1)</a></li><li><a href=/tags/asm>asm (1)</a></li><li><a href=/tags/async>async (2)</a></li><li><a href=/tags/atcoder>atcoder (1)</a></li><li><a href=/tags/autohotkey>autohotkey (1)</a></li><li><a href=/tags/autopilot>autopilot (1)</a></li><li><a href=/tags/azure>azure (2)</a></li><li><a href=/tags/b-tree>b-tree (1)</a></li><li><a href=/tags/basic-paxos>basic paxos (2)</a></li><li><a href=/tags/bbr>bbr (1)</a></li><li><a href=/tags/binary-indexed-tree>binary indexed tree (1)</a></li><li><a href=/tags/binary-tree>binary tree (1)</a></li><li><a href=/tags/bittorrent>bittorrent (1)</a></li><li><a href=/tags/borg>borg (1)</a></li><li><a href=/tags/bw-tree>bw-tree (1)</a></li><li><a href=/tags/c>c# (1)</a></li><li><a href=/tags/c++>c++ (6)</a></li><li><a href=/tags/cache>cache (1)</a></li><li><a href=/tags/cachegrind>cachegrind (1)</a></li><li><a href=/tags/cap>cap (1)</a></li><li><a href=/tags/career>career (1)</a></li><li><a href=/tags/cas>cas (3)</a></li><li><a href=/tags/ceph>ceph (1)</a></li><li><a href=/tags/chrome-extension>chrome-extension (2)</a></li><li><a href=/tags/cmpxchg>cmpxchg (2)</a></li><li><a href=/tags/cocurrency>cocurrency (1)</a></li><li><a href=/tags/code-golf>code golf (1)</a></li><li><a href=/tags/codeforces>codeforces (14)</a></li><li><a href=/tags/compare-ans-swap>compare-ans-swap (1)</a></li><li><a href=/tags/computational-geometry>computational geometry (1)</a></li><li><a href=/tags/consistency>consistency (1)</a></li><li><a href=/tags/cpp>cpp (9)</a></li><li><a href=/tags/cpu>cpu (1)</a></li><li><a href=/tags/cse351>cse351 (2)</a></li><li><a href=/tags/csharp>csharp (1)</a></li><li><a href=/tags/css>css (1)</a></li><li><a href=/tags/data-center>data center (1)</a></li><li><a href=/tags/data-center-management>data center management (1)</a></li><li><a href=/tags/defer>defer (1)</a></li><li><a href=/tags/distributed-system>distributed system (4)</a></li><li><a href=/tags/epoll>epoll (1)</a></li><li><a href=/tags/ergodone>ergodone (1)</a></li><li><a href=/tags/fifo>fifo (1)</a></li><li><a href=/tags/flatbuffer>flatbuffer (2)</a></li><li><a href=/tags/fn-layer>fn-layer (1)</a></li><li><a href=/tags/front-end-development>front-end development (1)</a></li><li><a href=/tags/functional-programming>functional programming (1)</a></li><li><a href=/tags/game>game (1)</a></li><li><a href=/tags/gcj>gcj (1)</a></li><li><a href=/tags/geohash>geohash (1)</a></li><li><a href=/tags/geometric>geometric (1)</a></li><li><a href=/tags/geometry>geometry (1)</a></li><li><a href=/tags/get-things-done>get things done (1)</a></li><li><a href=/tags/google>google (3)</a></li><li><a href=/tags/graph>graph (1)</a></li><li><a href=/tags/head-first>head-first (1)</a></li><li><a href=/tags/heap>heap (1)</a></li><li><a href=/tags/herd7>herd7 (1)</a></li><li><a href=/tags/induction>induction (2)</a></li><li><a href=/tags/interview>interview (5)</a></li><li><a href=/tags/keyboard>keyboard (2)</a></li><li><a href=/tags/kubernetes>kubernetes (1)</a></li><li><a href=/tags/lavastore>lavastore (1)</a></li><li><a href=/tags/leetcode>leetcode (4)</a></li><li><a href=/tags/leveldb>leveldb (1)</a></li><li><a href=/tags/linkedin>linkedin (1)</a></li><li><a href=/tags/linux>linux (1)</a></li><li><a href=/tags/litmus>litmus (1)</a></li><li><a href=/tags/lock-less>lock-less (1)</a></li><li><a href=/tags/lsm-tree>lsm-tree (1)</a></li><li><a href=/tags/markdown>markdown (1)</a></li><li><a href=/tags/median>median (1)</a></li><li><a href=/tags/memory>memory (1)</a></li><li><a href=/tags/memory-barrier>memory-barrier (3)</a></li><li><a href=/tags/mesi>mesi (1)</a></li><li><a href=/tags/message-queue>message queue (1)</a></li><li><a href=/tags/metadata>metadata (1)</a></li><li><a href=/tags/metaprogramming>metaprogramming (1)</a></li><li><a href=/tags/microsoft>microsoft (2)</a></li><li><a href=/tags/misaka>misaka (1)</a></li><li><a href=/tags/modern-c++>modern c++ (1)</a></li><li><a href=/tags/modern-cpp>modern cpp (4)</a></li><li><a href=/tags/mosca>mosca (1)</a></li><li><a href=/tags/mq>mq (1)</a></li><li><a href=/tags/multi-paxos>multi paxos (1)</a></li><li><a href=/tags/multi-thread>multi-thread (3)</a></li><li><a href=/tags/multiprocess>multiprocess (1)</a></li><li><a href=/tags/multithread>multithread (3)</a></li><li><a href=/tags/network>network (1)</a></li><li><a href=/tags/networking>networking (4)</a></li><li><a href=/tags/non-blocking>non-blocking (1)</a></li><li><a href=/tags/normal-distribution>normal-distribution (1)</a></li><li><a href=/tags/ocaml>ocaml (1)</a></li><li><a href=/tags/ot>ot (1)</a></li><li><a href=/tags/parallel>parallel (1)</a></li><li><a href=/tags/partition>partition (1)</a></li><li><a href=/tags/paxos>paxos (2)</a></li><li><a href=/tags/pecifica>pecifica (1)</a></li><li><a href=/tags/pelican>pelican (1)</a></li><li><a href=/tags/phxrpc>phxrpc (8)</a></li><li><a href=/tags/pl>pl (1)</a></li><li><a href=/tags/poi>poi (1)</a></li><li><a href=/tags/poll>poll (1)</a></li><li><a href=/tags/powershell>powershell (1)</a></li><li><a href=/tags/priority-queue>priority queue (1)</a></li><li><a href=/tags/priority_queue>priority_queue (1)</a></li><li><a href=/tags/profile>profile (1)</a></li><li><a href=/tags/programming-interview>programming interview (1)</a></li><li><a href=/tags/promela>promela (2)</a></li><li><a href=/tags/protobuf>protobuf (1)</a></li><li><a href=/tags/protocol>protocol (4)</a></li><li><a href=/tags/python>python (3)</a></li><li><a href=/tags/quartile>quartile (1)</a></li><li><a href=/tags/queue>queue (2)</a></li><li><a href=/tags/quick-sort>quick sort (1)</a></li><li><a href=/tags/quora>quora (1)</a></li><li><a href=/tags/racket>racket (1)</a></li><li><a href=/tags/raft>raft (2)</a></li><li><a href=/tags/rocksdb>rocksdb (2)</a></li><li><a href=/tags/rpc>rpc (4)</a></li><li><a href=/tags/social-network>social network (1)</a></li><li><a href=/tags/socket>socket (1)</a></li><li><a href=/tags/solution>solution (2)</a></li><li><a href=/tags/sort>sort (1)</a></li><li><a href=/tags/spin>spin (4)</a></li><li><a href=/tags/spin/promela>spin/promela (2)</a></li><li><a href=/tags/stack>stack (2)</a></li><li><a href=/tags/stdfunction>std::function (1)</a></li><li><a href=/tags/stl>stl (1)</a></li><li><a href=/tags/storage>storage (3)</a></li><li><a href=/tags/storage-system>storage system (2)</a></li><li><a href=/tags/streambuf>streambuf (1)</a></li><li><a href=/tags/string>string (1)</a></li><li><a href=/tags/stup>stup (3)</a></li><li><a href=/tags/stylish>stylish (1)</a></li><li><a href=/tags/system>system (1)</a></li><li><a href=/tags/system-design>system design (5)</a></li><li><a href=/tags/tcp>tcp (4)</a></li><li><a href=/tags/tcpip>tcpip (1)</a></li><li><a href=/tags/thread>thread (3)</a></li><li><a href=/tags/tlv>tlv (1)</a></li><li><a href=/tags/twisted>twisted (1)</a></li><li><a href=/tags/ucontext>ucontext (2)</a></li><li><a href=/tags/udp>udp (3)</a></li><li><a href=/tags/useless>useless (1)</a></li><li><a href=/tags/userscript>userscript (1)</a></li><li><a href=/tags/valgrind>valgrind (1)</a></li><li><a href=/tags/wait-free>wait-free (1)</a></li><li><a href=/tags/was>was (1)</a></li><li><a href=/tags/wisckey>wisckey (1)</a></li><li><a href=/tags/workflowy>workflowy (1)</a></li><li><a href=/tags/wsl>wsl (1)</a></li><li><a href=/tags/yunfile>yunfile (1)</a></li><li><a href=/tags/zeromq>zeromq (1)</a></li><li><a href=/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B>å¹¶å‘ç¼–ç¨‹ (1)</a></li><li><a href=/tags/%E7%B3%99%E5%BF%AB%E7%8C%9B>ç³™å¿«çŒ› (1)</a></li><li><a href=/tags/%E5%88%9B%E9%80%A0%E5%8A%9B>åˆ›é€ åŠ› (1)</a></li><li><a href=/tags/%E8%AF%BB%E4%B9%A6>è¯»ä¹¦ (2)</a></li><li><a href=/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B>å¤šçº¿ç¨‹ (2)</a></li><li><a href=/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F>åˆ†å¸ƒå¼ç³»ç»Ÿ (6)</a></li><li><a href=/tags/%E5%88%86%E7%B1%BB%E5%99%A8>åˆ†ç±»å™¨ (1)</a></li><li><a href=/tags/%E5%85%AC%E5%BC%80%E8%AF%BE>å…¬å¼€è¯¾ (4)</a></li><li><a href=/tags/%E8%AE%A1%E6%95%B0>è®¡æ•° (1)</a></li><li><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6>è®¡ç®—æœºç§‘å­¦ (1)</a></li><li><a href=/tags/%E9%93%BE%E8%A1%A8>é“¾è¡¨ (1)</a></li><li><a href=/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB>è®ºæ–‡é˜…è¯» (1)</a></li><li><a href=/tags/%E9%9D%A2%E8%AF%95>é¢è¯• (1)</a></li><li><a href=/tags/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86>å®¹æ–¥åŸç† (1)</a></li><li><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F>è®¾è®¡æ¨¡å¼ (2)</a></li><li><a href=/tags/%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81>æ•°æ®ç¼–ç  (1)</a></li><li><a href=/tags/%E6%95%B0%E6%8D%AE%E5%BA%93>æ•°æ®åº“ (4)</a></li><li><a href=/tags/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F>æ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿ (1)</a></li><li><a href=/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B>æ•°æ®æ¨¡å‹ (1)</a></li><li><a href=/tags/%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F>æ•°æ®ç³»ç»Ÿ (1)</a></li><li><a href=/tags/%E6%80%9D%E7%BB%B4>æ€ç»´ (1)</a></li><li><a href=/tags/%E7%AE%97%E6%B3%95>ç®—æ³• (14)</a></li><li><a href=/tags/%E7%B4%A2%E5%BC%95>ç´¢å¼• (1)</a></li><li><a href=/tags/%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84>ç´¢å¼•ç»“æ„ (1)</a></li><li><a href=/tags/%E9%A2%98%E8%A7%A3>é¢˜è§£ (11)</a></li><li><a href=/tags/%E9%97%B2%E8%81%8A>é—²èŠ (3)</a></li><li><a href=/tags/%E5%8D%8F%E7%A8%8B>åç¨‹ (1)</a></li><li><a href=/tags/%E5%8E%8B%E7%BC%A9>å‹ç¼© (1)</a></li><li><a href=/tags/%E4%B8%80%E8%87%B4%E6%80%A7>ä¸€è‡´æ€§ (3)</a></li><li><a href=/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6>ä¸»ä»å¤åˆ¶ (1)</a></li><li><a href=/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2>å­—ç¬¦ä¸² (1)</a></li><li><a href=/tags/%E6%9C%80%E5%B0%8F%E8%A1%A8%E7%A4%BA%E6%B3%95>æœ€å°è¡¨ç¤ºæ³• (1)</a></li></ul></div></div></main><footer class=footer><div class=footer-row><a class=footer-item href=https://wizmann.top/posts/index.xml>Feed of Posts
<i class=icofont-rss></i></a></div></footer></body></html>