<!doctype html><html lang=zh-CN dir=ltr><head><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}}</script><script defer src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://wizmann.top/ style=color:inherit>Maerlyn's Rainbow</a></div><div class=nav-right><div style=position:absolute;width:0;height:0><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div></div><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><div class=single-header><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://wizmann.top/><span itemprop=name></span>
</a><meta itemprop=position content='1'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://wizmann.top/posts/><span itemprop=name>Posts</span>
</a><meta itemprop=position content='2'></li><span>&nbsp»&nbsp</span></ol><h1>[tl;dr] 论文阅读：Rarest First and Choke Algorithms Are Enough</h1><time class=dim datetime=2023-12-08T00:00:00+00:00>December 8, 2023</time><div class=term-container><div class=tag><a href=https://wizmann.top/tags/bittorrent/>#BitTorrent</a></div><div class=tag><a href=https://wizmann.top/tags/distributed-system/>#distributed system</a></div></ol></div><section class=page-section><ul><li><h2 id=基本概念>基本概念</h2><ul><li><strong>Peer</strong>：BitTorrent P2P下载的参与者</li><li><strong>Leecher</strong>：“吸血者”，仍在下载过程中的peer</li><li><strong>Seeder</strong>：做种者，下载完成后还在继续做种的peer</li><li><strong>Piece</strong>：Piece是文件的数据单元。当文件被分享时，它被分割成多个大小相等的片段，称为"pieces"。这些pieces是peer间传输的基本单位</li></ul></li><li><h2 id=最稀有优先算法rarest-first-algorithm>&ldquo;最稀有优先算法&rdquo;（Rarest First Algorithm）</h2><ul><li>&ldquo;最稀有优先算法&rdquo;（Rarest First Algorithm）是BitTorrent协议中的一个关键策略，用于决定哪些数据块（piece）首先被下载和分享。这个算法的核心目标是优化整个网络中数据的分布，确保更快的下载速度和更高的效率。</li><li><h3 id=基本原理>基本原理</h3><ul><li><strong>数据块的稀有度</strong><ul><li>在BitTorrent网络中，文件被分割成许多小的数据块。<ul><li>“最稀有优先”算法的目的是优先下载那些网络中数量最少的数据块。</li></ul></li></ul></li><li><strong>选择下载的块</strong>：<ul><li>当一个peer加入Torrent网络，并开始下载文件时，它首先会从所有连接的peer那里获取有关哪些数据块是稀有的信息。<ul><li>然后，它优先请求下载那些最稀有的数据块。</li></ul></li></ul></li><li><strong>动态调整</strong>：<ul><li>随着下载的进行，每个peer会不断更新和重新评估网络中每个数据块的稀有度，并相应地调整其下载优先级。</li></ul></li><li><h3 id=算法的重要性>算法的重要性</h3><ul><li><strong>提高效率</strong>：通过优先下载最稀有的块，这个算法帮助加快了文件的整体下载速度。一旦最稀有的块被更多peer获取，它们就更容易被进一步分享和分发。</li><li><strong>防止瓶颈</strong>：如果没有这个算法，某些数据块可能会变得很难获得，导致下载过程在接近完成时放慢，这被称为“最后一块问题”（Last Piece Problem）。</li><li><strong>促进平等分享</strong>：这种方法鼓励peer分享它们拥有的稀有块，从而提高了整个网络中的合作和资源共享。</li></ul></li></ul></li><li><h3 id=实际应用>实际应用</h3><ul><li>在BitTorrent网络中，这个算法对于确保高效的数据分发至关重要。它不仅提高了单个用户的下载速度，而且还提高了整个网络的效率，确保了资源在用户之间的均衡分配。通过这种方式，BitTorrent网络能够有效地避免瓶颈和提高数据的可用性，即使在面对大量用户的情况下也是如此。</li></ul></li><li><h3 id=结论>结论</h3><ul><li>最稀有优先算法是BitTorrent网络高效运行的关键组成部分。它通过智能地选择下载和分享网络中最稀有的数据块，提高了资源的整体分布和可用性，确保了快速、平衡的文件共享。</li></ul></li></ul></li><li><h2 id=窒息算法choking-algorithm>&ldquo;窒息算法&rdquo;（Choking Algorithm）</h2><ul><li>&ldquo;窒息算法&rdquo;（Choking Algorithm）是BitTorrent协议中的一个关键组成部分，用于管理多个peer之间的数据传输。这个算法帮助优化带宽的使用，确保网络中的资源被高效合理地分配。其核心目的是促进peer间的合作和数据的快速分发。</li><li><h3 id=窒息算法的基本原理>窒息算法的基本原理</h3><ul><li><strong>选择和窒息（Choking and Unchoking）</strong><ul><li>在BitTorrent网络中，每个peer同时维护着一组“窒息”（choked）和“未窒息”（unchoked）的peer名单。<ul><li>被“窒息”的peer无法从窒息方接收文件数据，而“未窒息”的peer可以进行数据交换。</li><li>这种状态是动态的，peer根据算法定期更新它们的窒息/未窒息peer名单。</li></ul></li></ul></li><li><strong>利益驱动的决策</strong><ul><li>算法核心是“利益驱动”（tit-for-tat）策略，即peer更倾向于向那些能给它提供数据的peer提供数据。<ul><li>这种方法鼓励peer分享数据，因为分享越多，获得数据的机会也越大。</li></ul></li></ul></li><li><strong>优化器</strong>：<ul><li>除了基于交换数据的量来决定窒息状态外，大多数BitTorrent客户端还实现了一个“优化器”（Optimizer），用于探索新的peer。<ul><li>通常，这是通过定期“未窒息”一个随机选择的peer来实现的，即使它在过去的数据交换中表现不佳或没有数据交换。</li></ul></li></ul></li><li><strong>窒息周期</strong>：<ul><li>peer定期评估其连接，并根据从其他peer接收到的数据速率来更新其窒息/未窒息名单</li></ul></li></ul></li><li><h3 id=窒息算法的重要性>窒息算法的重要性</h3><ul><li><strong>合作促进</strong>：通过奖励那些分享资源的peer，窒息算法鼓励合作，提高了网络中的资源共享效率。</li><li><strong>防止自私行为</strong>：算法减少了自私peer（只下载不上传的）的优势，因为这些peer不太可能被其他peer“未窒息”。</li><li><strong>网络拥塞控制</strong>：它帮助控制网络拥塞，通过限制peer的连接数量和数据传输，优化带宽使用。</li></ul></li><li><h3 id=结论-1>结论</h3><ul><li>窒息算法是BitTorrent协议高效性的关键，它通过一种简单但有效的方式来鼓励数据共享和合作，保证了整个网络的健康和高效运行。通过这种动态的窒息/未窒息机制，BitTorrent网络能够有效地管理带宽和连接，确保资源在网络中的快速且公平的分配。</li></ul></li></ul></li><li><h2 id=为什么说已经足够了>为什么说“已经足够了”</h2><ul><li><blockquote><p>因为这是一门实验科学</p></blockquote></li><li><h3 id=最稀有优先算法rarest-first-algorithm-1>&ldquo;最稀有优先算法&rdquo;（Rarest First Algorithm）</h3><ul><li><h3 id=种子的熵>种子的熵</h3><ul><li>描述了种子中各个数据块在所有peer间的分布情况</li><li>高熵意味着数据块在所有peer中分布得很均匀，peer之间更有可能拥有彼此尚未下载的块</li><li>高熵的种子通常意味着更高的数据交换效率</li></ul></li><li><h3 id=理想熵ideal-entrophy>理想熵（Ideal Entrophy）</h3><ul><li>是指网络中的数据块（pieces）在所有leechers之间均匀分布</li><li>每个leechers都持有一些其他leechers需要的数据块，从而确保了网络中的每个leechers都对其他leechers感兴趣。</li></ul></li><li><h3 id=冷启动transient-state>冷启动（Transient State）</h3><ul><li>当种子刚开始传播时的动态，优先传播稀有块，提高下载效率</li><li>Rarest First Algorithm解决了种子的冷启动问题，确保了最不常见的块被优先传播，提高了整个网络的下载效率</li></ul></li><li><h3 id=稳定态steady-state>稳定态（Steady State）</h3><ul><li>网络中的大部分块已经被比较均匀地传播。最稀有优先算法在这一阶段继续确保数据块的多样性，从而减少了任何特定块成为瓶颈的可能性</li><li>算法鼓励peer间的有效合作，因为每个peer都可能持有其他peer需要的稀有块</li></ul></li><li><h3 id=最后一块问题last-pieces-problem>“最后一块”问题（Last Pieces Problem）</h3><ul><li>下载接近完成时，某些块变得非常稀有，从而延缓整个下载过程</li><li>算法确保即使在下载的后期，所有参与的peer仍然有激励去交换彼此之间缺少的块</li><li>避免了下载末期的稀有块瓶颈</li></ul></li></ul></li><li><h3 id=窒息算法choking-algorithm-1>&ldquo;窒息算法&rdquo;（Choking Algorithm）</h3><ul><li><h3 id=对等原则tit-for-tat-fairness>“对等原则”（Tit-for-tat Fairness）</h3><ul><li>如果A从B下载的数据少于B从A下载的数据，A会拒绝继续与B分享数据</li><li>用来保证公平性，杜绝free rider</li><li>在动态或非对称网络环境中可能效率低下</li><li>会导致网络空闲资源的浪费</li></ul></li><li><h3 id=旧版窒息算法>旧版窒息算法</h3><ul><li>旧版窒息算法只考虑了peer之间的下载速度，而不是它们的上传贡献<ul><li>少量上传速度快的leecher会占据大量带宽，不利于种子熵的增加</li><li>下载速度快的free riders得到了比实际贡献更多的回报</li></ul></li><li>基于更宏观的性能指标（如整体上传贡献）的策略能够更好地适应这些变化</li></ul></li><li><h3 id=新版窒息算法>新版窒息算法</h3><ul><li>上传速度快的leecher一定比上传速度慢的leecher获得更多的下载速度，保证了近似的对等原则</li><li>对于seed（做种者）而言，应该对每个leecher提供相同的服务时间。保证了网络中的公平性和效率</li><li>因为文件块可以被更平均的分配给了其它peer，在冷启动时的弹性更强，对于free riders的抵抗性也更强</li></ul></li></ul></li></ul></li><li>Link<ul><li><a href=http://conferences.sigcomm.org/imc/2006/papers/p20-legout.pdf>Rarest First and Choke Algorithms Are Enough</a></li></ul></li></ul><div class="alert alert-info" role=alert>本文部分内容由ChatGPT4生成</div></section></main><footer id=main-footer><div class=footer><a href=#></a><div class=footer-copyright><div class=dim>© 2025</div><div></div></div></div></footer></div><aside id=side-pane class=side-sticky><div class=side-details><span>2895 </span><span>7 - 9</span></div><h3></h3><nav id=TableOfContents><ul><li><a href=#基本概念>基本概念</a></li><li><a href=#最稀有优先算法rarest-first-algorithm>&ldquo;最稀有优先算法&rdquo;（Rarest First Algorithm）</a><ul><li><a href=#基本原理>基本原理</a></li><li><a href=#算法的重要性>算法的重要性</a></li><li><a href=#实际应用>实际应用</a></li><li><a href=#结论>结论</a></li></ul></li><li><a href=#窒息算法choking-algorithm>&ldquo;窒息算法&rdquo;（Choking Algorithm）</a><ul><li><a href=#窒息算法的基本原理>窒息算法的基本原理</a></li><li><a href=#窒息算法的重要性>窒息算法的重要性</a></li><li><a href=#结论-1>结论</a></li></ul></li><li><a href=#为什么说已经足够了>为什么说“已经足够了”</a><ul><li><a href=#最稀有优先算法rarest-first-algorithm-1>&ldquo;最稀有优先算法&rdquo;（Rarest First Algorithm）</a></li><li><a href=#种子的熵>种子的熵</a></li><li><a href=#理想熵ideal-entrophy>理想熵（Ideal Entrophy）</a></li><li><a href=#冷启动transient-state>冷启动（Transient State）</a></li><li><a href=#稳定态steady-state>稳定态（Steady State）</a></li><li><a href=#最后一块问题last-pieces-problem>“最后一块”问题（Last Pieces Problem）</a></li><li><a href=#窒息算法choking-algorithm-1>&ldquo;窒息算法&rdquo;（Choking Algorithm）</a></li><li><a href=#对等原则tit-for-tat-fairness>“对等原则”（Tit-for-tat Fairness）</a></li><li><a href=#旧版窒息算法>旧版窒息算法</a></li><li><a href=#新版窒息算法>新版窒息算法</a></li></ul></li></ul></nav><h3></h3><ul><li><a href=/posts/introduction-to-ceph/>Introduction to Ceph</a></li></ul></aside></div></div></body></html>