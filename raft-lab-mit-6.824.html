<!DOCTYPE html>
<html lang="zhs" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>6.824 Lab 2: Raft协议实现指南 （无剧透版） - Maerlyn's Rainbow</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://wizmann.top/statistics/favicon.png" rel="icon">

<link rel="canonical" href="https://wizmann.top/raft-lab-mit-6.824.html">

        <meta name="author" content="Wizmann" />
        <meta name="keywords" content="raft,分布式系统" />
        <meta name="description" content="背景 MIT6.824是一个用来学习分布式系统的非常好的资源。其中第二个课程作业就是关于Raft算法。 由于在工作中涉及到分布一致性算法的调研，接触了paxos/raft算法。然后被@neutronest安利了一发，于是开始 …" />

        <meta property="og:site_name" content="Maerlyn's Rainbow" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="6.824 Lab 2: Raft协议实现指南 （无剧透版）"/>
        <meta property="og:url" content="https://wizmann.top/raft-lab-mit-6.824.html"/>
        <meta property="og:description" content="背景 MIT6.824是一个用来学习分布式系统的非常好的资源。其中第二个课程作业就是关于Raft算法。 由于在工作中涉及到分布一致性算法的调研，接触了paxos/raft算法。然后被@neutronest安利了一发，于是开始 …"/>
        <meta property="article:published_time" content="2019-05-02" />
            <meta property="article:section" content="Blog" />
            <meta property="article:tag" content="raft" />
            <meta property="article:tag" content="分布式系统" />
            <meta property="article:author" content="Wizmann" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://wizmann.top/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="https://wizmann.top/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://wizmann.top/theme/css/pygments/solarizedlight.css" rel="stylesheet">
    <link rel="stylesheet" href="https://wizmann.top/theme/css/style.css" type="text/css"/>

        <link href="https://wizmann.top/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Maerlyn's Rainbow ATOM Feed"/>

        <link href="https://wizmann.top/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate"
              title="Maerlyn's Rainbow Blog ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://wizmann.top/" class="navbar-brand">
Maerlyn's Rainbow            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/category/blog.html">Blog</a></li>
                    <li><a href="https://vijos.org/d/wizmann/p">Online Judge</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://wizmann.top/raft-lab-mit-6.824.html"
                       rel="bookmark"
                       title="Permalink to 6.824 Lab 2: Raft协议实现指南 （无剧透版）">
                        6.824 Lab 2: Raft协议实现指南 （无剧透版）
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2019-05-02T21:33:00+08:00"> 2019-05-02</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://wizmann.top/tag/raft.html">raft</a>
        /
	<a href="https://wizmann.top/tag/fen-bu-shi-xi-tong.html">分布式系统</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2 id="_1">背景</h2>
<p>MIT6.824是一个用来学习分布式系统的非常好的资源。其中第二个课程作业就是关于<a href="https://pdos.csail.mit.edu/6.824/labs/lab-raft.html">Raft算法</a>。</p>
<p>由于在工作中涉及到分布一致性算法的调研，接触了paxos/raft算法。然后被@neutronest安利了一发，于是开始着手实现这个作业。</p>
<p>本文是我对这个项目的实现总结。希望能在划出重点的同时，不涉及实现细节，避免破坏大家的写代码体验。</p>
<p>本文唯一参考资料：<a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm</a></p>
<h2 id="_2">任务分解</h2>
<p>在官方文档里，整个项目被分成了2A、2B、2C三个部分：</p>
<ul>
<li>2A - 投票与选举</li>
<li>2B - 一致性</li>
<li>2C - 可持久化</li>
</ul>
<p>实际上，2C的工作量非常少，我们可以把2B和2C合成一个。然后单独提出几个比较重要的测试用例，划分成子项目。任务分解如下：</p>
<ul>
<li>2A - 投票与选举</li>
<li>2B/2C - 一致性和可持久化</li>
<li>三个难度比较高的Case<ul>
<li>Test (2B): leader backs up quickly over incorrect follower logs  <br>
验证协议实现的正确性</li>
<li>Test (2B): RPC counts aren&rsquo;t too high    <br>
测试协议是否产生了过多的RPC请求。验证协议的性能。</li>
<li>Test (2C): Figure 8 (unreliable)    <br>
测试在极端混乱的情况下，Raft协议是否能及时恢复正常工作。验证协议实现的正确性和性能。</li>
</ul>
</li>
</ul>
<p>所以推荐大家按顺序以上顺序进行实现。并且充分利用版本控制对代码进行开发和重构。</p>
<h2 id="_3">需要关注的知识点</h2>
<p>以下会介绍每一个部分需要重点关注的知识点，内容包括golang基础和论文中的知识点，无剧透，请放心食用。</p>
<h3 id="_4">准备工作</h3>
<p>golang是一门傲慢的语言，其标准库的缺乏实在是让人感到TMD蛋疼。但是对于一个课程作业来说，我们也没有必要引入一系列第三方库。所以我们先要扩充<code>util.go</code>文件，使其为我们的开发提供更多的便利。</p>
<h4 id="log">Log模块</h4>
<p>项目给出的<code>DPrintf</code>函数非常简单，只提供了一个<code>fmt.Printf</code>的封装。并不能打印行号和文件名。这里提供一个扩展版本。</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">DPrintf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">Debug</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">lineno</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">();</span>
<span class="w">            </span><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05.00&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">lineno</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">a</span><span class="o">...</span><span class="p">);</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s [%s:%d] &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="o">...</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>其输出示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="mi">2019</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">28</span><span class="err">:</span><span class="mf">35.04</span><span class="w"> </span><span class="o">[</span><span class="n">raft.go:652</span><span class="o">]</span><span class="w"> </span><span class="n">Node</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">processing</span><span class="p">,</span><span class="w"> </span><span class="k">state</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">LEADER</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">commitIndex</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="nl">logCount</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">leader</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

<h4 id="maxmin">Max和Min函数</h4>
<p>golang是没有对于int值的<code>max</code>和<code>min</code>函数的，这里省略脏话100句。</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Min</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Max</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="assert">Assert函数</h4>
<p>是的，你没有看错，golang也没有提供<code>assert</code>函数。如果你嫌到处写<code>if</code>和<code>panic</code>太丑的话，可以使用这个<code>assert</code>函数。</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">flag</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(!</span><span class="nx">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">lineno</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">();</span>
<span class="w">            </span><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05.00&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">lineno</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">a</span><span class="o">...</span><span class="p">);</span>
<span class="w">            </span><span class="nx">reason</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s [%s:%d] &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="o">...</span><span class="p">);</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">reason</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="log-id">Log Id</h4>
<p>为了验证日志的一致性，我们在日志中额外加入一个UUID来进行标识。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="s2">&quot;math/rand&quot;</span>

<span class="n">func</span><span class="w"> </span><span class="n">CreateLogId</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="n">uuid</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">make</span><span class="p">([]</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">    </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">rand</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%X</span><span class="s2">-</span><span class="si">%X</span><span class="s2">-</span><span class="si">%X</span><span class="s2">-</span><span class="si">%X</span><span class="s2">-</span><span class="si">%X</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">uuid</span>
<span class="p">}</span>
</code></pre></div>

<p>以上代码可以生成一个（伪）UUID对日志进行标识。推荐使用<code>math/rand</code>，因为这里我们使用伪随机数就够了。</p>
<blockquote>
<p>注：这里的UUID只是看起来像一个UUID，实际上UUID有其特殊的规范与格式。但是由于golang内部没有提供可用的UUID库，所以只好随手模拟了一个。</p>
</blockquote>
<h4 id="_5">文件组织</h4>
<p>默认的实现是把所有的东西都写到了<code>raft.go</code>文件里。一个非常大的文件可能会给我们的开发带来负担，所以我的做法是把所有的类声明放到<code>models.go</code>文件里。以避免文件的膨胀。</p>
<h4 id="defer">锁与defer</h4>
<p>在raft实现中，锁可以用来保证在多线程环境下数据的正确性。所以只要在涉及到raft内部状态的变化时，都需要加锁。一个常见的加锁pattern是：</p>
<div class="highlight"><pre><span></span><code><span class="nx">rf</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 加锁</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">rf</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 在函数执行完成后解锁</span>
</code></pre></div>

<p>这里推荐使用defer，因为手动控制锁实现是过于容易出错。但是defer也是有坑的！</p>
<p>不同于C++的大括号作用域，defer的触发时间是在函数执行完成之后，而并不是退出当前大括号时。这点非常需要注意，否则极易出现死锁。</p>
<p>如果我们想实现C++中<code>do { ... } while (0);</code>类似的lock guard pattern，可以使用以下实现：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rf</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">rf</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// do something here</span>
<span class="p">}()</span>
</code></pre></div>

<p>这样一来，在执行完当前lambda之后，就会自动解锁。</p>
<h4 id="_6">刷新定时器</h4>
<p>由于raft算法里面使用了定时器，这里提供一个刷新定时器的golang代码。这样实现是为了每次在刷新的时候，清空定时器中原有的超时时间，以避免混乱。</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rf</span><span class="w"> </span><span class="o">*</span><span class="nx">Raft</span><span class="p">)</span><span class="w"> </span><span class="nx">renewTimer</span><span class="p">(</span><span class="nx">timeout</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rf</span><span class="p">.</span><span class="nx">timer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">rf</span><span class="p">.</span><span class="nx">timer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTimer</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(!</span><span class="nx">rf</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Stop</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">rf</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
<span class="w">                </span><span class="c1">// pass</span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span>
<span class="w">                </span><span class="c1">// pass</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">rf</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>以及，在定时器超时之后，不要忘了更新定时器。</p>
<h3 id="2a-">2A - 投票与选举</h3>
<h4 id="_7">所需要类的声明</h4>
<p>论文中的<code>Figure2</code>包含了算法中所有的类以及基本算法。在2A中，所有的类都会被用到。由于2A中只包括投票与选举，所以和日志相关的字段可以先忽略掉。</p>
<h4 id="checklist-for-2a">Checklist for 2A</h4>
<ul>
<li>实现raft状态机的三个状态：leader，follower和candidate</li>
<li>实现RPC函数：<code>sendRequestVote</code>（发送端）和<code>RequestVote</code>（接收端的回调函数）</li>
<li>实现RPC函数：<code>sendAppendEntries</code>（发送端）和<code>AppendEntries</code>（接收端的回调函数）    </li>
<li>保证raft状态机的任期号（<code>currentTerm</code>）是单调递增的</li>
<li>一个Follower对于某一个Term只能投出一票</li>
<li>实现Leader心跳，维护当前任期（Term）。</li>
<li>实现Follower选举超时（election timeout）</li>
<li>实现Candidate选举的三种场景<ul>
<li>获得多数选票，赢得选举。状态切换为Leader</li>
<li>其它的节点已经被选为Leader。状态切换为Follower</li>
<li>在选举中并未获得多数选票，状态切换为Follower</li>
</ul>
</li>
<li>实现Candidate随机选举超时（randomized election timeout）</li>
</ul>
<h3 id="2b2c-">2B/2C - 日志复制与持久化</h3>
<h4 id="_8">基本工作流</h4>
<p>日志复制的基本工作流如下：</p>
<p>Leader接受用户请求，将状态变化写入本机的日志流中，并且把日志复制到Followers。如果本条日志合法，Followers会将这条日志标记为“提交”（committed），然后再将这条日志“应用”（apply）到Raft协议之外的状态机。Follower在提交日志之后，就可以向Leader回报这条日志已经被提交。在本条日志被多数节点提交之后，Leader再将这条日志标记为提交。此时，用户的请求就可以被确认（ACK）了。</p>
<p>Raft的论文中，Leader需要维护<code>commitIndex</code>和<code>lastApplied</code>这两个状态。为了简单起见，我们可以忽略“应用”（apply）这个过程。这两个状态我们只需要维护<code>commitIndex</code>即可。</p>
<blockquote>
<p>Raft协议不是2PC，千万不要搞混了哦～</p>
</blockquote>
<h4 id="_9">回滚与滚回来</h4>
<p><img alt="rollback" src="https://raw.githubusercontent.com/Wizmann/assets/3f1056d6f142755204092fb89a474dc964608bab/wizmann-pic/2019-05-02_14-40-52.png"></p>
<p>从上面的工作流我们可以看到，对于已经committed的日志，仍然有可能是不可靠的。</p>
<p>例如，在Term1时，节点1作业Leader提交到了日志(1, 2)，而Follower节点Node2和Node3分别提交到了日志(1, 2)和(1, 3)。此时Leader短暂断线，出发选举超时，就会进行下一轮的选举。如果节点Node2被选为Leader，那么节点Node3就会被Leader多出一条日志，这是不被允许的。如果节点Node3被选为Leader，那么Node2就比Leader在Term1少一条日志，需要补齐。</p>
<blockquote>
<p>这里有人可能会怀疑，节点2比节点3少一条日志，那么按照论文里的说法，因为节点3的日志比较节点2要多，所以只有节点3才能赢得下一轮选举。这其实是不对的，如果节点3断线，节点1和节点2仍然可以组成一个quorum，选举出Leader。</p>
</blockquote>
<p>所以我们需要考虑将已committed的日志回滚（向左滚），以及缺失的日志补齐（向右滚）。这里其实有一些优化的点，我们后文再说。</p>
<p>再次注意，保证日志的一致性是Raft协议正确性的必须保证，在这一点上一定要注意。</p>
<h4 id="_10">乱序请求</h4>
<p>本项目中，模拟的RPC协议并不能保证可靠性（会丢包）、有序性（会乱序），也没有SLA（没有超时时间的上限），更不用想拥塞控制。我们可以理解为它在底层使用了UDP协议，而不是TCP。所以我们不能做出任何假设。</p>
<p>例如，两个请求先后来到Leader端，A请求编号(1,100)，B请求编号(1,110)。然后我们依次将Log复制到Follower端（A先B后），但是在Follower端有可能收到的顺序是B先A后。甚至只收到B，没收到A。这种情况日常工程中的TCP协议下几乎不能发生，但是在测试环境中要十分小心。</p>
<h4 id="checklist-for-2b2c">Checklist for 2B/2C</h4>
<ul>
<li>日志的状态会影响Leader选举  <br>
如果两份日志流的最后一条日志的Term不一样，那么我们认为Term号大的日志“比较新”。如果Term号一样，那么Index大的日志“比较新”</li>
<li>如果Leader和Follower的日志不一致，那么Follower需要拷贝Leader的日志（向左滚或向右滚的正确性）    <br>
这里推荐使用Assert加断言进行保证，如果出错可以获得实时的现场</li>
<li>对于小于当前Term的日志，Leader不需要等多数Follower确认就可以直接commit</li>
<li>一个重要特性：如果两个日志的(Term, Index)一致，那么其内容也是一致的。并且在此日志之前的所有日志都必须是一致的</li>
<li>另一个重要特性：RPC请求是幂等的，也就是多次重复发送一个请求并不会破坏Raft协议的状态</li>
</ul>
<h3 id="3case">最后的3个Case</h3>
<p>最后的三个Case有一个共同点，就是对协议的效率和正确性有比较高的要求。即使前面的代码里你的实现是正确的，也有可能因为各种其它的原因造成Case挂掉。</p>
<p>建议首先解决正确性问题，再提升效率。</p>
<h4 id="_11">向左滚的优化（重要！）</h4>
<p>在论文的5.3节，介绍了一种回滚的优化。如果Leader和Follower在某个Index上的日志不一致，Leader的版本记为(Term1, Index)，Follower的版本记为(Term2, Index)。那么Follower需要回滚所有日志，直到Term小于<code>Min(Term1, Term2)</code>。</p>
<p>这样的好处是可以加快回滚的效率。虽然论文上表示这种优化并非必要，但是在模拟出来的极端网络环境下，这样的优化可以帮助我们通过一些比较变态的Case。</p>
<h4 id="_12">其它的非官方优化</h4>
<p>这里还有一些论文里没的提到的优化方案，不保证一定是正确的。</p>
<p>为了不剧透，放到单独的链接里了：<a href="https://github.com/Wizmann/assets/blob/master/wizmann-pic/19-05-02/raft-hints.md">剧透警告！</a></p>
<blockquote>
<p>还有一个Bonus挑战，谁比较闲可以试一下。</p>
</blockquote>
<h2 id="_13">测试结果</h2>
<p><img alt="tests" src="https://raw.githubusercontent.com/Wizmann/assets/e35dd59aa533ddd19065f070dcb85a3734cc035d/wizmann-pic/19-05-02/2019-05-02_21-37-14.png"></p>
<p>在Travis CI上面运行的测试。自我感觉实现的比较一般，所以你们的程序应该跑的比我快一点才正常。</p>
<h2 id="_14">总结</h2>
<p>想要完整正确的实现这个项目，首先一定要把论文读懂。并且划出实现上应该注意的重点。</p>
<p>当遇到正确性问题时，一定要回归论文，大部分的问题都可以获得解答。当遇到性能问题时，可以参考作业上面的Hints，里面也有非常有用的信息。</p>
<p>MIT的这个课程还有基于raft实现kv storage的项目，后续如果有时间应该还会做吧。</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'wizmann'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "zhs";

                        this.page.identifier = '2019-05-02-raft-lab-mit-6.824';
                        this.page.url = 'https://wizmann.top/raft-lab-mit-6.824.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://github.com/wizmann"><i class="fa fa-github-square fa-lg"></i> github</a></li>
    <li class="list-group-item"><a href="https://wizmann.top//feeds/all.atom.xml"><i class="fa fa-rss-square fa-lg"></i> rss</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://wizmann.top/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group " id="tags">
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/cpp.html">cpp</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/algorithm.html">algorithm</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/suan-fa.html">算法</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/codeforces.html">codeforces</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/c.html">C++</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/fen-bu-shi-xi-tong.html">分布式系统</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://wizmann.top/tag/ti-jie.html">题解</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/udp.html">UDP</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/cas.html">cas</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/rpc.html">rpc</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/shu-ju-xi-tong.html">数据系统</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/shu-ju-ku.html">数据库</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/leetcode.html">Leetcode</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/interview.html">interview</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/multithread.html">multithread</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/jian-suo-zeng-qiang-sheng-cheng.html">检索增强生成</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/xian-liao.html">闲聊</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/rag.html">RAG</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/modern-cpp.html">modern cpp</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/protocol.html">protocol</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/multi-thread.html">multi-thread</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/yi-zhi-xing.html">一致性</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/networking.html">networking</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/storage.html">storage</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/xin-xi-jian-suo.html">信息检索</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/stup.html">STUP</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/distributed-system.html">Distributed System</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/phxrpc.html">phxrpc</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/memory-barrier.html">memory-barrier</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/system-design.html">System Design</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/thread.html">thread</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/llm.html">LLM</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/tcp.html">tcp</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/duo-xian-cheng.html">多线程</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://wizmann.top/tag/gong-kai-ke.html">公开课</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/spinpromela.html">SPIN/Promela</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/promela.html">Promela</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/storage-system.html">storage system</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/google.html">Google</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/bing-fa-bian-cheng.html">并发编程</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/induction.html">induction</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/raft.html">raft</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/ucontext.html">ucontext</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/paxos.html">paxos</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/cse351.html">CSE351</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/cmpxchg.html">cmpxchg</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/basic-paxos.html">basic paxos</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/solution.html">Solution</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/azure.html">azure</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/async.html">async</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/3d-printing.html">3D printing</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/shu-ju-mi-ji-xing-ying-yong-xi-tong.html">数据密集型应用系统</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://wizmann.top/tag/spin.html">SPIN</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/shu-ju-mo-xing.html">数据模型</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/yi-zhi-xing-xie-yi.html">一致性协议</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/zi-fu-chuan-zhong-xie-xi-tong.html">字符串重写系统</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/shu-xing-dp.html">树形DP</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/bian-yi-qi-bian-cheng.html">编译期编程</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/mutex.html">mutex</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/yuan-lei.html">元类</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/cppcon.html">CppCon</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/cppcon2024.html">CppCon2024</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/3dda-yin.html">3D打印</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/led.html">LED</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/nei-cun-mo-xing.html">内存模型</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/fen-bu-shi-shi-wu.html">分布式事务</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/diy.html">DIY</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/excrt.html">excrt</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/segment-tree.html">segment-tree</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/shu-lian-pou-fen.html">树链剖分</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/an-quan-xing.html">安全性</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/dp.html">dp</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/bing-fa.html">并发</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/qi-fa-shi-he-bing.html">启发式合并</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/semaphore.html">semaphore</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/fen-bu-shi-gong-shi.html">分布式共识</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/nosql.html">nosql</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/post.html">Post</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/shu-ju-bian-ma.html">数据编码</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/litmus.html">litmus</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/fan-she.html">反射</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/si-suo.html">死锁</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/hash.html">hash</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/partitioning.html">partitioning</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/xian-duan-shu.html">线段树</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/volatile.html">volatile</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/shu-ju-jie-gou.html">数据结构</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/ab.html">A=B</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/tu-ling-wan-bei-xing.html">图灵完备性</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/suo-yin-jie-gou.html">索引结构</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/repartitioning.html">repartitioning</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/thue.html">Thue</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/crt.html">crt</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/herb-sutter.html">Herb Sutter</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/condition_variable.html">condition_variable</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/dsu-on-tree.html">DSU on Tree</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/math.html">math</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/bian-yi-qi-you-hua.html">编译器优化</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/deng-ju-she-ji.html">灯具设计</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://wizmann.top/tag/3dmo-xing.html">3D模型</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://getpelican.com/" target="_blank">Pelican</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2025 Wizmann
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://wizmann.top/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://wizmann.top/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://wizmann.top/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'wizmann'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46053117-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->


</body>
</html>